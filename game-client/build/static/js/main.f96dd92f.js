/*! For license information please see main.f96dd92f.js.LICENSE.txt */
(()=>{var e={2:(e,t,n)=>{"use strict";var r,o=n(1251),a=n(9304),s=n(9820),i=n(1725),l=n(5077),c=n(2557),d=n(4902),u=n(3094),h=n(3701),p=n(1911),m=n(4591),f=n(1557),g=n(7583),y=n(969),v=n(7792),b=Function,x=function(e){try{return b('"use strict"; return ('+e+").constructor;")()}catch(t){}},w=n(5558),S=n(2090),T=function(){throw new d},C=w?function(){try{return T}catch(e){try{return w(arguments,"callee").get}catch(t){return T}}}():T,k=n(2108)(),A=n(1291),I=n(7651),E=n(757),P=n(5061),_=n(4937),N={},R="undefined"!==typeof Uint8Array&&A?A(Uint8Array):r,M={__proto__:null,"%AggregateError%":"undefined"===typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"===typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":k&&A?A([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":N,"%AsyncGenerator%":N,"%AsyncGeneratorFunction%":N,"%AsyncIteratorPrototype%":N,"%Atomics%":"undefined"===typeof Atomics?r:Atomics,"%BigInt%":"undefined"===typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"===typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"===typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"===typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":a,"%eval%":eval,"%EvalError%":s,"%Float16Array%":"undefined"===typeof Float16Array?r:Float16Array,"%Float32Array%":"undefined"===typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"===typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"===typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":b,"%GeneratorFunction%":N,"%Int8Array%":"undefined"===typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"===typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"===typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":k&&A?A(A([][Symbol.iterator]())):r,"%JSON%":"object"===typeof JSON?JSON:r,"%Map%":"undefined"===typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!==typeof Map&&k&&A?A((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":o,"%Object.getOwnPropertyDescriptor%":w,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"===typeof Promise?r:Promise,"%Proxy%":"undefined"===typeof Proxy?r:Proxy,"%RangeError%":i,"%ReferenceError%":l,"%Reflect%":"undefined"===typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"===typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!==typeof Set&&k&&A?A((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"===typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":k&&A?A(""[Symbol.iterator]()):r,"%Symbol%":k?Symbol:r,"%SyntaxError%":c,"%ThrowTypeError%":C,"%TypedArray%":R,"%TypeError%":d,"%Uint8Array%":"undefined"===typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"===typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"===typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"===typeof Uint32Array?r:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"===typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"===typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"===typeof WeakSet?r:WeakSet,"%Function.prototype.call%":_,"%Function.prototype.apply%":P,"%Object.defineProperty%":S,"%Object.getPrototypeOf%":I,"%Math.abs%":h,"%Math.floor%":p,"%Math.max%":m,"%Math.min%":f,"%Math.pow%":g,"%Math.round%":y,"%Math.sign%":v,"%Reflect.getPrototypeOf%":E};if(A)try{null.error}catch(W){var j=A(A(W));M["%Error.prototype%"]=j}var D=function e(t){var n;if("%AsyncFunction%"===t)n=x("async function () {}");else if("%GeneratorFunction%"===t)n=x("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=x("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&A&&(n=A(o.prototype))}return M[t]=n,n},O={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},B=n(3864),L=n(4384),F=B.call(_,Array.prototype.concat),$=B.call(P,Array.prototype.splice),G=B.call(_,String.prototype.replace),z=B.call(_,String.prototype.slice),U=B.call(_,RegExp.prototype.exec),H=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,q=/\\(\\)?/g,V=function(e,t){var n,r=e;if(L(O,r)&&(r="%"+(n=O[r])[0]+"%"),L(M,r)){var o=M[r];if(o===N&&(o=D(r)),"undefined"===typeof o&&!t)throw new d("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!==typeof e||0===e.length)throw new d("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!==typeof t)throw new d('"allowMissing" argument must be a boolean');if(null===U(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=z(e,0,1),n=z(e,-1);if("%"===t&&"%"!==n)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var r=[];return G(e,H,(function(e,t,n,o){r[r.length]=n?G(o,q,"$1"):t||e})),r}(e),r=n.length>0?n[0]:"",o=V("%"+r+"%",t),a=o.name,s=o.value,i=!1,l=o.alias;l&&(r=l[0],$(n,F([0,1],l)));for(var u=1,h=!0;u<n.length;u+=1){var p=n[u],m=z(p,0,1),f=z(p,-1);if(('"'===m||"'"===m||"`"===m||'"'===f||"'"===f||"`"===f)&&m!==f)throw new c("property names with quotes must have matching quotes");if("constructor"!==p&&h||(i=!0),L(M,a="%"+(r+="."+p)+"%"))s=M[a];else if(null!=s){if(!(p in s)){if(!t)throw new d("base intrinsic for "+e+" exists, but the property is not available.");return}if(w&&u+1>=n.length){var g=w(s,p);s=(h=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:s[p]}else h=L(s,p),s=s[p];h&&!i&&(M[a]=s)}}return s}},149:(e,t,n)=>{"use strict";var r=n(9108),o=Object.prototype.hasOwnProperty,a=Array.isArray,s=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),i=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)"undefined"!==typeof e[r]&&(n[r]=e[r]);return n},l=1024;e.exports={arrayToObject:i,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var o=t[r],s=o.obj[o.prop],i=Object.keys(s),l=0;l<i.length;++l){var c=i[l],d=s[c];"object"===typeof d&&null!==d&&-1===n.indexOf(d)&&(t.push({obj:s,prop:c}),n.push(d))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(a(n)){for(var r=[],o=0;o<n.length;++o)"undefined"!==typeof n[o]&&r.push(n[o]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(o){return r}},encode:function(e,t,n,o,a){if(0===e.length)return e;var i=e;if("symbol"===typeof e?i=Symbol.prototype.toString.call(e):"string"!==typeof e&&(i=String(e)),"iso-8859-1"===n)return escape(i).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",d=0;d<i.length;d+=l){for(var u=i.length>=l?i.slice(d,d+l):i,h=[],p=0;p<u.length;++p){var m=u.charCodeAt(p);45===m||46===m||95===m||126===m||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122||a===r.RFC1738&&(40===m||41===m)?h[h.length]=u.charAt(p):m<128?h[h.length]=s[m]:m<2048?h[h.length]=s[192|m>>6]+s[128|63&m]:m<55296||m>=57344?h[h.length]=s[224|m>>12]+s[128|m>>6&63]+s[128|63&m]:(p+=1,m=65536+((1023&m)<<10|1023&u.charCodeAt(p)),h[h.length]=s[240|m>>18]+s[128|m>>12&63]+s[128|m>>6&63]+s[128|63&m])}c+=h.join("")}return c},isBuffer:function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(a(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!==typeof n){if(a(t))t.push(n);else{if(!t||"object"!==typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!o.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!==typeof t)return[t].concat(n);var s=t;return a(t)&&!a(n)&&(s=i(t,r)),a(t)&&a(n)?(n.forEach((function(n,a){if(o.call(t,a)){var s=t[a];s&&"object"===typeof s&&n&&"object"===typeof n?t[a]=e(s,n,r):t.push(n)}else t[a]=n})),t):Object.keys(n).reduce((function(t,a){var s=n[a];return o.call(t,a)?t[a]=e(t[a],s,r):t[a]=s,t}),s)}}},579:(e,t,n)=>{"use strict";e.exports=n(1153)},639:(e,t,n)=>{"use strict";var r=n(149),o=Object.prototype.hasOwnProperty,a=Array.isArray,s={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:r.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},i=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"===typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,r){if(e){var a=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,s=/(\[[^[\]]*])/g,i=n.depth>0&&/(\[[^[\]]*])/.exec(a),c=i?a.slice(0,i.index):a,d=[];if(c){if(!n.plainObjects&&o.call(Object.prototype,c)&&!n.allowPrototypes)return;d.push(c)}for(var u=0;n.depth>0&&null!==(i=s.exec(a))&&u<n.depth;){if(u+=1,!n.plainObjects&&o.call(Object.prototype,i[1].slice(1,-1))&&!n.allowPrototypes)return;d.push(i[1])}if(i){if(!0===n.strictDepth)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");d.push("["+a.slice(i.index)+"]")}return function(e,t,n,r){for(var o=r?t:l(t,n),a=e.length-1;a>=0;--a){var s,i=e[a];if("[]"===i&&n.parseArrays)s=n.allowEmptyArrays&&(""===o||n.strictNullHandling&&null===o)?[]:[].concat(o);else{s=n.plainObjects?Object.create(null):{};var c="["===i.charAt(0)&&"]"===i.charAt(i.length-1)?i.slice(1,-1):i,d=n.decodeDotInKeys?c.replace(/%2E/g,"."):c,u=parseInt(d,10);n.parseArrays||""!==d?!isNaN(u)&&i!==d&&String(u)===d&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(s=[])[u]=o:"__proto__"!==d&&(s[d]=o):s={0:o}}o=s}return o}(d,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return s;if("undefined"!==typeof e.allowEmptyArrays&&"boolean"!==typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!==typeof e.decodeDotInKeys&&"boolean"!==typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&"undefined"!==typeof e.decoder&&"function"!==typeof e.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t="undefined"===typeof e.charset?s.charset:e.charset,n="undefined"===typeof e.duplicates?s.duplicates:e.duplicates;if("combine"!==n&&"first"!==n&&"last"!==n)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:"undefined"===typeof e.allowDots?!0===e.decodeDotInKeys||s.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"===typeof e.allowEmptyArrays?!!e.allowEmptyArrays:s.allowEmptyArrays,allowPrototypes:"boolean"===typeof e.allowPrototypes?e.allowPrototypes:s.allowPrototypes,allowSparse:"boolean"===typeof e.allowSparse?e.allowSparse:s.allowSparse,arrayLimit:"number"===typeof e.arrayLimit?e.arrayLimit:s.arrayLimit,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:s.charsetSentinel,comma:"boolean"===typeof e.comma?e.comma:s.comma,decodeDotInKeys:"boolean"===typeof e.decodeDotInKeys?e.decodeDotInKeys:s.decodeDotInKeys,decoder:"function"===typeof e.decoder?e.decoder:s.decoder,delimiter:"string"===typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:s.delimiter,depth:"number"===typeof e.depth||!1===e.depth?+e.depth:s.depth,duplicates:n,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"===typeof e.interpretNumericEntities?e.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"===typeof e.parameterLimit?e.parameterLimit:s.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"===typeof e.plainObjects?e.plainObjects:s.plainObjects,strictDepth:"boolean"===typeof e.strictDepth?!!e.strictDepth:s.strictDepth,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:s.strictNullHandling}}(t);if(""===e||null===e||"undefined"===typeof e)return n.plainObjects?Object.create(null):{};for(var d="string"===typeof e?function(e,t){var n={__proto__:null},c=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;c=c.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var d,u=t.parameterLimit===1/0?void 0:t.parameterLimit,h=c.split(t.delimiter,u),p=-1,m=t.charset;if(t.charsetSentinel)for(d=0;d<h.length;++d)0===h[d].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[d]?m="utf-8":"utf8=%26%2310003%3B"===h[d]&&(m="iso-8859-1"),p=d,d=h.length);for(d=0;d<h.length;++d)if(d!==p){var f,g,y=h[d],v=y.indexOf("]="),b=-1===v?y.indexOf("="):v+1;-1===b?(f=t.decoder(y,s.decoder,m,"key"),g=t.strictNullHandling?null:""):(f=t.decoder(y.slice(0,b),s.decoder,m,"key"),g=r.maybeMap(l(y.slice(b+1),t),(function(e){return t.decoder(e,s.decoder,m,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===m&&(g=i(g)),y.indexOf("[]=")>-1&&(g=a(g)?[g]:g);var x=o.call(n,f);x&&"combine"===t.duplicates?n[f]=r.combine(n[f],g):x&&"last"!==t.duplicates||(n[f]=g)}return n}(e,n):e,u=n.plainObjects?Object.create(null):{},h=Object.keys(d),p=0;p<h.length;++p){var m=h[p],f=c(m,d[m],n,"string"===typeof e);u=r.merge(u,f,n)}return!0===n.allowSparse?u:r.compact(u)}},757:e=>{"use strict";e.exports="undefined"!==typeof Reflect&&Reflect.getPrototypeOf||null},819:(e,t,n)=>{"use strict";n.d(t,{AQ:()=>l,El:()=>a,fE:()=>i,gU:()=>o,if:()=>s,rw:()=>c,vh:()=>d});var r=n(1431);n(3488);const o=(e,t)=>{const n=[];for(let r=1;r<=4;r++){const o=e[`ingredient${r}`],a=e[`ingredient${r}qty`];if(o&&a){const e=t.find((e=>e.type===o)),r=(null===e||void 0===e?void 0:e.symbol)||"";n.push(`${r} ${o} x${a}`)}}return n};function a(e,t){console.log("\ud83e\uddea mergeTiles called"),console.log("\ud83d\udce5 Existing Tiles:",e.length,"rows"),console.log("\ud83d\udce5 Updated Tiles:",t);const n=e.map((e=>[...e]));let r=!1;return t.forEach((e=>{let{x:t,y:o,type:a}=e;if(n[o]&&"undefined"!==typeof n[o][t]){const e=n[o][t];e!==a?(console.log(`\ud83d\udd04 Tile at (${t},${o}) changed from "${e}" to "${a}"`),n[o][t]=a,r=!0):console.log(`\u2705 Tile at (${t},${o}) is already "${a}" \u2014 no change`)}else console.warn(`\u26a0\ufe0f Attempted to update invalid tile at (${t},${o})`)})),console.log("\u2705 mergeTiles returning new tile array"),console.log("\ud83d\udd01 Any tiles changed?",r),n}function s(e,t){const n=t.find((t=>t.type===e.type));return n?{...n,...e}:(console.warn(`\u26a0\ufe0f No matching resource template found for ${e.type}`),e)}function i(e,t){const n=r.default.getPlayersInGrid(e);if(!n||null===t||void 0===t||!t.playerId)return console.warn("\u26a0\ufe0f playersInGrid or playerId missing."),null;const o=n[t.playerId];if(!o)return console.warn("\u26a0\ufe0f Player not found in playersInGrid."),null;const{x:a,y:s}=o.position;if(null==a||null==s)return console.warn("\u26a0\ufe0f Invalid player position."),null;return{tileX:Math.floor(a),tileY:Math.floor(s)}}function l(e,t){if("Oak Tree"===e||"Pine Tree"===e)return!1;return!!t.some((t=>"farmplot"===t.category&&t.output===e))}function c(e,t){var n,r;return"devonly"===e||(!e||null!==(n=null===t||void 0===t||null===(r=t.skills)||void 0===r?void 0:r.some((t=>t.type===e)))&&void 0!==n&&n)}function d(e,t){return"devonly"!==e.requires||t}},969:e=>{"use strict";e.exports=Math.round},973:e=>{"use strict";function t(e,t,r){r=r||2;var a,s,i,l,u,h,m,f=t&&t.length,g=f?t[0]*r:e.length,y=n(e,0,g,r,!0),v=[];if(!y||y.next===y.prev)return v;if(f&&(y=function(e,t,r,o){var a,s,i,l=[];for(a=0,s=t.length;a<s;a++)(i=n(e,t[a]*o,a<s-1?t[a+1]*o:e.length,o,!1))===i.next&&(i.steiner=!0),l.push(p(i));for(l.sort(c),a=0;a<l.length;a++)r=d(l[a],r);return r}(e,t,y,r)),e.length>80*r){a=i=e[0],s=l=e[1];for(var b=r;b<g;b+=r)(u=e[b])<a&&(a=u),(h=e[b+1])<s&&(s=h),u>i&&(i=u),h>l&&(l=h);m=0!==(m=Math.max(i-a,l-s))?32767/m:0}return o(y,v,r,a,s,m,0),v}function n(e,t,n,r,o){var a,s;if(o===A(e,t,n,r)>0)for(a=t;a<n;a+=r)s=T(a,e[a],e[a+1],s);else for(a=n-r;a>=t;a-=r)s=T(a,e[a],e[a+1],s);return s&&y(s,s.next)&&(C(s),s=s.next),s}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!y(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(C(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function o(e,t,n,c,d,u,p){if(e){!p&&u&&function(e,t,n,r){var o=e;do{0===o.z&&(o.z=h(o.x,o.y,t,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,n,r,o,a,s,i,l,c=1;do{for(n=e,e=null,a=null,s=0;n;){for(s++,r=n,i=0,t=0;t<c&&(i++,r=r.nextZ);t++);for(l=c;i>0||l>0&&r;)0!==i&&(0===l||!r||n.z<=r.z)?(o=n,n=n.nextZ,i--):(o=r,r=r.nextZ,l--),a?a.nextZ=o:e=o,o.prevZ=a,a=o;n=r}a.nextZ=null,c*=2}while(s>1)}(o)}(e,c,d,u);for(var m,f,g=e;e.prev!==e.next;)if(m=e.prev,f=e.next,u?s(e,c,d,u):a(e))t.push(m.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),C(e),e=f.next,g=f.next;else if((e=f)===g){p?1===p?o(e=i(r(e),t,n),t,n,c,d,u,2):2===p&&l(e,t,n,c,d,u):o(r(e),t,n,c,d,u,1);break}}}function a(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var o=t.x,a=n.x,s=r.x,i=t.y,l=n.y,c=r.y,d=o<a?o<s?o:s:a<s?a:s,u=i<l?i<c?i:c:l<c?l:c,h=o>a?o>s?o:s:a>s?a:s,p=i>l?i>c?i:c:l>c?l:c,f=r.next;f!==t;){if(f.x>=d&&f.x<=h&&f.y>=u&&f.y<=p&&m(o,i,a,l,s,c,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function s(e,t,n,r){var o=e.prev,a=e,s=e.next;if(g(o,a,s)>=0)return!1;for(var i=o.x,l=a.x,c=s.x,d=o.y,u=a.y,p=s.y,f=i<l?i<c?i:c:l<c?l:c,y=d<u?d<p?d:p:u<p?u:p,v=i>l?i>c?i:c:l>c?l:c,b=d>u?d>p?d:p:u>p?u:p,x=h(f,y,t,n,r),w=h(v,b,t,n,r),S=e.prevZ,T=e.nextZ;S&&S.z>=x&&T&&T.z<=w;){if(S.x>=f&&S.x<=v&&S.y>=y&&S.y<=b&&S!==o&&S!==s&&m(i,d,l,u,c,p,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;if(S=S.prevZ,T.x>=f&&T.x<=v&&T.y>=y&&T.y<=b&&T!==o&&T!==s&&m(i,d,l,u,c,p,T.x,T.y)&&g(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;S&&S.z>=x;){if(S.x>=f&&S.x<=v&&S.y>=y&&S.y<=b&&S!==o&&S!==s&&m(i,d,l,u,c,p,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;T&&T.z<=w;){if(T.x>=f&&T.x<=v&&T.y>=y&&T.y<=b&&T!==o&&T!==s&&m(i,d,l,u,c,p,T.x,T.y)&&g(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function i(e,t,n){var o=e;do{var a=o.prev,s=o.next.next;!y(a,s)&&v(a,o,o.next,s)&&w(a,s)&&w(s,a)&&(t.push(a.i/n|0),t.push(o.i/n|0),t.push(s.i/n|0),C(o),C(o.next),o=e=s),o=o.next}while(o!==e);return r(o)}function l(e,t,n,a,s,i){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&f(l,c)){var d=S(l,c);return l=r(l,l.next),d=r(d,d.next),o(l,t,n,a,s,i,0),void o(d,t,n,a,s,i,0)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function d(e,t){var n=function(e,t){var n,r=t,o=e.x,a=e.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var i=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(i<=o&&i>s&&(s=i,n=r.x<r.next.x?r:r.next,i===o))return n}r=r.next}while(r!==t);if(!n)return null;var l,c=n,d=n.x,h=n.y,p=1/0;r=n;do{o>=r.x&&r.x>=d&&o!==r.x&&m(a<h?o:s,a,d,h,a<h?s:o,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(o-r.x),w(r,e)&&(l<p||l===p&&(r.x>n.x||r.x===n.x&&u(n,r)))&&(n=r,p=l)),r=r.next}while(r!==c);return n}(e,t);if(!n)return t;var o=S(n,e);return r(o,o.next),r(n,n.next)}function u(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function h(e,t,n,r,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function m(e,t,n,r,o,a,s,i){return(o-s)*(t-i)>=(e-s)*(a-i)&&(e-s)*(r-i)>=(n-s)*(t-i)&&(n-s)*(a-i)>=(o-s)*(r-i)}function f(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&v(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var n=e,r=!1,o=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&o<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||y(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function v(e,t,n,r){var o=x(g(e,t,n)),a=x(g(e,t,r)),s=x(g(n,r,e)),i=x(g(n,r,t));return o!==a&&s!==i||(!(0!==o||!b(e,n,t))||(!(0!==a||!b(e,r,t))||(!(0!==s||!b(n,e,r))||!(0!==i||!b(n,t,r)))))}function b(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function x(e){return e>0?1:e<0?-1:0}function w(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function S(e,t){var n=new k(e.i,e.x,e.y),r=new k(t.i,t.x,t.y),o=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function T(e,t,n,r){var o=new k(e,t,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function k(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,n,r){for(var o=0,a=t,s=n-r;a<n;a+=r)o+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return o}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var o=t&&t.length,a=o?t[0]*n:e.length,s=Math.abs(A(e,0,a,n));if(o)for(var i=0,l=t.length;i<l;i++){var c=t[i]*n,d=i<l-1?t[i+1]*n:e.length;s-=Math.abs(A(e,c,d,n))}var u=0;for(i=0;i<r.length;i+=3){var h=r[i]*n,p=r[i+1]*n,m=r[i+2]*n;u+=Math.abs((e[h]-e[m])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[m+1]-e[h+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var a=0;a<e[o].length;a++)for(var s=0;s<t;s++)n.vertices.push(e[o][a][s]);o>0&&(r+=e[o-1].length,n.holes.push(r))}return n}},1153:(e,t,n)=>{"use strict";var r=n(5043),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,d=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:d,props:a,_owner:i.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},1251:e=>{"use strict";e.exports=Object},1291:(e,t,n)=>{"use strict";var r=n(757),o=n(7651),a=n(7297);e.exports=r?function(e){return r(e)}:o?function(e){if(!e||"object"!==typeof e&&"function"!==typeof e)throw new TypeError("getProto: not an object");return o(e)}:a?function(e){return a(e)}:null},1431:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c,initializePlayersInGrid:()=>d});var r=n(3488),o=n(8665),a=n(6213),s=n(4517),i=n(8146);const l=new class{constructor(){this.playersInGrid={},this.pendingUpdates={},this.batchInterval=null,this.BATCH_SAVE_INTERVAL=5e3}registerSetPlayersInGrid(e){this.setPlayersInGridReact=e}registerTileSize(e){this.tileSize=e}startBatchSaving(){this.batchInterval||(this.batchInterval=setInterval((()=>{this.processPendingUpdates()}),this.BATCH_SAVE_INTERVAL),console.log("\ud83d\udd04 Started batch saving interval"))}stopBatchSaving(){this.batchInterval&&(clearInterval(this.batchInterval),this.batchInterval=null),this.processPendingUpdates()}async processPendingUpdates(){const e=Object.entries(this.pendingUpdates);if(0===e.length)return;console.log(`\ud83d\udce6 Processing ${e.length} pending PC position updates`);const t={};for(const[r,o]of e)t[o.gridId]||(t[o.gridId]={}),t[o.gridId][o.playerId]=o.pc;this.pendingUpdates={};for(const[o,s]of Object.entries(t))try{const e=await a.A.post(`${r.A}/api/batch-update-pc-positions`,{gridId:o,updates:s,timestamp:Date.now()});e.data.errors&&e.data.errors.length>0&&console.warn(`\u26a0\ufe0f Batch update had ${e.data.errors.length} errors:`,e.data.errors),console.log(`\u2705 Batch updated ${e.data.updated} PC positions for grid ${o}`)}catch(n){console.error(`\u274c Failed to batch save positions for grid ${o}:`,n);for(const[e,t]of Object.entries(s)){const n=`${o}-${e}`;this.pendingUpdates[n]={gridId:o,playerId:e,pc:t,lastUpdated:t.lastUpdated}}}0===Object.keys(this.pendingUpdates).length&&console.log("\u2705 All PC position updates saved successfully")}async forceSavePendingUpdates(){await this.processPendingUpdates()}async flushGridPositionUpdates(e){const t=Object.entries(this.pendingUpdates).filter((t=>{let[n,r]=t;return r.gridId===e}));if(0===t.length)return;console.log(`\ud83d\udcbe Flushing ${t.length} PC position updates for grid ${e}`),t.forEach((e=>{let[t]=e;delete this.pendingUpdates[t]}));const n={};t.forEach((e=>{let[t,r]=e;n[r.playerId]=r.pc}));try{const t=await a.A.post(`${r.A}/api/batch-update-pc-positions`,{gridId:e,updates:n,timestamp:Date.now()});console.log(`\u2705 Flushed ${t.data.updated} PC positions for grid ${e}`)}catch(o){console.error(`\u274c Failed to flush PC positions for grid ${e}:`,o),t.forEach((e=>{let[t,n]=e;this.pendingUpdates[t]=n}))}}async initializePlayersInGrid(e){if(console.log("\ud83e\udde0 Fetching playersInGrid for gridId:",e),e)try{const t=await a.A.get(`${r.A}/api/load-grid-state/${e}`),{playersInGrid:n={pcs:{},lastUpdated:0}}=t.data,s={pcs:n.pcs||{},playersInGridLastUpdated:new Date(n.lastUpdated||0).getTime()},i=s.pcs||{};console.log("Fetched PC NPCsInGrid:",s),Object.keys(i).forEach((e=>{const t=i[e];i[e]={...t,position:t.position||{x:0,y:0}}})),this.playersInGrid[e]=s,this.setPlayersInGridReact((t=>({...t,[e]:{pcs:i,playersInGridLastUpdated:Date.now()}}))),console.log(`\u2705 Initialized playersInGrid for gridId ${e}:`,i),this.startBatchSaving(),this.unloadListenerAdded||(window.addEventListener("beforeunload",(()=>{console.log("\ud83d\udd04 Page unloading, saving pending positions...");const e=Object.entries(this.pendingUpdates);if(e.length>0){const t={};for(const[n,r]of e)t[r.gridId]||(t[r.gridId]={}),t[r.gridId][r.playerId]=r.pc;for(const[e,n]of Object.entries(t)){const t=new XMLHttpRequest;t.open("POST",`${r.A}/api/batch-update-pc-positions`,!1),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({gridId:e,updates:n,timestamp:Date.now()}))}}})),this.unloadListenerAdded=!0),console.log("\ud83d\udd04 Requesting current players from server for grid:",e),o.Ay&&o.Ay.emit&&o.Ay.emit("request-current-grid-players",{gridId:e})}catch(t){console.error("\u274c Error fetching playersInGrid:",t)}else console.error("initializePlayersInGrid: gridId is undefined.")}getPlayersInGrid(e){const t=this.playersInGrid[e];return t?t.pcs:(console.warn(`\u26a0\ufe0f No PC state found for gridId: ${e}`),{})}getAllPCs(e){var t,n;return(null===(t=this.playersInGrid)||void 0===t||null===(n=t[e])||void 0===n?void 0:n.pcs)||{}}getPlayerPosition(e,t){var n,r,o,a;return(null===(n=this.playersInGrid)||void 0===n||null===(r=n[e])||void 0===r||null===(o=r.pcs)||void 0===o||null===(a=o[t])||void 0===a?void 0:a.position)||null}setAllPCs(e,t){this.playersInGrid[e]={pcs:t||{},playersInGridLastUpdated:Date.now()},this.setPlayersInGridReact&&this.setPlayersInGridReact((t=>({...t,[e]:this.playersInGrid[e]})))}async addPlayer(e,t,n){var s,l;this.playersInGrid[e]||(this.playersInGrid[e]={pcs:{},playersInGridLastUpdated:Date.now()});const c=Date.now(),d=await(0,i._M)(),u={},h=(null===(s=n.settings)||void 0===s?void 0:s.equippedWeapon)||null,p=(null===(l=n.settings)||void 0===l?void 0:l.equippedArmor)||null,m=e=>!0===e.passable&&"number"===typeof e.damage&&e.damage>0,f=e=>!0===e.passable&&"number"===typeof e.armorclass&&e.armorclass>0;(n.powers||[]).forEach((e=>{const t=d.find((t=>t.type===e.type));if(t&&"power"===t.category){const n=e.quantity||0;if((e=>!m(e)&&!f(e))(t)||m(t)&&e.type===h||f(t)&&e.type===p){["hp","maxhp","damage","armorclass","attackbonus","attackrange","speed"].forEach((e=>{if("number"===typeof t[e]){const r=n*t[e];u[e]=(u[e]||0)+r}}))}}}));const g=(e,t)=>(n[e]||0)+(u[t]||0);console.log("\ud83d\udea8 [HP DEBUG] addPlayer - Base stat calculation:"),console.log("  pcData.baseHp:",n.baseHp),console.log("  pcData.baseMaxhp:",n.baseMaxhp),console.log("  modifiers.hp:",u.hp),console.log("  modifiers.maxhp:",u.maxhp),console.log('  getStat("baseHp", "hp"):',g("baseHp","hp")),console.log('  getStat("baseMaxhp", "maxhp"):',g("baseMaxhp","maxhp"));const y={playerId:t,username:n.username,type:"pc",icon:n.icon,position:n.position||{x:0,y:0},hp:g("baseHp","hp"),maxhp:g("baseMaxhp","maxhp"),armorclass:g("baseArmorclass","armorclass"),attackbonus:g("baseAttackbonus","attackbonus"),damage:g("baseDamage","damage"),attackrange:g("baseAttackrange","attackrange"),speed:g("baseSpeed","speed"),iscamping:n.iscamping||!1,isinboat:n.isinboat||!1,lastUpdated:c};this.playersInGrid[e].pcs[t]=y;try{await a.A.post(`${r.A}/api/save-single-pc`,{gridId:e,playerId:t,pc:y,lastUpdated:c}),console.log(`\u2705 Added and saved new PC ${t} to server.`)}catch(v){console.error(`\u274c Failed to add PC ${t}:`,v)}o.Ay&&o.Ay.emit&&o.Ay.emit("update-NPCsInGrid-PCs",{gridId:e,pcs:{[t]:y},playersInGridLastUpdated:c})}async addPC(e,t,n){var o,s,i,l,c,d,u;this.playersInGrid[e]||(this.playersInGrid[e]={pcs:{},playersInGridLastUpdated:Date.now()});const h=Date.now();console.log("\ud83d\udea8 [HP DEBUG] addPC - Incoming PC data:"),console.log("  pcData.hp:",n.hp),console.log("  pcData.maxhp:",n.maxhp),console.log("  playerId:",t);const p={playerId:n.playerId,username:n.username,type:"pc",icon:n.icon,position:n.position||{x:0,y:0},hp:null!==(o=n.hp)&&void 0!==o?o:25,maxhp:null!==(s=n.maxhp)&&void 0!==s?s:25,armorclass:null!==(i=n.armorclass)&&void 0!==i?i:10,attackbonus:null!==(l=n.attackbonus)&&void 0!==l?l:0,damage:null!==(c=n.damage)&&void 0!==c?c:1,attackrange:null!==(d=n.attackrange)&&void 0!==d?d:1,speed:null!==(u=n.speed)&&void 0!==u?u:1,iscamping:n.iscamping||!1,isinboat:n.isinboat||!1,lastUpdated:h};this.playersInGrid[e].pcs[t]=p,this.setPlayersInGridReact&&this.setPlayersInGridReact((n=>{var r;return{...n,[e]:{...n[e]||{},pcs:{...(null===(r=n[e])||void 0===r?void 0:r.pcs)||{},[t]:p}}}}));try{console.log("\ud83d\udce4 [DEBUG] Attempting to save PC to database:",{gridId:e,playerId:t,pcData:{...p,hasValidPosition:p.position&&"number"===typeof p.position.x&&"number"===typeof p.position.y,hasValidIcon:p.icon&&"string"===typeof p.icon,hasValidType:"pc"===p.type,hasValidUsername:p.username&&"string"===typeof p.username,hasValidCombatStats:"number"===typeof p.hp&&"number"===typeof p.maxhp}}),await a.A.post(`${r.A}/api/save-single-pc`,{gridId:e,playerId:t,pc:p,lastUpdated:h}),console.log(`\u2705 Added PC ${t} to grid ${e} and database`)}catch(y){var m,f,g;throw console.error(`\u274c Failed to save PC ${t} to database:`,{error:y.message,status:null===(m=y.response)||void 0===m?void 0:m.status,statusText:null===(f=y.response)||void 0===f?void 0:f.statusText,data:null===(g=y.response)||void 0===g?void 0:g.data,pcData:p,gridId:e,playerId:t}),delete this.playersInGrid[e].pcs[t],this.setPlayersInGridReact&&this.setPlayersInGridReact((n=>{var r;const o={...(null===(r=n[e])||void 0===r?void 0:r.pcs)||{}};return delete o[t],{...n,[e]:{...n[e]||{},pcs:o}}})),y}}updatePCLocal(e,t,n){var r,o,a,s,i,l,c;this.playersInGrid[e]||(this.playersInGrid[e]={pcs:{},playersInGridLastUpdated:Date.now()});const d=Date.now(),u={playerId:n.playerId||t,username:n.username,type:"pc",icon:n.icon,position:n.position||{x:0,y:0},hp:null!==(r=n.hp)&&void 0!==r?r:25,maxhp:null!==(o=n.maxhp)&&void 0!==o?o:25,armorclass:null!==(a=n.armorclass)&&void 0!==a?a:10,attackbonus:null!==(s=n.attackbonus)&&void 0!==s?s:0,damage:null!==(i=n.damage)&&void 0!==i?i:1,attackrange:null!==(l=n.attackrange)&&void 0!==l?l:1,speed:null!==(c=n.speed)&&void 0!==c?c:1,iscamping:n.iscamping||!1,isinboat:n.isinboat||!1,lastUpdated:n.lastUpdated||d};return this.playersInGrid[e].pcs[t]=u,this.setPlayersInGridReact&&this.setPlayersInGridReact((n=>{var r;return{...n,[e]:{...n[e]||{},pcs:{...(null===(r=n[e])||void 0===r?void 0:r.pcs)||{},[t]:u}}}})),console.log(`\u2705 Updated PC ${t} locally (no DB call)`),u}async updatePC(e,t,n){var r,a;const i=null===(r=this.playersInGrid[e])||void 0===r?void 0:r.pcs;if(!i||!i[t])return void console.error(`Cannot update PC ${t}. No NPCsInGrid or PC found for gridId: ${e}`);const l=i[t];if(Object.keys(n).filter((e=>"lastUpdated"!==e)).every((e=>{const t=l[e],r=n[e];return JSON.stringify(t)===JSON.stringify(r)})))return;const c=null===(a=i[t])||void 0===a?void 0:a.position,d=Date.now(),u={...i[t],...n,lastUpdated:d},h=u.position;if(this.playersInGrid[e].pcs[t]=u,o.Ay&&o.Ay.emit){const n={[e]:{pcs:{[t]:u},playersInGridLastUpdated:d},emitterId:o.Ay.id};o.Ay.emit("update-NPCsInGrid-PCs",n)}this.tileSize&&c&&h&&(c.x!==h.x||c.y!==h.y)&&(0,s.d)(t,c,h,this.tileSize),this.setPlayersInGridReact&&this.setPlayersInGridReact((n=>{var r;return{...n,[e]:{...n[e]||{},pcs:{...(null===(r=n[e])||void 0===r?void 0:r.pcs)||{},[t]:u}}}}));const p=`${e}-${t}`;this.pendingUpdates[p]={gridId:e,playerId:t,pc:u,lastUpdated:d},this.batchInterval||this.startBatchSaving()}async removePC(e,t){var n,o;const s=`${e}-${t}`;if(this.pendingUpdates[s]&&(console.log(`\ud83e\uddf9 Clearing pending update for ${t} in grid ${e} before removal`),delete this.pendingUpdates[s]),null!==(n=this.playersInGrid[e])&&void 0!==n&&null!==(o=n.pcs)&&void 0!==o&&o[t]){delete this.playersInGrid[e].pcs[t],this.setPlayersInGridReact&&this.setPlayersInGridReact((n=>{var r;const o={...(null===(r=n[e])||void 0===r?void 0:r.pcs)||{}};return delete o[t],{...n,[e]:{...n[e]||{},pcs:o}}}));try{await a.A.post(`${r.A}/api/remove-single-pc`,{gridId:e,playerId:t}),console.log(`\ud83d\uddd1\ufe0f Removed PC ${t} from grid ${e} and database`)}catch(i){console.error(`\u274c Failed to remove PC ${t} from database:`,i),this.playersInGrid[e]||(this.playersInGrid[e]={pcs:{},playersInGridLastUpdated:Date.now()})}}else console.warn(`\u26a0\ufe0f Cannot remove PC ${t}; not found in grid ${e}.`)}},c=l,{initializePlayersInGrid:d}=l},1557:e=>{"use strict";e.exports=Math.min},1593:(e,t,n)=>{"use strict";n.d(t,{t3:()=>w,Ke:()=>x,FD:()=>S,iZ:()=>k,mQ:()=>b,qh:()=>T});var r=n(3488),o=n(6213),a=n(9957),s=n(2667),i=n(1431),l=n(8665),c=n(5823),d=n(819),u=n(9106),h=(n(4450),n(7605)),p=n(6352),m=n(4876);const f=new class{constructor(){this.isLocationChangeInProgress=!1,this.pendingLocationChange=null,this.lastCompletedChange=null}isInProgress(){return this.isLocationChangeInProgress}async requestLocationChange(e){return this.isLocationChangeInProgress?(console.log("\ud83d\udeab Location change blocked - operation already in progress"),this.pendingLocationChange={...e,timestamp:Date.now()},!1):(this.isLocationChangeInProgress=!0,this.pendingLocationChange=null,console.log("\u2705 Location change permission granted"),!0)}completeLocationChange(e){if(this.isLocationChangeInProgress=!1,this.lastCompletedChange={...e,completedAt:Date.now()},console.log("\u2705 Location change completed successfully"),this.pendingLocationChange){const e=this.pendingLocationChange;this.pendingLocationChange=null,console.log("\ud83d\udd04 Processing queued location change after completion"),setTimeout((()=>{e.retryCallback&&e.retryCallback()}),100)}}failLocationChange(e){console.error("\u274c Location change failed:",e),this.isLocationChangeInProgress=!1,this.pendingLocationChange&&(console.log("\ud83d\udeab Discarding pending location change due to failure"),this.pendingLocationChange=null)}getStatus(){return{inProgress:this.isLocationChangeInProgress,hasPending:!!this.pendingLocationChange,lastCompleted:this.lastCompletedChange,pendingChange:this.pendingLocationChange}}clearPending(){this.pendingLocationChange=null,console.log("\ud83e\uddf9 Cleared pending location changes")}reset(){this.isLocationChangeInProgress=!1,this.pendingLocationChange=null,this.lastCompletedChange=null,console.warn("\u26a0\ufe0f LocationChangeManager force reset")}};"undefined"!==typeof window&&(window.locationChangeManager=f,window.debugLocationChanges=()=>(console.log("Location Change Manager Status:",f.getStatus()),f.getStatus()),window.resetLocationChangeManager=()=>{f.reset(),console.log("Location Change Manager reset")});const g=f;var y=n(6388),v=n(9804);const b=async function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{const{x:a,y:s,growEnd:i,craftEnd:c,craftedItem:d,type:u}=t,h={resource:{type:u,x:a,y:s,...void 0!==i&&{growEnd:i},...void 0!==c&&{craftEnd:c},...void 0!==d&&{craftedItem:d}},broadcast:n};if(!(await o.A.patch(`${r.A}/api/update-grid/${e}`,h)).data.success)throw new Error("Failed DB update");return n&&l.Ay&&l.Ay.emit&&l.Ay.emit("update-resource",{gridId:e,updatedResources:[null===(null===t||void 0===t?void 0:t.type)?{x:a,y:s,type:null}:t]}),{success:!0}}catch(a){return console.error("\u274c Error in updateGridResource:",a),{success:!1}}},x=async function(e,t,n,a){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;try{const i=await o.A.patch(`${r.A}/api/update-tile/${e}`,{x:t,y:n,newType:a});i.data.success?(s&&s((e=>{const r=(0,d.El)(e,[{x:t,y:n,type:a}]);return console.log("\ud83c\udf31 Optimistically updated tileTypes (emitter):",r),r})),l.Ay.emit("update-tile",{gridId:e,updatedTiles:[{x:t,y:n,type:a}]})):console.error(`\u274c Failed to update tile at (${t}, ${n}):`,i.data.message)}catch(i){console.error(`\u274c Error converting tile at (${t}, ${n}):`,i)}},w=async function(e,t,n,d,h,f,b,x,w,S,C,k){var A,I,E;let P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,_=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,N=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null,R=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;if(console.log("\ud83d\ude80 [GRID TRANSITION] Starting transactional grid change..."),null!==R&&void 0!==R&&R.startTransition&&R.startTransition(),null!==k&&void 0!==k&&null!==(A=k.isAnyBulkOperationActive)&&void 0!==A&&A.call(k))return C&&C(470),!1;const M=(null===(I=e._id)||void 0===I?void 0:I.toString())||e.playerId,j={from:t,to:n,playerId:M,timestamp:Date.now()};if(!await g.requestLocationChange(j))return console.log("\ud83d\udeab Location change blocked - another change in progress"),C&&C("Location change in progress, please wait..."),!1;console.log("\ud83d\udccb [PHASE 1] PREPARATION - Disabling interaction and showing loading"),S&&S();t.g,c.default.getTiles(),c.default.getResources(),null===(E=i.default.getPlayersInGrid(t.g))||void 0===E||E[M];if(!t||!n)return console.error("\u274c Invalid fromLocation or toLocation"),g.failLocationChange(new Error("Invalid locations")),!1;try{var D,O,B,L,F,$,G,z,U,H,q,V,W,Y,K,X,Z,J,Q,ee,te,ne,re,oe,ae,se,ie,le;console.log("\ud83e\uddf9 [PHASE 2] CLEANUP - Removing from old grid and flushing updates"),C&&C("Leaving ...");const S=null===(D=i.default.getPlayersInGrid(t.g))||void 0===D?void 0:D[M],k=(null===(O=(await o.A.get(`${r.A}/api/load-grid-state/${t.g}`)).data)||void 0===O||null===(B=O.playersInGrid)||void 0===B?void 0:B.pcs)||{},A=S||k[M]||{};console.log("\ud83d\udcbe [CLEANUP] Preserving player state:",A),console.log("\ud83d\udcbe [CLEANUP] Flushing pending position updates..."),await Promise.all([s.Ay.flushGridPositionUpdates(t.g),i.default.flushGridPositionUpdates(t.g)]),console.log("\ud83d\udd50 [CLEANUP] Stopping all timers and intervals for old grid...");try{s.Ay.stopGridTimer(),i.default.stopBatchSaving(),console.log("\u2705 [CLEANUP] Timers stopped successfully")}catch(de){console.warn("\u26a0\ufe0f [CLEANUP] Error stopping timers:",de)}console.log("\ud83d\udeab [CLEANUP] Removing player from old grid..."),await i.default.removePC(t.g,M),l.Ay.emit("player-left-grid",{gridId:t.g,playerId:M,username:e.username}),l.Ay.emit("leave-grid",t.g),console.log("\ud83d\udce6 [PHASE 3] LOAD - Loading new grid data completely"),C&&C("Loading ..."),console.log("\ud83d\udce1 [LOAD] Fetching grid state data...");const I=await o.A.get(`${r.A}/api/load-grid-state/${n.g}`);console.log("\ud83d\udce1 [LOAD] Pre-loading grid data for validation...");const E=await o.A.get(`${r.A}/api/load-grid/${n.g}`),j=(null===(L=E.data)||void 0===L?void 0:L.tiles)||[],fe=(null===(F=E.data)||void 0===F?void 0:F.resources)||[],ge=(null===($=E.data)||void 0===$?void 0:$.region)||null,ye=(null===(G=e.location)||void 0===G?void 0:G.region)||null;console.log(`\ud83d\uddfa\ufe0f [LOAD] Region transition check: from "${ye||"none"}" to "${ge||"none"}"`);null===(z=I.data)||void 0===z||null===(U=z.playersInGrid)||void 0===U||U.pcs;const ve=Date.now();console.log("\ud83d\udc64 [LOAD] Preparing player data with preserved stats..."),console.log("  fromPlayerState.hp:",A.hp),console.log("  fromPlayerState.maxhp:",A.maxhp);const be=null!==(H=null!==(q=A.hp)&&void 0!==q?q:e.hp)&&void 0!==H?H:25,xe=null!==(V=null!==(W=A.maxhp)&&void 0!==W?W:e.maxhp)&&void 0!==V?V:25,we={playerId:M,type:"pc",username:e.username,position:{x:n.x,y:n.y},icon:e.icon||"\ud83d\ude00",hp:be,maxhp:xe,armorclass:null!==(Y=null!==(K=A.armorclass)&&void 0!==K?K:e.armorclass)&&void 0!==Y?Y:10,attackbonus:null!==(X=null!==(Z=A.attackbonus)&&void 0!==Z?Z:e.attackbonus)&&void 0!==X?X:0,damage:null!==(J=null!==(Q=A.damage)&&void 0!==Q?Q:e.damage)&&void 0!==J?J:1,speed:null!==(ee=null!==(te=A.speed)&&void 0!==te?te:e.speed)&&void 0!==ee?ee:1,attackrange:null!==(ne=null!==(re=A.attackrange)&&void 0!==re?re:e.attackrange)&&void 0!==ne?ne:1,iscamping:null!==(oe=null!==(ae=A.iscamping)&&void 0!==ae?ae:e.iscamping)&&void 0!==oe&&oe,isinboat:null!==(se=null!==(ie=A.isinboat)&&void 0!==ie?ie:e.isinboat)&&void 0!==se&&se,lastUpdated:ve};console.log("\u2705 [PHASE 4] VALIDATION - Verifying all data loaded successfully"),C&&C("Validating ...");const Se={tiles:Array.isArray(j)&&j.length>0,resources:Array.isArray(fe),gridState:I.data&&"object"===typeof I.data,playerData:we&&"string"===typeof we.playerId&&"string"===typeof we.username&&we.playerId.length>0&&we.username.length>0};console.log("\ud83d\udd0d [VALIDATION] Data validation results:",Se),console.log("\ud83d\udd0d [VALIDATION] Player data details:",{playerId:we.playerId,username:we.username,type:typeof we.playerId,valid:Se.playerData});if(!Object.values(Se).every((e=>!0===e)))throw new Error(`Validation failed: ${JSON.stringify(Se)}`);console.log("\u2705 [VALIDATION] All data validation checks passed"),console.log("\ud83d\udd04 [PHASE 5] COMMIT - Atomically swapping to new grid state"),C&&C("Entering ..."),l.Ay.connected?(l.Ay.emit("join-grid",{gridId:n.g,playerId:M}),console.log("\ud83d\udce1 Emitted join-grid for grid transition:",n.g)):(console.warn("\u26a0\ufe0f Socket not connected during grid transition, waiting..."),await new Promise((e=>{l.Ay.once("connect",(()=>{l.Ay.emit("join-grid",{gridId:n.g,playerId:M}),console.log("\ud83d\udce1 Emitted join-grid after reconnect:",n.g),e()}))}))),console.log("\ud83d\udce4 [COMMIT] Adding player to new grid database..."),await i.default.addPC(n.g,M,we),console.log("\ud83d\udccd [COMMIT] Updating player location in database...");const Te=await o.A.post(`${r.A}/api/update-player-location`,{playerId:M,location:n});if(!Te.data.success)throw new Error(`Failed to update player location: ${Te.data.error}`);console.log("\ud83e\uddea [COMMIT] HYPOTHESIS TEST: Keeping SVG cache (not clearing)"),console.log("\u26a1 [COMMIT] Atomically committing all state changes..."),f([]),x([]),b([]),c.default.setTiles([]),c.default.setResources([]),await new Promise((e=>setTimeout(e,10))),h(n.g);const Ce={...e,location:Te.data.player.location,...Te.data.player.homesteadGridCoord&&{homesteadGridCoord:Te.data.player.homesteadGridCoord}};d(Ce),localStorage.setItem("player",JSON.stringify(Ce)),console.log("\ud83d\udd04 [COMMIT] Initializing grid with proper tile loading..."),await(0,a.F)(w,n.g,f,x,b,C,Ce),console.log("\u2705 [COMMIT] State successfully committed with proper grid initialization"),console.log("\ud83d\udd0d [POST-INIT] Running grid transition diagnostics...");const ke=c.default.getTiles(),Ae=c.default.getResources();console.log("\ud83d\udd0d [POST-INIT] Tile/Resource State:",{tilesCount:(null===ke||void 0===ke?void 0:ke.length)||0,tilesIsArray:Array.isArray(ke),tilesFirstItem:null===ke||void 0===ke?void 0:ke[0],resourcesCount:(null===Ae||void 0===Ae?void 0:Ae.length)||0,resourcesIsArray:Array.isArray(Ae),resourcesFirstItem:null===Ae||void 0===Ae?void 0:Ae[0],resourcesWithFilename:(null===Ae||void 0===Ae||null===(le=Ae.filter((e=>{const t=null===P||void 0===P?void 0:P.find((t=>t.type===e.type));return null===t||void 0===t?void 0:t.filename})))||void 0===le?void 0:le.length)||0});const Ie=y.A.diagnoseLoadingState();if(console.log("\ud83d\udd0d [POST-INIT] SVG Cache Health:",Ie),(null===Ae||void 0===Ae?void 0:Ae.length)>0&&0===Ie.textures&&(console.warn("\u26a0\ufe0f [POST-INIT] WARNING: Resources exist but SVG texture cache is empty!"),console.warn("\u26a0\ufe0f [POST-INIT] This may cause blank resource rendering.")),P&&(null===Ae||void 0===Ae?void 0:Ae.length)>0){console.log("\ud83d\uddbc\ufe0f [SVG PRELOAD] Preloading SVGs for grid resources..."),C&&C("Loading assets...");const e=await y.A.preloadResourceSVGs(Ae,P,w);e.success?console.log("\u2705 [SVG PRELOAD] All SVGs preloaded successfully"):console.warn("\u26a0\ufe0f [SVG PRELOAD] Some SVGs failed to load:",e.results)}else console.log("\ud83d\uddbc\ufe0f [SVG PRELOAD] Skipping preload - no masterResources or no resources");if(n.gtype&&n.gtype.startsWith("valley")&&_){var ce;if(!(null===(ce=e.trophies)||void 0===ce?void 0:ce.some((e=>"Explore the Valley"===e.name)))){console.log('\ud83c\udfc6 First time visiting valley - awarding "Explore the Valley" trophy');try{const t=await(0,p.p)(M,"Explore the Valley",1,e,N,d);t.success?((0,m.D)("Message",{title:_[7002],message:_[7021]}),console.log("\u2705 Valley trophy awarded and notification shown")):console.warn("\u26a0\ufe0f Failed to award valley trophy:",t.error)}catch(ue){console.error("\u274c Error awarding valley trophy:",ue)}}}_&&ye!==ge&&(ge?(console.log(`\ud83d\uddfa\ufe0f Player entering region: ${ge}`),(0,m.D)("Travel",{title:_[10185]||"Elsinore",message:`${_[10182]||"You are entering "}${ge}.`})):ye&&(console.log(`\ud83d\uddfa\ufe0f Player leaving region: ${ye}`),(0,m.D)("Travel",{title:_[10185]||"Elsinore",message:`${_[10183]||"You are leaving "}${ye}.`}))),console.log("\ud83c\udfc1 [PHASE 6] FINALIZATION - Completing grid transition"),console.log("\ud83d\udc65 [FINALIZATION] Initializing NPCs and PCs...");try{await s.Ay.initializeGridState(n.g),await i.default.initializePlayersInGrid(n.g);const e=s.Ay.getNPCsInGrid(n.g),t=i.default.getPlayersInGrid(n.g);if(t&&t[M])i.default.setPlayersInGridReact({[n.g]:{pcs:t,playersInGridLastUpdated:Date.now()}});else{console.warn("\u26a0\ufe0f [FINALIZATION] Player not found in fresh PC state, forcing re-add..."),await i.default.addPC(n.g,M,we);const e=i.default.getPlayersInGrid(n.g);i.default.setPlayersInGridReact({[n.g]:{pcs:e,playersInGridLastUpdated:Date.now()}}),console.log("\u2705 [FINALIZATION] Player force-added to grid")}s.Ay.setGridStateReact({[n.g]:{npcs:e,NPCsInGridLastUpdated:Date.now()}}),console.log("\u2705 [FINALIZATION] NPCs and PCs initialized successfully")}catch(he){throw console.error("\u274c [FINALIZATION] Error initializing NPCs/PCs:",he),new Error(`Failed to initialize grid entities: ${he.message}`)}let Ee=n.x,Pe=n.y;if(n.findSignpost){console.log(`\ud83d\udd0d [FINALIZATION] Looking for ${n.findSignpost}...`);const t=c.default.getResources().find((e=>e.type===n.findSignpost));if(t){Ee=t.x,Pe=t.y;const a=n.findSignpost,s={"Signpost NE":{x:-1,y:1},"Signpost E":{x:-1,y:0},"Signpost SE":{x:-1,y:-1},"Signpost S":{x:0,y:-1},"Signpost SW":{x:1,y:-1},"Signpost W":{x:1,y:0},"Signpost NW":{x:1,y:1},"Signpost N":{x:0,y:1},"Signpost Home":{x:0,y:1}}[a];s&&(Ee+=s.x,Pe+=s.y,console.log(`\ud83d\udccd [FINALIZATION] Applied offset for ${a}: (${s.x}, ${s.y}) -> final position (${Ee}, ${Pe})`));const c={...we,position:{x:Ee,y:Pe}};i.default.updatePC(n.g,M,c),await o.A.post(`${r.A}/api/save-single-pc`,{gridId:n.g,playerId:M,pc:c,lastUpdated:Date.now()}),l.Ay.emit("player-moved",{gridId:n.g,playerId:M,position:{x:Ee,y:Pe},username:e.username}),console.log(`\u2705 [FINALIZATION] Player positioned at signpost (${Ee}, ${Pe})`)}else console.log(`\u26a0\ufe0f [FINALIZATION] ${n.findSignpost} not found, using default position`)}const _e=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("number"===typeof e.x&&"number"===typeof e.y)try{(0,u.V5)(e,w),console.log(`\ud83d\udcf7 [GRID TRANSITION] Camera centered on (${e.x}, ${e.y})`)}catch(ue){t<3?(console.warn(`\u26a0\ufe0f [GRID TRANSITION] Camera centering failed, retrying in 100ms (attempt ${t+1}/3):`,ue),setTimeout((()=>_e(e,t+1)),100)):console.error("\u274c [GRID TRANSITION] Camera centering failed after 3 attempts:",ue)}else console.warn("\u26a0\ufe0f [GRID TRANSITION] Cannot center camera - invalid coordinates:",e)};if("number"===typeof Ee&&"number"===typeof Pe?await _e({x:Ee,y:Pe}):console.warn("\u26a0\ufe0f [GRID TRANSITION] Cannot center camera - invalid final coordinates:",{finalX:Ee,finalY:Pe}),e.hp<=0){console.log("\u26b0\ufe0f [FINALIZATION] Verifying dead player cleanup...");try{await o.A.post(`${r.A}/api/remove-single-pc`,{gridId:t.g,playerId:M}),console.log("\u2705 [FINALIZATION] Dead player cleanup verified")}catch(pe){console.warn("\u26a0\ufe0f [FINALIZATION] Cleanup verification failed:",pe)}}if(l.Ay.emit("set-username",{username:e.username}),l.Ay.emit("request-npc-controller",{gridId:n.g}),console.log("\ud83d\udea8 [GRID MGMT DEBUG] Emitting player-joined-grid with data:",{gridId:n.g,playerId:M,username:e.username,playerDataKeys:we?Object.keys(we):"undefined",playerDataHP:null===we||void 0===we?void 0:we.hp,playerDataMaxHP:null===we||void 0===we?void 0:we.maxhp,playerDataArmorClass:null===we||void 0===we?void 0:we.armorclass,playerDataAttackBonus:null===we||void 0===we?void 0:we.attackbonus,fullPlayerData:we}),l.Ay.emit("player-joined-grid",{gridId:n.g,playerId:M,username:e.username,playerData:we}),C&&n.gtype&&await T(n.gtype,null,C,e,n.g),console.log("\ud83c\udf89 [GRID TRANSITION] Transactional grid change completed successfully"),null!==R&&void 0!==R&&R.endTransition&&R.endTransition(),g.completeLocationChange({from:t,to:n,playerId:M,success:!0}),console.log(`\ud83d\udccd [GRIDS_VISITED] Checking visit tracking - gridCoord: ${n.gridCoord}, type: ${typeof n.gridCoord}`),"number"===typeof n.gridCoord&&n.gridCoord>=0){const t=(0,v.isGridVisited)(e.gridsVisited,n.gridCoord);if(console.log(`\ud83d\udccd [GRIDS_VISITED] Grid ${n.gridCoord} alreadyVisited: ${t}, hasGridsVisited: ${!!e.gridsVisited}`),t)console.log(`\ud83d\udccd [GRIDS_VISITED] Grid ${n.gridCoord} was already visited, skipping API call`);else{console.log(`\ud83d\udccd [GRIDS_VISITED] Making API call to mark grid ${n.gridCoord} as visited for player ${M}`);try{const e=await o.A.post(`${r.A}/api/mark-grid-visited`,{playerId:M,gridCoord:n.gridCoord});if(console.log("\ud83d\udccd [GRIDS_VISITED] API response:",e.data),e.data.success&&e.data.gridsVisited){const t={...Ce,gridsVisited:e.data.gridsVisited};d(t),localStorage.setItem("player",JSON.stringify(t)),console.log(`\ud83d\udccd [GRIDS_VISITED] \u2705 Marked grid ${n.gridCoord} as visited`)}}catch(me){console.warn("\ud83d\udccd [GRIDS_VISITED] \u26a0\ufe0f Failed to mark grid as visited:",me)}}}else console.log("\ud83d\udccd [GRIDS_VISITED] Skipping visit tracking - gridCoord invalid");return!0}catch(ue){throw console.error("\u274c Location change error:",ue),null!==R&&void 0!==R&&R.endTransition&&R.endTransition(),g.failLocationChange(ue),ue}};async function S(e,t,n){try{const t=(await o.A.get(`${r.A}/api/load-grid/${e}`)).data||{},{gridType:n,_id:a,ownerId:s,playersInGrid:i,NPCsInGrid:l}=t;console.log("Fetched grid data:",t);const c={pcs:(null===i||void 0===i?void 0:i.pcs)||{},npcs:(null===l||void 0===l?void 0:l.npcs)||{}};return{...t,NPCsInGrid:c}}catch(a){return console.error("Error fetching grid data:",a),t&&t("Failed to load grid data"),{}}}async function T(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(n)switch(console.log("\ud83d\ude00\ud83d\ude00 UPDATING GRID STATUS message"),e){case"homestead":if(r&&o){const{username:e}=await(0,h.qJ)(o);if(e===r.username)return void n(112);t=e}n(`Welcome to ${t||"Unknown"}'s homestead.`);break;case"town":n(14);break;case"valley0":case"valley1":case"valley2":case"valley3":n(16);break;case"settlement":n(12);break;case"frontier":n(13)}}function C(e,t,n){const r=n.size||1;return e>=n.x&&e<n.x+r&&t>=n.y&&t<n.y+r}function k(e,t){const n=c.default.getResources(),r=function(e,t){const n=[];let r=Math.floor(e.x),o=Math.floor(e.y);const a=Math.floor(t.x),s=Math.floor(t.y),i=Math.abs(a-r),l=Math.abs(s-o),c=r<a?1:-1,d=o<s?1:-1;let u=i-l,h=r,p=o;for(;r===Math.floor(e.x)&&o===Math.floor(e.y)||r===a&&o===s||(n.push({x:r,y:o}),h!==r&&p!==o&&(n.push({x:h,y:o}),n.push({x:r,y:p}))),r!==a||o!==s;){h=r,p=o;const e=2*u;e>-l&&(u-=l,r+=c),e<i&&(u+=i,o+=d)}return n}(e,t);for(const o of r){if(n.find((e=>("wall"===e.action||"door"===e.action)&&C(o.x,o.y,e))))return!0}return!1}},1725:e=>{"use strict";e.exports=RangeError},1907:function(e,t,n){var r;e=n.nmd(e),function(){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof n.g&&n.g;o.global!==o&&o.window!==o&&o.self;var a,s=2147483647,i=36,l=/^xn--/,c=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},h=Math.floor,p=String.fromCharCode;function m(e){throw new RangeError(u[e])}function f(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function g(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+f((e=e.replace(d,".")).split("."),t).join(".")}function y(e){for(var t,n,r=[],o=0,a=e.length;o<a;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<a?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function v(e){return f(e,(function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=p(e)})).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function x(e,t,n){var r=0;for(e=n?h(e/700):e>>1,e+=h(e/t);e>455;r+=i)e=h(e/35);return h(r+36*e/(e+38))}function w(e){var t,n,r,o,a,l,c,d,u,p,f,g=[],y=e.length,b=0,w=128,S=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&m("not-basic"),g.push(e.charCodeAt(r));for(o=n>0?n+1:0;o<y;){for(a=b,l=1,c=i;o>=y&&m("invalid-input"),((d=(f=e.charCodeAt(o++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:i)>=i||d>h((s-b)/l))&&m("overflow"),b+=d*l,!(d<(u=c<=S?1:c>=S+26?26:c-S));c+=i)l>h(s/(p=i-u))&&m("overflow"),l*=p;S=x(b-a,t=g.length+1,0==a),h(b/t)>s-w&&m("overflow"),w+=h(b/t),b%=t,g.splice(b++,0,w)}return v(g)}function S(e){var t,n,r,o,a,l,c,d,u,f,g,v,w,S,T,C=[];for(v=(e=y(e)).length,t=128,n=0,a=72,l=0;l<v;++l)(g=e[l])<128&&C.push(p(g));for(r=o=C.length,o&&C.push("-");r<v;){for(c=s,l=0;l<v;++l)(g=e[l])>=t&&g<c&&(c=g);for(c-t>h((s-n)/(w=r+1))&&m("overflow"),n+=(c-t)*w,t=c,l=0;l<v;++l)if((g=e[l])<t&&++n>s&&m("overflow"),g==t){for(d=n,u=i;!(d<(f=u<=a?1:u>=a+26?26:u-a));u+=i)T=d-f,S=i-f,C.push(p(b(f+T%S,0))),d=h(T/S);C.push(p(b(d,0))),a=x(n,w,r==o),n=0,++r}++n,++t}return C.join("")}a={version:"1.4.1",ucs2:{decode:y,encode:v},decode:w,encode:S,toASCII:function(e){return g(e,(function(e){return c.test(e)?"xn--"+S(e):e}))},toUnicode:function(e){return g(e,(function(e){return l.test(e)?w(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return a}.call(t,n,t,e))||(e.exports=r)}()},1911:e=>{"use strict";e.exports=Math.floor},2090:e=>{"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(n){t=!1}e.exports=t},2108:(e,t,n)=>{"use strict";var r="undefined"!==typeof Symbol&&Symbol,o=n(9534);e.exports=function(){return"function"===typeof r&&("function"===typeof Symbol&&("symbol"===typeof r("foo")&&("symbol"===typeof Symbol("bar")&&o())))}},2129:(e,t,n)=>{"use strict";var r=n(9269),o=n(149),a=n(9108),s=Object.prototype.hasOwnProperty,i={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,d=function(e,t){c.apply(e,l(t)?t:[t])},u=Date.prototype.toISOString,h=a.default,p={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:o.encode,encodeValuesOnly:!1,format:h,formatter:a.formatters[h],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},m={},f=function e(t,n,a,s,i,c,u,h,f,g,y,v,b,x,w,S,T,C){for(var k,A=t,I=C,E=0,P=!1;void 0!==(I=I.get(m))&&!P;){var _=I.get(t);if(E+=1,"undefined"!==typeof _){if(_===E)throw new RangeError("Cyclic object value");P=!0}"undefined"===typeof I.get(m)&&(E=0)}if("function"===typeof g?A=g(n,A):A instanceof Date?A=b(A):"comma"===a&&l(A)&&(A=o.maybeMap(A,(function(e){return e instanceof Date?b(e):e}))),null===A){if(c)return f&&!S?f(n,p.encoder,T,"key",x):n;A=""}if("string"===typeof(k=A)||"number"===typeof k||"boolean"===typeof k||"symbol"===typeof k||"bigint"===typeof k||o.isBuffer(A))return f?[w(S?n:f(n,p.encoder,T,"key",x))+"="+w(f(A,p.encoder,T,"value",x))]:[w(n)+"="+w(String(A))];var N,R=[];if("undefined"===typeof A)return R;if("comma"===a&&l(A))S&&f&&(A=o.maybeMap(A,f)),N=[{value:A.length>0?A.join(",")||null:void 0}];else if(l(g))N=g;else{var M=Object.keys(A);N=y?M.sort(y):M}var j=h?n.replace(/\./g,"%2E"):n,D=s&&l(A)&&1===A.length?j+"[]":j;if(i&&l(A)&&0===A.length)return D+"[]";for(var O=0;O<N.length;++O){var B=N[O],L="object"===typeof B&&"undefined"!==typeof B.value?B.value:A[B];if(!u||null!==L){var F=v&&h?B.replace(/\./g,"%2E"):B,$=l(A)?"function"===typeof a?a(D,F):D:D+(v?"."+F:"["+F+"]");C.set(t,E);var G=r();G.set(m,C),d(R,e(L,$,a,s,i,c,u,h,"comma"===a&&S&&l(A)?null:f,g,y,v,b,x,w,S,T,G))}}return R};e.exports=function(e,t){var n,o=e,c=function(e){if(!e)return p;if("undefined"!==typeof e.allowEmptyArrays&&"boolean"!==typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!==typeof e.encodeDotInKeys&&"boolean"!==typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&"undefined"!==typeof e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=a.default;if("undefined"!==typeof e.format){if(!s.call(a.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r,o=a.formatters[n],c=p.filter;if(("function"===typeof e.filter||l(e.filter))&&(c=e.filter),r=e.arrayFormat in i?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":p.arrayFormat,"commaRoundTrip"in e&&"boolean"!==typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var d="undefined"===typeof e.allowDots?!0===e.encodeDotInKeys||p.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:d,allowEmptyArrays:"boolean"===typeof e.allowEmptyArrays?!!e.allowEmptyArrays:p.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:"undefined"===typeof e.delimiter?p.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:p.encode,encodeDotInKeys:"boolean"===typeof e.encodeDotInKeys?e.encodeDotInKeys:p.encodeDotInKeys,encoder:"function"===typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:c,format:n,formatter:o,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"===typeof c.filter?o=(0,c.filter)("",o):l(c.filter)&&(n=c.filter);var u=[];if("object"!==typeof o||null===o)return"";var h=i[c.arrayFormat],m="comma"===h&&c.commaRoundTrip;n||(n=Object.keys(o)),c.sort&&n.sort(c.sort);for(var g=r(),y=0;y<n.length;++y){var v=n[y];c.skipNulls&&null===o[v]||d(u,f(o[v],v,h,m,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,g))}var b=u.join(c.delimiter),x=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?x+="utf8=%26%2310003%3B&":x+="utf8=%E2%9C%93&"),b.length>0?x+b:""}},2467:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(7544);let o=null;const a=e=>(o||(o=(()=>{const e={};return Object.entries(r).forEach((t=>{let[n,r]=t;e[r]=n})),e})()),o[e]||null),s=(e,t)=>{if(!t)return console.warn("getLocalizedString: strings object is undefined, returning original value"),e;const n=a(e);return n&&t[n]?t[n]:e}},2557:e=>{"use strict";e.exports=SyntaxError},2634:()=>{},2667:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>w});var r=n(3488),o=n(8665),a=n(6213),s=n(8014),i=n(8146);let l=null,c=null;const d=new class{constructor(){this.NPCsInGrid={},this.pendingPositionUpdates=new Map,this.batchSaveInterval=null,this.BATCH_SAVE_DELAY=1e4,console.log("GridStateManager instance created."),this.startBatchSaveTimer()}startBatchSaveTimer(){this.batchSaveInterval||(this.batchSaveInterval=setInterval((()=>{this.flushPendingPositionUpdates()}),this.BATCH_SAVE_DELAY),console.log("\u2705 Batch save timer started (10s interval)"))}stopBatchSaveTimer(){this.batchSaveInterval&&(clearInterval(this.batchSaveInterval),this.batchSaveInterval=null,console.log("\u274c Batch save timer stopped"))}queuePositionUpdate(e,t,n){this.pendingPositionUpdates.has(e)||this.pendingPositionUpdates.set(e,new Map);this.pendingPositionUpdates.get(e).set(t,{position:{x:n.x,y:n.y},timestamp:Date.now()})}async flushPendingPositionUpdates(){if(0!==this.pendingPositionUpdates.size){console.log(`\ud83d\udcbe Flushing batch position updates for ${this.pendingPositionUpdates.size} grids`);for(const[t,n]of this.pendingPositionUpdates)if(0!==n.size)try{const e={};for(const[t,r]of n)e[t]=r.position;await a.A.post(`${r.A}/api/batch-update-npc-positions`,{gridId:t,updates:e,timestamp:Date.now()}),console.log(`\u2705 Batch saved ${n.size} NPC positions for grid ${t}`),n.clear()}catch(e){console.error(`\u274c Failed to batch save positions for grid ${t}:`,e)}for(const[e,t]of this.pendingPositionUpdates)0===t.size&&this.pendingPositionUpdates.delete(e)}}async flushGridPositionUpdates(e){const t=this.pendingPositionUpdates.get(e);if(t&&0!==t.size)try{const n={};for(const[e,r]of t)n[e]=r.position;await a.A.post(`${r.A}/api/batch-update-npc-positions`,{gridId:e,updates:n,timestamp:Date.now()}),console.log(`\u2705 Force batch saved ${t.size} NPC positions for grid ${e}`),t.clear(),this.pendingPositionUpdates.delete(e)}catch(n){console.error(`\u274c Failed to force batch save positions for grid ${e}:`,n)}}async updateNPCPosition(e,t,n){var r;const a=this.NPCsInGrid[e];if(!a||null===(r=a.npcs)||void 0===r||!r[t])return void console.error(`Cannot update position for NPC ${t}. Not found in grid ${e}`);const s=a.npcs[t],i=Date.now();if(s.position={x:n.x,y:n.y},s.lastUpdated=i,this.queuePositionUpdate(e,t,n),o.Ay&&o.Ay.emit){const r={[e]:{npcs:{[t]:{...s,position:n}},NPCsInGridLastUpdated:i},emitterId:o.Ay.id};o.Ay.emit("update-NPCsInGrid-NPCs",r)}a.NPCsInGridLastUpdated=i,this.setGridStateReact&&this.setGridStateReact((t=>({...t,[e]:{...t[e]||{},...a,NPCsInGridLastUpdated:i}})))}registerSetGridState(e){c=e}async initializeGridState(e){if(console.log("\ud83d\udc4d Initialize NPCsInGrid for gridId:",e),e)try{const t=await a.A.get(`${r.A}/api/load-grid-state/${e}`),{NPCsInGrid:n={npcs:{},lastUpdated:0}}=t.data,o={npcs:n.npcs||{},NPCsInGridLastUpdated:new Date(n.lastUpdated||0).getTime()},l=o.npcs||{};console.log("Fetched NPCsInGrid:",o);const c=await(0,i._M)();l&&Object.keys(l).forEach((t=>{const r=l[t],o=c.find((e=>e.type===r.type));o||(console.warn(`\u26a0\ufe0f Missing template for NPC type: ${r.type}`),console.log("Master resources:",c.map((e=>e.type))));const a=new s.A(t,r.type,r.position,{...o,...r},e);console.log("  \u2705 Hydrated NPC instance:",a),n.npcs[t]=a})),this.NPCsInGrid[e]=n,this.setGridStateReact&&(console.log("\ud83d\udce1 Syncing initialized NPCs to React state for gridId:",e),this.setGridStateReact((t=>({...t,[e]:{...t[e]||{},...n}})))),console.log(`\u2705 Initialized and enriched NPCsInGrid for gridId ${e}:`,n)}catch(t){console.error("Error fetching NPCsInGrid:",t)}else console.error("initializeGridState: gridId is undefined.")}getNPCsInGrid(e){const t=this.NPCsInGrid[e];return t?t.npcs:(console.warn(`\u26a0\ufe0f No NPCsInGrid found for gridId: ${e}`),{npcs:{}})}async spawnNPC(e,t,n){var o;if(console.log("spawnNPC called with:",{gridId:e,npcType:t,position:n}),"object"===typeof t&&null!==(o=t)&&void 0!==o&&o.type&&(t=t.type),"string"!==typeof t)return void console.error("Invalid npcType. Expected a string but got:",t);const i=(await a.A.get(`${r.A}/api/resources`)).data.find((e=>e.type===t&&"npc"===e.category));if(!i)return void console.error(`NPC template not found for type: ${t}`);const l=`${Date.now()}`;let c;c="graze"===i.action?{id:l,type:t,action:i.action,state:"idle",position:n,hp:0,maxhp:i.maxhp,lastUpdated:Date.now()}:"spawn"===i.action?{id:l,type:t,action:i.action,state:"hungry",position:n,hp:i.maxhp,maxhp:i.maxhp,lastUpdated:Date.now(),nextspawn:Date.now()+1e3*i.speed}:{id:l,type:t,action:i.action,state:"idle",position:n,hp:i.maxhp,maxhp:i.maxhp,lastUpdated:Date.now()},console.log("Creating lightweightNPC:",c);const d=new s.A(l,t,n,{...i,...c},e);this.addNPC(e,d),console.log(`Successfully added NPC to NPCsInGrid. NPC ID: ${l}`);const u=this.getNPCsInGrid(e);this.setAllNPCs(e,u)}async addNPC(e,t){console.log(`Adding NPC to NPCsInGrid for gridId: ${e}. NPC:`,t);let n=this.NPCsInGrid[e];n||(console.warn(`\u26a0\ufe0f No NPCsInGrid found for gridId: ${e}. Initializing new entry.`),n={npcs:{},NPCsInGridLastUpdated:Date.now()},this.NPCsInGrid[e]=n),n.npcs||(n.npcs={});const s=Date.now();t.lastUpdated=s,n.npcs[t.id]=t;try{await a.A.post(`${r.A}/api/save-single-npc`,{gridId:e,npcId:t.id,npc:t,lastUpdated:s}),console.log(`\u2705 Saved single NPC ${t.id} to server.`)}catch(i){console.error(`\u274c Failed to save single NPC ${t.id}:`,i)}if(o.Ay&&o.Ay.emit){const n={[e]:{npcs:{[t.id]:t},NPCsInGridLastUpdated:s},emitterId:o.Ay.id};console.log("\ud83d\udce1 Emitting update-NPCsInGrid-NPCs with payload:",JSON.stringify(n,null,2)),o.Ay.emit("update-NPCsInGrid-NPCs",n)}}async updateNPC(e,t,n){var i,l;const c=this.NPCsInGrid[e],d=null===c||void 0===c||null===(i=c.npcs)||void 0===i?void 0:i[t];if(!c||null===(l=c.npcs)||void 0===l||!l[t])return void console.error(`Cannot update NPC ${t}. No NPCsInGrid or NPC found for gridId: ${e}`);if(!(d instanceof s.A))return void console.error(`\ud83d\uded1 Skipping updateNPC for ${t} \u2014 not an instance of NPC:`,d);const u=Date.now(),h=c.npcs[t];Object.assign(h,n),h.lastUpdated=u;try{const n={id:h.id,type:h.type,position:h.position,state:h.state,hp:h.hp,maxhp:h.maxhp,grazeEnd:h.grazeEnd,lastUpdated:h.lastUpdated,action:h.action,gridId:h.gridId};"spawn"===h.action&&(n.requires=h.requires,n.qtycollected=h.qtycollected,n.range=h.range,n.nextspawn=h.nextspawn),await a.A.post(`${r.A}/api/save-single-npc`,{gridId:e,npcId:t,npc:n,lastUpdated:u})}catch(p){console.error(`\u274c Failed to save single NPC ${t}:`,p)}if(o.Ay&&o.Ay.emit){const n={[e]:{npcs:{[t]:h},NPCsInGridLastUpdated:u},emitterId:o.Ay.id};o.Ay.emit("update-NPCsInGrid-NPCs",n)}c.NPCsInGridLastUpdated=u,this.setGridStateReact&&this.setGridStateReact((t=>({...t,[e]:{...t[e]||{},...c,NPCsInGridLastUpdated:u}})))}async removeNPC(e,t){console.log(`Removing NPC ${t} from gridId: ${e}`);const n=this.NPCsInGrid[e];if(!n||!n.npcs)return void console.error(`Cannot remove NPC. No NPCsInGrid or NPCs found for gridId: ${e}`);const s=this.pendingPositionUpdates.get(e);s&&(s.delete(t),console.log(`\ud83e\uddf9 Cleared pending position update for removed NPC ${t}`)),delete n.npcs[t],this.setAllNPCs(e,n.npcs);try{await a.A.post(`${r.A}/api/remove-single-npc`,{gridId:e,npcId:t}),console.log(`\u2705 Removed single NPC ${t} from server.`)}catch(i){console.error(`\u274c Failed to remove single NPC ${t}:`,i)}o.Ay&&o.Ay.emit&&(o.Ay.emit("remove-NPC",{gridId:e,npcId:t,emitterId:o.Ay.id}),console.log(`\ud83d\udce1 Emitted NPC removal for ${t}`))}async saveGridStateNPCs(e){try{const t=this.NPCsInGrid[e];if(!t||!t.npcs)return void console.warn(`\u26a0\ufe0f No NPCs to save for grid ${e}`);const n=Date.now();t.NPCsInGridLastUpdated=n;const s={};Object.entries(t.npcs).forEach((e=>{let[t,n]=e;s[t]={id:n.id,type:n.type,position:n.position,state:n.state,hp:n.hp,maxhp:n.maxhp,grazeEnd:n.grazeEnd,lastUpdated:n.lastUpdated}}));const i={gridId:e,npcs:s,NPCsInGridLastUpdated:n};await a.A.post(`${r.A}/api/save-grid-state-npcs`,i),o.Ay&&o.Ay.emit&&(console.log(`\ud83d\udce1 Emitting NPC grid-state for grid ${e}`),o.Ay.emit("update-NPCsInGrid-NPCs",{gridId:e,npcs:s,NPCsInGridLastUpdated:n}))}catch(t){console.error(`\u274c Error saving NPCs for grid ${e}:`,t)}}startGridTimer(e){l&&clearInterval(l),l=setInterval((()=>{const t=this.NPCsInGrid[e];if(!t)return;const{npcs:n}=t,r=Date.now();Object.values(n||{}).forEach((e=>{e instanceof s.A&&"function"===typeof e.update?e.update(r,t):console.error(`NPC ID: ${e.id} is not a valid NPC instance or missing update method. NPC:`,e)})),console.log(`Processed NPC updates for gridId ${e}.`)}),1e3)}stopGridTimer(){l&&clearInterval(l),l=null}stopGridStateUpdates(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.flushPendingPositionUpdates(),this.stopBatchSaveTimer(),this.NPCsInGrid={},this.pendingPositionUpdates.clear()}registerSetGridState(e){this.setGridStateReact=e}setAllNPCs(e,t){const n=this.NPCsInGrid[e]||{},r=n.NPCsInGridLastUpdated||Date.now();this.NPCsInGrid[e]={...n,npcs:t||{},NPCsInGridLastUpdated:r},this.setGridStateReact&&this.setGridStateReact((n=>({...n,[e]:{...n[e]||{},npcs:t||{},NPCsInGridLastUpdated:Date.now()}})))}},{initializeGridState:u,getNPCsInGrid:h,addNPC:p,updateNPC:m,updateNPCPosition:f,removeNPC:g,registerSetGridState:y,setAllNPCs:v,flushPendingPositionUpdates:b,flushGridPositionUpdates:x}=d,w=d},2730:(e,t,n)=>{"use strict";var r=n(5043),o=n(8853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,i={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(i[e]=t,e=0;e<t.length;e++)s.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,r,o,a,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new f(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new f(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new f(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new f(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new f(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,r){var o=g.hasOwnProperty(t)?g[t]:null;(null!==o?0!==o.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),I=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var j=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=j&&e[j]||e["@@iterator"])?e:null}var O,B=Object.assign;function L(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var F=!1;function $(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var o=c.stack.split("\n"),a=r.stack.split("\n"),s=o.length-1,i=a.length-1;1<=s&&0<=i&&o[s]!==a[i];)i--;for(;1<=s&&0<=i;s--,i--)if(o[s]!==a[i]){if(1!==s||1!==i)do{if(s--,0>--i||o[s]!==a[i]){var l="\n"+o[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=i);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?L(e):""}function G(e){switch(e.tag){case 5:return L(e.type);case 16:return L("Lazy");case 13:return L("Suspense");case 19:return L("SuspenseList");case 0:case 2:case 15:return e=$(e.type,!1);case 11:return e=$(e.type.render,!1);case 1:return e=$(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case S:return"Portal";case k:return"Profiler";case C:return"StrictMode";case P:return"Suspense";case _:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:z(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return z(e(t))}catch(n){}}return null}function U(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function V(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function W(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function K(e,t){var n=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Z(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ae(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ie(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ie(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return de(e,t)}))}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=fe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(pe).forEach((function(e){me.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ye=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Te=null,Ce=null;function ke(e){if(e=xo(e)){if("function"!==typeof Se)throw Error(a(280));var t=e.stateNode;t&&(t=So(t),Se(e.stateNode,e.type,t))}}function Ae(e){Te?Ce?Ce.push(e):Ce=[e]:Te=e}function Ie(){if(Te){var e=Te,t=Ce;if(Ce=Te=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Ee(e,t){return e(t)}function Pe(){}var _e=!1;function Ne(e,t,n){if(_e)return e(t,n);_e=!0;try{return Ee(e,t,n)}finally{_e=!1,(null!==Te||null!==Ce)&&(Pe(),Ie())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var r=So(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Me=!1;if(d)try{var je={};Object.defineProperty(je,"passive",{get:function(){Me=!0}}),window.addEventListener("test",je,je),window.removeEventListener("test",je,je)}catch(de){Me=!1}function De(e,t,n,r,o,a,s,i,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var Oe=!1,Be=null,Le=!1,Fe=null,$e={onError:function(e){Oe=!0,Be=e}};function Ge(e,t,n,r,o,a,s,i,l){Oe=!1,Be=null,De.apply($e,arguments)}function ze(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ue(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(ze(e)!==e)throw Error(a(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=ze(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var s=o.alternate;if(null===s){if(null!==(r=o.return)){n=r;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===n)return He(o),e;if(s===r)return He(o),t;s=s.sibling}throw Error(a(188))}if(n.return!==r.return)n=o,r=s;else{for(var i=!1,l=o.child;l;){if(l===n){i=!0,n=o,r=s;break}if(l===r){i=!0,r=o,n=s;break}l=l.sibling}if(!i){for(l=s.child;l;){if(l===n){i=!0,n=s,r=o;break}if(l===r){i=!0,r=s,n=o;break}l=l.sibling}if(!i)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Ve(e):null}function Ve(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ve(e);if(null!==t)return t;e=e.sibling}return null}var We=o.unstable_scheduleCallback,Ye=o.unstable_cancelCallback,Ke=o.unstable_shouldYield,Xe=o.unstable_requestPaint,Ze=o.unstable_now,Je=o.unstable_getCurrentPriorityLevel,Qe=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,at=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(it(e)/lt|0)|0},it=Math.log,lt=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes,s=268435455&n;if(0!==s){var i=s&~o;0!==i?r=ut(i):0!==(a&=s)&&(r=ut(a))}else 0!==(s=n&~o)?r=ut(s):0!==a&&(r=ut(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(a=t&-t)||16===o&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-st(t)),r|=e[n],t&=~o;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,St,Tt,Ct,kt,At=!1,It=[],Et=null,Pt=null,_t=null,Nt=new Map,Rt=new Map,Mt=[],jt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":_t=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Ot(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=xo(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Bt(e){var t=bo(e.target);if(null!==t){var n=ze(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ue(n)))return e.blockedOn=t,void kt(e.priority,(function(){Tt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Lt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xo(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Ft(e,t,n){Lt(e)&&n.delete(t)}function $t(){At=!1,null!==Et&&Lt(Et)&&(Et=null),null!==Pt&&Lt(Pt)&&(Pt=null),null!==_t&&Lt(_t)&&(_t=null),Nt.forEach(Ft),Rt.forEach(Ft)}function Gt(e,t){e.blockedOn===t&&(e.blockedOn=null,At||(At=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,$t)))}function zt(e){function t(t){return Gt(t,e)}if(0<It.length){Gt(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Et&&Gt(Et,e),null!==Pt&&Gt(Pt,e),null!==_t&&Gt(_t,e),Nt.forEach(t),Rt.forEach(t),n=0;n<Mt.length;n++)(r=Mt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Mt.length&&null===(n=Mt[0]).blockedOn;)Bt(n),null===n.blockedOn&&Mt.shift()}var Ut=x.ReactCurrentBatchConfig,Ht=!0;function qt(e,t,n,r){var o=bt,a=Ut.transition;Ut.transition=null;try{bt=1,Wt(e,t,n,r)}finally{bt=o,Ut.transition=a}}function Vt(e,t,n,r){var o=bt,a=Ut.transition;Ut.transition=null;try{bt=4,Wt(e,t,n,r)}finally{bt=o,Ut.transition=a}}function Wt(e,t,n,r){if(Ht){var o=Kt(e,t,n,r);if(null===o)Hr(e,t,r,Yt,n),Dt(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return Et=Ot(Et,e,t,n,r,o),!0;case"dragenter":return Pt=Ot(Pt,e,t,n,r,o),!0;case"mouseover":return _t=Ot(_t,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return Nt.set(a,Ot(Nt.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,Rt.set(a,Ot(Rt.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Dt(e,r),4&t&&-1<jt.indexOf(e)){for(;null!==o;){var a=xo(o);if(null!==a&&wt(a),null===(a=Kt(e,t,n,r))&&Hr(e,t,r,Yt,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Yt=null;function Kt(e,t,n,r){if(Yt=null,null!==(e=bo(e=we(r))))if(null===(t=ze(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ue(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Qe:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Zt=null,Jt=null,Qt=null;function en(){if(Qt)return Qt;var e,t,n=Jt,r=n.length,o="value"in Zt?Zt.value:Zt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===o[a-t];t++);return Qt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,o,a){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(o):o[s]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=on(cn),un=B({},cn,{view:0,detail:0}),hn=on(un),pn=B({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),mn=on(pn),fn=on(B({},pn,{dataTransfer:0})),gn=on(B({},un,{relatedTarget:0})),yn=on(B({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=B({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(vn),xn=on(B({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function kn(){return Cn}var An=B({},un,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=on(An),En=on(B({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=on(B({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),_n=on(B({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=B({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=on(Nn),Mn=[9,13,27,32],jn=d&&"CompositionEvent"in window,Dn=null;d&&"documentMode"in document&&(Dn=document.documentMode);var On=d&&"TextEvent"in window&&!Dn,Bn=d&&(!jn||Dn&&8<Dn&&11>=Dn),Ln=String.fromCharCode(32),Fn=!1;function $n(e,t){switch(e){case"keyup":return-1!==Mn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var zn=!1;var Un={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Un[e.type]:"textarea"===t}function qn(e,t,n,r){Ae(r),0<(t=Vr(t,"onChange")).length&&(n=new dn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Vn=null,Wn=null;function Yn(e){Lr(e,0)}function Kn(e){if(W(wo(e)))return e}function Xn(e,t){if("change"===e)return t}var Zn=!1;if(d){var Jn;if(d){var Qn="oninput"in document;if(!Qn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Qn="function"===typeof er.oninput}Jn=Qn}else Jn=!1;Zn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Vn&&(Vn.detachEvent("onpropertychange",nr),Wn=Vn=null)}function nr(e){if("value"===e.propertyName&&Kn(Wn)){var t=[];qn(t,Wn,e,we(e)),Ne(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Wn=n,(Vn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kn(Wn)}function ar(e,t){if("click"===e)return Kn(t)}function sr(e,t){if("input"===e||"change"===e)return Kn(t)}var ir="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(ir(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!u.call(t,o)||!ir(e[o],t[o]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function ur(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ur(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ur(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,a=Math.min(r.start,o);r=void 0===r.end?a:Math.min(r.end,o),!e.extend&&a>r&&(o=r,r=a,a=o),o=dr(n,a);var s=dr(n,r);o&&s&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=d&&"documentMode"in document&&11>=document.documentMode,gr=null,yr=null,vr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==gr||gr!==Y(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,0<(r=Vr(yr,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Tr={},Cr={};function kr(e){if(Tr[e])return Tr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Cr)return Tr[e]=n[t];return e}d&&(Cr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Ar=kr("animationend"),Ir=kr("animationiteration"),Er=kr("animationstart"),Pr=kr("transitionend"),_r=new Map,Nr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(e,t){_r.set(e,t),l(t,[e])}for(var Mr=0;Mr<Nr.length;Mr++){var jr=Nr[Mr];Rr(jr.toLowerCase(),"on"+(jr[0].toUpperCase()+jr.slice(1)))}Rr(Ar,"onAnimationEnd"),Rr(Ir,"onAnimationIteration"),Rr(Er,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Pr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Or=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dr));function Br(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,o,s,i,l,c){if(Ge.apply(this,arguments),Oe){if(!Oe)throw Error(a(198));var d=Be;Oe=!1,Be=null,Le||(Le=!0,Fe=d)}}(r,t,void 0,e),e.currentTarget=null}function Lr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var s=r.length-1;0<=s;s--){var i=r[s],l=i.instance,c=i.currentTarget;if(i=i.listener,l!==a&&o.isPropagationStopped())break e;Br(o,i,c),a=l}else for(s=0;s<r.length;s++){if(l=(i=r[s]).instance,c=i.currentTarget,i=i.listener,l!==a&&o.isPropagationStopped())break e;Br(o,i,c),a=l}}}if(Le)throw e=Fe,Le=!1,Fe=null,e}function Fr(e,t){var n=t[go];void 0===n&&(n=t[go]=new Set);var r=e+"__bubble";n.has(r)||(Ur(t,e,2,!1),n.add(r))}function $r(e,t,n){var r=0;t&&(r|=4),Ur(n,e,r,t)}var Gr="_reactListening"+Math.random().toString(36).slice(2);function zr(e){if(!e[Gr]){e[Gr]=!0,s.forEach((function(t){"selectionchange"!==t&&(Or.has(t)||$r(t,!1,e),$r(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Gr]||(t[Gr]=!0,$r("selectionchange",!1,t))}}function Ur(e,t,n,r){switch(Xt(t)){case 1:var o=qt;break;case 4:o=Vt;break;default:o=Wt}n=o.bind(null,t,n,e),o=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,o){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var i=r.stateNode.containerInfo;if(i===o||8===i.nodeType&&i.parentNode===o)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===o||8===l.nodeType&&l.parentNode===o))return;s=s.return}for(;null!==i;){if(null===(s=bo(i)))return;if(5===(l=s.tag)||6===l){r=a=s;continue e}i=i.parentNode}}r=r.return}Ne((function(){var r=a,o=we(n),s=[];e:{var i=_r.get(e);if(void 0!==i){var l=dn,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=In;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Ar:case Ir:case Er:l=yn;break;case Pr:l=_n;break;case"scroll":l=hn;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=En}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==i?i+"Capture":null:i;d=[];for(var p,m=r;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=Re(m,h))&&d.push(qr(m,f,p)))),u)break;m=m.return}0<d.length&&(i=new l(i,c,null,n,o),s.push({event:i,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(i="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!bo(c)&&!c[fo])&&(l||i)&&(i=o.window===o?o:(i=o.ownerDocument)?i.defaultView||i.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?bo(c):null)&&(c!==(u=ze(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(d=mn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=En,f="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==l?i:wo(l),p=null==c?i:wo(c),(i=new d(f,m+"leave",l,n,o)).target=u,i.relatedTarget=p,f=null,bo(o)===r&&((d=new d(h,m+"enter",c,n,o)).target=p,d.relatedTarget=u,f=d),u=f,l&&c)e:{for(h=c,m=0,p=d=l;p;p=Wr(p))m++;for(p=0,f=h;f;f=Wr(f))p++;for(;0<m-p;)d=Wr(d),m--;for(;0<p-m;)h=Wr(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=Wr(d),h=Wr(h)}d=null}else d=null;null!==l&&Yr(s,i,l,d,!1),null!==c&&null!==u&&Yr(s,u,c,d,!0)}if("select"===(l=(i=r?wo(r):window).nodeName&&i.nodeName.toLowerCase())||"input"===l&&"file"===i.type)var g=Xn;else if(Hn(i))if(Zn)g=sr;else{g=or;var y=rr}else(l=i.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(g=ar);switch(g&&(g=g(e,r))?qn(s,g,n,o):(y&&y(e,i,r),"focusout"===e&&(y=i._wrapperState)&&y.controlled&&"number"===i.type&&ee(i,"number",i.value)),y=r?wo(r):window,e){case"focusin":(Hn(y)||"true"===y.contentEditable)&&(gr=y,yr=r,vr=null);break;case"focusout":vr=yr=gr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(s,n,o);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":xr(s,n,o)}var v;if(jn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else zn?$n(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Bn&&"ko"!==n.locale&&(zn||"onCompositionStart"!==b?"onCompositionEnd"===b&&zn&&(v=en()):(Jt="value"in(Zt=o)?Zt.value:Zt.textContent,zn=!0)),0<(y=Vr(r,b)).length&&(b=new xn(b,e,null,n,o),s.push({event:b,listeners:y}),v?b.data=v:null!==(v=Gn(n))&&(b.data=v))),(v=On?function(e,t){switch(e){case"compositionend":return Gn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Ln);case"textInput":return(e=t.data)===Ln&&Fn?null:e;default:return null}}(e,n):function(e,t){if(zn)return"compositionend"===e||!jn&&$n(e,t)?(e=en(),Qt=Jt=Zt=null,zn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Vr(r,"onBeforeInput")).length&&(o=new xn("onBeforeInput","beforeinput",null,n,o),s.push({event:o,listeners:r}),o.data=v))}Lr(s,t)}))}function qr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Vr(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;5===o.tag&&null!==a&&(o=a,null!=(a=Re(e,n))&&r.unshift(qr(e,a,o)),null!=(a=Re(e,t))&&r.push(qr(e,a,o))),e=e.return}return r}function Wr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,o){for(var a=t._reactName,s=[];null!==n&&n!==r;){var i=n,l=i.alternate,c=i.stateNode;if(null!==l&&l===r)break;5===i.tag&&null!==c&&(i=c,o?null!=(l=Re(n,a))&&s.unshift(qr(n,l,i)):o||null!=(l=Re(n,a))&&s.push(qr(n,l,i))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Kr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Zr(e){return("string"===typeof e?e:""+e).replace(Kr,"\n").replace(Xr,"")}function Jr(e,t,n){if(t=Zr(t),Zr(e)!==t&&n)throw Error(a(425))}function Qr(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ro="function"===typeof setTimeout?setTimeout:void 0,oo="function"===typeof clearTimeout?clearTimeout:void 0,ao="function"===typeof Promise?Promise:void 0,so="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ao?function(e){return ao.resolve(null).then(e).catch(io)}:ro;function io(e){setTimeout((function(){throw e}))}function lo(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return e.removeChild(o),void zt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);zt(t)}function co(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function uo(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ho=Math.random().toString(36).slice(2),po="__reactFiber$"+ho,mo="__reactProps$"+ho,fo="__reactContainer$"+ho,go="__reactEvents$"+ho,yo="__reactListeners$"+ho,vo="__reactHandles$"+ho;function bo(e){var t=e[po];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fo]||n[po]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=uo(e);null!==e;){if(n=e[po])return n;e=uo(e)}return t}n=(e=n).parentNode}return null}function xo(e){return!(e=e[po]||e[fo])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wo(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function So(e){return e[mo]||null}var To=[],Co=-1;function ko(e){return{current:e}}function Ao(e){0>Co||(e.current=To[Co],To[Co]=null,Co--)}function Io(e,t){Co++,To[Co]=e.current,e.current=t}var Eo={},Po=ko(Eo),_o=ko(!1),No=Eo;function Ro(e,t){var n=e.type.contextTypes;if(!n)return Eo;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,a={};for(o in n)a[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Mo(e){return null!==(e=e.childContextTypes)&&void 0!==e}function jo(){Ao(_o),Ao(Po)}function Do(e,t,n){if(Po.current!==Eo)throw Error(a(168));Io(Po,t),Io(_o,n)}function Oo(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,U(e)||"Unknown",o));return B({},n,r)}function Bo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Eo,No=Po.current,Io(Po,e),Io(_o,_o.current),!0}function Lo(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Oo(e,t,No),r.__reactInternalMemoizedMergedChildContext=e,Ao(_o),Ao(Po),Io(Po,e)):Ao(_o),Io(_o,n)}var Fo=null,$o=!1,Go=!1;function zo(e){null===Fo?Fo=[e]:Fo.push(e)}function Uo(){if(!Go&&null!==Fo){Go=!0;var e=0,t=bt;try{var n=Fo;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fo=null,$o=!1}catch(o){throw null!==Fo&&(Fo=Fo.slice(e+1)),We(Qe,Uo),o}finally{bt=t,Go=!1}}return null}var Ho=[],qo=0,Vo=null,Wo=0,Yo=[],Ko=0,Xo=null,Zo=1,Jo="";function Qo(e,t){Ho[qo++]=Wo,Ho[qo++]=Vo,Vo=e,Wo=t}function ea(e,t,n){Yo[Ko++]=Zo,Yo[Ko++]=Jo,Yo[Ko++]=Xo,Xo=e;var r=Zo;e=Jo;var o=32-st(r)-1;r&=~(1<<o),n+=1;var a=32-st(t)+o;if(30<a){var s=o-o%5;a=(r&(1<<s)-1).toString(32),r>>=s,o-=s,Zo=1<<32-st(t)+o|n<<o|r,Jo=a+e}else Zo=1<<a|n<<o|r,Jo=e}function ta(e){null!==e.return&&(Qo(e,1),ea(e,1,0))}function na(e){for(;e===Vo;)Vo=Ho[--qo],Ho[qo]=null,Wo=Ho[--qo],Ho[qo]=null;for(;e===Xo;)Xo=Yo[--Ko],Yo[Ko]=null,Jo=Yo[--Ko],Yo[Ko]=null,Zo=Yo[--Ko],Yo[Ko]=null}var ra=null,oa=null,aa=!1,sa=null;function ia(e,t){var n=Nc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function la(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ra=e,oa=co(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ra=e,oa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xo?{id:Zo,overflow:Jo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ra=e,oa=null,!0);default:return!1}}function ca(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function da(e){if(aa){var t=oa;if(t){var n=t;if(!la(e,t)){if(ca(e))throw Error(a(418));t=co(n.nextSibling);var r=ra;t&&la(e,t)?ia(r,n):(e.flags=-4097&e.flags|2,aa=!1,ra=e)}}else{if(ca(e))throw Error(a(418));e.flags=-4097&e.flags|2,aa=!1,ra=e}}}function ua(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ra=e}function ha(e){if(e!==ra)return!1;if(!aa)return ua(e),aa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oa)){if(ca(e))throw pa(),Error(a(418));for(;t;)ia(e,t),t=co(t.nextSibling)}if(ua(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oa=co(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oa=null}}else oa=ra?co(e.stateNode.nextSibling):null;return!0}function pa(){for(var e=oa;e;)e=co(e.nextSibling)}function ma(){oa=ra=null,aa=!1}function fa(e){null===sa?sa=[e]:sa.push(e)}var ga=x.ReactCurrentBatchConfig;function ya(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var o=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=o.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function va(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ba(e){return(0,e._init)(e._payload)}function xa(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Mc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function i(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Bc(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===T?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===R&&ba(a)===t.type)?((r=o(t,n.props)).ref=ya(e,t,n),r.return=e,r):((r=jc(n.type,n.key,n.props,null,e.mode,r)).ref=ya(e,t,n),r.return=e,r)}function d(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Lc(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function u(e,t,n,r,a){return null===t||7!==t.tag?((t=Dc(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Bc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=jc(t.type,t.key,t.props,null,e.mode,n)).ref=ya(e,null,t),n.return=e,n;case S:return(t=Lc(t,e.mode,n)).return=e,t;case R:return h(e,(0,t._init)(t._payload),n)}if(te(t)||D(t))return(t=Dc(t,e.mode,n,null)).return=e,t;va(e,t)}return null}function p(e,t,n,r){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==o?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===o?c(e,t,n,r):null;case S:return n.key===o?d(e,t,n,r):null;case R:return p(e,t,(o=n._init)(n._payload),r)}if(te(n)||D(n))return null!==o?null:u(e,t,n,r,null);va(e,n)}return null}function m(e,t,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case S:return d(t,e=e.get(null===r.key?n:r.key)||null,r,o);case R:return m(e,t,n,(0,r._init)(r._payload),o)}if(te(r)||D(r))return u(t,e=e.get(n)||null,r,o,null);va(t,r)}return null}function f(o,a,i,l){for(var c=null,d=null,u=a,f=a=0,g=null;null!==u&&f<i.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var y=p(o,u,i[f],l);if(null===y){null===u&&(u=g);break}e&&u&&null===y.alternate&&t(o,u),a=s(y,a,f),null===d?c=y:d.sibling=y,d=y,u=g}if(f===i.length)return n(o,u),aa&&Qo(o,f),c;if(null===u){for(;f<i.length;f++)null!==(u=h(o,i[f],l))&&(a=s(u,a,f),null===d?c=u:d.sibling=u,d=u);return aa&&Qo(o,f),c}for(u=r(o,u);f<i.length;f++)null!==(g=m(u,o,f,i[f],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),a=s(g,a,f),null===d?c=g:d.sibling=g,d=g);return e&&u.forEach((function(e){return t(o,e)})),aa&&Qo(o,f),c}function g(o,i,l,c){var d=D(l);if("function"!==typeof d)throw Error(a(150));if(null==(l=d.call(l)))throw Error(a(151));for(var u=d=null,f=i,g=i=0,y=null,v=l.next();null!==f&&!v.done;g++,v=l.next()){f.index>g?(y=f,f=null):y=f.sibling;var b=p(o,f,v.value,c);if(null===b){null===f&&(f=y);break}e&&f&&null===b.alternate&&t(o,f),i=s(b,i,g),null===u?d=b:u.sibling=b,u=b,f=y}if(v.done)return n(o,f),aa&&Qo(o,g),d;if(null===f){for(;!v.done;g++,v=l.next())null!==(v=h(o,v.value,c))&&(i=s(v,i,g),null===u?d=v:u.sibling=v,u=v);return aa&&Qo(o,g),d}for(f=r(o,f);!v.done;g++,v=l.next())null!==(v=m(f,o,g,v.value,c))&&(e&&null!==v.alternate&&f.delete(null===v.key?g:v.key),i=s(v,i,g),null===u?d=v:u.sibling=v,u=v);return e&&f.forEach((function(e){return t(o,e)})),aa&&Qo(o,g),d}return function e(r,a,s,l){if("object"===typeof s&&null!==s&&s.type===T&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case w:e:{for(var c=s.key,d=a;null!==d;){if(d.key===c){if((c=s.type)===T){if(7===d.tag){n(r,d.sibling),(a=o(d,s.props.children)).return=r,r=a;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===R&&ba(c)===d.type){n(r,d.sibling),(a=o(d,s.props)).ref=ya(r,d,s),a.return=r,r=a;break e}n(r,d);break}t(r,d),d=d.sibling}s.type===T?((a=Dc(s.props.children,r.mode,l,s.key)).return=r,r=a):((l=jc(s.type,s.key,s.props,null,r.mode,l)).ref=ya(r,a,s),l.return=r,r=l)}return i(r);case S:e:{for(d=s.key;null!==a;){if(a.key===d){if(4===a.tag&&a.stateNode.containerInfo===s.containerInfo&&a.stateNode.implementation===s.implementation){n(r,a.sibling),(a=o(a,s.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Lc(s,r.mode,l)).return=r,r=a}return i(r);case R:return e(r,a,(d=s._init)(s._payload),l)}if(te(s))return f(r,a,s,l);if(D(s))return g(r,a,s,l);va(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==a&&6===a.tag?(n(r,a.sibling),(a=o(a,s)).return=r,r=a):(n(r,a),(a=Bc(s,r.mode,l)).return=r,r=a),i(r)):n(r,a)}}var wa=xa(!0),Sa=xa(!1),Ta=ko(null),Ca=null,ka=null,Aa=null;function Ia(){Aa=ka=Ca=null}function Ea(e){var t=Ta.current;Ao(Ta),e._currentValue=t}function Pa(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function _a(e,t){Ca=e,Aa=ka=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bi=!0),e.firstContext=null)}function Na(e){var t=e._currentValue;if(Aa!==e)if(e={context:e,memoizedValue:t,next:null},null===ka){if(null===Ca)throw Error(a(308));ka=e,Ca.dependencies={lanes:0,firstContext:e}}else ka=ka.next=e;return t}var Ra=null;function Ma(e){null===Ra?Ra=[e]:Ra.push(e)}function ja(e,t,n,r){var o=t.interleaved;return null===o?(n.next=n,Ma(t)):(n.next=o.next,o.next=n),t.interleaved=n,Da(e,r)}function Da(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Oa=!1;function Ba(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function La(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function $a(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&El)){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Da(e,n)}return null===(o=r.interleaved)?(t.next=t,Ma(r)):(t.next=o.next,o.next=t),r.interleaved=t,Da(e,n)}function Ga(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function za(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?o=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ua(e,t,n,r){var o=e.updateQueue;Oa=!1;var a=o.firstBaseUpdate,s=o.lastBaseUpdate,i=o.shared.pending;if(null!==i){o.shared.pending=null;var l=i,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var d=e.alternate;null!==d&&((i=(d=d.updateQueue).lastBaseUpdate)!==s&&(null===i?d.firstBaseUpdate=c:i.next=c,d.lastBaseUpdate=l))}if(null!==a){var u=o.baseState;for(s=0,d=c=l=null,i=a;;){var h=i.lane,p=i.eventTime;if((r&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var m=e,f=i;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,u,h):m)||void 0===h)break e;u=B({},u,h);break e;case 2:Oa=!0}}null!==i.callback&&0!==i.lane&&(e.flags|=64,null===(h=o.effects)?o.effects=[i]:h.push(i))}else p={eventTime:p,lane:h,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===d?(c=d=p,l=u):d=d.next=p,s|=h;if(null===(i=i.next)){if(null===(i=o.shared.pending))break;i=(h=i).next,h.next=null,o.lastBaseUpdate=h,o.shared.pending=null}}if(null===d&&(l=u),o.baseState=l,o.firstBaseUpdate=c,o.lastBaseUpdate=d,null!==(t=o.shared.interleaved)){o=t;do{s|=o.lane,o=o.next}while(o!==t)}else null===a&&(o.shared.lanes=0);Ol|=s,e.lanes=s,e.memoizedState=u}}function Ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!==typeof o)throw Error(a(191,o));o.call(r)}}}var qa={},Va=ko(qa),Wa=ko(qa),Ya=ko(qa);function Ka(e){if(e===qa)throw Error(a(174));return e}function Xa(e,t){switch(Io(Ya,t),Io(Wa,e),Io(Va,qa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ao(Va),Io(Va,t)}function Za(){Ao(Va),Ao(Wa),Ao(Ya)}function Ja(e){Ka(Ya.current);var t=Ka(Va.current),n=le(t,e.type);t!==n&&(Io(Wa,e),Io(Va,n))}function Qa(e){Wa.current===e&&(Ao(Va),Ao(Wa))}var es=ko(0);function ts(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ns=[];function rs(){for(var e=0;e<ns.length;e++)ns[e]._workInProgressVersionPrimary=null;ns.length=0}var os=x.ReactCurrentDispatcher,as=x.ReactCurrentBatchConfig,ss=0,is=null,ls=null,cs=null,ds=!1,us=!1,hs=0,ps=0;function ms(){throw Error(a(321))}function fs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ir(e[n],t[n]))return!1;return!0}function gs(e,t,n,r,o,s){if(ss=s,is=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,os.current=null===e||null===e.memoizedState?Qs:ei,e=n(r,o),us){s=0;do{if(us=!1,hs=0,25<=s)throw Error(a(301));s+=1,cs=ls=null,t.updateQueue=null,os.current=ti,e=n(r,o)}while(us)}if(os.current=Js,t=null!==ls&&null!==ls.next,ss=0,cs=ls=is=null,ds=!1,t)throw Error(a(300));return e}function ys(){var e=0!==hs;return hs=0,e}function vs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===cs?is.memoizedState=cs=e:cs=cs.next=e,cs}function bs(){if(null===ls){var e=is.alternate;e=null!==e?e.memoizedState:null}else e=ls.next;var t=null===cs?is.memoizedState:cs.next;if(null!==t)cs=t,ls=e;else{if(null===e)throw Error(a(310));e={memoizedState:(ls=e).memoizedState,baseState:ls.baseState,baseQueue:ls.baseQueue,queue:ls.queue,next:null},null===cs?is.memoizedState=cs=e:cs=cs.next=e}return cs}function xs(e,t){return"function"===typeof t?t(e):t}function ws(e){var t=bs(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=ls,o=r.baseQueue,s=n.pending;if(null!==s){if(null!==o){var i=o.next;o.next=s.next,s.next=i}r.baseQueue=o=s,n.pending=null}if(null!==o){s=o.next,r=r.baseState;var l=i=null,c=null,d=s;do{var u=d.lane;if((ss&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,i=r):c=c.next=h,is.lanes|=u,Ol|=u}d=d.next}while(null!==d&&d!==s);null===c?i=r:c.next=l,ir(r,t.memoizedState)||(bi=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{s=o.lane,is.lanes|=s,Ol|=s,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ss(e){var t=bs(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,s=t.memoizedState;if(null!==o){n.pending=null;var i=o=o.next;do{s=e(s,i.action),i=i.next}while(i!==o);ir(s,t.memoizedState)||(bi=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Ts(){}function Cs(e,t){var n=is,r=bs(),o=t(),s=!ir(r.memoizedState,o);if(s&&(r.memoizedState=o,bi=!0),r=r.queue,Os(Is.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==cs&&1&cs.memoizedState.tag){if(n.flags|=2048,Ns(9,As.bind(null,n,r,o,t),void 0,null),null===Pl)throw Error(a(349));0!==(30&ss)||ks(n,t,o)}return o}function ks(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=is.updateQueue)?(t={lastEffect:null,stores:null},is.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function As(e,t,n,r){t.value=n,t.getSnapshot=r,Es(t)&&Ps(e)}function Is(e,t,n){return n((function(){Es(t)&&Ps(e)}))}function Es(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ir(e,n)}catch(r){return!0}}function Ps(e){var t=Da(e,1);null!==t&&nc(t,e,1,-1)}function _s(e){var t=vs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:e},t.queue=e,e=e.dispatch=Ys.bind(null,is,e),[t.memoizedState,e]}function Ns(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=is.updateQueue)?(t={lastEffect:null,stores:null},is.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Rs(){return bs().memoizedState}function Ms(e,t,n,r){var o=vs();is.flags|=e,o.memoizedState=Ns(1|t,n,void 0,void 0===r?null:r)}function js(e,t,n,r){var o=bs();r=void 0===r?null:r;var a=void 0;if(null!==ls){var s=ls.memoizedState;if(a=s.destroy,null!==r&&fs(r,s.deps))return void(o.memoizedState=Ns(t,n,a,r))}is.flags|=e,o.memoizedState=Ns(1|t,n,a,r)}function Ds(e,t){return Ms(8390656,8,e,t)}function Os(e,t){return js(2048,8,e,t)}function Bs(e,t){return js(4,2,e,t)}function Ls(e,t){return js(4,4,e,t)}function Fs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function $s(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,js(4,4,Fs.bind(null,t,e),n)}function Gs(){}function zs(e,t){var n=bs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Us(e,t){var n=bs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fs(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Hs(e,t,n){return 0===(21&ss)?(e.baseState&&(e.baseState=!1,bi=!0),e.memoizedState=n):(ir(n,t)||(n=ft(),is.lanes|=n,Ol|=n,e.baseState=!0),t)}function qs(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=as.transition;as.transition={};try{e(!1),t()}finally{bt=n,as.transition=r}}function Vs(){return bs().memoizedState}function Ws(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ks(e))Xs(t,n);else if(null!==(n=ja(e,t,n,r))){nc(n,e,r,ec()),Zs(n,t,r)}}function Ys(e,t,n){var r=tc(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ks(e))Xs(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,i=a(s,n);if(o.hasEagerState=!0,o.eagerState=i,ir(i,s)){var l=t.interleaved;return null===l?(o.next=o,Ma(t)):(o.next=l.next,l.next=o),void(t.interleaved=o)}}catch(c){}null!==(n=ja(e,t,o,r))&&(nc(n,e,r,o=ec()),Zs(n,t,r))}}function Ks(e){var t=e.alternate;return e===is||null!==t&&t===is}function Xs(e,t){us=ds=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Zs(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var Js={readContext:Na,useCallback:ms,useContext:ms,useEffect:ms,useImperativeHandle:ms,useInsertionEffect:ms,useLayoutEffect:ms,useMemo:ms,useReducer:ms,useRef:ms,useState:ms,useDebugValue:ms,useDeferredValue:ms,useTransition:ms,useMutableSource:ms,useSyncExternalStore:ms,useId:ms,unstable_isNewReconciler:!1},Qs={readContext:Na,useCallback:function(e,t){return vs().memoizedState=[e,void 0===t?null:t],e},useContext:Na,useEffect:Ds,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ms(4194308,4,Fs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ms(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ms(4,2,e,t)},useMemo:function(e,t){var n=vs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=vs();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ws.bind(null,is,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},vs().memoizedState=e},useState:_s,useDebugValue:Gs,useDeferredValue:function(e){return vs().memoizedState=e},useTransition:function(){var e=_s(!1),t=e[0];return e=qs.bind(null,e[1]),vs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=is,o=vs();if(aa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Pl)throw Error(a(349));0!==(30&ss)||ks(r,t,n)}o.memoizedState=n;var s={value:n,getSnapshot:t};return o.queue=s,Ds(Is.bind(null,r,s,e),[e]),r.flags|=2048,Ns(9,As.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=vs(),t=Pl.identifierPrefix;if(aa){var n=Jo;t=":"+t+"R"+(n=(Zo&~(1<<32-st(Zo)-1)).toString(32)+n),0<(n=hs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ps++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ei={readContext:Na,useCallback:zs,useContext:Na,useEffect:Os,useImperativeHandle:$s,useInsertionEffect:Bs,useLayoutEffect:Ls,useMemo:Us,useReducer:ws,useRef:Rs,useState:function(){return ws(xs)},useDebugValue:Gs,useDeferredValue:function(e){return Hs(bs(),ls.memoizedState,e)},useTransition:function(){return[ws(xs)[0],bs().memoizedState]},useMutableSource:Ts,useSyncExternalStore:Cs,useId:Vs,unstable_isNewReconciler:!1},ti={readContext:Na,useCallback:zs,useContext:Na,useEffect:Os,useImperativeHandle:$s,useInsertionEffect:Bs,useLayoutEffect:Ls,useMemo:Us,useReducer:Ss,useRef:Rs,useState:function(){return Ss(xs)},useDebugValue:Gs,useDeferredValue:function(e){var t=bs();return null===ls?t.memoizedState=e:Hs(t,ls.memoizedState,e)},useTransition:function(){return[Ss(xs)[0],bs().memoizedState]},useMutableSource:Ts,useSyncExternalStore:Cs,useId:Vs,unstable_isNewReconciler:!1};function ni(e,t){if(e&&e.defaultProps){for(var n in t=B({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ri(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:B({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var oi={isMounted:function(e){return!!(e=e._reactInternals)&&ze(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),o=tc(e),a=Fa(r,o);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=$a(e,a,o))&&(nc(t,e,o,r),Ga(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),o=tc(e),a=Fa(r,o);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=$a(e,a,o))&&(nc(t,e,o,r),Ga(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),o=Fa(n,r);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),null!==(t=$a(e,o,r))&&(nc(t,e,r,n),Ga(t,e,r))}};function ai(e,t,n,r,o,a,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(o,a))}function si(e,t,n){var r=!1,o=Eo,a=t.contextType;return"object"===typeof a&&null!==a?a=Na(a):(o=Mo(t)?No:Po.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ro(e,o):Eo),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=oi,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function ii(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&oi.enqueueReplaceState(t,t.state,null)}function li(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Ba(e);var a=t.contextType;"object"===typeof a&&null!==a?o.context=Na(a):(a=Mo(t)?No:Po.current,o.context=Ro(e,a)),o.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(ri(e,t,a,n),o.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(t=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&oi.enqueueReplaceState(o,o.state,null),Ua(e,n,o,r),o.state=e.memoizedState),"function"===typeof o.componentDidMount&&(e.flags|=4194308)}function ci(e,t){try{var n="",r=t;do{n+=G(r),r=r.return}while(r);var o=n}catch(a){o="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:o,digest:null}}function di(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ui(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var hi="function"===typeof WeakMap?WeakMap:Map;function pi(e,t,n){(n=Fa(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hl||(Hl=!0,ql=r),ui(0,t)},n}function mi(e,t,n){(n=Fa(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){ui(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){ui(0,t),"function"!==typeof r&&(null===Vl?Vl=new Set([this]):Vl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fi(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new hi;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=kc.bind(null,e,t,n),t.then(e,e))}function gi(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function yi(e,t,n,r,o){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fa(-1,1)).tag=2,$a(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}var vi=x.ReactCurrentOwner,bi=!1;function xi(e,t,n,r){t.child=null===e?Sa(t,null,n,r):wa(t,e.child,n,r)}function wi(e,t,n,r,o){n=n.render;var a=t.ref;return _a(t,o),r=gs(e,t,n,r,a,o),n=ys(),null===e||bi?(aa&&n&&ta(t),t.flags|=1,xi(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Hi(e,t,o))}function Si(e,t,n,r,o){if(null===e){var a=n.type;return"function"!==typeof a||Rc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=jc(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ti(e,t,a,r,o))}if(a=e.child,0===(e.lanes&o)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(s,r)&&e.ref===t.ref)return Hi(e,t,o)}return t.flags|=1,(e=Mc(a,r)).ref=t.ref,e.return=t,t.child=e}function Ti(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(lr(a,r)&&e.ref===t.ref){if(bi=!1,t.pendingProps=r=a,0===(e.lanes&o))return t.lanes=e.lanes,Hi(e,t,o);0!==(131072&e.flags)&&(bi=!0)}}return Ai(e,t,n,r,o)}function Ci(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Io(Ml,Rl),Rl|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Io(Ml,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Io(Ml,Rl),Rl|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Io(Ml,Rl),Rl|=r;return xi(e,t,o,n),t.child}function ki(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ai(e,t,n,r,o){var a=Mo(n)?No:Po.current;return a=Ro(t,a),_a(t,o),n=gs(e,t,n,r,a,o),r=ys(),null===e||bi?(aa&&r&&ta(t),t.flags|=1,xi(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Hi(e,t,o))}function Ii(e,t,n,r,o){if(Mo(n)){var a=!0;Bo(t)}else a=!1;if(_a(t,o),null===t.stateNode)Ui(e,t),si(t,n,r),li(t,n,r,o),r=!0;else if(null===e){var s=t.stateNode,i=t.memoizedProps;s.props=i;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Na(c):c=Ro(t,c=Mo(n)?No:Po.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof s.getSnapshotBeforeUpdate;u||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(i!==r||l!==c)&&ii(t,s,r,c),Oa=!1;var h=t.memoizedState;s.state=h,Ua(t,r,s,o),l=t.memoizedState,i!==r||h!==l||_o.current||Oa?("function"===typeof d&&(ri(t,n,d,r),l=t.memoizedState),(i=Oa||ai(t,n,i,r,h,l,c))?(u||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=i):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,La(e,t),i=t.memoizedProps,c=t.type===t.elementType?i:ni(t.type,i),s.props=c,u=t.pendingProps,h=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Na(l):l=Ro(t,l=Mo(n)?No:Po.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(i!==u||h!==l)&&ii(t,s,r,l),Oa=!1,h=t.memoizedState,s.state=h,Ua(t,r,s,o);var m=t.memoizedState;i!==u||h!==m||_o.current||Oa?("function"===typeof p&&(ri(t,n,p,r),m=t.memoizedState),(c=Oa||ai(t,n,c,r,h,m,l)||!1)?(d||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,m,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,m,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=m),s.props=r,s.state=m,s.context=l,r=c):("function"!==typeof s.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ei(e,t,n,r,a,o)}function Ei(e,t,n,r,o,a){ki(e,t);var s=0!==(128&t.flags);if(!r&&!s)return o&&Lo(t,n,!1),Hi(e,t,a);r=t.stateNode,vi.current=t;var i=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=wa(t,e.child,null,a),t.child=wa(t,null,i,a)):xi(e,t,i,a),t.memoizedState=r.state,o&&Lo(t,n,!0),t.child}function Pi(e){var t=e.stateNode;t.pendingContext?Do(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Do(0,t.context,!1),Xa(e,t.containerInfo)}function _i(e,t,n,r,o){return ma(),fa(o),t.flags|=256,xi(e,t,n,r),t.child}var Ni,Ri,Mi,ji,Di={dehydrated:null,treeContext:null,retryLane:0};function Oi(e){return{baseLanes:e,cachePool:null,transitions:null}}function Bi(e,t,n){var r,o=t.pendingProps,s=es.current,i=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(i=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Io(es,1&s),null===e)return da(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=o.children,e=o.fallback,i?(o=t.mode,i=t.child,l={mode:"hidden",children:l},0===(1&o)&&null!==i?(i.childLanes=0,i.pendingProps=l):i=Oc(l,o,0,null),e=Dc(e,o,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Oi(n),t.memoizedState=Di,e):Li(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,o,s,i){if(n)return 256&t.flags?(t.flags&=-257,Fi(e,t,i,r=di(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,o=t.mode,r=Oc({mode:"visible",children:r.children},o,0,null),(s=Dc(s,o,i,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&wa(t,e.child,null,i),t.child.memoizedState=Oi(i),t.memoizedState=Di,s);if(0===(1&t.mode))return Fi(e,t,i,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var l=r.dgst;return r=l,Fi(e,t,i,r=di(s=Error(a(419)),r,void 0))}if(l=0!==(i&e.childLanes),bi||l){if(null!==(r=Pl)){switch(i&-i){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(r.suspendedLanes|i))?0:o)&&o!==s.retryLane&&(s.retryLane=o,Da(e,o),nc(r,e,o,-1))}return fc(),Fi(e,t,i,r=di(Error(a(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=Ic.bind(null,e),o._reactRetry=t,null):(e=s.treeContext,oa=co(o.nextSibling),ra=t,aa=!0,sa=null,null!==e&&(Yo[Ko++]=Zo,Yo[Ko++]=Jo,Yo[Ko++]=Xo,Zo=e.id,Jo=e.overflow,Xo=t),t=Li(t,r.children),t.flags|=4096,t)}(e,t,l,o,r,s,n);if(i){i=o.fallback,l=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:o.children};return 0===(1&l)&&t.child!==s?((o=t.child).childLanes=0,o.pendingProps=c,t.deletions=null):(o=Mc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==r?i=Mc(r,i):(i=Dc(i,l,n,null)).flags|=2,i.return=t,o.return=t,o.sibling=i,t.child=o,o=i,i=t.child,l=null===(l=e.child.memoizedState)?Oi(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=e.childLanes&~n,t.memoizedState=Di,o}return e=(i=e.child).sibling,o=Mc(i,{mode:"visible",children:o.children}),0===(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Li(e,t){return(t=Oc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fi(e,t,n,r){return null!==r&&fa(r),wa(t,e.child,null,n),(e=Li(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function $i(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Pa(e.return,t,n)}function Gi(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function zi(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(xi(e,t,r.children,n),0!==(2&(r=es.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&$i(e,n,t);else if(19===e.tag)$i(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Io(es,r),0===(1&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ts(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Gi(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ts(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Gi(t,!0,n,null,a);break;case"together":Gi(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ui(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hi(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ol|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Mc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Mc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function qi(e,t){if(!aa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Vi(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Wi(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vi(t),null;case 1:case 17:return Mo(t.type)&&jo(),Vi(t),null;case 3:return r=t.stateNode,Za(),Ao(_o),Ao(Po),rs(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ha(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==sa&&(sc(sa),sa=null))),Ri(e,t),Vi(t),null;case 5:Qa(t);var o=Ka(Ya.current);if(n=t.type,null!==e&&null!=t.stateNode)Mi(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Vi(t),null}if(e=Ka(Va.current),ha(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[po]=t,r[mo]=s,e=0!==(1&t.mode),n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(o=0;o<Dr.length;o++)Fr(Dr[o],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":X(r,s),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Fr("invalid",r);break;case"textarea":oe(r,s),Fr("invalid",r)}for(var l in ve(n,s),o=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Jr(r.textContent,c,e),o=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Jr(r.textContent,c,e),o=["children",""+c]):i.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fr("scroll",r)}switch(n){case"input":V(r),Q(r,s,!0);break;case"textarea":V(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Qr)}r=o,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ie(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[po]=t,e[mo]=r,Ni(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),o=r;break;case"iframe":case"object":case"embed":Fr("load",e),o=r;break;case"video":case"audio":for(o=0;o<Dr.length;o++)Fr(Dr[o],e);o=r;break;case"source":Fr("error",e),o=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),o=r;break;case"details":Fr("toggle",e),o=r;break;case"input":X(e,r),o=K(e,r),Fr("invalid",e);break;case"option":default:o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=B({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":oe(e,r),o=re(e,r),Fr("invalid",e)}for(s in ve(n,o),c=o)if(c.hasOwnProperty(s)){var d=c[s];"style"===s?ge(e,d):"dangerouslySetInnerHTML"===s?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===s?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(i.hasOwnProperty(s)?null!=d&&"onScroll"===s&&Fr("scroll",e):null!=d&&b(e,s,d,l))}switch(n){case"input":V(e),Q(e,r,!1);break;case"textarea":V(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Qr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Vi(t),null;case 6:if(e&&null!=t.stateNode)ji(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=Ka(Ya.current),Ka(Va.current),ha(t)){if(r=t.stateNode,n=t.memoizedProps,r[po]=t,(s=r.nodeValue!==n)&&null!==(e=ra))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[po]=t,t.stateNode=r}return Vi(t),null;case 13:if(Ao(es),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(aa&&null!==oa&&0!==(1&t.mode)&&0===(128&t.flags))pa(),ma(),t.flags|=98560,s=!1;else if(s=ha(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(a(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(a(317));s[po]=t}else ma(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Vi(t),s=!1}else null!==sa&&(sc(sa),sa=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&es.current)?0===jl&&(jl=3):fc())),null!==t.updateQueue&&(t.flags|=4),Vi(t),null);case 4:return Za(),Ri(e,t),null===e&&zr(t.stateNode.containerInfo),Vi(t),null;case 10:return Ea(t.type._context),Vi(t),null;case 19:if(Ao(es),null===(s=t.memoizedState))return Vi(t),null;if(r=0!==(128&t.flags),null===(l=s.rendering))if(r)qi(s,!1);else{if(0!==jl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ts(e))){for(t.flags|=128,qi(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Io(es,1&es.current|2),t.child}e=e.sibling}null!==s.tail&&Ze()>zl&&(t.flags|=128,r=!0,qi(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ts(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),qi(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!aa)return Vi(t),null}else 2*Ze()-s.renderingStartTime>zl&&1073741824!==n&&(t.flags|=128,r=!0,qi(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ze(),t.sibling=null,n=es.current,Io(es,r?1&n|2:1&n),t):(Vi(t),null);case 22:case 23:return uc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Rl)&&(Vi(t),6&t.subtreeFlags&&(t.flags|=8192)):Vi(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Yi(e,t){switch(na(t),t.tag){case 1:return Mo(t.type)&&jo(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Za(),Ao(_o),Ao(Po),rs(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Qa(t),null;case 13:if(Ao(es),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ma()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ao(es),null;case 4:return Za(),null;case 10:return Ea(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}Ni=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ri=function(){},Mi=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Ka(Va.current);var a,s=null;switch(n){case"input":o=K(e,o),r=K(e,r),s=[];break;case"select":o=B({},o,{value:void 0}),r=B({},r,{value:void 0}),s=[];break;case"textarea":o=re(e,o),r=re(e,r),s=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(e.onclick=Qr)}for(d in ve(n,r),n=null,o)if(!r.hasOwnProperty(d)&&o.hasOwnProperty(d)&&null!=o[d])if("style"===d){var l=o[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(i.hasOwnProperty(d)?s||(s=[]):(s=s||[]).push(d,null));for(d in r){var c=r[d];if(l=null!=o?o[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(i.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Fr("scroll",e),s||l===c||(s=[])):(s=s||[]).push(d,c))}n&&(s=s||[]).push("style",n);var d=s;(t.updateQueue=d)&&(t.flags|=4)}},ji=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ki=!1,Xi=!1,Zi="function"===typeof WeakSet?WeakSet:Set,Ji=null;function Qi(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Cc(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){Cc(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var a=o.destroy;o.destroy=void 0,void 0!==a&&el(t,n,a)}o=o.next}while(o!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[po],delete t[mo],delete t[go],delete t[yo],delete t[vo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function il(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Qr));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var dl=null,ul=!1;function hl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(ot,n)}catch(i){}switch(n.tag){case 5:Xi||Qi(n,t);case 6:var r=dl,o=ul;dl=null,hl(e,t,n),ul=o,null!==(dl=r)&&(ul?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(ul?(e=dl,n=n.stateNode,8===e.nodeType?lo(e.parentNode,n):1===e.nodeType&&lo(e,n),zt(e)):lo(dl,n.stateNode));break;case 4:r=dl,o=ul,dl=n.stateNode.containerInfo,ul=!0,hl(e,t,n),dl=r,ul=o;break;case 0:case 11:case 14:case 15:if(!Xi&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){o=r=r.next;do{var a=o,s=a.destroy;a=a.tag,void 0!==s&&(0!==(2&a)||0!==(4&a))&&el(n,t,s),o=o.next}while(o!==r)}hl(e,t,n);break;case 1:if(!Xi&&(Qi(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(i){Cc(n,t,i)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Xi=(r=Xi)||null!==n.memoizedState,hl(e,t,n),Xi=r):hl(e,t,n);break;default:hl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zi),t.forEach((function(t){var r=Ec.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function fl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var s=e,i=t,l=i;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,ul=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===dl)throw Error(a(160));pl(s,i,o),dl=null,ul=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(d){Cc(o,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fl(t,e),yl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(g){Cc(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Cc(e,e.return,g)}}break;case 1:fl(t,e),yl(e),512&r&&null!==n&&Qi(n,n.return);break;case 5:if(fl(t,e),yl(e),512&r&&null!==n&&Qi(n,n.return),32&e.flags){var o=e.stateNode;try{he(o,"")}catch(g){Cc(e,e.return,g)}}if(4&r&&null!=(o=e.stateNode)){var s=e.memoizedProps,i=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&Z(o,s),be(l,i);var d=be(l,s);for(i=0;i<c.length;i+=2){var u=c[i],h=c[i+1];"style"===u?ge(o,h):"dangerouslySetInnerHTML"===u?ue(o,h):"children"===u?he(o,h):b(o,u,h,d)}switch(l){case"input":J(o,s);break;case"textarea":ae(o,s);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!s.multiple;var m=s.value;null!=m?ne(o,!!s.multiple,m,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(o,!!s.multiple,s.defaultValue,!0):ne(o,!!s.multiple,s.multiple?[]:"",!1))}o[mo]=s}catch(g){Cc(e,e.return,g)}}break;case 6:if(fl(t,e),yl(e),4&r){if(null===e.stateNode)throw Error(a(162));o=e.stateNode,s=e.memoizedProps;try{o.nodeValue=s}catch(g){Cc(e,e.return,g)}}break;case 3:if(fl(t,e),yl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{zt(t.containerInfo)}catch(g){Cc(e,e.return,g)}break;case 4:default:fl(t,e),yl(e);break;case 13:fl(t,e),yl(e),8192&(o=e.child).flags&&(s=null!==o.memoizedState,o.stateNode.isHidden=s,!s||null!==o.alternate&&null!==o.alternate.memoizedState||(Gl=Ze())),4&r&&ml(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Xi=(d=Xi)||u,fl(t,e),Xi=d):fl(t,e),yl(e),8192&r){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Ji=e,u=e.child;null!==u;){for(h=Ji=u;null!==Ji;){switch(m=(p=Ji).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Qi(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){r=p,n=p.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Cc(r,n,g)}}break;case 5:Qi(p,p.return);break;case 22:if(null!==p.memoizedState){wl(h);continue}}null!==m?(m.return=p,Ji=m):wl(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{o=h.stateNode,d?"function"===typeof(s=o.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=h.stateNode,i=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=fe("display",i))}catch(g){Cc(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){Cc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:fl(t,e),yl(e),4&r&&ml(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(he(o,""),r.flags&=-33),cl(e,il(e),o);break;case 3:case 4:var s=r.stateNode.containerInfo;ll(e,il(e),s);break;default:throw Error(a(161))}}catch(i){Cc(e,e.return,i)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vl(e,t,n){Ji=e,bl(e,t,n)}function bl(e,t,n){for(var r=0!==(1&e.mode);null!==Ji;){var o=Ji,a=o.child;if(22===o.tag&&r){var s=null!==o.memoizedState||Ki;if(!s){var i=o.alternate,l=null!==i&&null!==i.memoizedState||Xi;i=Ki;var c=Xi;if(Ki=s,(Xi=l)&&!c)for(Ji=o;null!==Ji;)l=(s=Ji).child,22===s.tag&&null!==s.memoizedState?Sl(o):null!==l?(l.return=s,Ji=l):Sl(o);for(;null!==a;)Ji=a,bl(a,t,n),a=a.sibling;Ji=o,Ki=i,Xi=c}xl(e)}else 0!==(8772&o.subtreeFlags)&&null!==a?(a.return=o,Ji=a):xl(e)}}function xl(e){for(;null!==Ji;){var t=Ji;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xi||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xi)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ni(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Ha(t,s,r);break;case 3:var i=t.updateQueue;if(null!==i){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ha(t,i,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&zt(h)}}}break;default:throw Error(a(163))}Xi||512&t.flags&&ol(t)}catch(p){Cc(t,t.return,p)}}if(t===e){Ji=null;break}if(null!==(n=t.sibling)){n.return=t.return,Ji=n;break}Ji=t.return}}function wl(e){for(;null!==Ji;){var t=Ji;if(t===e){Ji=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Ji=n;break}Ji=t.return}}function Sl(e){for(;null!==Ji;){var t=Ji;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Cc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(l){Cc(t,o,l)}}var a=t.return;try{ol(t)}catch(l){Cc(t,a,l)}break;case 5:var s=t.return;try{ol(t)}catch(l){Cc(t,s,l)}}}catch(l){Cc(t,t.return,l)}if(t===e){Ji=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Ji=i;break}Ji=t.return}}var Tl,Cl=Math.ceil,kl=x.ReactCurrentDispatcher,Al=x.ReactCurrentOwner,Il=x.ReactCurrentBatchConfig,El=0,Pl=null,_l=null,Nl=0,Rl=0,Ml=ko(0),jl=0,Dl=null,Ol=0,Bl=0,Ll=0,Fl=null,$l=null,Gl=0,zl=1/0,Ul=null,Hl=!1,ql=null,Vl=null,Wl=!1,Yl=null,Kl=0,Xl=0,Zl=null,Jl=-1,Ql=0;function ec(){return 0!==(6&El)?Ze():-1!==Jl?Jl:Jl=Ze()}function tc(e){return 0===(1&e.mode)?1:0!==(2&El)&&0!==Nl?Nl&-Nl:null!==ga.transition?(0===Ql&&(Ql=ft()),Ql):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function nc(e,t,n,r){if(50<Xl)throw Xl=0,Zl=null,Error(a(185));yt(e,n,r),0!==(2&El)&&e===Pl||(e===Pl&&(0===(2&El)&&(Bl|=n),4===jl&&ic(e,Nl)),rc(e,r),1===n&&0===El&&0===(1&t.mode)&&(zl=Ze()+500,$o&&Uo()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-st(a),i=1<<s,l=o[s];-1===l?0!==(i&n)&&0===(i&r)||(o[s]=pt(i,t)):l<=t&&(e.expiredLanes|=i),a&=~i}}(e,t);var r=ht(e,e===Pl?Nl:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){$o=!0,zo(e)}(lc.bind(null,e)):zo(lc.bind(null,e)),so((function(){0===(6&El)&&Uo()})),n=null;else{switch(xt(r)){case 1:n=Qe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Pc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Jl=-1,Ql=0,0!==(6&El))throw Error(a(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var r=ht(e,e===Pl?Nl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var o=El;El|=2;var s=mc();for(Pl===e&&Nl===t||(Ul=null,zl=Ze()+500,hc(e,t));;)try{vc();break}catch(l){pc(e,l)}Ia(),kl.current=s,El=o,null!==_l?t=0:(Pl=null,Nl=0,t=jl)}if(0!==t){if(2===t&&(0!==(o=mt(e))&&(r=o,t=ac(e,o))),1===t)throw n=Dl,hc(e,0),ic(e,r),rc(e,Ze()),n;if(6===t)ic(e,r);else{if(o=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!ir(a(),o))return!1}catch(i){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)&&(2===(t=gc(e,r))&&(0!==(s=mt(e))&&(r=s,t=ac(e,s))),1===t))throw n=Dl,hc(e,0),ic(e,r),rc(e,Ze()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:wc(e,$l,Ul);break;case 3:if(ic(e,r),(130023424&r)===r&&10<(t=Gl+500-Ze())){if(0!==ht(e,0))break;if(((o=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ro(wc.bind(null,e,$l,Ul),t);break}wc(e,$l,Ul);break;case 4:if(ic(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var i=31-st(r);s=1<<i,(i=t[i])>o&&(o=i),r&=~s}if(r=o,10<(r=(120>(r=Ze()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Cl(r/1960))-r)){e.timeoutHandle=ro(wc.bind(null,e,$l,Ul),r);break}wc(e,$l,Ul);break;default:throw Error(a(329))}}}return rc(e,Ze()),e.callbackNode===n?oc.bind(null,e):null}function ac(e,t){var n=Fl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=$l,$l=n,null!==t&&sc(t)),e}function sc(e){null===$l?$l=e:$l.push.apply($l,e)}function ic(e,t){for(t&=~Ll,t&=~Bl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&El))throw Error(a(327));Sc();var t=ht(e,0);if(0===(1&t))return rc(e,Ze()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=mt(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=Dl,hc(e,0),ic(e,t),rc(e,Ze()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,$l,Ul),rc(e,Ze()),null}function cc(e,t){var n=El;El|=1;try{return e(t)}finally{0===(El=n)&&(zl=Ze()+500,$o&&Uo())}}function dc(e){null!==Yl&&0===Yl.tag&&0===(6&El)&&Sc();var t=El;El|=1;var n=Il.transition,r=bt;try{if(Il.transition=null,bt=1,e)return e()}finally{bt=r,Il.transition=n,0===(6&(El=t))&&Uo()}}function uc(){Rl=Ml.current,Ao(Ml)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==_l)for(n=_l.return;null!==n;){var r=n;switch(na(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&jo();break;case 3:Za(),Ao(_o),Ao(Po),rs();break;case 5:Qa(r);break;case 4:Za();break;case 13:case 19:Ao(es);break;case 10:Ea(r.type._context);break;case 22:case 23:uc()}n=n.return}if(Pl=e,_l=e=Mc(e.current,null),Nl=Rl=t,jl=0,Dl=null,Ll=Bl=Ol=0,$l=Fl=null,null!==Ra){for(t=0;t<Ra.length;t++)if(null!==(r=(n=Ra[t]).interleaved)){n.interleaved=null;var o=r.next,a=n.pending;if(null!==a){var s=a.next;a.next=o,r.next=s}n.pending=r}Ra=null}return e}function pc(e,t){for(;;){var n=_l;try{if(Ia(),os.current=Js,ds){for(var r=is.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}ds=!1}if(ss=0,cs=ls=is=null,us=!1,hs=0,Al.current=null,null===n||null===n.return){jl=1,Dl=t,_l=null;break}e:{var s=e,i=n.return,l=n,c=t;if(t=Nl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=gi(i);if(null!==m){m.flags&=-257,yi(m,i,l,0,t),1&m.mode&&fi(s,d,t),c=d;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(c),t.updateQueue=g}else f.add(c);break e}if(0===(1&t)){fi(s,d,t),fc();break e}c=Error(a(426))}else if(aa&&1&l.mode){var y=gi(i);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),yi(y,i,l,0,t),fa(ci(c,l));break e}}s=c=ci(c,l),4!==jl&&(jl=2),null===Fl?Fl=[s]:Fl.push(s),s=i;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,za(s,pi(0,c,t));break e;case 1:l=c;var v=s.type,b=s.stateNode;if(0===(128&s.flags)&&("function"===typeof v.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Vl||!Vl.has(b)))){s.flags|=65536,t&=-t,s.lanes|=t,za(s,mi(s,l,t));break e}}s=s.return}while(null!==s)}xc(n)}catch(x){t=x,_l===n&&null!==n&&(_l=n=n.return);continue}break}}function mc(){var e=kl.current;return kl.current=Js,null===e?Js:e}function fc(){0!==jl&&3!==jl&&2!==jl||(jl=4),null===Pl||0===(268435455&Ol)&&0===(268435455&Bl)||ic(Pl,Nl)}function gc(e,t){var n=El;El|=2;var r=mc();for(Pl===e&&Nl===t||(Ul=null,hc(e,t));;)try{yc();break}catch(o){pc(e,o)}if(Ia(),El=n,kl.current=r,null!==_l)throw Error(a(261));return Pl=null,Nl=0,jl}function yc(){for(;null!==_l;)bc(_l)}function vc(){for(;null!==_l&&!Ke();)bc(_l)}function bc(e){var t=Tl(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?xc(e):_l=t,Al.current=null}function xc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Wi(n,t,Rl)))return void(_l=n)}else{if(null!==(n=Yi(n,t)))return n.flags&=32767,void(_l=n);if(null===e)return jl=6,void(_l=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(_l=t);_l=t=e}while(null!==t);0===jl&&(jl=5)}function wc(e,t,n){var r=bt,o=Il.transition;try{Il.transition=null,bt=1,function(e,t,n,r){do{Sc()}while(null!==Yl);if(0!==(6&El))throw Error(a(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-st(n),a=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~a}}(e,s),e===Pl&&(_l=Pl=null,Nl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Wl||(Wl=!0,Pc(tt,(function(){return Sc(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Il.transition,Il.transition=null;var i=bt;bt=1;var l=El;El|=4,Al.current=null,function(e,t){if(eo=Ht,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(w){n=null;break e}var i=0,l=-1,c=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==o&&3!==h.nodeType||(l=i+o),h!==s||0!==r&&3!==h.nodeType||(c=i+r),3===h.nodeType&&(i+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===o&&(l=i),p===s&&++u===r&&(c=i),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Ht=!1,Ji=t;null!==Ji;)if(e=(t=Ji).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ji=e;else for(;null!==Ji;){t=Ji;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,y=f.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:ni(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(a(163))}}catch(w){Cc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Ji=e;break}Ji=t.return}f=tl,tl=!1}(e,n),gl(n,e),mr(to),Ht=!!eo,to=eo=null,e.current=n,vl(n,e,o),Xe(),El=l,bt=i,Il.transition=s}else e.current=n;if(Wl&&(Wl=!1,Yl=e,Kl=o),s=e.pendingLanes,0===s&&(Vl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(ot,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ze()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Hl)throw Hl=!1,e=ql,ql=null,e;0!==(1&Kl)&&0!==e.tag&&Sc(),s=e.pendingLanes,0!==(1&s)?e===Zl?Xl++:(Xl=0,Zl=e):Xl=0,Uo()}(e,t,n,r)}finally{Il.transition=o,bt=r}return null}function Sc(){if(null!==Yl){var e=xt(Kl),t=Il.transition,n=bt;try{if(Il.transition=null,bt=16>e?16:e,null===Yl)var r=!1;else{if(e=Yl,Yl=null,Kl=0,0!==(6&El))throw Error(a(331));var o=El;for(El|=4,Ji=e.current;null!==Ji;){var s=Ji,i=s.child;if(0!==(16&Ji.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(Ji=d;null!==Ji;){var u=Ji;switch(u.tag){case 0:case 11:case 15:nl(8,u,s)}var h=u.child;if(null!==h)h.return=u,Ji=h;else for(;null!==Ji;){var p=(u=Ji).sibling,m=u.return;if(al(u),u===d){Ji=null;break}if(null!==p){p.return=m,Ji=p;break}Ji=m}}}var f=s.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Ji=s}}if(0!==(2064&s.subtreeFlags)&&null!==i)i.return=s,Ji=i;else e:for(;null!==Ji;){if(0!==(2048&(s=Ji).flags))switch(s.tag){case 0:case 11:case 15:nl(9,s,s.return)}var v=s.sibling;if(null!==v){v.return=s.return,Ji=v;break e}Ji=s.return}}var b=e.current;for(Ji=b;null!==Ji;){var x=(i=Ji).child;if(0!==(2064&i.subtreeFlags)&&null!==x)x.return=i,Ji=x;else e:for(i=b;null!==Ji;){if(0!==(2048&(l=Ji).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(S){Cc(l,l.return,S)}if(l===i){Ji=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Ji=w;break e}Ji=l.return}}if(El=o,Uo(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(ot,e)}catch(S){}r=!0}return r}finally{bt=n,Il.transition=t}}return!1}function Tc(e,t,n){e=$a(e,t=pi(0,t=ci(n,t),1),1),t=ec(),null!==e&&(yt(e,1,t),rc(e,t))}function Cc(e,t,n){if(3===e.tag)Tc(e,e,n);else for(;null!==t;){if(3===t.tag){Tc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Vl||!Vl.has(r))){t=$a(t,e=mi(t,e=ci(n,e),1),1),e=ec(),null!==t&&(yt(t,1,e),rc(t,e));break}}t=t.return}}function kc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Pl===e&&(Nl&n)===n&&(4===jl||3===jl&&(130023424&Nl)===Nl&&500>Ze()-Gl?hc(e,0):Ll|=n),rc(e,t)}function Ac(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=ec();null!==(e=Da(e,t))&&(yt(e,t,n),rc(e,n))}function Ic(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ac(e,n)}function Ec(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Ac(e,n)}function Pc(e,t){return We(e,t)}function _c(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nc(e,t,n,r){return new _c(e,t,n,r)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mc(e,t){var n=e.alternate;return null===n?((n=Nc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function jc(e,t,n,r,o,s){var i=2;if(r=e,"function"===typeof e)Rc(e)&&(i=1);else if("string"===typeof e)i=5;else e:switch(e){case T:return Dc(n.children,o,s,t);case C:i=8,o|=8;break;case k:return(e=Nc(12,n,t,2|o)).elementType=k,e.lanes=s,e;case P:return(e=Nc(13,n,t,o)).elementType=P,e.lanes=s,e;case _:return(e=Nc(19,n,t,o)).elementType=_,e.lanes=s,e;case M:return Oc(n,o,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:i=10;break e;case I:i=9;break e;case E:i=11;break e;case N:i=14;break e;case R:i=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Nc(i,n,t,o)).elementType=e,t.type=r,t.lanes=s,t}function Dc(e,t,n,r){return(e=Nc(7,e,r,t)).lanes=n,e}function Oc(e,t,n,r){return(e=Nc(22,e,r,t)).elementType=M,e.lanes=n,e.stateNode={isHidden:!1},e}function Bc(e,t,n){return(e=Nc(6,e,null,t)).lanes=n,e}function Lc(e,t,n){return(t=Nc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fc(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function $c(e,t,n,r,o,a,s,i,l){return e=new Fc(e,t,n,i,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Nc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ba(a),e}function Gc(e){if(!e)return Eo;e:{if(ze(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Mo(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Mo(n))return Oo(e,n,t)}return t}function zc(e,t,n,r,o,a,s,i,l){return(e=$c(n,r,!0,e,0,a,0,i,l)).context=Gc(null),n=e.current,(a=Fa(r=ec(),o=tc(n))).callback=void 0!==t&&null!==t?t:null,$a(n,a,o),e.current.lanes=o,yt(e,o,r),rc(e,r),e}function Uc(e,t,n,r){var o=t.current,a=ec(),s=tc(o);return n=Gc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fa(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=$a(o,t,s))&&(nc(e,o,s,a),Ga(e,o,s)),s}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Vc(e,t){qc(e,t),(e=e.alternate)&&qc(e,t)}Tl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||_o.current)bi=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bi=!1,function(e,t,n){switch(t.tag){case 3:Pi(t),ma();break;case 5:Ja(t);break;case 1:Mo(t.type)&&Bo(t);break;case 4:Xa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Io(Ta,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Io(es,1&es.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Bi(e,t,n):(Io(es,1&es.current),null!==(e=Hi(e,t,n))?e.sibling:null);Io(es,1&es.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return zi(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),Io(es,es.current),r)break;return null;case 22:case 23:return t.lanes=0,Ci(e,t,n)}return Hi(e,t,n)}(e,t,n);bi=0!==(131072&e.flags)}else bi=!1,aa&&0!==(1048576&t.flags)&&ea(t,Wo,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ui(e,t),e=t.pendingProps;var o=Ro(t,Po.current);_a(t,n),o=gs(null,t,r,e,o,n);var s=ys();return t.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Mo(r)?(s=!0,Bo(t)):s=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Ba(t),o.updater=oi,t.stateNode=o,o._reactInternals=t,li(t,r,e,n),t=Ei(null,t,r,!0,s,n)):(t.tag=0,aa&&s&&ta(t),xi(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ui(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===N)return 14}return 2}(r),e=ni(r,e),o){case 0:t=Ai(null,t,r,e,n);break e;case 1:t=Ii(null,t,r,e,n);break e;case 11:t=wi(null,t,r,e,n);break e;case 14:t=Si(null,t,r,ni(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,Ai(e,t,r,o=t.elementType===r?o:ni(r,o),n);case 1:return r=t.type,o=t.pendingProps,Ii(e,t,r,o=t.elementType===r?o:ni(r,o),n);case 3:e:{if(Pi(t),null===e)throw Error(a(387));r=t.pendingProps,o=(s=t.memoizedState).element,La(e,t),Ua(t,r,null,n);var i=t.memoizedState;if(r=i.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=_i(e,t,r,n,o=ci(Error(a(423)),t));break e}if(r!==o){t=_i(e,t,r,n,o=ci(Error(a(424)),t));break e}for(oa=co(t.stateNode.containerInfo.firstChild),ra=t,aa=!0,sa=null,n=Sa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ma(),r===o){t=Hi(e,t,n);break e}xi(e,t,r,n)}t=t.child}return t;case 5:return Ja(t),null===e&&da(t),r=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,i=o.children,no(r,o)?i=null:null!==s&&no(r,s)&&(t.flags|=32),ki(e,t),xi(e,t,i,n),t.child;case 6:return null===e&&da(t),null;case 13:return Bi(e,t,n);case 4:return Xa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=wa(t,null,r,n):xi(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,wi(e,t,r,o=t.elementType===r?o:ni(r,o),n);case 7:return xi(e,t,t.pendingProps,n),t.child;case 8:case 12:return xi(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,s=t.memoizedProps,i=o.value,Io(Ta,r._currentValue),r._currentValue=i,null!==s)if(ir(s.value,i)){if(s.children===o.children&&!_o.current){t=Hi(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){i=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=Fa(-1,n&-n)).tag=2;var d=s.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Pa(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)i=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(i=s.return))throw Error(a(341));i.lanes|=n,null!==(l=i.alternate)&&(l.lanes|=n),Pa(i,n,t),i=s.sibling}else i=s.child;if(null!==i)i.return=s;else for(i=s;null!==i;){if(i===t){i=null;break}if(null!==(s=i.sibling)){s.return=i.return,i=s;break}i=i.return}s=i}xi(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,_a(t,n),r=r(o=Na(o)),t.flags|=1,xi(e,t,r,n),t.child;case 14:return o=ni(r=t.type,t.pendingProps),Si(e,t,r,o=ni(r.type,o),n);case 15:return Ti(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ni(r,o),Ui(e,t),t.tag=1,Mo(r)?(e=!0,Bo(t)):e=!1,_a(t,n),si(t,r,o),li(t,r,o,n),Ei(null,t,r,!0,e,n);case 19:return zi(e,t,n);case 22:return Ci(e,t,n)}throw Error(a(156,t.tag))};var Wc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Qc(e,t,n,r,o){var a=n._reactRootContainer;if(a){var s=a;if("function"===typeof o){var i=o;o=function(){var e=Hc(s);i.call(e)}}Uc(t,s,e,o)}else s=function(e,t,n,r,o){if(o){if("function"===typeof r){var a=r;r=function(){var e=Hc(s);a.call(e)}}var s=zc(t,r,e,0,null,!1,0,"",Jc);return e._reactRootContainer=s,e[fo]=s.current,zr(8===e.nodeType?e.parentNode:e),dc(),s}for(;o=e.lastChild;)e.removeChild(o);if("function"===typeof r){var i=r;r=function(){var e=Hc(l);i.call(e)}}var l=$c(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fo]=l.current,zr(8===e.nodeType?e.parentNode:e),dc((function(){Uc(t,l,n,r)})),l}(n,t,e,o,r);return Hc(s)}Kc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Uc(e,t,null,null)},Kc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Uc(null,e,null,null)})),t[fo]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ct();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Mt.length&&0!==t&&t<Mt[n].priority;n++);Mt.splice(n,0,e),0===n&&Bt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(vt(t,1|n),rc(t,Ze()),0===(6&El)&&(zl=Ze()+500,Uo()))}break;case 13:dc((function(){var t=Da(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),Vc(e,1)}},St=function(e){if(13===e.tag){var t=Da(e,134217728);if(null!==t)nc(t,e,134217728,ec());Vc(e,134217728)}},Tt=function(e){if(13===e.tag){var t=tc(e),n=Da(e,t);if(null!==n)nc(n,e,t,ec());Vc(e,t)}},Ct=function(){return bt},kt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Se=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=So(r);if(!o)throw Error(a(90));W(r),J(r,o)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=cc,Pe=dc;var ed={usingClientEntryPoint:!1,Events:[xo,wo,So,Ae,Ie,cc]},td={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nd={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rd.isDisabled&&rd.supportsFiber)try{ot=rd.inject(nd),at=rd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xc(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xc(e))throw Error(a(299));var n=!1,r="",o=Wc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=$c(e,1,!1,null,0,n,0,r,o),e[fo]=t.current,zr(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Zc(t))throw Error(a(200));return Qc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xc(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,o=!1,s="",i=Wc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(i=n.onRecoverableError)),t=zc(t,null,e,1,null!=n?n:null,o,0,s,i),e[fo]=t.current,zr(e),r)for(e=0;e<r.length;e++)o=(o=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Kc(t)},t.render=function(e,t,n){if(!Zc(t))throw Error(a(200));return Qc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(a(40));return!!e._reactRootContainer&&(dc((function(){Qc(null,null,e,!1,(function(){e._reactRootContainer=null,e[fo]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Qc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},2816:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!==e}},2908:(e,t,n)=>{"use strict";var r=n(2129),o=n(639),a=n(9108);e.exports={formats:a,parse:o,stringify:r}},3094:e=>{"use strict";e.exports=URIError},3287:(e,t,n)=>{"use strict";n.d(t,{handleConstruction:()=>p,q:()=>h});n(3488);var r=n(5701),o=n(1593),a=(n(7605),n(6894)),s=n(3295),i=n(2667),l=n(1431),c=n(819),d=n(5823),u=n(4255);const h=async e=>{if(e.modifiedRecipe){const t=e.buildOptions.map((t=>t.type===e.modifiedRecipe.type?e.modifiedRecipe:t));return p({...e,buildOptions:t})}return p(e)},p=async e=>{let{TILE_SIZE:t,selectedItem:n,buildOptions:h,inventory:p,setInventory:m,backpack:f,setBackpack:g,resources:y,setResources:v,currentPlayer:b,setCurrentPlayer:x,gridId:w,updateStatus:S,overridePosition:T,globalTuning:C,masterResources:k}=e;if(!b)return console.warn("Current Player not provided; inventory changes will not be saved."),!1;if(!n)return console.warn("Invalid building selection."),!1;const A=b._id.toString(),I=l.default.getPlayersInGrid(w),E=null===I||void 0===I?void 0:I[A],P=null===E||void 0===E?void 0:E.position;let _,N;if(T)_=T.x,N=T.y;else{const e=(0,c.fE)(w,b);if(!e)return!1;_=e.tileX,N=e.tileY}if(console.log("playerPosition = ",P),console.log("x = ",_," y = ",N),!P||null==_||null==N)return console.warn("Player position is invalid."),!1;const R=h.find((e=>e.type===n)),M=R.size||1;if(console.log(`\ud83c\udfd7\ufe0f Building ${n} with size ${M}`),"npc"!==R.category){const e=[];for(let t=0;t<M;t++)for(let n=0;n<M;n++)e.push({x:_+t,y:N-n});console.log("\ud83d\udccd Tiles to check for placement:",e);const r=e.find((e=>y.some((t=>t.x===e.x&&t.y===e.y))));if(r)return console.warn(`Cannot build ${n} - tile at (${r.x}, ${r.y}) is occupied.`),a.A.addFloatingText(306,_,N,t),!1}if(C){var j;if(R.passable&&"graze"===R.action){const e=C.maxFarmAnimals||10,r=i.Ay.getNPCsInGrid(w);if((r?Object.values(r).filter((e=>"graze"===e.action)).length:0)>=e)return console.warn(`Cannot buy ${n} - farm animal limit (${e}) reached.`),a.A.addFloatingText(407,_,N,t),!1}if("BuildTown"===R.source&&"homestead"!==(null===b||void 0===b||null===(j=b.location)||void 0===j?void 0:j.gtype)&&k){const e=C.maxTownBuildings||500;if(y.filter((e=>{const t=k.find((t=>t.type===e.type));return"BuildTown"===(null===t||void 0===t?void 0:t.source)})).length>=e)return console.warn(`Cannot build ${n} - town building limit (${e}) reached.`),a.A.addFloatingText(407,_,N,t),!1}}if(!await(0,r.dw)({playerId:b.playerId,recipe:R,inventory:p,backpack:f,setInventory:m,setBackpack:g,setCurrentPlayer:x,updateStatus:S}))return a.A.addFloatingText(305,P.x,P.y,t),!1;console.log("selectedResource.action=",R.action);const D=[];for(let r=1;r<=4;r++){const e=R[`ingredient${r}`],t=R[`ingredient${r}qty`];e&&t&&D.push(`${t} ${e}`)}const O=D.length>0?D.join(", "):"free";if("npc"===R.category){const e=T?{x:_,y:N}:P;i.Ay.spawnNPC(w,R,e),console.log("Spawned NPC:",w,R,e),(0,u.MV)(_,N,t),a.A.addFloatingText(300,_,N,t),S(`${R.type} purchased for ${O}.`),await(0,s.D)(b,"Buy",R.type,1,x)}else{console.log("Placing resource on the grid:",n);const e=y.find((e=>e.x===_&&e.y===N));console.log("\ud83d\udd0d Existing resource at location before setResources:",e);const r={type:n,x:_,y:N},i=(0,c.if)(r,h);M>1&&(i.size=M,i.anchorKey=`${n}_${_}_${N}`);let l=[...y,i];console.log("\ud83d\udce6 Preparing resource update with:",i);try{if(M>1)for(let e=0;e<M;e++)for(let t=0;t<M;t++){if(0===e&&0===t)continue;const n={type:"shadow",x:_+e,y:N-t,parentAnchorKey:i.anchorKey,passable:i.passable};l.push(n)}return console.log("\ud83e\uddea Updating local state with all resources"),d.default.setResources(l),v(l),await(0,o.mQ)(w,r,!0),(0,u.MV)(_,N,t),a.A.addFloatingText(300,P.x,P.y,t),S(`${n} purchased for ${O}.`),await(0,s.D)(b,"Build",n,1,x),await(0,s.D)(b,"Buy",n,1,x),!0}catch(B){return console.error("Error placing resource on grid:",B),!1}}return!0}},3295:(e,t,n)=>{"use strict";n.d(t,{D:()=>a});var r=n(3488),o=n(6213);async function a(e,t,n,a,s){var i;if(null===e||void 0===e||null===(i=e.activeQuests)||void 0===i||!i.length)return;console.log("At trackQuestProgress; action = ",t);let l=!1;const c=e.activeQuests.map((e=>{if(e.completed||e.rewardCollected)return e;const r={...e.progress};let o=0,s=0;for(let i=1;i<=3;i++){const l=e[`goal${i}action`],c=e[`goal${i}item`],d=e[`goal${i}qty`];l&&c&&d&&(s++,l===t&&c===n&&(r[`goal${i}`]=Math.min((r[`goal${i}`]||0)+a,d)),r[`goal${i}`]>=d&&o++)}return o===s&&s>0&&(e.completed=!0),e.progress=r,l=!0,e}));if(l)try{console.log("Saving updated player quests; updatedQuests = ",c);const t=await o.A.post(`${r.A}/api/update-player-quests`,{playerId:e.playerId,activeQuests:c});"function"===typeof s&&s((e=>({...e,activeQuests:t.data.player.activeQuests||c})))}catch(d){console.error("Error updating quest progress:",d)}}},3488:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_STRIPE_PUBLISHABLE_KEY:"pk_live_51ReZDs2Ldypb8mDE69ZKUaxZ5aUTW9PCLZUg8JPNmQmefLd4c8jy44ryZ19UZhsMVqOi7DU3RJ9qGdN5a5K2aOP2000ulybBFt"}.REACT_APP_SERVER_URL||"http://localhost:3001"},3701:e=>{"use strict";e.exports=Math.abs},3864:(e,t,n)=>{"use strict";var r=n(7724);e.exports=Function.prototype.bind||r},4080:(e,t,n)=>{"use strict";var r=n(1907);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(l),d=["%","/","?",";","#"].concat(c),u=["/","?","#"],h=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=n(2908);function v(e,t,n){if(e&&"object"===typeof e&&e instanceof o)return e;var r=new o;return r.parse(e,t,n),r}o.prototype.parse=function(e,t,n){if("string"!==typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",l=e.split(s);l[0]=l[0].replace(/\\/g,"/");var v=e=l.join(s);if(v=v.trim(),!n&&1===e.split("#").length){var b=i.exec(v);if(b)return this.path=v,this.href=v,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var x=a.exec(v);if(x){var w=(x=x[0]).toLowerCase();this.protocol=w,v=v.substr(x.length)}if(n||x||v.match(/^\/\/[^@/]+@[^@/]+/)){var S="//"===v.substr(0,2);!S||x&&f[x]||(v=v.substr(2),this.slashes=!0)}if(!f[x]&&(S||x&&!g[x])){for(var T,C,k=-1,A=0;A<u.length;A++){-1!==(I=v.indexOf(u[A]))&&(-1===k||I<k)&&(k=I)}-1!==(C=-1===k?v.lastIndexOf("@"):v.lastIndexOf("@",k))&&(T=v.slice(0,C),v=v.slice(C+1),this.auth=decodeURIComponent(T)),k=-1;for(A=0;A<d.length;A++){var I;-1!==(I=v.indexOf(d[A]))&&(-1===k||I<k)&&(k=I)}-1===k&&(k=v.length),this.host=v.slice(0,k),v=v.slice(k),this.parseHost(),this.hostname=this.hostname||"";var E="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!E)for(var P=this.hostname.split(/\./),_=(A=0,P.length);A<_;A++){var N=P[A];if(N&&!N.match(h)){for(var R="",M=0,j=N.length;M<j;M++)N.charCodeAt(M)>127?R+="x":R+=N[M];if(!R.match(h)){var D=P.slice(0,A),O=P.slice(A+1),B=N.match(p);B&&(D.push(B[1]),O.unshift(B[2])),O.length&&(v="/"+O.join(".")+v),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),E||(this.hostname=r.toASCII(this.hostname));var L=this.port?":"+this.port:"",F=this.hostname||"";this.host=F+L,this.href+=this.host,E&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==v[0]&&(v="/"+v))}if(!m[w])for(A=0,_=c.length;A<_;A++){var $=c[A];if(-1!==v.indexOf($)){var G=encodeURIComponent($);G===$&&(G=escape($)),v=v.split($).join(G)}}var z=v.indexOf("#");-1!==z&&(this.hash=v.substr(z),v=v.slice(0,z));var U=v.indexOf("?");if(-1!==U?(this.search=v.substr(U),this.query=v.substr(U+1),t&&(this.query=y.parse(this.query)),v=v.slice(0,U)):t&&(this.search="",this.query={}),v&&(this.pathname=v),g[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){L=this.pathname||"";var H=this.search||"";this.path=L+H}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&"object"===typeof this.query&&Object.keys(this.query).length&&(a=y.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||g[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(s=s.replace("#","%23"))+r},o.prototype.resolve=function(e){return this.resolveObject(v(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if("string"===typeof e){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,r=Object.keys(this),a=0;a<r.length;a++){var s=r[a];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var i=Object.keys(e),l=0;l<i.length;l++){var c=i[l];"protocol"!==c&&(n[c]=e[c])}return g[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!g[e.protocol]){for(var d=Object.keys(e),u=0;u<d.length;u++){var h=d[u];n[h]=e[h]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||f[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",y=n.search||"";n.path=m+y}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),x=b||v||n.host&&e.pathname,w=x,S=n.pathname&&n.pathname.split("/")||[],T=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!g[n.protocol]);if(T&&(n.hostname="",n.port=null,n.host&&(""===S[0]?S[0]=n.host:S.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),x=x&&(""===p[0]||""===S[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,S=p;else if(p.length)S||(S=[]),S.pop(),S=S.concat(p),n.search=e.search,n.query=e.query;else if(null!=e.search){if(T)n.host=S.shift(),n.hostname=n.host,(E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=E.shift(),n.hostname=E.shift(),n.host=n.hostname);return n.search=e.search,n.query=e.query,null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!S.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var C=S.slice(-1)[0],k=(n.host||e.host||S.length>1)&&("."===C||".."===C)||""===C,A=0,I=S.length;I>=0;I--)"."===(C=S[I])?S.splice(I,1):".."===C?(S.splice(I,1),A++):A&&(S.splice(I,1),A--);if(!x&&!w)for(;A--;A)S.unshift("..");!x||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),k&&"/"!==S.join("/").substr(-1)&&S.push("");var E,P=""===S[0]||S[0]&&"/"===S[0].charAt(0);T&&(n.hostname=P?"":S.length?S.shift():"",n.host=n.hostname,(E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=E.shift(),n.hostname=E.shift(),n.host=n.hostname));return(x=x||n.host&&S.length)&&!P&&S.unshift(""),S.length>0?n.pathname=S.join("/"):(n.pathname=null,n.path=null),null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.qg=v,t.hd=function(e,t){return v(e,!1,!0).resolve(t)},t.GP=function(e){return"string"===typeof e&&(e=v(e)),e instanceof o?e.format():o.prototype.format.call(e)}},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var x=b.prototype=new v;x.constructor=b,f(x,y.prototype),x.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,r){var o,a={},s=null,i=null;if(null!=t)for(o in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(s=""+t.key),t)S.call(t,o)&&!C.hasOwnProperty(o)&&(a[o]=t[o]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(o in l=e.defaultProps)void 0===a[o]&&(a[o]=l[o]);return{$$typeof:n,type:e,key:s,ref:i,props:a,_owner:T.current}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,o,a,s){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var l=!1;if(null===e)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===a?"."+E(l,0):a,w(s)?(o="",null!=e&&(o=e.replace(I,"$&/")+"/"),P(s,t,o,"",(function(e){return e}))):null!=s&&(A(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,o+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(I,"$&/")+"/")+e)),t.push(s)),1;if(l=0,a=""===a?".":a+":",w(e))for(var c=0;c<e.length;c++){var d=a+E(i=e[c],c);l+=P(i,t,o,d,s)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(i=e.next()).done;)l+=P(i=i.value,t,o,d=a+E(i,c++),s);else if("object"===i)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function _(e,t,n){if(null==e)return e;var r=[],o=0;return P(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function N(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},M={transition:null},j={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:M,ReactCurrentOwner:T};function D(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:_,forEach:function(e,t,n){_(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return _(e,(function(){t++})),t},toArray:function(e){return _(e,(function(e){return e}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=o,t.Profiler=s,t.PureComponent=b,t.StrictMode=a,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j,t.act=D,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=f({},e.props),a=e.key,s=e.ref,i=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,i=T.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!C.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];o.children=l}return{$$typeof:n,type:e.type,key:a,ref:s,props:o,_owner:i}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:i,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=D,t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.3.1"},4255:(e,t,n)=>{"use strict";n.d(t,{En:()=>g,MV:()=>m,TL:()=>f,d9:()=>u,il:()=>p,pU:()=>h,t7:()=>d});const r=500,o=1e3,a=1500,s=new Map,i=new Set;let l=0,c=null;const d=e=>{c=e},u=(e,t)=>i.has(`${e},${t}`),h=()=>l,p=(e,t,n)=>({centerX:e*n+n/2-6,centerY:t*n+n/2-6}),m=(e,t,n)=>{const o=document.querySelector(".homestead");if(!o)return;const a=`collect-${e}-${t}`,i=Date.now(),l=s.get(a);if(l&&i-l<100)return void console.log("Skipping duplicate collect effect at",e,t);s.set(a,i),setTimeout((()=>{s.delete(a)}),1e3);const c=o.querySelectorAll(".tile");let d,u,h=null;if(c.forEach((r=>{const o=parseInt(r.style.top)/n,a=parseInt(r.style.left)/n;Math.round(a)===e&&Math.round(o)===t&&(h=r)})),h){const e=h.getBoundingClientRect(),t=o.getBoundingClientRect();d=e.left-t.left+e.width/2-6,u=e.top-t.top+e.height/2-6}else{const{centerX:r,centerY:o}=p(e,t,n);d=r,u=o}console.log("createCollectEffect at grid(",e,",",t,") -> screen(",d,",",u,")");[{dx:-1,dy:-1,startX:-2,startY:-2},{dx:1,dy:-1,startX:2,startY:-2},{dx:-1,dy:1,startX:-2,startY:2},{dx:1,dy:1,startX:2,startY:2}].forEach((e=>{const t=((e,t,n)=>{const r=document.createElement("div");return r.innerText=e,r.style.position="absolute",r.style.left=`${t}px`,r.style.top=`${n}px`,r.style.pointerEvents="none",r.style.zIndex="1000",r.style.fontSize="12px",r})("\ud83d\udca8",d+e.startX,u+e.startY);o.appendChild(t),t.style.transition="all 0.5s ease-out",requestAnimationFrame((()=>{t.style.transform=`translate(${20*e.dx}px, ${20*e.dy}px)`,t.style.opacity="0"})),setTimeout((()=>{o.removeChild(t)}),r)}))},f=(e,t,n,r)=>{const a=document.querySelector(".homestead");if(!a)return;console.log("createSourceConversionEffect called with x:",e,"y:",t,"requiredSkill:",r);const s=null!==r&&void 0!==r&&r.includes("Axe")?"\ud83e\ude93":null!==r&&void 0!==r&&r.includes("Pickaxe")?"\u26cf\ufe0f":null!==r&&void 0!==r&&r.includes("Golden Key")?"\ud83d\udd11":null!==r&&void 0!==r&&r.includes("Skeleton Key")?"\ud83d\udddd\ufe0f":"\ud83d\udcab",{centerX:i,centerY:l}=p(e,t,n),c=document.createElement("div");c.innerText=s,c.style.position="absolute",c.style.left=i-n/2+5+"px",c.style.top=l-n/2-4+"px",c.style.pointerEvents="none",c.style.zIndex="1000",c.style.fontSize="28px",a.appendChild(c),c.style.transition=`all ${o}ms cubic-bezier(0.2, 0, 0, 1)`,requestAnimationFrame((()=>{c.style.transform=`translate(-${n}px, ${n}px)`,c.style.opacity="0"})),setTimeout((()=>{a.removeChild(c)}),o)},g=function(e,t,n,r,o){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const d=document.querySelector(".homestead");if(!d)return;const u=`${e},${t}`;i.add(u);const h=.7*n,p=document.createElement("div");if(p.style.position="absolute",p.style.pointerEvents="none",p.style.zIndex="1001",p.style.transition=`transform ${a}ms ease-out`,s){const r=e*n,o=t*n;p.style.left=`${r}px`,p.style.top=`${o}px`,p.style.width=`${n}px`,p.style.height=`${n}px`,p.style.transformOrigin="center center",p.style.transform="scale(0.02)";const a=document.createElement("img");a.src=`/assets/resources/${s}`,a.alt="",a.style.width="100%",a.style.height="100%",p.appendChild(a)}else{const o=e*n+n/2,a=t*n+n/2-.02*n;p.style.left=`${o}px`,p.style.top=`${a}px`,p.style.transform="translate(-50%, -50%) scale(0.02)",p.innerText=r,p.style.fontSize=`${h}px`}d.appendChild(p),requestAnimationFrame((()=>{p.style.transform=s?"scale(1)":"translate(-50%, -50%) scale(1)"})),setTimeout((()=>{p.parentNode&&d.removeChild(p),i.delete(u),l++,c&&c(),o&&o()}),a)}},4384:(e,t,n)=>{"use strict";var r=Function.prototype.call,o=Object.prototype.hasOwnProperty,a=n(3864);e.exports=a.call(r,o)},4391:(e,t,n)=>{"use strict";var r=n(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4450:(e,t,n)=>{"use strict";n.d(t,{d:()=>i,e:()=>s});var r=n(5043),o=n(579);const a=(0,r.createContext)(),s=e=>{let{children:t}=e;const[n,s]=(0,r.useState)(null),i=()=>{s(null)};return(0,o.jsx)(a.Provider,{value:{activePanel:n,openPanel:e=>{s(e)},closePanel:i,closeAllPanels:i},children:t})},i=()=>(0,r.useContext)(a)},4517:(e,t,n)=>{"use strict";n.d(t,{d:()=>o});var r=n(9106);function o(e,t,n,o){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,s=0;const i=t.x*o,l=t.y*o,c=n.x*o,d=n.y*o;!function t(){if(s>=a)return void delete r.ZH[e];const n=i+(c-i)/a*s,u=l+(d-l)/a*s;r.ZH[e]={x:n/o,y:u/o},s++,requestAnimationFrame(t)}()}},4590:e=>{"use strict";e.exports="undefined"!==typeof Reflect&&Reflect&&Reflect.apply},4591:e=>{"use strict";e.exports=Math.max},4781:(e,t,n)=>{"use strict";var r=n(3864),o=n(4902),a=n(4937),s=n(5747);e.exports=function(e){if(e.length<1||"function"!==typeof e[0])throw new o("a function is required");return s(r,a,e)}},4876:(e,t,n)=>{"use strict";n.d(t,{p:()=>h,D:()=>p});var r=n(5043),o=n(4391),a=n(7037),s=n(579);let i=null,l=null,c={};const d=["To Do","FTUE","Message"];function u(e){let{type:t,data:n,onDismiss:o,onClick:i}=e;const l=(0,a.k)();r.useEffect((()=>()=>{}),[]),r.useEffect((()=>{if(!d.includes(t)){const e=setTimeout((()=>{o()}),5e3);return()=>{clearTimeout(e)}}}),[t]);const c="notification "+(d.includes(t)?"notification-persistent":"");return(0,s.jsxs)("div",{className:c,onClick:i,style:{cursor:i?"pointer":"default"},children:[(0,s.jsx)("button",{className:"notification-dismiss",onClick:e=>{e.stopPropagation(),o()},children:"\xd7"}),(0,s.jsx)("div",{className:"notification-content",children:(()=>{switch(t){case"Trophy":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"notification-icon-wrapper",children:[(0,s.jsx)("div",{className:"notification-icon",children:n.icon||"\ud83c\udfc6"}),"Progress"===n.type&&n.progress&&(0,s.jsx)("div",{className:"notification-milestone",children:n.progress}),"Count"===n.type&&n.qty&&(0,s.jsxs)("div",{className:"notification-milestone",children:[n.qty,"x"]})]}),(0,s.jsxs)("div",{className:"notification-text",children:[(0,s.jsx)("div",{className:"notification-title",children:l[6003]}),(0,s.jsx)("div",{className:"notification-name",children:n.name})]})]});case"Phase Change":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"notification-icon-wrapper",children:(0,s.jsx)("div",{className:"notification-icon",children:n.icon||"\ud83c\udf19"})}),(0,s.jsxs)("div",{className:"notification-text",children:[(0,s.jsx)("div",{className:"notification-title",children:"Phase Change"}),(0,s.jsx)("div",{className:"notification-name",children:n.message||"Day has turned to night"})]})]});case"Message":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"notification-icon-wrapper",children:(0,s.jsx)("div",{className:"notification-icon",children:n.icon||"\ud83d\udce8"})}),(0,s.jsxs)("div",{className:"notification-text",children:[(0,s.jsx)("div",{className:"notification-title",children:n.title||"New Message"}),(0,s.jsx)("div",{className:"notification-name",children:n.message})]})]});case"To Do":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"notification-icon-wrapper",children:(0,s.jsx)("div",{className:"notification-icon",children:n.icon||"\u2705"})}),(0,s.jsxs)("div",{className:"notification-text",children:[(0,s.jsx)("div",{className:"notification-title",children:n.title||l[204]}),(0,s.jsx)("div",{className:"notification-name",children:n.message})]})]});case"Tip":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"notification-icon-wrapper",children:(0,s.jsx)("div",{className:"notification-icon",children:n.icon||"\u2139\ufe0f"})}),(0,s.jsxs)("div",{className:"notification-text",children:[(0,s.jsx)("div",{className:"notification-title",children:n.title||l[7001]}),(0,s.jsx)("div",{className:"notification-name",children:n.message})]})]});case"Travel":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"notification-icon-wrapper",children:(0,s.jsx)("div",{className:"notification-icon",children:n.icon||"\ud83d\udc78"})}),(0,s.jsxs)("div",{className:"notification-text",children:[(0,s.jsx)("div",{className:"notification-title",children:n.title||l[7001]}),(0,s.jsx)("div",{className:"notification-name",children:n.message})]})]});case"FTUE":return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"notification-icon-wrapper",children:(0,s.jsx)("div",{className:"notification-icon",children:n.icon||"\u2139\ufe0f"})}),(0,s.jsxs)("div",{className:"notification-text",children:[(0,s.jsx)("div",{className:"notification-title",children:n.title||l[7049]}),(0,s.jsx)("div",{className:"notification-name",children:n.message})]})]});default:return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"notification-icon-wrapper",children:(0,s.jsx)("div",{className:"notification-icon",children:n.icon||"\u2139\ufe0f"})}),(0,s.jsxs)("div",{className:"notification-text",children:[(0,s.jsx)("div",{className:"notification-title",children:"Notification"}),(0,s.jsx)("div",{className:"notification-name",children:n.message||"Something happened!"})]})]})}})()})]})}function h(e,t){c[e]=t}function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log(`[showNotification] Called with type: ${e}`,t),l&&clearTimeout(l);let r=document.getElementById("notification-container");if(!r){r=document.createElement("div"),r.id="notification-container";(document.querySelector(".game-container")||document.querySelector(".App")||document.body).appendChild(r)}i||(i=o.createRoot(r));const a=n||(c[e]?()=>c[e](t):null),d=`${e}-${Date.now()}`;i.render((0,s.jsx)(u,{type:e,data:t,onDismiss:()=>{console.log(`[handleDismiss] Dismissing notification of type: ${e}`),i&&i.render(null)},onClick:a},d))}},4902:e=>{"use strict";e.exports=TypeError},4937:e=>{"use strict";e.exports=Function.prototype.call},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5061:e=>{"use strict";e.exports=Function.prototype.apply},5077:e=>{"use strict";e.exports=ReferenceError},5322:(e,t,n)=>{"use strict";var r=n(2),o=n(8117),a=n(8206),s=n(7858),i=n(4902),l=r("%WeakMap%",!0),c=o("WeakMap.prototype.get",!0),d=o("WeakMap.prototype.set",!0),u=o("WeakMap.prototype.has",!0),h=o("WeakMap.prototype.delete",!0);e.exports=l?function(){var e,t,n={assert:function(e){if(!n.has(e))throw new i("Side channel does not contain "+a(e))},delete:function(n){if(l&&n&&("object"===typeof n||"function"===typeof n)){if(e)return h(e,n)}else if(s&&t)return t.delete(n);return!1},get:function(n){return l&&n&&("object"===typeof n||"function"===typeof n)&&e?c(e,n):t&&t.get(n)},has:function(n){return l&&n&&("object"===typeof n||"function"===typeof n)&&e?u(e,n):!!t&&t.has(n)},set:function(n,r){l&&n&&("object"===typeof n||"function"===typeof n)?(e||(e=new l),d(e,n,r)):s&&(t||(t=s()),t.set(n,r))}};return n}:s},5364:(e,t,n)=>{"use strict";n.d(t,{LQ:()=>s,aA:()=>c,p:()=>l,s1:()=>d});var r=n(6213),o=n(3488),a=n(8146);const s=async(e,t,n,r)=>{if(null===n||void 0===n||!n.firsttimeuser)return(null===n||void 0===n?void 0:n.ftuestep)||0;const o=(0,a.G9)().find((t=>t.trigger===e));if(!o)return console.log(`\ud83c\udf93 No FTUE step found with trigger: ${e}`),(null===n||void 0===n?void 0:n.ftuestep)||0;const s=(null===n||void 0===n?void 0:n.ftuestep)||0,l=o.step-1;return s!==l?(console.log(`\ud83c\udf93 Trigger "${e}" requires step ${l}, but player is at step ${s}. Skipping.`),s):(console.log(`\ud83c\udf93 Trigger "${e}" matched! Advancing from step ${s} to ${o.step}`),i(t,n,r))},i=async(e,t,n)=>{try{const s=(null===t||void 0===t?void 0:t.ftuestep)||0,i=s+1;if(!(0,a.G9)().some((e=>e.step===i)))return console.log("\ud83d\udcda No more FTUE steps available after step",s),s;return(await r.A.post(`${o.A}/api/update-profile`,{playerId:e,updates:{ftuestep:i}})).data.success?(n((e=>({...e,ftuestep:i}))),console.log("\u2705 FTUE step incremented to:",i),i):s}catch(s){return console.error("Error incrementing FTUE step:",s),(null===t||void 0===t?void 0:t.ftuestep)||0}},l=async(e,t,n,a)=>{try{const s=await r.A.get(`${o.A}/api/quests`),i=(s.data||[]).find((e=>e.index===a));if(!i)return console.error(`\u274c Quest template not found for index: ${a}`),t;const l={questId:i.title,startTime:Date.now(),symbol:i.symbol||"\u2753",progress:{goal1:0,goal2:0,goal3:0},completed:!1,rewardCollected:!1,goal1action:i.goal1action||null,goal1item:i.goal1item||null,goal1qty:i.goal1qty||null,goal2action:i.goal2action||null,goal2item:i.goal2item||null,goal2qty:i.goal2qty||null,goal3action:i.goal3action||null,goal3item:i.goal3item||null,goal3qty:i.goal3qty||null},c=(null===t||void 0===t?void 0:t.activeQuests)||[];if(c.some((e=>e.questId===i.title)))return console.log(`\ud83d\udcda Quest "${i.title}" already exists in active quests`),t;const d=[...c,l];if((await r.A.post(`${o.A}/api/update-profile`,{playerId:e,updates:{activeQuests:d}})).data.success){const e={...t,activeQuests:d};return n(e),console.log(`\u2705 Quest "${i.title}" added to active quests`),e}return t}catch(s){return console.error("Error adding accepted quest:",s),t}},c=async(e,t,n,a)=>{try{const s=(null===t||void 0===t?void 0:t.activeQuests)||[],i=s.some((e=>"Find the Wizard in the Valley"===e.questId));let c=s;if(i)console.log("\ud83c\udf93 Wizard quest already exists, skipping addition");else{console.log("\ud83c\udf93 Adding completed Wizard quest before completing tutorial");const a=await l(e,t,n,1);if(a.activeQuests&&a.activeQuests.length>0){const t=a.activeQuests.findIndex((e=>"Find the Wizard in the Valley"===e.questId));-1!==t&&(a.activeQuests[t].completed=!0,c=a.activeQuests,await r.A.post(`${o.A}/api/update-profile`,{playerId:e,updates:{activeQuests:c}}))}}(await r.A.post(`${o.A}/api/update-profile`,{playerId:e,updates:{firsttimeuser:!1,ftuestep:null}})).data.success&&(n((e=>{const t={...e,firsttimeuser:!1,activeQuests:c};return delete t.ftuestep,t})),a&&a())}catch(s){console.error("Error completing tutorial:",s),a&&a()}},d=async(e,t,n,a,s,i)=>{try{const n=(()=>{const e=navigator.userAgent;return e.includes("Chrome")&&!e.includes("Edg")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")&&!e.includes("Chrome")?"Safari":e.includes("Edg")?"Edge":e.includes("Opera")||e.includes("OPR")?"Opera":"Unknown"})();return!!(await r.A.post(`${o.A}/api/update-profile`,{playerId:t,updates:{"ftueFeedback.positive":e?s:[],"ftueFeedback.negative":e?[]:i,"ftueFeedback.browser":n}})).data.success&&(a((t=>({...t,ftueFeedback:{...t.ftueFeedback,positive:e?s:[],negative:e?[]:i,browser:n}}))),!0)}catch(l){return console.error("Error saving FTUE feedback:",l),!1}}},5519:(e,t,n)=>{"use strict";n.d(t,{handleFarmPlotPlacement:()=>h,handleTerraform:()=>p});n(3488),n(7605);var r=n(1593),o=n(819),a=n(5701),s=n(6894),i=n(6857),l=n(3295),c=n(5823),d=n(5364),u=n(4255);const h=async e=>{let{selectedItem:t,TILE_SIZE:n,resources:h,setResources:p,currentPlayer:m,setCurrentPlayer:f,inventory:g,setInventory:y,backpack:v,setBackpack:b,gridId:x,masterResources:w,masterSkills:S,updateStatus:T,overridePosition:C}=e;try{var k;let e,S;if(console.log(w),C)e=C.x,S=C.y;else{const t=(0,o.fE)(x,m);if(!t)return!1;e=t.tileX,S=t.tileY}if(h.find((t=>t.x===e&&t.y===S)))return s.A.addFloatingText(304,e,S,n),!1;const A=c.default.getTiles(),I=null===A||void 0===A||null===(k=A[S])||void 0===k?void 0:k[e],E=!0===t[`validon${I}`];if(!I||!E){const r=(e=>{const t={d:303,z:307,n:308},n=["g","d","s","p","w","l","n","o","x","y","z"].filter((t=>!0===e[`validon${t}`]));return 1===n.length&&t[n[0]]?t[n[0]]:304})(t);return s.A.addFloatingText(r,e,S,n),!1}if(!await(0,a.dw)({playerId:m.playerId,recipe:t,inventory:g,backpack:v,setInventory:y,setBackpack:b,setCurrentPlayer:f,updateStatus:T}))return s.A.addFloatingText(305,e,S,n),!1;const P=Date.now()+1e3*(t.growtime||0);console.log(`\u23f1\ufe0f Planting ${t.type}: growtime = ${t.growtime}, growEndTime = ${P}, secondsFromNow = ${(P-Date.now())/1e3}`),console.log("\ud83c\udf31 Attempting to plant:",t.type,"at",e,S);const _=(0,o.if)({type:t.type,x:e,y:S,growEnd:P},w);console.log("\ud83c\udf3e Enriched resource before setResources:",_);const N=c.default.getResources()||[];c.default.setResources([...N,_]),console.log("\ud83e\uddea Global resources after planting:",c.default.getResources()),p([...N,_]);const R=await(0,r.mQ)(x,{type:t.type,x:e,y:S,growEnd:P},!0);if(null!==R&&void 0!==R&&R.success){i.default.addSeed({type:t.type,x:e,y:S,growEnd:P,output:t.output}),(0,u.MV)(e,S,n),_.symbol&&(0,u.En)(e,S,n,_.symbol,null,_.filename),s.A.addFloatingText(302,e,S,n);const r=t.output||t.type;return await(0,l.D)(m,"Plant",r,1,f),await(0,d.LQ)("PlantedFirstCrop",m.playerId,m,f),!0}throw new Error("Server update failed.")}catch(A){return console.error("\u274c Error in handleFarmPlotPlacement:",A),!1}},p=async e=>{var t;let n,a,{TILE_SIZE:i,actionType:l,tileType:c,gridId:d,currentPlayer:h,tileTypes:p,setTileTypes:m,overridePosition:f,isDeveloper:g}=e;if(console.log("handleTerraform;  currentPlayer = ",h),null===h||void 0===h||!h.location)return console.error("\u274c handleTerraform: Missing currentPlayer location."),!1;if(f)n=f.x,a=f.y;else{const e=(0,o.fE)(d,h);if(!e)return!1;n=e.tileX,a=e.tileY}const y=null===p||void 0===p||null===(t=p[a])||void 0===t?void 0:t[n];if(console.log("tile at ",a,", ",n," = ",y),!y)return console.error("\u274c handleTerraform: Could not find tile at given coordinates."),!1;if("l"===y&&!g)return s.A.addFloatingText(320,n,a,i),!1;if("w"===y&&!g)return s.A.addFloatingText(320,n,a,i),!1;let v;if(c)v=c;else switch(l){case"till":v="d";break;case"plantGrass":v="g";break;case"pave":v="p";break;case"stone":v="s";break;case"cobblestone":v="x";break;case"water":v="w";break;default:return console.error(`\u274c handleTerraform: Unknown actionType "${l}"`),!1}return console.log(`\ud83c\udf31 handleTerraform: Changing tile at (${n}, ${a}) to "${v}"`),await(0,r.Ke)(d,n,a,v,m),(0,u.MV)(n,a,i),!0}},5558:(e,t,n)=>{"use strict";var r=n(8258);if(r)try{r([],"length")}catch(o){r=null}e.exports=r},5701:(e,t,n)=>{"use strict";n.d(t,{CP:()=>m,Fp:()=>d,J_:()=>p,Md:()=>h,O_:()=>c,Pu:()=>u,TM:()=>i,dN:()=>l,dw:()=>g,qf:()=>f,sy:()=>s});var r=n(3488),o=n(6213),a=n(1431);const s=e=>"Money"===e||"Gem"===e||"Home Deed"===e||"Town Key"===e||"Skeleton Key"===e||"Golden Key"===e||"Dungeon Key"===e||"Mirror Key"===e||"Yellow Heart"===e||"Green Heart"===e||"Purple Heart"===e;function i(e,t,n){const r=[];let o=1;return t.forEach((t=>{var a;const s=null===n||void 0===n||null===(a=n[t.type])||void 0===a?void 0:a[e];s&&s>1&&(r.push(t.type),o*=s)})),{multiplier:o,skills:r,hasSkills:r.length>0}}function l(e,t){return Math.floor(e*t)}function c(e,t,n){const r=(null===e||void 0===e?void 0:e.warehouseCapacity)||0,o=(null===e||void 0===e?void 0:e.backpackCapacity)||0,a="Gold"===(null===e||void 0===e?void 0:e.accountStatus),s=a?(null===n||void 0===n?void 0:n.warehouseCapacityGold)||1e5:0,i=a?(null===n||void 0===n?void 0:n.backpackCapacityGold)||5e3:0;return((null===e||void 0===e?void 0:e.skills)||[]).reduce(((e,n)=>{const r=null===t||void 0===t?void 0:t.find((e=>e.type===n.type));if(r){const t=r.qtycollected||0;"warehouseCapacity"===r.output?e.warehouse+=t:"backpackCapacity"===r.output&&(e.backpack+=t)}return e}),{warehouse:r+s,backpack:o+i})}const d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!e)return!1;const o=Array.isArray(t)?t:[],a=Array.isArray(n)?n:[];for(let s=1;s<=10;s++){const t=e[`ingredient${s}`],n=e[`ingredient${s}qty`]*r;if(t&&n>=0){const e=a.find((e=>e.type===t)),r=o.find((e=>e.type===t));if(((null===e||void 0===e?void 0:e.quantity)||0)+((null===r||void 0===r?void 0:r.quantity)||0)<n)return!1}}return!0},u=e=>{var t;let{resource:n,quantity:r,currentPlayer:o,inventory:a,backpack:i,masterResources:l,globalTuning:d}=e;const u=s(n),h="homestead"===(null===o||void 0===o||null===(t=o.location)||void 0===t?void 0:t.gtype);if(u)return!0;if(!u&&!h){var p;if(!(null===o||void 0===o||null===(p=o.skills)||void 0===p?void 0:p.some((e=>"Backpack"===e.type&&e.quantity>0))))return!1}const m=h?a:i,{warehouse:f,backpack:g}=c(o,l||[],d),y=h?f:g;return m.filter((e=>e&&!s(e.type)&&"number"===typeof e.quantity)).reduce(((e,t)=>e+t.quantity),0)+r<=y};async function h(e){if(!e)return console.error("No playerId provided for fetching inventory and backpack"),{inventory:[],backpack:[]};try{var t,n,a,s;const i=await o.A.get(`${r.A}/api/inventory/${e}`);return{inventory:(null===(t=i.data)||void 0===t?void 0:t.inventory)||[],backpack:(null===(n=i.data)||void 0===n?void 0:n.backpack)||[],warehouseCapacity:(null===(a=i.data)||void 0===a?void 0:a.warehouseCapacity)||0,backpackCapacity:(null===(s=i.data)||void 0===s?void 0:s.backpackCapacity)||0}}catch(i){return console.error("Error fetching inventory and backpack:",i),{inventory:[],backpack:[]}}}async function p(e){if(!e)return console.error("No playerId provided for fetching inventory"),[];try{var t;return(null===(t=(await o.A.get(`${r.A}/api/inventory/${e}`)).data)||void 0===t?void 0:t.inventory)||[]}catch(n){return console.error("Error fetching inventory:",n),[]}}async function m(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{const l=(await o.A.get(`${r.A}/api/player/${e}`)).data;if(console.log("\ud83d\udea8 [HP DEBUG] refreshPlayerAfterInventoryUpdate - Server player data:"),console.log("  updatedPlayerData.hp:",l.hp),console.log("  updatedPlayerData.maxhp:",l.maxhp),console.log("  updatedPlayerData.baseHp:",l.baseHp),console.log("  updatedPlayerData.baseMaxhp:",l.baseMaxhp),n)t((t=>{var n,r;const o={...l,inventory:t.inventory,backpack:t.backpack},s=null===(n=a.default.getPlayersInGrid(null===(r=o.location)||void 0===r?void 0:r.g))||void 0===n?void 0:n[e];return s&&(o.location={...o.location,x:s.position.x,y:s.position.y}),o}));else{var s,i;const n=null===(s=a.default.getPlayersInGrid(null===(i=l.location)||void 0===i?void 0:i.g))||void 0===s?void 0:s[e];n&&(l.location={...l.location,x:n.position.x,y:n.position.y}),t(l)}}catch(l){console.error("Error refreshing player:",l)}}async function f(e){var t;let{playerId:n,currentPlayer:a,resource:i,quantity:l,inventory:d,backpack:u,setInventory:h,setBackpack:p,setCurrentPlayer:f,updateStatus:g,masterResources:y,globalTuning:v}=e;const b=s(i),x="homestead"===(null===a||void 0===a||null===(t=a.location)||void 0===t?void 0:t.gtype),w=!b&&!x,S=b||x?[...d]:[...u];if(w){var T;if(!(null===a||void 0===a||null===(T=a.skills)||void 0===T?void 0:T.some((e=>"Backpack"===e.type&&e.quantity>0))))return g&&g(19),{success:!1,isCapacityError:!0,isMissingBackpack:!0,isNetworkError:!1,error:new Error("Missing backpack skill")}}if(!b){const{warehouse:e,backpack:t}=c(a,y||[],v),n=x?e:t;if(S.filter((e=>e&&!s(e.type)&&"number"===typeof e.quantity)).reduce(((e,t)=>e+t.quantity),0)+l>n)return g&&g(x?20:21),{success:!1,isCapacityError:!0,isNetworkError:!1,error:new Error(x?"Warehouse full":"Backpack full")}}const C=S.findIndex((e=>e.type===i));C>=0?S[C].quantity+=l:S.push({type:i,quantity:l});const k={playerId:n,delta:[{type:i,quantity:l,target:w?"backpack":"inventory"}]};try{return await o.A.post(`${r.A}/api/update-inventory-delta`,k),h(b||x?S:d),p(b||x?u:S),f((e=>({...e,inventory:b||x?S:d,backpack:b||x?u:S}))),await m(n,f),!0}catch(O){var A,I,E,P,_,N,R,M,j,D;console.error("\u274c Error gaining ingredient:",O),console.error("Error details:",{status:null===(A=O.response)||void 0===A?void 0:A.status,data:null===(I=O.response)||void 0===I?void 0:I.data,message:O.message,resource:i,quantity:l,target:w?"backpack":"inventory"});return{success:!1,isCapacityError:400===(null===(E=O.response)||void 0===E?void 0:E.status)&&((null===(P=O.response)||void 0===P||null===(_=P.data)||void 0===_||null===(N=_.error)||void 0===N?void 0:N.includes("capacity"))||(null===(R=O.response)||void 0===R||null===(M=R.data)||void 0===M||null===(j=M.error)||void 0===j?void 0:j.includes("full"))),isNetworkError:!O.response||(null===(D=O.response)||void 0===D?void 0:D.status)>=500,error:O}}}async function g(e){let{playerId:t,recipe:n,inventory:a,backpack:s,setInventory:i,setBackpack:l,setCurrentPlayer:c,updateStatus:u}=e,h=[...a],p=[...s];if(!d(n,a,s,1))return u(4),!1;const f=[];for(let r=1;r<=10;r++){const e=null===n||void 0===n?void 0:n[`ingredient${r}`],t=null===n||void 0===n?void 0:n[`ingredient${r}qty`];if(e&&t){let n=t;const r=p.find((t=>t.type===e));if(r){const t=Math.min(n,r.quantity);r.quantity-=t,n-=t,f.push({type:e,quantity:-t,target:"backpack"}),r.quantity<=0&&p.splice(p.indexOf(r),1)}if(n>0){const t=h.find((t=>t.type===e));if(t){const r=Math.min(n,t.quantity);t.quantity-=r,f.push({type:e,quantity:-r,target:"inventory"}),t.quantity<=0&&h.splice(h.indexOf(t),1)}}}}try{await o.A.post(`${r.A}/api/update-inventory-delta`,{playerId:t,delta:f}),i(h),l(p),c((e=>({...e,inventory:h,backpack:p}))),await m(t,c);const e={success:!0,updatedInventory:h,updatedBackpack:p,valueOf:()=>!0};return e}catch(g){return console.error("\u274c Error spending ingredients:",g),!1}}},5747:(e,t,n)=>{"use strict";var r=n(3864),o=n(5061),a=n(4937),s=n(4590);e.exports=s||r.call(a,o)},5823:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={tiles:[],resources:[],setTiles(e){this.tiles=e},setResources(e){this.resources=e},getTiles(){return this.tiles},getResources(){return this.resources}}},6213:(e,t,n)=>{"use strict";n.d(t,{A:()=>yt});var r={};function o(e,t){return function(){return e.apply(t,arguments)}}n.r(r),n.d(r,{hasBrowserEnv:()=>se,hasStandardBrowserEnv:()=>le,hasStandardBrowserWebWorkerEnv:()=>ce,navigator:()=>ie,origin:()=>de});const{toString:a}=Object.prototype,{getPrototypeOf:s}=Object,i=(l=Object.create(null),e=>{const t=a.call(e);return l[t]||(l[t]=t.slice(8,-1).toLowerCase())});var l;const c=e=>(e=e.toLowerCase(),t=>i(t)===e),d=e=>t=>typeof t===e,{isArray:u}=Array,h=d("undefined");const p=c("ArrayBuffer");const m=d("string"),f=d("function"),g=d("number"),y=e=>null!==e&&"object"===typeof e,v=e=>{if("object"!==i(e))return!1;const t=s(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},b=c("Date"),x=c("File"),w=c("Blob"),S=c("FileList"),T=c("URLSearchParams"),[C,k,A,I]=["ReadableStream","Request","Response","Headers"].map(c);function E(e,t){let n,r,{allOwnKeys:o=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),u(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=o?Object.getOwnPropertyNames(e):Object.keys(e),a=r.length;let s;for(n=0;n<a;n++)s=r[n],t.call(null,e[s],s,e)}}function P(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,o=n.length;for(;o-- >0;)if(r=n[o],t===r.toLowerCase())return r;return null}const _="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,N=e=>!h(e)&&e!==_;const R=(M="undefined"!==typeof Uint8Array&&s(Uint8Array),e=>M&&e instanceof M);var M;const j=c("HTMLFormElement"),D=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),O=c("RegExp"),B=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};E(n,((n,o)=>{let a;!1!==(a=t(n,o,e))&&(r[o]=a||n)})),Object.defineProperties(e,r)};const L=c("AsyncFunction"),F=((e,t)=>{return e?setImmediate:t?(n=`axios@${Math.random()}`,r=[],_.addEventListener("message",(e=>{let{source:t,data:o}=e;t===_&&o===n&&r.length&&r.shift()()}),!1),e=>{r.push(e),_.postMessage(n,"*")}):e=>setTimeout(e);var n,r})("function"===typeof setImmediate,f(_.postMessage)),$="undefined"!==typeof queueMicrotask?queueMicrotask.bind(_):"undefined"!==typeof process&&process.nextTick||F,G={isArray:u,isArrayBuffer:p,isBuffer:function(e){return null!==e&&!h(e)&&null!==e.constructor&&!h(e.constructor)&&f(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||f(e.append)&&("formdata"===(t=i(e))||"object"===t&&f(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&p(e.buffer),t},isString:m,isNumber:g,isBoolean:e=>!0===e||!1===e,isObject:y,isPlainObject:v,isReadableStream:C,isRequest:k,isResponse:A,isHeaders:I,isUndefined:h,isDate:b,isFile:x,isBlob:w,isRegExp:O,isFunction:f,isStream:e=>y(e)&&f(e.pipe),isURLSearchParams:T,isTypedArray:R,isFileList:S,forEach:E,merge:function e(){const{caseless:t}=N(this)&&this||{},n={},r=(r,o)=>{const a=t&&P(n,o)||o;v(n[a])&&v(r)?n[a]=e(n[a],r):v(r)?n[a]=e({},r):u(r)?n[a]=r.slice():n[a]=r};for(let o=0,a=arguments.length;o<a;o++)arguments[o]&&E(arguments[o],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return E(t,((t,r)=>{n&&f(t)?e[r]=o(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let o,a,i;const l={};if(t=t||{},null==e)return t;do{for(o=Object.getOwnPropertyNames(e),a=o.length;a-- >0;)i=o[a],r&&!r(i,e,t)||l[i]||(t[i]=e[i],l[i]=!0);e=!1!==n&&s(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:i,kindOfTest:c,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(u(e))return e;let t=e.length;if(!g(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:j,hasOwnProperty:D,hasOwnProp:D,reduceDescriptors:B,freezeMethods:e=>{B(e,((t,n)=>{if(f(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];f(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return u(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:P,global:_,isContextDefined:N,isSpecCompliantForm:function(e){return!!(e&&f(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(y(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const o=u(e)?[]:{};return E(e,((e,t)=>{const a=n(e,r+1);!h(a)&&(o[t]=a)})),t[r]=void 0,o}}return e};return n(e,0)},isAsyncFn:L,isThenable:e=>e&&(y(e)||f(e))&&f(e.then)&&f(e.catch),setImmediate:F,asap:$};function z(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}G.inherits(z,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:G.toJSONObject(this.config),code:this.code,status:this.status}}});const U=z.prototype,H={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{H[e]={value:e}})),Object.defineProperties(z,H),Object.defineProperty(U,"isAxiosError",{value:!0}),z.from=(e,t,n,r,o,a)=>{const s=Object.create(U);return G.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),z.call(s,e.message,t,n,r,o),s.cause=e,s.name=e.name,a&&Object.assign(s,a),s};const q=z;function V(e){return G.isPlainObject(e)||G.isArray(e)}function W(e){return G.endsWith(e,"[]")?e.slice(0,-2):e}function Y(e,t,n){return e?e.concat(t).map((function(e,t){return e=W(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const K=G.toFlatObject(G,{},null,(function(e){return/^is[A-Z]/.test(e)}));const X=function(e,t,n){if(!G.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=G.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!G.isUndefined(t[e])}))).metaTokens,o=n.visitor||c,a=n.dots,s=n.indexes,i=(n.Blob||"undefined"!==typeof Blob&&Blob)&&G.isSpecCompliantForm(t);if(!G.isFunction(o))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(G.isDate(e))return e.toISOString();if(!i&&G.isBlob(e))throw new q("Blob is not supported. Use a Buffer instead.");return G.isArrayBuffer(e)||G.isTypedArray(e)?i&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,o){let i=e;if(e&&!o&&"object"===typeof e)if(G.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(G.isArray(e)&&function(e){return G.isArray(e)&&!e.some(V)}(e)||(G.isFileList(e)||G.endsWith(n,"[]"))&&(i=G.toArray(e)))return n=W(n),i.forEach((function(e,r){!G.isUndefined(e)&&null!==e&&t.append(!0===s?Y([n],r,a):null===s?n:n+"[]",l(e))})),!1;return!!V(e)||(t.append(Y(o,n,a),l(e)),!1)}const d=[],u=Object.assign(K,{defaultVisitor:c,convertValue:l,isVisitable:V});if(!G.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!G.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),G.forEach(n,(function(n,a){!0===(!(G.isUndefined(n)||null===n)&&o.call(t,n,G.isString(a)?a.trim():a,r,u))&&e(n,r?r.concat(a):[a])})),d.pop()}}(e),t};function Z(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function J(e,t){this._pairs=[],e&&X(e,this,t)}const Q=J.prototype;Q.append=function(e,t){this._pairs.push([e,t])},Q.toString=function(e){const t=e?function(t){return e.call(this,t,Z)}:Z;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const ee=J;function te(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ne(e,t,n){if(!t)return e;const r=n&&n.encode||te;G.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let a;if(a=o?o(t,n):G.isURLSearchParams(t)?t.toString():new ee(t,n).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const re=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){G.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},oe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ae={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:ee,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},se="undefined"!==typeof window&&"undefined"!==typeof document,ie="object"===typeof navigator&&navigator||void 0,le=se&&(!ie||["ReactNative","NativeScript","NS"].indexOf(ie.product)<0),ce="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,de=se&&window.location.href||"http://localhost",ue={...r,...ae};const he=function(e){function t(e,n,r,o){let a=e[o++];if("__proto__"===a)return!0;const s=Number.isFinite(+a),i=o>=e.length;if(a=!a&&G.isArray(r)?r.length:a,i)return G.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!s;r[a]&&G.isObject(r[a])||(r[a]=[]);return t(e,n,r[a],o)&&G.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const o=n.length;let a;for(r=0;r<o;r++)a=n[r],t[a]=e[a];return t}(r[a])),!s}if(G.isFormData(e)&&G.isFunction(e.entries)){const n={};return G.forEachEntry(e,((e,r)=>{t(function(e){return G.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const pe={transitional:oe,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=G.isObject(e);o&&G.isHTMLForm(e)&&(e=new FormData(e));if(G.isFormData(e))return r?JSON.stringify(he(e)):e;if(G.isArrayBuffer(e)||G.isBuffer(e)||G.isStream(e)||G.isFile(e)||G.isBlob(e)||G.isReadableStream(e))return e;if(G.isArrayBufferView(e))return e.buffer;if(G.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return X(e,new ue.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return ue.isNode&&G.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=G.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return X(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),function(e,t,n){if(G.isString(e))try{return(t||JSON.parse)(e),G.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||pe.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(G.isResponse(e)||G.isReadableStream(e))return e;if(e&&G.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(o){if(n){if("SyntaxError"===o.name)throw q.from(o,q.ERR_BAD_RESPONSE,this,null,this.response);throw o}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ue.classes.FormData,Blob:ue.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};G.forEach(["delete","get","head","post","put","patch"],(e=>{pe.headers[e]={}}));const me=pe,fe=G.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ge=Symbol("internals");function ye(e){return e&&String(e).trim().toLowerCase()}function ve(e){return!1===e||null==e?e:G.isArray(e)?e.map(ve):String(e)}function be(e,t,n,r,o){return G.isFunction(r)?r.call(this,t,n):(o&&(t=n),G.isString(t)?G.isString(r)?-1!==t.indexOf(r):G.isRegExp(r)?r.test(t):void 0:void 0)}class xe{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function o(e,t,n){const o=ye(t);if(!o)throw new Error("header name must be a non-empty string");const a=G.findKey(r,o);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=ve(e))}const a=(e,t)=>G.forEach(e,((e,n)=>o(e,n,t)));if(G.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(G.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let n,r,o;return e&&e.split("\n").forEach((function(e){o=e.indexOf(":"),n=e.substring(0,o).trim().toLowerCase(),r=e.substring(o+1).trim(),!n||t[n]&&fe[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t);else if(G.isHeaders(e))for(const[s,i]of e.entries())o(i,s,n);else null!=e&&o(t,e,n);return this}get(e,t){if(e=ye(e)){const n=G.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(G.isFunction(t))return t.call(this,e,n);if(G.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ye(e)){const n=G.findKey(this,e);return!(!n||void 0===this[n]||t&&!be(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function o(e){if(e=ye(e)){const o=G.findKey(n,e);!o||t&&!be(0,n[o],o,t)||(delete n[o],r=!0)}}return G.isArray(e)?e.forEach(o):o(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const o=t[n];e&&!be(0,this[o],o,e,!0)||(delete this[o],r=!0)}return r}normalize(e){const t=this,n={};return G.forEach(this,((r,o)=>{const a=G.findKey(n,o);if(a)return t[a]=ve(r),void delete t[o];const s=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(o):String(o).trim();s!==o&&delete t[o],t[s]=ve(r),n[s]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return G.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&G.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[ge]=this[ge]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ye(e);t[r]||(!function(e,t){const n=G.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,o){return this[r].call(this,t,e,n,o)},configurable:!0})}))}(n,e),t[r]=!0)}return G.isArray(e)?e.forEach(r):r(e),this}}xe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),G.reduceDescriptors(xe.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),G.freezeMethods(xe);const we=xe;function Se(e,t){const n=this||me,r=t||n,o=we.from(r.headers);let a=r.data;return G.forEach(e,(function(e){a=e.call(n,a,o.normalize(),t?t.status:void 0)})),o.normalize(),a}function Te(e){return!(!e||!e.__CANCEL__)}function Ce(e,t,n){q.call(this,null==e?"canceled":e,q.ERR_CANCELED,t,n),this.name="CanceledError"}G.inherits(Ce,q,{__CANCEL__:!0});const ke=Ce;function Ae(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new q("Request failed with status code "+n.status,[q.ERR_BAD_REQUEST,q.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const Ie=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let o,a=0,s=0;return t=void 0!==t?t:1e3,function(i){const l=Date.now(),c=r[s];o||(o=l),n[a]=i,r[a]=l;let d=s,u=0;for(;d!==a;)u+=n[d++],d%=e;if(a=(a+1)%e,a===s&&(s=(s+1)%e),l-o<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}};const Ee=function(e,t){let n,r,o=0,a=1e3/t;const s=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();o=a,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-o;for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];t>=a?s(l,e):(n=l,r||(r=setTimeout((()=>{r=null,s(n)}),a-t)))},()=>n&&s(n)]},Pe=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const o=Ie(50,250);return Ee((n=>{const a=n.loaded,s=n.lengthComputable?n.total:void 0,i=a-r,l=o(i);r=a;e({loaded:a,total:s,progress:s?a/s:void 0,bytes:i,rate:l||void 0,estimated:l&&s&&a<=s?(s-a)/l:void 0,event:n,lengthComputable:null!=s,[t?"download":"upload"]:!0})}),n)},_e=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Ne=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return G.asap((()=>e(...n)))},Re=ue.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,ue.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(ue.origin),ue.navigator&&/(msie|trident)/i.test(ue.navigator.userAgent)):()=>!0,Me=ue.hasStandardBrowserEnv?{write(e,t,n,r,o,a){const s=[e+"="+encodeURIComponent(t)];G.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),G.isString(r)&&s.push("path="+r),G.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function je(e,t,n){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const De=e=>e instanceof we?{...e}:e;function Oe(e,t){t=t||{};const n={};function r(e,t,n,r){return G.isPlainObject(e)&&G.isPlainObject(t)?G.merge.call({caseless:r},e,t):G.isPlainObject(t)?G.merge({},t):G.isArray(t)?t.slice():t}function o(e,t,n,o){return G.isUndefined(t)?G.isUndefined(e)?void 0:r(void 0,e,0,o):r(e,t,0,o)}function a(e,t){if(!G.isUndefined(t))return r(void 0,t)}function s(e,t){return G.isUndefined(t)?G.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function i(n,o,a){return a in t?r(n,o):a in e?r(void 0,n):void 0}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:i,headers:(e,t,n)=>o(De(e),De(t),0,!0)};return G.forEach(Object.keys(Object.assign({},e,t)),(function(r){const a=l[r]||o,s=a(e[r],t[r],r);G.isUndefined(s)&&a!==i||(n[r]=s)})),n}const Be=e=>{const t=Oe({},e);let n,{data:r,withXSRFToken:o,xsrfHeaderName:a,xsrfCookieName:s,headers:i,auth:l}=t;if(t.headers=i=we.from(i),t.url=ne(je(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&i.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),G.isFormData(r))if(ue.hasStandardBrowserEnv||ue.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(!1!==(n=i.getContentType())){const[e,...t]=n?n.split(";").map((e=>e.trim())).filter(Boolean):[];i.setContentType([e||"multipart/form-data",...t].join("; "))}if(ue.hasStandardBrowserEnv&&(o&&G.isFunction(o)&&(o=o(t)),o||!1!==o&&Re(t.url))){const e=a&&s&&Me.read(s);e&&i.set(a,e)}return t},Le="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){const r=Be(e);let o=r.data;const a=we.from(r.headers).normalize();let s,i,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=r;function m(){c&&c(),d&&d(),r.cancelToken&&r.cancelToken.unsubscribe(s),r.signal&&r.signal.removeEventListener("abort",s)}let f=new XMLHttpRequest;function g(){if(!f)return;const r=we.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());Ae((function(e){t(e),m()}),(function(e){n(e),m()}),{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:e,request:f}),f=null}f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(n(new q("Request aborted",q.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new q("Network Error",q.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const o=r.transitional||oe;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new q(t,o.clarifyTimeoutError?q.ETIMEDOUT:q.ECONNABORTED,e,f)),f=null},void 0===o&&a.setContentType(null),"setRequestHeader"in f&&G.forEach(a.toJSON(),(function(e,t){f.setRequestHeader(t,e)})),G.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),u&&"json"!==u&&(f.responseType=r.responseType),p&&([l,d]=Pe(p,!0),f.addEventListener("progress",l)),h&&f.upload&&([i,c]=Pe(h),f.upload.addEventListener("progress",i),f.upload.addEventListener("loadend",c)),(r.cancelToken||r.signal)&&(s=t=>{f&&(n(!t||t.type?new ke(null,e,f):t),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(s),r.signal&&(r.signal.aborted?s():r.signal.addEventListener("abort",s)));const y=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);y&&-1===ue.protocols.indexOf(y)?n(new q("Unsupported protocol "+y+":",q.ERR_BAD_REQUEST,e)):f.send(o||null)}))},Fe=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const o=function(e){if(!n){n=!0,s();const t=e instanceof Error?e:this.reason;r.abort(t instanceof q?t:new ke(t instanceof Error?t.message:t))}};let a=t&&setTimeout((()=>{a=null,o(new q(`timeout ${t} of ms exceeded`,q.ETIMEDOUT))}),t);const s=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(o):e.removeEventListener("abort",o)})),e=null)};e.forEach((e=>e.addEventListener("abort",o)));const{signal:i}=r;return i.unsubscribe=()=>G.asap(s),i}},$e=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,o=0;for(;o<n;)r=o+t,yield e.slice(o,r),o=r},Ge=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}},ze=(e,t,n,r)=>{const o=async function*(e,t){for await(const n of Ge(e))yield*$e(n,t)}(e,t);let a,s=0,i=e=>{a||(a=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await o.next();if(t)return i(),void e.close();let a=r.byteLength;if(n){let e=s+=a;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw i(t),t}},cancel:e=>(i(e),o.return())},{highWaterMark:2})},Ue="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,He=Ue&&"function"===typeof ReadableStream,qe=Ue&&("function"===typeof TextEncoder?(Ve=new TextEncoder,e=>Ve.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Ve;const We=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(o){return!1}},Ye=He&&We((()=>{let e=!1;const t=new Request(ue.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),Ke=He&&We((()=>G.isReadableStream(new Response("").body))),Xe={stream:Ke&&(e=>e.body)};var Ze;Ue&&(Ze=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Xe[e]&&(Xe[e]=G.isFunction(Ze[e])?t=>t[e]():(t,n)=>{throw new q(`Response type '${e}' is not supported`,q.ERR_NOT_SUPPORT,n)})})));const Je=async(e,t)=>{const n=G.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(G.isBlob(e))return e.size;if(G.isSpecCompliantForm(e)){const t=new Request(ue.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return G.isArrayBufferView(e)||G.isArrayBuffer(e)?e.byteLength:(G.isURLSearchParams(e)&&(e+=""),G.isString(e)?(await qe(e)).byteLength:void 0)})(t):n},Qe={http:null,xhr:Le,fetch:Ue&&(async e=>{let{url:t,method:n,data:r,signal:o,cancelToken:a,timeout:s,onDownloadProgress:i,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=Be(e);c=c?(c+"").toLowerCase():"text";let p,m=Fe([o,a&&a.toAbortSignal()],s);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&Ye&&"get"!==n&&"head"!==n&&0!==(g=await Je(d,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(G.isFormData(r)&&(e=n.headers.get("content-type"))&&d.setContentType(e),n.body){const[e,t]=_e(g,Pe(Ne(l)));r=ze(n.body,65536,e,t)}}G.isString(u)||(u=u?"include":"omit");const o="credentials"in Request.prototype;p=new Request(t,{...h,signal:m,method:n.toUpperCase(),headers:d.normalize().toJSON(),body:r,duplex:"half",credentials:o?u:void 0});let a=await fetch(p);const s=Ke&&("stream"===c||"response"===c);if(Ke&&(i||s&&f)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=a[t]}));const t=G.toFiniteNumber(a.headers.get("content-length")),[n,r]=i&&_e(t,Pe(Ne(i),!0))||[];a=new Response(ze(a.body,65536,n,(()=>{r&&r(),f&&f()})),e)}c=c||"text";let y=await Xe[G.findKey(Xe,c)||"text"](a,e);return!s&&f&&f(),await new Promise(((t,n)=>{Ae(t,n,{data:y,headers:we.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:p})}))}catch(y){if(f&&f(),y&&"TypeError"===y.name&&/fetch/i.test(y.message))throw Object.assign(new q("Network Error",q.ERR_NETWORK,e,p),{cause:y.cause||y});throw q.from(y,y&&y.code,e,p)}})};G.forEach(Qe,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(n){}Object.defineProperty(e,"adapterName",{value:t})}}));const et=e=>`- ${e}`,tt=e=>G.isFunction(e)||null===e||!1===e,nt=e=>{e=G.isArray(e)?e:[e];const{length:t}=e;let n,r;const o={};for(let a=0;a<t;a++){let t;if(n=e[a],r=n,!tt(n)&&(r=Qe[(t=String(n)).toLowerCase()],void 0===r))throw new q(`Unknown adapter '${t}'`);if(r)break;o[t||"#"+a]=r}if(!r){const e=Object.entries(o).map((e=>{let[t,n]=e;return`adapter ${t} `+(!1===n?"is not supported by the environment":"is not available in the build")}));let n=t?e.length>1?"since :\n"+e.map(et).join("\n"):" "+et(e[0]):"as no adapter specified";throw new q("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return r};function rt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ke(null,e)}function ot(e){rt(e),e.headers=we.from(e.headers),e.data=Se.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return nt(e.adapter||me.adapter)(e).then((function(t){return rt(e),t.data=Se.call(e,e.transformResponse,t),t.headers=we.from(t.headers),t}),(function(t){return Te(t)||(rt(e),t&&t.response&&(t.response.data=Se.call(e,e.transformResponse,t.response),t.response.headers=we.from(t.response.headers))),Promise.reject(t)}))}const at="1.8.4",st={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{st[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const it={};st.transitional=function(e,t,n){function r(e,t){return"[Axios v1.8.4] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,o,a)=>{if(!1===e)throw new q(r(o," has been removed"+(t?" in "+t:"")),q.ERR_DEPRECATED);return t&&!it[o]&&(it[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,a)}},st.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};const lt={assertOptions:function(e,t,n){if("object"!==typeof e)throw new q("options must be an object",q.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let o=r.length;for(;o-- >0;){const a=r[o],s=t[a];if(s){const t=e[a],n=void 0===t||s(t,a,e);if(!0!==n)throw new q("option "+a+" must be "+n,q.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new q("Unknown option "+a,q.ERR_BAD_OPTION)}},validators:st},ct=lt.validators;class dt{constructor(e){this.defaults=e,this.interceptors={request:new re,response:new re}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(r){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=Oe(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:o}=t;void 0!==n&&lt.assertOptions(n,{silentJSONParsing:ct.transitional(ct.boolean),forcedJSONParsing:ct.transitional(ct.boolean),clarifyTimeoutError:ct.transitional(ct.boolean)},!1),null!=r&&(G.isFunction(r)?t.paramsSerializer={serialize:r}:lt.assertOptions(r,{encode:ct.function,serialize:ct.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),lt.assertOptions(t,{baseUrl:ct.spelling("baseURL"),withXsrfToken:ct.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&G.merge(o.common,o[t.method]);o&&G.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete o[e]})),t.headers=we.concat(a,o);const s=[];let i=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let d,u=0;if(!i){const e=[ot.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=s.length;let h=t;for(u=0;u<d;){const e=s[u++],t=s[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{c=ot.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return ne(je((e=Oe(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}G.forEach(["delete","get","head","options"],(function(e){dt.prototype[e]=function(t,n){return this.request(Oe(n||{},{method:e,url:t,data:(n||{}).data}))}})),G.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,o){return this.request(Oe(o||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}dt.prototype[e]=t(),dt.prototype[e+"Form"]=t(!0)}));const ut=dt;class ht{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,o){n.reason||(n.reason=new ke(e,r,o),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new ht((function(t){e=t})),cancel:e}}}const pt=ht;const mt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(mt).forEach((e=>{let[t,n]=e;mt[n]=t}));const ft=mt;const gt=function e(t){const n=new ut(t),r=o(ut.prototype.request,n);return G.extend(r,ut.prototype,n,{allOwnKeys:!0}),G.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(Oe(t,n))},r}(me);gt.Axios=ut,gt.CanceledError=ke,gt.CancelToken=pt,gt.isCancel=Te,gt.VERSION=at,gt.toFormData=X,gt.AxiosError=q,gt.Cancel=gt.CanceledError,gt.all=function(e){return Promise.all(e)},gt.spread=function(e){return function(t){return e.apply(null,t)}},gt.isAxiosError=function(e){return G.isObject(e)&&!0===e.isAxiosError},gt.mergeConfig=Oe,gt.AxiosHeaders=we,gt.formToJSON=e=>he(G.isHTMLForm(e)?new FormData(e):e),gt.getAdapter=nt,gt.HttpStatusCode=ft,gt.default=gt;const yt=gt},6352:(e,t,n)=>{"use strict";n.d(t,{p:()=>s});var r=n(6213),o=n(3488),a=n(4876);async function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;try{if(s&&i){const e=i.find((e=>e.name===t));if(e&&"Event"===e.type){var c;if(null===(c=s.trophies)||void 0===c?void 0:c.some((e=>e.name===t)))return console.log(`\u26a0\ufe0f Player already has Event trophy: ${t}`),{success:!1,message:"Trophy already earned"}}}const d=await r.A.post(`${o.A}/api/earn-trophy`,{playerId:e,trophyName:t,progressIncrement:n});if(d.data.success){const{trophy:e,isNewMilestone:n}=d.data;if(l&&s&&n&&l((n=>{const r=[...n.trophies||[]],o=r.findIndex((e=>e.name===t));return-1!==o?r[o]={...r[o],progress:e.progress,qty:e.qty,collected:!1,timestamp:new Date}:r.push({name:t,progress:e.progress,qty:e.qty,collected:!1,timestamp:new Date}),console.log(`\ud83d\udd04 Local player state updated with trophy: ${t}`),{...n,trophies:r}})),n){console.log(`\ud83c\udfc6 Trophy milestone earned: ${t}`,e);let n=!0;if(i){const e=i.find((e=>e.name===t));e&&!1===e.visible&&(n=!1,console.log(`\ud83d\udd07 Trophy notification suppressed for hidden trophy: ${t}`))}n&&(0,a.D)("Trophy",e)}else console.log(`\ud83d\udcc8 Trophy progress: ${t} - ${e.progress}/${e.nextMilestone}`);return d.data}return d.data}catch(d){return console.error("Error earning trophy:",d),{success:!1,error:d.message}}}},6388:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=new class{constructor(){this.svgCache=new Map,this.textureCache=new Map,this.loadingPromises=new Map,this.ZOOM_TIERS=[16,34,50,68,100,150]}getBestZoomTier(e){const t=window.devicePixelRatio||1,n=e*Math.max(t,1.5);return this.ZOOM_TIERS.find((e=>e>=n))||this.ZOOM_TIERS[this.ZOOM_TIERS.length-1]}async loadSVG(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=t?`overlay-${e}`:e;if(this.svgCache.has(n))return this.svgCache.get(n);if(this.loadingPromises.has(n))return this.loadingPromises.get(n);const r=fetch(`${t?"/assets/overlays/":"/assets/resources/"}${e}`).then((t=>{if(!t.ok)throw new Error(`Failed to load SVG: ${e}`);return t.text()})).then((e=>(this.svgCache.set(n,e),this.loadingPromises.delete(n),e))).catch((t=>(console.warn(`SVG asset not found: ${e}`,t),this.loadingPromises.delete(n),null)));return this.loadingPromises.set(n,r),r}async createSVGTexture(e,t){return new Promise((n=>{const r=document.createElement("canvas");r.width=r.height=t;const o=r.getContext("2d");if(!o)return console.error("\u274c [SVG TEXTURE] Failed to get 2d context for offscreen canvas"),void n(null);o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high";const a=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(a),i=new Image,l=setTimeout((()=>{console.warn(`\u23f0 [SVG TEXTURE] Image load timed out for size ${t}`),URL.revokeObjectURL(s),n(null)}),5e3);i.onload=()=>{clearTimeout(l);try{o.drawImage(i,0,0,t,t),n(r)}catch(e){console.error("\u274c [SVG TEXTURE] Error drawing image to canvas:",e),n(null)}finally{URL.revokeObjectURL(s)}},i.onerror=e=>{clearTimeout(l),console.warn("\u274c [SVG TEXTURE] Failed to load SVG image:",e),URL.revokeObjectURL(s),n(null)},i.src=s}))}async getSVGTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=window.devicePixelRatio||1,o=Math.ceil(t*r),a=`${n?"overlay-":""}${e}-${t}-${o}`;if(this.textureCache.has(a))return this.textureCache.get(a);try{const t=await this.loadSVG(e,n);if(!t)return console.warn(`\u274c [SVG MANAGER] No SVG text loaded for ${e}`),null;const r=await this.createSVGTexture(t,o);return r?this.textureCache.set(a,r):console.warn(`\u274c [SVG MANAGER] Failed to create texture for ${e}`),r}catch(s){return console.error(`\u274c [SVG MANAGER] Error creating SVG texture for ${e}:`,s),null}}async getOverlayTexture(e,t){return this.getSVGTexture(e,t,!0)}updateZoomTiers(e){if(!e)return void console.warn("No globalTuning provided, using default zoom tiers");const t=[e.farZoom||16,e.closeZoom||34,e.closerZoom||50],n=t.map((e=>[1.5*e,2*e,3*e])).flat();this.ZOOM_TIERS=[...new Set([...t,...n])].sort(((e,t)=>e-t)),console.log("Updated SVG zoom tiers from globalTuning:",this.ZOOM_TIERS)}clearCache(){this.svgCache.clear(),this.textureCache.clear(),this.loadingPromises.clear()}getCacheStats(){return{svgFiles:this.svgCache.size,textures:this.textureCache.size,loading:this.loadingPromises.size}}async preloadResourceSVGs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64;if(!e||!t)return console.warn("\ud83d\uddbc\ufe0f [SVG PRELOAD] Missing resources or masterResources"),{success:!1,loaded:0,failed:0,skipped:0};console.log(`\ud83d\uddbc\ufe0f [SVG PRELOAD] Starting preload for ${e.length} resources at size ${n}`);const r=Date.now(),o=new Map;for(const u of e){if("shadow"===u.type)continue;const e=t.find((e=>e.type===u.type));null!==e&&void 0!==e&&e.filename&&o.set(u.type,e.filename)}console.log(`\ud83d\uddbc\ufe0f [SVG PRELOAD] Found ${o.size} unique resource types with SVG files`);let a=0,s=0,i=0;const l=Array.from(o.entries()).map((async e=>{let[t,r]=e;if(this.textureCache.has(`${r}-${n}-${Math.ceil(n*(window.devicePixelRatio||1))}`))return i++,{type:t,filename:r,status:"cached"};try{return await this.getSVGTexture(r,n)?(a++,{type:t,filename:r,status:"loaded"}):(s++,console.warn(`\ud83d\uddbc\ufe0f [SVG PRELOAD] Failed to load: ${r} for ${t}`),{type:t,filename:r,status:"failed"})}catch(o){return s++,console.error(`\ud83d\uddbc\ufe0f [SVG PRELOAD] Error loading ${r}:`,o),{type:t,filename:r,status:"error",error:o.message}}})),c=await Promise.all(l),d=Date.now()-r;return console.log(`\ud83d\uddbc\ufe0f [SVG PRELOAD] Complete in ${d}ms - Loaded: ${a}, Cached: ${i}, Failed: ${s}`),console.log("\ud83d\uddbc\ufe0f [SVG PRELOAD] Cache stats after preload:",this.getCacheStats()),{success:0===s,loaded:a,failed:s,skipped:i,duration:d,results:c.filter((e=>"failed"===e.status||"error"===e.status))}}diagnoseLoadingState(){const e=this.getCacheStats(),t=Array.from(this.loadingPromises.keys());return console.log("\ud83d\udd0d [SVG DIAGNOSIS] ================================"),console.log("\ud83d\udd0d [SVG DIAGNOSIS] SVG Cache Status:"),console.log(`   - SVG files loaded: ${e.svgFiles}`),console.log(`   - Textures cached: ${e.textures}`),console.log(`   - Currently loading: ${e.loading}`),t.length>0&&console.log(`   - Pending loads: ${t.join(", ")}`),console.log("\ud83d\udd0d [SVG DIAGNOSIS] ================================"),{...e,pendingLoads:t,isHealthy:0===e.loading}}}},6704:(e,t,n)=>{"use strict";n.d(t,{handleTransitSignpost:()=>h});var r=n(3488),o=n(6213),a=n(1593);const s={N:{x:31,y:63},NE:{x:0,y:63},E:{x:0,y:31},SE:{x:0,y:0},S:{x:31,y:0},SW:{x:63,y:0},W:{x:63,y:30},NW:{x:63,y:63}};var i=n(1431),l=n(7605),c=n(6894),d=n(6352),u=n(5364);async function h(e,t,n,h,p,m,f,g,y,v,b,x,w){let S=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,T=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null,C=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;try{var k,A,I,E,P,_,N;"function"!==typeof g&&console.warn("\u26a0\ufe0f updateStatus is not a function:",g),console.log("Handling transit for resource:",t),null!==C&&void 0!==C&&C.startTransition?(console.log("\ud83c\udf11 [IMMEDIATE FADE] Starting fade transition for signpost travel"),console.log("\ud83c\udf11 [DEBUG] transitionFadeControl object:",C),C.startTransition()):(console.warn("\ud83c\udf11 [DEBUG] transitionFadeControl not available or missing startTransition method"),console.log("\ud83c\udf11 [DEBUG] transitionFadeControl value:",C)),console.log("\ud83d\udd0d currentPlayer before checking skills:",e),console.log("\ud83d\udcdc currentPlayer.skills:",e.skills);const{g:L,s:F,f:$}=e.location;if(!("Signpost Town"===t||"Signpost Home"===t||"Signpost Town Home"===t)){v=e.skills.length?e.skills:await o.A.get(`${r.A}/api/inventory/${e.playerId}`).then((e=>e.data.skills||[])),console.log("skillResponse.data: ",v),console.log("currentPlayer = ",e.username);const t=v.some((e=>"Horse"===e.type&&e.quantity>0));if(console.log("hasHorse: ",t),!t){g(15);const t=i.default.getPlayersInGrid(L);if(t&&t[e.playerId]){const n=t[e.playerId].position;c.A.addFloatingText(91,n.x,n.y,y)}return void(null!==C&&void 0!==C&&C.endTransition&&C.endTransition())}}if("Signpost Home"===t){var R,M,j;const t=null===(R=e.backpack)||void 0===R?void 0:R.some((e=>"Home Deed"===e.type&&e.quantity>0)),s=null===(M=e.inventory)||void 0===M?void 0:M.some((e=>"Home Deed"===e.type&&e.quantity>0));if(!t&&!s)return g(109),void(null!==C&&void 0!==C&&C.endTransition&&C.endTransition());const v=null!==(j=e.skills)&&void 0!==j&&j.length?e.skills:await o.A.get(`${r.A}/api/inventory/${e.playerId}`).then((e=>e.data.skills||[]));if(!v.some((e=>"Horse"===e.type&&e.quantity>0))){g(15);const t=i.default.getPlayersInGrid(L);if(t&&t[e.playerId]){const n=t[e.playerId].position;c.A.addFloatingText(91,n.x,n.y,y)}return void(null!==C&&void 0!==C&&C.endTransition&&C.endTransition())}console.log("\ud83c\udfe0 Traveling to homestead:",{gridId:e.gridId,settlementId:e.settlementId,gridCoord:e.gridCoord});try{var D;const t=await(0,l.FV)(e.gridId),r=e.homesteadGridCoord,o={x:t.x+1,y:t.y,g:e.gridId,s:e.settlementId,f:e.location.f,gtype:"homestead",gridCoord:r};g(101),await(0,a.t3)(e,e.location,o,n,h,p,m,f,y,b,g,x,w,S,T,C);!(null===(D=e.trophies)||void 0===D?void 0:D.some((e=>"TraveledToHomestead"===e.type&&e.progress>0)))&&null!==e&&void 0!==e&&e.playerId&&(console.log("\ud83c\udfe0 First time traveling to homestead - awarding trophy and advancing FTUE"),await(0,d.p)(e.playerId,"TraveledToHomestead",1,e,T,n),await(0,u.LQ)("FirstHomesteadVisit",e.playerId,e,n))}catch(B){console.error("\u274c Error traveling home:",B),B.message&&B.message.includes("Failed to remove player from previous grid")?g("Failed to leave current location. Please try again."):g("Error traveling home")}return}if("Signpost Town Home"===t||"Signpost Town"===t){const s="Signpost Town Home"===t,i=s?e.settlementId:F;console.log(s?"Signpost Town Home clicked. Finding the first town grid in the player's owned settlement.":"Signpost Town clicked. Finding the first town grid in the settlement.");const c=(await o.A.get(`${r.A}/api/get-settlement/${i}`)).data;if(!c||!c.grids)return g(104),void(null!==C&&void 0!==C&&C.endTransition&&C.endTransition());const v=c.grids.flat().find((e=>"town"===e.gridType&&e.gridId));if(!v)return g(104),void(null!==C&&void 0!==C&&C.endTransition&&C.endTransition());console.log("Found town grid:",v);try{var O;const t=await(0,l.f0)(v.gridId),r={x:t.x,y:t.y,g:v.gridId,s:i,f:$,gtype:"town",gridCoord:v.gridCoord};g(102),await(0,a.t3)(e,e.location,r,n,h,p,m,f,y,b,g,x,w,S,T,C);!(null===(O=e.trophies)||void 0===O?void 0:O.some((e=>"TraveledToTown"===e.type&&e.progress>0)))&&null!==e&&void 0!==e&&e.playerId&&(console.log("\ud83c\udfd8\ufe0f First time traveling to town - awarding trophy and advancing FTUE"),await(0,d.p)(e.playerId,"TraveledToTown",1,e,T,n),await(0,u.LQ)("FirstTownVisit",e.playerId,e,n))}catch(B){console.error(`\u274c Error traveling to ${s?"player's town":"town"}:`,B),B.message&&B.message.includes("Failed to remove player from previous grid")?g("Failed to leave current location. Please try again."):g("Error traveling to town")}return}console.log("Regular Signpost clicked. Calculating transit options dynamically.");const G=t.replace("Signpost ",""),z={N:[-1,0],S:[1,0],E:[0,1],W:[0,-1],NE:[-1,1],SE:[1,1],SW:[1,-1],NW:[-1,-1]},U=(await o.A.get(`${r.A}/api/get-settlement/${F}`)).data;if(!U||!U.grids)return console.error("Settlement data is invalid or missing grids."),g(105),void(null!==C&&void 0!==C&&C.endTransition&&C.endTransition());console.log(`\ud83d\udd0d [TRANSIT DEBUG] Looking for currentGridId: ${L} in settlement`),console.log(`\ud83d\udd0d [TRANSIT DEBUG] Settlement has ${U.grids.length} rows`),console.log(`\ud83d\udd0d [TRANSIT DEBUG] Total grids in settlement: ${U.grids.flat().length}`);const H=U.grids.flat().find((e=>e.gridId===L));if(!H)return console.error("\u274c Current grid not found in settlement."),console.error("\u274c currentGridId type: "+typeof L),console.error(`\u274c currentGridId value: ${L}`),console.error("\u274c Sample gridIds from settlement:",U.grids.flat().slice(0,5).map((e=>{var t,n;return{gridId:e.gridId,type:typeof e.gridId,match:e.gridId===L,toString:null===(t=e.gridId)||void 0===t?void 0:t.toString(),stringMatch:(null===(n=e.gridId)||void 0===n?void 0:n.toString())===L.toString()}}))),g(105),void(null!==C&&void 0!==C&&C.endTransition&&C.endTransition());if(console.log(`\u2705 [TRANSIT DEBUG] Found current grid in settlement: ${H.gridId}, type: ${H.gridType}, gridCoord: ${H.gridCoord}`),!H.gridCoord)return console.error("No gridCoord found on current grid."),void g(105);g(103);const{frontierTier:q,frontierIndex:V,setRow:W,setCol:Y,gRow:K,gCol:X}=function(e){const t=e.toString().padStart(8,"0");return{frontierTier:parseInt(t.slice(0,2),10),frontierIndex:parseInt(t.slice(2,4),10),setRow:parseInt(t.slice(4,5),10),setCol:parseInt(t.slice(5,6),10),gRow:parseInt(t.slice(6,7),10),gCol:parseInt(t.slice(7,8),10)}}(H.gridCoord),[Z,J]=z[G]||[0,0];let Q=K+Z,ee=X+J,te=W,ne=Y;if(Q<0?(Q=7,te-=1):Q>7&&(Q=0,te+=1),ee<0?(ee=7,ne-=1):ee>7&&(ee=0,ne+=1),te<0||te>7||ne<0||ne>7)return void g(106);const re=(await o.A.get(`${r.A}/api/get-settlement-by-coords/${te}/${ne}`)).data;if(!re||!re.grids)return console.warn("Target settlement not found or invalid."),void g(105);const oe=re.grids[Q][ee];if(console.log("targetGrid = ",oe),null===oe||void 0===oe||!oe.gridId)return console.log("\u274c [TRAVEL FAILED] No valid grid found - ending fade transition"),g(18),void(null!==C&&void 0!==C&&C.endTransition&&C.endTransition());let ae;const se=null===(k=e._id)||void 0===k?void 0:k.toString(),ie=null===(A=e.location)||void 0===A?void 0:A.g,le=null===(I=i.default.getPlayersInGrid(ie))||void 0===I?void 0:I[se],ce=null!==(E=null===le||void 0===le||null===(P=le.position)||void 0===P?void 0:P.x)&&void 0!==E?E:0,de=null!==(_=null===le||void 0===le||null===(N=le.position)||void 0===N?void 0:N.y)&&void 0!==_?_:0;console.log("Current player position:",{x:ce,y:de}),console.log("Direction:",G);const ue=`Signpost ${{NE:"SW",SW:"NE",E:"W",W:"E",SE:"NW",NW:"SE",S:"N",N:"S"}[G]}`;let he=!1;try{const e=await o.A.get(`${r.A}/api/load-grid/${oe.gridId}`),t=(e.data.resources||[]).find((e=>e.type===ue));if(t&&void 0!==t.x&&void 0!==t.y){const e={"Signpost NE":{x:-1,y:1},"Signpost E":{x:-1,y:0},"Signpost SE":{x:-1,y:-1},"Signpost S":{x:0,y:-1},"Signpost SW":{x:1,y:-1},"Signpost W":{x:1,y:0},"Signpost NW":{x:1,y:1},"Signpost N":{x:0,y:1}}[ue]||{x:0,y:0};ae={x:t.x+e.x,y:t.y+e.y},he=!0,console.log(`\u2705 Found opposite signpost ${ue} at (${t.x}, ${t.y}), applying offset (${e.x}, ${e.y}) -> entry position (${ae.x}, ${ae.y})`)}}catch(B){console.warn("Could not fetch opposite signpost position:",B)}he||(["E","W"].includes(G)?(ae={x:"E"===G?0:63,y:de},console.log("No opposite signpost found. Preserving row (Y) for E/W direction:",ae)):["N","S"].includes(G)?(ae={x:ce,y:"N"===G?63:0},console.log("No opposite signpost found. Preserving column (X) for N/S direction:",ae)):(ae=function(e){return s[e]||{x:0,y:0}}(G),console.log("No opposite signpost found. Using default entry position for diagonal:",ae)));const pe={x:ae.x,y:ae.y,g:oe.gridId,s:re._id,f:$,gtype:oe.gridType,gridCoord:oe.gridCoord};await(0,a.t3)(e,e.location,pe,n,h,p,m,f,y,b,g,x,w,S,T,C),console.log(`Player moved to grid ID: ${oe.gridId}`)}catch(B){console.error("Error handling transit:",B.message||B),g("Error during travel.")}}},6857:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(1593);let o=null;const a=new class{constructor(){this.farmState=[]}initializeFarmState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.farmState=e.filter((e=>"farmplot"===e.category&&e.growEnd))}addSeed(e){e.output||console.warn("\u26a0\ufe0f Trying to add a seed without an output! This will break later.",e),this.farmState.push(e)}startSeedTimer(e){let{gridId:t,setResources:n,masterResources:a}=e;o&&clearInterval(o);const s=t;o=setInterval((async()=>{const e=Date.now(),t=this.farmState.filter((t=>t.growEnd<=e));if(t.length>0){let e=0;for(const i of t){if(!this.farmState.some((e=>e.x===i.x&&e.y===i.y&&e.type===i.type))){console.log(`Seed at (${i.x}, ${i.y}) no longer exists in farmState, skipping conversion.`);continue}const t=a.find((e=>e.type===i.output));if(t)try{const o=await(0,r.mQ)(s,{type:t.type,x:i.x,y:i.y},!0);if(null!==o&&void 0!==o&&o.success){const r={...t,x:i.x,y:i.y};n((e=>[...e.filter((e=>!(e.x===i.x&&e.y===i.y))),r])),this.farmState=this.farmState.filter((e=>!(e.x===i.x&&e.y===i.y&&e.type===i.type))),e++,await new Promise((e=>setTimeout(e,120)))}else console.warn(`Failed to update grid resource for seed at (${i.x}, ${i.y}).`)}catch(o){console.error(`Error updating grid resource for seed at (${i.x}, ${i.y}):`,o)}else console.warn(`No target resource found for seed output: ${i.output}`)}}}),1e3)}async forceProcessPendingSeeds(e){let{gridId:t,setResources:n,masterResources:o}=e;const a=Date.now(),s=this.farmState.filter((e=>e.growEnd<=a));if(0===s.length)return!0;try{const e=s.map((async e=>{const n=o.find((t=>t.type===e.output));if(!n)return console.warn(`No target resource found for seed output: ${e.output}`),null;try{const o=await(0,r.mQ)(t,{type:n.type,x:e.x,y:e.y},!0);return null!==o&&void 0!==o&&o.success?{seed:e,enriched:{...n,x:e.x,y:e.y}}:null}catch(a){return console.error(`Error syncing seed at (${e.x}, ${e.y}):`,a),null}})),a=(await Promise.all(e)).filter((e=>null!==e));if(a.length>0){n((e=>{const t=a.map((e=>{let{seed:t}=e;return`${t.x},${t.y}`}));return[...e.filter((e=>!t.includes(`${e.x},${e.y}`))),...a.map((e=>{let{enriched:t}=e;return t}))]}));const e=a.map((e=>{let{seed:t}=e;return t}));this.farmState=this.farmState.filter((t=>!e.includes(t)))}return!0}catch(i){return console.error("\u274c Error during force sync:",i),!1}}stopSeedTimer(){o&&clearInterval(o),o=null,this.farmState=[]}}},6894:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var r=n(5043),o=n(7950),a=n(4255),s=n(7037),i=n(579);let l=[],c=null;const d=()=>{const[e,t]=(0,r.useState)(0),n=(0,s.k)(),u=((0,r.useRef)(Math.floor(1e4*Math.random())),()=>t((e=>e+1)));(0,r.useEffect)((()=>{c=u,d.addFloatingText=function(e,t,r,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const i="number"===typeof e?n[e]||`Missing string for code: ${e}`:e;if(!document.querySelector(".homestead"))return;if(isNaN(t)||isNaN(r))return void console.warn("Invalid coordinates in addFloatingText:",{x:t,y:r});const{centerX:d,centerY:u}=(0,a.il)(t,r,o),h=`${Date.now()}-${Math.floor(1e4*Math.random())}`,p=100;let m=d,f=u;const g=64*o;d<p?m=d+40:d>g-p&&(m=d-40),u<p?f=u+40:u>g-p&&(f=u-40),l.push({id:h,text:i,x:m,y:f,timestamp:Date.now(),color:s.color,size:s.size}),c&&c()}}),[n]);const h=document.querySelector(".homestead");return h?(0,o.createPortal)((0,i.jsx)("div",{className:"floating-text-container",children:l.map((e=>{let{id:t,text:n,x:r,y:o,color:a,size:s}=e;return(0,i.jsx)("div",{className:"floating-text",style:{position:"absolute",left:r,top:o-30,transform:"translate(-50%, -50%)",color:a||void 0,fontSize:s||void 0},onAnimationEnd:e=>{e.target.style.display="none",l=l.filter((e=>e.id!==t)),c&&c()},children:n},t)}))}),h):null};d.addFloatingText=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.warn("FloatingTextManager not ready yet",...t)};const u=d},7037:(e,t,n)=>{"use strict";n.d(t,{s:()=>y,k:()=>v});var r=n(5043),o=n(7544);const a=JSON.parse('{"0":"Secrets of Elsinore","1":"Le serveur ne fonctionne pas.","2":"Carte de la Fronti\xe8re","3":"Terrain labour\xe9 avec succ\xe8s.","4":"\u26a0\ufe0f Vous n\'avez pas assez de ressources.","5":"\u2692\ufe0f Construction termin\xe9e avec succ\xe8s.","6":"\ud83d\udcb0 Objets vendus.","7":"\ud83c\udfe0 Ce domaine est inoccup\xe9.","8":"\ud83d\udeab Cette zone est interdite.","9":"La Vall\xe9e regorge de merveilles, et doit \xeatre explor\xe9e \xe0 pied.","10":"\ud83c\udfe0 Domaine de [username].","11":"\ud83c\udfe0 Domaine d\'un propri\xe9taire inconnu.","12":"Vue de la colonie. Selon votre position, vous devrez peut-\xeatre faire d\xe9filer pour voir la ville.","13":"Vue de la fronti\xe8re.","14":"\ud83d\udc78 Bienvenue en ville.","15":"\ud83d\udc34 Vous avez besoin d\'un Cheval pour voyager ici. Visitez le Camp d\'Aventure en Ville.","16":"Vous \xeates dans la vall\xe9e.","17":"Vous ne poss\xe9dez pas de domaine ici.","18":"\ud83d\udeab Vous ne pouvez pas aller par l\xe0.","19":"\ud83c\udf92 Vous avez besoin d\'un sac \xe0 dos pour collecter des ressources loin de votre domaine. Achetez-en un au Camp d\'Aventure.","20":"\ud83d\udeab Pas assez de place dans l\'entrep\xf4t.","21":"\ud83c\udf92 Pas assez de place dans le sac \xe0 dos. Ouvrez l\'inventaire pour g\xe9rer son contenu.","22":"Objets achet\xe9s.","23":"\u26a0\ufe0f Vous ne pouvez pas construire cela ici.","24":"\ud83c\udfaf Hors de port\xe9e","25":"\ud83c\udf92 Rien dans le sac \xe0 dos.","26":"\ud83c\udf92 Vous devez \xeatre \xe0 votre domaine pour vider votre sac \xe0 dos.","27":"\u26fa\ufe0f Vous n\'avez pas de tente.","28":"\u26fa\ufe0f Vous campez maintenant.","29":"\u26a0\ufe0f \u26fa\ufe0f \xc9chec lors du camping / d\xe9camping.","30":"\u26fa\ufe0f Vous ne campez plus.","31":"\u26fa\ufe0f Impossible d\'attaquer en campant.","32":"\u26fa\ufe0f Vous devez d\xe9camper d\'abord.","33":"\ud83d\udce6 Objets d\xe9plac\xe9s dans l\'entrep\xf4t.","34":"\ud83c\udf92 Sac \xe0 dos vid\xe9.","35":"Vous avez besoin d\'un(e) ","36":"Vous avez utilis\xe9 un(e) ","37":"\ud83d\udef6 Vous n\'avez pas de bateau.","38":"Info Joueur :","40":"Impossible d\'attaquer \xe0 travers les murs.","41":"Vous \xeates rassasi\xe9","42":"Rapporte : ","44":"Pas de sac \xe0 dos","45":"Kent ach\xe8tera ces marchandises :","46":"Kent revient dans :","47":"Je peux acheter des marchandises de vous.","48":"Besoin de conseils ?","49":"Soins restants :","50":"\ud83d\udeab Ce nom d\'utilisateur est d\xe9j\xe0 pris.","51":"Total Soins : ","70":"Session expir\xe9e","71":"Vous \xeates absent depuis un moment. Actualiser garantit le bon fonctionnement de votre session.","72":"Cette page s\'actualisera automatiquement dans 30 secondes sauf si vous le faites maintenant.","73":"\ud83d\udd04 Actualiser maintenant","74":"\ud83c\udf92 Un sac \xe0 dos est n\xe9cessaire pour poss\xe9der une tente.","75":"Vous ne poss\xe9dez pas de sac \xe0 dos. Vous pouvez en acheter un au Camp d\'Aventure en ville.","76":"Votre entrep\xf4t est vide.","77":"Votre sac \xe0 dos est vide.","78":"\ud83c\udf7d\ufe0f Manger","80":"Acquis ","81":"Monter une tente en Ville ou dans la Vall\xe9e vous emp\xeache d\'\xeatre attaqu\xe9.","82":"Un bateau vous permettra de voyager sur l\'eau.","88":"Votre entrep\xf4t est \xe0 sa capacit\xe9 maximale.","89":" capacit\xe9 avec le Pass Or","90":"\ud83d\udeab Ce n\'est pas votre domaine.","91":"\ud83d\udc34 Cheval requis.","94":"\ud83d\udce2 Partagez \'Secrets of Elsinore\' !","95":"Invitez d\'autres personnes \xe0 aider et rejoindre l\'aventure !","96":"Vous avez des commentaires ?","97":"@ Nous contacter par e-mail","98":"\u23f3 Chargement ...","99":"\u26a0\ufe0f Une erreur s\'est produite.","100":"CHA\xceNES DE VOYAGE :","101":"\ud83d\udc34 Voyage vers la maison... veuillez patienter.","102":"\ud83d\udc34 Voyage vers la ville... veuillez patienter.","103":"\ud83d\udc34 Voyage vers la prochaine destination... veuillez patienter.","104":"\ud83d\udeab Il n\'y a pas encore de ville dans cette colonie.","105":"\u26a0\ufe0f Un probl\xe8me est survenu lors du voyage.","106":"\ud83d\udeab Vous ne pouvez pas voyager au-del\xe0 de la fronti\xe8re.","107":"Votre Propri\xe9t\xe9","108":"Votre Ville","110":"\u27a1\ufe0f Marchez sur les panneaux pour les utiliser","111":"\ud83d\udc78 Bienvenue en ville.","112":"\ud83c\udfe0 Bienvenue \xe0 la maison.","120":"Vous n\'avez plus de d\xe9placements de domaine disponibles.","121":"Vous avez d\xe9plac\xe9 votre domaine avec succ\xe8s.","122":"Vous ne pouvez pas d\xe9m\xe9nager dans la vall\xe9e !","123":"Vous ne pouvez pas d\xe9m\xe9nager en ville !","124":"Ce domaine est d\xe9j\xe0 occup\xe9.","125":"O\xf9 souhaitez-vous d\xe9m\xe9nager ?","126":"Ce domaine est inoccup\xe9.","130":"S\xe9lectionnez votre langue","131":"Confirmer","140":"TEXTES DE L\'\xc9TAL DE COMMERCE :","141":"Vendu","151":"Vous ne pouvez pas remplir l\'\xe9tal d\'un autre joueur.","152":"Vous n\'avez pas assez d\'argent pour acheter cet objet.","153":"vend :","154":"vendent","155":"Transaction \xe9chou\xe9e. Cet objet a d\xe9j\xe0 \xe9t\xe9 vendu.","156":"Vide (ajouter des objets)","157":"Achet\xe9 par","158":" LIMITE PAR COMMANDE","159":"Pr\xeat \xe0 vendre","160":"\ud83d\udce5 Comptoir Commercial : Ajouter des Objets \xe0 Vendre","161":"Article","162":"Vous Avez","163":"Prix unit.","164":"Quantit\xe9 \xe0 Ajouter","165":"Tout","166":"Ajouter","167":"Vendre","168":"Oui, Vendre Tout","169":"Acheter","170":"Emplacement de commerce d\xe9verrouill\xe9","171":"Pass Or Requis","172":"Verrouill\xe9","173":"Limite de","174":"pour Vendre","175":"D\xe9bloquer pour","176":"Bois","177":"Besoin de","178":"pour d\xe9bloquer cet emplacement","179":"Ce Poste n\'accepte que les articles de votre sac \xe0 dos. Tout joueur peut collecter de l\'argent d\'un Poste.","180":"Vers le Sac \xe0 Dos","181":"\ud83d\udce6 Entrep\xf4t","182":"\ud83c\udf92 Sac \xe0 dos","183":"Capacit\xe9 : ","184":"G\xe9rer","185":"Quantit\xe9","186":"Montant","187":"\ud83c\udf92 Gestion du Sac \xe0 Dos","188":"Jeter","189":"Tout ajouter \xe0 l\'entrep\xf4t","190":"Tout jeter","191":"Article","192":"Action","193":"\ud83d\udce6 Gestion de l\'Entrep\xf4t","194":"Agrandir","195":"Agrandir le Sac \xe0 dos au Camp d\'Aventure en Ville.","196":"Ajouter ","197":"Entrep\xf4t am\xe9lior\xe9","198":" \xe0 la capacit\xe9 de l\'entrep\xf4t.","199":"Capacit\xe9 consid\xe9rablement augment\xe9e avec le Pass Or (parmi d\'autres avantages).","200":"QUESTS","201":"\u2705 Qu\xeate termin\xe9e. Vous avez re\xe7u votre r\xe9compense.","202":"\u2705 Qu\xeate accept\xe9e.","203":"Aucune qu\xeate active pour le moment.","204":"propose ces qu\xeates :","205":"Rien de nouveau pour le moment. Consultez votre liste \u2705 \xc0 faire !","206":"Retournez voir le PNJ qui vous a donn\xe9 cette qu\xeate pour recevoir votre r\xe9compense.","207":"En cours","208":"Obtenir la r\xe9compense","209":"Accepter la qu\xeate","299":"FARMING STRINGS:","300":"\u2705 Ajout\xe9","301":"Labour\xe9","302":"\ud83c\udf31 Plant\xe9","303":"\ud83c\udf31 Doit \xeatre plant\xe9 sur de la terre","304":"\ud83c\udf31 Impossible de planter ici","305":"\u26a0\ufe0f Pas assez de ressources","306":"\u26a0\ufe0f Impossible de construire ici","307":"\ud83c\udf31 Doit \xeatre plant\xe9 sur de la mousse","308":"\ud83c\udf31 Doit \xeatre plant\xe9 sur du sable","310":"Vous devez labourer la terre pour planter.","311":"Vos animaux de ferme auront besoin de beaucoup d\'herbe pour pa\xeetre.","312":"Le pavage peut \xeatre utile pour contr\xf4ler les animaux errants.","313":"Les chemins pav\xe9s ajoutent de la d\xe9coration \xe0 votre ferme.","315":"S\xe9lectionnez les cultures \xe0 r\xe9colter :","316":"Tout s\xe9lectionner","317":"Tout d\xe9s\xe9lectionner","318":"Collecter","319":"S\xe9lectionnez les animaux \xe0 collecter :","320":"Impossible de terraformer ici.","340":"Non disponible \xe0 moins d\'\xeatre \xe0 pied.","341":"S\xe9lectionner les Stations d\'Artisanat \xe0 Collecter:","342":"R\xe9colter ?","343":"Replanter ?","344":"Aucune culture pr\xeate \xe0 r\xe9colter.","345":"Pr\xeat \xe0 collecter :","346":"Collecter ?","347":"Acheter 1 pour : ","350":"L\'Ouvrier Agricole vous aidera \xe0 automatiser la r\xe9colte et la plantation des cultures.","351":"Le Rancher vous aidera \xe0 automatiser la collecte des animaux.","352":"Le B\xfbcheron vous aidera \xe0 automatiser la coupe d\'arbres pour le bois.","353":"L\'Artisan vous aidera \xe0 automatiser la collecte des stations d\'artisanat.","354":"Kent est votre Gestionnaire de Ferme. Il peut vous aider \xe0 g\xe9rer votre ferme.","355":"Le Berger vous guidera dans la gestion de vos animaux de ferme.","356":"R\xe9sultats de R\xe9colte en Masse","357":"Cultures R\xe9colt\xe9es","358":"Cultures Replant\xe9es","359":"Objets Trouv\xe9s !","360":"Continuer","361":"Graines utilis\xe9es","362":"March\xe9 Mondial","363":"Aucun article actuellement disponible \xe0 l\'achat","364":"articles disponibles","365":"Acheter","366":"Fermer","367":"Vos Emplacements de Commerce:","368":"Envoyer \xe0 la Maison","369":"Envoyez des articles de votre sac \xe0 dos directement \xe0 votre entrep\xf4t chez vous.","400":"BUYING, CRAFTING, SKILLS, HEALING, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Vous avez d\xe9j\xe0 tous vos points de vie.","402":"\u26a0\ufe0f ressources.","403":"\u26a0\ufe0f Votre inventaire est plein.","404":"Travail en cours...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Points de vie soign\xe9s de +","406":"Maximum atteint pour cet emplacement.","407":"Maximum atteint pour cet emplacement.","408":"Besoin de plus d\'H\xf4pitaux.","410":"\ud83c\udfd5\ufe0f Pour utiliser une tente achet\xe9e, cliquez sur votre ic\xf4ne de joueur.","420":"\xc9changes :","421":"Utilis\xe9 dans :","422":"Valeur de base :","423":"Aucun \xe9change disponible.","424":"Aucune recette disponible.","425":"Vendre pour remboursement.","426":"Si vous avez moins de 10 de ces cultures, vous pouvez les acheter ici :","427":"Achetez la comp\xe9tence de R\xe9colte group\xe9e du Fermier pour r\xe9colter toutes les cultures en une seule fois.","428":"Cliquez pour r\xe9colter instantan\xe9ment toutes les cultures.","429":"Vous n\u2019avez aucune culture \xe0 r\xe9colter.","430":"Comp\xe9tences du Fermier :","431":"Achetez la comp\xe9tence de Collecte animale group\xe9e du Fermier pour collecter tous les animaux d\u2019un coup.","432":"Achetez la comp\xe9tence de B\xfbcheronnage du Fermier pour couper plusieurs arbres \xe0 la fois et r\xe9colter le bois.","433":"Achetez Am\xe9lioration du b\xfbcheronnage pour augmenter le nombre d\u2019arbres coup\xe9s en une fois.","434":"Cliquez pour collecter instantan\xe9ment tous les animaux.","435":"Cliquez pour couper instantan\xe9ment plusieurs arbres et r\xe9colter du bois.","436":"Vous n\u2019avez aucun animal \xe0 collecter.","437":"Vous n\u2019avez aucun arbre \xe0 couper.","438":"Retirer","439":"Culture r\xe9cup\xe9r\xe9e.","440":"Fabrication commenc\xe9e ","441":"\u231b\ufe0f  En cours ...","442":"\ud83c\udfe0 R\xe9parations de la maison termin\xe9es !","450":"\u274c Impossible de payer les frais de fabrication","451":"\u26a0\ufe0f Fabrication d\xe9j\xe0 en cours","452":"\u274c \xc9chec du d\xe9marrage de la fabrication.","453":"\u274c \xc9chec de la r\xe9paration de la maison.","454":"\u274c \xc9chec de l\u2019embauche de l\u2019ouvrier.","455":" est arriv\xe9(e) !","456":"Plus aucun ouvrier disponible.","457":"Pr\xeat \xe0 collecter !","458":"Temps : ","459":"Instantan\xe9","460":"N\xe9cessite : ","461":"Co\xfbte : ","462":"Donne : ","463":"Soigne : ","464":"Achetez l\'Artisanat en masse pour collecter depuis toutes les stations d\'artisanat pr\xeates en une seule fois.","465":"Cliquez pour collecter instantan\xe9ment depuis toutes les stations d\'artisanat pr\xeates.","466":"Vous n\'avez aucune station d\'artisanat pr\xeate pour la collecte.","467":"Fabrication en masse","468":"Red\xe9marr\xe9 : ","469":"+","470":"Impossible de voyager maintenant, des actions agricoles sont en cours.","471":"\u26a0\ufe0f D\xe9j\xe0 en cours.","472":"R\xe9colt\xe9","475":"Red\xe9marrer ?","476":"Station","477":"Vos ouvriers agricoles sont occup\xe9s...","478":"\ud83c\udf31 Au travail","479":"Exploitation Foresti\xe8re","480":"Fabriqu\xe9","481":"avec","482":"appliqu\xe9","483":"replant\xe9","490":"Vendre pour remboursement (Dev seulement)","500":"COMBAT STRINGS","501":"\ud83c\udfaf Hors de port\xe9e.","502":"\ud83c\udfaf Touch\xe9 !","503":"\u274c Rat\xe9","504":"\ud83d\udc80 Tu\xe9","505":"\u26a0\ufe0f Erreur","510":"\u2764\ufe0f\u200d\ud83e\ude79 Vous subissez des d\xe9g\xe2ts...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Votre Sant\xe9 : ","512":"Votre Sant\xe9 Indisponible","520":"Vous devez \xeatre en ville ou chez vous pour \xe9quiper des armes et armures.","522":"\ud83d\udee1\ufe0f Armure \xe9quip\xe9e :","523":"Aucune armure disponible","524":"\u2694\ufe0f Arme \xe9quip\xe9e :","525":"Aucune arme disponible","526":"Enchantements magiques :","527":"Aucun enchantement magique disponible","528":"Autre \xe9quipement :","550":"\ud83d\udee1\ufe0f Sant\xe9 maximale","551":"\ud83d\udee1\ufe0f Classe d\'armure","552":"\ud83c\udfaf Bonus d\'attaque","553":"\u2694\ufe0f D\xe9g\xe2ts","554":"\u2694\ufe0f Vitesse","555":"\ud83d\udc41\ufe0f Port\xe9e d\'attaque","556":"\u26fa\ufe0f En train de camper","557":"\ud83d\udef6 Dans le bateau","558":"Oui","559":"Non","600":"CHA\xceNES DE RELATION :","601":"Relation :","602":"Vous avez rencontr\xe9","603":"Vous \xeates maintenant ami avec","604":"Vous avez un coup de c\u0153ur pour","605":"Vous \xeates amoureux de","606":"Vous et","607":"\xeates maintenant mari\xe9s.","608":"\xeates maintenant rivaux.","609":"est d\xe9sormais votre rival \xe0 cause de cela.","610":"ne va pas \xeatre tr\xe8s content de cela...","611":"ne vont pas \xeatre tr\xe8s contents de cela...","612":"sera tr\xe8s heureux de cela.","613":"approuvent cela.","614":"et","615":"Votre relation avec","616":"a chang\xe9.","619":"Int\xe9r\xeats :","620":"Vous devez vous rapprocher pour interagir avec ce personnage.","621":"pour \xeatre mari\xe9(e)s.","622":"pour \xeatre amis.","623":"pour \xeatre amoureux.","625":"D\xe9veloppez une relation pour d\xe9bloquer des t\xe2ches avec ce personnage.","626":"D\xe9veloppez une relation pour d\xe9bloquer des \xe9changes avec ce personnage.","627":"Avec une meilleure relation, {npc} pourrait avoir des t\xe2ches suppl\xe9mentaires pour vous.","628":"Avec une meilleure relation, {npc} pourrait avoir des \xe9changes suppl\xe9mentaires pour vous.","630":"Saluer","631":"Parler","632":"\xc9changer","633":"Qu\xeate","634":"Rencontr\xe9","635":"Ami","636":"Mari\xe9","637":"Rival","638":"Amour","639":"B\xe9guin","640":"Plaisanter","641":"Se lier d\'amiti\xe9","642":"Insulter","643":"C\xe2liner","644":"Embrasser","645":"S\'excuser","646":"Offrir un cadeau","647":"Complimenter","648":"Flatter","649":"D\xe9clarer son amour","650":"Demander en mariage","651":"Narguer","652":"Taquiner","653":"Divorcer","660":"Amoureux de : ","661":"Ami(e) de : ","662":"Rival(e) de : ","663":"Mari\xe9(e) \xe0 : ","700":"CHA\xceNES FTUE :","701":"\ud83d\udc78 Bienvenue \xe0 Secrets of Elsinore","702":"Bienvenue, voyageur ! Vous \xeates arriv\xe9 \xe0 Elsinore, une terre frontali\xe8re pleine d\'opportunit\xe9s, de myst\xe8res et d\'aventures.","705":"Aspiration","706":"Elsinore est un grand monde. C\'est \xe0 vous de d\xe9cider comment vous voulez passer votre temps. Laquelle de ces aspirations convient le mieux \xe0 votre style de jeu ? (Ce choix ne limitera en aucune fa\xe7on vos options.)","721":"\ud83e\udd20 R\xe9colter et vendre des cultures","722":"Vous voudrez commencer \xe0 gagner de l\'\ud83d\udcb0 Argent tout de suite. R\xe9coltez du \ud83c\udf3e Bl\xe9, puis vendez-le \xe0 \ud83e\udd20 Kent.","723":"\ud83d\udcaa Comp\xe9tence de cultivateur","724":"Cha-ching ! Maintenant, pour tirer le meilleur parti de votre ferme, acqu\xe9rez la comp\xe9tence \ud83d\udcaa Cultivateur.","727":"\ud83c\udf3d Plantation","728":"Super, maintenant commencez \xe0 cultiver ! Vous pouvez planter de nouvelles cultures en utilisant le panneau \ud83c\udf3d Agriculture.","729":"\ud83d\udc2e Vie animale","730":"Excellent ! Pendant que \xe7a pousse, apportons de la vie \xe0 la ferme. D\'abord, acqu\xe9rez la comp\xe9tence \ud83d\udcaa \xc9levage. Ensuite, visitez le panneau \ud83d\udc2e Animaux pour acheter une vache.","731":"\ud83c\udf33 Bois","732":"Merveilleux ! Elsinore est riche en for\xeats. Le bois est une ressource vitale pour l\'artisanat et la construction. Pour couper des arbres, vous devrez acqu\xe9rir la comp\xe9tence \ud83d\udcaa Hache.","733":"\u2692\ufe0f Constructeur","734":"Bien, vous avez obtenu la \ud83e\ude93 Hache ! En plus de construire des stations d\'artisanat, vous pouvez aussi vous frayer un chemin jusqu\'\xe0 la \ud83d\ude82 Gare au bout de votre Homestead. Utilisez le \u27a1\ufe0f Poteau indicateur pour voyager en ville.","737":"Il est temps d\'explorer","738":"Votre Homestead fait partie d\'une colonie plus grande avec d\'autres joueurs partageant une vaste Fronti\xe8re. Utilisez les \ud83c\udfdb\ufe0f Poteaux indicateurs pour voyager, ou marchez jusqu\'au bord de n\'importe quelle carte. AMUSEZ-VOUS \xc0 JOUER !","740":"Je me suis r\xe9veill\xe9 d\'un \xe9trange cauchemar, pour me retrouver dans une for\xeat sombre, devant l\'entr\xe9e d\'une grotte.","741":"Utilisez les touches A-W-S-D (ou les fl\xe8ches) pour d\xe9placer votre personnage et trouvez la sortie de la grotte.","742":"Cela ressemble \xe0 l\'entr\xe9e d\'une ville. Saluez le Constable qui garde la porte.","750":"\ud83c\udf3d Fermier","751":"Cultivez votre ferme, faites pousser des cultures, occupez-vous des animaux et fabriquez des biens \xe0 vendre et \xe9changer avec d\'autres joueurs. Investissez dans les comp\xe9tences agricoles et artisanales pour augmenter vos profits.","752":"\u2694\ufe0f Aventurier","753":"Aventurez-vous dans la Vall\xe9e pour des ressources et des objets rares. Combattez des animaux et des cr\xe9atures, d\xe9couvrez des lieux cach\xe9s et rencontrez des personnages magiques. Investissez dans les comp\xe9tences de combat pour devenir un combattant redoutable.","754":"\ud83c\udfdb\ufe0f Politicien","755":"Pr\xe9sentez-vous comme Maire, fixez le taux d\'imposition et gagnez des revenus fiscaux pour vous-m\xeame. Investissez dans des b\xe2timents communautaires pour toute la Ville, comme des H\xf4pitaux, des \xc9coles et des Biblioth\xe8ques, et aidez votre colonie \xe0 prosp\xe9rer.","780":"Dites-nous ce que vous pensez de Elsinore","781":"Je continuerai \xe0 jouer ; voici pourquoi (cochez toutes les r\xe9ponses applicables) :","782":"Je doute que je reviendrai ; voici pourquoi (cochez toutes les r\xe9ponses applicables) :","783":"Jouer","784":"\xc7a a l\'air amusant","785":"J\'aime les visuels","786":"J\'aime l\'agriculture","787":"J\'ai h\xe2te de collaborer avec les autres","790":"Je n\'ai pas pu comprendre","791":"Je n\'aime pas les visuels","792":"J\'ai eu un probl\xe8me technique","793":"Ce n\'est tout simplement pas pour moi","794":"Jouer","795":"Passer le Tutoriel","796":"OK","797":"Retour","798":"Jouer","800":"PLUS DE CHA\xceNES DE STATION D\'ARTISANAT :","801":"Acqu\xe9rez la comp\xe9tence ","802":" au ","803":" pour augmenter la production de cette station de ","805":"Votre comp\xe9tence ","806":" augmente la production de base de cette station de ","810":"Vous pouvez aussi acheter cette comp\xe9tence directement : ","811":"Niveau sup\xe9rieur !","812":"F\xe9licitations ! Vous avez atteint le niveau {level} !","813":"Niveau sup\xe9rieur ! Vous \xeates maintenant niveau {level} !","814":"{feature} se d\xe9bloque au niveau {level}.","815":"Votre niveau actuel : {level}","820":"Produit : ","821":"Quantit\xe9 de base : ","825":"Vous avez ","826":"Parchemins.","827":"Parchemin","828":"Vous avez d\xe9j\xe0 ceci.","829":"R\xe9v\xe9lation du parchemin...","830":"\xc9chec de la r\xe9v\xe9lation du parchemin","831":"R\xe9v\xe9ler","832":"Vous avez besoin de parchemins pour utiliser le Temple Ancien. Trouvez des parchemins en explorant le monde.","899":"DEBUG STRINGS:","900":"Debug : Inventaire vid\xe9.","901":"Debug : Historique des qu\xeates r\xe9initialis\xe9.","902":"Debug : Ressources ajout\xe9es.","903":"Debug : Grille r\xe9initialis\xe9e avec succ\xe8s.","904":"Debug : Comp\xe9tences ajout\xe9es.","905":"Debug : Comp\xe9tences et pouvoirs r\xe9initialis\xe9s.","906":"Debug : Statistiques de combat r\xe9initialis\xe9es.","999":"PANEL UI STRINGS:","1000":"[Description needed]","1001":"Les ressources collect\xe9es \xe0 la ferme vont dans l\'entrep\xf4t. Les ressources collect\xe9es en ville ou dans la vall\xe9e iront dans le sac \xe0 dos. Pour acheter un sac \xe0 dos, visitez le Magasin en ville.","1002":"Construction : Construisez des ateliers sur votre domaine en utilisant les ressources de votre entrep\xf4t.","1003":"Les animaux achet\xe9s appara\xeetront \xe0 votre ic\xf4ne de joueur et commenceront imm\xe9diatement leur vie sur le domaine.","1004":"Labourez la terre pour planter des cultures. Plantez de l\'herbe pour nourrir les animaux de la ferme.","1005":"Acqu\xe9rez des Comp\xe9tences pour am\xe9liorer divers attributs. Assurez-vous d\'explorer la Ville pour trouver d\'autres endroits et fa\xe7ons d\'acqu\xe9rir des Comp\xe9tences.","1006":"G\xe9rez toutes vos qu\xeates en cours ici. Cherchez des donneurs de qu\xeates sur votre domaine, en ville, ou m\xeame dans la vall\xe9e.","1007":"Les gouvernements \xe0 Elsinore se forment au niveau des colonies. Le maire \xe9lu met en place des politiques et construit des b\xe2timents pour aider la communaut\xe9 \xe0 prosp\xe9rer.","1008":"Achetez et vendez avec d\'autres joueurs. Si personne n\'ach\xe8te vos articles avant la fin du minuteur, vendez-les au jeu.","1009":"[Crafting description]","1010":"[Mailbox description]","1011":"Cet enclos est vide. Assurez-vous que les animaux ont de l\'herbe \xe0 manger, ils viendront alors \xe0 l\'enclos pour \xeatre r\xe9colt\xe9s.","1012":"Les \xe9lections ont lieu au tribunal. Ici, les maires peuvent fixer le taux d\'imposition et renommer la colonie.","1013":" ","1014":" ","1015":"Le jeu se d\xe9roule au fil des saisons changeantes.","1016":" ","1017":"Visitez la banque pour \xe9changer des objets contre de l\'argent, y compris des objets rares comme l\'or et l\'argent. Revenez r\xe9guli\xe8rement \xe0 la banque pour de nouvelles offres.","1018":"","1019":"[Profile description]","1021":"\xa9 Valley View Studios, 2025, All Rights Reserved.","1022":"[Train description]","1023":"Les ouvriers vous aident \xe0 g\xe9rer votre ferme. Embauchez-les \xe0 la Ferme.","1024":"[Combat description]","1025":"[Shop description]","1026":"Gagner et d\xe9penser de l\'Argent.","1027":"Voici les avantages d\'un compte Or.","1028":" ","1029":"[Panneau des animaux]","1030":"[Panneau des cultures]","1031":"Achetez des d\xe9corations pour votre propri\xe9t\xe9. Vous pourrez les revendre pour un remboursement complet.","1032":"La maison de ferme est l\u2019endroit o\xf9 vous pouvez embaucher des personnes pour vous aider \xe0 g\xe9rer votre propri\xe9t\xe9.","1033":"Fa\xe7onnez la terre avec ces outils. Les animaux ont besoin d\u2019herbe pour pa\xeetre, les cultures ont besoin de terre pour pousser. Le pavage peut \xeatre utile pour contr\xf4ler les d\xe9placements des animaux et des personnages.","1034":"Gagner et d\xe9penser des Gemmes.","1035":"Ceci est votre collection de Troph\xe9es \xe0 vie.","1036":"R\xe9v\xe9lez des parchemins myst\xe9rieux dans ce Temple Ancien.","1037":"Participez au Carnaval avec d\'autres dans votre Village. Compl\xe9tez toutes les commandes en \xe9quipe pour gagner des prix.","1038":"Continuez \xe0 v\xe9rifier avec Kent pour vendre vos marchandises.","1039":"Acqu\xe9rez ces animaux de zoo pour peupler votre propri\xe9t\xe9 et d\xe9terrer des objets rares.","1040":"D\xe9couvrez votre classement par rapport aux autres joueurs de la fronti\xe8re.","1101":"Inventaire","1102":"\u2692\ufe0f Construire","1103":"\ud83d\udc2e Animaux","1104":"\ud83c\udf3d Agriculture","1105":"\ud83d\udcaa Comp\xe9tences","1106":"\u2753 Qu\xeates","1107":"\ud83c\udfdb\ufe0f Gouvernement","1108":"\ud83d\udce5 \xc9tal de commerce","1109":"Artisanat","1110":"\ud83d\udcea Bo\xeete aux lettres","1111":"\ud83d\udc3e Animaux","1112":"\ud83c\udfdb\ufe0f Tribunal","1113":"Personnage assistant","1114":"Personnage joueur","1115":"\ud83d\uddd3\ufe0f Saison","1116":"\ud83d\udd01 Marchand","1117":"\ud83c\udfe6 Banque","1118":"\ud83d\udd79\ufe0f Comment jouer","1119":"Profil","1120":"\ud83d\udc1e D\xe9bogage","1121":"\ud83d\ude00 Bienvenue","1122":"\ud83d\ude82 Train","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Ouvriers agricoles","1124":"\u2694\ufe0f Combat","1125":"\ud83d\uded2 Boutique","1126":"\ud83d\udcb0 \xc0 propos de l\'argent","1127":"\u2b50\ufe0f Pass Or","1128":"\ud83e\ude91 D\xe9corations","1129":"\ud83d\udc3e Animaux","1130":"\ud83c\udf3d Cultures et arbres","1131":"\ud83e\udeb4 D\xe9corations","1132":"\ud83c\udfe0 Maison de ferme","1133":"\u26cf\ufe0f Outils","1134":"\ud83d\udc8e Gemmes","1135":"\ud83c\udfc6 Troph\xe9es","1136":"\ud83d\uded5 Temple Ancien","1137":"\ud83c\udfa1 Carnaval","1138":"\ud83e\udd20 Kent","1139":"\ud83d\udc12 Animaux du Zoo","1140":"\ud83d\udcca Classement","1141":"\ud83d\udce5 Avant-poste","1190":"\u2699\ufe0f Param\xe8tres","1301":"Comp\xe9tences \xe0 acheter :","1302":"Am\xe9liorations \xe0 acheter :","1303":"Comp\xe9tences poss\xe9d\xe9es :","1304":"Am\xe9liorations poss\xe9d\xe9es :","1305":"Vous n\'avez pas encore de comp\xe9tences.","1306":"Vous n\'avez pas encore d\'am\xe9liorations.","1350":"TEXTES CARNAVAL","1351":"Afficher Journal du Carnaval","1352":"Le Carnaval est","1400":"MODAL STRINGS","1401":"BANK MODAL","1402":"Ces offres sont valables pendant","1403":"Ach\xe8tera","1404":"pour","1405":"Aucune offre disponible.","1406":"Nouvelles offres dans","1407":"G\xe9n\xe9ration de nouvelles commandes. Merci de votre patience.","1408":"\u26a0\ufe0f Vous n\'avez pas assez d\'objets.","1409":"\u26a0\ufe0f Vous n\'avez pas assez de comp\xe9tences.","1410":"\u26a0\ufe0f Vous n\'avez pas assez d\'am\xe9liorations.","1500":"TOWN NEWS STRINGS:","1501":"Nouvelles de la colonie","1502":"Le maire actuel est","1503":", et le taux d\'imposition est","1504":"Voici ce qui se passe actuellement en ville :","1505":"C\'est la saison des \xe9lections et la campagne bat son plein. Passez au tribunal en ville pour vous pr\xe9senter comme maire.","1506":"Le vote pour le prochain maire a commenc\xe9. Votez au tribunal en ville.","1507":"Le train arrive, il ach\xe8te :","1508":"Le train part. \xc0 son retour, il ach\xe8tera :","1509":"Le train est l\xe0, il ach\xe8te :","1510":" ","1511":"Visitez la banque pour vendre de l\'or, de l\'argent et des diamants. La banque met actuellement \xe0 jour ses offres.","1512":"Il n\'y a actuellement pas de maire.","1513":"Le train part dans","1514":"\xc0 son retour, il ach\xe8tera :","1515":"Le taux d\'imposition est","1516":"La banque ach\xe8te actuellement :","1517":"Le train partira dans","1518":"Les votes de la derni\xe8re \xe9lection pour le maire sont en cours de comptage. R\xe9sultats attendus dans ","1600":"MAILBOX STRINGS:","1601":"Chargement des messages...","1602":"Vous n\'avez aucun message.","1603":"Re\xe7u","1604":"R\xe9cup\xe9rer","1605":"La plupart des messages seront supprim\xe9s apr\xe8s 14 jours. Les achats en boutique ne seront pas supprim\xe9s.","1606":"\ud83d\udcea Mailbox","1607":"\ud83d\uddd1\ufe0f Message supprim\xe9.","1700":"STORE STRINGS:","1701":"\ud83d\uded2 Store","1702":"Les achats seront livr\xe9s dans la bo\xeete de r\xe9ception.","1703":"\ud83d\ude4f Merci pour votre soutien ! Nous sommes une petite \xe9quipe avec peu de ressources, mais passionn\xe9s par la cr\xe9ation d\'un espace convivial pour une communaut\xe9 positive.","1704":"Merci de soutenir le jeu par vos achats afin que nous puissions continuer \xe0 l\'am\xe9liorer.","2000":"TRAIN, BANK, COURTHOUSE, etc. STRINGS:","2002":"\u2705 Termin\xe9","2003":"\ud83d\ude82 Aper\xe7u de la prochaine livraison :","2004":"\ud83c\udf81 R\xe9compenses pour avoir rempli toutes les commandes :","2005":"Cliquez pour remplir","2006":"Votre commande","2007":"R\xe9clam\xe9","2008":"R\xe9clamer la commande","2009":"R\xe9clam\xe9 par vous :","2010":"Disponible \xe0 r\xe9clamer :","2011":"R\xe9clam\xe9 par d\'autres :","2012":"Termin\xe9 :","2013":"R\xe9clam\xe9 par vous :","2014":"Vous ne pouvez accepter qu\u2019une offre de train \xe0 la fois.","2015":"Afficher le journal du train","2016":"\u2705 Toutes les commandes ont \xe9t\xe9 compl\xe9t\xe9es ! Les r\xe9compenses ont \xe9t\xe9 envoy\xe9es par courrier.","2017":"Cette commande a d\xe9j\xe0 \xe9t\xe9 r\xe9clam\xe9e.","2018":"\ud83c\udfa1 Aper\xe7u du Prochain Carnaval :","2019":"R\xe9compenses pour avoir rempli toutes les commandes :","2020":"Le train est","2030":"Prochaine mise \xe0 jour des offres dans","2040":"Bienvenue, Maire.","2041":"\ud83d\udcb0 Taux d\'imposition : ","2042":"Propos\xe9 : ","2043":"Mettre \xe0 jour","2044":"\u26a0\ufe0f Seul le maire peut fixer le taux d\'imposition.","2045":"\ud83d\uddf3\ufe0f \xc9lections :","2046":"Phase actuelle :","2047":"Minuteur de phase :","2048":"\ud83d\udce2 Promesses \xe9lectorales","2050":"Ce n\'est pas votre colonie d\'origine.","2060":"D\xe9but du vote dans :","2061":"Fin du vote dans :","2062":"Le vote est termin\xe9. R\xe9sultats annonc\xe9s dans :","2063":"La prochaine campagne commence dans :","2070":"\ud83d\udce2 Promesses \xe9lectorales","2071":"Personne n\'a encore fait de promesse \xe9lectorale.","2072":"Saisissez votre promesse \xe9lectorale (200 caract\xe8res max)...","2073":"Soumettre la promesse","2074":"Voter","2075":"Aucun candidat disponible pour le vote.","2076":"Promesse \xe9lectorale :","2077":"Vous avez d\xe9j\xe0 vot\xe9 \xe0 cette \xe9lection.","2078":"Il n\'y avait aucun candidat.","2079":"Comment va votre maire ?","2080":"Bienvenue, Maire.","2081":"Entrez le nom de la colonie...","2082":"Votre colonie :","2083":"Mettre \xe0 jour le nom","2084":"Visitez le panneau \ud83c\udfdb\ufe0f Gouvernement pour voir les statistiques de la colonie et guider votre d\xe9cision \xe9lectorale.","2085":"Maire actuel :","2090":"\ud83c\udfe4 B\xe2timents communautaires","2092":"\ud83c\udfeb \xc9coles : ","2093":"\ud83c\udfeb Aucune \xe9cole construite pour le moment.","2094":"\ud83c\udfe5 H\xf4pitaux : ","2095":"\ud83c\udfe5 Aucun h\xf4pital construit pour le moment.","2096":"\ud83d\udc3e Enclos \xe0 animaux : ","2097":"\ud83d\udc3e Aucun enclos \xe0 animaux construit pour le moment.","2098":"\ud83c\udfe4 Biblioth\xe8ques : ","2099":"\ud83c\udfe4 Aucune biblioth\xe8que construite pour le moment.","3000":"GOV PANEL:","3001":"Colonie :","3002":"\ud83d\ude0a Pop.","3003":"\ud83d\udcb0 Taux d\'imposition :","3004":"Le taux d\'imposition est fix\xe9 par le maire pour cette colonie, et un pourcentage de tous les imp\xf4ts collect\xe9s est ajout\xe9 au compte du maire.","3005":"Les maires sont \xe9lus au tribunal en ville.","3006":"\ud83c\udfdb\ufe0f Officiels du gouvernement","3007":"Aucun officiel \xe9lu pour le moment.","3009":"Seul le Maire peut construire des \xc9coles, des H\xf4pitaux et des Biblioth\xe8ques dans la Ville.","3010":"\ud83c\udfeb Les \xe9coles donnent acc\xe8s \xe0 certaines comp\xe9tences exclusives.","3011":"\ud83c\udfe5 Les h\xf4pitaux fournissent des m\xe9decins pour soigner les aventuriers revenant de la vall\xe9e.","3012":"\ud83c\udfe4 Les Biblioth\xe8ques sont une source de Livres, qui sont vitaux pour les Aventuriers cherchant \xe0 apprendre de nouvelles comp\xe9tences.","3013":"\ud83d\ude82 Le maire peut influencer la demande de marchandises au train.","3020":"Voir l\'historique des imp\xf4ts","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"TEXTES DU PANNEAU DE SAISON","3051":"(La valeur nette est recalcul\xe9e deux fois par jour.)","3052":"Aucune donn\xe9e disponible pour les meilleurs citoyens.","3053":"C\'est","3054":"Chargement...","3055":"La saison se termine dans :","3056":"Nous sommes entre deux saisons.","3057":"\xc0 la fin de la saison, des r\xe9compenses bonus seront envoy\xe9es aux meilleurs joueurs de la Fronti\xe8re, ainsi qu\'\xe0 tous les joueurs de la meilleure Colonie.","3058":"\ud83c\udfc6 Meilleurs Citoyens de la Fronti\xe8re","3059":"\ud83c\udfd9\ufe0f Colonie en T\xeate","3060":"Richesse Totale :","3061":"Population :","3062":"Inconnu","3063":"Aucune donn\xe9e disponible","3064":"Voir le Journal de Saison","4000":"LOGIN PANEL:","4001":"Vous n\'avez pas encore de compte ? Cr\xe9ez-en un gratuitement pour commencer \xe0 jouer :","4002":"Cr\xe9er un Nouveau Profil","4003":"Nom d\'utilisateur","4004":"Aucune adresse e-mail ne vous sera demand\xe9e.","4005":"Avec un nouveau compte, vous aurez votre propre domaine \xe0 cultiver dans une colonie avec d\'autres joueurs, dans une fronti\xe8re pleine de colonies. L\'aventure vous attend dans la Vall\xe9e.","4006":"Mot de passe","4007":"Connexion","4008":"Nom d\'utilisateur","4009":"Connectez-vous \xe0 votre compte pour continuer \xe0 jouer. Si vous n\'en avez pas,","4010":"Vous avez d\xe9j\xe0 un profil ?","4050":"PROFILE PANEL:","4051":"Bonjour, ","4052":"Changer le nom d\'utilisateur :","4053":"Changer le mot de passe :","4054":"Gestion du compte","4055":"Statut du compte :","4056":"D\xe9connexion","4057":"Supprimer le compte","4058":"ID du joueur :","4059":"D\xe9placement du domaine","4060":"D\xe9placements restants :","4061":"Visitez la boutique pour acheter plus de d\xe9placements.","4062":"Param\xe8tres","4063":"Langue :","4064":"Indicateur de port\xe9e :","4065":"Changer d\'avatar","4066":"Retour \xe0 la connexion","4067":"Choisir la langue","4068":"Commencez Votre Aventure !","4069":"Choisir un nom d\'utilisateur","4070":"Choisir un mot de passe","4071":"Choisissez votre ic\xf4ne de joueur :","5000":"MORE MODAL STRINGS:","5001":"\ud83d\udc80 Vous \xeates mort.","5002":"Vous avez \xe9t\xe9 ramen\xe9 chez vous. Tous les objets \ud83c\udf92 du sac \xe0 dos ont \xe9t\xe9 perdus.","5003":"Soyez plus prudent la prochaine fois.","5004":"\ud83d\udc80 Vous \xeates tomb\xe9!","5005":"\ud83d\ude00 Bienvenue \xe0 Valley View\u2122","5006":"Veuillez vous connecter ou cr\xe9er un compte gratuit.","5007":"\xa9 Valley View Studios, 2025, Tous droits r\xe9serv\xe9s.","5010":"\ud83d\udce8 Bo\xeete de r\xe9ception","5011":"Vous n\'avez aucun message","5015":"\ud83d\uded2 Boutique","5016":"Les achats seront livr\xe9s dans la bo\xeete de r\xe9ception. Aucun retour possible. Tous les achats sont d\xe9finitifs.","5017":"Attention, la plupart des objets de l\'inventaire sont supprim\xe9s entre les saisons. V\xe9rifiez l\'horloge des saisons avant d\'acheter et consultez le panneau des saisons pour plus d\'informations.","5020":"\ud83d\udeab Vous \xeates actuellement d\xe9connect\xe9.","5021":"Cliquez sur Connexion ou Cr\xe9er un compte pour commencer.","5025":"\ud83d\ude4f Merci pour votre soutien !","5026":"Votre achat a \xe9t\xe9 livr\xe9 dans votre bo\xeete de r\xe9ception.","5027":"Profitez de Elsinore !","5030":"\ud83d\ude00 Bienvenue \xe0 Elsinore !","5031":"Aucun joueur connect\xe9 ou le serveur est hors ligne.","5032":"Veuillez actualiser la page, v\xe9rifier votre connexion internet ou revenir plus tard.","5035":"Nous sommes entre deux saisons !","5036":"Elsinore est temporairement indisponible pendant la remise \xe0 z\xe9ro de la saison.","5040":"\ud83d\udcf0 Nouvelles de la ville","5041":"Voici ce qui se passe actuellement en ville :","5045":"Utiliser ","5046":"Voulez-vous utiliser un(e)","5047":"Vous avez ","5050":"\u26a0\ufe0f Confirmer le d\xe9placement du domaine","5051":"\xcates-vous s\xfbr de vouloir d\xe9placer votre domaine ? Cette action est irr\xe9versible.","5052":"Fermez cette fen\xeatre pour annuler.","5060":"\u2b50\ufe0f F\xe9licitations !","5061":"Vous avez maintenant un compte Or. Rendez-vous sur votre profil pour personnaliser votre ic\xf4ne et d\xe9couvrir les autres avantages.","5062":"Merci pour votre soutien !","5070":"Votre voyage ne doit pas se terminer ici...","5071":"Choisissez votre destin :","5072":"Revivez pour","5073":"Accepter votre mort","5074":"Besoin de plus de gemmes ?","5100":"Collectes d\'imp\xf4ts r\xe9centes","5101":"Aucun historique de collecte d\'imp\xf4ts disponible pour le moment.","5102":"\ud83d\uddd3\ufe0f Date","5103":"\ud83d\udcb0 Total collect\xe9","5104":"Maire","5105":"\ud83d\udcb0 Part du maire","5110":"","6000":"CHA\xceNES DE TROPH\xc9ES:","6001":"Voici vos Troph\xe9es \xe0 vie:","6002":"Vous n\'avez pas encore de troph\xe9es. Gagnez des troph\xe9es pour des r\xe9alisations tout au long du jeu.","6003":"Troph\xe9e Gagn\xe9 !","7000":"CHA\xceNES DE NOTIFICATION :","7001":"Conseil :","7002":"F\xe9licitations !","7003":"Cliquez sur \ud83e\udd20 Kent pour vendre des marchandises.","7004":"Note :","7005":"Utilisez A-W-S-D ou les touches fl\xe9ch\xe9es pour vous d\xe9placer. Allez sur la terre, puis s\xe9lectionnez \ud83c\udf31 Parcelle de bl\xe9.","7006":"Cherchez l\'ic\xf4ne \ud83d\udcaa pour ouvrir le panneau Comp\xe9tences. Continuez \xe0 vendre des marchandises \xe0 \ud83e\udd20 Kent pour gagner de l\'argent et des \ud83d\udd37 XP.","7007":"Apr\xe8s avoir acquis \xc9levage, allez sur une tuile d\'\ud83d\udfe9 herbe, puis trouvez le panneau \ud83d\udc2e Acheter pour acheter une \ud83d\udc2e Vache.","7008":"Les cultures ont besoin de terre. Les vaches et moutons ont besoin d\'\ud83d\udfe9 herbe. Le pavage peut aider \xe0 contenir les mouvements des personnes et des animaux. Utilisez les \u26cf\ufe0f Outils pour fa\xe7onner le terrain \xe0 votre go\xfbt.","7009":"Continuez \xe0 v\xe9rifier votre \u2705 Liste de t\xe2ches, et continuez \xe0 consulter \ud83e\udd20 Kent et \ud83d\udc75\ud83c\udffb la Berg\xe8re.","7015":"Cliquez sur + et - en haut de l\'\xe9cran pour zoomer et d\xe9zoomer.","7017":"Vous avez acquis un objet \xe9quipable. Visitez le panneau \u2694\ufe0f Combat pour l\'\xe9quiper.","7020":"Pour voyager instantan\xe9ment chez vous, cliquez sur la Colonie o\xf9 se trouve votre Propri\xe9t\xe9.","7021":"Vous \xeates arriv\xe9 dans la Vall\xe9e ! Assurez-vous de faire un zoom arri\xe8re (+ et -) pour suivre votre position. Si vous vous perdez, faites un zoom arri\xe8re jusqu\'\xe0 la vue Fronti\xe8re pour retourner chez vous.","7049":"Tutoriel","7050":"Utilisez A-W-S-D ou les touches fl\xe9ch\xe9es pour vous d\xe9placer. Essayez de parler au Constable Elbow.","7051":"Vous pouvez acheter un Acte de Propri\xe9t\xe9 aupr\xe8s du Constable Elbow, quand vous \xeates pr\xeat \xe0 vous installer sur votre Domaine. Ou vous pouvez explorer et vous \xe9quiper pour l\'aventure.","7052":"Avec votre Acte de Propri\xe9t\xe9, vous pouvez utiliser le \ud83c\udfe0 Panneau Maison pour voyager vers votre Domaine \xe0 tout moment.","7053":"Bienvenue sur votre Domaine ! Cette terre est \xe0 vous pour construire. Gagnez de l\'\ud83d\udcb0 Argent en vendant vos marchandises \xe0 \ud83e\udd20 Kent.","7054":"Super, maintenant commencez \xe0 cultiver ! Vous pouvez planter des cultures en utilisant le panneau \ud83c\udf3d Agriculture. Les cultures doivent \xeatre plant\xe9es sur de la terre.","7055":"Vous \xeates en bonne voie ! Continuez \xe0 cultiver et \xe0 vendre. Quand vous \xeates pr\xeat, retournez en Ville en utilisant le \ud83c\udfdb\ufe0f Panneau, et obtenez une Cl\xe9 de la Ville aupr\xe8s du Constable Elbow.","7056":"Vous \xeates maintenant bienvenu en Ville ! Explorez tout ce que la Ville a \xe0 offrir, y compris d\xe9velopper plus de Comp\xe9tences, rencontrer les Habitants, et plus de moyens de gagner de l\'Argent.","7057":"Rendez-vous au \ud83c\udfea Magasin G\xe9n\xe9ral en ville pour acqu\xe9rir une Hache.","7058":"Rendez-vous au \ud83c\udfea Magasin G\xe9n\xe9ral en ville pour acqu\xe9rir une Pioche.","7061":"Voyagez maintenant vers la Ville pour obtenir votre Cl\xe9 de la Ville aupr\xe8s du Constable Elbow. Utilisez le \ud83c\udfdb\ufe0f Panneau Ville pour vous y rendre.","7062":"Bon travail ! Je suis la Berg\xe8re, et je vous aiderai avec votre \u2705 Liste de T\xe2ches. Revenez me voir quand les t\xe2ches sont termin\xe9es.","8000":"CHA\xceNES ANIMAUX & TEMPLE :","8001":"COMMUN","8002":"PEU COMMUN","8003":"RARE","8004":"\xc9PIQUE","8005":"L\xc9GENDAIRE","8010":"Cet animal a faim.","8011":"Nourrir","8012":" pour l\'envoyer chercher des tr\xe9sors.","8014":" cherche des tr\xe9sors...","8015":"Revenir dans :","8016":" a trouv\xe9 quelque chose !","8999":"HOW TO PLAY STRINGS:","9000":"Bienvenue \xe0 Secrets of Elsinore !","9001":"De quoi s\'agit-il ?","9002":"Secrets of Elsinore est un jeu qui explore comment les gens peuvent s\'organiser eux-m\xeames et cr\xe9er des micro-soci\xe9t\xe9s dans un monde aux ressources asym\xe9triques et interd\xe9pendantes, avec des espaces priv\xe9s et partag\xe9s.","9003":"Il n\'y a pas de voies de sp\xe9cialisation explicites, mais trois axes de jeu principaux et interd\xe9pendants : AGRICULTEUR, AVENTURIER et POLITICIEN. Vous \xeates encourag\xe9 \xe0 vous entraider.","9004":"Pour commencer, les bases :","9005":"Utilisez les touches A-W-S-D pour vous d\xe9placer. Cliquez pour interagir avec les \xe9l\xe9ments \xe0 port\xe9e.","9006":"Explorez \ud83c\udf3d AGRICULTURE, \u2692\ufe0f CONSTRUCTION et \ud83d\udc2e ACHATS pour am\xe9liorer votre domaine et g\xe9n\xe9rer des ressources.","9007":"G\xe9n\xe9rez de l\'\ud83d\udcb0 ARGENT aupr\xe8s de \ud83e\udd20 KENT ou au \ud83d\udce5 COMPTOIR COMMERCIAL.","9008":"En savoir plus :","9009":"En cr\xe9ant de la richesse, am\xe9liorez-vous avec des COMP\xc9TENCES et des APTITUDES. Par exemple, achetez la comp\xe9tence \ud83d\udc34 \xc9QUITATION pour voyager en ville.","9010":"D\xe9zoomez (- et +) pour voir la taille du monde. Votre domaine est l\'un des nombreux d\'une COLONIE. Chaque colonie partage une VILLE. Votre colonie fait partie de la FRONTI\xc8RE.","9011":"Quand vous serez pr\xeat, explorez la VALL\xc9E, pleine de dangers et de merveilles. Les secrets du magicien PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f et du roi perdu LEONTES \ud83e\udd34, entre autres, s\'y trouvent.","9012":"Vos objectifs :","9013":"N\'h\xe9sitez pas \xe0 cr\xe9er vos propres objectifs. De plus, \xe0 la fin de chaque \ud83d\uddd3\ufe0f SAISON, qui dure trois mois, les individus et les colonies seront class\xe9s, et un meilleur classement g\xe9n\xe8re des richesses suppl\xe9mentaires. Votre propri\xe9t\xe9, toutes vos comp\xe9tences et votre inventaire seront conserv\xe9s pour la prochaine Saison.","9014":"Cultivez, fabriquez, \xe9changez, explorez, combattez et amusez-vous !","9020":"Comment gagner de l\'argent","9021":"Il existe plusieurs fa\xe7ons de gagner de l\'\ud83d\udcb0 ARGENT.","9022":"Pour d\xe9buter, consultez \ud83e\udd20 KENT. Il ach\xe8tera des marchandises, y compris des r\xe9coltes et de l\'artisanat.","9023":"Diff\xe9rents emplacements au \ud83d\udce5 COMPTOIR COMMERCIAL ont diff\xe9rents minuteurs. Pendant le minuteur, vous ne pouvez vendre les marchandises que si un autre joueur les ach\xe8te. Apr\xe8s le minuteur, vous pouvez vendre les marchandises au jeu. Essayez de commercer avec d\'autres joueurs. Ils auront des choses dont vous avez besoin, et vice versa.","9024":"En Ville, vous trouverez des endroits comme la \ud83c\udfe6 BANQUE, qui vous ach\xe8tera certains articles \xe0 un prix premium.","9025":"D\xe9penser son argent","9026":"Sans surprise, la plupart des choses co\xfbtent de l\'argent. Au d\xe9but, d\xe9pensez-le pour \ud83d\udcaa des COMP\xc9TENCES, \ud83d\udc2e des ANIMAUX et \u2692\ufe0f des ATELIERS. Explorez les panneaux \xe0 gauche de l\'\xe9cran pour g\xe9n\xe9rer plus de ressources et donc plus d\'argent.","9027":"En ville, vous d\xe9couvrirez d\'autres boutiques et commer\xe7ants.","9030":"Comment Gagner des Gemmes","9031":"Les Gemmes sont une ressource rare qui peut \xeatre utilis\xe9e pour acheter diverses choses pour acc\xe9l\xe9rer votre jeu.","9032":"Vous pouvez acheter des Gemmes dans le Magasin, ou en cliquant ici :","9033":"En de rares occasions, des Gemmes peuvent \xeatre trouv\xe9es dans la Vall\xe9e, ou gagn\xe9es comme r\xe9compenses pour avoir excell\xe9 avec le Train, ou termin\xe9 fort \xe0 la fin d\'une Saison.","9040":"\xc9vident :","9041":"100 \ud83d\udc8e Gemmes pour ","9042":"Meilleure Valeur :","9043":"500 \ud83d\udc8e Gemmes pour ","9044":"Plus Populaire :","9045":"1000 \ud83d\udc8e Gemmes pour ","9050":"Avantages","9051":"Un compte Or est un abonnement mensuel qui donne acc\xe8s \xe0 des fonctionnalit\xe9s et avantages premium dans Secrets of Elsinore.","9052":"Avec un compte Or, vous b\xe9n\xe9ficiez des avantages suivants :","9053":"\u2705 Avatars premium : \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 +100 000 capacit\xe9 d\'Entrep\xf4t","9055":"\u2705 +5 000 capacit\xe9 de Sac \xe0 dos","9056":"\u2705 2 emplacements d\'\xe9tal suppl\xe9mentaires","9057":"\u2705 Taux d\'imposition r\xe9duit","9058":"\u2705 La moiti\xe9 de vos PV max restaur\xe9e \xe0 la mort","9059":"\u2705 Vous pouvez vous pr\xe9senter aux \xe9lections","9060":"Merci pour votre achat de compte Gold.","9061":"Acheter un compte Gold","9999":"CHA\xceNES D\'ERREUR:","10000":"\ud83d\udd0c Serveur hors ligne","10001":"Le serveur est actuellement hors ligne. Nous nous excusons pour la g\xeane occasionn\xe9e, veuillez r\xe9essayer bient\xf4t.","10002":"(Ce message dispara\xeetra lorsque le serveur sera de retour en ligne.)","10100":"APP.JS STRINGS:","10101":"Bienvenue \xe0 Valley View !","10102":"Veuillez vous connecter ou cr\xe9er un compte gratuit.","10103":"\ud83c\udf92 Inventaire","10104":"\ud83d\uded2 Boutique","10105":"\ud83d\udce8 Bo\xeete de r\xe9ception","10106":"\ud83d\udce2 Partager","10107":"\ud83d\udcac Chat","10108":"Vous avez un compte Or","10109":"Contr\xf4les :","10110":"\ud83d\udd79\ufe0f Comment jouer","10111":"Vous \xeates le Maire","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Sant\xe9 : ","10113":"\ud83d\uddd3\ufe0f Nous sommes le","10114":"La prochaine saison commence dans :","10115":"\ud83d\uddd3\ufe0f Prochaine saison dans :","10116":"\ud83c\udfdb\ufe0f En cours en ville :","10117":"\ud83d\udcb0 Prochaine collecte d\'imp\xf4ts :","10118":"Dans : ","10119":"Collecte des imp\xf4ts en cours...","10120":"\ud83c\udfdb\ufe0f \xc9lections : ","10121":"Se termine : ","10122":"\ud83d\ude82 Train : ","10123":"\ud83c\udfe6 Banque : ","10124":"Nouvelles offres : ","10125":"Lisez les Nouvelles du Village !","10126":"Pr\xe9sents :","10127":"Aucun joueur pr\xe9sent sur cette grille.","10128":"Enregistrer les modifications","10129":"","10130":"Vous avez un compte Or","10131":"Avantages du compte Or","10132":"Annuler le d\xe9m\xe9nagement","10133":"D\xe9m\xe9nager le domaine","10135":"A-Z-S-D pour Se D\xe9placer","10136":"I pour Inventaire","10137":"+/- pour Zoomer","10138":"Vous avez d\xe9bloqu\xe9 :","10139":"Nouvelles qu\xeates de :","10149":"Niveau","10150":"\u2b06\ufe0f Niveau","10151":"\ud83d\udd37 XP :","10152":"\ud83d\udef6 Monter dans le Bateau","10153":"\ud83d\udef6 Sortir du Bateau","10154":"\ud83c\udfd5\ufe0f Monter la Tente","10155":"\u26fa Ranger la Tente","10156":"Disponible","10157":"Sant\xe9","10158":"Quantit\xe9 \xe0 Manger","10159":"Gain de Sant\xe9","10160":"Max","10161":"\ud83c\udf7d\ufe0f Mangez de la Nourriture pour Restaurer la Sant\xe9","10162":"Vous n\'avez aucun article comestible dans votre ","10170":"La porte vous est ouverte.","10171":"Vous n\'avez pas acc\xe8s.","10175":"Acqu\xe9rez plus de comp\xe9tences \xe0 divers endroits de la ville.","10180":"\ud83d\udce5 Poste de Commerce: Demander des Articles \xe0 Acheter","10181":" LIMITE PAR DEMANDE","10182":"Vous entrez dans ","10183":"Vous quittez ","10184":"La Vall\xe9e","10185":"Elsinore","10186":"Dans un Donjon","10187":"Placer avec le curseur","11000":"ADDED STRINGS:","11001":"Attendez la fin du minuteur ou qu\u2019un autre joueur ach\xe8te cet objet.","12001":"Agriculture","12002":"Construction","12003":"Animaux","12004":"Qu\xeates actives","12005":"Comp\xe9tences","12006":"Combat","12007":"Gouvernement","12008":"Saisons","12009":"Accueil","12010":"Profil","12011":"D\xe9corations","12012":"Outils","12013":"Troph\xe9es","12014":"Animaux du Zoo","15000":"\ud83d\uddd3\ufe0f R\xe8gles de Saison","15001":"Les saisons durent trois mois.","15002":"R\xe9compenses","15003":"\ud83d\udcb0 La valeur nette sera calcul\xe9e en fonction de votre argent, des objets de votre inventaire et des objets sur votre ferme.","15004":"\ud83c\udfc6 Les 3 meilleurs joueurs \xe0 travers la fronti\xe8re recevront des r\xe9compenses dans votre bo\xeete aux lettres, et gagneront aussi un troph\xe9e \'Gagnant de Saison\'.","15005":"\ud83c\udfc6 Le meilleur joueur de la fronti\xe8re gagnera aussi le troph\xe9e \'Champion de Saison\'.","15006":"\ud83c\udf81 Tous les joueurs dans la meilleure colonie recevront des r\xe9compenses suppl\xe9mentaires dans votre bo\xeete aux lettres.","15007":"R\xe9initialisation des Joueurs et des Lieux","15008":"\ud83c\udfe0 Vous serez relocalis\xe9 \xe0 votre ferme si vous \xeates loin de chez vous quand la saison se termine.","15009":"\ud83c\udfe0 Vos fermes ne seront PAS r\xe9initialis\xe9es \u2013 toute la disposition, les tuiles et les ressources sont conserv\xe9es.","15010":"\ud83c\udf92 Contrairement aux saisons pr\xe9c\xe9dentes, votre inventaire NE sera PAS effac\xe9.","15011":"\ud83d\udc8e Vous garderez toutes les Gemmes.","15012":"\ud83d\udcb0 Contrairement aux saisons pr\xe9c\xe9dentes, l\'Argent NE sera PAS r\xe9duit.","15013":"\u2705 Toutes les qu\xeates seront effac\xe9es.","15014":"\ud83d\udcaa Vos comp\xe9tences & pouvoirs sont conserv\xe9s.","15015":"\u2764\ufe0f Vos relations sont conserv\xe9es.","15016":"\u2b50\ufe0f Votre statut Pass Or sera r\xe9voqu\xe9 pour la nouvelle saison.","15017":"\ud83c\udf32 Toutes les grilles de ville et de vall\xe9e seront r\xe9initialis\xe9es avec de nouvelles tuiles, ressources et ennemis.","15018":"Qu\'est-ce qui Change ?","15019":"\ud83c\udf83 Les villes auront des tuiles et des ressources selon le nouveau contenu de saison.","15020":"\ud83d\ude00 Les nouveaux joueurs qui rejoignent (et cr\xe9ent de nouvelles fermes) obtiendront des tuiles et ressources de d\xe9marrage selon le nouveau contenu de saison.","15021":"\ud83d\ude82 Les commandes de train sont affect\xe9es par les saisons.","15022":"\ud83c\udfc6 De nouvelles r\xe9compenses et troph\xe9es peuvent \xeatre gagn\xe9s.","15030":"\ud83d\uddd3\ufe0f Lire sur les Saisons","16000":"TEXTES D\'HISTOIRE","16001":"Bien rencontr\xe9, {username}. Je suis Portia, et je d\xe9fends les lois qui unissent notre communaut\xe9. Aide-moi \xe0 b\xe2tir les institutions qui nous civilisent \u2014 \xe9coles, h\xf4pitaux, biblioth\xe8ques \u2014 et je te r\xe9compenserai par l\'influence et le rang. Mais sache ceci : tout ce qui brille n\'est pas or, et ce gredin d\'Iago n\'est que du clinquant. Aide-le, et nous en aurons fini.","16002":"Salut, soldat ! Je me r\xe9jouis de te voir, car ces terres ont besoin de plus de combattants pour repousser le mal qui nous menace. Visite l\'Antre du Guerrier et l\'Armurerie, et pr\xe9pare-toi au combat !","16003":"Enchant\xe9 de faire ta connaissance, {username}. Je m\'appelle Cassio, et je d\xe9fends l\'honneur de ma s\u0153ur Juliette, tout en recherchant la t\xeate de ce l\xe2che de Duc Angelo. Il se cache dans la Vall\xe9e. Et ne te lie pas d\'amiti\xe9 avec ce voleur d\'Iago, sinon je ne ferai pas affaire avec toi.","16004":"Eh bien, n\'es-tu pas adorable ? Je suis Ma\xeetresse Quickly, et je me sp\xe9cialise dans les arts culinaires. Je t\'aiderai volontiers \xe0 d\xe9velopper tes talents en cuisine, nous avons besoin de plus de magiciens des fourneaux dans ces contr\xe9es !","16005":"Tr\xe8s heureux de faire ta connaissance, {username}. Je m\'appelle Feste, et je suis l\'artisan local de ces contr\xe9es. Je peux t\'aider \xe0 d\xe9velopper tes comp\xe9tences cr\xe9atives, car il y a bon argent \xe0 gagner en fabriquant de belles choses pour les gens.","16006":"Bonjour, aimable voyageur. Je suis Helena, et je vis ici parmi les champs de M\xe8re Nature. En explorant ces terres, sache que moi seule poss\xe8de la Cl\xe9 Dor\xe9e du ch\xe2teau o\xf9 le Roi Leontes a perdu sa couronne. Bien que je soupire apr\xe8s l\'amour de sa reine, je sacrifierais mes r\xeaves pour voir Leontes lui revenir et retrouver sa gloire d\'antan.","16007":"Tu as voyag\xe9 loin, {username}. Je suis Titania, Reine des F\xe9es. Tu es maintenant arriv\xe9 \xe0 l\'endroit au-del\xe0 duquel les dangers ne feront que cro\xeetre. Si tu rencontres Prospero, n\'en fais pas un ennemi, sinon tu n\'obtiendras rien de moi.","16008":"Eh bien, tu as r\xe9ussi. Je n\'aurais jamais r\xeav\xe9 qu\'il y aurait quelqu\'un capable de vaincre mes dragons et de m\'atteindre en ce lieu. L\'Orbe de Merlin est \xe0 toi. Peut-\xeatre que l\'Oracle peut nous apporter l\'Espoir apr\xe8s tout. Cherche-la au plus profond de la Vall\xe9e.","16009":"[Prospero]","16010":"Donne-moi la vie, donne-moi l\'amour, mais surtout... donne-moi du Porto ! En \xe9change, un brin de Grande Camomille, plus pr\xe9cieux que l\'or pour certains, surtout cette Helena aux grands yeux. Elle dit qu\'elle cherche des couronnes et des l\xe9gendes, pauvre fille. Moi ? Je cherche un ventre plein et une douce sieste. \xab Tu as l\'esprit si embrum\xe9 par le vieux vin \xbb, m\'a-t-on dit un jour. Ha ! Ils n\'avaient pas tort.","16011":"Voici du romarin, pour le souvenir \u2014 et de la belladone, pour les regrets. Mes potions ne sont pas pour les faibles de volont\xe9. Avec la bonne feuille, je peux soigner tes membres ou embrouiller ta langue. \xab Je me souviens d\'un apothicaire \xbb, dit un gar\xe7on un jour, et il en paya le prix. Mais toi ? Tu as l\'air plus sage. Apporte-moi des racines rares et des graines am\xe8res, et je te pr\xe9parerai quelque chose qui vaut le danger.","16012":"Ah, voyageur, les bois regorgent de complots murmur\xe9s, et Portia en garde un serr\xe9 contre sa poitrine comme un avare sa pi\xe8ce. Apporte-moi son secret, je t\'en prie, et je mettrai dans ta main une Cloche de Bronze des plus rares. Sa voix sonne plus vraie que tous les serments qu\'elle a prononc\xe9s. Fais cela, et je te soufflerai des murmures de m\xe9faits au clair de lune, de rivalit\xe9s profondes, et de fortunes encore \xe0 venir.","16013":"Quelque chose est pourri, encore. Je le sens dans le sol. J\'ai r\xe9gn\xe9 autrefois, aim\xe9, perdu. Helena m\'a travers\xe9e comme un \xe9clair d\'\xe9t\xe9. Et Leontes ? Il n\'a pu pardonner le d\xe9gel. \xab La dame proteste trop \xbb, disaient-ils ; qu\'ils le disent. Si tu vois Helena, dis-lui que les roses connaissent son nom. Si tu vois Leontes, dis-lui que je n\'ai pas oubli\xe9 l\'hiver.","16014":"Mon chagrin est une statue ; silencieux, mais jamais immobile. J\'ai enterr\xe9 ma couronne dans la neige le jour o\xf9 Gertrude a choisi son jardin plut\xf4t que moi. \xab Sortie, poursuivi par un ours \xbb ? Non, je me suis fui moi-m\xeame. Maintenant j\'attends, parmi la pierre et le silence. Apporte-moi ce qui \xe9tait mien, la Couronne du Roi, et je te paierai en Or, plus que le poids de la m\xe9moire. Mais prends garde : certains tr\xf4nes portent des mal\xe9dictions.","16015":"Ce pont est mien, par Sycorax ma m\xe8re. Prospero a essay\xe9 de le voler avec des sorts et des sourires. Ils m\'ont appel\xe9 b\xeate, mais je suis de terre et de temp\xeate, n\xe9 pour la v\xe9rit\xe9 sauvage. J\'\xe9change des os contre de l\'Argent, des reliques des morts contre des pi\xe8ces des vivants. Ne touche rien \xe0 la l\xe9g\xe8re dans ces bois. Apporte-moi ce que les autres craignent, et je te rendrai riche... ou hant\xe9.","16016":"Ma g\xe9n\xe9rosit\xe9 est aussi sans bornes que la mer, mon amour aussi profond... mais il est parti, et tout ce qui reste est un portrait et de la douleur. Angelo a pris les deux. Apporte-moi le portrait de Rom\xe9o, arrach\xe9 de ma chambre, et je te donnerai des Tulipes rouges comme le sang vers\xe9 sur les pierres de V\xe9rone. Que ceci soit notre nouveau balcon : toi en bas, portant la justice.","16017":"Bonjour, ami. Cherches-tu le Trident des anciens dieux ? C\'est l\'un des sept artefacts n\xe9cessaires pour satisfaire l\'Oracle. J\'ai besoin de beaucoup d\'or pour m\'en s\xe9parer.","16018":"Bienvenue {username}. F\xe9licitations, car tu as parcouru une grande distance. Je sens l\'h\xe9ro\xefsme en toi. Apporte-moi les sept artefacts qui lient ces peuples, et je te donnerai l\'Espoir pour restaurer l\'\xc2ge d\'Or !","16019":"Salutations {username} ! Pendant des si\xe8cles, les gentils habitants d\'Elsinore vivaient en harmonie, gouvern\xe9s par le bienveillant Roi Leontes. Mais depuis peu, un fl\xe9au mal\xe9fique grandit dans la Vall\xe9e et menace nos voies paisibles. On dit qu\'une seule Qu\xeate peut restaurer l\'Espoir dans ces terres et repousser les t\xe9n\xe8bres. Cherche l\'Oracle dans la Vall\xe9e, aventurier, et apporte-nous l\'Espoir !","16020":"Bien rencontr\xe9, chasseur ! As-tu des peaux \xe0 \xe9changer ? Je te paierai un juste prix pour toutes les fourrures que les terres sauvages de la vall\xe9e ont c\xe9d\xe9es \xe0 ton talent. Les mois froids approchent, et les gens cherchent la chaleur. Ta chasse remplit mes coffres ; mes pi\xe8ces remplissent ta bourse. C\'est un march\xe9 aussi douillet que le nom que je porte !","16101":"","16102":"","16103":"","16104":"","16105":"","16106":"","16107":"","16108":"","16109":"","16110":"","16111":"","16112":"","16113":"","16114":"","16115":"","16116":"","16117":"","16118":"","16119":"","16120":"","21000":"Chat","21001":"Caniche","21002":"Singe","21003":"Canard","21004":"\xc2ne","21005":"Hibou","21006":"Perroquet","21007":"Aigle","21008":"Z\xe8bre","21009":"Girafe","21010":"Orang-outan","21011":"Dodo","30000":"TROPH\xc9ES :","30001":"Premier Ouvrier Agricole","30002":"Constructeur de Comp\xe9tences","30003":"Trains Termin\xe9s","30004":"Gagnant de Saison","30005":"Champion de Saison","30006":"Rencontrez les Personnages","30007":"Explorez la Vall\xe9e","30008":"Combattant","30009":"R\xe9v\xe9lateur de Parchemins","30010":"Aventurier","30011":"Marin","30012":"Tuez le Duc","30013":"L\'Orbe de Prospero","30014":"Carnavals Termin\xe9s","200000":"RESSOURCES","200009":"Compte Or","200010":"Argent","200011":"Souche","200012":"Panneau Nord","200013":"Panneau Est","200014":"Panneau Sud","200015":"Panneau Ouest","200016":"Panneau Nord-Ouest","200017":"Panneau Nord-Est","200018":"Panneau Sud-Est","200019":"Panneau Sud-Ouest","200020":"Panneau Ville","200021":"Panneau Maison","200022":"\xc9tal de Commerce","200023":"Comptoir Commercial","200024":"Entrep\xf4t","200025":"Maison Abandonn\xe9e","200026":"Ferme","200027":"R\xe9parer","200028":"Montagne","200029":"Grande Montagne","200030":"Banque","200031":"Tribunal","200032":"Train","200033":"Bo\xeete aux Lettres","200034":"Ch\xeane","200035":"Pin","200036":"Palmier","200037":"Arbre de F\xeate","200038":"Bonhomme de Neige","200039":"Rochers","200040":"Gisement d\'Argile","200041":"Bois","200042":"Pierre","200043":"Argile","200044":"Parcelle de Bl\xe9","200045":"Parcelle de Carottes","200046":"Parcelle de Ma\xefs","200047":"Parcelle de Canne \xe0 Sucre","200048":"Parcelle de Fraises","200049":"Pommier","200050":"Citronnier","200051":"Vigne","200052":"Parcelle d\'Ail","200053":"Olivier","200054":"Plant de Tomates","200055":"Parcelle de Ch\xeane","200056":"Bl\xe9","200057":"Carotte","200058":"Ma\xefs","200059":"Canne \xe0 Sucre","200060":"Fraise","200061":"Pomme","200062":"Citron","200063":"Raisins","200064":"Ail","200065":"Olive","200066":"Tomate","200067":"Myrtille","200068":"Lait","200069":"Laine","200070":"\u0152uf","200071":"Farine","200072":"Nourriture pour Poulets","200073":"Sucre","200074":"Farine de Ma\xefs","200075":"Bois d\'\u0152uvre","200076":"Beurre","200077":"Cr\xe8me","200078":"Fromage","200079":"Fil","200080":"Tissu","200081":"Chandail","200082":"Veste","200083":"Veste Lourde","200084":"Tunique Runique","200085":"Pain","200086":"Pain de Ma\xefs","200087":"Tarte aux Pommes","200088":"Tarte aux Fraises","200089":"Biscuit au Citron","200090":"Pain aux Olives","200091":"Pain \xe0 l\'Ail","200092":"G\xe2teau de la Reine","200093":"Soupe de Tomates","200094":"Soupe de Carottes","200095":"Omelette","200096":"Pizza","200097":"Miel","200098":"Cidre de Pomme","200099":"Vin","200100":"Porto","200101":"Huile d\'Olive","200102":"Vin Vieilli","200103":"Poterie","200104":"Meubles","200105":"Encre","200106":"Urnes","200107":"Romarin","200108":"Champignon","200109":"Champignon Magique","200110":"Marguerite","200111":"Tulipe","200112":"Tournesol","200113":"Grande Camomille","200114":"Potion A","200115":"Potion B","200116":"Potion C","200117":"Gemme","200118":"Livre","200119":"Peau","200120":"Peau d\'Ours","200121":"Os","200122":"Argent M\xe9tal","200123":"Or","200124":"Bague en Diamant","200125":"Couronne du Roi","200126":"Portrait","200127":"Trident","200128":"Cl\xe9 Squelette","200129":"Cl\xe9 Dor\xe9e","200130":"Parchemin","200131":"Orbe de Prospero","200132":"Tente","200133":"Bateau","200134":"Sanctuaire","200135":"Ch\xe2teau","200136":"Restaurant","200137":"Toilettes","200138":"Magasin G\xe9n\xe9ral","200139":"Repaire du Guerrier","200140":"Boutique de Magie","200141":"Temple Ancien","200142":"Camp d\'Aventure","200143":"Laboratoire","200144":"\xc9cole","200145":"\xc9table","200146":"Moulin","200147":"Laiterie","200148":"Poulailler","200149":"Scierie","200150":"M\xe9tier \xe0 Tisser","200151":"Four","200152":"Cuisine","200153":"Ruche","200154":"Atelier","200155":"Vinerie","200156":"Biblioth\xe8que","200157":"Cour des Animaux","200158":"H\xf4pital","200159":"Vache","200160":"Mouton","200161":"Vache Brune","200162":"Docteur","200163":"Chirurgien","200164":"F\xe9e","200165":"Kent","200166":"Portia","200167":"La Berg\xe8re","200168":"Hotspur","200169":"Cassio","200170":"Dame Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampire","200175":"P\xe8re No\xebl","200176":"Prospero","200177":"Falstaff","200178":"Apothicaire","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Juliette","200184":"Sir\xe8ne","200185":"Fermier","200186":"Ouvrier Agricole","200187":"\xc9leveur","200188":"B\xfbcheron","200189":"Coyote","200190":"Ours","200191":"Araign\xe9e","200192":"Zombie","200193":"Duc Angelo","200194":"Fant\xf4me","200195":"Ogre","200196":"D\xe9mon","200197":"Dragon","200198":"G\xe9n\xe9rateur de Coyotes","200199":"G\xe9n\xe9rateur d\'Ours","200200":"G\xe9n\xe9rateur d\'Araign\xe9es","200201":"G\xe9n\xe9rateur de Zombies","200202":"G\xe9n\xe9rateur de Fant\xf4mes","200203":"G\xe9n\xe9rateur de D\xe9mons","200204":"G\xe9n\xe9rateur de Dragons","200205":"Cultivateur","200206":"Main Verte","200207":"\xc9levage","200208":"Collecte Animale en Masse","200209":"Hache","200210":"Pioche","200211":"B\xe2tisseur","200212":"R\xe9colte en Masse","200213":"Replantation en Masse","200214":"B\xfbcheronnage","200215":"B\xfbcheronnage Am\xe9lior\xe9","200216":"Artisanat en Masse","200217":"Red\xe9marrage d\'Artisanat en Masse","200218":"Hache Am\xe9lior\xe9e","200219":"Pioche Am\xe9lior\xe9e","200220":"Entrep\xf4t","200221":"D\xe9p\xf4t","200222":"Stockage 3 \xc0 D\xe9finir","200223":"Stockage 4 \xc0 D\xe9finir","200224":"Ma\xe7onnerie","200225":"M\xe9canique","200226":"Textiles","200227":"Art","200228":"Apiculteur","200229":"Tailleur","200230":"Politique","200231":"\xc9ducation","200232":"Chimie","200233":"Cuisine","200234":"Cr\xe9merie","200235":"Boulanger","200236":"Vigneron","200237":"Meunier","200238":"Artisan","200239":"Cuisinier","200240":"Tisserand","200241":"Oiseleur","200242":"Fromager","200243":"Virtuose Culinaire","200244":"Ma\xeetre Apiculteur","200245":"Viticulteur","200246":"Droit","200247":"M\xe9decine","200248":"Chirurgie","200249":"Sac \xe0 Dos","200250":"Havresac","200251":"Sac Enchant\xe9","200252":"Cheval","200253":"Pistage","200254":"\xc9claireur","200255":"Rembourrage","200256":"Armure L\xe9g\xe8re","200257":"Cotte de Mailles","200258":"Armure de Plaques","200259":"Armure Lourde","200260":"Armure Mystique","200261":"Plastron de Caliban","200262":"Voile B\xe9ni","200263":"Casque Magique","200264":"Gants Magiques","200265":"Bottes de Protection","200266":"Couteau","200267":"\xc9p\xe9e Courte","200268":"\xc9p\xe9e Longue","200269":"Grande \xc9p\xe9e","200270":"Hallebarde","200271":"\xc9p\xe9e Chantante","200272":"Hallebarde Magique","200273":"\xc9p\xe9e Luisante","200274":"Hache G\xe9ante","200275":"\xc9p\xe9e L\xe9gendaire","200276":"Tueur de Dragons","200277":"Fl\xe9chettes","200278":"Arc Court","200279":"Arc Long","200280":"Lance","200281":"Arbal\xe8te","200282":"Lance Magique","200283":"Arbal\xe8te Magique","200284":"Arc de Titania","200285":"Arbal\xe8te L\xe9gendaire","200286":"Temp\xeate","200287":"Maelstr\xf6m","200288":"Oubli","200289":"Titan","200290":"Coup Sec","200291":"Rafale","200292":"Barrage","200293":"Main Ferme","200294":"Pr\xe9cision Extr\xeame","200295":"Infaillible","200296":"Concentration","200297":"Pr\xe9cision","200298":"\u0152il de l\'Horizon","200299":"Force d\'\xc2me","200300":"C\u0153ur de Pierre","200301":"Incassable","200500":"Caisse","200501":"Mur de Pierre","200502":"Grand Mur de Pierre","200503":"Mur Vert","200504":"Mur Noir","200505":"Mur de Sable","200506":"Mur Bleu","200507":"Mur Orange","200508":"Plante","200509":"Cactus","200510":"Harpe","200511":"Drapeau","200512":"Pile de Livres","200513":"Chaise","200514":"Toilettes","200515":"Lit","200516":"Ours en Peluche","200517":"Grand Trou","200518":"Toboggan","200519":"Fontaine","200520":"Grande Fontaine","200521":"Grand Palmier D\xe9coratif","200600":"Pomme de terre","200601":"Laitue","200602":"Poivron","200603":"Orange","200604":"Salade Compos\xe9e","200605":"Sandwich","200606":"Gratin de Pommes de Terre","200607":"Brandy","200608":"Scie","200609":"Pelle","200610":"Tournevis","200611":"Marteau","200612":"Boulon","200613":"Ph\xe9nix","200614":"Plume de Ph\xe9nix","200615":"Cloche de Laiton","200616":"Sang de Vampire","200617":"Espoir","200618":"C\u0153ur Jaune","200619":"C\u0153ur Vert","200620":"C\u0153ur Violet","200621":"Carnaval","200622":"Guilde","200623":"Cochon","200800":"Trouv\xe9 uniquement dans les parchemins","200801":"Qu\xeate d\'Espoir","armorclass":"Armor Class","attackbonus":"Attack Bonus","attackrange":"Attack Range","backpackCapacity":"Backpack Capacity","damage":"Damage","hp":"Hit Points","iscamping":"Is Camping","maxhp":"Max Hit Points","range":"Range","speed":"Attack Speed","warehouseCapacity":"Warehouse Capacity"}'),s=JSON.parse('{"0":"Secrets of Elsinore","1":"El servidor no est\xe1 en funcionamiento.","2":"Mapa de la Frontera","3":"Tierra labrada con \xe9xito.","4":"\u26a0\ufe0f No tienes suficientes recursos.","5":"\u2692\ufe0f Construcci\xf3n completada con \xe9xito.","6":"\ud83d\udcb0 Art\xedculos vendidos.","7":"\ud83c\udfe0 Esta hacienda est\xe1 desocupada.","8":"\ud83d\udeab Esta \xe1rea est\xe1 prohibida.","9":"El valle est\xe1 lleno de maravillas y debe explorarse a pie.","10":"\ud83c\udfe0 Hacienda de [nombre de usuario].","11":"\ud83c\udfe0 Hacienda del propietario desconocido.","12":"Vista del asentamiento. Dependiendo de tu ubicaci\xf3n, es posible que debas desplazarte para ver la ciudad.","13":"Vista fronteriza.","14":"\ud83d\udc78 Bienvenido a la ciudad.","15":"\ud83d\udc34 Necesitas un Caballo para viajar aqu\xed. Visita el Campamento de Aventura en el Pueblo.","16":"Est\xe1s en el valle.","17":"No eres due\xf1o de ninguna hacienda aqu\xed.","18":"\ud83d\udeab No puedes ir por ese camino.","19":"\ud83c\udf92 Necesitas una mochila para recolectar recursos lejos de tu hacienda. C\xf3mprala en el Campamento de Aventuras.","20":"\ud83d\udeab No hay suficiente espacio en el almac\xe9n.","21":"\ud83c\udf92 No hay suficiente espacio en la mochila. Abre el inventario para administrar el contenido de la mochila.","22":"Art\xedculos comprados.","23":"\u26a0\ufe0f No puedes construir aqu\xed.","24":"\ud83c\udfaf Fuera de alcance.","25":"\ud83c\udf92 Nada en la mochila.","26":"\ud83c\udf92 Debes estar en tu hacienda para vaciar la mochila.","27":"\u26fa\ufe0f No tienes una tienda de campa\xf1a.","28":"\u26fa\ufe0f Ahora est\xe1s acampando.","29":"\u26a0\ufe0f \u26fa\ufe0f Error al acampar / desmontar.","30":"\u26fa\ufe0f Ya no est\xe1s acampando.","31":"\u26fa\ufe0f No puedes atacar mientras acampas.","32":"\u26fa\ufe0f Necesitas desmontar primero.","33":"\ud83d\udce6 Art\xedculos movidos al almac\xe9n.","34":"\ud83c\udf92 Mochila vac\xeda.","35":"Necesitas un ","36":"Usaste un ","37":"\ud83d\udef6 No tienes un bote.","38":"Info del Jugador:","40":"No puedes atacar a trav\xe9s de las paredes.","41":"Est\xe1s lleno","42":"Gana: ","44":"Sin mochila","45":"Kent comprar\xe1 estos productos:","46":"Kent regresa en:","47":"Puedo comprarte mercanc\xedas.","48":"\xbfNecesitas consejo?","49":"Curaciones restantes:","50":"\ud83d\udeab Ese nombre de usuario ya est\xe1 en uso.","51":"Curaciones Totales: ","70":"Sesi\xf3n expirada","71":"Has estado ausente por un tiempo. Actualizar asegura que tu sesi\xf3n funcione correctamente.","72":"Esta p\xe1gina se actualizar\xe1 autom\xe1ticamente en 30 segundos a menos que lo hagas ahora.","73":"\ud83d\udd04 Actualizar ahora","74":"\ud83c\udf92 Se requiere una mochila para tener una tienda de campa\xf1a.","75":"No tienes una mochila. Puedes comprar una en el Campamento de Aventuras en la Ciudad.","76":"Tu almac\xe9n est\xe1 vac\xedo.","77":"Tu mochila est\xe1 vac\xeda.","78":"\ud83c\udf7d\ufe0f Comer","80":"Adquirido ","81":"Montar una tienda en el Pueblo o en el Valle evita que seas atacado.","82":"Un bote te permitir\xe1 viajar por agua.","88":"Tu almac\xe9n est\xe1 a capacidad m\xe1xima.","89":" capacidad con Pase de Oro","90":"\ud83d\udeab Esta no es tu hacienda.","91":"\ud83d\udc34 Se requiere caballo.","94":"\ud83d\udce2 \xa1Comparte Valley View!","95":"\xa1Invita a otros a ayudar y unirse a la aventura!","96":"\xbfTienes comentarios?","97":"@ Env\xedanos un correo","98":"\u23f3 Cargando ...","99":"\u26a0\ufe0f Algo sali\xf3 mal.","100":"CADENAS DE VIAJE:","101":"\ud83d\udc34 Viajando a casa... por favor espera.","102":"\ud83d\udc34 Viajando a la ciudad ... por favor espera.","103":"\ud83d\udc34 Viajando a la pr\xf3xima ubicaci\xf3n ... por favor espera.","104":"\ud83d\udeab No hay una ciudad en este asentamiento a\xfan.","105":"\u26a0\ufe0f Hubo un problema al intentar viajar.","106":"\ud83d\udeab No puedes viajar m\xe1s all\xe1 de la frontera.","107":"Tu Granja","108":"Tu Pueblo","110":"\u27a1\ufe0f \xa1Camina hacia los postes indicadores para usarlos!","111":"\ud83d\udc78 Bienvenido a la ciudad.","112":"\ud83c\udfe0 Bienvenido a casa.","120":"No te quedan movimientos de casas de campo.","121":"Has movido con \xe9xito tu casa de campo.","122":"\xa1No puedes mudarte al valle!","123":"\xa1No puedes mudarte a la ciudad!","124":"Esa casa de campo est\xe1 ocupada.","125":"\xbfHacia d\xf3nde te est\xe1s mudando?","126":"Esta casa de campo est\xe1 desocupada.","130":"Selecciona tu idioma","131":"Confirmar","140":"TEXTOS DEL PUESTO COMERCIAL:","141":"Vendido","151":"No puedes llenar el puesto de ventas de otro jugador.","152":"No tienes suficiente dinero para comprar este art\xedculo.","153":"est\xe1 vendiendo:","154":"est\xe1n vendiendo","155":"La transacci\xf3n fall\xf3. Este art\xedculo ya ha sido vendido.","156":"Vac\xedo (a\xf1adir objetos)","157":"Comprado por","158":" L\xcdMITE POR PEDIDO","159":"Listo para vender","160":"\ud83d\udce5 Puesto Comercial: A\xf1adir Art\xedculos para Vender","161":"Art\xedculo","162":"Tienes","163":"Precio ud.","164":"Cantidad a A\xf1adir","165":"Todo","166":"Agregar","167":"Vender","168":"S\xed, Vender Todo","169":"Comprar","170":"Ranura de comercio desbloqueada","171":"Requiere Pase Dorado","172":"Bloqueado","173":"L\xedmite de","174":"para Vender","175":"Desbloquear por","176":"Madera","177":"Necesitas","178":"para desbloquear esta ranura","179":"Este Puesto solo acepta art\xedculos de tu mochila. Cualquier jugador puede recolectar dinero de un Puesto.","180":"A la Mochila","181":"\ud83d\udce6 Almac\xe9n","182":"\ud83c\udf92 Mochila","183":"Capacidad: ","184":"Gestionar","185":"Cantidad","186":"Monto","187":"\ud83c\udf92 Gesti\xf3n de Mochila","188":"Descartar","189":"A\xf1adir todo al almac\xe9n","190":"Descartar todo","191":"Art\xedculo","192":"Acci\xf3n","193":"\ud83d\udce6 Gesti\xf3n de Almac\xe9n","194":"Expandir","195":"Expande la Mochila en el Campamento de Aventuras en la Ciudad.","196":"A\xf1adir ","197":"Almac\xe9n mejorado","198":" a la capacidad del almac\xe9n.","199":"Capacidad significativamente mayor con el Pase Oro (entre otros beneficios).","200":"MISIONES","201":"\u2705 Misi\xf3n completada. Tienes tu recompensa.","202":"\u2705 Misi\xf3n aceptada.","203":"No hay misiones activas por el momento.","204":"est\xe1 ofreciendo estas misiones:","205":"Nada nuevo por el momento. \xa1Revisa tu lista de tareas \u2705!","206":"Vuelve al PNJ que te dio esta misi\xf3n para recoger tu recompensa.","207":"En Progreso","208":"Obtener Recompensa","209":"Aceptar Misi\xf3n","299":"CUADRO DE AGRICULTURA:","300":"Agregado","301":"Labrado","302":"\ud83c\udf31 Plantado","303":"\ud83c\udf31 Debes plantar en tierra","304":"\ud83c\udf31 No puedes plantar aqu\xed","305":"\u26a0\ufe0f No hay suficientes recursos","306":"\u26a0\ufe0f No puedes construir aqu\xed","307":"\ud83c\udf31 Debes plantar en musgo","308":"\ud83c\udf31 Debes plantar en arena","310":"Debes labrar la tierra para plantar.","311":"Tus animales de granja necesitar\xe1n mucho pasto para pastar.","312":"El pavimento puede ser \xfatil para controlar los animales errantes.","313":"Los caminos de adoquines agregan decoraci\xf3n a tu granja.","315":"Seleccionar Cultivos para Cosechar:","316":"Seleccionar Todo","317":"Deseleccionar Todo","318":"Recolectar","319":"Seleccionar Animales para Recolectar:","320":"No se puede terraformar aqu\xed.","340":"No disponible a menos que est\xe9s a pie.","341":"Seleccionar Estaciones de Artesan\xeda para Recolectar:","342":"\xbfCosechar?","343":"\xbfReplantar?","344":"No hay cultivos listos para cosechar.","345":"Listo para recolectar:","346":"\xbfRecolectar?","347":"Comprar 1 por: ","350":"El Pe\xf3n de Granja te ayudar\xe1 a automatizar la cosecha y plantaci\xf3n de cultivos.","351":"El Ranchero te ayudar\xe1 a automatizar la recolecci\xf3n de animales.","352":"El Le\xf1ador te ayudar\xe1 a automatizar la tala de \xe1rboles para madera.","353":"El Artesano te ayudar\xe1 a automatizar la recolecci\xf3n de estaciones de artesan\xeda.","354":"Kent es tu Administrador de Granja. Puede ayudarte a administrar tu granja.","355":"El Pastor te guiar\xe1 en la gesti\xf3n de tus animales de granja.","356":"Resultados de Cosecha Masiva","357":"Cultivos Cosechados","358":"Cultivos Replantados","359":"\xa1Objetos Encontrados!","360":"Continuar","361":"Semillas utilizadas","362":"Mercado Global","363":"No hay art\xedculos disponibles para comprar actualmente","364":"art\xedculos disponibles","365":"Comprar","366":"Cerrar","367":"Tus Espacios de Comercio:","368":"Enviar Bienes a Casa","369":"Env\xeda art\xedculos de tu mochila directamente a tu almac\xe9n en casa.","400":"COMPRANDO, CREANDO, HABILIDADES, SANANDO, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Ya tienes la m\xe1xima cantidad de puntos de vida.","402":"\u26a0\ufe0f recursos.","403":"\u26a0\ufe0f Tu inventario est\xe1 lleno.","404":"Trabajando...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Puntos de vida sanados por +","406":"M\xe1ximo alcanzado para esta ubicaci\xf3n.","407":"M\xe1ximo alcanzado para esta ubicaci\xf3n.","408":"Se necesitan m\xe1s Hospitales.","410":"\ud83c\udfd5\ufe0f Para usar una tienda comprada, haz clic en tu propio \xedcono de jugador.","420":"Intercambios:","421":"Utilizado en:","422":"Valor Base:","423":"No hay intercambios disponibles.","424":"No hay recetas disponibles.","425":"Vender para reembolso.","426":"Si tienes menos de 10 de estos cultivos, puedes comprarlos aqu\xed:","427":"Compra la habilidad de Cosecha a Granel del Ayudante de la Granja para cosechar todos los cultivos de una vez.","428":"Haz clic para cosechar al instante todos los cultivos.","429":"No tienes cultivos para cosechar.","430":"Habilidades del Ayudante de la Granja:","431":"Compra la habilidad de Recolecci\xf3n de Animales a Granel del Ayudante de la Granja para recolectar todos los animales de una vez.","432":"Compra la habilidad de Tala del Ayudante de la Granja para cortar varios \xe1rboles a la vez y recolectar la madera.","433":"Compra Mejora de Tala para aumentar la cantidad de \xe1rboles cortados a la vez.","434":"Haz clic para recolectar al instante de todos los animales.","435":"Haz clic para cortar al instante varios \xe1rboles y recolectar madera.","436":"No tienes animales para recolectar.","437":"No tienes \xe1rboles para cortar.","438":"Eliminar","439":"Cultivo devuelto.","440":"Fabricaci\xf3n iniciada ","441":"\u231b\ufe0f En progreso ...","442":"\ud83c\udfe0 \xa1Reparaciones de la casa completas!","450":"\u274c No puedes pagar los costos de fabricaci\xf3n","451":"\u26a0\ufe0f Fabricaci\xf3n ya en progreso","452":"\u274c No se pudo iniciar la fabricaci\xf3n.","453":"\u274c No se pudo reparar la casa.","454":"\u274c No se pudo contratar al trabajador.","455":" ha llegado!","456":"No hay m\xe1s trabajadores disponibles.","457":"\xa1Listo para recoger!","458":"Tiempo: ","459":"Instant\xe1neo","460":"Requiere: ","461":"Cuesta: ","462":"Da: ","463":"Cura: ","464":"Compra Fabricaci\xf3n en masa para recolectar de todas las estaciones de fabricaci\xf3n listas de una vez.","465":"Haz clic para recolectar instant\xe1neamente de todas las estaciones de fabricaci\xf3n listas.","466":"No tienes estaciones de fabricaci\xf3n listas para recolectar.","467":"Recolecci\xf3n de fabricaci\xf3n en masa completada: ","468":"Reiniciado: ","469":"+","470":"No puedes viajar ahora, hay acciones agr\xedcolas en progreso.","471":"\u26a0\ufe0f Ya en progreso.","472":"Cosechado","475":"\xbfReiniciar?","476":"Estaci\xf3n","477":"Tus trabajadores agr\xedcolas est\xe1n ocupados...","478":"\ud83c\udf31 Trabajando","479":"Tala","480":"Elaborado","481":"con","482":"aplicado","483":"replantado","490":"Vender para reembolso (Solo desarrollo)","500":"CADENAS DE COMBATE","501":"\ud83c\udfaf Fuera de alcance.","502":"\ud83c\udfaf \xa1Acertaste!","503":"\u274c Fallaste","504":"\ud83d\udc80 Muerto","505":"\u26a0\ufe0f Error","510":"\u2764\ufe0f\u200d\ud83e\ude79 Est\xe1s recibiendo da\xf1o...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Tu Salud: ","512":"Tu Salud No Disponible","520":"Debes estar en la ciudad o en casa para equipar armas y armaduras.","522":"\ud83d\udee1\ufe0f Armadura equipada:","523":"No hay armadura disponible","524":"\u2694\ufe0f Arma equipada:","525":"No hay armas disponibles","526":"Mejoras m\xe1gicas:","527":"No hay mejoras m\xe1gicas disponibles","528":"Otro equipamiento:","550":"\ud83d\udee1\ufe0f Salud m\xe1xima","551":"\ud83d\udee1\ufe0f Clase de armadura","552":"\ud83c\udfaf Bonificaci\xf3n de ataque","553":"\u2694\ufe0f Da\xf1o","554":"\u2694\ufe0f Velocidad","555":"\ud83d\udc41\ufe0f Alcance de ataque","556":"\u26fa\ufe0f Acampando","557":"\ud83d\udef6 En el bote","558":"S\xed","559":"No","600":"CADENAS DE RELACI\xd3N:","601":"Relaci\xf3n:","602":"Has conocido a","603":"Ahora eres amigo de","604":"Tienes un flechazo por","605":"Est\xe1s enamorado de","606":"T\xfa y","607":"ahora est\xe1n casados.","608":"ahora son rivales.","609":"ahora es tu rival por esto.","610":"no estar\xe1 muy contento con esto...","611":"no estar\xe1n muy contentos con esto...","612":"estar\xe1 muy feliz con esto.","613":"aprueban esto.","614":"y","615":"Tu relaci\xf3n con","616":"ha cambiado.","619":"Intereses:","620":"Necesitas acercarte m\xe1s para interactuar con este personaje.","621":"por estar casados.","622":"por ser amigos.","623":"por estar enamorados.","625":"Construye una relaci\xf3n para desbloquear tareas con este personaje.","626":"Construye una relaci\xf3n para desbloquear intercambios con este personaje.","627":"Con una mejor relaci\xf3n, {npc} podr\xeda tener tareas adicionales para ti.","628":"Con una mejor relaci\xf3n, {npc} podr\xeda tener intercambios adicionales para ti.","630":"Saludar","631":"Hablar","632":"Comerciar","633":"Misi\xf3n","634":"Conocido","635":"Amigo","636":"Casado","637":"Rival","638":"Amor","639":"Enamoramiento","640":"Bromear","641":"Hacer amistad","642":"Insultar","643":"Abrazar","644":"Besar","645":"Disculparse","646":"Dar un regalo","647":"Halagar","648":"Adular","649":"Declarar amor","650":"Proponer matrimonio","651":"Provocar","652":"Molestar","653":"Terminar matrimonio","660":"Enamorado/a de: ","661":"Amigo/a de: ","662":"Rival de: ","663":"Casado/a con: ","700":"CADENAS FTUE:","701":"\ud83d\udc78 Bienvenido a Valley View","702":"\xa1Bienvenido, viajero! Has llegado a Valley View, una tierra fronteriza llena de oportunidades, misterios y aventuras.","705":"Aspiraci\xf3n","706":"Valley View es un mundo grande. Depende de ti c\xf3mo quieres pasar tu tiempo. \xbfCu\xe1l de estas aspiraciones se adapta mejor a tu estilo de juego? (Esta elecci\xf3n no limitar\xe1 tus opciones de ninguna manera.)","721":"\ud83e\udd20 Cosechar y vender cultivos","722":"Querr\xe1s empezar a ganar \ud83d\udcb0 Dinero de inmediato. Cosecha algo de \ud83c\udf3e Trigo y v\xe9ndelo a \ud83e\udd20 Kent.","723":"\ud83d\udcaa Habilidad de cultivador","724":"\xa1Cha-ching! Ahora, para sacar m\xe1s provecho de tu granja, adquiere la habilidad \ud83d\udcaa Cultivador.","727":"\ud83c\udf3d Plantar","728":"\xa1Genial, ahora empieza a cultivar! Puedes plantar nuevos cultivos usando el panel de \ud83c\udf31 Agricultura.","729":"\ud83d\udc2e Vida animal","730":"\xa1Excelente! Mientras eso crece, traigamos vida a la granja. Primero, adquiere la habilidad \ud83d\udcaa Ganader\xeda. Luego visita el panel de \ud83d\udc2e Animales para comprar una vaca.","731":"\ud83c\udf33 Madera","732":"\xa1Maravilloso! Valley View es rico en bosques. La madera es un recurso vital para la artesan\xeda y la construcci\xf3n. Para talar \xe1rboles, necesitar\xe1s adquirir la habilidad \ud83d\udcaa Hacha.","733":"\u2692\ufe0f Constructor","734":"\xa1Bien, has obtenido el \ud83e\ude93 Hacha! Adem\xe1s de construir estaciones de artesan\xeda, tambi\xe9n puedes abrirte camino hasta la \ud83d\ude82 Estaci\xf3n de tren al borde de tu Homestead. Usa el \u27a1\ufe0f Poste se\xf1alizador para viajar al pueblo.","737":"Hora de explorar","738":"Tu Homestead es parte de un asentamiento m\xe1s grande con otros jugadores compartiendo una gran Frontera. Usa los \ud83c\udfdb\ufe0f Postes se\xf1alizadores para viajar, o camina hasta el borde de cualquier mapa. \xa1DISFRUTA JUGANDO VALLEY VIEW!","740":"Despert\xe9 de una extra\xf1a pesadilla, para encontrarme en un bosque oscuro, frente a la entrada de una cueva.","741":"Usa las teclas A-W-S-D (o las flechas) para mover tu personaje y encuentra la salida de la cueva.","742":"Esto parece la entrada a un pueblo. Saluda al Alguacil que guarda la puerta.","750":"\ud83c\udf31 Granjero","751":"Cultiva tu granja, siembra cultivos, cuida animales y fabrica bienes para vender e intercambiar con otros jugadores. Invierte en habilidades agr\xedcolas y artesanales para aumentar tus ganancias.","752":"\u2694\ufe0f Aventurero","753":"Avent\xfarate en el Valle por recursos y objetos raros. Lucha contra animales y criaturas, descubre lugares ocultos y conoce personajes m\xe1gicos. Invierte en habilidades de combate para convertirte en un luchador formidable.","754":"\ud83c\udfdb\ufe0f Pol\xedtico","755":"Post\xfalate para Alcalde, establece la tasa de impuestos y gana ingresos fiscales para ti mismo. Invierte en edificios comunitarios para toda la Ciudad, como Hospitales, Escuelas y Bibliotecas, y ayuda a tu asentamiento a prosperar.","780":"Cu\xe9ntanos qu\xe9 piensas de Valley View","781":"Seguir\xe9 jugando; aqu\xed est\xe1 el porqu\xe9 (marca todas las que apliquen):","782":"Dudo que regrese; aqu\xed est\xe1 el porqu\xe9 (marca todas las que apliquen):","783":"Jugar","784":"Se ve divertido","785":"Me gustan los visuales","786":"Me gusta la agricultura","787":"Espero colaborar con otros","790":"No pude entenderlo","791":"No me gustan los visuales","792":"Tuve un problema t\xe9cnico","793":"Simplemente no es para m\xed","794":"Jugar","795":"Saltar Tutorial","796":"OK","797":"Atr\xe1s","798":"Jugar","800":"M\xc1S CADENAS DE ESTACI\xd3N DE ARTESAN\xcdA:","801":"Adquiere la habilidad ","802":" en el ","803":" para aumentar la producci\xf3n de esta estaci\xf3n en ","805":"Tu habilidad ","806":" aumenta la producci\xf3n base de esta estaci\xf3n en ","810":"Tambi\xe9n puedes comprar esta habilidad directamente: ","811":"\xa1Subida de nivel!","812":"\xa1Felicidades! \xa1Has alcanzado el nivel {level}!","813":"\xa1Subida de nivel! \xa1Ahora eres nivel {level}!","814":"{feature} se desbloquea en el nivel {level}.","815":"Tu nivel actual: {level}","820":"Produce: ","821":"Cantidad base: ","825":"Tienes ","826":"Pergaminos.","827":"Pergamino","828":"Ya tienes esto.","829":"Revelando pergamino...","830":"Error al revelar el pergamino","831":"Revelar","832":"Necesitas pergaminos para usar el Templo Antiguo. Encuentra pergaminos explorando el mundo.","899":"CADENAS DE DEPURACI\xd3N:","900":"Depuraci\xf3n: Inventario limpiado.","901":"Depuraci\xf3n: Historial de misiones limpiado.","902":"Depuraci\xf3n: Recursos a\xf1adidos.","903":"Depuraci\xf3n: Cuadr\xedcula reiniciada con \xe9xito.","904":"Depuraci\xf3n: Habilidades a\xf1adidas.","905":"Depuraci\xf3n: Habilidades y Poderes limpiados.","906":"Depuraci\xf3n: Estad\xedsticas de combate restablecidas.","999":"CADENAS DE IU DE PANEL:","1000":"[Falta descripci\xf3n]","1001":"Los recursos recolectados en la granja van al almac\xe9n. Los recursos recolectados en la ciudad o en el valle ir\xe1n a la mochila. Para comprar una mochila, visita la Tienda en la ciudad.","1002":"Construir: Construye estaciones de elaboraci\xf3n en tu Hacienda usando recursos de tu almac\xe9n.","1003":"Los animales comprados aparecer\xe1n en el icono de tu jugador, y comenzar\xe1n inmediatamente su vida en la Hacienda.","1004":"Labra la tierra para plantar cultivos. Planta pasto para que los animales de granja tengan algo en qu\xe9 alimentarse.","1005":"Adquiere Habilidades para mejorar diversos atributos. Aseg\xfarate de explorar el Pueblo para encontrar lugares y formas adicionales de obtener Habilidades.","1006":"Gestiona todas tus misiones en curso aqu\xed. Busca personajes que dan misiones en tu hacienda, as\xed como en la Ciudad o incluso en el Valle.","1007":"Los gobiernos en Valley View se forman a nivel de asentamiento. El alcalde electo implementa pol\xedticas y construye edificios para ayudar a que la comunidad prospere.","1008":"Compra y vende con otros jugadores. Si nadie compra tus art\xedculos antes de que expire el temporizador, v\xe9ndelos al juego.","1009":"[Descripci\xf3n de Elaboraci\xf3n]","1010":"[Descripci\xf3n de Buz\xf3n]","1011":"Este Puesto de Animales est\xe1 vac\xedo. Aseg\xfarate de que los animales tengan pasto para comer, y eventualmente vendr\xe1n al puesto para la cosecha.","1012":"Las elecciones tienen lugar en el Palacio de Justicia. Aqu\xed, los alcaldes tienen el poder de establecer la tasa impositiva y renombrar el Asentamiento.","1013":" ","1014":" ","1015":"El juego se desarrolla a lo largo de estaciones en constante cambio.","1016":" ","1017":"Visita el Banco para intercambiar objetos por Dinero, incluyendo objetos raros como Oro y Plata. Vuelve al banco regularmente para ofertas diferentes.","1018":"","1019":"[Descripci\xf3n de perfil]","1021":"\xa9 Valley View Studios, 2025, Todos los derechos reservados.","1022":"[Descripci\xf3n del tren]","1023":"Los trabajadores te ayudan a administrar tu granja. Contr\xe1talos en la Casa de la Granja.","1024":"[Descripci\xf3n de combate]","1025":"[Descripci\xf3n de la tienda]","1026":"Ganar y gastar Dinero.","1027":"Estos son los beneficios de un Pase de Oro.","1028":"[Descripci\xf3n del panel de decoraciones]","1029":"[Panel de Animales]","1030":"[Panel de Cultivos]","1031":"Compra decoraciones para tu propiedad. Podr\xe1s venderlas para obtener un reembolso completo.","1032":"La casa de granja es donde puedes contratar personas para ayudarte a administrar tu propiedad.","1033":"Transforma la tierra con estas herramientas. Los animales necesitan pasto para pastar, los cultivos necesitan tierra para crecer. El pavimento puede ser \xfatil para controlar el movimiento de animales y personajes.","1034":"Ganar y gastar Gemas.","1035":"Esta es tu colecci\xf3n de Trofeos de por vida.","1036":"Revela pergaminos misteriosos en este Templo Antiguo.","1037":"Participa en el Carnaval con otros en tu Asentamiento. Completa todos los pedidos en equipo para ganar premios.","1038":"Sigue consultando con Kent para vender tus productos.","1039":"Adquiere estos animales de zool\xf3gico para poblar tu granja y desenterrar objetos raros.","1040":"Ve c\xf3mo te clasificas frente a otros jugadores en la frontera.","1101":"Inventario","1102":"\u2692\ufe0f Construir","1103":"\ud83d\udc2e Animales","1104":"\ud83c\udf31 Granja","1105":"\ud83d\udcaa Habilidades","1106":"\u2753 Misiones","1107":"\ud83c\udfdb\ufe0f Gobierno","1108":"\ud83d\udce5 Puesto de intercambio","1109":"Creaci\xf3n","1110":"\ud83d\udcea Buz\xf3n","1111":"\ud83d\udc3e Animales","1112":"\ud83c\udfdb\ufe0f Tribunal","1113":"Personaje ayudante","1114":"Personaje jugador","1115":"\ud83d\uddd3\ufe0f Temporada","1116":"\ud83d\udd01 Comerciante","1117":"\ud83c\udfe6 Banco","1118":"\ud83d\udd79\ufe0f C\xf3mo jugar","1119":"Perfil","1120":"\ud83d\udc1e Depurar","1121":"\ud83d\ude00 Bienvenido","1122":"\ud83d\ude82 Tren","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Granjero","1124":"\u2694\ufe0f Combate","1125":"\ud83d\uded2 Tienda","1126":"\ud83d\udcb0 Acerca del dinero","1127":"\u2b50\ufe0f Pase de Oro","1128":"\ud83e\ude91 Decoraciones","1129":"\ud83d\udc3e Animales","1130":"\ud83c\udf3d Cultivos y \xc1rboles","1131":"\ud83e\udeb4 Decoraciones","1132":"\ud83c\udfe0 Casa de Granja","1133":"\u26cf\ufe0f Herramientas","1134":"\ud83d\udc8e Gemas","1135":"\ud83c\udfc6 Trofeos","1136":"\ud83d\uded5 Templo Antiguo","1137":"\ud83c\udfa1 Carnaval","1138":"\ud83e\udd20 Kent","1139":"\ud83d\udc12 Animales del Zool\xf3gico","1140":"\ud83d\udcca Clasificaci\xf3n","1141":"\ud83d\udce5 Puesto Avanzado","1190":"\u2699\ufe0f Configuraci\xf3n","1301":"Habilidades para comprar:","1302":"Mejoras para comprar:","1303":"Habilidades que tienes:","1304":"Mejoras que tienes:","1305":"Todav\xeda no tienes habilidades.","1306":"Todav\xeda no tienes mejoras.","1350":"TEXTOS CARNAVAL","1351":"Mostrar Registro del Carnaval","1352":"El Carnaval est\xe1","1400":"CADENAS MODAL","1401":"MODAL DEL BANCO","1402":"Estas ofertas son buenas para","1403":"Comprar","1404":"por","1405":"No hay ofertas disponibles.","1406":"Nuevas ofertas en","1407":"Generando nuevos pedidos. Gracias por tu paciencia.","1408":"\u26a0\ufe0f No tienes suficientes art\xedculos.","1409":"\u26a0\ufe0f No tienes suficientes habilidades.","1410":"\u26a0\ufe0f No tienes suficientes mejoras.","1500":"CADENAS DE NOTICIAS DE LA CIUDAD","1501":"Noticias para","1502":"El alcalde actual es","1503":", y la tasa impositiva es","1504":"Esto es lo que est\xe1 sucediendo en la Ciudad en este momento:","1505":"Es temporada de elecciones y la campa\xf1a est\xe1 en pleno apogeo. Pasa por el Palacio de Justicia en la Ciudad para postularte como alcalde.","1506":"La votaci\xf3n para el pr\xf3ximo alcalde ha comenzado. Emite tu voto en el Palacio de Justicia en la Ciudad.","1507":"El Tren est\xe1 llegando, ofreciendo comprar:","1508":"El Tren est\xe1 partiendo. Cuando regrese, estar\xe1 comprando:","1509":"El Tren est\xe1 aqu\xed, ofreciendo comprar:","1510":" ","1511":"Visita el Banco para vender oro, plata y diamantes. El Banco est\xe1 actualizando sus ofertas actualmente.","1512":"Actualmente no hay alcalde.","1513":"El Tren est\xe1 partiendo en","1514":"Cuando regrese, estar\xe1 comprando:","1515":"La tasa impositiva es","1516":"El Banco est\xe1 comprando actualmente:","1517":"El Tren partir\xe1 en","1518":"Los votos en la \xfaltima elecci\xf3n para alcalde se est\xe1n contando. Se espera que los resultados est\xe9n listos en","1600":"CADENAS DE BUZ\xd3N","1601":"Cargando mensajes...","1602":"No tienes mensajes.","1603":"Recibido","1604":"Recoger","1605":"La mayor\xeda de los mensajes se eliminar\xe1n despu\xe9s de 14 d\xedas. Las compras en la tienda no se eliminar\xe1n.","1606":"\ud83d\udcea Buz\xf3n","1607":"\ud83d\uddd1\ufe0f Mensaje eliminado.","1700":"CADENAS DE TIENDA","1701":"\ud83d\uded2 Tienda","1702":"Las compras se entregar\xe1n en la Bandeja de entrada.","1703":"\ud83d\ude4f \xa1Gracias por tu apoyo! Somos un peque\xf1o desarrollador con pocos recursos, pero apasionados por crear un espacio divertido para una comunidad positiva.","1704":"Por favor, considera hacer compras para que podamos seguir mejorando el juego.","2000":"CADENAS DE TREN, BANCO, PALACIO DE JUSTICIA, ETC.","2002":"\u2705 Completado","2003":"\ud83d\ude82 Vista preliminar del pr\xf3ximo env\xedo:","2004":"\ud83c\udf81 Recompensas por completar todos los pedidos:","2005":"Haz clic para cumplir","2006":"Tu Pedido","2007":"Reclamado","2008":"Reclamar Pedido","2009":"Reclamado por ti:","2010":"Disponible para reclamar:","2011":"Reclamado por otros:","2012":"Completado:","2013":"Reclamado por ti:","2014":"Solo puedes reclamar una oferta de tren a la vez.","2015":"Mostrar Registro de Trenes","2016":"\u2705 \xa1Todos los pedidos han sido completados! Las recompensas han sido enviadas por correo.","2017":"Este pedido ya ha sido reclamado.","2018":"\ud83c\udfa1 Vista Previa del Pr\xf3ximo Carnaval:","2019":"Recompensas por completar todos los pedidos:","2020":"El tren es","2030":"Actualizaci\xf3n de Ofertas en","2040":"Bienvenido, Alcalde.","2041":"\ud83d\udcb0 Tasa de Impuestos: ","2042":"Propuesto: ","2043":"Actualizar","2044":"\u26a0\ufe0f Solo el Alcalde puede establecer la tasa impositiva.","2045":"\ud83d\uddf3\ufe0f Elecciones:","2046":"Fase Actual:","2047":"Temporizador de Fase:","2048":"\ud83d\udce2 Promesas de Campa\xf1a","2050":"Este no es tu asentamiento de origen.","2060":"La votaci\xf3n comienza en:","2061":"La votaci\xf3n termina en:","2062":"La votaci\xf3n ha terminado. Los resultados se anunciar\xe1n en:","2063":"La pr\xf3xima campa\xf1a comienza en:","2070":"\ud83d\udce2 Promesas de Campa\xf1a","2071":"Nadie ha hecho una promesa de campa\xf1a todav\xeda.","2072":"Ingresa tu promesa de campa\xf1a (m\xe1x. 200 caracteres)...","2073":"Enviar Promesa de Campa\xf1a","2074":"Emite tu Voto","2075":"No hay candidatos disponibles para la votaci\xf3n.","2076":"Promesa de campa\xf1a:","2077":"Ya has votado en esta elecci\xf3n.","2078":"No hubo candidatos.","2079":"\xbfC\xf3mo est\xe1 tu Alcalde?","2080":"Bienvenido, Alcalde.","2081":"Ingresa nombre del asentamiento...","2082":"Tu Asentamiento:","2083":"Actualizar Nombre","2084":"Visita el Panel de Gobierno \ud83c\udfdb\ufe0f para ver estad\xedsticas sobre c\xf3mo est\xe1 el asentamiento, para ayudar a guiar tu decisi\xf3n electoral.","2085":"Alcalde Actual:","2090":"\ud83c\udfe4 Edificios Comunitarios","2092":"\ud83c\udfeb Escuelas: ","2093":"\ud83c\udfeb A\xfan no se han construido Escuelas.","2094":"\ud83c\udfe5 Hospitales: ","2095":"\ud83c\udfe5 A\xfan no se han construido Hospitales.","2096":"\ud83d\udc3e Patios de Animales: ","2097":"\ud83d\udc3e A\xfan no se han construido Patios de Animales.","2098":"\ud83c\udfe4 Bibliotecas:","2099":"\ud83c\udfe4 A\xfan no se han construido bibliotecas.","3000":"PANEL DEL GOBIERNO:","3001":"Asentamiento:","3002":"\ud83d\ude0a Poblaci\xf3n.","3003":"\ud83d\udcb0 Tasa de Impuestos:","3004":"La tasa impositiva la fija el Alcalde, para este asentamiento y un porcentaje de todos los impuestos recaudados se agrega a la cuenta del Alcalde.","3005":"Los Alcaldes son elegidos en el Ayuntamiento de la Ciudad.","3006":"\ud83c\udfdb\ufe0f Funcionarios del Gobierno","3007":"Todav\xeda no se han elegido funcionarios del gobierno.","3009":"Solo el Alcalde puede construir Escuelas, Hospitales y Bibliotecas en la Ciudad.","3010":"\ud83c\udfeb Las Escuelas brindan a los ciudadanos acceso a ciertas habilidades que no se pueden obtener en otro lugar.","3011":"\ud83c\udfe5 Los Hospitales suministran Doctores, que pueden curar a los aventureros que regresan del Valle.","3012":"\ud83c\udfe4 Las Bibliotecas son una fuente de Libros, que son vitales para los Aventureros que buscan aprender nuevas habilidades.","3013":"\ud83d\ude82 El Alcalde puede influir en la demanda de bienes en el Tren.","3020":"Ver Registro de Impuestos","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"TEXTOS DEL PANEL DE TEMPORADA","3051":"(El patrimonio neto se recalcula dos veces al d\xeda.)","3052":"No hay datos disponibles para los mejores ciudadanos.","3053":"Es","3054":"Cargando...","3055":"La temporada termina en:","3056":"Estamos entre temporadas.","3057":"Al final de la temporada, se enviar\xe1n recompensas adicionales a los mejores jugadores de la Frontera, as\xed como a todos los jugadores del mejor Asentamiento.","3058":"\ud83c\udfc6 Mejores Ciudadanos de la Frontera","3059":"\ud83c\udfd9\ufe0f Asentamiento L\xedder","3060":"Riqueza Total:","3061":"Poblaci\xf3n:","3062":"Desconocido","3063":"No hay datos disponibles","3064":"Ver Registro de Temporada","4000":"\xbfTodav\xeda no tienes una cuenta? Crea una cuenta gratuita para empezar a jugar:","4001":"Crear Cuenta","4002":"Crear un Nuevo Perfil","4003":"No se te pedir\xe1 una direcci\xf3n de correo electr\xf3nico.","4004":"Con una nueva cuenta, se te otorgar\xe1 tu propia hacienda para cultivar en un asentamiento con otros jugadores, en una Frontera llena de Asentamientos. La aventura te espera en el Valle.","4005":"Contrase\xf1a","4006":"Iniciar Sesi\xf3n","4007":"Nombre de Usuario","4008":"Inicia sesi\xf3n en tu cuenta para seguir jugando. Si no tienes una","4009":"PANEL DE PERFIL:","4010":"\xbfYa tienes un perfil?","4050":"Hola,","4051":"Cambiar Nombre de Usuario:","4052":"Cambiar Contrase\xf1a:","4053":"Gesti\xf3n de la Cuenta","4054":"Estado de la Cuenta:","4055":"Cerrar Sesi\xf3n","4056":"Eliminar Cuenta","4057":"ID del Jugador:","4058":"Reubicaci\xf3n de la Hacienda","4059":"Reubicaciones Restantes:","4060":"Visita la Tienda para comprar m\xe1s Reubicaciones.","4061":"Ajustes","4062":"Idioma:","4063":"Indicador de Rango:","4064":"Cambiar Avatar","4065":"Volver al Inicio de Sesi\xf3n","4066":"Seleccionar Idioma","4067":"Seleccionar Idioma","4068":"\xa1Comienza Tu Aventura!","4069":"Elige un nombre de usuario","4070":"Elige una contrase\xf1a","4071":"Elige tu icono de jugador:","5000":"M\xc1S CADENAS MODALES:","5001":"Has sido devuelto a casa. Cualquier \xedtem de la mochila \ud83c\udf92 que ten\xedas se perdi\xf3.","5002":"Ten m\xe1s cuidado la pr\xf3xima vez.","5003":"\ud83d\ude00 Bienvenido a Valley View\u2122","5004":"\ud83d\udc80 \xa1Has ca\xeddo!","5005":"Por favor inicia sesi\xf3n o crea una cuenta gratuita.","5006":"\xa9 Estudios Valley View, 2025, Todos los derechos reservados.","5007":"\ud83d\udce8 Bandeja de entrada","5010":"No tienes mensajes","5011":"\ud83d\uded2 Tienda","5015":"Las compras ser\xe1n entregadas en la Bandeja de entrada. No podemos ofrecer devoluciones. Todas las compras son finales.","5016":"Ten en cuenta que la mayor\xeda de los \xedtems del inventario se borran entre temporadas, as\xed que verifica el reloj de la temporada antes de comprar y consulta el panel de temporadas para m\xe1s informaci\xf3n.","5017":"\ud83d\udeab Actualmente no has iniciado sesi\xf3n.","5020":"Haz clic en el bot\xf3n Iniciar Sesi\xf3n o Crear Cuenta para empezar.","5021":"\ud83d\ude4f Gracias por tu apoyo!","5025":"Tu compra ha sido entregada en tu Bandeja de entrada.","5026":"\xa1Disfruta de Valley View!","5027":"\ud83d\ude00 \xa1Bienvenido a Valley View!","5030":"Ning\xfan jugador est\xe1 conectado o el servidor est\xe1 fuera de l\xednea.","5031":"Por favor actualiza la p\xe1gina, verifica tu conexi\xf3n a internet o regresa m\xe1s tarde.","5032":"\xa1Estamos entre temporadas!","5035":"Valley View no est\xe1 disponible temporalmente mientras reiniciamos la temporada.","5036":"\ud83d\udcf0 Noticias de la Ciudad","5040":"Esto es lo que est\xe1 sucediendo en la Ciudad en este momento:","5041":"Usar ","5045":"\xbfDeseas usar un ","5046":"Tienes ","5047":"\u26a0\ufe0f Confirmar Movimiento de la Hacienda","5050":"\xbfEst\xe1s seguro/a de que deseas mover tu hacienda? Esto no se puede deshacer.","5051":"Cierra este di\xe1logo para cancelar.","5052":"\u2b50\ufe0f \xa1Felicidades!","5060":"Ahora tienes un Pase Oro. Ve a tu panel de Perfil para personalizar tu icono de jugador y descubrir otros beneficios del Oro.","5061":"\xa1Gracias por tu apoyo!","5062":"Colecciones Recientes de Impuestos","5070":"Tu viaje no tiene que terminar aqu\xed...","5071":"Elige tu destino:","5072":"Revivir por","5073":"Aceptar tu muerte","5074":"\xbfNecesitas m\xe1s gemas?","5100":"A\xfan no hay historial de recolecci\xf3n de impuestos.","5101":"\ud83d\uddd3\ufe0f Fecha","5102":"\ud83d\udcb0 Total Recolectado","5103":"Alcalde","5104":"\ud83d\udcb0 Participaci\xf3n del Alcalde","5105":"\ud83d\udcb0 Comisi\xf3n del Alcalde","5110":"C\xd3MO JUGAR FRASES:","6000":"CADENAS DE TROFEOS:","6001":"Aqu\xed est\xe1n tus Trofeos de por vida:","6002":"A\xfan no tienes trofeos. Gana trofeos por logros a lo largo del juego.","6003":"\xa1Trofeo Ganado!","7000":"CADENAS DE NOTIFICACI\xd3N:","7001":"Consejo:","7002":"\xa1Felicidades!","7003":"Haz clic en \ud83e\udd20 Kent para vender productos.","7004":"Nota:","7005":"Usa A-W-S-D o las teclas de flecha para moverte. Ve a la tierra y luego selecciona \ud83c\udf31 Parcela de trigo.","7006":"Busca el icono \ud83d\udcaa para abrir el panel de Habilidades. Sigue vendiendo productos a \ud83e\udd20 Kent para ganar Dinero y \ud83d\udd37 XP.","7007":"Despu\xe9s de adquirir Ganader\xeda, ve a una casilla de \ud83d\udfe9 hierba, luego encuentra el panel de \ud83d\udc2e Comprar para comprar una \ud83d\udc2e Vaca.","7008":"Los cultivos necesitan tierra. Las vacas y ovejas necesitan \ud83d\udfe9 hierba. El pavimento puede ayudar a contener los movimientos de personas y animales. Usa las \u26cf\ufe0f Herramientas para dar forma a la tierra a tu gusto.","7009":"Sigue revisando tu \u2705 Lista de tareas y sigue consultando con \ud83e\udd20 Kent y \ud83d\udc75\ud83c\udffb la Pastora.","7015":"Haz clic en + y - en la parte superior de la pantalla para acercar y alejar.","7017":"Has adquirido un objeto equipable. Visita el panel de \u2694\ufe0f Combate para equiparlo.","7020":"Para viajar instant\xe1neamente a casa, haz clic en el Asentamiento donde se encuentra tu Hacienda.","7021":"\xa1Llegaste al Valle! Aseg\xfarate de alejar el zoom (+ y -) para seguir tu ubicaci\xf3n. Si te pierdes, aleja el zoom hasta la vista de la Frontera para viajar de vuelta a casa.","7049":"Tutorial","7050":"Usa A-W-S-D o las teclas de flecha para moverte. Intenta hablar con el Alguacil Elbow.","7051":"Puedes comprar una Escritura de Casa del Alguacil Elbow, cuando est\xe9s listo para establecer tu Hacienda. O puedes explorar y prepararte para la aventura.","7052":"Con tu Escritura de Casa, puedes usar el \ud83c\udfe0 Se\xf1alador Casa para viajar a tu Hacienda en cualquier momento.","7053":"\xa1Bienvenido a tu Hacienda! Esta tierra es tuya para construir. Gana \ud83d\udcb0 Dinero vendiendo tus bienes a \ud83e\udd20 Kent.","7054":"Genial, \xa1ahora empieza a cultivar! Puedes plantar cultivos usando el panel \ud83c\udf3d Agricultura. Los cultivos deben plantarse en tierra.","7055":"\xa1Vas por buen camino! Sigue cultivando y vendiendo. Cuando est\xe9s listo, viaja de vuelta al Pueblo usando el \ud83c\udfdb\ufe0f Se\xf1alador, y obt\xe9n una Llave del Pueblo del Alguacil Elbow.","7056":"\xa1Ahora eres bienvenido al Pueblo! Explora todo lo que el Pueblo tiene para ofrecer, incluyendo desarrollar m\xe1s Habilidades, conocer a los Habitantes, y m\xe1s formas de ganar Dinero.","7057":"Ve a la \ud83c\udfea Tienda General en el pueblo para adquirir un Hacha.","7058":"Ve a la \ud83c\udfea Tienda General en el pueblo para adquirir un Pico.","7061":"Ahora viaja al Pueblo para obtener tu Llave del Pueblo del Alguacil Elbow. Usa el \ud83c\udfdb\ufe0f Se\xf1alizador del Pueblo para viajar all\xed.","7062":"\xa1Buen trabajo! Soy la Pastora, y te ayudar\xe9 con tu \u2705 Lista de Tareas. Vuelve a verme cuando completes las tareas.","8000":"TEXTOS DE MASCOTAS Y TEMPLO:","8001":"COM\xdaN","8002":"POCO COM\xdaN","8003":"RARO","8004":"\xc9PICO","8005":"LEGENDARIO","8010":"Esta mascota tiene hambre.","8011":"Alimentar","8012":" para enviarla a buscar tesoros.","8014":" est\xe1 buscando tesoros...","8015":"Vuelve en:","8016":" \xa1ha encontrado algo!","8999":"CADENAS DE C\xd3MO JUGAR:","9000":"\xa1Bienvenido a Secrets of Elsinore!","9001":"\xbfDe qu\xe9 trata?","9002":"Secrets of Elsinore es un juego que explora c\xf3mo las personas podr\xedan autoorganizarse y crear microsociedades en un mundo de recursos asim\xe9tricos e interdependencia, con espacios propios y compartidos.","9003":"Aunque no hay caminos de especializaci\xf3n expl\xedcitos, hay tres vectores principales de juego que son interdependientes. Estos son: el GRANJERO, el AVENTURERO y el POL\xcdTICO. Se te anima a apoyarte mutuamente.","9004":"Primero, lo b\xe1sico:","9005":"Usa las teclas A-W-S-D para MOVERTE. Haz clic para interactuar con las cosas que est\xe1n dentro de tu radio de interacci\xf3n.","9006":"Explora \ud83c\udf3d la AGRICULTURA, \u2692\ufe0f CONSTRUYE y \ud83d\udc2e COMPRA para mejorar tu Hacienda y generar recursos.","9007":"Genera \ud83d\udcb0 DINERO con \ud83e\udd20 KENT o en el \ud83d\udce5 PUESTO COMERCIAL.","9008":"M\xe1s:","9009":"A medida que generes riqueza, mej\xf3rate con HABILIDADES y CAPACIDADES. Por ejemplo, compra la habilidad de \ud83d\udc34 MONTAR A CABALLO para aventurarte en el Valle.","9010":"Aleja (- y +) para ver lo grande que es el mundo. Tu Hacienda es una de muchas en un ASENTAMIENTO. Cada ASENTAMIENTO tiene una CIUDAD compartida. Tu Asentamiento es uno de muchos en la FRONTERA.","9011":"Cuando est\xe9s listo, explora el VALLE, lleno de peligros y maravillas. Los secretos del mago PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f y del rey perdido LEONTES \ud83e\udd34, entre otros, se pueden encontrar en el Valle.","9012":"Tus Objetivos:","9013":"Si\xe9ntete libre de crear tus propios objetivos. Adem\xe1s, al final de cada \ud83d\uddd3\ufe0f TEMPORADA, que dura tres meses, tanto individuos como asentamientos ser\xe1n clasificados, y una posici\xf3n alta genera riqueza adicional. Tu granja, todas tus habilidades y tu inventario se transferir\xe1n a la pr\xf3xima Temporada.","9014":"\xa1Cultiva, fabrica, comercia, explora, lucha y disfruta!","9020":"C\xf3mo Ganar Dinero","9021":"Hay algunas formas de ganar \ud83d\udcb0 DINERO.","9022":"Cuando est\xe9s empezando, consulta con \ud83e\udd20 KENT. \xc9l comprar\xe1 mercanc\xedas, incluyendo cultivos y artesan\xedas.","9023":"Diferentes espacios en el \ud83d\udce5 PUESTO COMERCIAL tienen diferentes temporizadores. Durante el temporizador, solo puedes vender los productos si otro jugador los compra. Despu\xe9s del temporizador, puedes vender los productos al juego. Intenta comerciar con otros jugadores. Ellos tendr\xe1n cosas que necesitas, y viceversa.","9024":"En la Ciudad, encontrar\xe1s lugares como el \ud83c\udfe6 BANCO, que te comprar\xe1 art\xedculos espec\xedficos a un precio premium.","9025":"Gastar Dinero","9026":"Sorpresa, la mayor\xeda de las cosas cuestan Dinero. Inicialmente, querr\xe1s gastar dinero en \ud83d\udcaa HABILIDADES, \ud83d\udc2e ANIMALES DE GRANJA y \ud83d\uded6 ESTACIONES DE ARTESAN\xcdA. Explora los paneles en el lado izquierdo de la pantalla. Estos te ayudar\xe1n a generar m\xe1s recursos, lo que a su vez te ayudar\xe1 a ganar m\xe1s Dinero.","9027":"En la CIUDAD descubrir\xe1s m\xe1s Tiendas y Comerciantes.","9030":"C\xf3mo Ganar Gemas","9031":"Las Gemas son un recurso raro que se puede usar para comprar varias cosas para ayudar a acelerar tu juego.","9032":"Puedes comprar Gemas en la Tienda, o haciendo clic aqu\xed:","9033":"En raras ocasiones, las Gemas se pueden encontrar en el Valle, o ganar como recompensas por triunfar con el Tren, o terminar fuerte al final de una Temporada.","9040":"Obvio:","9041":"100 \ud83d\udc8e Gemas por ","9042":"Mejor Valor:","9043":"500 \ud83d\udc8e Gemas por ","9044":"M\xe1s Popular:","9045":"1000 \ud83d\udc8e Gemas por ","9050":"Beneficios","9051":"Con un Pase de Oro, puedes disfrutar de los siguientes beneficios:","9052":"\u2705 Avatares premium: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9053":"\u2705 Capacidad de Almac\xe9n casi ilimitada","9054":"\u2705 +100.000 capacidad de Almac\xe9n","9055":"\u2705 +5.000 capacidad de Mochila","9056":"\u2705 Tasa de Impuesto m\xe1s baja","9057":"\u2705 La mitad de tu MaxHP se restaura al morir","9058":"\u2705 Puedes postularte para un cargo","9059":"Gracias por comprar tu Pase de Oro.","9060":"Comprar un Pase de Oro","9061":"\ud83d\udd0c El servidor est\xe1 ca\xeddo","9999":"CADENAS DE ERROR:","10000":"El servidor est\xe1 actualmente ca\xeddo. Pedimos disculpas por las molestias, por favor, vuelve a intentarlo pronto.","10001":"(Este mensaje desaparecer\xe1 cuando el servidor vuelva a estar en funcionamiento.)","10002":"TEXTOS DE APP.JS:","10100":"\xa1Bienvenido a Valley View!","10101":"Por favor, inicia sesi\xf3n o crea una cuenta gratuita.","10102":"\ud83c\udf92 Inventario","10103":"\ud83d\uded2 Tienda","10104":"\ud83d\udce8, Bandeja de entrada","10105":"\ud83d\udce2 Compartir","10106":"\ud83d\udcac Chat","10107":"Tienes un Pase de Oro","10108":"\u2194\ufe0f Teclas de Movimiento: ","10109":"Controles:","10110":"Eres el Alcalde","10111":"\u2764\ufe0f\u200d\ud83e\ude79 Salud: ","10112":"\ud83d\uddd3\ufe0f Es","10113":"La Temporada Termina en:","10114":"La pr\xf3xima temporada comienza en:","10115":"\ud83c\udfdb\ufe0f Ocurriendo Ahora en la Ciudad:","10116":"\ud83d\udcb0 Pr\xf3xima Recaudaci\xf3n de Impuestos:","10117":"En: ","10118":"Recaudando impuestos ahora...","10119":"\ud83c\udfdb\ufe0f Elecciones: ","10120":"Finaliza: ","10121":"\ud83d\ude82 Tren: ","10122":"\ud83c\udfe6 Banco: ","10123":"Nuevas Ofertas: ","10124":"\xa1Lee las noticias!","10125":"\xa1Lee las Noticias del Pueblo!","10126":"No hay PCs presentes en la cuadr\xedcula.","10127":"Guardar Cambios","10128":"Guardar Cambios","10129":"Tienes un Pase de Oro","10130":"Beneficios del Pase de Oro","10131":"Cancelar Reubicaci\xf3n","10132":"Reubicar Hacienda","10133":"CADENAS AGREGADAS:","10135":"A-W-S-D para Moverse","10136":"I para Inventario","10137":"+/- para Zoom","10138":"Has desbloqueado:","10139":"Nuevas misiones de:","10149":"Nivel","10150":"\u2b06\ufe0f Nivel","10151":"\ud83d\udd37 EXP:","10152":"\ud83d\udef6 Subir al Bote","10153":"\ud83d\udef6 Bajar del Bote","10154":"\ud83c\udfd5\ufe0f Montar Tienda","10155":"\u26fa Guardar Tienda","10156":"Disponible","10157":"Salud","10158":"Cantidad a Comer","10159":"Ganancia de Salud","10160":"M\xe1x","10161":"\ud83c\udf7d\ufe0f Come Comida para Restaurar Salud","10162":"No tienes ning\xfan art\xedculo comestible en tu ","10170":"La puerta est\xe1 abierta para ti.","10171":"No tienes acceso.","10175":"Adquiere m\xe1s habilidades en varios lugares de la ciudad.","10180":"\ud83d\udce5 Puesto de Comercio: Solicitar Art\xedculos para Comprar","10181":" L\xcdMITE POR SOLICITUD","10182":"Est\xe1s entrando en ","10183":"Est\xe1s saliendo de ","10184":"El Valle","10185":"Elsinore","10186":"En una Mazmorra","10187":"Colocar con cursor","11000":"ADDED STRINGS:","11001":"Espera a que termine el temporizador, o que otro jugador compre este art\xedculo.","12001":"Construir","12002":"Construir","12003":"Animales","12004":"Misiones Activas","12005":"Habilidades","12006":"Combate","12007":"Gobierno","12008":"Estaciones","12009":"Hogar","12010":"Perfil","12011":"Decoraciones","12012":"Herramientas","12013":"Trofeos","12014":"Animales del Zool\xf3gico","15000":"\ud83d\uddd3\ufe0f Reglas de Temporada","15001":"Las temporadas duran tres meses.","15002":"Recompensas","15003":"\ud83d\udcb0 El patrimonio neto se calcular\xe1 en base a tu dinero, art\xedculos del inventario y art\xedculos en tu granja.","15004":"\ud83c\udfc6 Los 3 mejores jugadores a trav\xe9s de la frontera recibir\xe1n recompensas en tu buz\xf3n, y tambi\xe9n ganar\xe1n un trofeo de \'Ganador de Temporada\'.","15005":"\ud83c\udfc6 El mejor jugador en la frontera tambi\xe9n ganar\xe1 el trofeo de \'Campe\xf3n de Temporada\'.","15006":"\ud83c\udf81 Todos los jugadores en el mejor asentamiento recibir\xe1n recompensas adicionales en tu buz\xf3n.","15007":"Reinicio de Jugadores y Ubicaciones","15008":"\ud83c\udfe0 Ser\xe1s reubicado de vuelta a tu granja si est\xe1s lejos de casa cuando termine la temporada.","15009":"\ud83c\udfe0 Tus granjas NO se reiniciar\xe1n \u2013 todo el dise\xf1o, baldosas y recursos se mantienen.","15010":"\ud83c\udf92 A diferencia de temporadas anteriores, tu inventario NO ser\xe1 borrado.","15011":"\ud83d\udc8e Mantendr\xe1s todas las Gemas.","15012":"\ud83d\udcb0 A diferencia de temporadas anteriores, el Dinero NO ser\xe1 reducido.","15013":"\u2705 Todas las misiones ser\xe1n borradas.","15014":"\ud83d\udcaa Tus habilidades y poderes se mantienen.","15015":"\u2764\ufe0f Tus relaciones se mantienen.","15016":"\u2b50\ufe0f Tu estado de Pase Dorado ser\xe1 revocado para la nueva temporada.","15017":"\ud83c\udf32 Todas las cuadr\xedculas de ciudad y valle ser\xe1n reiniciadas con baldosas, recursos y enemigos frescos.","15018":"\xbfQu\xe9 Cambia?","15019":"\ud83c\udf83 Las ciudades tendr\xe1n baldosas y recursos seg\xfan el nuevo contenido de temporada.","15020":"\ud83d\ude00 Los nuevos jugadores que se unan (y creen nuevas granjas) obtendr\xe1n baldosas y recursos iniciales seg\xfan el nuevo contenido de temporada.","15021":"\ud83d\ude82 Los pedidos de tren son afectados por las temporadas.","15022":"\ud83c\udfc6 Se pueden ganar nuevas recompensas y trofeos.","15030":"\ud83d\uddd3\ufe0f Leer Sobre las Temporadas","16000":"TEXTOS DE HISTORIA","16001":"Bien hallado, {username}. Soy Portia, y defiendo las leyes que unen a nuestra comunidad. Ay\xfadame a construir las instituciones que nos civilizan \u2014 escuelas, hospitales, bibliotecas \u2014 y te recompensar\xe9 con influencia y posici\xf3n. Pero sabe esto: no todo lo que brilla es oro, y ese brib\xf3n de Iago no es m\xe1s que oropel. Ay\xfadalo, y habremos terminado.","16002":"\xa1Salve, soldado! Me alegro de ti, pues estas tierras necesitan m\xe1s luchadores para rechazar el mal que enfrentamos. \xa1Visita la Guarida del Guerrero y la Armer\xeda, y prep\xe1rate para la batalla!","16003":"Encantado de conocerte, {username}. Cassio es mi nombre, y defiendo el honor de mi hermana Julieta, mientras busco la cabeza de ese cobarde Duque Angelo. Se esconde en el Valle. Y no te hagas amigo de ese ladr\xf3n de Iago, o no har\xe9 negocios contigo.","16004":"\xa1Vaya, qu\xe9 encanto eres! Soy la Se\xf1ora Quickly, y me especializo en las artes culinarias. \xa1Con gusto te ayudar\xe9 a desarrollar tus habilidades con la comida, necesitamos m\xe1s magos de la cocina en estas tierras!","16005":"Muy complacido de conocerte, {username}. Mi nombre es Feste, y soy el artesano local de estos lugares. Puedo ayudarte a desarrollar tus habilidades creativas, pues hay buen dinero que ganar fabricando cosas finas para la gente.","16006":"Hola, amable viajero. Soy Helena, y vivo aqu\xed entre los campos de la Madre Naturaleza. Mientras exploras estas tierras, sabe que solo yo poseo la Llave Dorada del castillo donde el Rey Leontes perdi\xf3 su corona. Aunque suspiro por el amor de su reina, sacrificar\xeda mis sue\xf1os para ver a Leontes regresar a ella y a su antigua gloria.","16007":"Has viajado lejos, {username}. Soy Titania, Reina de las Hadas. Ahora has llegado al lugar m\xe1s all\xe1 del cual los peligros solo crecer\xe1n. Si encuentras a Prospero, no lo conviertas en tu enemigo, o no obtendr\xe1s nada de m\xed.","16008":"Bien, lo has logrado. Nunca so\xf1\xe9 que habr\xeda alguien capaz de derrotar a mis dragones y alcanzarme en este lugar. El Orbe de Merl\xedn es tuyo. Quiz\xe1s el Or\xe1culo pueda traernos Esperanza despu\xe9s de todo. B\xfascala en lo profundo del Valle.","16009":"[Pr\xf3spero]","16010":"Dame vida, dame amor, pero sobre todo... \xa1dame Oporto! A cambio, una ramita de Matricaria, m\xe1s preciada que el oro para algunos, especialmente esa Helena de ojos grandes. Dice que busca coronas y leyendas, pobre chica. \xbfYo? Busco una barriga llena y una siesta tranquila. \xabEst\xe1s tan atontado de beber vino viejo\xbb, me dijeron una vez. \xa1Ja! No se equivocaban.","16011":"Aqu\xed hay romero, para el recuerdo \u2014 y belladona, para los arrepentimientos. Mis pociones no son para los d\xe9biles de voluntad. Con la hoja correcta, puedo sanar tus miembros o enredar tu lengua. \xabRecuerdo a un boticario\xbb, dijo un muchacho una vez, y pag\xf3 el precio. \xbfPero t\xfa? Pareces m\xe1s sabio. Tr\xe1eme ra\xedces raras y semillas amargas, y te preparar\xe9 algo que vale el peligro.","16012":"Ah, viajero, los bosques est\xe1n llenos de conspiraciones susurradas, y Portia guarda una apretada contra su pecho como un avaro su moneda. Tr\xe1eme su secreto, te lo ruego, y pondr\xe9 en tu mano una Campana de Bronce de las m\xe1s raras. Su voz suena m\xe1s verdadera que cualquier juramento que haya hecho. Haz esto, y te susurrar\xe9 murmullos de travesuras a la luz de la luna, rivalidades profundamente arraigadas, y el giro de fortunas a\xfan no vistas.","16013":"Algo est\xe1 podrido, todav\xeda. Lo siento en la tierra. Una vez gobern\xe9, am\xe9, perd\xed. Helena me atraves\xf3 como un rel\xe1mpago de verano. \xbfY Leontes? No pudo perdonar el deshielo. \xabLa dama protesta demasiado\xbb, dijeron; que lo digan. Si ves a Helena, dile que las rosas conocen su nombre. Si ves a Leontes, dile que no he olvidado el invierno.","16014":"Mi pena es una estatua; silenciosa, pero nunca quieta. Enterr\xe9 mi corona en la nieve el d\xeda que Gertrudis eligi\xf3 su jard\xedn sobre m\xed. \xab\xbfSalida, perseguido por un oso\xbb? No, hu\xed de m\xed mismo. Ahora espero, entre piedra y silencio. Tr\xe1eme lo que una vez fue m\xedo, la Corona del Rey, y te pagar\xe9 en Oro, m\xe1s que el peso de la memoria. Pero ten cuidado: algunos tronos llevan maldiciones.","16015":"Este puente es m\xedo, por Sycorax mi madre. Pr\xf3spero intent\xf3 robarlo con hechizos y sonrisas. Me llamaron bestia, pero soy de tierra y tormenta, nacido para la verdad salvaje. Intercambio huesos por Plata, reliquias de los muertos por monedas de los vivos. No toques nada a la ligera en estos bosques. Tr\xe1eme lo que otros temen, y te har\xe9 rico... o embrujado.","16016":"Mi generosidad es tan ilimitada como el mar, mi amor tan profundo... pero \xe9l se fue, y todo lo que queda es un retrato y dolor. Angelo se llev\xf3 ambos. Tr\xe1eme el retrato de Romeo, arrancado de mi c\xe1mara, y te dar\xe9 Tulipanes rojos como la sangre derramada sobre las piedras de Verona. Que este sea nuestro nuevo balc\xf3n: t\xfa abajo, portando justicia.","16017":"Hola, amigo. \xbfBuscas el Tridente de los dioses antiguos? Es uno de los siete artefactos necesarios para satisfacer al Or\xe1culo. Necesito mucho oro para separarme de \xe9l.","16018":"Bienvenido {username}. Felicitaciones, pues has recorrido una gran distancia. Siento el hero\xedsmo en ti. Tr\xe1eme los siete artefactos que unen a estos pueblos, \xa1y te dar\xe9 la Esperanza para restaurar la Edad Dorada!","16019":"\xa1Saludos {username}! Durante siglos, la gentil gente de Elsinore vivi\xf3 en armon\xeda, gobernada por el benevolente Rey Leontes. Pero \xfaltimamente un flagelo maligno crece en el Valle y amenaza nuestros caminos pac\xedficos. Se dice que una sola Misi\xf3n puede restaurar la Esperanza en estas tierras y hacer retroceder la oscuridad. \xa1Busca al Or\xe1culo en el Valle, aventurero, y tr\xe1enos Esperanza!","16020":"\xa1Bien hallado, cazador! \xbfTienes pieles para comerciar? Te pagar\xe9 monedas justas por cualquier piel que las tierras salvajes del valle hayan cedido a tu habilidad. Los meses fr\xedos se acercan, y la gente busca calor. Tu caza llena mis arcas; mis monedas llenan tu bolsa. \xa1Es un trato tan acogedor como el nombre que llevo!","16101":"","16102":"","16103":"","16104":"","16105":"","16106":"","16107":"","16108":"","16109":"","16110":"","16111":"","16112":"","16113":"","16114":"","16115":"","16116":"","16117":"","16118":"","16119":"","16120":"","21000":"Gato","21001":"Caniche","21002":"Mono","21003":"Pato","21004":"Burro","21005":"B\xfaho","21006":"Loro","21007":"\xc1guila","21008":"Cebra","21009":"Jirafa","21010":"Orangut\xe1n","21011":"Dodo","30000":"TROFEOS:","30001":"Primer Trabajador Agr\xedcola","30002":"Constructor de Habilidades","30003":"Trenes Completados","30004":"Ganador de Temporada","30005":"Campe\xf3n de Temporada","30006":"Conoce al Elenco","30007":"Explora el Valle","30008":"Luchador","30009":"Revelador de Pergaminos","30010":"Aventurero","30011":"Marinero","30012":"Mata al Duque","30013":"El Orbe de Pr\xf3spero","30014":"Carnavales Completados","200000":"RECURSOS","200009":"Cuenta de Oro","200010":"Dinero","200011":"Toc\xf3n","200012":"Se\xf1al N","200013":"Se\xf1al E","200014":"Se\xf1al S","200015":"Se\xf1al O","200016":"Se\xf1al NO","200017":"Se\xf1al NE","200018":"Se\xf1al SE","200019":"Se\xf1al SO","200020":"Se\xf1al Pueblo","200021":"Se\xf1al Casa","200022":"Puesto de Comercio","200023":"Puesto Comercial","200024":"Almac\xe9n","200025":"Casa Abandonada","200026":"Casa de Granja","200027":"Reparar","200028":"Monta\xf1a","200029":"Monta\xf1a Grande","200030":"Banco","200031":"Juzgado","200032":"Tren","200033":"Buz\xf3n","200034":"Roble","200035":"Pino","200036":"Palmera","200037":"\xc1rbol Navide\xf1o","200038":"Mu\xf1eco de Nieve","200039":"Rocas","200040":"Cantera de Arcilla","200041":"Madera","200042":"Piedra","200043":"Arcilla","200044":"Parcela de Trigo","200045":"Parcela de Zanahoria","200046":"Parcela de Ma\xedz","200047":"Parcela de Ca\xf1a de Az\xfacar","200048":"Parcela de Fresa","200049":"Manzano","200050":"Limonero","200051":"Vid","200052":"Parcela de Ajo","200053":"Olivo","200054":"Tomatera","200055":"Parcela de Roble","200056":"Trigo","200057":"Zanahoria","200058":"Ma\xedz","200059":"Ca\xf1a de Az\xfacar","200060":"Fresa","200061":"Manzana","200062":"Lim\xf3n","200063":"Uvas","200064":"Ajo","200065":"Aceituna","200066":"Tomate","200067":"Ar\xe1ndano","200068":"Leche","200069":"Lana","200070":"Huevo","200071":"Harina","200072":"Pienso para Pollos","200073":"Az\xfacar","200074":"Harina de Ma\xedz","200075":"Madera Aserrada","200076":"Mantequilla","200077":"Crema","200078":"Queso","200079":"Hilo","200080":"Tela","200081":"Su\xe9ter","200082":"Chaqueta","200083":"Chaqueta Pesada","200084":"T\xfanica R\xfanica","200085":"Pan","200086":"Pan de Ma\xedz","200087":"Tarta de Manzana","200088":"Tarta de Fresa","200089":"Galleta de Lim\xf3n","200090":"Pan de Aceitunas","200091":"Pan de Ajo","200092":"Pastel de la Reina","200093":"Sopa de Tomate","200094":"Sopa de Zanahoria","200095":"Tortilla","200096":"Pizza","200097":"Miel","200098":"Sidra de Manzana","200099":"Vino","200100":"Oporto","200101":"Aceite de Oliva","200102":"Vino A\xf1ejo","200103":"Cer\xe1mica","200104":"Muebles","200105":"Tinta","200106":"Urnas","200107":"Romero","200108":"Champi\xf1\xf3n","200109":"Champi\xf1\xf3n M\xe1gico","200110":"Margarita","200111":"Tulip\xe1n","200112":"Girasol","200113":"Matricaria","200114":"Poci\xf3n A","200115":"Poci\xf3n B","200116":"Poci\xf3n C","200117":"Gema","200118":"Libro","200119":"Piel","200120":"Piel de Oso","200121":"Huesos","200122":"Plata","200123":"Oro","200124":"Anillo de Diamante","200125":"Corona del Rey","200126":"Retrato","200127":"Tridente","200128":"Llave Maestra","200129":"Llave Dorada","200130":"Pergamino","200131":"Orbe de Pr\xf3spero","200132":"Tienda de Campa\xf1a","200133":"Barco","200134":"Santuario","200135":"Castillo","200136":"Restaurante","200137":"Ba\xf1o","200138":"Tienda General","200139":"Guarida del Guerrero","200140":"Tienda de Magia","200141":"Templo Antiguo","200142":"Campamento de Aventura","200143":"Laboratorio","200144":"Escuela","200145":"Establo","200146":"Molino","200147":"Lecher\xeda","200148":"Gallinero","200149":"Aserradero","200150":"Telar","200151":"Horno","200152":"Cocina","200153":"Colmena","200154":"Estudio","200155":"Bodega","200156":"Biblioteca","200157":"Corral","200158":"Hospital","200159":"Vaca","200160":"Oveja","200161":"Vaca Marr\xf3n","200162":"Doctor","200163":"Cirujano","200164":"Hada","200165":"Kent","200166":"Portia","200167":"El Pastor","200168":"Hotspur","200169":"Cassio","200170":"Se\xf1ora Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampiro","200175":"Pap\xe1 Noel","200176":"Pr\xf3spero","200177":"Falstaff","200178":"Boticario","200179":"Iago","200180":"Gertrudis","200181":"Leontes","200182":"Calib\xe1n","200183":"Julieta","200184":"Sirena","200185":"Granjero","200186":"Pe\xf3n de Granja","200187":"Ranchero","200188":"Le\xf1ador","200189":"Coyote","200190":"Oso","200191":"Ara\xf1a","200192":"Zombi","200193":"Duque Angelo","200194":"Fantasma","200195":"Ogro","200196":"Demonio","200197":"Drag\xf3n","200198":"Generador de Coyotes","200199":"Generador de Osos","200200":"Generador de Ara\xf1as","200201":"Generador de Zombis","200202":"Generador de Fantasmas","200203":"Generador de Demonios","200204":"Generador de Dragones","200205":"Cultivador","200206":"Mano Verde","200207":"Ganader\xeda","200208":"Recolecci\xf3n Animal en Masa","200209":"Hacha","200210":"Pico","200211":"Constructor","200212":"Cosecha en Masa","200213":"Replantaci\xf3n en Masa","200214":"Tala","200215":"Mejor Tala","200216":"Artesan\xeda en Masa","200217":"Reinicio de Artesan\xeda en Masa","200218":"Mejor Hacha","200219":"Mejor Pico","200220":"Almac\xe9n","200221":"Dep\xf3sito","200222":"Almacenamiento 3 Por Determinar","200223":"Almacenamiento 4 Por Determinar","200224":"Alba\xf1iler\xeda","200225":"Mec\xe1nica","200226":"Textiles","200227":"Artesan\xeda Art\xedstica","200228":"Apicultor","200229":"Sastre","200230":"Pol\xedtica","200231":"Educaci\xf3n","200232":"Qu\xedmica","200233":"Cocina","200234":"Queser\xeda","200235":"Panadero","200236":"Vinicultor","200237":"Molinero","200238":"Artesano","200239":"Cocinero","200240":"Tejedor","200241":"Cazador de Aves","200242":"Quesero","200243":"Virtuoso Culinario","200244":"Maestro Apicultor","200245":"Vinicultor Experto","200246":"Ley","200247":"Medicina","200248":"Cirug\xeda","200249":"Mochila","200250":"Mochila Grande","200251":"Mochila Encantada","200252":"Caballo","200253":"Rastreo","200254":"Explorador","200255":"Acolchado","200256":"Armadura Ligera","200257":"Cota de Malla","200258":"Armadura de Placas","200259":"Armadura Pesada","200260":"Armadura M\xedstica","200261":"Peto de Calib\xe1n","200262":"Velo Bendito","200263":"Yelmo M\xe1gico","200264":"Guantes M\xe1gicos","200265":"Botas de Protecci\xf3n","200266":"Cuchillo","200267":"Espada Corta","200268":"Espada Larga","200269":"Gran Espada","200270":"Alabarda","200271":"Espada de Canto","200272":"Alabarda M\xe1gica","200273":"Espada Resplandeciente","200274":"Hacha Gigante","200275":"Espada Legendaria","200276":"Matadragones","200277":"Dardos","200278":"Arco Corto","200279":"Arco Largo","200280":"Lanza","200281":"Ballesta","200282":"Lanza M\xe1gica","200283":"Ballesta M\xe1gica","200284":"Arco de Titania","200285":"Ballesta Legendaria","200286":"Tempestad","200287":"Maelstr\xf6m","200288":"Olvido","200289":"Tit\xe1n","200290":"Golpe","200291":"R\xe1faga","200292":"Andanada","200293":"Mano Firme","200294":"Precisi\xf3n Puntual","200295":"Infalible","200296":"Enfoque","200297":"Precisi\xf3n","200298":"Ojo del Horizonte","200299":"Fortaleza","200300":"Coraz\xf3n de Piedra","200301":"Inquebrantable","200500":"Caja","200501":"Muro de Piedra","200502":"Muro de Piedra Grande","200503":"Muro Verde","200504":"Muro Negro","200505":"Muro de Arena","200506":"Muro Azul","200507":"Muro Naranja","200508":"Planta","200509":"Cactus","200510":"Arpa","200511":"Bandera","200512":"Pila de Libros","200513":"Silla","200514":"Inodoro","200515":"Cama","200516":"Oso de Peluche","200517":"Hoyo Grande","200518":"Tobog\xe1n","200519":"Fuente","200520":"Fuente Grande","200521":"Palmera Decorativa Grande","200600":"Patata","200601":"Lechuga","200602":"Pimiento","200603":"Naranja","200604":"Ensalada Mixta","200605":"S\xe1ndwich","200606":"Patatas al Horno","200607":"Brandy","200608":"Sierra","200609":"Pala","200610":"Destornillador","200611":"Martillo","200612":"Tornillo","200613":"F\xe9nix","200614":"Pluma de F\xe9nix","200615":"Campana de Lat\xf3n","200616":"Sangre de Vampiro","200617":"Esperanza","200618":"Coraz\xf3n Amarillo","200619":"Coraz\xf3n Verde","200620":"Coraz\xf3n Morado","200621":"Carnaval","200622":"Gremio","200623":"Cerdo","200800":"Solo se encuentra en los pergaminos","200801":"Misi\xf3n de Esperanza","armorclass":"Capacidad de la Mochila","attackbonus":"Da\xf1o","attackrange":"Bono de Ataque","backpackCapacity":"Capacidad del Almac\xe9n","damage":"Velocidad de Ataque","hp":"Puntos de Golpe M\xe1ximos","iscamping":"Clase de Armadura","maxhp":"Alcance","range":"Rango de Ataque","speed":"Est\xe1 de Campamento","warehouseCapacity":"Capacidad del Almac\xe9n"}'),i=JSON.parse('{"0":"Valley View","1":"Server is not running.","3":"\ud83c\udf31 Land successfully tilled.","4":"\u26a0\ufe0f You don\'t have enough resources.","5":"\u2692\ufe0f Construction completed successfully.","6":"\ud83d\udcb0 Items sold.","7":"\ud83c\udfe0 This homsetead is unoccupied.","8":"\ud83d\udeab This area is off limits.","9":"The Valley is full of wonders, and must be explored on foot.","10":"\ud83c\udfe0 [username]\'s homestead.","11":"\ud83c\udfe0 Unknown owner\'s homestead.","12":"Settlement view. Depending on your location, you may need to scroll to see the Town.","13":"Frontier view.","14":"\ud83c\udfdb\ufe0f Welcome to town.","15":"\ud83d\udc34 You need a Horse to travel here. Visit the Adventure Camp in Town.","16":"You\'re in the valley.","17":"You do not own a hometead here.","18":"\ud83d\udeab You can\'t go that way.","19":"\ud83c\udf92 You need a Backpack to collect resources away from your homestead. Buy one at the Adventure Camp.","20":"\ud83d\udeab Not enough room in the Warehouse.","21":"\ud83c\udf92 Not enough room in the Backpack. Open Inventory to manage Backpack contents.","22":"Items purchased.","23":"\u26a0\ufe0f You can\'t build that here.","24":"\ud83c\udfaf Out of range","25":"\ud83c\udf92 Nothing in the Backpack.","26":"\ud83c\udf92 You must be at your homestead to empty your Backpack.","27":"\u26fa\ufe0f You don\'t have a tent.","28":"\u26fa\ufe0f You are now camping.","29":"\u26a0\ufe0f \u26fa\ufe0f Failed to camp / decamp.","30":"\u26fa\ufe0f No longer camping.","31":"\u26fa\ufe0f Cannot attack while camping.","32":"\u26fa\ufe0f You need to decamp first.","33":"\ud83d\udce6 Moved items to the Warehouse.","34":"\ud83c\udf92 Emptied backpack.","35":"You need a ","36":"You used a ","50":"\ud83d\udeab That username is already taken.","70":"Session Expired","71":"You\'ve been away for a while. Refreshing ensures your session works properly.","72":"This page will auto-refresh in 30 seconds unless you do it now.","73":"\ud83d\udd04 Refresh Now","74":"\ud83c\udf92 A Backpack is required to own a Tent.","75":"You do not own a Backpack. You can purchase one at the Adventure Camp in Town.","76":"Your Warehouse is empty.","77":"Your Backpack is empty.","78":"Manage Contents","80":"Acquired ","90":"\ud83d\udeab This is not your homestead.","91":"\ud83d\udc34 Horse required.","94":"\ud83d\udce2 Share Valley View!","95":"Invite others to help out and join the adventure!","96":"Have Feedback?","97":"@ Email Us","98":"\u23f3 Loading ...","99":"\u26a0\ufe0f Something went wrong.","100":"TRAVELING STRINGS:","101":"\ud83d\udc34 Traveling home ... please wait.","102":"\ud83d\udc34 Traveling to town ... please wait.","103":"\ud83d\udc34 Traveling to the next location ... please wait.","104":"\ud83d\udeab No town in this settlement yet.","105":"\u26a0\ufe0f There was a problem trying to travel.","106":"\ud83d\udeab You cannot travel beyond the frontier.","110":"\u27a1\ufe0f Walk onto Signposts to use them","111":"Welcome to town.","112":"Welcome home.","120":"You don\'t have any homestead moves left.","121":"You have successfully moved your homestead.","122":"You cannot move to the valley!","123":"You cannot move to the town!","124":"That homestead is occupied.","125":"Where are you moving to?","130":"Select your language:","131":"Confirm","140":"TRADE STALL STRINGS:","141":"Sold","151":"You cannot fill another player\'s trade stall.","152":"You do not have enough money to buy this item.","153":"is selling:","154":"are selling","155":"Transaction failed. This item has already been sold.","156":"Click to sell","157":"Bought by","158":" limit per order.","159":"Ready to sell","160":"Items to Sell","161":"Item","162":"Available","163":"Price","164":"Amount","165":"All","166":"Add","167":"Sell","168":"Yes, Sell All","169":"Buy","170":"Unlocked trading slot","171":"Gold Pass Required","172":"Locked","173":"Limit of","174":"to Sell","175":"Unlock for","176":"Wood","177":"Need","178":"to unlock this slot","179":"This Outpost only accepts items from your backpack. Any player can collect money from an Outpost.","180":"INVENTORY STRINGS:","181":"\ud83d\udce6 Warehouse","182":"\ud83c\udf92 Backpack","183":"Capacity: ","184":"Manage Contents","185":"Quantity","186":"Amount","187":"Add to Warehouse","188":"Discard","189":"Add All to Warehouse","190":"Discard All","191":"Item","192":"Action","193":"Discard Items","194":"Expand Warehouse","195":"Expand Backpack at the Adventure Camp in Town.","199":"Near unlimited capacity with Gold Pass (among other benefits).","200":"QUESTS","201":"\u2705 Action item completed. You have your reward.","202":"\u2705 Action item accepted.","203":"No action items at the moment.","204":"To Do List:","205":"Nothing new at this time. Check your \u2705 To Do list!","206":"Return to the NPC who gave you this quest to collect your reward.","207":"In Progress","208":"Get Reward","209":"Accept","299":"FARMING STRINGS:","300":"Added","301":"\ud83c\udf31 Tilled","302":"\ud83c\udf31 Planted","303":"\ud83c\udf31 Must plant on dirt","304":"\ud83c\udf31 Can\'t plant here","305":"\u26a0\ufe0f Not enough resources","306":"\u26a0\ufe0f Can\'t build here","310":"You need to till the land for planting.","311":"Your farm animals will need plenty of grass to graze on.","312":"Pavement can be useful to control wandering animals.","313":"","315":"Select Crops to Harvest:","316":"Select All","317":"Deselect All","318":"Collect","319":"Select Animals to Collect:","320":"Cannot terraform here.","340":"Not avilable unless you\'re on foot.","341":"Select Crafting Stations to Collect:","342":"Harvest?","343":"Replant?","344":"No crops ready to harvest.","345":"Ready to Collect:","346":"Collect?","347":"Buy 1 for: ","350":"The Farm Hand will help you automate harvesting and planting of crops.","351":"The Rancher will help you automate collecting from animals.","352":"The Lumberjack will help you automate chopping trees for wood.","353":"The Crafter will help you automate collecting from crafting stations.","354":"Kent is your Farm Manager. He can help you run your homestead.","355":"The Shepherd will guide you in the management of your farm animals.","400":"BUYING, CRAFTING, SKILLS, HEALING, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Already at maximum hit points.","402":"\u26a0\ufe0f  resources.","403":"\u26a0\ufe0f Youre inventory is full.","404":"Working...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Hit Points healed by +","410":"\ud83c\udfd5\ufe0f To use a purchased tent, click on your own player icon.","420":"will trade you:","421":"Used In:","422":"Base Value:","423":"No trades available.","424":"No recipes available.","425":"Sell for refund","426":"Expensive starter crops, but in case you run out:","427":"Purchase the Farm Hand\'s Bulk Harvest skill to harvest all crops at once.","428":"Click to instantly harvest all crops.","429":"You have no crops to harvest.","430":"Purchase these farm skills:","431":"Purchase the Farm Hand\'s Bulk Animal Collect skill to collect from all animals at once.","432":"Purchase the Farm Hand\'s Logging skill to chop multiple trees at once and collect the wood.","433":"Purchase Better Logging to increase the number of trees chopped at once.","434":"Click to instantly collect from all animals.","435":"Click to instantly chop multiple trees and collect wood.","436":"You have no animals to collect from.","437":"You have no trees to chop.","438":"Remove Crop","439":"Crop returned.","440":"Started ","441":"\u231b\ufe0f Ready in ","442":"\ud83c\udfe0 House repairs complete!","450":"\u274c Cannot afford crafting costs","451":"\u26a0\ufe0f Crafting already in progress","452":"\u274c Failed to start crafting.","453":"\u274c Failed to repair house.","454":"\u274c Failed to hire worker.","455":" has arrived!","456":"No more workers available.","457":"Ready!","458":"Time: ","459":"Instant","460":"Requires: ","461":"Costs: ","462":"Gives: ","463":"Heals: ","464":"Purchase Bulk Crafting to collect from ready crafting stations all at once.","465":"Click to instantly collect from all ready crafting stations.","466":"You have no crafting stations ready to collect from.","467":"Bulk Crafting","468":"Restarted: ","469":"Collected","470":"Cannot travel right now, farming actions in progress.","471":"\u26a0\ufe0f Already in progress.","472":"Harvested","475":"Restart?","476":"Station","477":"Your farm workers are busy...","478":"\ud83c\udf31 Working","479":"Logging complete","480":"Crafted","481":"with","482":"applied","483":"replanted","490":"Sell for refund (Dev only)","500":"COMBAT STRINGS","501":"\ud83c\udfaf Out of range.","502":"\ud83c\udfaf Hit!","503":"\u274c Miss","504":"\ud83d\udc80 Killed","505":"\u26a0\ufe0f Error","510":"\u2764\ufe0f\u200d\ud83e\ude79 You\'re taking damage ...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Your Health: ","512":"Your Health Unavailable","600":"RELATIONSHIP STRINGS:","601":"Relationship:","602":"You\'ve met","603":"You\'re now friends with","604":"You have a crush on","605":"You\'re in love with","606":"You and","607":"are now married.","608":"are now rivals.","609":"is now your rival because of this.","610":"isn\'t going to be very happy about this...","611":"aren\'t going to be very happy about this...","612":"will be very happy about this.","613":"approve of this.","614":"and","615":"Your relationship with","616":"has changed.","620":"You need to move closer to interact with this character.","621":"for being married.","622":"for being friends.","623":"for being in love.","630":"Greet","631":"Talk","632":"Trade","633":"Quest","634":"Met","635":"Friend","636":"Married","637":"Rival","638":"Love","639":"Crush","640":"Joke","641":"Make Friends","642":"Insult","643":"Hug","644":"Kiss","645":"Apologize","646":"Give Gift","647":"Compliment","648":"Flatter","649":"Profess Love","650":"Propose","651":"Taunt","652":"Tease","653":"End Marriage","700":"FTUE STRINGS:","701":"\ud83d\udc78 Welcome to Valley View","702":"Welcome, traveler! You\'ve arrived in Valley View, a frontier land of opportunity, mystery and adventure.","705":"Aspiration","706":"Valley View is a big world. It\'s up to you how you want to spend your time. Which of these aspirations best suits your style of play? (This choice will not limit your options in any way.)","721":"\ud83e\udd20 Meet Kent the Farm Manager","722":"First things first! Harvest some \ud83c\udf3e Wheat and sell it at the \ud83d\udce5 Trading Post for \ud83d\udcb0 Money.","723":"\ud83c\udf31 Get Farming","724":"Well done, you\'re making money now, so start Farming! Plant crops using the \ud83c\udf31 Farming panel, harvest them, and sell.","727":"\ud83d\udc75\ud83c\udffb Hire the Shepherd","728":"Nice work! Now hire the \ud83d\udc75\ud83c\udffb Shepherd from the \ud83c\udfe0 Farm House, and she\'ll help bring some \ud83d\udc2e animal life to the farm, so you can continue to expand your business.","729":"\ud83d\udc2e Animal Husbandry","730":"Welcome \ud83d\udc75\ud83c\udffb Shepherd! Now visit the \ud83d\udc2e Animal Panel to acquire a cow. Cows need \ud83d\udfe9 grass to graze, so place them carefully. And you already have your first \ud83d\udfeb Animal Stall; this is where you can produce milk once the cow is full.","731":"\u26cf\ufe0f Shape the Land","732":"Crops need dirt. Cows and sheep need \ud83d\udfe9 grass. Pavement can help contain the movements of people and animals. Use the \u26cf\ufe0f Tools to pave the land to your liking, and learn the  \ud83e\ude93 axe skill to chop trees for wood.","733":"\u2692\ufe0f Builder","734":"You\'ve mastered the \ud83e\ude93 axe -- excellent! Wood is useful for a number of things, including building crafting stations. You can also chop your way to the \ud83d\ude82 Train Station at the edge of your Homestead, where you can eventually travel into Town.","737":"Time to Explore","738":"Your Homestead is part of a larger Settlement of other players sharing a large Frontier. Zoom out (+ and -) to see the whole Settlement and Frontier. Use \u27a1\ufe0f Signposts to travel, or walk to the edge of any map. ENJOY PLAYING VALLEY VIEW!","750":"\ud83c\udf31 Farmer","751":"Cultivate your homestead, grow crops, tend animals, and craft goods to sell and trade with other players. Invest in farming and crafting skills to grow your profits.","752":"\u2694\ufe0f Adventurer","753":"Venture into the Valley for resources and rare items. Fight animals and creatures, uncover hidden locations, and meet magical characters. Invest in combat skills to become a formidable fighter.","754":"\ud83c\udfdb\ufe0f Politician","755":"Run for Mayor, set the tax rate, and earn tax revenue for your self. Invest in community buildings for the whole Town, like Hospitals, Schools, and Libraries, and help your settlement thrive.","795":"Skip Tutorial","796":"OK","797":"Back","798":"Play","800":"MORE CRAFTING STATION STRINGS:","801":"Acquire the ","802":" Skill at the ","803":" to increase the output of this station by ","805":"Your ","806":" Skill increases the base output of this station by ","810":"You can also purchase this skill directly: ","820":"Makes: ","821":"Base Amount: ","825":"You have ","826":"Scrolls.","827":"Scroll","899":"DEBUG STRINGS:","900":"Debug: Inventory cleared.","901":"Debug: Quest history cleared.","902":"Debug: Resources added.","903":"Debug: Grid successfully reset.","904":"Debug: Skills added.","905":"Debug: Skills & Powers cleared.","906":"Debug: Combat Stats reset.","999":"PANEL UI STRINGS:","1000":"[Description needed]","1001":"Resources collected at the homestead go into the warehouse. Resources collected in town or in the valley will go into the backpack. To buy a backpack, visit the Store in town. To empty the backpack or warehouse, use the Manage buttons.","1002":"Build crafting stations on your Homestead using resources from your warehouse.","1003":"Purchased animals will appear at your player icon, and immediately begin life on the homestead.","1004":"Till land to dirt in order to plant crops. Plant grass to give farm animals something to graze on.","1005":"Acquire Skills and Upgrades to improve various attributes. Make sure to explore the Town to find additional places and ways to gain Skills and Upgrades.","1006":"Manage your ongoing To Do list here. Look for quest-giving characters on your homestead as well as Town, or even the Valley.","1007":"Governments in Valley View are formed at the settlement level. The elected mayor implements policies and builds buildings to help the community thrive.","1008":"Buy and sell with other players. If no players buy your items before the timer expires, sell them to the game for a fraction of their base value.","1009":"[Crafting description]","1010":"[Mailbox description]","1011":"This Animal Stall is empty. Make sure animals have grass to eat, and they will eventually come to the stall for harvesting.","1012":"Elections take place in the Courthouse. Here, Mayors have the power to set the tax rate and rename the Settlement.","1013":" ","1014":" ","1015":"The game takes place over the course of continually changing seasons.","1016":" ","1017":"Visit the Bank to exchange items for Money, including rare items like Gold and Silver. Return to the bank regulalry for different offers.","1018":"","1019":"[Profile description]","1021":"\xa9 Valley View Studios, 2025, All Rights Reserved.","1022":"[Train description]","1023":"Workers help you run your homestead. Hire them at the Farm House.","1024":"[Combat description]","1025":"[Shop description]","1026":"Earning and spending Money.","1027":"These are the benefits of a Gold Pass.","1028":"[Decorations panel description]","1029":"[Animal panel]","1030":"[Crop panel]","1031":"Buy decorations for your homesetead. You will be able to sell these for a full refund.","1032":"The Farm House is where you can hire people to help you run your homestead.","1033":"Terraform the land with these tools. Animals need grass for grazing, crops need dirt to grow on. Pavement can be useful for controlling movements of animals and characters.","1034":"Earning and spending Gems.","1035":"This is your collection of lifetime Trophies.","1036":"Reveal mysterious scrolls at this Ancient Temple.","1101":"Inventory","1102":"\u2692\ufe0f Build","1103":"\ud83d\uded2 Buy","1104":"\ud83c\udf31 Farming","1105":"\ud83d\udcaa Skills","1106":"\u2705 To Do List","1107":"\ud83c\udfdb\ufe0f Government","1108":"\ud83d\udce5 Trade","1109":"Crafting","1110":"\ud83d\udcea Mailbox","1111":"\ud83d\udc3e Animals","1112":"\ud83c\udfdb\ufe0f Courthouse","1113":"Helper Character","1114":"\ud83d\ude00 Player Character","1115":"\ud83d\uddd3\ufe0f Season","1116":"\ud83d\udd01 Trader","1117":"\ud83c\udfe6 Bank","1118":"\ud83d\udd79\ufe0f How to Play","1119":"\ud83d\ude00 Profile","1120":"\ud83d\udc1e Debug","1121":"\ud83d\ude00 Welcome","1122":"\ud83d\ude82 Train","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Farm Hand","1124":"\u2694\ufe0f Combat","1125":"\ud83d\uded2 Shop","1126":"\ud83d\udcb0 About Money","1127":"\u2b50\ufe0f Gold Pass","1128":"\ud83e\udeb4 Decorations","1129":"\ud83d\udc3e Animals","1130":"\ud83c\udf31 Crops & Trees","1131":"\ud83e\udeb4 Decorations","1132":"\ud83c\udfe0 Farm House","1133":"\u26cf\ufe0f Tools","1134":"\ud83d\udc8e Gems","1135":"\ud83c\udfc6 Trophies","1136":"\ud83d\uded5 Ancient Temple","1200":"TRADER STORY STRINGS","1201":"Ah, the forest hides many secrets\u2026 and I? I\u2019ve stolen a few. These Gems, they\u2019re not mine, but Titania has more than she needs. You\u2019ve something I crave: Olive Bread, warm and rich. Trade with me, and I might whisper tales of glowing eyes in the dark, wings that shimmer at moonrise, and dragons that speak in riddles. Keep an ear open, and a dagger close.","1202":"My bounty is as boundless as the sea, my love as deep... but he is gone, and all that remains is a portrait and pain. Angelo took both. Bring me Romeo\u2019s likeness, torn from my chamber, and I\u2019ll give you Tulips red as the blood spilt on Verona\u2019s stones. Let this be our new balcony: you below, bearing justice.","1203":"Give me life, give me love, but most of all... give me Port! In exchange, a sprig of Feverfew, dearer than gold to some, especially that wide-eyed Helena. Says she\u2019s after crowns and legends, poor girl. Me? I\u2019m after a full belly and a gentle nap. \u2018Thou art so fat-witted with drinking of old sack,\u2019 they once told me. Ha! They were not wrong.","1204":"Here\u2019s rosemary, for remembrance\u2014and nightshade, for regrets. My potions are not for the faint of will. With the right leaf, I can mend your limbs or muddle your tongue. \u2018I do remember an apothecary,\u2019 said a boy once, and he paid the price. But you? You look wiser. Bring me rare roots and bitter seeds, and I\u2019ll mix you something worth the danger.","1205":"Something is rotten, still. I feel it in the soil. I once ruled, loved, lost. Helena burned through me like summer lightning. And Leontes? He could not forgive the thaw. \u2018The lady doth protest too much,\u2019 they said; let them. If you see Helena, tell her the roses know her name. If you see Leontes, tell him I have not forgotten the winter.","1206":"My grief is a statue; silent, but never still. I buried my crown in snow the day Gertrude chose her garden over me. \u2018Exit, pursued by a bear\u2019? No, I fled myself. Now I wait, among stone and silence. Bring me what was once mine, the King\u2019s Crown, and I\u2019ll pay in Gold, more than the weight of memory. But beware: some thrones carry curses.","1207":"This bridge is mine, by Sycorax my mother.\u2019 Prospero tried to steal it with spells and smiles. They called me beast, but I am of earth and storm, born to wild truth. I trade bones for Silver, tokens of the dead for coin of the living. Touch nothing lightly in these woods. Bring me what others fear, and I shall make you rich... or haunted.","1208":"","1301":"Skills to purchase:","1302":"Upgrades to purchase:","1303":"Skills you have:","1304":"Upgrades you have:","1305":"You have no skills yet.","1306":"You have no upgrades yet.","1400":"MODAL STRINGS","1401":"BANK MODAL","1402":"These offers good for","1403":"Will buy","1404":"for","1405":"No offers available.","1406":"New offers in","1407":"Generating new orders. Thank you for your patience.","1408":"\u26a0\ufe0f You don\'t have enough items.","1409":"\u26a0\ufe0f You don\'t have enough skills.","1410":"\u26a0\ufe0f You don\'t have enough upgrades.","1500":"TOWN NEWS STRINGS:","1501":"News for ","1502":"The current Mayor is","1503":", and the tax rate is","1504":"Here\'s what\'s happening in Town right now:","1505":"It\'s election season, and campaigning is in full swing. Stop by the Courthouse in Town to run for Mayor.","1506":"Voting for the next Mayor has begun. Cast your vote at the Courthouse in Town.","1507":"The Train is arriving, offering to buy:","1508":"The Train is departing. When it returns, it will be buying:","1509":"The Train is here, offering to buy:","1510":" ","1511":"Visit the Bank to sell gold, silver, and diamonds. The Bank is currently updating its offers.","1512":"There is currently no mayor. ","1513":"The Train is departing in","1514":"When it returns, it will be buying:","1515":"The tax rate is","1516":"The Bank is currently buying:","1517":"The Train will be departing in","1518":"The votes in the latest election for Mayor are being counted. Results expected in ","1600":"MAILBOX STRINGS:","1601":"Loading messages...","1602":"You have no messages.","1603":"Received","1604":"Collect","1605":"Most messages will be deleted afer 14 days. Store purchases will not be deleted.","1606":"\ud83d\udcea Mailbox","1607":"\ud83d\uddd1\ufe0f Message deleted.","1700":"STORE STRINGS:","1701":"\ud83d\uded2 Store","1702":"Purchases will be delivered to the Inbox.","1703":"\ud83d\ude4f Thank you for your support! We are a tiny developer with few resources, but passionate about creating a fun space for a positive community.","1704":"Please consider making purchases so we can continue to improve the game.","2000":"TRAIN, BANK, COURTHOUSE, etc. STRINGS:","2002":"Completed","2003":"\ud83d\ude82 Next Shipment Preview:","2004":"\ud83c\udf81 Rewards for filling all orders (sent to all who complete at least one order):","2005":"Click to fulfill","2006":"Your Order","2007":"Claimed","2008":"Claim Order","2009":"Claimed by you:","2010":"Available to claim:","2011":"Claimed by others:","2012":"Completed:","2013":"Claimed by you:","2014":"You can only claim one train offer at a time.","2015":"Show Train Log","2016":"\ud83c\udf89 All orders were completed! Rewards have been mailed out.","2017":"This order has already been claimed.","2020":"Train is","2030":"Offers Update in","2040":"Welcome, Mayor.","2041":"\ud83d\udcb0 Tax Rate: ","2042":"Proposed: ","2043":"Update","2044":"\u26a0\ufe0f Only the Mayor can set the tax rate.","2045":"\ud83d\uddf3\ufe0f Elections","2046":"Current Phase:","2047":"Phase Timer:","2048":"\ud83d\udce2 Campaign Promises","2060":"Voting begins in:","2061":"Voting ends in:","2062":"Voting has ended. Results announced in:","2063":"Next campaign begins in:","2070":"\ud83d\udce2 Campaign Promises","2071":"No one has made a campaign promise yet.","2072":"Enter your campaign promise (max 200 characters)...","2073":"Submit Campaign Promise","2074":"Cast Your Vote","2075":"No candidates available for voting.","2076":"Campaign promise:","2077":"You have already voted in this election.","2078":"There were no candidates.","2079":"How\'s your Mayor doing?","2080":"Welcome, Mayor.","2081":"Enter settlement name...","2082":"Your Settlement:","2083":"Update Name","2084":"Visit the \ud83c\udfdb\ufe0f Government Panel to view stats on how the settlement is doing, to help guide your election decision.","2085":"Current Mayor:","2090":"\ud83c\udfe4 Community Buildings","2092":"\ud83c\udfeb Schools: ","2093":"\ud83c\udfeb No Schools built yet.","2094":"\ud83c\udfe5 Hospitals: ","2095":"\ud83c\udfe5 No Hospitals built yet.","2096":"\ud83d\udc3e Animal Yards: ","2097":"\ud83d\udc3e No Animal Yards built yet.","2098":"\ud83c\udfe4 Libraries: ","2099":"\ud83c\udfe4 No Libraries built yet.","3000":"GOV PANEL:","3001":"Your Settlement:","3002":"\ud83d\ude0a Pop.","3003":"\ud83d\udcb0 Tax Rate:","3004":"The tax rate is set by the Mayor, for this Settlement, and a percentage of all taxes collected are added to the Mayor\'s bank account.","3005":"Mayors are elected at the Courthouse in Town.","3006":"\ud83c\udfdb\ufe0f Government Officials","3007":"No government officials elected yet.","3009":"Only the Mayor can build Schools, Hospitals and Libraries in the Town.","3010":"\ud83c\udfeb Schools give citizens access to certain Skills that cannot be gained elsewhere.","3011":"\ud83c\udfe5 Hospitals supply Doctors, who can heal adventurers returning from the Valley.","3012":"\ud83c\udfe4 Libraries are a source of Books, which are vital to Adventurers looking to learn new skills.","3013":"\ud83d\ude82 The Mayor can influence demand for goods at the Train.","3020":"View Tax Log","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"SEASON PANEL STRINGS","3051":"(Net worth is recalculated twice per day.)","3052":"No data available for top citizens.","3053":"It\'s","3054":"Loading...","3055":"Season ends in:","3056":"We are in between seasons.","3057":"At the end of the season, bonus rewards will be sent to the top players in the Frontier, as well as to all players in the top Settlement.","3058":"\ud83c\udfc6 Top Citizens in the Frontier","3059":"\ud83c\udfd9\ufe0f Leading Settlement","3060":"Total Wealth:","3061":"Population:","3062":"Unknown","3063":"No data available","3064":"View Season Log","4000":"LOGIN PANEL:","4001":"Don\'t have a profile? Create a new free profile to start playing:","4002":"New Profile","4003":"Username","4004":"You will not be asked for an email address.","4005":"With your own profile, you\'ll be granted your own homestead to cultivate in a Settlement with other players, in a Frontier full of Settlements. Adventure awaits you in the Valley.","4006":"Password","4007":"Login","4008":"Username","4009":"Login to your profile to continue playing. If you don\'t have an","4010":"Already have a profile?","4050":"PROFILE PANEL:","4051":"Hi, ","4052":"Change Username:","4053":"Change Password:","4054":"Profile Management","4055":"Profile Status:","4056":"Logout","4057":"Delete Your Profile","4058":"Player ID:","4059":"Homestead Relocation","4060":"Relocations Remaining:","4061":"Visit the Store to purchase more Relocations.","4062":"Settings","4063":"Language:","4064":"Range Indicator:","4065":"Change Avatar","4066":"Back to Login","4067":"Select Language","5000":"MORE MODAL STRINGS:","5001":"\ud83d\udc80 You have died.","5002":"You have been returned home. Any backpack \ud83c\udf92 items you had were lost.","5003":"Be more careful next time.","5005":"\ud83d\ude00 Welcome to Valley View\u2122","5006":"Please login, or create a free profile.","5007":"\xa9 Valley View Studios, 2025, All Rights Reserved.","5010":"\ud83d\udce8 Inbox","5011":"You have no messages","5015":"\ud83d\uded2 Store","5016":"Purchases will be delivered to the Inbox. We are unable to offer returns. All purchases are final.","5017":"Be aware that most inventory items are wiped between seasons, so please check the season clock before purchasing, and see the seasons panel for more information.","5020":"\ud83d\udeab You are currently logged out.","5021":"Click the Login or Create Profile button to begin.","5025":"\ud83d\ude4f Thank you for your support!","5026":"Your purchase has been delivered to your Inbox.","5027":"Enjoy Valley View!","5030":"\ud83d\ude00 Welcome to Valley View!","5031":"No player is logged in or the server is offline.","5032":"Please refresh the page, check your internet connetion, or return later.","5035":"We are between seasons!","5036":"Valley View is temporarily unavailable while we reset the season.","5040":"\ud83d\udcf0 Town News","5041":"Here\'s what\'s happening in Town right now:","5045":"Use ","5046":"Do you want to use a","5047":"You have ","5050":"\u26a0\ufe0f Confirm Homestead Move","5051":"Are you sure you want to move your homestead? This cannot be undone.","5052":"Close this dialog to cancel.","5060":"\u2b50\ufe0f Congratulations!","5061":"You now have a Gold Pass. Go to your Profile panel to customize your player icon, and discover other Gold benefits.","5062":"Thank you for your support!","5100":"Recent Tax Collections","5101":"No tax collection history available yet.","5102":"\ud83d\uddd3\ufe0f Date","5103":"\ud83d\udcb0 Total Collected","5104":"Mayor","5105":"\ud83d\udcb0 Mayor Take","5110":"","6000":"TROPHY STRINGS:","6001":"Here are your lifetime Trophies:","6002":"You have no trophies yet. Earn trophies for achievements throughout the game.","6003":"Trophy Earned!","7000":"NOTIFICAITION STRINGS:","7001":"Tip:","7005":"Use A-W-S-D or the Arrow Keys to Move.","7006":"Look for the \ud83d\udcaa icon to open the Skills panel.","7007":"Stand on grass, then find the \ud83d\udc2e Buy panel to purchase a cow. You\'ll first need the Husbandry skill.","7009":"Keep checking your \u2705 To-Do-List, and keep checking with \ud83e\udd20 Kent and \ud83d\udc75\ud83c\udffb the Shepherd.","7015":"Click + and - at the top of the screen to zoom in and out.","8999":"HOW TO PLAY STRINGS:","9000":"Welcome to Valley View!","9001":"What\u2019s it about?","9002":"Valley view is a game that explores how people might self organize and create micro societies in a world of asymmetric resources and interdependence, with both owned and shared spaces.","9003":"While there are no explicit specialization paths, there are three main vectors of play which are interdependent. These are: the FARMER, the ADVENTURER, and the POLITICIAN. You are encouraged to lean upon each other.","9004":"First, the basics:","9005":"Use A-W-S-D keys to MOVE. Click to interact with things that are within your interaction radius.","9006":"Explore \ud83c\udf31 FARMING, \u2692\ufe0f BUILD, and \ud83d\udc2e BUY to improve your Homestead and generate resources.","9007":"Generate \ud83d\udcb0 MONEY at the \ud83d\udce5 TRADING POST. Post resources for sale to other players, or sell them to the game for partial value.","9008":"More:","9009":"As you create wealth, improve yourself with SKILLS and ABILITIES. For example, purchase the \ud83d\udc34 HORSERIDING SKILL to venture into the Valley.","9010":"Zoom out (- and +) to see how big the world is. Your Homestead is one of many in a SETTLEMENT. Each SETTLEMENT has a shared TOWN. Your Settlement is one of many in the FRONTIER.","9011":"When you are ready, explore the VALLEY, which is full of danger and wonders. The secrets of the wizard PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f and the lost king LEONTES \ud83e\udd34, among others, can be found in the Valley.","9012":"Your Goals:","9013":"Feel free to create your own goals. Also, at the end of each \ud83d\uddd3\ufe0f SEASON, which runs three months, both individuals and settlements will be ranked, and top placement generates additional wealth. Your homsestead, all of your skills, and some of your wealth will carry over into the next Season.","9014":"Farm, craft, trade, explore, fight, and enjoy!","9020":"How to Earn Money","9021":"There are a few ways to make \ud83d\udcb0 MONEY.","9022":"As you are getting started, open the \ud83d\udce5 TRADING POST, which you will find in the upper left corner of your Homestead. Here, you can sell goods, including crops and crafts.","9023":"The \ud83d\udce5 TRADING POST will buy goods from you at 25% of their value. To maximize your earnings, you should trade with other players. They will have things you need, and vice versa.","9024":"As you advance, you\'ll be able to travel into TOWN using the \ud83c\udfdb\ufe0f SIGNPOST next to the TRAIN. There, you will find places like the BANK, which will buy specific items from you at a premium.","9025":"Spending Money","9026":"Surprise, most things cost Money. Initially, you will want to spend money on \ud83d\udcaa SKILLS, \ud83d\udc2e FARM ANIMALS, and \u2692\ufe0f CRAFTING STATIONS. Explore the panels at the left side of the screen. These will help you generate more resources, which in turn will help you earn more Money.","9027":"In TOWN you will disocver more Shops and Traders.","9030":"How to Earn Gems","9031":"Gems are a rare resource that can be used to purchase various things to help accelerate your play.","9032":"You can purchase Gems in the Store, or by clicking here:","9033":"On rare occassions, Gems can be found in the Valley, or earned as rewards for crushing it with the Train, or finishing strong at the end of a Season.","9040":"No Brainer:","9041":"100 \ud83d\udc8e Gems for ","9042":"Best Value:","9043":"500 \ud83d\udc8e Gems for ","9044":"Most Popular:","9045":"1000 \ud83d\udc8e Gems for ","9050":"Benefits","9051":"A Gold Pass gives you access to premium features and benefits in Valley View for the duration of a season.","9052":"With a Gold Pass, you can enjoy the following benefits:","9053":"\u2705 Premium avatars: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 Near unlimited Warehouse capacity","9055":"\u2705 Near unlimited Backpack capacity","9056":"\u2705 2 additional Trade Stall slots","9057":"\u2705 Lower Tax rate","9058":"\u2705 Half your MaxHP restored on death","9059":"\u2705 You can run for office","9060":"Thank you for your Gold Pass purchase.","9061":"Purchase a Gold Pass","9999":"ERROR STRINGS:","10000":"\ud83d\udd0c Server is Down","10001":"The server is currently down. We apologize for the inconvencient, please check back soon.","10002":"(This message will disappear when the server is back up.)","10100":"APP.JS STRINGS:","10101":"Welcome to Valley View!","10102":"Please login, or create a free profile.","10103":"\ud83c\udf92 Inventory","10104":"\ud83d\uded2 Store","10105":"\ud83d\udce8, Inbox","10106":"\ud83d\udce2 Share","10107":"\ud83d\udcac Chat","10108":"You Have a Gold Pass","10109":"\u2194\ufe0f Move Keys: ","10110":"\ud83d\udd79\ufe0f How to Play","10111":"You are the Mayor","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Health: ","10113":"\ud83d\uddd3\ufe0f It\'s","10114":"Next Season starts in:","10115":"\ud83d\uddd3\ufe0f Next Season:","10116":"\ud83c\udfdb\ufe0f Happening Now in Town:","10117":"\ud83d\udcb0 Next Tax Collection:","10118":"In: ","10119":"Now collecting taxes...","10120":"\ud83c\udfdb\ufe0f Elections: ","10121":"Ends: ","10122":"\ud83d\ude82 Train: ","10123":"\ud83c\udfe6 Bank: ","10124":"New Offers: ","10125":"Read the News!","10126":"Who\'s here:","10127":"No PCs present in the grid.","10128":"Save Changes","10129":"","10130":"You Have a Gold Pass","10131":"Gold Pass Benefits","10132":"Cancel Relocation","10133":"Relocate Homestead","11000":"ADDED STRINGS:","11001":"Wait for the timer to end, or for another player to buy this item.","12001":"Farming","12002":"Build","12003":"Animals","12004":"To Do List","12005":"Skills","12006":"Combat","12007":"Government","12008":"Seasons","12009":"Home","12010":"Profile","12011":"Decorations","12012":"Tools","12013":"Trophies","15000":"\ud83d\uddd3\ufe0f Season Rules","15001":"Seasons last three months.","15002":"Rewards","15003":"\ud83d\udcb0 Net worth will be calculated based on your money, inventory items, and items on your homestead.","15004":"\ud83c\udfc6 The top 3 players across the frontier will have rewards sent to your mailbox, and also earn a \u201cSeason Winner\u201d trophy.","15005":"\ud83c\udfc6 The top player in the frontier will also earn the \u201cSeason Champion\u201d trophy.","15006":"\ud83c\udf81 All players in the top settlement will receive additional rewards in your mailbox.","15007":"Resetting Players and Locations","15008":"\ud83c\udfe0 You will be relocated back to your homestead if you are away from home when the season ends.","15009":"\ud83c\udfe0 Your homesteads will NOT reset \u2013 all layout, tiles and resources carry over.","15010":"\ud83c\udf92 Your inventory WILL be wiped, with the exception of rare items like Prospero\u2019s Orb, King\u2019s Crown, Golden & Skeleton Keys, Trident).","15011":"\ud83d\udc8e You will keep all Gems.","15012":"\ud83d\udcb0 Money will be nerfed to 10% of the current amount (25% for Gold Pass holders).","15013":"\u2705 All quests will be wiped.","15014":"\ud83d\udcaa Your skills & powers carry over.","15015":"\u2764\ufe0f Your relationships carry over.","15016":"\u2b50\ufe0f Your Gold Pass status will be revoked for the new season.","15017":"\ud83c\udf32 All town and valley grids will be reset with fresh tiles, resources and enemies.","15018":"What Changes?","15019":"\ud83c\udf83 Towns will have tiles and resources according to the new season content.","15020":"\ud83d\ude00 New players joining (and creating new homesteads) will get starter tiles and resources according to the new season content.","15021":"\ud83d\ude82 Train orders are affected by the seasons.","15022":"\ud83c\udfc6 New rewards and trophies can be earned.","30000":"TROPHIES:","30001":"First Farm Worker","30002":"Skill Builder","30003":"Trains Completed","30004":"Season Winner","30005":"Season Champion","200000":"RESOURCES","200009":"Gold Account","200010":"Money","200011":"Stub","200012":"Signpost N","200013":"Signpost E","200014":"Signpost S","200015":"Signpost W","200016":"Signpost NW","200017":"Signpost NE","200018":"Signpost SE","200019":"Signpost SW","200020":"Signpost Town","200021":"Signpost Home","200022":"Trade Stall","200023":"Trading Post","200024":"Warehouse","200025":"Abandoned House","200026":"Farm House","200027":"Repair","200028":"Mountain","200029":"Mountain Large","200030":"Bank","200031":"Courthouse","200032":"Train","200033":"Mailbox","200034":"Oak Tree","200035":"Pine Tree","200036":"Palm Tree","200037":"Holiday Tree","200038":"Snowman","200039":"Rocks","200040":"Clay Pit","200041":"Wood","200042":"Stone","200043":"Clay","200044":"Wheat Plot","200045":"Carrot Plot","200046":"Corn Plot","200047":"Sugarcane Plot","200048":"Strawberry Plot","200049":"Apple Tree","200050":"Lemon Tree","200051":"Grape Vine","200052":"Garlic Plot","200053":"Olive Tree","200054":"Tomato Vine","200055":"Oak Tree Plot","200056":"Wheat","200057":"Carrot","200058":"Corn","200059":"Sugarcane","200060":"Strawberry","200061":"Apple","200062":"Lemon","200063":"Grapes","200064":"Garlic","200065":"Olive","200066":"Tomato","200067":"Blueberry","200068":"Milk","200069":"Wool","200070":"Egg","200071":"Flour","200072":"Chicken Feed","200073":"Sugar","200074":"Cornmeal","200075":"Lumber","200076":"Butter","200077":"Cream","200078":"Cheese","200079":"Thread","200080":"Cloth","200081":"Sweater","200082":"Jacket","200083":"Heavy Jacket","200084":"Runic Tunic","200085":"Bread","200086":"Cornbread","200087":"Apple Pie","200088":"Strawberry Pie","200089":"Lemon Cookie","200090":"Olive Bread","200091":"Garlic Bread","200092":"Queen\'s Cake","200093":"Tomato Soup","200094":"Carrot Soup","200095":"Omelette","200096":"Pizza","200097":"Honey","200098":"Apple Cider","200099":"Wine","200100":"Port","200101":"Olive Oil","200102":"Aged Wine","200103":"Pottery","200104":"Furniture","200105":"Ink","200106":"Urns","200107":"Rosemary","200108":"Mushroom","200109":"Magic Mushroom","200110":"Daisy","200111":"Tulip","200112":"Sunflower","200113":"Feverfew","200114":"Potion A","200115":"Potion B","200116":"Potion C","200117":"Gem","200118":"Book","200119":"Pelt","200120":"Bear Skin","200121":"Bones","200122":"Silver","200123":"Gold","200124":"Diamond Ring","200125":"King\'s Crown","200126":"Portrait","200127":"Trident","200128":"Skeleton Key","200129":"Golden Key","200130":"Scroll","200131":"Prospero\'s Orb","200132":"Tent","200133":"Boat","200134":"Shrine","200135":"Castle","200136":"Restaurant","200137":"Restroom","200138":"General Store","200139":"Warrior\'s Den","200140":"Magic Shop","200141":"Ancient Temple","200142":"Adventure Camp","200143":"Laboratory","200144":"School","200145":"Animal Stall","200146":"Mill","200147":"Dairy","200148":"Chicken Coop","200149":"Lumber Yard","200150":"Loom","200151":"Oven","200152":"Kitchen","200153":"Beehive","200154":"Studio","200155":"Winery","200156":"Library","200157":"Animal Yard","200158":"Hospital","200159":"Cow","200160":"Sheep","200161":"Brown Cow","200162":"Doctor","200163":"Surgeon","200164":"Fairy","200165":"Kent","200166":"Portia","200167":"The Shepherd","200168":"Hotspur","200169":"Cassio","200170":"Mistress Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampire","200175":"Santa Claus","200176":"Prospero","200177":"Falstaff","200178":"Apothecary","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Juliet","200184":"Mermaid","200185":"Farmer","200186":"Farm Hand","200187":"Rancher","200188":"Lumberjack","200189":"Coyote","200190":"Bear","200191":"Spider","200192":"Zombie","200193":"Duke Angelo","200194":"Ghost","200195":"Ogre","200196":"Demon","200197":"Dragon","200198":"Coyote Spawner","200199":"Bear Spawner","200200":"Spider Spawner","200201":"Zombie Spawner","200202":"Ghost Spawner","200203":"Demon Spawner","200204":"Dragon Spawner","200205":"Grower","200206":"Green Thumb","200207":"Husbandry","200208":"Bulk Animal Collect","200209":"Axe","200210":"Pickaxe","200211":"Builder","200212":"Bulk Harvest","200213":"Bulk Replant","200214":"Logging","200215":"Better Logging","200216":"Bulk Crafting","200217":"Bulk Restart Craft","200218":"Better Axe","200219":"Better Pickaxe","200220":"Storehouse","200221":"Depot","200222":"TBD Storage 3","200223":"TBD Storage 4","200224":"Masonry","200225":"Mechanics","200226":"Textiles","200227":"Artistry","200228":"Beekeeper","200229":"Tailor","200230":"Politics","200231":"Education","200232":"Chemistry","200233":"Cooking","200234":"Creamery","200235":"Baker","200236":"Winemaker","200237":"Miller","200238":"Artisan","200239":"Cuisinier","200240":"Weaver","200241":"Fowler","200242":"Fromager","200243":"Virtuose Culinaire","200244":"Apiarch","200245":"Vintner","200246":"Law","200247":"Medicine","200248":"Surgery","200249":"Backpack","200250":"Rucksack","200251":"Enchanted Pack","200252":"Horse","200253":"Tracking","200254":"Scout","200255":"Padding","200256":"Light Armor","200257":"Chainmail","200258":"Plate Armor","200259":"Heavy Armor","200260":"Mystic Armor","200261":"Caliban\'s Breastplate","200262":"Blessed Veil","200263":"Magic Helmet","200264":"Magic Gloves","200265":"Boots of Protection","200266":"Knife","200267":"Short Sword","200268":"Long Sword","200269":"Great Sword","200270":"Halberd","200271":"Sword of Song","200272":"Magic Halberd","200273":"Glowing Sword","200274":"Giant Axe","200275":"Legendary Sword","200276":"Dragonslayer","200277":"Darts","200278":"Short Bow","200279":"Long Bow","200280":"Spear","200281":"Crossbow","200282":"Magic Spear","200283":"Magic Crossbow","200284":"Titania\'s Bow","200285":"Legendary Crossbow","200286":"Tempest","200287":"Maelstrom","200288":"Oblivion","200289":"Titan","200290":"Jab","200291":"Flurry","200292":"Barrage","200293":"Steady Hand","200294":"Pinpoint","200295":"Unerring","200296":"Focus","200297":"Precision","200298":"Horizon Eye","200299":"Fortitude","200300":"Stoneheart","200301":"Unbreakable","200500":"Crate","200501":"Stone Wall","200502":"Stone Wall Large","200503":"Green Wall","200504":"Black Wall","200505":"Sand Wall","200506":"Blue Wall","200507":"Orange Wall","200508":"Plant","200509":"Cactus","200510":"Harp","200511":"Flag","200512":"Stack of Books","200513":"Chair","200514":"Toilet","200515":"Bed","200516":"Teddy Bear","200517":"Big Hole","200518":"Slide","200519":"Fountain","200520":"Fountain Large","200521":"Large Decorative Palm Tree","hp":"Hit Points","maxhp":"Max Hit Points","range":"Range","attackrange":"Attack Range","attackbonus":"Attack Bonus","damage":"Damage","speed":"Attack Speed","iscamping":"Is Camping","armorclass":"Armor Class","backpackCapacity":"Backpack Capacity","warehouseCapacity":"Warehouse Capacity"}'),l=JSON.parse('{"0":"Secrets of Elsinore","1":"Server l\xe4uft nicht.","2":"Grenzkarte","3":"Land erfolgreich gepfl\xfcgt.","4":"\u26a0\ufe0f Du hast nicht gen\xfcgend Ressourcen.","5":"\u2692\ufe0f Bau erfolgreich abgeschlossen.","6":"\ud83d\udcb0 Gegenst\xe4nde verkauft.","7":"\ud83c\udfe0 Dieses Geh\xf6ft ist unbewohnt.","8":"\ud83d\udeab Dieser Bereich ist gesperrt.","9":"Das Tal ist voller Wunder und muss zu Fu\xdf erkundet werden.","10":"\ud83c\udfe0 [username]s Geh\xf6ft.","11":"\ud83c\udfe0 Geh\xf6ft eines unbekannten Besitzers.","12":"Siedlungsansicht. Je nach Standort m\xfcssen Sie m\xf6glicherweise scrollen, um die Stadt zu sehen.","13":"Grenzlandansicht.","14":"\ud83d\udc78 Willkommen in der Stadt.","15":"\ud83d\udc34 Du brauchst ein Pferd, um hierhin zu reisen. Besuche das Abenteuerlager in der Stadt.","16":"Du bist im Tal.","17":"Du besitzt hier kein Geh\xf6ft.","18":"\ud83d\udeab Du kannst nicht dorthin gehen.","19":"\ud83c\udf92 Du ben\xf6tigst einen Rucksack, um Ressourcen au\xdferhalb deines Geh\xf6fts zu sammeln. Kaufe einen im Abenteuerlager.","20":"\ud83d\udeab Nicht genug Platz im Lagerhaus.","21":"\ud83c\udf92 Nicht genug Platz im Rucksack. \xd6ffne das Inventar, um den Rucksackinhalt zu verwalten.","22":"Gegenst\xe4nde gekauft.","23":"\u26a0\ufe0f Du kannst das hier nicht bauen.","24":"\ud83c\udfaf Au\xdfer Reichweite","25":"\ud83c\udf92 Nichts im Rucksack.","26":"\ud83c\udf92 Du musst bei deinem Geh\xf6ft sein, um deinen Rucksack zu leeren.","27":"\u26fa\ufe0f Du hast kein Zelt.","28":"\u26fa\ufe0f Du zeltest jetzt.","29":"\u26a0\ufe0f \u26fa\ufe0f Zelten / Abbauen fehlgeschlagen.","30":"\u26fa\ufe0f Nicht mehr am Zelten.","31":"\u26fa\ufe0f Kann beim Zelten nicht angreifen.","32":"\u26fa\ufe0f Du musst zuerst das Zelt abbauen.","33":"\ud83d\udce6 Gegenst\xe4nde ins Lagerhaus verschoben.","34":"\ud83c\udf92 Rucksack geleert.","35":"Du ben\xf6tigst einen ","36":"Du hast einen verwendet ","37":"\ud83d\udef6 Du hast kein Boot.","38":"Spieler-Info:","40":"Kann nicht durch W\xe4nde angreifen.","41":"Du bist satt","42":"Verdient: ","44":"Kein Rucksack","45":"Kent kauft diese Waren von dir:","46":"Kent kommt in:","47":"Ich kann Waren von dir kaufen.","48":"Brauchst du einen Rat?","49":"Verbleibende Heilungen:","50":"\ud83d\udeab Dieser Benutzername ist bereits vergeben.","51":"Heilungen Gesamt: ","70":"Sitzung abgelaufen","71":"Du warst eine Weile weg. Aktualisieren stellt sicher, dass deine Sitzung ordnungsgem\xe4\xdf funktioniert.","72":"Diese Seite wird in 30 Sekunden automatisch aktualisiert, es sei denn, du tust es jetzt.","73":"\ud83d\udd04 Jetzt aktualisieren","74":"\ud83c\udf92 Ein Rucksack ist erforderlich, um ein Zelt zu besitzen.","75":"Du besitzt keinen Rucksack. Du kannst einen im Abenteuerlager in der Stadt kaufen.","76":"Dein Lagerhaus ist leer.","77":"Dein Rucksack ist leer.","78":"\ud83c\udf7d\ufe0f Essen","80":"Erworben ","81":"Ein Zelt in der Stadt oder im Tal aufzuschlagen verhindert, dass du angegriffen wirst.","82":"Ein Boot erm\xf6glicht es dir, auf dem Wasser zu reisen.","88":"Dein Lagerhaus ist voll ausgelastet.","89":" Kapazit\xe4t mit Gold Pass","90":"\ud83d\udeab Dies ist nicht dein Geh\xf6ft.","91":"\ud83d\udc34 Pferd erforderlich.","94":"\ud83d\udce2 Teile \'Secrets of Elsinore\'!","95":"Lade andere ein zu helfen und am Abenteuer teilzunehmen!","96":"Feedback?","97":"@ Email an uns","98":"\u23f3 L\xe4dt ...","99":"\u26a0\ufe0f Etwas ist schiefgelaufen.","100":"REISE-STRINGS:","101":"\ud83d\udc34 Reise nach Hause ... bitte warten.","102":"\ud83d\udc34 Reise in die Stadt ... bitte warten.","103":"\ud83d\udc34 Reise zum n\xe4chsten Ort ... bitte warten.","104":"\ud83d\udeab Noch keine Stadt in dieser Siedlung.","105":"\u26a0\ufe0f Es gab ein Problem beim Versuch zu reisen.","106":"\ud83d\udeab Du kannst nicht \xfcber die Grenze hinaus reisen.","107":"Dein Geh\xf6ft","108":"Deine Stadt","110":"\u27a1\ufe0f Gehe auf Wegweiser, um sie zu benutzen","111":"\ud83d\udc78 Willkommen in der Stadt.","112":"\ud83c\udfe0 Willkommen zu Hause.","120":"Du hast keine Geh\xf6ft-Umz\xfcge mehr \xfcbrig.","121":"Du hast dein Geh\xf6ft erfolgreich umgezogen.","122":"Du kannst nicht ins Tal umziehen!","123":"Du kannst nicht in die Stadt umziehen!","124":"Dieses Geh\xf6ft ist besetzt.","125":"Wohin ziehst du um?","126":"Dieses Geh\xf6ft ist unbewohnt.","130":"W\xe4hle deine Sprache","131":"Best\xe4tigen","140":"HANDELSSTAND-TEXTE:","141":"Verkauft","151":"Du kannst den Handelsstand eines anderen Spielers nicht bef\xfcllen.","152":"Du hast nicht genug Geld, um diesen Gegenstand zu kaufen.","153":"verkauft:","154":"verkaufen","155":"Transaktion fehlgeschlagen. Dieser Artikel wurde bereits verkauft.","156":"Leer (Gegenst\xe4nde hinzuf\xfcgen)","157":"Gekauft von","158":" LIMIT PRO BESTELLUNG","159":"Bereit zum Verkauf","160":"\ud83d\udce5 Handelsposten: Artikel zum Verkauf hinzuf\xfcgen","161":"Gegenstand","162":"Du Hast","163":"St\xfcckpreis","164":"Hinzuzuf\xfcgende Menge","165":"Alle","166":"Hinzuf\xfcgen","167":"Verkaufen","168":"Ja, Alles Verkaufen","169":"Kaufen","170":"Handelsplatz freigeschaltet","171":"Gold Pass erforderlich","172":"Gesperrt","173":"Limit von","174":"zum Verkaufen","175":"Freischalten f\xfcr","176":"Holz","177":"Ben\xf6tigt","178":"um diesen Platz freizuschalten","179":"Dieser Au\xdfenposten akzeptiert nur Gegenst\xe4nde aus Ihrem Rucksack. Jeder Spieler kann Geld von einem Au\xdfenposten abholen.","180":"Zum Rucksack","181":"\ud83d\udce6 Lagerhaus","182":"\ud83c\udf92 Rucksack","183":"Kapazit\xe4t: ","184":"Verwalten","185":"Menge","186":"Betrag","187":"\ud83c\udf92 Rucksackverwaltung","188":"Verwerfen","189":"Alles zum Lager hinzuf\xfcgen","190":"Alles verwerfen","191":"Gegenstand","192":"Aktion","193":"\ud83d\udce6 Lagerverwaltung","194":"Erweitern","195":"Erweitere den Rucksack im Abenteuerlager in der Stadt.","196":"Hinzuf\xfcgen ","197":"Lagerhaus aufger\xfcstet","198":" zur Lagerhaus-Kapazit\xe4t.","199":"Deutlich mehr Kapazit\xe4t mit Gold Pass (neben anderen Vorteilen).","200":"QUESTS","201":"\u2705 Aufgabe abgeschlossen. Du hast deine Belohnung.","202":"\u2705 Aufgabe angenommen.","203":"Momentan keine Aufgaben.","204":"Aufgabenliste:","205":"Zurzeit nichts Neues. Schau auf deine \u2705 Aufgabenliste!","206":"Kehre zum NPC zur\xfcck, der dir diese Quest gegeben hat, um deine Belohnung zu erhalten.","207":"In Bearbeitung","208":"Belohnung erhalten","209":"Annehmen","299":"LANDWIRTSCHAFTS-STRINGS:","300":"Hinzugef\xfcgt","301":"Gepfl\xfcgt","302":"\ud83c\udf31 Gepflanzt","303":"\ud83c\udf31 Muss auf Erde pflanzen","304":"\ud83c\udf31 Kann hier nicht pflanzen","305":"\u26a0\ufe0f Nicht genug Ressourcen","306":"\u26a0\ufe0f Kann hier nicht bauen","307":"\ud83c\udf31 Muss auf Moos pflanzen","308":"\ud83c\udf31 Muss auf Sand pflanzen","310":"Du musst das Land zum Pflanzen pfl\xfcgen.","311":"Deine Nutztiere brauchen viel Gras zum Grasen.","312":"Pflaster kann n\xfctzlich sein, um wandernde Tiere zu kontrollieren.","313":"Kopfsteinpflasterwege f\xfcgen Ihrem Geh\xf6ft Dekoration hinzu.","315":"Pflanzen zum Ernten ausw\xe4hlen:","316":"Alle ausw\xe4hlen","317":"Alle abw\xe4hlen","318":"Sammeln","319":"Tiere zum Sammeln ausw\xe4hlen:","320":"Kann hier nicht terraformen.","340":"Nicht verf\xfcgbar, es sei denn, du bist zu Fu\xdf.","341":"Handwerksstationen zum Sammeln ausw\xe4hlen:","342":"Ernten?","343":"Neu pflanzen?","344":"Keine Feldfr\xfcchte bereit zur Ernte.","345":"Bereit zum Sammeln:","346":"Sammeln?","347":"Kaufe 1 f\xfcr: ","350":"Der Farmhelfer hilft Ihnen, das Ernten und Pflanzen von Pflanzen zu automatisieren.","351":"Der Rancher hilft Ihnen, das Sammeln von Tieren zu automatisieren.","352":"Der Holzf\xe4ller hilft Ihnen, das F\xe4llen von B\xe4umen f\xfcr Holz zu automatisieren.","353":"Der Handwerker hilft Ihnen, das Sammeln von Handwerksstationen zu automatisieren.","354":"Kent ist Ihr Farmmanager. Er kann Ihnen helfen, Ihr Geh\xf6ft zu f\xfchren.","355":"Der Hirte wird Sie bei der Verwaltung Ihrer Nutztiere anleiten.","356":"Massenernte-Ergebnisse","357":"Kulturen Geerntet","358":"Kulturen Neu Gepflanzt","359":"Gegenst\xe4nde Gefunden!","360":"Weiter","361":"Verwendete Samen","362":"Globaler Markt","363":"Derzeit keine Artikel zum Kauf verf\xfcgbar","364":"Artikel verf\xfcgbar","365":"Kaufen","366":"Schlie\xdfen","367":"Ihre Handelspl\xe4tze:","368":"Waren nach Hause schicken","369":"Sende Gegenst\xe4nde aus deinem Rucksack direkt zu deinem Lagerhaus zu Hause.","400":"KAUFEN, HERSTELLEN, F\xc4HIGKEITEN, HEILEN, USW.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Bereits bei maximalen Trefferpunkten.","402":"\u26a0\ufe0f  Ressourcen.","403":"\u26a0\ufe0f Dein Inventar ist voll.","404":"Arbeite...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Trefferpunkte geheilt um +","406":"Maximum f\xfcr diesen Standort erreicht.","407":"Maximum f\xfcr diesen Standort erreicht.","408":"Brauche mehr Krankenh\xe4user.","410":"\ud83c\udfd5\ufe0f Um ein gekauftes Zelt zu benutzen, klicke auf dein eigenes Spielersymbol.","420":"Tauschhandel:","421":"Verwendet in:","422":"Grundwert:","423":"Keine Handel verf\xfcgbar.","424":"Keine Rezepte verf\xfcgbar.","425":"Verkaufe f\xfcr R\xfcckerstattung.","426":"Wenn du weniger als 10 dieser Pflanzen hast, kannst du sie hier kaufen:","427":"Kaufe die Massenernte-F\xe4higkeit des Farmhelfers, um alle Pflanzen auf einmal zu ernten.","428":"Klicke, um sofort alle Pflanzen zu ernten.","429":"Du hast keine Pflanzen zum Ernten.","430":"Kaufe diese Farmf\xe4higkeiten:","431":"Kaufe die Massentiersammlung-F\xe4higkeit des Farmhelfers, um von allen Tieren auf einmal zu sammeln.","432":"Kaufe die Holzf\xe4ller-F\xe4higkeit des Farmhelfers, um mehrere B\xe4ume auf einmal zu f\xe4llen und das Holz zu sammeln.","433":"Kaufe Besseres Holzf\xe4llen, um die Anzahl der gef\xe4llten B\xe4ume zu erh\xf6hen.","434":"Klicke, um sofort von allen Tieren zu sammeln.","435":"Klicke, um sofort mehrere B\xe4ume zu f\xe4llen und Holz zu sammeln.","436":"Du hast keine Tiere zum Sammeln.","437":"Du hast keine B\xe4ume zum F\xe4llen.","438":"Pflanze","439":"Pflanze zur\xfcckgegeben.","440":"Gestartet ","441":"\u231b\ufe0f In Bearbeitung ...","442":"\ud83c\udfe0 Hausreparaturen abgeschlossen!","450":"\u274c Kann Herstellungskosten nicht bezahlen","451":"\u26a0\ufe0f Herstellung bereits im Gange","452":"\u274c Herstellung konnte nicht gestartet werden.","453":"\u274c Haus konnte nicht repariert werden.","454":"\u274c Arbeiter konnte nicht eingestellt werden.","455":" ist angekommen!","456":"Keine weiteren Arbeiter verf\xfcgbar.","457":"Bereit zum Einsammeln!","458":"Zeit: ","459":"Sofort","460":"Ben\xf6tigt: ","461":"Kostet: ","462":"Gibt: ","463":"Heilt: ","464":"Kaufe Massen-Handwerk, um von allen fertigen Handwerksstationen auf einmal zu sammeln.","465":"Klicke, um sofort von allen fertigen Handwerksstationen zu sammeln.","466":"Du hast keine Handwerksstationen, die bereit zum Sammeln sind.","467":"Massenherstellung","468":"Neugestartet: ","469":"+","470":"Kann jetzt nicht reisen, landwirtschaftliche Aktionen im Gange.","471":"\u26a0\ufe0f Bereits im Gange.","472":"Geerntet","475":"Neustarten?","476":"Station","477":"Deine Farmarbeiter sind besch\xe4ftigt...","478":"\ud83c\udf31 Arbeitet","479":"Holzf\xe4llen","480":"Hergestellt","481":"mit","482":"angewendet","483":"neu gepflanzt","490":"Verkaufe f\xfcr R\xfcckerstattung (Nur Entwickler)","500":"KAMPF-STRINGS","501":"\ud83c\udfaf Au\xdfer Reichweite.","502":"\ud83c\udfaf Treffer!","503":"\u274c Verfehlt","504":"\ud83d\udc80 Get\xf6tet","505":"\u26a0\ufe0f Fehler","510":"\u2764\ufe0f\u200d\ud83e\ude79 Du nimmst Schaden ...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Deine Gesundheit: ","512":"Deine Gesundheit Nicht Verf\xfcgbar","520":"Du musst in der Stadt oder zu Hause sein, um Waffen und R\xfcstungen anzulegen.","522":"\ud83d\udee1\ufe0f Angelegte R\xfcstung:","523":"Keine R\xfcstung verf\xfcgbar","524":"\u2694\ufe0f Angelegte Waffe:","525":"Keine Waffen verf\xfcgbar","526":"Magische Verbesserungen:","527":"Keine magischen Verbesserungen verf\xfcgbar","528":"Sonstige Ausr\xfcstung:","550":"\ud83d\udee1\ufe0f Maximale Gesundheit","551":"\ud83d\udee1\ufe0f R\xfcstungsklasse","552":"\ud83c\udfaf Angriffsbonus","553":"\u2694\ufe0f Schaden","554":"\u2694\ufe0f Geschwindigkeit","555":"\ud83d\udc41\ufe0f Angriffsreichweite","556":"\u26fa\ufe0f Am Campen","557":"\ud83d\udef6 Im Boot","558":"Ja","559":"Nein","600":"BEZIEHUNGS-STRINGS:","601":"Beziehung:","602":"Du hast getroffen","603":"Du bist jetzt befreundet mit","604":"Du bist verknallt in","605":"Du bist verliebt in","606":"Du und","607":"sind jetzt verheiratet.","608":"sind jetzt Rivalen.","609":"ist jetzt dein Rivale deswegen.","610":"wird dar\xfcber nicht sehr gl\xfccklich sein...","611":"werden dar\xfcber nicht sehr gl\xfccklich sein...","612":"wird dar\xfcber sehr gl\xfccklich sein.","613":"billigen dies.","614":"und","615":"Deine Beziehung zu","616":"hat sich ge\xe4ndert.","619":"Interessen:","620":"Du musst dich n\xe4her bewegen, um mit diesem Charakter zu interagieren.","621":"f\xfcr das Verheiratetsein.","622":"f\xfcr die Freundschaft.","623":"f\xfcr das Verliebtsein.","625":"Baue eine Beziehung auf, um Aufgaben mit diesem Charakter freizuschalten.","626":"Baue eine Beziehung auf, um Handel mit diesem Charakter freizuschalten.","627":"Mit einer besseren Beziehung k\xf6nnte {npc} zus\xe4tzliche Aufgaben f\xfcr dich haben.","628":"Mit einer besseren Beziehung k\xf6nnte {npc} zus\xe4tzliche Handelsangebote f\xfcr dich haben.","630":"Begr\xfc\xdfen","631":"Sprechen","632":"Handeln","633":"Quest","634":"Getroffen","635":"Freund","636":"Verheiratet","637":"Rivale","638":"Liebe","639":"Verknallt","640":"Scherzen","641":"Freunde werden","642":"Beleidigen","643":"Umarmen","644":"K\xfcssen","645":"Entschuldigen","646":"Geschenk geben","647":"Kompliment","648":"Schmeicheln","649":"Liebe gestehen","650":"Antrag machen","651":"Verspotten","652":"Necken","653":"Ehe beenden","660":"Verliebt in: ","661":"Befreundet mit: ","662":"Rivale von: ","663":"Verheiratet mit: ","700":"EINF\xdcHRUNGS-STRINGS:","701":"\ud83d\udc78 Willkommen in Secrets of Elsinore","702":"Du bist in Elsinore angekommen, einem Grenzland voller M\xf6glichkeiten, Geheimnisse und Abenteuer.","705":"Bestreben","706":"Elsinore ist eine gro\xdfe Welt. Es liegt an dir, wie du deine Zeit verbringen m\xf6chtest. Welches dieser Bestreben passt am besten zu deinem Spielstil? (Diese Wahl wird deine Optionen in keiner Weise einschr\xe4nken.)","721":"\ud83e\udd20 Ernte und verkaufe Feldfr\xfcchte","722":"Du solltest sofort anfangen, \ud83d\udcb0 Geld zu verdienen. Ernte etwas \ud83c\udf3e Weizen und verkaufe es an \ud83e\udd20 Kent.","723":"\ud83d\udcaa Anbau-F\xe4higkeit","724":"Kaching! Um mehr aus deiner Farm herauszuholen, erwirb jetzt die \ud83d\udcaa Anbau-F\xe4higkeit.","727":"\ud83c\udf3d Pflanzen","728":"Gro\xdfartig, jetzt beginne mit der Landwirtschaft! Du kannst neue Feldfr\xfcchte \xfcber das \ud83c\udf31 Landwirtschafts-Panel pflanzen.","729":"\ud83d\udc2e Tierleben","730":"Ausgezeichnet! W\xe4hrend das w\xe4chst, bringen wir Leben auf die Farm. Erwirb zuerst die \ud83d\udcaa Viehzucht-F\xe4higkeit. Besuche dann das \ud83d\udc2e Tier-Panel, um eine Kuh zu kaufen.","731":"\ud83c\udf33 Holz","732":"Wunderbar! Secrets of Elsinore ist reich an W\xe4ldern. Holz ist eine wichtige Ressource f\xfcr Handwerk und Bauen. Um B\xe4ume zu f\xe4llen, musst du die \ud83d\udcaa Axt-F\xe4higkeit erwerben.","733":"\u2692\ufe0f Baumeister","734":"Gut, du hast die \ud83e\ude93 Axt erhalten! Neben dem Bau von Handwerksstationen kannst du dir auch einen Weg zum \ud83d\ude82 Bahnhof am Rand deines Homesteads bahnen. Benutze den \u27a1\ufe0f Wegweiser, um in die Stadt zu reisen.","737":"Zeit zu erkunden","738":"Dein Homestead ist Teil einer gr\xf6\xdferen Siedlung mit anderen Spielern, die sich eine gro\xdfe Grenze teilen. Benutze \ud83c\udfdb\ufe0f Wegweiser zum Reisen oder laufe zum Rand jeder Karte. VIEL SPASS BEIM SPIELEN VON ELSINORE!","740":"Ich erwachte aus einem seltsamen Albtraum und fand mich in einem dunklen Wald, vor dem Eingang einer H\xf6hle.","741":"Benutze die Tasten A-W-S-D (oder die Pfeiltasten), um deine Figur zu bewegen, und finde den Ausgang aus der H\xf6hle.","742":"Das sieht aus wie der Eingang zu einer Stadt. Begr\xfc\xdfe den Constable, der das Tor bewacht.","750":"\ud83c\udf3d Bauer","751":"Bewirtschafte dein Geh\xf6ft, baue Feldfr\xfcchte an, k\xfcmmere dich um Tiere und stelle Waren her, um sie zu verkaufen und mit anderen Spielern zu handeln. Investiere in Landwirtschafts- und Handwerksf\xe4higkeiten, um deine Gewinne zu steigern.","752":"\u2694\ufe0f Abenteurer","753":"Wage dich ins Tal f\xfcr Ressourcen und seltene Gegenst\xe4nde. K\xe4mpfe gegen Tiere und Kreaturen, entdecke versteckte Orte und triff magische Charaktere. Investiere in Kampff\xe4higkeiten, um ein beeindruckender K\xe4mpfer zu werden.","754":"\ud83c\udfdb\ufe0f Politiker","755":"Kandidiere als B\xfcrgermeister, lege den Steuersatz fest und verdiene Steuereinnahmen f\xfcr dich selbst. Investiere in Gemeinschaftsgeb\xe4ude f\xfcr die ganze Stadt, wie Krankenh\xe4user, Schulen und Bibliotheken, und hilf deiner Siedlung zu gedeihen.","780":"Lass uns wissen, was du von Secrets of Elsinore h\xe4ltst","781":"Ich werde weiterspielen; hier ist warum (alle zutreffenden ankreuzen):","782":"Ich bezweifle, dass ich zur\xfcckkehre; hier ist warum (alle zutreffenden ankreuzen):","783":"Spielen","784":"Sieht spa\xdfig aus","785":"Mir gefallen die Grafiken","786":"Ich mag Landwirtschaft","787":"Ich freue mich auf die Zusammenarbeit mit anderen","790":"Ich konnte es nicht herausfinden","791":"Mir gefallen die Grafiken nicht","792":"Ich hatte ein technisches Problem","793":"Es ist einfach nichts f\xfcr mich","794":"Spielen","795":"Tutorial \xdcberspringen","796":"OK","797":"Zur\xfcck","798":"Spielen","800":"WEITERE HANDWERKSSTATIONS-STRINGS:","801":"Erwerbe die F\xe4higkeit ","802":" am ","803":" um die Produktion dieser Station um ","805":"Deine F\xe4higkeit ","806":" erh\xf6ht die Basisproduktion dieser Station um ","810":"Du kannst diese F\xe4higkeit auch direkt kaufen: ","811":"Aufgestiegen!","812":"Herzlichen Gl\xfcckwunsch! Du hast Stufe {level} erreicht!","813":"Aufgestiegen! Du bist jetzt Stufe {level}!","814":"{feature} wird auf Stufe {level} freigeschaltet.","815":"Deine aktuelle Stufe: {level}","820":"Stellt her: ","821":"Basismenge: ","825":"Sie haben ","826":"Schriftrollen.","827":"Schriftrolle","828":"Das hast du bereits.","829":"Enth\xfclle Schriftrolle...","830":"Schriftrolle konnte nicht enth\xfcllt werden","831":"Enth\xfcllen","832":"Du brauchst Schriftrollen, um den Alten Tempel zu benutzen. Finde Schriftrollen, indem du die Welt erkundest.","899":"DEBUG-STRINGS:","900":"Debug: Inventar geleert.","901":"Debug: Quest-Verlauf gel\xf6scht.","902":"Debug: Ressourcen hinzugef\xfcgt.","903":"Debug: Raster erfolgreich zur\xfcckgesetzt.","904":"Debug: F\xe4higkeiten hinzugef\xfcgt.","905":"Debug: F\xe4higkeiten & Kr\xe4fte gel\xf6scht.","906":"Debug: Kampfstatistiken zur\xfcckgesetzt.","999":"PANEL UI-STRINGS:","1000":"[Beschreibung ben\xf6tigt]","1001":"Auf dem Geh\xf6ft gesammelte Ressourcen kommen ins Lagerhaus. In der Stadt oder im Tal gesammelte Ressourcen kommen in den Rucksack. Um einen Rucksack zu kaufen, besuche den Laden in der Stadt.","1002":"Bauen: Baue Handwerksstationen auf deinem Geh\xf6ft mit Ressourcen aus deinem Lagerhaus.","1003":"Gekaufte Tiere erscheinen bei deinem Spielersymbol und beginnen sofort ihr Leben auf dem Geh\xf6ft.","1004":"Pfl\xfcge Land zu Erde, um Pflanzen zu pflanzen. Pflanze Gras, um Nutztieren etwas zum Grasen zu geben.","1005":"Erwerbe F\xe4higkeiten, um verschiedene Attribute zu verbessern. Erkunde unbedingt die Stadt, um weitere Orte und M\xf6glichkeiten zum Erwerb von F\xe4higkeiten zu finden.","1006":"Verwalte hier deine laufende Aufgabenliste. Suche nach questgebenden Charakteren auf deinem Geh\xf6ft sowie in der Stadt oder sogar im Tal.","1007":"Regierungen in Elsinore werden auf Siedlungsebene gebildet. Der gew\xe4hlte B\xfcrgermeister setzt Richtlinien um und baut Geb\xe4ude, um der Gemeinschaft zu helfen, zu gedeihen.","1008":"Kaufe und verkaufe mit anderen Spielern. Wenn niemand deine Artikel vor Ablauf des Timers kauft, verkaufe sie an das Spiel.","1009":"[Handwerksbeschreibung]","1010":"[Briefkastenbeschreibung]","1011":"Dieser Tierstall ist leer. Stelle sicher, dass Tiere Gras zum Fressen haben, und sie werden schlie\xdflich zum Stall zum Ernten kommen.","1012":"Wahlen finden im Gerichtsgeb\xe4ude statt. Hier haben B\xfcrgermeister die Macht, den Steuersatz festzulegen und die Siedlung umzubenennen.","1013":" ","1014":" ","1015":"Das Spiel findet im Verlauf sich st\xe4ndig \xe4ndernder Jahreszeiten statt.","1016":" ","1017":"Besuche die Bank, um Gegenst\xe4nde gegen Geld einzutauschen, einschlie\xdflich seltener Gegenst\xe4nde wie Gold und Silber. Komme regelm\xe4\xdfig zur Bank zur\xfcck f\xfcr verschiedene Angebote.","1018":"","1019":"[Profilbeschreibung]","1021":"\xa9 Valley View Studios, 2025, Alle Rechte vorbehalten.","1022":"[Zugbeschreibung]","1023":"Arbeiter helfen dir, dein Geh\xf6ft zu f\xfchren. Stelle sie im Bauernhaus ein.","1024":"[Kampfbeschreibung]","1025":"[Ladenbeschreibung]","1026":"Geld verdienen und ausgeben.","1027":"Dies sind die Vorteile eines Gold-Passes.","1028":"[Dekorations-Panel-Beschreibung]","1029":"[Tier-Panel]","1030":"[Pflanzen-Panel]","1031":"Kaufe Dekorationen f\xfcr dein Geh\xf6ft. Du kannst diese f\xfcr eine volle R\xfcckerstattung verkaufen.","1032":"Das Bauernhaus ist der Ort, an dem du Leute einstellen kannst, die dir helfen, dein Geh\xf6ft zu f\xfchren.","1033":"Terraformiere das Land mit diesen Werkzeugen. Tiere brauchen Gras zum Grasen, Pflanzen brauchen Erde zum Wachsen. Pflaster kann n\xfctzlich sein, um Bewegungen von Tieren und Charakteren zu kontrollieren.","1034":"Edelsteine verdienen und ausgeben.","1035":"Dies ist deine Sammlung lebenslanger Troph\xe4en.","1036":"Enth\xfclle geheimnisvolle Schriftrollen in diesem Alten Tempel.","1037":"Nimm am Karneval mit anderen in deiner Siedlung teil. Erf\xfcllt alle Auftr\xe4ge als Team, um Preise zu gewinnen.","1038":"Schau regelm\xe4\xdfig bei Kent vorbei, um deine Waren zu verkaufen.","1039":"Erwerbe diese Zootiere, um dein Geh\xf6ft zu bev\xf6lkern und seltene Gegenst\xe4nde auszugraben.","1040":"Sieh, wie du im Vergleich zu anderen Spielern an der Grenze abschneidest.","1101":"Inventar","1102":"\u2692\ufe0f Bauen","1103":"\ud83d\udc2e Tiere","1104":"\ud83c\udf3d Landwirtschaft","1105":"\ud83d\udcaa F\xe4higkeiten","1106":"\u2705 Aufgabenliste","1107":"\ud83c\udfdb\ufe0f Regierung","1108":"\ud83d\udce5 Handel","1109":"Handwerk","1110":"\ud83d\udcea Briefkasten","1111":"\ud83d\udc3e Tiere","1112":"\ud83c\udfdb\ufe0f Gerichtsgeb\xe4ude","1113":"Helfercharakter","1114":"Spielercharakter","1115":"\ud83d\uddd3\ufe0f Saison","1116":"\ud83d\udd01 H\xe4ndler","1117":"\ud83c\udfe6 Bank","1118":"\ud83d\udd79\ufe0f Wie man spielt","1119":"Profil","1120":"\ud83d\udc1e Debug","1121":"\ud83d\ude00 Willkommen","1122":"\ud83d\ude82 Zug","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Farmhelfer","1124":"\u2694\ufe0f Kampf","1125":"\ud83d\uded2 Laden","1126":"\ud83d\udcb0 \xdcber Geld","1127":"\u2b50\ufe0f Gold-Pass","1128":"\ud83e\udeb4 Dekorationen","1129":"\ud83d\udc3e Tiere","1130":"\ud83c\udf3d Pflanzen & B\xe4ume","1131":"\ud83e\udeb4 Dekorationen","1132":"\ud83c\udfe0 Bauernhaus","1133":"\u26cf\ufe0f Werkzeuge","1134":"\ud83d\udc8e Edelsteine","1135":"\ud83c\udfc6 Troph\xe4en","1136":"\ud83d\uded5 Alter Tempel","1137":"\ud83c\udfa1 Karneval","1138":"\ud83e\udd20 Kent","1139":"\ud83d\udc12 Zootiere","1140":"\ud83d\udcca Bestenliste","1141":"\ud83d\udce5 Au\xdfenposten","1190":"\u2699\ufe0f Einstellungen","1301":"Zu kaufende F\xe4higkeiten:","1302":"Zu kaufende Upgrades:","1303":"Deine F\xe4higkeiten:","1304":"Deine Upgrades:","1305":"Du hast noch keine F\xe4higkeiten.","1306":"Du hast noch keine Upgrades.","1350":"KARNEVAL TEXTE","1351":"Karneval-Protokoll anzeigen","1352":"Karneval ist","1400":"MODAL-STRINGS","1401":"BANK-MODAL","1402":"Diese Angebote gelten f\xfcr","1403":"Kauft","1404":"f\xfcr","1405":"Keine Angebote verf\xfcgbar.","1406":"Neue Angebote in","1407":"Erstelle neue Auftr\xe4ge. Danke f\xfcr deine Geduld.","1408":"\u26a0\ufe0f Du hast nicht genug Gegenst\xe4nde.","1409":"\u26a0\ufe0f Du hast nicht genug F\xe4higkeiten.","1410":"\u26a0\ufe0f Du hast nicht genug Upgrades.","1500":"STADTNACHRICHTEN-STRINGS:","1501":"Nachrichten f\xfcr ","1502":"Der aktuelle B\xfcrgermeister ist","1503":", und der Steuersatz betr\xe4gt","1504":"Das passiert gerade in der Stadt:","1505":"Es ist Wahlsaison, und der Wahlkampf ist in vollem Gange. Komm beim Gerichtsgeb\xe4ude in der Stadt vorbei, um f\xfcr das B\xfcrgermeisteramt zu kandidieren.","1506":"Die Abstimmung f\xfcr den n\xe4chsten B\xfcrgermeister hat begonnen. Gib deine Stimme im Gerichtsgeb\xe4ude in der Stadt ab.","1507":"Der Zug kommt an und bietet an zu kaufen:","1508":"Der Zug f\xe4hrt ab. Wenn er zur\xfcckkommt, wird er kaufen:","1509":"Der Zug ist hier und bietet an zu kaufen:","1510":" ","1511":"Besuche die Bank, um Gold, Silber und Diamanten zu verkaufen. Die Bank aktualisiert derzeit ihre Angebote.","1512":"Es gibt derzeit keinen B\xfcrgermeister. ","1513":"Der Zug f\xe4hrt ab in","1514":"Wenn er zur\xfcckkommt, wird er kaufen:","1515":"Der Steuersatz betr\xe4gt","1516":"Die Bank kauft derzeit:","1517":"Der Zug wird abfahren in","1518":"Die Stimmen der letzten B\xfcrgermeisterwahl werden ausgez\xe4hlt. Ergebnisse erwartet in ","1600":"BRIEFKASTEN-STRINGS:","1601":"Lade Nachrichten...","1602":"Du hast keine Nachrichten.","1603":"Erhalten","1604":"Sammeln","1605":"Die meisten Nachrichten werden nach 14 Tagen gel\xf6scht. Shop-K\xe4ufe werden nicht gel\xf6scht.","1606":"\ud83d\udcea Briefkasten","1607":"\ud83d\uddd1\ufe0f Nachricht gel\xf6scht.","1700":"SHOP-STRINGS:","1701":"\ud83d\uded2 Shop","1702":"K\xe4ufe werden an den Posteingang geliefert.","1703":"\ud83d\ude4f Danke f\xfcr deine Unterst\xfctzung! Wir sind ein winziger Entwickler mit wenigen Ressourcen, aber leidenschaftlich daran interessiert, einen unterhaltsamen Raum f\xfcr eine positive Community zu schaffen.","1704":"Bitte erw\xe4ge K\xe4ufe zu t\xe4tigen, damit wir das Spiel weiter verbessern k\xf6nnen.","2000":"ZUG, BANK, GERICHTSGEB\xc4UDE, USW. STRINGS:","2002":"Abgeschlossen","2003":"\ud83d\ude82 N\xe4chste Lieferungsvorschau:","2004":"\ud83c\udf81 Belohnungen f\xfcr das Erf\xfcllen aller Auftr\xe4ge:","2005":"Klicke zum Erf\xfcllen","2006":"Deine Bestellung","2007":"Beansprucht","2008":"Auftrag beanspruchen","2009":"Von dir beansprucht:","2010":"Verf\xfcgbar zum Beanspruchen:","2011":"Von anderen beansprucht:","2012":"Abgeschlossen:","2013":"Von dir beansprucht:","2014":"Du kannst nur ein Zugangebot gleichzeitig beanspruchen.","2015":"Zugprotokoll anzeigen","2016":"\ud83c\udf89 Alle Auftr\xe4ge wurden abgeschlossen! Belohnungen wurden verschickt.","2017":"Diese Bestellung wurde bereits beansprucht.","2018":"\ud83c\udfa1 Vorschau auf den N\xe4chsten Karneval:","2019":"Belohnungen f\xfcr das Erf\xfcllen aller Bestellungen:","2020":"Zug ist","2030":"Angebote aktualisieren in","2040":"Willkommen, B\xfcrgermeister.","2041":"\ud83d\udcb0 Steuersatz: ","2042":"Vorgeschlagen: ","2043":"Aktualisieren","2044":"\u26a0\ufe0f Nur der B\xfcrgermeister kann den Steuersatz festlegen.","2045":"\ud83d\uddf3\ufe0f Wahlen:","2046":"Aktuelle Phase:","2047":"Phasen-Timer:","2048":"\ud83d\udce2 Wahlversprechen","2050":"Dies ist nicht deine Heimatsiedlung.","2060":"Abstimmung beginnt in:","2061":"Abstimmung endet in:","2062":"Abstimmung ist beendet. Ergebnisse werden bekannt gegeben in:","2063":"N\xe4chster Wahlkampf beginnt in:","2070":"\ud83d\udce2 Wahlversprechen","2071":"Niemand hat noch ein Wahlversprechen abgegeben.","2072":"Gib dein Wahlversprechen ein (max. 200 Zeichen)...","2073":"Wahlversprechen abgeben","2074":"Stimme abgeben","2075":"Keine Kandidaten zur Wahl verf\xfcgbar.","2076":"Wahlversprechen:","2077":"Du hast in dieser Wahl bereits abgestimmt.","2078":"Es gab keine Kandidaten.","2079":"Wie macht sich dein B\xfcrgermeister?","2080":"Willkommen, B\xfcrgermeister.","2081":"Siedlungsnamen eingeben...","2082":"Deine Siedlung:","2083":"Namen aktualisieren","2084":"Besuche das \ud83c\udfdb\ufe0f Regierungs-Panel, um Statistiken zu sehen, wie es der Siedlung geht, um deine Wahlentscheidung zu leiten.","2085":"Aktueller B\xfcrgermeister:","2090":"\ud83c\udfe4 Gemeinschaftsgeb\xe4ude","2092":"\ud83c\udfeb Schulen: ","2093":"\ud83c\udfeb Noch keine Schulen gebaut.","2094":"\ud83c\udfe5 Krankenh\xe4user: ","2095":"\ud83c\udfe5 Noch keine Krankenh\xe4user gebaut.","2096":"\ud83d\udc3e Tierh\xf6fe: ","2097":"\ud83d\udc3e Noch keine Tierh\xf6fe gebaut.","2098":"\ud83c\udfe4 Bibliotheken: ","2099":"\ud83c\udfe4 Noch keine Bibliotheken gebaut.","3000":"REGIERUNGS-PANEL:","3001":"Deine Siedlung:","3002":"\ud83d\ude0a Bev.","3003":"\ud83d\udcb0 Steuersatz:","3004":"Der Steuersatz wird vom B\xfcrgermeister f\xfcr diese Siedlung festgelegt, und ein Prozentsatz aller gesammelten Steuern wird dem Bankkonto des B\xfcrgermeisters hinzugef\xfcgt.","3005":"B\xfcrgermeister werden im Gerichtsgeb\xe4ude in der Stadt gew\xe4hlt.","3006":"\ud83c\udfdb\ufe0f Regierungsbeamte","3007":"Noch keine Regierungsbeamten gew\xe4hlt.","3009":"Nur der B\xfcrgermeister kann Schulen, Krankenh\xe4user und Bibliotheken in der Stadt bauen.","3010":"\ud83c\udfeb Schulen geben B\xfcrgern Zugang zu bestimmten F\xe4higkeiten, die anderswo nicht erlangt werden k\xf6nnen.","3011":"\ud83c\udfe5 Krankenh\xe4user stellen \xc4rzte zur Verf\xfcgung, die Abenteurer heilen k\xf6nnen, die aus dem Tal zur\xfcckkehren.","3012":"\ud83c\udfe4 Bibliotheken sind eine Quelle f\xfcr B\xfccher, die f\xfcr Abenteurer, die neue F\xe4higkeiten erlernen m\xf6chten, lebenswichtig sind.","3013":"\ud83d\ude82 Der B\xfcrgermeister kann die Nachfrage nach Waren am Zug beeinflussen.","3020":"Steuerprotokoll anzeigen","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"SAISON-PANEL-TEXTE","3051":"(Das Nettoverm\xf6gen wird zweimal t\xe4glich neu berechnet.)","3052":"Keine Daten f\xfcr Top-B\xfcrger verf\xfcgbar.","3053":"Es ist","3054":"L\xe4dt...","3055":"Saison endet in:","3056":"Wir befinden uns zwischen den Saisons.","3057":"Am Ende der Saison werden Bonusbelohnungen an die besten Spieler der Grenzlande sowie an alle Spieler der f\xfchrenden Siedlung gesendet.","3058":"\ud83c\udfc6 Top-B\xfcrger der Grenzlande","3059":"\ud83c\udfd9\ufe0f F\xfchrende Siedlung","3060":"Gesamtverm\xf6gen:","3061":"Bev\xf6lkerung:","3062":"Unbekannt","3063":"Keine Daten verf\xfcgbar","3064":"Saisonprotokoll anzeigen","4000":"ANMELDE-PANEL:","4001":"Hast du noch kein Profil? Erstelle ein neues kostenloses Profil, um zu spielen:","4002":"Ein neues Profil erstellen","4003":"Benutzername","4004":"Du wirst nicht nach einer E-Mail-Adresse gefragt.","4005":"Mit deinem eigenen Profil erh\xe4ltst du dein eigenes Geh\xf6ft zum Bewirtschaften in einer Siedlung mit anderen Spielern, in einer Grenze voller Siedlungen. Abenteuer erwarten dich im Tal.","4006":"Passwort","4007":"Anmelden","4008":"Benutzername","4009":"Melde dich bei deinem Profil an, um weiterzuspielen. Wenn du keinen hast","4010":"Hast du bereits ein Profil?","4050":"PROFIL-PANEL:","4051":"Hallo, ","4052":"Benutzername \xe4ndern:","4053":"Passwort \xe4ndern:","4054":"Profilverwaltung","4055":"Profilstatus:","4056":"Abmelden","4057":"Dein Profil l\xf6schen","4058":"Spieler-ID:","4059":"Geh\xf6ft-Umzug","4060":"Verbleibende Umz\xfcge:","4061":"Besuche den Shop, um mehr Umz\xfcge zu kaufen.","4062":"Einstellungen","4063":"Sprache:","4064":"Reichweitenanzeige:","4065":"Avatar \xe4ndern","4066":"Zur\xfcck zur Anmeldung","4067":"Sprache ausw\xe4hlen","4068":"Beginne Deine Reise!","4069":"Benutzername w\xe4hlen","4070":"Passwort w\xe4hlen","4071":"W\xe4hle dein Spieler-Symbol:","5000":"WEITERE MODAL-STRINGS:","5001":"\ud83d\udc80 Du bist gestorben.","5002":"Du wurdest nach Hause zur\xfcckgebracht. Alle Rucksack \ud83c\udf92 Gegenst\xe4nde, die du hattest, gingen verloren.","5003":"Sei n\xe4chstes Mal vorsichtiger.","5004":"\ud83d\udc80 Du bist gefallen!","5005":"\ud83d\ude00 Willkommen bei Secrets of Elsinore","5006":"Bitte melde dich an oder erstelle ein kostenloses Profil.","5007":"\xa9 Valley View Studios, 2025, Alle Rechte vorbehalten.","5010":"\ud83d\udce8 Posteingang","5011":"Du hast keine Nachrichten","5015":"\ud83d\uded2 Shop","5016":"K\xe4ufe werden an den Posteingang geliefert. Wir k\xf6nnen keine R\xfcckgaben anbieten. Alle K\xe4ufe sind endg\xfcltig.","5017":"Beachte, dass die meisten Inventargegenst\xe4nde zwischen den Saisons gel\xf6scht werden. \xdcberpr\xfcfe also bitte die Saisonuhr vor dem Kauf und siehe das Saisons-Panel f\xfcr weitere Informationen.","5020":"\ud83d\udeab Du bist derzeit abgemeldet.","5021":"Klicke auf die Anmelde- oder Profil erstellen-Schaltfl\xe4che, um zu beginnen.","5025":"\ud83d\ude4f Danke f\xfcr deine Unterst\xfctzung!","5026":"Dein Kauf wurde an deinen Posteingang geliefert.","5027":"Genie\xdfe Secrets of Elsinore!","5030":"\ud83d\ude00 Willkommen bei Secrets of Elsinore!","5031":"Kein Spieler ist angemeldet oder der Server ist offline.","5032":"Bitte aktualisiere die Seite, \xfcberpr\xfcfe deine Internetverbindung oder komme sp\xe4ter zur\xfcck.","5035":"Wir sind zwischen den Saisons!","5036":"Secrets of Elsinore ist vor\xfcbergehend nicht verf\xfcgbar, w\xe4hrend wir die Saison zur\xfccksetzen.","5040":"\ud83d\udcf0 Stadtnachrichten","5041":"Das passiert gerade in der Stadt:","5045":"Benutze ","5046":"M\xf6chtest du einen verwenden","5047":"Du hast ","5050":"\u26a0\ufe0f Geh\xf6ft-Umzug best\xe4tigen","5051":"Bist du sicher, dass du dein Geh\xf6ft umziehen m\xf6chtest? Dies kann nicht r\xfcckg\xe4ngig gemacht werden.","5052":"Schlie\xdfe diesen Dialog zum Abbrechen.","5060":"\u2b50\ufe0f Gl\xfcckwunsch!","5061":"Du hast jetzt einen Gold-Pass. Gehe zu deinem Profil-Panel, um dein Spielersymbol anzupassen und andere Gold-Vorteile zu entdecken.","5062":"Danke f\xfcr deine Unterst\xfctzung!","5070":"Deine Reise muss hier nicht enden...","5071":"W\xe4hle dein Schicksal:","5072":"Wiederbeleben f\xfcr","5073":"Akzeptiere deinen Tod","5074":"Mehr Edelsteine ben\xf6tigt?","5100":"Letzte Steuererhebungen","5101":"Noch keine Steuererhebungshistorie verf\xfcgbar.","5102":"\ud83d\uddd3\ufe0f Datum","5103":"\ud83d\udcb0 Gesamt gesammelt","5104":"B\xfcrgermeister","5105":"\ud83d\udcb0 B\xfcrgermeisteranteil","5110":"","6000":"TROPH\xc4EN-STRINGS:","6001":"Hier sind Ihre Lebenszeittroph\xe4en:","6002":"Sie haben noch keine Troph\xe4en. Verdienen Sie Troph\xe4en f\xfcr Erfolge im Spiel.","6003":"Troph\xe4e Erhalten!","7000":"BENACHRICHTIGUNGSTEXTE:","7001":"Tipp:","7002":"Herzlichen Gl\xfcckwunsch!","7003":"Klicke auf \ud83e\udd20 Kent, um Waren zu verkaufen.","7004":"Hinweis:","7005":"Benutze A-W-S-D oder die Pfeiltasten zum Bewegen. Gehe auf Erde und w\xe4hle dann \ud83c\udf31 Weizenfeld.","7006":"Suche nach dem \ud83d\udcaa Symbol, um das F\xe4higkeiten-Panel zu \xf6ffnen. Verkaufe weiterhin Waren an \ud83e\udd20 Kent, um Geld und \ud83d\udd37 XP zu verdienen.","7007":"Nach dem Erwerb von Viehzucht, gehe auf eine \ud83d\udfe9 Graskachel, dann finde das \ud83d\udc2e Kauf-Panel, um eine \ud83d\udc2e Kuh zu kaufen.","7008":"Feldfr\xfcchte brauchen Erde. K\xfche und Schafe brauchen \ud83d\udfe9 Gras. Pflaster kann helfen, die Bewegungen von Menschen und Tieren zu begrenzen. Benutze die \u26cf\ufe0f Werkzeuge, um das Land nach deinen W\xfcnschen zu formen.","7009":"\xdcberpr\xfcfe weiterhin deine \u2705 Aufgabenliste und sprich weiterhin mit \ud83e\udd20 Kent und \ud83d\udc75\ud83c\udffb der Hirtin.","7015":"Klicke + und - oben auf dem Bildschirm zum Hinein- und Herauszoomen.","7017":"Du hast einen ausr\xfcstbaren Gegenstand erhalten. Besuche das \u2694\ufe0f Kampf-Men\xfc, um ihn anzulegen.","7020":"Um sofort nach Hause zu reisen, klicke auf die Siedlung, in der sich dein Geh\xf6ft befindet.","7021":"Du hast es ins Tal geschafft! Vergiss nicht herauszuzoomen (+ und -), um deine Position im Blick zu behalten. Wenn du dich verirrst, zoome zur Grenzland-Ansicht heraus, um nach Hause zur\xfcckzureisen.","7049":"Tutorial","7050":"Benutze A-W-S-D oder die Pfeiltasten zum Bewegen. Versuche, mit Constable Elbow zu sprechen.","7051":"Du kannst eine Hausurkunde bei Constable Elbow kaufen, wenn du bereit bist, dein Geh\xf6ft zu besiedeln. Oder du kannst erkunden und dich f\xfcr Abenteuer ausr\xfcsten.","7052":"Mit deiner Hausurkunde kannst du den \ud83c\udfe0 Wegweiser Heim benutzen, um jederzeit zu deinem Geh\xf6ft zu reisen.","7053":"Willkommen auf deinem Geh\xf6ft! Dieses Land geh\xf6rt dir zum Aufbauen. Verdiene \ud83d\udcb0 Geld, indem du deine Waren an \ud83e\udd20 Kent verkaufst.","7054":"Gro\xdfartig, jetzt fang mit dem Anbau an! Du kannst Pflanzen \xfcber das \ud83c\udf3d Anbau-Panel pflanzen. Pflanzen m\xfcssen auf Erde gepflanzt werden.","7055":"Du bist auf dem richtigen Weg! Baue weiter an und verkaufe. Wenn du bereit bist, reise mit dem \ud83c\udfdb\ufe0f Wegweiser zur\xfcck in die Stadt und hole dir einen Stadtschl\xfcssel bei Constable Elbow.","7056":"Du bist jetzt in der Stadt willkommen! Erkunde alles, was die Stadt zu bieten hat, einschlie\xdflich mehr F\xe4higkeiten aufbauen, Stadtbewohner treffen und mehr M\xf6glichkeiten, Geld zu verdienen.","7057":"Gehe zum \ud83c\udfea Gemischtwarenladen in der Stadt, um eine Axt zu erwerben.","7058":"Gehe zum \ud83c\udfea Gemischtwarenladen in der Stadt, um eine Spitzhacke zu erwerben.","7061":"Reise jetzt in die Stadt, um deinen Stadtschl\xfcssel von Constable Elbow zu bekommen. Benutze den \ud83c\udfdb\ufe0f Wegweiser Stadt, um dorthin zu reisen.","7062":"Gut gemacht! Ich bin die Hirtin, und ich helfe dir mit deiner \u2705 Aufgabenliste. Komm zu mir zur\xfcck, wenn Aufgaben erledigt sind.","8000":"HAUSTIER & TEMPEL TEXTE:","8001":"GEW\xd6HNLICH","8002":"UNGEW\xd6HNLICH","8003":"SELTEN","8004":"EPISCH","8005":"LEGEND\xc4R","8010":"Dieses Haustier ist hungrig.","8011":"F\xfcttern","8012":", um es auf Schatzsuche zu schicken.","8014":" sucht nach Sch\xe4tzen...","8015":"Schau wieder vorbei in:","8016":" hat etwas gefunden!","8999":"WIE MAN SPIELT-STRINGS:","9000":"Willkommen bei Secrets of Elsinore!","9001":"Worum geht es?","9002":"Elsinore ist ein Spiel, das erforscht, wie Menschen sich selbst organisieren und Mikrogesellschaften in einer Welt asymmetrischer Ressourcen und gegenseitiger Abh\xe4ngigkeit schaffen k\xf6nnten, mit sowohl eigenen als auch gemeinsamen R\xe4umen.","9003":"Obwohl es keine expliziten Spezialisierungspfade gibt, gibt es drei Hauptrichtungen des Spiels, die voneinander abh\xe4ngig sind. Diese sind: der BAUER, der ABENTEURER und der POLITIKER. Du wirst ermutigt, dich aufeinander zu st\xfctzen.","9004":"Zuerst die Grundlagen:","9005":"Benutze die A-W-S-D-Tasten zum BEWEGEN. Klicke, um mit Dingen zu interagieren, die sich in deinem Interaktionsradius befinden.","9006":"Erkunde \ud83c\udf3d LANDWIRTSCHAFT, \u2692\ufe0f BAUEN und \ud83d\udc2e KAUFEN, um dein Geh\xf6ft zu verbessern und Ressourcen zu generieren.","9007":"Generiere \ud83d\udcb0 GELD von \ud83e\udd20 KENT oder beim \ud83d\udce5 HANDELSPOSTEN.","9008":"Mehr:","9009":"W\xe4hrend du Reichtum schaffst, verbessere dich selbst mit F\xc4HIGKEITEN und FERTIGKEITEN. Kaufe zum Beispiel die \ud83d\udc34 REITF\xc4HIGKEIT, um dich ins Tal zu wagen.","9010":"Zoome heraus (- und +), um zu sehen, wie gro\xdf die Welt ist. Dein Geh\xf6ft ist eines von vielen in einer SIEDLUNG. Jede SIEDLUNG hat eine gemeinsame STADT. Deine Siedlung ist eine von vielen in der GRENZE.","9011":"Wenn du bereit bist, erkunde das TAL, das voller Gefahren und Wunder ist. Die Geheimnisse des Zauberers PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f und des verlorenen K\xf6nigs LEONTES \ud83e\udd34 k\xf6nnen unter anderem im Tal gefunden werden.","9012":"Deine Ziele:","9013":"Setze dir gerne eigene Ziele. Am Ende jeder \ud83d\uddd3\ufe0f SAISON, die drei Monate dauert, werden sowohl Einzelpersonen als auch Siedlungen eingestuft, und eine Top-Platzierung generiert zus\xe4tzlichen Wohlstand. Dein Geh\xf6ft, alle deine F\xe4higkeiten und dein Inventar werden in die n\xe4chste Saison \xfcbertragen.","9014":"Bewirtschafte, stelle her, handle, erkunde, k\xe4mpfe und genie\xdfe!","9020":"Wie man Geld verdient","9021":"Es gibt ein paar M\xf6glichkeiten, \ud83d\udcb0 GELD zu verdienen.","9022":"Wenn du anf\xe4ngst, sprich mit \ud83e\udd20 KENT. Er kauft Waren, einschlie\xdflich Ernten und Handwerk.","9023":"Verschiedene Slots am \ud83d\udce5 HANDELSPOSTEN haben unterschiedliche Timer. W\xe4hrend des Timers kannst du die Waren nur verkaufen, wenn ein anderer Spieler sie kauft. Nach dem Timer kannst du die Waren an das Spiel verkaufen. Versuche mit anderen Spielern zu handeln. Sie haben Dinge, die du brauchst, und umgekehrt.","9024":"In der STADT findest du Orte wie die \ud83c\udfe6 BANK, die bestimmte Gegenst\xe4nde zu einem Premium-Preis von dir kauft.","9025":"Geld ausgeben","9026":"\xdcberraschung, die meisten Dinge kosten Geld. Anfangs m\xf6chtest du Geld f\xfcr \ud83d\udcaa F\xc4HIGKEITEN, \ud83d\udc2e NUTZTIERE und \u2692\ufe0f HANDWERKSSTATIONEN ausgeben. Erkunde die Panels auf der linken Seite des Bildschirms. Diese helfen dir, mehr Ressourcen zu generieren, die dir wiederum helfen, mehr Geld zu verdienen.","9027":"In der STADT wirst du mehr Gesch\xe4fte und H\xe4ndler entdecken.","9030":"Wie man Edelsteine verdient","9031":"Edelsteine sind eine seltene Ressource, die verwendet werden kann, um verschiedene Dinge zu kaufen, die dein Spiel beschleunigen.","9032":"Du kannst Edelsteine im Laden kaufen oder hier klicken:","9033":"In seltenen F\xe4llen k\xf6nnen Edelsteine im Tal gefunden oder als Belohnung f\xfcr das Meistern des Zugs oder einen starken Abschluss am Ende einer Saison verdient werden.","9040":"Kinderleicht:","9041":"100 \ud83d\udc8e Edelsteine f\xfcr ","9042":"Bester Wert:","9043":"500 \ud83d\udc8e Edelsteine f\xfcr ","9044":"Am beliebtesten:","9045":"1000 \ud83d\udc8e Edelsteine f\xfcr ","9050":"Vorteile","9051":"Ein Gold-Pass gibt dir Zugang zu Premium-Funktionen und Vorteilen in Elsinore f\xfcr die Dauer einer Saison.","9052":"Mit einem Gold-Pass kannst du folgende Vorteile genie\xdfen:","9053":"\u2705 Premium-Avatare: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 +100.000 Lagerkapazit\xe4t","9055":"\u2705 +5.000 Rucksackkapazit\xe4t","9056":"\u2705 2 zus\xe4tzliche Handelsstand-Pl\xe4tze","9057":"\u2705 Niedrigerer Steuersatz","9058":"\u2705 Die H\xe4lfte deiner MaxHP beim Tod wiederhergestellt","9059":"\u2705 Du kannst f\xfcr ein Amt kandidieren","9060":"Danke f\xfcr deinen Gold-Pass-Kauf.","9061":"Kaufe einen Gold-Pass","9999":"FEHLER-STRINGS:","10000":"\ud83d\udd0c Server ist unten","10001":"Der Server ist derzeit unten. Wir entschuldigen uns f\xfcr die Unannehmlichkeiten, bitte schaue bald wieder vorbei.","10002":"(Diese Nachricht verschwindet, wenn der Server wieder l\xe4uft.)","10100":"APP.JS-STRINGS:","10101":"Willkommen bei Secrets of Elsinore!","10102":"Bitte melde dich an oder erstelle ein kostenloses Profil.","10103":"\ud83c\udf92 Inventar","10104":"\ud83d\uded2 Shop","10105":"\ud83d\udce8 Posteingang","10106":"\ud83d\udce2 Teilen","10107":"\ud83d\udcac Chat","10108":"Du hast einen Gold-Pass","10109":"Steuerung:","10110":"\ud83d\udd79\ufe0f Wie man spielt","10111":"Du bist der B\xfcrgermeister","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Gesundheit: ","10113":"\ud83d\uddd3\ufe0f Es ist","10114":"N\xe4chste Saison beginnt in:","10115":"\ud83d\uddd3\ufe0f N\xe4chste Saison in:","10116":"\ud83c\udfdb\ufe0f Jetzt in der Stadt:","10117":"\ud83d\udcb0 N\xe4chste Steuererhebung:","10118":"In: ","10119":"Steuern werden jetzt erhoben...","10120":"\ud83c\udfdb\ufe0f Wahlen: ","10121":"Endet: ","10122":"\ud83d\ude82 Zug: ","10123":"\ud83c\udfe6 Bank: ","10124":"Neue Angebote: ","10125":"Lies die Stadtnachrichten!","10126":"Wer ist hier:","10127":"Keine PCs im Raster vorhanden.","10128":"\xc4nderungen speichern","10129":"","10130":"Du hast einen Gold-Pass","10131":"Gold-Pass-Vorteile","10132":"Umzug abbrechen","10133":"Geh\xf6ft umziehen","10135":"A-W-S-D zum Bewegen","10136":"I f\xfcr Inventar","10137":"+/- zum Zoomen","10138":"Du hast freigeschaltet:","10139":"Neue Quests von:","10149":"Stufe","10150":"\u2b06\ufe0f Stufe","10151":"\ud83d\udd37 EP:","10152":"\ud83d\udef6 Ins Boot Steigen","10153":"\ud83d\udef6 Aus dem Boot Steigen","10154":"\ud83c\udfd5\ufe0f Zelt Aufschlagen","10155":"\u26fa Zelt Einpacken","10156":"Verf\xfcgbar","10157":"Gesundheit","10158":"Zu Essende Menge","10159":"Gesundheitsgewinn","10160":"Max","10161":"\ud83c\udf7d\ufe0f Iss Nahrung, um Gesundheit Wiederherzustellen","10162":"Du hast keine essbaren Gegenst\xe4nde in deinem ","10170":"Die T\xfcr steht Ihnen offen.","10171":"Sie haben keinen Zugriff.","10175":"Erwerben Sie weitere F\xe4higkeiten an verschiedenen Orten in der Stadt.","10180":"\ud83d\udce5 Handelsposten: Artikel zum Kauf anfordern","10181":" LIMIT PRO ANFRAGE","10182":"Sie betreten ","10183":"Sie verlassen ","10184":"Das Tal","10185":"Elsinore","10186":"In einem Verlies","10187":"Mit Cursor platzieren","11000":"ADDED STRINGS:","11001":"Warte, bis der Timer endet, oder bis ein anderer Spieler diesen Gegenstand kauft.","12001":"Landwirtschaft","12002":"Bauen","12003":"Tiere","12004":"Aufgabenliste","12005":"F\xe4higkeiten","12006":"Kampf","12007":"Regierung","12008":"Saisons","12009":"Startseite","12010":"Profil","12011":"Dekorationen","12012":"Werkzeuge","12013":"Troph\xe4en","12014":"Zootiere","15000":"\ud83d\uddd3\ufe0f Saisonregeln","15001":"Saisons dauern drei Monate.","15002":"Belohnungen","15003":"\ud83d\udcb0 Das Nettoverm\xf6gen wird basierend auf deinem Geld, Inventargegenst\xe4nden und Gegenst\xe4nden auf deinem Geh\xf6ft berechnet.","15004":"\ud83c\udfc6 Die Top 3 Spieler \xfcber die Grenze hinweg erhalten Belohnungen in deinem Briefkasten und verdienen auch eine \'Saisonsieger\'-Troph\xe4e.","15005":"\ud83c\udfc6 Der beste Spieler an der Grenze erh\xe4lt auch die \'Saisonmeister\'-Troph\xe4e.","15006":"\ud83c\udf81 Alle Spieler in der besten Siedlung erhalten zus\xe4tzliche Belohnungen in deinem Briefkasten.","15007":"Zur\xfccksetzen von Spielern und Orten","15008":"\ud83c\udfe0 Du wirst zu deinem Geh\xf6ft zur\xfcckversetzt, wenn du bei Saisonende von zu Hause weg bist.","15009":"\ud83c\udfe0 Deine Geh\xf6fte werden NICHT zur\xfcckgesetzt \u2013 alle Layouts, Kacheln und Ressourcen bleiben erhalten.","15010":"\ud83c\udf92 Anders als in fr\xfcheren Saisons wird dein Inventar NICHT gel\xf6scht.","15011":"\ud83d\udc8e Du beh\xe4ltst alle Edelsteine.","15012":"\ud83d\udcb0 Anders als in fr\xfcheren Saisons wird Geld NICHT reduziert.","15013":"\u2705 Alle Quests werden gel\xf6scht.","15014":"\ud83d\udcaa Deine F\xe4higkeiten & Kr\xe4fte bleiben erhalten.","15015":"\u2764\ufe0f Deine Beziehungen bleiben erhalten.","15016":"\u2b50\ufe0f Dein Gold Pass-Status wird f\xfcr die neue Saison widerrufen.","15017":"\ud83c\udf32 Alle Stadt- und Talgitter werden mit frischen Kacheln, Ressourcen und Feinden zur\xfcckgesetzt.","15018":"Was \xe4ndert sich?","15019":"\ud83c\udf83 St\xe4dte haben Kacheln und Ressourcen entsprechend dem neuen Saisoninhalt.","15020":"\ud83d\ude00 Neue Spieler, die beitreten (und neue Geh\xf6fte erstellen), erhalten Starter-Kacheln und Ressourcen entsprechend dem neuen Saisoninhalt.","15021":"\ud83d\ude82 Zugbestellungen werden von den Saisons beeinflusst.","15022":"\ud83c\udfc6 Neue Belohnungen und Troph\xe4en k\xf6nnen verdient werden.","15030":"\ud83d\uddd3\ufe0f \xdcber Jahreszeiten lesen","16000":"GESCHICHTSTEXTE","16001":"Sei gegr\xfc\xdft, {username}. Ich bin Portia und stehe f\xfcr die Gesetze, die unsere Gemeinschaft zusammenhalten. Hilf mir, die Institutionen aufzubauen, die uns zivilisieren \u2014 Schulen, Krankenh\xe4user, Bibliotheken \u2014 und ich werde dich mit Einfluss und Rang belohnen. Aber wisse: Es ist nicht alles Gold, was gl\xe4nzt, und dieser Schurke Iago ist nur Katzengold. Hilf ihm, und wir sind geschieden.","16002":"Sei gegr\xfc\xdft, Soldat! Ich freue mich \xfcber dich, denn diese Lande brauchen mehr K\xe4mpfer, um das B\xf6se zur\xfcckzuschlagen, dem wir gegen\xfcberstehen. Besuche die Kriegerh\xf6hle und die Waffenkammer und mache dich bereit f\xfcr den Kampf!","16003":"Erfreut, deine Bekanntschaft zu machen, {username}. Cassio ist mein Name, und ich stehe f\xfcr die Ehre meiner Schwester Julia und suche den Kopf dieses feigen Herzogs Angelo. Er versteckt sich im Tal. Und schlie\xdfe keine Freundschaft mit diesem Dieb Iago, oder ich werde keine Gesch\xe4fte mit dir machen.","16004":"Na, bist du nicht ein Schatz? Ich bin Wirtin Quickly, und ich habe mich auf die Kochkunst spezialisiert. Ich helfe dir gerne, deine F\xe4higkeiten mit Essen aufzubauen, wir brauchen mehr K\xfcchenmagier in diesen Landen!","16005":"Sehr erfreut, deine Bekanntschaft zu machen, {username}. Mein Name ist Feste, und ich bin der \xf6rtliche Handwerker in dieser Gegend. Ich kann dir helfen, deine kreativen F\xe4higkeiten aufzubauen, denn es ist gutes Geld zu verdienen, wenn man feine Dinge f\xfcr die Leute herstellt.","16006":"Aber hallo, freundlicher Reisender. Ich bin Helena und lebe hier zwischen den Feldern von Mutter Natur. Wenn du diese Lande erkundest, wisse, dass ich allein den Goldenen Schl\xfcssel zur Burg besitze, wo K\xf6nig Leontes seine Krone verlor. Obwohl ich nach der Liebe seiner K\xf6nigin schmachte, w\xfcrde ich meine Tr\xe4ume opfern, um Leontes zu ihr und zu seinem fr\xfcheren Ruhm zur\xfcckkehren zu sehen.","16007":"Du bist weit gereist, {username}. Ich bin Titania, K\xf6nigin der Feen. Du bist nun an den Ort gelangt, jenseits dessen die Gefahren nur noch wachsen werden. Wenn du Prospero triffst, mache ihn nicht zu deinem Feind, oder du wirst nichts von mir bekommen.","16008":"Nun, du hast es geschafft. Ich h\xe4tte nie gedacht, dass es jemanden geben w\xfcrde, der meine Drachen besiegt und mich an diesem Ort erreicht. Die Kugel des Merlin geh\xf6rt dir. Vielleicht kann uns das Orakel doch noch Hoffnung bringen. Suche sie tief im Tal.","16009":"[Prospero]","16010":"Gib mir Leben, gib mir Liebe, aber vor allem... gib mir Portwein! Im Tausch ein Zweig Mutterkraut, manchen teurer als Gold, besonders dieser gro\xdf\xe4ugigen Helena. Sie sagt, sie ist hinter Kronen und Legenden her, armes M\xe4dchen. Ich? Ich bin hinter einem vollen Bauch und einem sanften Nickerchen her. \'Du bist so dumm vom Trinken alten Weins\', sagten sie mir einst. Ha! Sie hatten nicht unrecht.","16011":"Hier ist Rosmarin, zum Gedenken \u2014 und Nachtschatten, f\xfcr Bedauern. Meine Tr\xe4nke sind nichts f\xfcr Willensschwache. Mit dem richtigen Blatt kann ich deine Glieder heilen oder deine Zunge verwirren. \'Ich erinnere mich an einen Apotheker\', sagte einst ein Junge, und er zahlte den Preis. Aber du? Du siehst kl\xfcger aus. Bring mir seltene Wurzeln und bittere Samen, und ich mische dir etwas, das die Gefahr wert ist.","16012":"Ah, Reisender, die W\xe4lder sind voll gefl\xfcsterter Intrigen, und Portia h\xe4lt eine an ihre Brust gedr\xfcckt wie ein Geizhals seine M\xfcnze. Bring mir ihr Geheimnis, ich bitte dich, und ich werde dir eine h\xf6chst seltene Messingglocke in die Hand legen. Ihre Stimme klingt wahrer als jeder Eid, den sie geschworen hat. Tu dies, und ich werde dir Murmeln von mondlichem Unfug zufl\xfcstern, von tief verwurzelten Rivalit\xe4ten und dem Wenden noch ungesehener Schicksale.","16013":"Etwas ist noch immer faul. Ich sp\xfcre es im Boden. Ich herrschte einst, liebte, verlor. Helena durchfuhr mich wie Sommerblitze. Und Leontes? Er konnte das Tauwetter nicht verzeihen. \'Die Dame protestiert zu viel\', sagten sie; lass sie reden. Wenn du Helena siehst, sag ihr, dass die Rosen ihren Namen kennen. Wenn du Leontes siehst, sag ihm, dass ich den Winter nicht vergessen habe.","16014":"Meine Trauer ist eine Statue; stumm, aber niemals still. Ich begrub meine Krone im Schnee an dem Tag, als Gertrud ihren Garten mir vorzog. \'Abgang, verfolgt von einem B\xe4ren\'? Nein, ich floh vor mir selbst. Nun warte ich, zwischen Stein und Stille. Bring mir, was einst mein war, die K\xf6nigskrone, und ich zahle in Gold, mehr als das Gewicht der Erinnerung. Aber sei gewarnt: Manche Throne tragen Fl\xfcche.","16015":"Diese Br\xfccke ist mein, bei Sycorax, meiner Mutter. Prospero versuchte sie mit Zauber und L\xe4cheln zu stehlen. Sie nannten mich Bestie, aber ich bin aus Erde und Sturm, geboren zur wilden Wahrheit. Ich tausche Knochen gegen Silber, Zeichen der Toten gegen M\xfcnzen der Lebenden. Ber\xfchre nichts leichtfertig in diesen W\xe4ldern. Bring mir, was andere f\xfcrchten, und ich mache dich reich... oder verflucht.","16016":"Meine Gro\xdfz\xfcgigkeit ist so grenzenlos wie das Meer, meine Liebe so tief... aber er ist fort, und alles was bleibt ist ein Portr\xe4t und Schmerz. Angelo nahm beides. Bring mir Romeos Abbild, aus meiner Kammer gerissen, und ich gebe dir Tulpen, rot wie das Blut, das auf Veronas Steinen vergossen wurde. Lass dies unser neuer Balkon sein: du unten, Gerechtigkeit tragend.","16017":"Hallo, Freund. Suchst du den Dreizack der alten G\xf6tter? Er ist eines der sieben Artefakte, die n\xf6tig sind, um das Orakel zufriedenzustellen. Ich brauche viel Gold, um mich davon zu trennen.","16018":"Willkommen {username}. Herzlichen Gl\xfcckwunsch, denn du hast eine weite Strecke zur\xfcckgelegt. Ich sp\xfcre den Heldenmut in dir. Bring mir die sieben Artefakte, die diese V\xf6lker verbinden, und ich werde dir die Hoffnung geben, das Goldene Zeitalter wiederherzustellen!","16019":"Gr\xfc\xdfe {username}! Jahrhundertelang lebten die freundlichen Menschen von Elsinore in Harmonie, regiert vom wohlwollenden K\xf6nig Leontes. Doch seit kurzem w\xe4chst eine b\xf6se Plage im Tal und bedroht unsere friedlichen Wege. Es hei\xdft, eine einzige Quest kann die Hoffnung in diese Lande zur\xfcckbringen und die Dunkelheit zur\xfcckdr\xe4ngen. Suche das Orakel im Tal, Abenteurer, und bring uns Hoffnung!","16020":"Sei gegr\xfc\xdft, J\xe4ger! Hast du Felle zum Handeln? Ich zahle dir faire M\xfcnzen f\xfcr alle Pelze, die die Wildnis des Tals deinem Geschick \xfcberlassen hat. Die k\xe4lteren Monate nahen, und die Leute suchen W\xe4rme. Deine Jagd f\xfcllt meine Truhen; meine M\xfcnzen f\xfcllen deinen Beutel. Das ist ein Handel so gem\xfctlich wie der Name, den ich trage!","16101":"","16102":"","16103":"","16104":"","16105":"","16106":"","16107":"","16108":"","16109":"","16110":"","16111":"","16112":"","16113":"","16114":"","16115":"","16116":"","16117":"","16118":"","16119":"","16120":"","21000":"Katze","21001":"Pudel","21002":"Affe","21003":"Ente","21004":"Esel","21005":"Eule","21006":"Papagei","21007":"Adler","21008":"Zebra","21009":"Giraffe","21010":"Orang-Utan","21011":"Dodo","30000":"TROPH\xc4EN:","30001":"Erster Landarbeiter","30002":"F\xe4higkeiten-Erbauer","30003":"Z\xfcge Abgeschlossen","30004":"Saisonsieger","30005":"Saisonmeister","30006":"Triff die Besetzung","30007":"Erkunde das Tal","30008":"K\xe4mpfer","30009":"Schriftrollenoffenbarer","30010":"Abenteurer","30011":"Seefahrer","30012":"T\xf6te den Herzog","30013":"Prosperos Kugel","30014":"Abgeschlossene Karnevale","200000":"RESSOURCEN","200009":"Gold-Konto","200010":"Geld","200011":"Stummel","200012":"Wegweiser N","200013":"Wegweiser O","200014":"Wegweiser S","200015":"Wegweiser W","200016":"Wegweiser NW","200017":"Wegweiser NO","200018":"Wegweiser SO","200019":"Wegweiser SW","200020":"Wegweiser Stadt","200021":"Wegweiser Heim","200022":"Handelsstand","200023":"Handelsposten","200024":"Lagerhaus","200025":"Verlassenes Haus","200026":"Bauernhaus","200027":"Reparatur","200028":"Berg","200029":"Gro\xdfer Berg","200030":"Bank","200031":"Gerichtsgeb\xe4ude","200032":"Zug","200033":"Briefkasten","200034":"Eiche","200035":"Kiefer","200036":"Palme","200037":"Weihnachtsbaum","200038":"Schneemann","200039":"Felsen","200040":"Lehmgrube","200041":"Holz","200042":"Stein","200043":"Lehm","200044":"Weizenfeld","200045":"Karottenfeld","200046":"Maisfeld","200047":"Zuckerrohrfeld","200048":"Erdbeerfeld","200049":"Apfelbaum","200050":"Zitronenbaum","200051":"Weinrebe","200052":"Knoblauchfeld","200053":"Olivenbaum","200054":"Tomatenrebe","200055":"Eichenfeld","200056":"Weizen","200057":"Karotte","200058":"Mais","200059":"Zuckerrohr","200060":"Erdbeere","200061":"Apfel","200062":"Zitrone","200063":"Trauben","200064":"Knoblauch","200065":"Olive","200066":"Tomate","200067":"Blaubeere","200068":"Milch","200069":"Wolle","200070":"Ei","200071":"Mehl","200072":"H\xfchnerfutter","200073":"Zucker","200074":"Maismehl","200075":"Schnittholz","200076":"Butter","200077":"Sahne","200078":"K\xe4se","200079":"Faden","200080":"Stoff","200081":"Pullover","200082":"Jacke","200083":"Schwere Jacke","200084":"Runentunika","200085":"Brot","200086":"Maisbrot","200087":"Apfelkuchen","200088":"Erdbeerkuchen","200089":"Zitronenkeks","200090":"Olivenbrot","200091":"Knoblauchbrot","200092":"K\xf6niginnenkuchen","200093":"Tomatensuppe","200094":"Karottensuppe","200095":"Omelett","200096":"Pizza","200097":"Honig","200098":"Apfelwein","200099":"Wein","200100":"Portwein","200101":"Oliven\xf6l","200102":"Gereifter Wein","200103":"T\xf6pferwaren","200104":"M\xf6bel","200105":"Tinte","200106":"Urnen","200107":"Rosmarin","200108":"Pilz","200109":"Zauberpilz","200110":"G\xe4nsebl\xfcmchen","200111":"Tulpe","200112":"Sonnenblume","200113":"Mutterkraut","200114":"Trank A","200115":"Trank B","200116":"Trank C","200117":"Edelstein","200118":"Buch","200119":"Fell","200120":"B\xe4renfell","200121":"Knochen","200122":"Silber","200123":"Gold","200124":"Diamantring","200125":"K\xf6nigskrone","200126":"Portr\xe4t","200127":"Dreizack","200128":"Dietrich","200129":"Goldener Schl\xfcssel","200130":"Schriftrolle","200131":"Prosperos Kugel","200132":"Zelt","200133":"Boot","200134":"Schrein","200135":"Burg","200136":"Restaurant","200137":"Toilette","200138":"Gemischtwarenladen","200139":"Kriegerh\xf6hle","200140":"Magie-Laden","200141":"Alter Tempel","200142":"Abenteuerlager","200143":"Labor","200144":"Schule","200145":"Tierstall","200146":"M\xfchle","200147":"Molkerei","200148":"H\xfchnerstall","200149":"S\xe4gewerk","200150":"Webstuhl","200151":"Ofen","200152":"K\xfcche","200153":"Bienenstock","200154":"Studio","200155":"Weinkellerei","200156":"Bibliothek","200157":"Tierhof","200158":"Krankenhaus","200159":"Kuh","200160":"Schaf","200161":"Braune Kuh","200162":"Arzt","200163":"Chirurg","200164":"Fee","200165":"Kent","200166":"Portia","200167":"Die Sch\xe4ferin","200168":"Hotspur","200169":"Cassio","200170":"Mistress Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampir","200175":"Weihnachtsmann","200176":"Prospero","200177":"Falstaff","200178":"Apotheker","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Julia","200184":"Meerjungfrau","200185":"Bauer","200186":"Farmhelfer","200187":"Viehz\xfcchter","200188":"Holzf\xe4ller","200189":"Kojote","200190":"B\xe4r","200191":"Spinne","200192":"Zombie","200193":"Herzog Angelo","200194":"Geist","200195":"Oger","200196":"D\xe4mon","200197":"Drache","200198":"Kojoten-Spawner","200199":"B\xe4ren-Spawner","200200":"Spinnen-Spawner","200201":"Zombie-Spawner","200202":"Geist-Spawner","200203":"D\xe4monen-Spawner","200204":"Drachen-Spawner","200205":"Z\xfcchter","200206":"Gr\xfcner Daumen","200207":"Viehzucht","200208":"Massentiersammlung","200209":"Axt","200210":"Spitzhacke","200211":"Baumeister","200212":"Massenernte","200213":"Massennachpflanzung","200214":"Holzf\xe4llerei","200215":"Verbesserte Holzf\xe4llerei","200216":"Massenhandwerk","200217":"Massenhandwerk-Neustart","200218":"Verbesserte Axt","200219":"Verbesserte Spitzhacke","200220":"Lagerhaus","200221":"Depot","200222":"Lager 3 Noch zu Bestimmen","200223":"Lager 4 Noch zu Bestimmen","200224":"Maurerhandwerk","200225":"Mechanik","200226":"Textilien","200227":"Kunstfertigkeit","200228":"Imker","200229":"Schneider","200230":"Politik","200231":"Bildung","200232":"Chemie","200233":"Kochen","200234":"Molkerei","200235":"B\xe4cker","200236":"Winzer","200237":"M\xfcller","200238":"Handwerker","200239":"Koch","200240":"Weber","200241":"Vogelf\xe4nger","200242":"K\xe4ser","200243":"Kulinarischer Virtuose","200244":"Oberimker","200245":"Weinbauer","200246":"Recht","200247":"Medizin","200248":"Chirurgie","200249":"Rucksack","200250":"Tornister","200251":"Verzauberter Rucksack","200252":"Pferd","200253":"Spurensuche","200254":"Kundschafter","200255":"Polsterung","200256":"Leichte R\xfcstung","200257":"Kettenhemd","200258":"Plattenpanzer","200259":"Schwere R\xfcstung","200260":"Mystische R\xfcstung","200261":"Calibans Brustpanzer","200262":"Gesegneter Schleier","200263":"Magischer Helm","200264":"Magische Handschuhe","200265":"Schutzstiefel","200266":"Messer","200267":"Kurzschwert","200268":"Langschwert","200269":"Gro\xdfschwert","200270":"Hellebarde","200271":"Schwert des Liedes","200272":"Magische Hellebarde","200273":"Gl\xfchendes Schwert","200274":"Riesenaxt","200275":"Legend\xe4res Schwert","200276":"Drachent\xf6ter","200277":"Wurfpfeile","200278":"Kurzbogen","200279":"Langbogen","200280":"Speer","200281":"Armbrust","200282":"Magischer Speer","200283":"Magische Armbrust","200284":"Titanias Bogen","200285":"Legend\xe4re Armbrust","200286":"Sturm","200287":"Mahlstrom","200288":"Vergessenheit","200289":"Titan","200290":"Sto\xdf","200291":"Wirbel","200292":"Sperrfeuer","200293":"Ruhige Hand","200294":"Punktgenau","200295":"Unfehlbar","200296":"Fokus","200297":"Pr\xe4zision","200298":"Horizontauge","200299":"Standhaftigkeit","200300":"Steinherz","200301":"Unzerbrechlich","200500":"Kiste","200501":"Steinmauer","200502":"Gro\xdfe Steinmauer","200503":"Gr\xfcne Mauer","200504":"Schwarze Mauer","200505":"Sandmauer","200506":"Blaue Mauer","200507":"Orange Mauer","200508":"Pflanze","200509":"Kaktus","200510":"Harfe","200511":"Flagge","200512":"B\xfccherstapel","200513":"Stuhl","200514":"Toilette","200515":"Bett","200516":"Teddyb\xe4r","200517":"Gro\xdfes Loch","200518":"Rutsche","200519":"Brunnen","200520":"Gro\xdfer Brunnen","200521":"Gro\xdfe Dekorative Palme","200600":"Kartoffel","200601":"Salat","200602":"Paprika","200603":"Orange","200604":"Gemischter Salat","200605":"Sandwich","200606":"Kartoffelauflauf","200607":"Weinbrand","200608":"S\xe4ge","200609":"Schaufel","200610":"Schraubenzieher","200611":"Hammer","200612":"Schraube","200613":"Ph\xf6nix","200614":"Ph\xf6nixfeder","200615":"Messingglocke","200616":"Vampirblut","200617":"Hoffnung","200618":"Gelbes Herz","200619":"Gr\xfcnes Herz","200620":"Lila Herz","200621":"Karneval","200622":"Gilde","200623":"Schwein","200800":"Nur in Schriftrollen zu finden","200801":"Hoffnungsquest","armorclass":"R\xfcstungsklasse","attackbonus":"Angriffsbonus","attackrange":"Angriffsreichweite","backpackCapacity":"Rucksackkapazit\xe4t","damage":"Schaden","hp":"Trefferpunkte","iscamping":"Zeltet","maxhp":"Max. Trefferpunkte","range":"Reichweite","speed":"Angriffsgeschwindigkeit","warehouseCapacity":"Lagerhauskapazit\xe4t"}'),c=JSON.parse('{"0":"Valley View","1":"Server is not running.","3":"\ud83c\udf31 Land successfully tilled.","4":"\u26a0\ufe0f You don\'t have enough resources.","5":"\u2692\ufe0f Construction completed successfully.","6":"\ud83d\udcb0 Items sold.","7":"\ud83c\udfe0 This homsetead is unoccupied.","8":"\ud83d\udeab This area is off limits.","9":"The Valley is full of wonders, and must be explored on foot.","10":"\ud83c\udfe0 [username]\'s homestead.","11":"\ud83c\udfe0 Unknown owner\'s homestead.","12":"Settlement view. Depending on your location, you may need to scroll to see the Town.","13":"Frontier view.","14":"\ud83c\udfdb\ufe0f Welcome to town.","15":"\ud83d\udc34 You need a Horse to travel here. Visit the Adventure Camp in Town.","16":"You\'re in the valley.","17":"You do not own a hometead here.","18":"\ud83d\udeab You can\'t go that way.","19":"\ud83c\udf92 You need a Backpack to collect resources away from your homestead. Buy one at the Adventure Camp.","20":"\ud83d\udeab Not enough room in the Warehouse.","21":"\ud83c\udf92 Not enough room in the Backpack. Open Inventory to manage Backpack contents.","22":"Items purchased.","23":"\u26a0\ufe0f You can\'t build that here.","24":"\ud83c\udfaf Out of range","25":"\ud83c\udf92 Nothing in the Backpack.","26":"\ud83c\udf92 You must be at your homestead to empty your Backpack.","27":"\u26fa\ufe0f You don\'t have a tent.","28":"\u26fa\ufe0f You are now camping.","29":"\u26a0\ufe0f \u26fa\ufe0f Failed to camp / decamp.","30":"\u26fa\ufe0f No longer camping.","31":"\u26fa\ufe0f Cannot attack while camping.","32":"\u26fa\ufe0f You need to decamp first.","33":"\ud83d\udce6 Moved items to the Warehouse.","34":"\ud83c\udf92 Emptied backpack.","35":"You need a ","36":"You used a ","50":"\ud83d\udeab That username is already taken.","70":"Session Expired","71":"You\'ve been away for a while. Refreshing ensures your session works properly.","72":"This page will auto-refresh in 30 seconds unless you do it now.","73":"\ud83d\udd04 Refresh Now","74":"\ud83c\udf92 A Backpack is required to own a Tent.","75":"You do not own a Backpack. You can purchase one at the Adventure Camp in Town.","76":"Your Warehouse is empty.","77":"Your Backpack is empty.","78":"Manage Contents","80":"Acquired ","90":"\ud83d\udeab This is not your homestead.","91":"\ud83d\udc34 Horse required.","94":"\ud83d\udce2 Share Valley View!","95":"Invite others to help out and join the adventure!","96":"Have Feedback?","97":"@ Email Us","98":"\u23f3 Loading ...","99":"\u26a0\ufe0f Something went wrong.","100":"TRAVELING STRINGS:","101":"\ud83d\udc34 Traveling home ... please wait.","102":"\ud83d\udc34 Traveling to town ... please wait.","103":"\ud83d\udc34 Traveling to the next location ... please wait.","104":"\ud83d\udeab No town in this settlement yet.","105":"\u26a0\ufe0f There was a problem trying to travel.","106":"\ud83d\udeab You cannot travel beyond the frontier.","110":"\u27a1\ufe0f Walk onto Signposts to use them","111":"Welcome to town.","112":"Welcome home.","120":"You don\'t have any homestead moves left.","121":"You have successfully moved your homestead.","122":"You cannot move to the valley!","123":"You cannot move to the town!","124":"That homestead is occupied.","125":"Where are you moving to?","130":"Select your language:","131":"Confirm","140":"TRADE STALL STRINGS:","141":"Sold","151":"You cannot fill another player\'s trade stall.","152":"You do not have enough money to buy this item.","153":"is selling:","154":"are selling","155":"Transaction failed. This item has already been sold.","156":"Click to sell","157":"Bought by","158":" limit per order.","159":"Ready to sell","160":"Items to Sell","161":"Item","162":"Available","163":"Price","164":"Amount","165":"All","166":"Add","167":"Sell","168":"Yes, Sell All","169":"Buy","170":"Unlocked trading slot","171":"Gold Pass Required","172":"Locked","173":"Limit of","174":"to Sell","175":"Unlock for","176":"Wood","177":"Need","178":"to unlock this slot","179":"This Outpost only accepts items from your backpack. Any player can collect money from an Outpost.","180":"INVENTORY STRINGS:","181":"\ud83d\udce6 Warehouse","182":"\ud83c\udf92 Backpack","183":"Capacity: ","184":"Manage Contents","185":"Quantity","186":"Amount","187":"Add to Warehouse","188":"Discard","189":"Add All to Warehouse","190":"Discard All","191":"Item","192":"Action","193":"Discard Items","194":"Expand Warehouse","195":"Expand Backpack at the Adventure Camp in Town.","199":"Near unlimited capacity with Gold Pass (among other benefits).","200":"QUESTS","201":"\u2705 Action item completed. You have your reward.","202":"\u2705 Action item accepted.","203":"No action items at the moment.","204":"To Do List:","205":"Nothing new at this time. Check your \u2705 To Do list!","206":"Return to the NPC who gave you this quest to collect your reward.","207":"In Progress","208":"Get Reward","209":"Accept","299":"FARMING STRINGS:","300":"Added","301":"\ud83c\udf31 Tilled","302":"\ud83c\udf31 Planted","303":"\ud83c\udf31 Must plant on dirt","304":"\ud83c\udf31 Can\'t plant here","305":"\u26a0\ufe0f Not enough resources","306":"\u26a0\ufe0f Can\'t build here","310":"You need to till the land for planting.","311":"Your farm animals will need plenty of grass to graze on.","312":"Pavement can be useful to control wandering animals.","313":"","315":"Select Crops to Harvest:","316":"Select All","317":"Deselect All","318":"Collect","319":"Select Animals to Collect:","320":"Cannot terraform here.","340":"Not avilable unless you\'re on foot.","341":"Select Crafting Stations to Collect:","342":"Harvest?","343":"Replant?","344":"No crops ready to harvest.","345":"Ready to Collect:","346":"Collect?","347":"Buy 1 for: ","350":"The Farm Hand will help you automate harvesting and planting of crops.","351":"The Rancher will help you automate collecting from animals.","352":"The Lumberjack will help you automate chopping trees for wood.","353":"The Crafter will help you automate collecting from crafting stations.","354":"Kent is your Farm Manager. He can help you run your homestead.","355":"The Shepherd will guide you in the management of your farm animals.","400":"BUYING, CRAFTING, SKILLS, HEALING, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Already at maximum hit points.","402":"\u26a0\ufe0f  resources.","403":"\u26a0\ufe0f Youre inventory is full.","404":"Working...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Hit Points healed by +","410":"\ud83c\udfd5\ufe0f To use a purchased tent, click on your own player icon.","420":"will trade you:","421":"Used In:","422":"Base Value:","423":"No trades available.","424":"No recipes available.","425":"Sell for refund","426":"Expensive starter crops, but in case you run out:","427":"Purchase the Farm Hand\'s Bulk Harvest skill to harvest all crops at once.","428":"Click to instantly harvest all crops.","429":"You have no crops to harvest.","430":"Purchase these farm skills:","431":"Purchase the Farm Hand\'s Bulk Animal Collect skill to collect from all animals at once.","432":"Purchase the Farm Hand\'s Logging skill to chop multiple trees at once and collect the wood.","433":"Purchase Better Logging to increase the number of trees chopped at once.","434":"Click to instantly collect from all animals.","435":"Click to instantly chop multiple trees and collect wood.","436":"You have no animals to collect from.","437":"You have no trees to chop.","438":"Remove Crop","439":"Crop returned.","440":"Started ","441":"\u231b\ufe0f Ready in ","442":"\ud83c\udfe0 House repairs complete!","450":"\u274c Cannot afford crafting costs","451":"\u26a0\ufe0f Crafting already in progress","452":"\u274c Failed to start crafting.","453":"\u274c Failed to repair house.","454":"\u274c Failed to hire worker.","455":" has arrived!","456":"No more workers available.","457":"Ready!","458":"Time: ","459":"Instant","460":"Requires: ","461":"Costs: ","462":"Gives: ","463":"Heals: ","464":"Purchase Bulk Crafting to collect from ready crafting stations all at once.","465":"Click to instantly collect from all ready crafting stations.","466":"You have no crafting stations ready to collect from.","467":"Bulk Crafting","468":"Restarted: ","469":"Collected","470":"Cannot travel right now, farming actions in progress.","471":"\u26a0\ufe0f Already in progress.","472":"Harvested","475":"Restart?","476":"Station","477":"Your farm workers are busy...","478":"\ud83c\udf31 Working","479":"Logging complete","480":"Crafted","481":"with","482":"applied","483":"replanted","490":"Sell for refund (Dev only)","500":"COMBAT STRINGS","501":"\ud83c\udfaf Out of range.","502":"\ud83c\udfaf Hit!","503":"\u274c Miss","504":"\ud83d\udc80 Killed","505":"\u26a0\ufe0f Error","510":"\u2764\ufe0f\u200d\ud83e\ude79 You\'re taking damage ...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Your Health: ","512":"Your Health Unavailable","600":"RELATIONSHIP STRINGS:","601":"Relationship:","602":"You\'ve met","603":"You\'re now friends with","604":"You have a crush on","605":"You\'re in love with","606":"You and","607":"are now married.","608":"are now rivals.","609":"is now your rival because of this.","610":"isn\'t going to be very happy about this...","611":"aren\'t going to be very happy about this...","612":"will be very happy about this.","613":"approve of this.","614":"and","615":"Your relationship with","616":"has changed.","620":"You need to move closer to interact with this character.","621":"for being married.","622":"for being friends.","623":"for being in love.","630":"Greet","631":"Talk","632":"Trade","633":"Quest","634":"Met","635":"Friend","636":"Married","637":"Rival","638":"Love","639":"Crush","640":"Joke","641":"Make Friends","642":"Insult","643":"Hug","644":"Kiss","645":"Apologize","646":"Give Gift","647":"Compliment","648":"Flatter","649":"Profess Love","650":"Propose","651":"Taunt","652":"Tease","653":"End Marriage","700":"FTUE STRINGS:","701":"\ud83d\udc78 Welcome to Valley View","702":"Welcome, traveler! You\'ve arrived in Valley View, a frontier land of opportunity, mystery and adventure.","705":"Aspiration","706":"Valley View is a big world. It\'s up to you how you want to spend your time. Which of these aspirations best suits your style of play? (This choice will not limit your options in any way.)","721":"\ud83e\udd20 Meet Kent the Farm Manager","722":"First things first! Harvest some \ud83c\udf3e Wheat and sell it at the \ud83d\udce5 Trading Post for \ud83d\udcb0 Money.","723":"\ud83c\udf31 Get Farming","724":"Well done, you\'re making money now, so start Farming! Plant crops using the \ud83c\udf31 Farming panel, harvest them, and sell.","727":"\ud83d\udc75\ud83c\udffb Hire the Shepherd","728":"Nice work! Now hire the \ud83d\udc75\ud83c\udffb Shepherd from the \ud83c\udfe0 Farm House, and she\'ll help bring some \ud83d\udc2e animal life to the farm, so you can continue to expand your business.","729":"\ud83d\udc2e Animal Husbandry","730":"Welcome \ud83d\udc75\ud83c\udffb Shepherd! Now visit the \ud83d\udc2e Animal Panel to acquire a cow. Cows need \ud83d\udfe9 grass to graze, so place them carefully. And you already have your first \ud83d\udfeb Animal Stall; this is where you can produce milk once the cow is full.","731":"\u26cf\ufe0f Shape the Land","732":"Crops need dirt. Cows and sheep need \ud83d\udfe9 grass. Pavement can help contain the movements of people and animals. Use the \u26cf\ufe0f Tools to pave the land to your liking, and learn the  \ud83e\ude93 axe skill to chop trees for wood.","733":"\u2692\ufe0f Builder","734":"You\'ve mastered the \ud83e\ude93 axe -- excellent! Wood is useful for a number of things, including building crafting stations. You can also chop your way to the \ud83d\ude82 Train Station at the edge of your Homestead, where you can eventually travel into Town.","737":"Time to Explore","738":"Your Homestead is part of a larger Settlement of other players sharing a large Frontier. Zoom out (+ and -) to see the whole Settlement and Frontier. Use \u27a1\ufe0f Signposts to travel, or walk to the edge of any map. ENJOY PLAYING VALLEY VIEW!","750":"\ud83c\udf31 Farmer","751":"Cultivate your homestead, grow crops, tend animals, and craft goods to sell and trade with other players. Invest in farming and crafting skills to grow your profits.","752":"\u2694\ufe0f Adventurer","753":"Venture into the Valley for resources and rare items. Fight animals and creatures, uncover hidden locations, and meet magical characters. Invest in combat skills to become a formidable fighter.","754":"\ud83c\udfdb\ufe0f Politician","755":"Run for Mayor, set the tax rate, and earn tax revenue for your self. Invest in community buildings for the whole Town, like Hospitals, Schools, and Libraries, and help your settlement thrive.","795":"Skip Tutorial","796":"OK","797":"Back","798":"Play","800":"MORE CRAFTING STATION STRINGS:","801":"Acquire the ","802":" Skill at the ","803":" to increase the output of this station by ","805":"Your ","806":" Skill increases the base output of this station by ","810":"You can also purchase this skill directly: ","820":"Makes: ","821":"Base Amount: ","825":"You have ","826":"Scrolls.","827":"Scroll","899":"DEBUG STRINGS:","900":"Debug: Inventory cleared.","901":"Debug: Quest history cleared.","902":"Debug: Resources added.","903":"Debug: Grid successfully reset.","904":"Debug: Skills added.","905":"Debug: Skills & Powers cleared.","906":"Debug: Combat Stats reset.","999":"PANEL UI STRINGS:","1000":"[Description needed]","1001":"Resources collected at the homestead go into the warehouse. Resources collected in town or in the valley will go into the backpack. To buy a backpack, visit the Store in town. To empty the backpack or warehouse, use the Manage buttons.","1002":"Build crafting stations on your Homestead using resources from your warehouse.","1003":"Purchased animals will appear at your player icon, and immediately begin life on the homestead.","1004":"Till land to dirt in order to plant crops. Plant grass to give farm animals something to graze on.","1005":"Acquire Skills and Upgrades to improve various attributes. Make sure to explore the Town to find additional places and ways to gain Skills and Upgrades.","1006":"Manage your ongoing To Do list here. Look for quest-giving characters on your homestead as well as Town, or even the Valley.","1007":"Governments in Valley View are formed at the settlement level. The elected mayor implements policies and builds buildings to help the community thrive.","1008":"Buy and sell with other players. If no players buy your items before the timer expires, sell them to the game for a fraction of their base value.","1009":"[Crafting description]","1010":"[Mailbox description]","1011":"This Animal Stall is empty. Make sure animals have grass to eat, and they will eventually come to the stall for harvesting.","1012":"Elections take place in the Courthouse. Here, Mayors have the power to set the tax rate and rename the Settlement.","1013":" ","1014":" ","1015":"The game takes place over the course of continually changing seasons.","1016":" ","1017":"Visit the Bank to exchange items for Money, including rare items like Gold and Silver. Return to the bank regulalry for different offers.","1018":"","1019":"[Profile description]","1021":"\xa9 Valley View Studios, 2025, All Rights Reserved.","1022":"[Train description]","1023":"Workers help you run your homestead. Hire them at the Farm House.","1024":"[Combat description]","1025":"[Shop description]","1026":"Earning and spending Money.","1027":"These are the benefits of a Gold Pass.","1028":"[Decorations panel description]","1029":"[Animal panel]","1030":"[Crop panel]","1031":"Buy decorations for your homesetead. You will be able to sell these for a full refund.","1032":"The Farm House is where you can hire people to help you run your homestead.","1033":"Terraform the land with these tools. Animals need grass for grazing, crops need dirt to grow on. Pavement can be useful for controlling movements of animals and characters.","1034":"Earning and spending Gems.","1035":"This is your collection of lifetime Trophies.","1036":"Reveal mysterious scrolls at this Ancient Temple.","1101":"Inventory","1102":"\u2692\ufe0f Build","1103":"\ud83d\uded2 Buy","1104":"\ud83c\udf31 Farming","1105":"\ud83d\udcaa Skills","1106":"\u2705 To Do List","1107":"\ud83c\udfdb\ufe0f Government","1108":"\ud83d\udce5 Trade","1109":"Crafting","1110":"\ud83d\udcea Mailbox","1111":"\ud83d\udc3e Animals","1112":"\ud83c\udfdb\ufe0f Courthouse","1113":"Helper Character","1114":"\ud83d\ude00 Player Character","1115":"\ud83d\uddd3\ufe0f Season","1116":"\ud83d\udd01 Trader","1117":"\ud83c\udfe6 Bank","1118":"\ud83d\udd79\ufe0f How to Play","1119":"\ud83d\ude00 Profile","1120":"\ud83d\udc1e Debug","1121":"\ud83d\ude00 Welcome","1122":"\ud83d\ude82 Train","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Farm Hand","1124":"\u2694\ufe0f Combat","1125":"\ud83d\uded2 Shop","1126":"\ud83d\udcb0 About Money","1127":"\u2b50\ufe0f Gold Pass","1128":"\ud83e\udeb4 Decorations","1129":"\ud83d\udc3e Animals","1130":"\ud83c\udf31 Crops & Trees","1131":"\ud83e\udeb4 Decorations","1132":"\ud83c\udfe0 Farm House","1133":"\u26cf\ufe0f Tools","1134":"\ud83d\udc8e Gems","1135":"\ud83c\udfc6 Trophies","1136":"\ud83d\uded5 Ancient Temple","1200":"TRADER STORY STRINGS","1201":"Ah, the forest hides many secrets\u2026 and I? I\u2019ve stolen a few. These Gems, they\u2019re not mine, but Titania has more than she needs. You\u2019ve something I crave: Olive Bread, warm and rich. Trade with me, and I might whisper tales of glowing eyes in the dark, wings that shimmer at moonrise, and dragons that speak in riddles. Keep an ear open, and a dagger close.","1202":"My bounty is as boundless as the sea, my love as deep... but he is gone, and all that remains is a portrait and pain. Angelo took both. Bring me Romeo\u2019s likeness, torn from my chamber, and I\u2019ll give you Tulips red as the blood spilt on Verona\u2019s stones. Let this be our new balcony: you below, bearing justice.","1203":"Give me life, give me love, but most of all... give me Port! In exchange, a sprig of Feverfew, dearer than gold to some, especially that wide-eyed Helena. Says she\u2019s after crowns and legends, poor girl. Me? I\u2019m after a full belly and a gentle nap. \u2018Thou art so fat-witted with drinking of old sack,\u2019 they once told me. Ha! They were not wrong.","1204":"Here\u2019s rosemary, for remembrance\u2014and nightshade, for regrets. My potions are not for the faint of will. With the right leaf, I can mend your limbs or muddle your tongue. \u2018I do remember an apothecary,\u2019 said a boy once, and he paid the price. But you? You look wiser. Bring me rare roots and bitter seeds, and I\u2019ll mix you something worth the danger.","1205":"Something is rotten, still. I feel it in the soil. I once ruled, loved, lost. Helena burned through me like summer lightning. And Leontes? He could not forgive the thaw. \u2018The lady doth protest too much,\u2019 they said; let them. If you see Helena, tell her the roses know her name. If you see Leontes, tell him I have not forgotten the winter.","1206":"My grief is a statue; silent, but never still. I buried my crown in snow the day Gertrude chose her garden over me. \u2018Exit, pursued by a bear\u2019? No, I fled myself. Now I wait, among stone and silence. Bring me what was once mine, the King\u2019s Crown, and I\u2019ll pay in Gold, more than the weight of memory. But beware: some thrones carry curses.","1207":"This bridge is mine, by Sycorax my mother.\u2019 Prospero tried to steal it with spells and smiles. They called me beast, but I am of earth and storm, born to wild truth. I trade bones for Silver, tokens of the dead for coin of the living. Touch nothing lightly in these woods. Bring me what others fear, and I shall make you rich... or haunted.","1208":"","1301":"Skills to purchase:","1302":"Upgrades to purchase:","1303":"Skills you have:","1304":"Upgrades you have:","1305":"You have no skills yet.","1306":"You have no upgrades yet.","1400":"MODAL STRINGS","1401":"BANK MODAL","1402":"These offers good for","1403":"Will buy","1404":"for","1405":"No offers available.","1406":"New offers in","1407":"Generating new orders. Thank you for your patience.","1408":"\u26a0\ufe0f You don\'t have enough items.","1409":"\u26a0\ufe0f You don\'t have enough skills.","1410":"\u26a0\ufe0f You don\'t have enough upgrades.","1500":"TOWN NEWS STRINGS:","1501":"News for ","1502":"The current Mayor is","1503":", and the tax rate is","1504":"Here\'s what\'s happening in Town right now:","1505":"It\'s election season, and campaigning is in full swing. Stop by the Courthouse in Town to run for Mayor.","1506":"Voting for the next Mayor has begun. Cast your vote at the Courthouse in Town.","1507":"The Train is arriving, offering to buy:","1508":"The Train is departing. When it returns, it will be buying:","1509":"The Train is here, offering to buy:","1510":" ","1511":"Visit the Bank to sell gold, silver, and diamonds. The Bank is currently updating its offers.","1512":"There is currently no mayor. ","1513":"The Train is departing in","1514":"When it returns, it will be buying:","1515":"The tax rate is","1516":"The Bank is currently buying:","1517":"The Train will be departing in","1518":"The votes in the latest election for Mayor are being counted. Results expected in ","1600":"MAILBOX STRINGS:","1601":"Loading messages...","1602":"You have no messages.","1603":"Received","1604":"Collect","1605":"Most messages will be deleted afer 14 days. Store purchases will not be deleted.","1606":"\ud83d\udcea Mailbox","1607":"\ud83d\uddd1\ufe0f Message deleted.","1700":"STORE STRINGS:","1701":"\ud83d\uded2 Store","1702":"Purchases will be delivered to the Inbox.","1703":"\ud83d\ude4f Thank you for your support! We are a tiny developer with few resources, but passionate about creating a fun space for a positive community.","1704":"Please consider making purchases so we can continue to improve the game.","2000":"TRAIN, BANK, COURTHOUSE, etc. STRINGS:","2002":"Completed","2003":"\ud83d\ude82 Next Shipment Preview:","2004":"\ud83c\udf81 Rewards for filling all orders (sent to all who complete at least one order):","2005":"Click to fulfill","2006":"Your Order","2007":"Claimed","2008":"Claim Order","2009":"Claimed by you:","2010":"Available to claim:","2011":"Claimed by others:","2012":"Completed:","2013":"Claimed by you:","2014":"You can only claim one train offer at a time.","2015":"Show Train Log","2016":"\ud83c\udf89 All orders were completed! Rewards have been mailed out.","2017":"This order has already been claimed.","2020":"Train is","2030":"Offers Update in","2040":"Welcome, Mayor.","2041":"\ud83d\udcb0 Tax Rate: ","2042":"Proposed: ","2043":"Update","2044":"\u26a0\ufe0f Only the Mayor can set the tax rate.","2045":"\ud83d\uddf3\ufe0f Elections","2046":"Current Phase:","2047":"Phase Timer:","2048":"\ud83d\udce2 Campaign Promises","2060":"Voting begins in:","2061":"Voting ends in:","2062":"Voting has ended. Results announced in:","2063":"Next campaign begins in:","2070":"\ud83d\udce2 Campaign Promises","2071":"No one has made a campaign promise yet.","2072":"Enter your campaign promise (max 200 characters)...","2073":"Submit Campaign Promise","2074":"Cast Your Vote","2075":"No candidates available for voting.","2076":"Campaign promise:","2077":"You have already voted in this election.","2078":"There were no candidates.","2079":"How\'s your Mayor doing?","2080":"Welcome, Mayor.","2081":"Enter settlement name...","2082":"Your Settlement:","2083":"Update Name","2084":"Visit the \ud83c\udfdb\ufe0f Government Panel to view stats on how the settlement is doing, to help guide your election decision.","2085":"Current Mayor:","2090":"\ud83c\udfe4 Community Buildings","2092":"\ud83c\udfeb Schools: ","2093":"\ud83c\udfeb No Schools built yet.","2094":"\ud83c\udfe5 Hospitals: ","2095":"\ud83c\udfe5 No Hospitals built yet.","2096":"\ud83d\udc3e Animal Yards: ","2097":"\ud83d\udc3e No Animal Yards built yet.","2098":"\ud83c\udfe4 Libraries: ","2099":"\ud83c\udfe4 No Libraries built yet.","3000":"GOV PANEL:","3001":"Your Settlement:","3002":"\ud83d\ude0a Pop.","3003":"\ud83d\udcb0 Tax Rate:","3004":"The tax rate is set by the Mayor, for this Settlement, and a percentage of all taxes collected are added to the Mayor\'s bank account.","3005":"Mayors are elected at the Courthouse in Town.","3006":"\ud83c\udfdb\ufe0f Government Officials","3007":"No government officials elected yet.","3009":"Only the Mayor can build Schools, Hospitals and Libraries in the Town.","3010":"\ud83c\udfeb Schools give citizens access to certain Skills that cannot be gained elsewhere.","3011":"\ud83c\udfe5 Hospitals supply Doctors, who can heal adventurers returning from the Valley.","3012":"\ud83c\udfe4 Libraries are a source of Books, which are vital to Adventurers looking to learn new skills.","3013":"\ud83d\ude82 The Mayor can influence demand for goods at the Train.","3020":"View Tax Log","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"SEASON PANEL STRINGS","3051":"(Net worth is recalculated twice per day.)","3052":"No data available for top citizens.","3053":"It\'s","3054":"Loading...","3055":"Season ends in:","3056":"We are in between seasons.","3057":"At the end of the season, bonus rewards will be sent to the top players in the Frontier, as well as to all players in the top Settlement.","3058":"\ud83c\udfc6 Top Citizens in the Frontier","3059":"\ud83c\udfd9\ufe0f Leading Settlement","3060":"Total Wealth:","3061":"Population:","3062":"Unknown","3063":"No data available","3064":"View Season Log","4000":"LOGIN PANEL:","4001":"Don\'t have a profile? Create a new free profile to start playing:","4002":"New Profile","4003":"Username","4004":"You will not be asked for an email address.","4005":"With your own profile, you\'ll be granted your own homestead to cultivate in a Settlement with other players, in a Frontier full of Settlements. Adventure awaits you in the Valley.","4006":"Password","4007":"Login","4008":"Username","4009":"Login to your profile to continue playing. If you don\'t have an","4010":"Already have a profile?","4050":"PROFILE PANEL:","4051":"Hi, ","4052":"Change Username:","4053":"Change Password:","4054":"Profile Management","4055":"Profile Status:","4056":"Logout","4057":"Delete Your Profile","4058":"Player ID:","4059":"Homestead Relocation","4060":"Relocations Remaining:","4061":"Visit the Store to purchase more Relocations.","4062":"Settings","4063":"Language:","4064":"Range Indicator:","4065":"Change Avatar","4066":"Back to Login","4067":"Select Language","5000":"MORE MODAL STRINGS:","5001":"\ud83d\udc80 You have died.","5002":"You have been returned home. Any backpack \ud83c\udf92 items you had were lost.","5003":"Be more careful next time.","5005":"\ud83d\ude00 Welcome to Valley View\u2122","5006":"Please login, or create a free profile.","5007":"\xa9 Valley View Studios, 2025, All Rights Reserved.","5010":"\ud83d\udce8 Inbox","5011":"You have no messages","5015":"\ud83d\uded2 Store","5016":"Purchases will be delivered to the Inbox. We are unable to offer returns. All purchases are final.","5017":"Be aware that most inventory items are wiped between seasons, so please check the season clock before purchasing, and see the seasons panel for more information.","5020":"\ud83d\udeab You are currently logged out.","5021":"Click the Login or Create Profile button to begin.","5025":"\ud83d\ude4f Thank you for your support!","5026":"Your purchase has been delivered to your Inbox.","5027":"Enjoy Valley View!","5030":"\ud83d\ude00 Welcome to Valley View!","5031":"No player is logged in or the server is offline.","5032":"Please refresh the page, check your internet connetion, or return later.","5035":"We are between seasons!","5036":"Valley View is temporarily unavailable while we reset the season.","5040":"\ud83d\udcf0 Town News","5041":"Here\'s what\'s happening in Town right now:","5045":"Use ","5046":"Do you want to use a","5047":"You have ","5050":"\u26a0\ufe0f Confirm Homestead Move","5051":"Are you sure you want to move your homestead? This cannot be undone.","5052":"Close this dialog to cancel.","5060":"\u2b50\ufe0f Congratulations!","5061":"You now have a Gold Pass. Go to your Profile panel to customize your player icon, and discover other Gold benefits.","5062":"Thank you for your support!","5100":"Recent Tax Collections","5101":"No tax collection history available yet.","5102":"\ud83d\uddd3\ufe0f Date","5103":"\ud83d\udcb0 Total Collected","5104":"Mayor","5105":"\ud83d\udcb0 Mayor Take","5110":"","6000":"TROPHY STRINGS:","6001":"Here are your lifetime Trophies:","6002":"You have no trophies yet. Earn trophies for achievements throughout the game.","6003":"Trophy Earned!","7000":"NOTIFICAITION STRINGS:","7001":"Tip:","7005":"Use A-W-S-D or the Arrow Keys to Move.","7006":"Look for the \ud83d\udcaa icon to open the Skills panel.","7007":"Stand on grass, then find the \ud83d\udc2e Buy panel to purchase a cow. You\'ll first need the Husbandry skill.","7009":"Keep checking your \u2705 To-Do-List, and keep checking with \ud83e\udd20 Kent and \ud83d\udc75\ud83c\udffb the Shepherd.","7015":"Click + and - at the top of the screen to zoom in and out.","8999":"HOW TO PLAY STRINGS:","9000":"Welcome to Valley View!","9001":"What\u2019s it about?","9002":"Valley view is a game that explores how people might self organize and create micro societies in a world of asymmetric resources and interdependence, with both owned and shared spaces.","9003":"While there are no explicit specialization paths, there are three main vectors of play which are interdependent. These are: the FARMER, the ADVENTURER, and the POLITICIAN. You are encouraged to lean upon each other.","9004":"First, the basics:","9005":"Use A-W-S-D keys to MOVE. Click to interact with things that are within your interaction radius.","9006":"Explore \ud83c\udf31 FARMING, \u2692\ufe0f BUILD, and \ud83d\udc2e BUY to improve your Homestead and generate resources.","9007":"Generate \ud83d\udcb0 MONEY at the \ud83d\udce5 TRADING POST. Post resources for sale to other players, or sell them to the game for partial value.","9008":"More:","9009":"As you create wealth, improve yourself with SKILLS and ABILITIES. For example, purchase the \ud83d\udc34 HORSERIDING SKILL to venture into the Valley.","9010":"Zoom out (- and +) to see how big the world is. Your Homestead is one of many in a SETTLEMENT. Each SETTLEMENT has a shared TOWN. Your Settlement is one of many in the FRONTIER.","9011":"When you are ready, explore the VALLEY, which is full of danger and wonders. The secrets of the wizard PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f and the lost king LEONTES \ud83e\udd34, among others, can be found in the Valley.","9012":"Your Goals:","9013":"Feel free to create your own goals. Also, at the end of each \ud83d\uddd3\ufe0f SEASON, which runs three months, both individuals and settlements will be ranked, and top placement generates additional wealth. Your homsestead, all of your skills, and some of your wealth will carry over into the next Season.","9014":"Farm, craft, trade, explore, fight, and enjoy!","9020":"How to Earn Money","9021":"There are a few ways to make \ud83d\udcb0 MONEY.","9022":"As you are getting started, open the \ud83d\udce5 TRADING POST, which you will find in the upper left corner of your Homestead. Here, you can sell goods, including crops and crafts.","9023":"The \ud83d\udce5 TRADING POST will buy goods from you at 25% of their value. To maximize your earnings, you should trade with other players. They will have things you need, and vice versa.","9024":"As you advance, you\'ll be able to travel into TOWN using the \ud83c\udfdb\ufe0f SIGNPOST next to the TRAIN. There, you will find places like the BANK, which will buy specific items from you at a premium.","9025":"Spending Money","9026":"Surprise, most things cost Money. Initially, you will want to spend money on \ud83d\udcaa SKILLS, \ud83d\udc2e FARM ANIMALS, and \u2692\ufe0f CRAFTING STATIONS. Explore the panels at the left side of the screen. These will help you generate more resources, which in turn will help you earn more Money.","9027":"In TOWN you will disocver more Shops and Traders.","9030":"How to Earn Gems","9031":"Gems are a rare resource that can be used to purchase various things to help accelerate your play.","9032":"You can purchase Gems in the Store, or by clicking here:","9033":"On rare occassions, Gems can be found in the Valley, or earned as rewards for crushing it with the Train, or finishing strong at the end of a Season.","9040":"No Brainer:","9041":"100 \ud83d\udc8e Gems for ","9042":"Best Value:","9043":"500 \ud83d\udc8e Gems for ","9044":"Most Popular:","9045":"1000 \ud83d\udc8e Gems for ","9050":"Benefits","9051":"A Gold Pass gives you access to premium features and benefits in Valley View for the duration of a season.","9052":"With a Gold Pass, you can enjoy the following benefits:","9053":"\u2705 Premium avatars: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 Near unlimited Warehouse capacity","9055":"\u2705 Near unlimited Backpack capacity","9056":"\u2705 2 additional Trade Stall slots","9057":"\u2705 Lower Tax rate","9058":"\u2705 Half your MaxHP restored on death","9059":"\u2705 You can run for office","9060":"Thank you for your Gold Pass purchase.","9061":"Purchase a Gold Pass","9999":"ERROR STRINGS:","10000":"\ud83d\udd0c Server is Down","10001":"The server is currently down. We apologize for the inconvencient, please check back soon.","10002":"(This message will disappear when the server is back up.)","10100":"APP.JS STRINGS:","10101":"Welcome to Valley View!","10102":"Please login, or create a free profile.","10103":"\ud83c\udf92 Inventory","10104":"\ud83d\uded2 Store","10105":"\ud83d\udce8, Inbox","10106":"\ud83d\udce2 Share","10107":"\ud83d\udcac Chat","10108":"You Have a Gold Pass","10109":"\u2194\ufe0f Move Keys: ","10110":"\ud83d\udd79\ufe0f How to Play","10111":"You are the Mayor","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Health: ","10113":"\ud83d\uddd3\ufe0f It\'s","10114":"Next Season starts in:","10115":"\ud83d\uddd3\ufe0f Next Season:","10116":"\ud83c\udfdb\ufe0f Happening Now in Town:","10117":"\ud83d\udcb0 Next Tax Collection:","10118":"In: ","10119":"Now collecting taxes...","10120":"\ud83c\udfdb\ufe0f Elections: ","10121":"Ends: ","10122":"\ud83d\ude82 Train: ","10123":"\ud83c\udfe6 Bank: ","10124":"New Offers: ","10125":"Read the News!","10126":"Who\'s here:","10127":"No PCs present in the grid.","10128":"Save Changes","10129":"","10130":"You Have a Gold Pass","10131":"Gold Pass Benefits","10132":"Cancel Relocation","10133":"Relocate Homestead","11000":"ADDED STRINGS:","11001":"Wait for the timer to end, or for another player to buy this item.","12001":"Farming","12002":"Build","12003":"Animals","12004":"To Do List","12005":"Skills","12006":"Combat","12007":"Government","12008":"Seasons","12009":"Home","12010":"Profile","12011":"Decorations","12012":"Tools","12013":"Trophies","15000":"\ud83d\uddd3\ufe0f Season Rules","15001":"Seasons last three months.","15002":"Rewards","15003":"\ud83d\udcb0 Net worth will be calculated based on your money, inventory items, and items on your homestead.","15004":"\ud83c\udfc6 The top 3 players across the frontier will have rewards sent to your mailbox, and also earn a \u201cSeason Winner\u201d trophy.","15005":"\ud83c\udfc6 The top player in the frontier will also earn the \u201cSeason Champion\u201d trophy.","15006":"\ud83c\udf81 All players in the top settlement will receive additional rewards in your mailbox.","15007":"Resetting Players and Locations","15008":"\ud83c\udfe0 You will be relocated back to your homestead if you are away from home when the season ends.","15009":"\ud83c\udfe0 Your homesteads will NOT reset \u2013 all layout, tiles and resources carry over.","15010":"\ud83c\udf92 Your inventory WILL be wiped, with the exception of rare items like Prospero\u2019s Orb, King\u2019s Crown, Golden & Skeleton Keys, Trident).","15011":"\ud83d\udc8e You will keep all Gems.","15012":"\ud83d\udcb0 Money will be nerfed to 10% of the current amount (25% for Gold Pass holders).","15013":"\u2705 All quests will be wiped.","15014":"\ud83d\udcaa Your skills & powers carry over.","15015":"\u2764\ufe0f Your relationships carry over.","15016":"\u2b50\ufe0f Your Gold Pass status will be revoked for the new season.","15017":"\ud83c\udf32 All town and valley grids will be reset with fresh tiles, resources and enemies.","15018":"What Changes?","15019":"\ud83c\udf83 Towns will have tiles and resources according to the new season content.","15020":"\ud83d\ude00 New players joining (and creating new homesteads) will get starter tiles and resources according to the new season content.","15021":"\ud83d\ude82 Train orders are affected by the seasons.","15022":"\ud83c\udfc6 New rewards and trophies can be earned.","30000":"TROPHIES:","30001":"First Farm Worker","30002":"Skill Builder","30003":"Trains Completed","30004":"Season Winner","30005":"Season Champion","200000":"RESOURCES","200009":"Gold Account","200010":"Money","200011":"Stub","200012":"Signpost N","200013":"Signpost E","200014":"Signpost S","200015":"Signpost W","200016":"Signpost NW","200017":"Signpost NE","200018":"Signpost SE","200019":"Signpost SW","200020":"Signpost Town","200021":"Signpost Home","200022":"Trade Stall","200023":"Trading Post","200024":"Warehouse","200025":"Abandoned House","200026":"Farm House","200027":"Repair","200028":"Mountain","200029":"Mountain Large","200030":"Bank","200031":"Courthouse","200032":"Train","200033":"Mailbox","200034":"Oak Tree","200035":"Pine Tree","200036":"Palm Tree","200037":"Holiday Tree","200038":"Snowman","200039":"Rocks","200040":"Clay Pit","200041":"Wood","200042":"Stone","200043":"Clay","200044":"Wheat Plot","200045":"Carrot Plot","200046":"Corn Plot","200047":"Sugarcane Plot","200048":"Strawberry Plot","200049":"Apple Tree","200050":"Lemon Tree","200051":"Grape Vine","200052":"Garlic Plot","200053":"Olive Tree","200054":"Tomato Vine","200055":"Oak Tree Plot","200056":"Wheat","200057":"Carrot","200058":"Corn","200059":"Sugarcane","200060":"Strawberry","200061":"Apple","200062":"Lemon","200063":"Grapes","200064":"Garlic","200065":"Olive","200066":"Tomato","200067":"Blueberry","200068":"Milk","200069":"Wool","200070":"Egg","200071":"Flour","200072":"Chicken Feed","200073":"Sugar","200074":"Cornmeal","200075":"Lumber","200076":"Butter","200077":"Cream","200078":"Cheese","200079":"Thread","200080":"Cloth","200081":"Sweater","200082":"Jacket","200083":"Heavy Jacket","200084":"Runic Tunic","200085":"Bread","200086":"Cornbread","200087":"Apple Pie","200088":"Strawberry Pie","200089":"Lemon Cookie","200090":"Olive Bread","200091":"Garlic Bread","200092":"Queen\'s Cake","200093":"Tomato Soup","200094":"Carrot Soup","200095":"Omelette","200096":"Pizza","200097":"Honey","200098":"Apple Cider","200099":"Wine","200100":"Port","200101":"Olive Oil","200102":"Aged Wine","200103":"Pottery","200104":"Furniture","200105":"Ink","200106":"Urns","200107":"Rosemary","200108":"Mushroom","200109":"Magic Mushroom","200110":"Daisy","200111":"Tulip","200112":"Sunflower","200113":"Feverfew","200114":"Potion A","200115":"Potion B","200116":"Potion C","200117":"Gem","200118":"Book","200119":"Pelt","200120":"Bear Skin","200121":"Bones","200122":"Silver","200123":"Gold","200124":"Diamond Ring","200125":"King\'s Crown","200126":"Portrait","200127":"Trident","200128":"Skeleton Key","200129":"Golden Key","200130":"Scroll","200131":"Prospero\'s Orb","200132":"Tent","200133":"Boat","200134":"Shrine","200135":"Castle","200136":"Restaurant","200137":"Restroom","200138":"General Store","200139":"Warrior\'s Den","200140":"Magic Shop","200141":"Ancient Temple","200142":"Adventure Camp","200143":"Laboratory","200144":"School","200145":"Animal Stall","200146":"Mill","200147":"Dairy","200148":"Chicken Coop","200149":"Lumber Yard","200150":"Loom","200151":"Oven","200152":"Kitchen","200153":"Beehive","200154":"Studio","200155":"Winery","200156":"Library","200157":"Animal Yard","200158":"Hospital","200159":"Cow","200160":"Sheep","200161":"Brown Cow","200162":"Doctor","200163":"Surgeon","200164":"Fairy","200165":"Kent","200166":"Portia","200167":"The Shepherd","200168":"Hotspur","200169":"Cassio","200170":"Mistress Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampire","200175":"Santa Claus","200176":"Prospero","200177":"Falstaff","200178":"Apothecary","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Juliet","200184":"Mermaid","200185":"Farmer","200186":"Farm Hand","200187":"Rancher","200188":"Lumberjack","200189":"Coyote","200190":"Bear","200191":"Spider","200192":"Zombie","200193":"Duke Angelo","200194":"Ghost","200195":"Ogre","200196":"Demon","200197":"Dragon","200198":"Coyote Spawner","200199":"Bear Spawner","200200":"Spider Spawner","200201":"Zombie Spawner","200202":"Ghost Spawner","200203":"Demon Spawner","200204":"Dragon Spawner","200205":"Grower","200206":"Green Thumb","200207":"Husbandry","200208":"Bulk Animal Collect","200209":"Axe","200210":"Pickaxe","200211":"Builder","200212":"Bulk Harvest","200213":"Bulk Replant","200214":"Logging","200215":"Better Logging","200216":"Bulk Crafting","200217":"Bulk Restart Craft","200218":"Better Axe","200219":"Better Pickaxe","200220":"Storehouse","200221":"Depot","200222":"TBD Storage 3","200223":"TBD Storage 4","200224":"Masonry","200225":"Mechanics","200226":"Textiles","200227":"Artistry","200228":"Beekeeper","200229":"Tailor","200230":"Politics","200231":"Education","200232":"Chemistry","200233":"Cooking","200234":"Creamery","200235":"Baker","200236":"Winemaker","200237":"Miller","200238":"Artisan","200239":"Cuisinier","200240":"Weaver","200241":"Fowler","200242":"Fromager","200243":"Virtuose Culinaire","200244":"Apiarch","200245":"Vintner","200246":"Law","200247":"Medicine","200248":"Surgery","200249":"Backpack","200250":"Rucksack","200251":"Enchanted Pack","200252":"Horse","200253":"Tracking","200254":"Scout","200255":"Padding","200256":"Light Armor","200257":"Chainmail","200258":"Plate Armor","200259":"Heavy Armor","200260":"Mystic Armor","200261":"Caliban\'s Breastplate","200262":"Blessed Veil","200263":"Magic Helmet","200264":"Magic Gloves","200265":"Boots of Protection","200266":"Knife","200267":"Short Sword","200268":"Long Sword","200269":"Great Sword","200270":"Halberd","200271":"Sword of Song","200272":"Magic Halberd","200273":"Glowing Sword","200274":"Giant Axe","200275":"Legendary Sword","200276":"Dragonslayer","200277":"Darts","200278":"Short Bow","200279":"Long Bow","200280":"Spear","200281":"Crossbow","200282":"Magic Spear","200283":"Magic Crossbow","200284":"Titania\'s Bow","200285":"Legendary Crossbow","200286":"Tempest","200287":"Maelstrom","200288":"Oblivion","200289":"Titan","200290":"Jab","200291":"Flurry","200292":"Barrage","200293":"Steady Hand","200294":"Pinpoint","200295":"Unerring","200296":"Focus","200297":"Precision","200298":"Horizon Eye","200299":"Fortitude","200300":"Stoneheart","200301":"Unbreakable","200500":"Crate","200501":"Stone Wall","200502":"Stone Wall Large","200503":"Green Wall","200504":"Black Wall","200505":"Sand Wall","200506":"Blue Wall","200507":"Orange Wall","200508":"Plant","200509":"Cactus","200510":"Harp","200511":"Flag","200512":"Stack of Books","200513":"Chair","200514":"Toilet","200515":"Bed","200516":"Teddy Bear","200517":"Big Hole","200518":"Slide","200519":"Fountain","200520":"Fountain Large","200521":"Large Decorative Palm Tree","hp":"Hit Points","maxhp":"Max Hit Points","range":"Range","attackrange":"Attack Range","attackbonus":"Attack Bonus","damage":"Damage","speed":"Attack Speed","iscamping":"Is Camping","armorclass":"Armor Class","backpackCapacity":"Backpack Capacity","warehouseCapacity":"Warehouse Capacity"}'),d=JSON.parse('{"0":"Valley View","1":"Server is not running.","3":"\ud83c\udf31 Land successfully tilled.","4":"\u26a0\ufe0f You don\'t have enough resources.","5":"\u2692\ufe0f Construction completed successfully.","6":"\ud83d\udcb0 Items sold.","7":"\ud83c\udfe0 This homsetead is unoccupied.","8":"\ud83d\udeab This area is off limits.","9":"The Valley is full of wonders, and must be explored on foot.","10":"\ud83c\udfe0 [username]\'s homestead.","11":"\ud83c\udfe0 Unknown owner\'s homestead.","12":"Settlement view. Depending on your location, you may need to scroll to see the Town.","13":"Frontier view.","14":"\ud83c\udfdb\ufe0f Welcome to town.","15":"\ud83d\udc34 You need a Horse to travel here. Visit the Adventure Camp in Town.","16":"You\'re in the valley.","17":"You do not own a hometead here.","18":"\ud83d\udeab You can\'t go that way.","19":"\ud83c\udf92 You need a Backpack to collect resources away from your homestead. Buy one at the Adventure Camp.","20":"\ud83d\udeab Not enough room in the Warehouse.","21":"\ud83c\udf92 Not enough room in the Backpack. Open Inventory to manage Backpack contents.","22":"Items purchased.","23":"\u26a0\ufe0f You can\'t build that here.","24":"\ud83c\udfaf Out of range","25":"\ud83c\udf92 Nothing in the Backpack.","26":"\ud83c\udf92 You must be at your homestead to empty your Backpack.","27":"\u26fa\ufe0f You don\'t have a tent.","28":"\u26fa\ufe0f You are now camping.","29":"\u26a0\ufe0f \u26fa\ufe0f Failed to camp / decamp.","30":"\u26fa\ufe0f No longer camping.","31":"\u26fa\ufe0f Cannot attack while camping.","32":"\u26fa\ufe0f You need to decamp first.","33":"\ud83d\udce6 Moved items to the Warehouse.","34":"\ud83c\udf92 Emptied backpack.","35":"You need a ","36":"You used a ","50":"\ud83d\udeab That username is already taken.","70":"Session Expired","71":"You\'ve been away for a while. Refreshing ensures your session works properly.","72":"This page will auto-refresh in 30 seconds unless you do it now.","73":"\ud83d\udd04 Refresh Now","74":"\ud83c\udf92 A Backpack is required to own a Tent.","75":"You do not own a Backpack. You can purchase one at the Adventure Camp in Town.","76":"Your Warehouse is empty.","77":"Your Backpack is empty.","78":"Manage Contents","80":"Acquired ","90":"\ud83d\udeab This is not your homestead.","91":"\ud83d\udc34 Horse required.","94":"\ud83d\udce2 Share Valley View!","95":"Invite others to help out and join the adventure!","96":"Have Feedback?","97":"@ Email Us","98":"\u23f3 Loading ...","99":"\u26a0\ufe0f Something went wrong.","100":"TRAVELING STRINGS:","101":"\ud83d\udc34 Traveling home ... please wait.","102":"\ud83d\udc34 Traveling to town ... please wait.","103":"\ud83d\udc34 Traveling to the next location ... please wait.","104":"\ud83d\udeab No town in this settlement yet.","105":"\u26a0\ufe0f There was a problem trying to travel.","106":"\ud83d\udeab You cannot travel beyond the frontier.","110":"\u27a1\ufe0f Walk onto Signposts to use them","111":"Welcome to town.","112":"Welcome home.","120":"You don\'t have any homestead moves left.","121":"You have successfully moved your homestead.","122":"You cannot move to the valley!","123":"You cannot move to the town!","124":"That homestead is occupied.","125":"Where are you moving to?","130":"Select your language:","131":"Confirm","140":"TRADE STALL STRINGS:","141":"Sold","151":"You cannot fill another player\'s trade stall.","152":"You do not have enough money to buy this item.","153":"is selling:","154":"are selling","155":"Transaction failed. This item has already been sold.","156":"Click to sell","157":"Bought by","158":" limit per order.","159":"Ready to sell","160":"Items to Sell","161":"Item","162":"Available","163":"Price","164":"Amount","165":"All","166":"Add","167":"Sell","168":"Yes, Sell All","169":"Buy","170":"Unlocked trading slot","171":"Gold Pass Required","172":"Locked","173":"Limit of","174":"to Sell","175":"Unlock for","176":"Wood","177":"Need","178":"to unlock this slot","179":"This Outpost only accepts items from your backpack. Any player can collect money from an Outpost.","180":"INVENTORY STRINGS:","181":"\ud83d\udce6 Warehouse","182":"\ud83c\udf92 Backpack","183":"Capacity: ","184":"Manage Contents","185":"Quantity","186":"Amount","187":"Add to Warehouse","188":"Discard","189":"Add All to Warehouse","190":"Discard All","191":"Item","192":"Action","193":"Discard Items","194":"Expand Warehouse","195":"Expand Backpack at the Adventure Camp in Town.","199":"Near unlimited capacity with Gold Pass (among other benefits).","200":"QUESTS","201":"\u2705 Action item completed. You have your reward.","202":"\u2705 Action item accepted.","203":"No action items at the moment.","204":"To Do List:","205":"Nothing new at this time. Check your \u2705 To Do list!","206":"Return to the NPC who gave you this quest to collect your reward.","207":"In Progress","208":"Get Reward","209":"Accept","299":"FARMING STRINGS:","300":"Added","301":"\ud83c\udf31 Tilled","302":"\ud83c\udf31 Planted","303":"\ud83c\udf31 Must plant on dirt","304":"\ud83c\udf31 Can\'t plant here","305":"\u26a0\ufe0f Not enough resources","306":"\u26a0\ufe0f Can\'t build here","310":"You need to till the land for planting.","311":"Your farm animals will need plenty of grass to graze on.","312":"Pavement can be useful to control wandering animals.","313":"","315":"Select Crops to Harvest:","316":"Select All","317":"Deselect All","318":"Collect","319":"Select Animals to Collect:","320":"Cannot terraform here.","340":"Not avilable unless you\'re on foot.","341":"Select Crafting Stations to Collect:","342":"Harvest?","343":"Replant?","344":"No crops ready to harvest.","345":"Ready to Collect:","346":"Collect?","347":"Buy 1 for: ","350":"The Farm Hand will help you automate harvesting and planting of crops.","351":"The Rancher will help you automate collecting from animals.","352":"The Lumberjack will help you automate chopping trees for wood.","353":"The Crafter will help you automate collecting from crafting stations.","354":"Kent is your Farm Manager. He can help you run your homestead.","355":"The Shepherd will guide you in the management of your farm animals.","400":"BUYING, CRAFTING, SKILLS, HEALING, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Already at maximum hit points.","402":"\u26a0\ufe0f  resources.","403":"\u26a0\ufe0f Youre inventory is full.","404":"Working...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Hit Points healed by +","410":"\ud83c\udfd5\ufe0f To use a purchased tent, click on your own player icon.","420":"will trade you:","421":"Used In:","422":"Base Value:","423":"No trades available.","424":"No recipes available.","425":"Sell for refund","426":"Expensive starter crops, but in case you run out:","427":"Purchase the Farm Hand\'s Bulk Harvest skill to harvest all crops at once.","428":"Click to instantly harvest all crops.","429":"You have no crops to harvest.","430":"Purchase these farm skills:","431":"Purchase the Farm Hand\'s Bulk Animal Collect skill to collect from all animals at once.","432":"Purchase the Farm Hand\'s Logging skill to chop multiple trees at once and collect the wood.","433":"Purchase Better Logging to increase the number of trees chopped at once.","434":"Click to instantly collect from all animals.","435":"Click to instantly chop multiple trees and collect wood.","436":"You have no animals to collect from.","437":"You have no trees to chop.","438":"Remove Crop","439":"Crop returned.","440":"Started ","441":"\u231b\ufe0f Ready in ","442":"\ud83c\udfe0 House repairs complete!","450":"\u274c Cannot afford crafting costs","451":"\u26a0\ufe0f Crafting already in progress","452":"\u274c Failed to start crafting.","453":"\u274c Failed to repair house.","454":"\u274c Failed to hire worker.","455":" has arrived!","456":"No more workers available.","457":"Ready!","458":"Time: ","459":"Instant","460":"Requires: ","461":"Costs: ","462":"Gives: ","463":"Heals: ","464":"Purchase Bulk Crafting to collect from ready crafting stations all at once.","465":"Click to instantly collect from all ready crafting stations.","466":"You have no crafting stations ready to collect from.","467":"Bulk Crafting","468":"Restarted: ","469":"Collected","470":"Cannot travel right now, farming actions in progress.","471":"\u26a0\ufe0f Already in progress.","472":"Harvested","475":"Restart?","476":"Station","477":"Your farm workers are busy...","478":"\ud83c\udf31 Working","479":"Logging complete","480":"Crafted","481":"with","482":"applied","483":"replanted","490":"Sell for refund (Dev only)","500":"COMBAT STRINGS","501":"\ud83c\udfaf Out of range.","502":"\ud83c\udfaf Hit!","503":"\u274c Miss","504":"\ud83d\udc80 Killed","505":"\u26a0\ufe0f Error","510":"\u2764\ufe0f\u200d\ud83e\ude79 You\'re taking damage ...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Your Health: ","512":"Your Health Unavailable","600":"RELATIONSHIP STRINGS:","601":"Relationship:","602":"You\'ve met","603":"You\'re now friends with","604":"You have a crush on","605":"You\'re in love with","606":"You and","607":"are now married.","608":"are now rivals.","609":"is now your rival because of this.","610":"isn\'t going to be very happy about this...","611":"aren\'t going to be very happy about this...","612":"will be very happy about this.","613":"approve of this.","614":"and","615":"Your relationship with","616":"has changed.","620":"You need to move closer to interact with this character.","621":"for being married.","622":"for being friends.","623":"for being in love.","630":"Greet","631":"Talk","632":"Trade","633":"Quest","634":"Met","635":"Friend","636":"Married","637":"Rival","638":"Love","639":"Crush","640":"Joke","641":"Make Friends","642":"Insult","643":"Hug","644":"Kiss","645":"Apologize","646":"Give Gift","647":"Compliment","648":"Flatter","649":"Profess Love","650":"Propose","651":"Taunt","652":"Tease","653":"End Marriage","700":"FTUE STRINGS:","701":"\ud83d\udc78 Welcome to Valley View","702":"Welcome, traveler! You\'ve arrived in Valley View, a frontier land of opportunity, mystery and adventure.","705":"Aspiration","706":"Valley View is a big world. It\'s up to you how you want to spend your time. Which of these aspirations best suits your style of play? (This choice will not limit your options in any way.)","721":"\ud83e\udd20 Meet Kent the Farm Manager","722":"First things first! Harvest some \ud83c\udf3e Wheat and sell it at the \ud83d\udce5 Trading Post for \ud83d\udcb0 Money.","723":"\ud83c\udf31 Get Farming","724":"Well done, you\'re making money now, so start Farming! Plant crops using the \ud83c\udf31 Farming panel, harvest them, and sell.","727":"\ud83d\udc75\ud83c\udffb Hire the Shepherd","728":"Nice work! Now hire the \ud83d\udc75\ud83c\udffb Shepherd from the \ud83c\udfe0 Farm House, and she\'ll help bring some \ud83d\udc2e animal life to the farm, so you can continue to expand your business.","729":"\ud83d\udc2e Animal Husbandry","730":"Welcome \ud83d\udc75\ud83c\udffb Shepherd! Now visit the \ud83d\udc2e Animal Panel to acquire a cow. Cows need \ud83d\udfe9 grass to graze, so place them carefully. And you already have your first \ud83d\udfeb Animal Stall; this is where you can produce milk once the cow is full.","731":"\u26cf\ufe0f Shape the Land","732":"Crops need dirt. Cows and sheep need \ud83d\udfe9 grass. Pavement can help contain the movements of people and animals. Use the \u26cf\ufe0f Tools to pave the land to your liking, and learn the  \ud83e\ude93 axe skill to chop trees for wood.","733":"\u2692\ufe0f Builder","734":"You\'ve mastered the \ud83e\ude93 axe -- excellent! Wood is useful for a number of things, including building crafting stations. You can also chop your way to the \ud83d\ude82 Train Station at the edge of your Homestead, where you can eventually travel into Town.","737":"Time to Explore","738":"Your Homestead is part of a larger Settlement of other players sharing a large Frontier. Zoom out (+ and -) to see the whole Settlement and Frontier. Use \u27a1\ufe0f Signposts to travel, or walk to the edge of any map. ENJOY PLAYING VALLEY VIEW!","750":"\ud83c\udf31 Farmer","751":"Cultivate your homestead, grow crops, tend animals, and craft goods to sell and trade with other players. Invest in farming and crafting skills to grow your profits.","752":"\u2694\ufe0f Adventurer","753":"Venture into the Valley for resources and rare items. Fight animals and creatures, uncover hidden locations, and meet magical characters. Invest in combat skills to become a formidable fighter.","754":"\ud83c\udfdb\ufe0f Politician","755":"Run for Mayor, set the tax rate, and earn tax revenue for your self. Invest in community buildings for the whole Town, like Hospitals, Schools, and Libraries, and help your settlement thrive.","795":"Skip Tutorial","796":"OK","797":"Back","798":"Play","800":"MORE CRAFTING STATION STRINGS:","801":"Acquire the ","802":" Skill at the ","803":" to increase the output of this station by ","805":"Your ","806":" Skill increases the base output of this station by ","810":"You can also purchase this skill directly: ","820":"Makes: ","821":"Base Amount: ","825":"You have ","826":"Scrolls.","827":"Scroll","899":"DEBUG STRINGS:","900":"Debug: Inventory cleared.","901":"Debug: Quest history cleared.","902":"Debug: Resources added.","903":"Debug: Grid successfully reset.","904":"Debug: Skills added.","905":"Debug: Skills & Powers cleared.","906":"Debug: Combat Stats reset.","999":"PANEL UI STRINGS:","1000":"[Description needed]","1001":"Resources collected at the homestead go into the warehouse. Resources collected in town or in the valley will go into the backpack. To buy a backpack, visit the Store in town. To empty the backpack or warehouse, use the Manage buttons.","1002":"Build crafting stations on your Homestead using resources from your warehouse.","1003":"Purchased animals will appear at your player icon, and immediately begin life on the homestead.","1004":"Till land to dirt in order to plant crops. Plant grass to give farm animals something to graze on.","1005":"Acquire Skills and Upgrades to improve various attributes. Make sure to explore the Town to find additional places and ways to gain Skills and Upgrades.","1006":"Manage your ongoing To Do list here. Look for quest-giving characters on your homestead as well as Town, or even the Valley.","1007":"Governments in Valley View are formed at the settlement level. The elected mayor implements policies and builds buildings to help the community thrive.","1008":"Buy and sell with other players. If no players buy your items before the timer expires, sell them to the game for a fraction of their base value.","1009":"[Crafting description]","1010":"[Mailbox description]","1011":"This Animal Stall is empty. Make sure animals have grass to eat, and they will eventually come to the stall for harvesting.","1012":"Elections take place in the Courthouse. Here, Mayors have the power to set the tax rate and rename the Settlement.","1013":" ","1014":" ","1015":"The game takes place over the course of continually changing seasons.","1016":" ","1017":"Visit the Bank to exchange items for Money, including rare items like Gold and Silver. Return to the bank regulalry for different offers.","1018":"","1019":"[Profile description]","1021":"\xa9 Valley View Studios, 2025, All Rights Reserved.","1022":"[Train description]","1023":"Workers help you run your homestead. Hire them at the Farm House.","1024":"[Combat description]","1025":"[Shop description]","1026":"Earning and spending Money.","1027":"These are the benefits of a Gold Pass.","1028":"[Decorations panel description]","1029":"[Animal panel]","1030":"[Crop panel]","1031":"Buy decorations for your homesetead. You will be able to sell these for a full refund.","1032":"The Farm House is where you can hire people to help you run your homestead.","1033":"Terraform the land with these tools. Animals need grass for grazing, crops need dirt to grow on. Pavement can be useful for controlling movements of animals and characters.","1034":"Earning and spending Gems.","1035":"This is your collection of lifetime Trophies.","1036":"Reveal mysterious scrolls at this Ancient Temple.","1101":"Inventory","1102":"\u2692\ufe0f Build","1103":"\ud83d\uded2 Buy","1104":"\ud83c\udf31 Farming","1105":"\ud83d\udcaa Skills","1106":"\u2705 To Do List","1107":"\ud83c\udfdb\ufe0f Government","1108":"\ud83d\udce5 Trade","1109":"Crafting","1110":"\ud83d\udcea Mailbox","1111":"\ud83d\udc3e Animals","1112":"\ud83c\udfdb\ufe0f Courthouse","1113":"Helper Character","1114":"\ud83d\ude00 Player Character","1115":"\ud83d\uddd3\ufe0f Season","1116":"\ud83d\udd01 Trader","1117":"\ud83c\udfe6 Bank","1118":"\ud83d\udd79\ufe0f How to Play","1119":"\ud83d\ude00 Profile","1120":"\ud83d\udc1e Debug","1121":"\ud83d\ude00 Welcome","1122":"\ud83d\ude82 Train","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Farm Hand","1124":"\u2694\ufe0f Combat","1125":"\ud83d\uded2 Shop","1126":"\ud83d\udcb0 About Money","1127":"\u2b50\ufe0f Gold Pass","1128":"\ud83e\udeb4 Decorations","1129":"\ud83d\udc3e Animals","1130":"\ud83c\udf31 Crops & Trees","1131":"\ud83e\udeb4 Decorations","1132":"\ud83c\udfe0 Farm House","1133":"\u26cf\ufe0f Tools","1134":"\ud83d\udc8e Gems","1135":"\ud83c\udfc6 Trophies","1136":"\ud83d\uded5 Ancient Temple","1200":"TRADER STORY STRINGS","1201":"Ah, the forest hides many secrets\u2026 and I? I\u2019ve stolen a few. These Gems, they\u2019re not mine, but Titania has more than she needs. You\u2019ve something I crave: Olive Bread, warm and rich. Trade with me, and I might whisper tales of glowing eyes in the dark, wings that shimmer at moonrise, and dragons that speak in riddles. Keep an ear open, and a dagger close.","1202":"My bounty is as boundless as the sea, my love as deep... but he is gone, and all that remains is a portrait and pain. Angelo took both. Bring me Romeo\u2019s likeness, torn from my chamber, and I\u2019ll give you Tulips red as the blood spilt on Verona\u2019s stones. Let this be our new balcony: you below, bearing justice.","1203":"Give me life, give me love, but most of all... give me Port! In exchange, a sprig of Feverfew, dearer than gold to some, especially that wide-eyed Helena. Says she\u2019s after crowns and legends, poor girl. Me? I\u2019m after a full belly and a gentle nap. \u2018Thou art so fat-witted with drinking of old sack,\u2019 they once told me. Ha! They were not wrong.","1204":"Here\u2019s rosemary, for remembrance\u2014and nightshade, for regrets. My potions are not for the faint of will. With the right leaf, I can mend your limbs or muddle your tongue. \u2018I do remember an apothecary,\u2019 said a boy once, and he paid the price. But you? You look wiser. Bring me rare roots and bitter seeds, and I\u2019ll mix you something worth the danger.","1205":"Something is rotten, still. I feel it in the soil. I once ruled, loved, lost. Helena burned through me like summer lightning. And Leontes? He could not forgive the thaw. \u2018The lady doth protest too much,\u2019 they said; let them. If you see Helena, tell her the roses know her name. If you see Leontes, tell him I have not forgotten the winter.","1206":"My grief is a statue; silent, but never still. I buried my crown in snow the day Gertrude chose her garden over me. \u2018Exit, pursued by a bear\u2019? No, I fled myself. Now I wait, among stone and silence. Bring me what was once mine, the King\u2019s Crown, and I\u2019ll pay in Gold, more than the weight of memory. But beware: some thrones carry curses.","1207":"This bridge is mine, by Sycorax my mother.\u2019 Prospero tried to steal it with spells and smiles. They called me beast, but I am of earth and storm, born to wild truth. I trade bones for Silver, tokens of the dead for coin of the living. Touch nothing lightly in these woods. Bring me what others fear, and I shall make you rich... or haunted.","1208":"","1301":"Skills to purchase:","1302":"Upgrades to purchase:","1303":"Skills you have:","1304":"Upgrades you have:","1305":"You have no skills yet.","1306":"You have no upgrades yet.","1400":"MODAL STRINGS","1401":"BANK MODAL","1402":"These offers good for","1403":"Will buy","1404":"for","1405":"No offers available.","1406":"New offers in","1407":"Generating new orders. Thank you for your patience.","1408":"\u26a0\ufe0f You don\'t have enough items.","1409":"\u26a0\ufe0f You don\'t have enough skills.","1410":"\u26a0\ufe0f You don\'t have enough upgrades.","1500":"TOWN NEWS STRINGS:","1501":"News for ","1502":"The current Mayor is","1503":", and the tax rate is","1504":"Here\'s what\'s happening in Town right now:","1505":"It\'s election season, and campaigning is in full swing. Stop by the Courthouse in Town to run for Mayor.","1506":"Voting for the next Mayor has begun. Cast your vote at the Courthouse in Town.","1507":"The Train is arriving, offering to buy:","1508":"The Train is departing. When it returns, it will be buying:","1509":"The Train is here, offering to buy:","1510":" ","1511":"Visit the Bank to sell gold, silver, and diamonds. The Bank is currently updating its offers.","1512":"There is currently no mayor. ","1513":"The Train is departing in","1514":"When it returns, it will be buying:","1515":"The tax rate is","1516":"The Bank is currently buying:","1517":"The Train will be departing in","1518":"The votes in the latest election for Mayor are being counted. Results expected in ","1600":"MAILBOX STRINGS:","1601":"Loading messages...","1602":"You have no messages.","1603":"Received","1604":"Collect","1605":"Most messages will be deleted afer 14 days. Store purchases will not be deleted.","1606":"\ud83d\udcea Mailbox","1607":"\ud83d\uddd1\ufe0f Message deleted.","1700":"STORE STRINGS:","1701":"\ud83d\uded2 Store","1702":"Purchases will be delivered to the Inbox.","1703":"\ud83d\ude4f Thank you for your support! We are a tiny developer with few resources, but passionate about creating a fun space for a positive community.","1704":"Please consider making purchases so we can continue to improve the game.","2000":"TRAIN, BANK, COURTHOUSE, etc. STRINGS:","2002":"Completed","2003":"\ud83d\ude82 Next Shipment Preview:","2004":"\ud83c\udf81 Rewards for filling all orders (sent to all who complete at least one order):","2005":"Click to fulfill","2006":"Your Order","2007":"Claimed","2008":"Claim Order","2009":"Claimed by you:","2010":"Available to claim:","2011":"Claimed by others:","2012":"Completed:","2013":"Claimed by you:","2014":"You can only claim one train offer at a time.","2015":"Show Train Log","2016":"\ud83c\udf89 All orders were completed! Rewards have been mailed out.","2017":"This order has already been claimed.","2020":"Train is","2030":"Offers Update in","2040":"Welcome, Mayor.","2041":"\ud83d\udcb0 Tax Rate: ","2042":"Proposed: ","2043":"Update","2044":"\u26a0\ufe0f Only the Mayor can set the tax rate.","2045":"\ud83d\uddf3\ufe0f Elections","2046":"Current Phase:","2047":"Phase Timer:","2048":"\ud83d\udce2 Campaign Promises","2060":"Voting begins in:","2061":"Voting ends in:","2062":"Voting has ended. Results announced in:","2063":"Next campaign begins in:","2070":"\ud83d\udce2 Campaign Promises","2071":"No one has made a campaign promise yet.","2072":"Enter your campaign promise (max 200 characters)...","2073":"Submit Campaign Promise","2074":"Cast Your Vote","2075":"No candidates available for voting.","2076":"Campaign promise:","2077":"You have already voted in this election.","2078":"There were no candidates.","2079":"How\'s your Mayor doing?","2080":"Welcome, Mayor.","2081":"Enter settlement name...","2082":"Your Settlement:","2083":"Update Name","2084":"Visit the \ud83c\udfdb\ufe0f Government Panel to view stats on how the settlement is doing, to help guide your election decision.","2085":"Current Mayor:","2090":"\ud83c\udfe4 Community Buildings","2092":"\ud83c\udfeb Schools: ","2093":"\ud83c\udfeb No Schools built yet.","2094":"\ud83c\udfe5 Hospitals: ","2095":"\ud83c\udfe5 No Hospitals built yet.","2096":"\ud83d\udc3e Animal Yards: ","2097":"\ud83d\udc3e No Animal Yards built yet.","2098":"\ud83c\udfe4 Libraries: ","2099":"\ud83c\udfe4 No Libraries built yet.","3000":"GOV PANEL:","3001":"Your Settlement:","3002":"\ud83d\ude0a Pop.","3003":"\ud83d\udcb0 Tax Rate:","3004":"The tax rate is set by the Mayor, for this Settlement, and a percentage of all taxes collected are added to the Mayor\'s bank account.","3005":"Mayors are elected at the Courthouse in Town.","3006":"\ud83c\udfdb\ufe0f Government Officials","3007":"No government officials elected yet.","3009":"Only the Mayor can build Schools, Hospitals and Libraries in the Town.","3010":"\ud83c\udfeb Schools give citizens access to certain Skills that cannot be gained elsewhere.","3011":"\ud83c\udfe5 Hospitals supply Doctors, who can heal adventurers returning from the Valley.","3012":"\ud83c\udfe4 Libraries are a source of Books, which are vital to Adventurers looking to learn new skills.","3013":"\ud83d\ude82 The Mayor can influence demand for goods at the Train.","3020":"View Tax Log","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"SEASON PANEL STRINGS","3051":"(Net worth is recalculated twice per day.)","3052":"No data available for top citizens.","3053":"It\'s","3054":"Loading...","3055":"Season ends in:","3056":"We are in between seasons.","3057":"At the end of the season, bonus rewards will be sent to the top players in the Frontier, as well as to all players in the top Settlement.","3058":"\ud83c\udfc6 Top Citizens in the Frontier","3059":"\ud83c\udfd9\ufe0f Leading Settlement","3060":"Total Wealth:","3061":"Population:","3062":"Unknown","3063":"No data available","3064":"View Season Log","4000":"LOGIN PANEL:","4001":"Don\'t have a profile? Create a new free profile to start playing:","4002":"New Profile","4003":"Username","4004":"You will not be asked for an email address.","4005":"With your own profile, you\'ll be granted your own homestead to cultivate in a Settlement with other players, in a Frontier full of Settlements. Adventure awaits you in the Valley.","4006":"Password","4007":"Login","4008":"Username","4009":"Login to your profile to continue playing. If you don\'t have an","4010":"Already have a profile?","4050":"PROFILE PANEL:","4051":"Hi, ","4052":"Change Username:","4053":"Change Password:","4054":"Profile Management","4055":"Profile Status:","4056":"Logout","4057":"Delete Your Profile","4058":"Player ID:","4059":"Homestead Relocation","4060":"Relocations Remaining:","4061":"Visit the Store to purchase more Relocations.","4062":"Settings","4063":"Language:","4064":"Range Indicator:","4065":"Change Avatar","4066":"Back to Login","4067":"Select Language","5000":"MORE MODAL STRINGS:","5001":"\ud83d\udc80 You have died.","5002":"You have been returned home. Any backpack \ud83c\udf92 items you had were lost.","5003":"Be more careful next time.","5005":"\ud83d\ude00 Welcome to Valley View\u2122","5006":"Please login, or create a free profile.","5007":"\xa9 Valley View Studios, 2025, All Rights Reserved.","5010":"\ud83d\udce8 Inbox","5011":"You have no messages","5015":"\ud83d\uded2 Store","5016":"Purchases will be delivered to the Inbox. We are unable to offer returns. All purchases are final.","5017":"Be aware that most inventory items are wiped between seasons, so please check the season clock before purchasing, and see the seasons panel for more information.","5020":"\ud83d\udeab You are currently logged out.","5021":"Click the Login or Create Profile button to begin.","5025":"\ud83d\ude4f Thank you for your support!","5026":"Your purchase has been delivered to your Inbox.","5027":"Enjoy Valley View!","5030":"\ud83d\ude00 Welcome to Valley View!","5031":"No player is logged in or the server is offline.","5032":"Please refresh the page, check your internet connetion, or return later.","5035":"We are between seasons!","5036":"Valley View is temporarily unavailable while we reset the season.","5040":"\ud83d\udcf0 Town News","5041":"Here\'s what\'s happening in Town right now:","5045":"Use ","5046":"Do you want to use a","5047":"You have ","5050":"\u26a0\ufe0f Confirm Homestead Move","5051":"Are you sure you want to move your homestead? This cannot be undone.","5052":"Close this dialog to cancel.","5060":"\u2b50\ufe0f Congratulations!","5061":"You now have a Gold Pass. Go to your Profile panel to customize your player icon, and discover other Gold benefits.","5062":"Thank you for your support!","5100":"Recent Tax Collections","5101":"No tax collection history available yet.","5102":"\ud83d\uddd3\ufe0f Date","5103":"\ud83d\udcb0 Total Collected","5104":"Mayor","5105":"\ud83d\udcb0 Mayor Take","5110":"","6000":"TROPHY STRINGS:","6001":"Here are your lifetime Trophies:","6002":"You have no trophies yet. Earn trophies for achievements throughout the game.","6003":"Trophy Earned!","7000":"NOTIFICAITION STRINGS:","7001":"Tip:","7005":"Use A-W-S-D or the Arrow Keys to Move.","7006":"Look for the \ud83d\udcaa icon to open the Skills panel.","7007":"Stand on grass, then find the \ud83d\udc2e Buy panel to purchase a cow. You\'ll first need the Husbandry skill.","7009":"Keep checking your \u2705 To-Do-List, and keep checking with \ud83e\udd20 Kent and \ud83d\udc75\ud83c\udffb the Shepherd.","7015":"Click + and - at the top of the screen to zoom in and out.","8999":"HOW TO PLAY STRINGS:","9000":"Welcome to Valley View!","9001":"What\u2019s it about?","9002":"Valley view is a game that explores how people might self organize and create micro societies in a world of asymmetric resources and interdependence, with both owned and shared spaces.","9003":"While there are no explicit specialization paths, there are three main vectors of play which are interdependent. These are: the FARMER, the ADVENTURER, and the POLITICIAN. You are encouraged to lean upon each other.","9004":"First, the basics:","9005":"Use A-W-S-D keys to MOVE. Click to interact with things that are within your interaction radius.","9006":"Explore \ud83c\udf31 FARMING, \u2692\ufe0f BUILD, and \ud83d\udc2e BUY to improve your Homestead and generate resources.","9007":"Generate \ud83d\udcb0 MONEY at the \ud83d\udce5 TRADING POST. Post resources for sale to other players, or sell them to the game for partial value.","9008":"More:","9009":"As you create wealth, improve yourself with SKILLS and ABILITIES. For example, purchase the \ud83d\udc34 HORSERIDING SKILL to venture into the Valley.","9010":"Zoom out (- and +) to see how big the world is. Your Homestead is one of many in a SETTLEMENT. Each SETTLEMENT has a shared TOWN. Your Settlement is one of many in the FRONTIER.","9011":"When you are ready, explore the VALLEY, which is full of danger and wonders. The secrets of the wizard PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f and the lost king LEONTES \ud83e\udd34, among others, can be found in the Valley.","9012":"Your Goals:","9013":"Feel free to create your own goals. Also, at the end of each \ud83d\uddd3\ufe0f SEASON, which runs three months, both individuals and settlements will be ranked, and top placement generates additional wealth. Your homsestead, all of your skills, and some of your wealth will carry over into the next Season.","9014":"Farm, craft, trade, explore, fight, and enjoy!","9020":"How to Earn Money","9021":"There are a few ways to make \ud83d\udcb0 MONEY.","9022":"As you are getting started, open the \ud83d\udce5 TRADING POST, which you will find in the upper left corner of your Homestead. Here, you can sell goods, including crops and crafts.","9023":"The \ud83d\udce5 TRADING POST will buy goods from you at 25% of their value. To maximize your earnings, you should trade with other players. They will have things you need, and vice versa.","9024":"As you advance, you\'ll be able to travel into TOWN using the \ud83c\udfdb\ufe0f SIGNPOST next to the TRAIN. There, you will find places like the BANK, which will buy specific items from you at a premium.","9025":"Spending Money","9026":"Surprise, most things cost Money. Initially, you will want to spend money on \ud83d\udcaa SKILLS, \ud83d\udc2e FARM ANIMALS, and \u2692\ufe0f CRAFTING STATIONS. Explore the panels at the left side of the screen. These will help you generate more resources, which in turn will help you earn more Money.","9027":"In TOWN you will disocver more Shops and Traders.","9030":"How to Earn Gems","9031":"Gems are a rare resource that can be used to purchase various things to help accelerate your play.","9032":"You can purchase Gems in the Store, or by clicking here:","9033":"On rare occassions, Gems can be found in the Valley, or earned as rewards for crushing it with the Train, or finishing strong at the end of a Season.","9040":"No Brainer:","9041":"100 \ud83d\udc8e Gems for ","9042":"Best Value:","9043":"500 \ud83d\udc8e Gems for ","9044":"Most Popular:","9045":"1000 \ud83d\udc8e Gems for ","9050":"Benefits","9051":"A Gold Pass gives you access to premium features and benefits in Valley View for the duration of a season.","9052":"With a Gold Pass, you can enjoy the following benefits:","9053":"\u2705 Premium avatars: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 Near unlimited Warehouse capacity","9055":"\u2705 Near unlimited Backpack capacity","9056":"\u2705 2 additional Trade Stall slots","9057":"\u2705 Lower Tax rate","9058":"\u2705 Half your MaxHP restored on death","9059":"\u2705 You can run for office","9060":"Thank you for your Gold Pass purchase.","9061":"Purchase a Gold Pass","9999":"ERROR STRINGS:","10000":"\ud83d\udd0c Server is Down","10001":"The server is currently down. We apologize for the inconvencient, please check back soon.","10002":"(This message will disappear when the server is back up.)","10100":"APP.JS STRINGS:","10101":"Welcome to Valley View!","10102":"Please login, or create a free profile.","10103":"\ud83c\udf92 Inventory","10104":"\ud83d\uded2 Store","10105":"\ud83d\udce8, Inbox","10106":"\ud83d\udce2 Share","10107":"\ud83d\udcac Chat","10108":"You Have a Gold Pass","10109":"\u2194\ufe0f Move Keys: ","10110":"\ud83d\udd79\ufe0f How to Play","10111":"You are the Mayor","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Health: ","10113":"\ud83d\uddd3\ufe0f It\'s","10114":"Next Season starts in:","10115":"\ud83d\uddd3\ufe0f Next Season:","10116":"\ud83c\udfdb\ufe0f Happening Now in Town:","10117":"\ud83d\udcb0 Next Tax Collection:","10118":"In: ","10119":"Now collecting taxes...","10120":"\ud83c\udfdb\ufe0f Elections: ","10121":"Ends: ","10122":"\ud83d\ude82 Train: ","10123":"\ud83c\udfe6 Bank: ","10124":"New Offers: ","10125":"Read the News!","10126":"Who\'s here:","10127":"No PCs present in the grid.","10128":"Save Changes","10129":"","10130":"You Have a Gold Pass","10131":"Gold Pass Benefits","10132":"Cancel Relocation","10133":"Relocate Homestead","11000":"ADDED STRINGS:","11001":"Wait for the timer to end, or for another player to buy this item.","12001":"Farming","12002":"Build","12003":"Animals","12004":"To Do List","12005":"Skills","12006":"Combat","12007":"Government","12008":"Seasons","12009":"Home","12010":"Profile","12011":"Decorations","12012":"Tools","12013":"Trophies","15000":"\ud83d\uddd3\ufe0f Season Rules","15001":"Seasons last three months.","15002":"Rewards","15003":"\ud83d\udcb0 Net worth will be calculated based on your money, inventory items, and items on your homestead.","15004":"\ud83c\udfc6 The top 3 players across the frontier will have rewards sent to your mailbox, and also earn a \u201cSeason Winner\u201d trophy.","15005":"\ud83c\udfc6 The top player in the frontier will also earn the \u201cSeason Champion\u201d trophy.","15006":"\ud83c\udf81 All players in the top settlement will receive additional rewards in your mailbox.","15007":"Resetting Players and Locations","15008":"\ud83c\udfe0 You will be relocated back to your homestead if you are away from home when the season ends.","15009":"\ud83c\udfe0 Your homesteads will NOT reset \u2013 all layout, tiles and resources carry over.","15010":"\ud83c\udf92 Your inventory WILL be wiped, with the exception of rare items like Prospero\u2019s Orb, King\u2019s Crown, Golden & Skeleton Keys, Trident).","15011":"\ud83d\udc8e You will keep all Gems.","15012":"\ud83d\udcb0 Money will be nerfed to 10% of the current amount (25% for Gold Pass holders).","15013":"\u2705 All quests will be wiped.","15014":"\ud83d\udcaa Your skills & powers carry over.","15015":"\u2764\ufe0f Your relationships carry over.","15016":"\u2b50\ufe0f Your Gold Pass status will be revoked for the new season.","15017":"\ud83c\udf32 All town and valley grids will be reset with fresh tiles, resources and enemies.","15018":"What Changes?","15019":"\ud83c\udf83 Towns will have tiles and resources according to the new season content.","15020":"\ud83d\ude00 New players joining (and creating new homesteads) will get starter tiles and resources according to the new season content.","15021":"\ud83d\ude82 Train orders are affected by the seasons.","15022":"\ud83c\udfc6 New rewards and trophies can be earned.","30000":"TROPHIES:","30001":"First Farm Worker","30002":"Skill Builder","30003":"Trains Completed","30004":"Season Winner","30005":"Season Champion","200000":"RESOURCES","200009":"Gold Account","200010":"Money","200011":"Stub","200012":"Signpost N","200013":"Signpost E","200014":"Signpost S","200015":"Signpost W","200016":"Signpost NW","200017":"Signpost NE","200018":"Signpost SE","200019":"Signpost SW","200020":"Signpost Town","200021":"Signpost Home","200022":"Trade Stall","200023":"Trading Post","200024":"Warehouse","200025":"Abandoned House","200026":"Farm House","200027":"Repair","200028":"Mountain","200029":"Mountain Large","200030":"Bank","200031":"Courthouse","200032":"Train","200033":"Mailbox","200034":"Oak Tree","200035":"Pine Tree","200036":"Palm Tree","200037":"Holiday Tree","200038":"Snowman","200039":"Rocks","200040":"Clay Pit","200041":"Wood","200042":"Stone","200043":"Clay","200044":"Wheat Plot","200045":"Carrot Plot","200046":"Corn Plot","200047":"Sugarcane Plot","200048":"Strawberry Plot","200049":"Apple Tree","200050":"Lemon Tree","200051":"Grape Vine","200052":"Garlic Plot","200053":"Olive Tree","200054":"Tomato Vine","200055":"Oak Tree Plot","200056":"Wheat","200057":"Carrot","200058":"Corn","200059":"Sugarcane","200060":"Strawberry","200061":"Apple","200062":"Lemon","200063":"Grapes","200064":"Garlic","200065":"Olive","200066":"Tomato","200067":"Blueberry","200068":"Milk","200069":"Wool","200070":"Egg","200071":"Flour","200072":"Chicken Feed","200073":"Sugar","200074":"Cornmeal","200075":"Lumber","200076":"Butter","200077":"Cream","200078":"Cheese","200079":"Thread","200080":"Cloth","200081":"Sweater","200082":"Jacket","200083":"Heavy Jacket","200084":"Runic Tunic","200085":"Bread","200086":"Cornbread","200087":"Apple Pie","200088":"Strawberry Pie","200089":"Lemon Cookie","200090":"Olive Bread","200091":"Garlic Bread","200092":"Queen\'s Cake","200093":"Tomato Soup","200094":"Carrot Soup","200095":"Omelette","200096":"Pizza","200097":"Honey","200098":"Apple Cider","200099":"Wine","200100":"Port","200101":"Olive Oil","200102":"Aged Wine","200103":"Pottery","200104":"Furniture","200105":"Ink","200106":"Urns","200107":"Rosemary","200108":"Mushroom","200109":"Magic Mushroom","200110":"Daisy","200111":"Tulip","200112":"Sunflower","200113":"Feverfew","200114":"Potion A","200115":"Potion B","200116":"Potion C","200117":"Gem","200118":"Book","200119":"Pelt","200120":"Bear Skin","200121":"Bones","200122":"Silver","200123":"Gold","200124":"Diamond Ring","200125":"King\'s Crown","200126":"Portrait","200127":"Trident","200128":"Skeleton Key","200129":"Golden Key","200130":"Scroll","200131":"Prospero\'s Orb","200132":"Tent","200133":"Boat","200134":"Shrine","200135":"Castle","200136":"Restaurant","200137":"Restroom","200138":"General Store","200139":"Warrior\'s Den","200140":"Magic Shop","200141":"Ancient Temple","200142":"Adventure Camp","200143":"Laboratory","200144":"School","200145":"Animal Stall","200146":"Mill","200147":"Dairy","200148":"Chicken Coop","200149":"Lumber Yard","200150":"Loom","200151":"Oven","200152":"Kitchen","200153":"Beehive","200154":"Studio","200155":"Winery","200156":"Library","200157":"Animal Yard","200158":"Hospital","200159":"Cow","200160":"Sheep","200161":"Brown Cow","200162":"Doctor","200163":"Surgeon","200164":"Fairy","200165":"Kent","200166":"Portia","200167":"The Shepherd","200168":"Hotspur","200169":"Cassio","200170":"Mistress Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampire","200175":"Santa Claus","200176":"Prospero","200177":"Falstaff","200178":"Apothecary","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Juliet","200184":"Mermaid","200185":"Farmer","200186":"Farm Hand","200187":"Rancher","200188":"Lumberjack","200189":"Coyote","200190":"Bear","200191":"Spider","200192":"Zombie","200193":"Duke Angelo","200194":"Ghost","200195":"Ogre","200196":"Demon","200197":"Dragon","200198":"Coyote Spawner","200199":"Bear Spawner","200200":"Spider Spawner","200201":"Zombie Spawner","200202":"Ghost Spawner","200203":"Demon Spawner","200204":"Dragon Spawner","200205":"Grower","200206":"Green Thumb","200207":"Husbandry","200208":"Bulk Animal Collect","200209":"Axe","200210":"Pickaxe","200211":"Builder","200212":"Bulk Harvest","200213":"Bulk Replant","200214":"Logging","200215":"Better Logging","200216":"Bulk Crafting","200217":"Bulk Restart Craft","200218":"Better Axe","200219":"Better Pickaxe","200220":"Storehouse","200221":"Depot","200222":"TBD Storage 3","200223":"TBD Storage 4","200224":"Masonry","200225":"Mechanics","200226":"Textiles","200227":"Artistry","200228":"Beekeeper","200229":"Tailor","200230":"Politics","200231":"Education","200232":"Chemistry","200233":"Cooking","200234":"Creamery","200235":"Baker","200236":"Winemaker","200237":"Miller","200238":"Artisan","200239":"Cuisinier","200240":"Weaver","200241":"Fowler","200242":"Fromager","200243":"Virtuose Culinaire","200244":"Apiarch","200245":"Vintner","200246":"Law","200247":"Medicine","200248":"Surgery","200249":"Backpack","200250":"Rucksack","200251":"Enchanted Pack","200252":"Horse","200253":"Tracking","200254":"Scout","200255":"Padding","200256":"Light Armor","200257":"Chainmail","200258":"Plate Armor","200259":"Heavy Armor","200260":"Mystic Armor","200261":"Caliban\'s Breastplate","200262":"Blessed Veil","200263":"Magic Helmet","200264":"Magic Gloves","200265":"Boots of Protection","200266":"Knife","200267":"Short Sword","200268":"Long Sword","200269":"Great Sword","200270":"Halberd","200271":"Sword of Song","200272":"Magic Halberd","200273":"Glowing Sword","200274":"Giant Axe","200275":"Legendary Sword","200276":"Dragonslayer","200277":"Darts","200278":"Short Bow","200279":"Long Bow","200280":"Spear","200281":"Crossbow","200282":"Magic Spear","200283":"Magic Crossbow","200284":"Titania\'s Bow","200285":"Legendary Crossbow","200286":"Tempest","200287":"Maelstrom","200288":"Oblivion","200289":"Titan","200290":"Jab","200291":"Flurry","200292":"Barrage","200293":"Steady Hand","200294":"Pinpoint","200295":"Unerring","200296":"Focus","200297":"Precision","200298":"Horizon Eye","200299":"Fortitude","200300":"Stoneheart","200301":"Unbreakable","200500":"Crate","200501":"Stone Wall","200502":"Stone Wall Large","200503":"Green Wall","200504":"Black Wall","200505":"Sand Wall","200506":"Blue Wall","200507":"Orange Wall","200508":"Plant","200509":"Cactus","200510":"Harp","200511":"Flag","200512":"Stack of Books","200513":"Chair","200514":"Toilet","200515":"Bed","200516":"Teddy Bear","200517":"Big Hole","200518":"Slide","200519":"Fountain","200520":"Fountain Large","200521":"Large Decorative Palm Tree","hp":"Hit Points","maxhp":"Max Hit Points","range":"Range","attackrange":"Attack Range","attackbonus":"Attack Bonus","damage":"Damage","speed":"Attack Speed","iscamping":"Is Camping","armorclass":"Armor Class","backpackCapacity":"Backpack Capacity","warehouseCapacity":"Warehouse Capacity"}'),u=JSON.parse('{"0":"Valley View","1":"Server is not running.","3":"\ud83c\udf31 Land successfully tilled.","4":"\u26a0\ufe0f You don\'t have enough resources.","5":"\u2692\ufe0f Construction completed successfully.","6":"\ud83d\udcb0 Items sold.","7":"\ud83c\udfe0 This homsetead is unoccupied.","8":"\ud83d\udeab This area is off limits.","9":"The Valley is full of wonders, and must be explored on foot.","10":"\ud83c\udfe0 [username]\'s homestead.","11":"\ud83c\udfe0 Unknown owner\'s homestead.","12":"Settlement view. Depending on your location, you may need to scroll to see the Town.","13":"Frontier view.","14":"\ud83c\udfdb\ufe0f Welcome to town.","15":"\ud83d\udc34 You need a Horse to travel here. Visit the Adventure Camp in Town.","16":"You\'re in the valley.","17":"You do not own a hometead here.","18":"\ud83d\udeab You can\'t go that way.","19":"\ud83c\udf92 You need a Backpack to collect resources away from your homestead. Buy one at the Adventure Camp.","20":"\ud83d\udeab Not enough room in the Warehouse.","21":"\ud83c\udf92 Not enough room in the Backpack. Open Inventory to manage Backpack contents.","22":"Items purchased.","23":"\u26a0\ufe0f You can\'t build that here.","24":"\ud83c\udfaf Out of range","25":"\ud83c\udf92 Nothing in the Backpack.","26":"\ud83c\udf92 You must be at your homestead to empty your Backpack.","27":"\u26fa\ufe0f You don\'t have a tent.","28":"\u26fa\ufe0f You are now camping.","29":"\u26a0\ufe0f \u26fa\ufe0f Failed to camp / decamp.","30":"\u26fa\ufe0f No longer camping.","31":"\u26fa\ufe0f Cannot attack while camping.","32":"\u26fa\ufe0f You need to decamp first.","33":"\ud83d\udce6 Moved items to the Warehouse.","34":"\ud83c\udf92 Emptied backpack.","35":"You need a ","36":"You used a ","50":"\ud83d\udeab That username is already taken.","70":"Session Expired","71":"You\'ve been away for a while. Refreshing ensures your session works properly.","72":"This page will auto-refresh in 30 seconds unless you do it now.","73":"\ud83d\udd04 Refresh Now","74":"\ud83c\udf92 A Backpack is required to own a Tent.","75":"You do not own a Backpack. You can purchase one at the Adventure Camp in Town.","76":"Your Warehouse is empty.","77":"Your Backpack is empty.","78":"Manage Contents","80":"Acquired ","90":"\ud83d\udeab This is not your homestead.","91":"\ud83d\udc34 Horse required.","94":"\ud83d\udce2 Share Valley View!","95":"Invite others to help out and join the adventure!","96":"Have Feedback?","97":"@ Email Us","98":"\u23f3 Loading ...","99":"\u26a0\ufe0f Something went wrong.","100":"TRAVELING STRINGS:","101":"\ud83d\udc34 Traveling home ... please wait.","102":"\ud83d\udc34 Traveling to town ... please wait.","103":"\ud83d\udc34 Traveling to the next location ... please wait.","104":"\ud83d\udeab No town in this settlement yet.","105":"\u26a0\ufe0f There was a problem trying to travel.","106":"\ud83d\udeab You cannot travel beyond the frontier.","110":"\u27a1\ufe0f Walk onto Signposts to use them","111":"Welcome to town.","112":"Welcome home.","120":"You don\'t have any homestead moves left.","121":"You have successfully moved your homestead.","122":"You cannot move to the valley!","123":"You cannot move to the town!","124":"That homestead is occupied.","125":"Where are you moving to?","130":"Select your language:","131":"Confirm","140":"TRADE STALL STRINGS:","141":"Sold","151":"You cannot fill another player\'s trade stall.","152":"You do not have enough money to buy this item.","153":"is selling:","154":"are selling","155":"Transaction failed. This item has already been sold.","156":"Click to sell","157":"Bought by","158":" limit per order.","159":"Ready to sell","160":"Items to Sell","161":"Item","162":"Available","163":"Price","164":"Amount","165":"All","166":"Add","167":"Sell","168":"Yes, Sell All","169":"Buy","170":"Unlocked trading slot","171":"Gold Pass Required","172":"Locked","173":"Limit of","174":"to Sell","175":"Unlock for","176":"Wood","177":"Need","178":"to unlock this slot","179":"This Outpost only accepts items from your backpack. Any player can collect money from an Outpost.","180":"INVENTORY STRINGS:","181":"\ud83d\udce6 Warehouse","182":"\ud83c\udf92 Backpack","183":"Capacity: ","184":"Manage Contents","185":"Quantity","186":"Amount","187":"Add to Warehouse","188":"Discard","189":"Add All to Warehouse","190":"Discard All","191":"Item","192":"Action","193":"Discard Items","194":"Expand Warehouse","195":"Expand Backpack at the Adventure Camp in Town.","199":"Near unlimited capacity with Gold Pass (among other benefits).","200":"QUESTS","201":"\u2705 Action item completed. You have your reward.","202":"\u2705 Action item accepted.","203":"No action items at the moment.","204":"To Do List:","205":"Nothing new at this time. Check your \u2705 To Do list!","206":"Return to the NPC who gave you this quest to collect your reward.","207":"In Progress","208":"Get Reward","209":"Accept","299":"FARMING STRINGS:","300":"Added","301":"\ud83c\udf31 Tilled","302":"\ud83c\udf31 Planted","303":"\ud83c\udf31 Must plant on dirt","304":"\ud83c\udf31 Can\'t plant here","305":"\u26a0\ufe0f Not enough resources","306":"\u26a0\ufe0f Can\'t build here","310":"You need to till the land for planting.","311":"Your farm animals will need plenty of grass to graze on.","312":"Pavement can be useful to control wandering animals.","313":"","315":"Select Crops to Harvest:","316":"Select All","317":"Deselect All","318":"Collect","319":"Select Animals to Collect:","320":"Cannot terraform here.","340":"Not avilable unless you\'re on foot.","341":"Select Crafting Stations to Collect:","342":"Harvest?","343":"Replant?","344":"No crops ready to harvest.","345":"Ready to Collect:","346":"Collect?","347":"Buy 1 for: ","350":"The Farm Hand will help you automate harvesting and planting of crops.","351":"The Rancher will help you automate collecting from animals.","352":"The Lumberjack will help you automate chopping trees for wood.","353":"The Crafter will help you automate collecting from crafting stations.","354":"Kent is your Farm Manager. He can help you run your homestead.","355":"The Shepherd will guide you in the management of your farm animals.","400":"BUYING, CRAFTING, SKILLS, HEALING, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Already at maximum hit points.","402":"\u26a0\ufe0f  resources.","403":"\u26a0\ufe0f Youre inventory is full.","404":"Working...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Hit Points healed by +","410":"\ud83c\udfd5\ufe0f To use a purchased tent, click on your own player icon.","420":"will trade you:","421":"Used In:","422":"Base Value:","423":"No trades available.","424":"No recipes available.","425":"Sell for refund","426":"Expensive starter crops, but in case you run out:","427":"Purchase the Farm Hand\'s Bulk Harvest skill to harvest all crops at once.","428":"Click to instantly harvest all crops.","429":"You have no crops to harvest.","430":"Purchase these farm skills:","431":"Purchase the Farm Hand\'s Bulk Animal Collect skill to collect from all animals at once.","432":"Purchase the Farm Hand\'s Logging skill to chop multiple trees at once and collect the wood.","433":"Purchase Better Logging to increase the number of trees chopped at once.","434":"Click to instantly collect from all animals.","435":"Click to instantly chop multiple trees and collect wood.","436":"You have no animals to collect from.","437":"You have no trees to chop.","438":"Remove Crop","439":"Crop returned.","440":"Started ","441":"\u231b\ufe0f Ready in ","442":"\ud83c\udfe0 House repairs complete!","450":"\u274c Cannot afford crafting costs","451":"\u26a0\ufe0f Crafting already in progress","452":"\u274c Failed to start crafting.","453":"\u274c Failed to repair house.","454":"\u274c Failed to hire worker.","455":" has arrived!","456":"No more workers available.","457":"Ready!","458":"Time: ","459":"Instant","460":"Requires: ","461":"Costs: ","462":"Gives: ","463":"Heals: ","464":"Purchase Bulk Crafting to collect from ready crafting stations all at once.","465":"Click to instantly collect from all ready crafting stations.","466":"You have no crafting stations ready to collect from.","467":"Bulk Crafting","468":"Restarted: ","469":"Collected","470":"Cannot travel right now, farming actions in progress.","471":"\u26a0\ufe0f Already in progress.","472":"Harvested","475":"Restart?","476":"Station","477":"Your farm workers are busy...","478":"\ud83c\udf31 Working","479":"Logging complete","480":"Crafted","481":"with","482":"applied","483":"replanted","490":"Sell for refund (Dev only)","500":"COMBAT STRINGS","501":"\ud83c\udfaf Out of range.","502":"\ud83c\udfaf Hit!","503":"\u274c Miss","504":"\ud83d\udc80 Killed","505":"\u26a0\ufe0f Error","510":"\u2764\ufe0f\u200d\ud83e\ude79 You\'re taking damage ...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Your Health: ","512":"Your Health Unavailable","600":"RELATIONSHIP STRINGS:","601":"Relationship:","602":"You\'ve met","603":"You\'re now friends with","604":"You have a crush on","605":"You\'re in love with","606":"You and","607":"are now married.","608":"are now rivals.","609":"is now your rival because of this.","610":"isn\'t going to be very happy about this...","611":"aren\'t going to be very happy about this...","612":"will be very happy about this.","613":"approve of this.","614":"and","615":"Your relationship with","616":"has changed.","620":"You need to move closer to interact with this character.","621":"for being married.","622":"for being friends.","623":"for being in love.","630":"Greet","631":"Talk","632":"Trade","633":"Quest","634":"Met","635":"Friend","636":"Married","637":"Rival","638":"Love","639":"Crush","640":"Joke","641":"Make Friends","642":"Insult","643":"Hug","644":"Kiss","645":"Apologize","646":"Give Gift","647":"Compliment","648":"Flatter","649":"Profess Love","650":"Propose","651":"Taunt","652":"Tease","653":"End Marriage","700":"FTUE STRINGS:","701":"\ud83d\udc78 Welcome to Valley View","702":"Welcome, traveler! You\'ve arrived in Valley View, a frontier land of opportunity, mystery and adventure.","705":"Aspiration","706":"Valley View is a big world. It\'s up to you how you want to spend your time. Which of these aspirations best suits your style of play? (This choice will not limit your options in any way.)","721":"\ud83e\udd20 Meet Kent the Farm Manager","722":"First things first! Harvest some \ud83c\udf3e Wheat and sell it at the \ud83d\udce5 Trading Post for \ud83d\udcb0 Money.","723":"\ud83c\udf31 Get Farming","724":"Well done, you\'re making money now, so start Farming! Plant crops using the \ud83c\udf31 Farming panel, harvest them, and sell.","727":"\ud83d\udc75\ud83c\udffb Hire the Shepherd","728":"Nice work! Now hire the \ud83d\udc75\ud83c\udffb Shepherd from the \ud83c\udfe0 Farm House, and she\'ll help bring some \ud83d\udc2e animal life to the farm, so you can continue to expand your business.","729":"\ud83d\udc2e Animal Husbandry","730":"Welcome \ud83d\udc75\ud83c\udffb Shepherd! Now visit the \ud83d\udc2e Animal Panel to acquire a cow. Cows need \ud83d\udfe9 grass to graze, so place them carefully. And you already have your first \ud83d\udfeb Animal Stall; this is where you can produce milk once the cow is full.","731":"\u26cf\ufe0f Shape the Land","732":"Crops need dirt. Cows and sheep need \ud83d\udfe9 grass. Pavement can help contain the movements of people and animals. Use the \u26cf\ufe0f Tools to pave the land to your liking, and learn the  \ud83e\ude93 axe skill to chop trees for wood.","733":"\u2692\ufe0f Builder","734":"You\'ve mastered the \ud83e\ude93 axe -- excellent! Wood is useful for a number of things, including building crafting stations. You can also chop your way to the \ud83d\ude82 Train Station at the edge of your Homestead, where you can eventually travel into Town.","737":"Time to Explore","738":"Your Homestead is part of a larger Settlement of other players sharing a large Frontier. Zoom out (+ and -) to see the whole Settlement and Frontier. Use \u27a1\ufe0f Signposts to travel, or walk to the edge of any map. ENJOY PLAYING VALLEY VIEW!","750":"\ud83c\udf31 Farmer","751":"Cultivate your homestead, grow crops, tend animals, and craft goods to sell and trade with other players. Invest in farming and crafting skills to grow your profits.","752":"\u2694\ufe0f Adventurer","753":"Venture into the Valley for resources and rare items. Fight animals and creatures, uncover hidden locations, and meet magical characters. Invest in combat skills to become a formidable fighter.","754":"\ud83c\udfdb\ufe0f Politician","755":"Run for Mayor, set the tax rate, and earn tax revenue for your self. Invest in community buildings for the whole Town, like Hospitals, Schools, and Libraries, and help your settlement thrive.","795":"Skip Tutorial","796":"OK","797":"Back","798":"Play","800":"MORE CRAFTING STATION STRINGS:","801":"Acquire the ","802":" Skill at the ","803":" to increase the output of this station by ","805":"Your ","806":" Skill increases the base output of this station by ","810":"You can also purchase this skill directly: ","820":"Makes: ","821":"Base Amount: ","825":"You have ","826":"Scrolls.","827":"Scroll","899":"DEBUG STRINGS:","900":"Debug: Inventory cleared.","901":"Debug: Quest history cleared.","902":"Debug: Resources added.","903":"Debug: Grid successfully reset.","904":"Debug: Skills added.","905":"Debug: Skills & Powers cleared.","906":"Debug: Combat Stats reset.","999":"PANEL UI STRINGS:","1000":"[Description needed]","1001":"Resources collected at the homestead go into the warehouse. Resources collected in town or in the valley will go into the backpack. To buy a backpack, visit the Store in town. To empty the backpack or warehouse, use the Manage buttons.","1002":"Build crafting stations on your Homestead using resources from your warehouse.","1003":"Purchased animals will appear at your player icon, and immediately begin life on the homestead.","1004":"Till land to dirt in order to plant crops. Plant grass to give farm animals something to graze on.","1005":"Acquire Skills and Upgrades to improve various attributes. Make sure to explore the Town to find additional places and ways to gain Skills and Upgrades.","1006":"Manage your ongoing To Do list here. Look for quest-giving characters on your homestead as well as Town, or even the Valley.","1007":"Governments in Valley View are formed at the settlement level. The elected mayor implements policies and builds buildings to help the community thrive.","1008":"Buy and sell with other players. If no players buy your items before the timer expires, sell them to the game for a fraction of their base value.","1009":"[Crafting description]","1010":"[Mailbox description]","1011":"This Animal Stall is empty. Make sure animals have grass to eat, and they will eventually come to the stall for harvesting.","1012":"Elections take place in the Courthouse. Here, Mayors have the power to set the tax rate and rename the Settlement.","1013":" ","1014":" ","1015":"The game takes place over the course of continually changing seasons.","1016":" ","1017":"Visit the Bank to exchange items for Money, including rare items like Gold and Silver. Return to the bank regulalry for different offers.","1018":"","1019":"[Profile description]","1021":"\xa9 Valley View Studios, 2025, All Rights Reserved.","1022":"[Train description]","1023":"Workers help you run your homestead. Hire them at the Farm House.","1024":"[Combat description]","1025":"[Shop description]","1026":"Earning and spending Money.","1027":"These are the benefits of a Gold Pass.","1028":"[Decorations panel description]","1029":"[Animal panel]","1030":"[Crop panel]","1031":"Buy decorations for your homesetead. You will be able to sell these for a full refund.","1032":"The Farm House is where you can hire people to help you run your homestead.","1033":"Terraform the land with these tools. Animals need grass for grazing, crops need dirt to grow on. Pavement can be useful for controlling movements of animals and characters.","1034":"Earning and spending Gems.","1035":"This is your collection of lifetime Trophies.","1036":"Reveal mysterious scrolls at this Ancient Temple.","1101":"Inventory","1102":"\u2692\ufe0f Build","1103":"\ud83d\uded2 Buy","1104":"\ud83c\udf31 Farming","1105":"\ud83d\udcaa Skills","1106":"\u2705 To Do List","1107":"\ud83c\udfdb\ufe0f Government","1108":"\ud83d\udce5 Trade","1109":"Crafting","1110":"\ud83d\udcea Mailbox","1111":"\ud83d\udc3e Animals","1112":"\ud83c\udfdb\ufe0f Courthouse","1113":"Helper Character","1114":"\ud83d\ude00 Player Character","1115":"\ud83d\uddd3\ufe0f Season","1116":"\ud83d\udd01 Trader","1117":"\ud83c\udfe6 Bank","1118":"\ud83d\udd79\ufe0f How to Play","1119":"\ud83d\ude00 Profile","1120":"\ud83d\udc1e Debug","1121":"\ud83d\ude00 Welcome","1122":"\ud83d\ude82 Train","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Farm Hand","1124":"\u2694\ufe0f Combat","1125":"\ud83d\uded2 Shop","1126":"\ud83d\udcb0 About Money","1127":"\u2b50\ufe0f Gold Pass","1128":"\ud83e\udeb4 Decorations","1129":"\ud83d\udc3e Animals","1130":"\ud83c\udf31 Crops & Trees","1131":"\ud83e\udeb4 Decorations","1132":"\ud83c\udfe0 Farm House","1133":"\u26cf\ufe0f Tools","1134":"\ud83d\udc8e Gems","1135":"\ud83c\udfc6 Trophies","1136":"\ud83d\uded5 Ancient Temple","1200":"TRADER STORY STRINGS","1201":"Ah, the forest hides many secrets\u2026 and I? I\u2019ve stolen a few. These Gems, they\u2019re not mine, but Titania has more than she needs. You\u2019ve something I crave: Olive Bread, warm and rich. Trade with me, and I might whisper tales of glowing eyes in the dark, wings that shimmer at moonrise, and dragons that speak in riddles. Keep an ear open, and a dagger close.","1202":"My bounty is as boundless as the sea, my love as deep... but he is gone, and all that remains is a portrait and pain. Angelo took both. Bring me Romeo\u2019s likeness, torn from my chamber, and I\u2019ll give you Tulips red as the blood spilt on Verona\u2019s stones. Let this be our new balcony: you below, bearing justice.","1203":"Give me life, give me love, but most of all... give me Port! In exchange, a sprig of Feverfew, dearer than gold to some, especially that wide-eyed Helena. Says she\u2019s after crowns and legends, poor girl. Me? I\u2019m after a full belly and a gentle nap. \u2018Thou art so fat-witted with drinking of old sack,\u2019 they once told me. Ha! They were not wrong.","1204":"Here\u2019s rosemary, for remembrance\u2014and nightshade, for regrets. My potions are not for the faint of will. With the right leaf, I can mend your limbs or muddle your tongue. \u2018I do remember an apothecary,\u2019 said a boy once, and he paid the price. But you? You look wiser. Bring me rare roots and bitter seeds, and I\u2019ll mix you something worth the danger.","1205":"Something is rotten, still. I feel it in the soil. I once ruled, loved, lost. Helena burned through me like summer lightning. And Leontes? He could not forgive the thaw. \u2018The lady doth protest too much,\u2019 they said; let them. If you see Helena, tell her the roses know her name. If you see Leontes, tell him I have not forgotten the winter.","1206":"My grief is a statue; silent, but never still. I buried my crown in snow the day Gertrude chose her garden over me. \u2018Exit, pursued by a bear\u2019? No, I fled myself. Now I wait, among stone and silence. Bring me what was once mine, the King\u2019s Crown, and I\u2019ll pay in Gold, more than the weight of memory. But beware: some thrones carry curses.","1207":"This bridge is mine, by Sycorax my mother.\u2019 Prospero tried to steal it with spells and smiles. They called me beast, but I am of earth and storm, born to wild truth. I trade bones for Silver, tokens of the dead for coin of the living. Touch nothing lightly in these woods. Bring me what others fear, and I shall make you rich... or haunted.","1208":"","1301":"Skills to purchase:","1302":"Upgrades to purchase:","1303":"Skills you have:","1304":"Upgrades you have:","1305":"You have no skills yet.","1306":"You have no upgrades yet.","1400":"MODAL STRINGS","1401":"BANK MODAL","1402":"These offers good for","1403":"Will buy","1404":"for","1405":"No offers available.","1406":"New offers in","1407":"Generating new orders. Thank you for your patience.","1408":"\u26a0\ufe0f You don\'t have enough items.","1409":"\u26a0\ufe0f You don\'t have enough skills.","1410":"\u26a0\ufe0f You don\'t have enough upgrades.","1500":"TOWN NEWS STRINGS:","1501":"News for ","1502":"The current Mayor is","1503":", and the tax rate is","1504":"Here\'s what\'s happening in Town right now:","1505":"It\'s election season, and campaigning is in full swing. Stop by the Courthouse in Town to run for Mayor.","1506":"Voting for the next Mayor has begun. Cast your vote at the Courthouse in Town.","1507":"The Train is arriving, offering to buy:","1508":"The Train is departing. When it returns, it will be buying:","1509":"The Train is here, offering to buy:","1510":" ","1511":"Visit the Bank to sell gold, silver, and diamonds. The Bank is currently updating its offers.","1512":"There is currently no mayor. ","1513":"The Train is departing in","1514":"When it returns, it will be buying:","1515":"The tax rate is","1516":"The Bank is currently buying:","1517":"The Train will be departing in","1518":"The votes in the latest election for Mayor are being counted. Results expected in ","1600":"MAILBOX STRINGS:","1601":"Loading messages...","1602":"You have no messages.","1603":"Received","1604":"Collect","1605":"Most messages will be deleted afer 14 days. Store purchases will not be deleted.","1606":"\ud83d\udcea Mailbox","1607":"\ud83d\uddd1\ufe0f Message deleted.","1700":"STORE STRINGS:","1701":"\ud83d\uded2 Store","1702":"Purchases will be delivered to the Inbox.","1703":"\ud83d\ude4f Thank you for your support! We are a tiny developer with few resources, but passionate about creating a fun space for a positive community.","1704":"Please consider making purchases so we can continue to improve the game.","2000":"TRAIN, BANK, COURTHOUSE, etc. STRINGS:","2002":"Completed","2003":"\ud83d\ude82 Next Shipment Preview:","2004":"\ud83c\udf81 Rewards for filling all orders (sent to all who complete at least one order):","2005":"Click to fulfill","2006":"Your Order","2007":"Claimed","2008":"Claim Order","2009":"Claimed by you:","2010":"Available to claim:","2011":"Claimed by others:","2012":"Completed:","2013":"Claimed by you:","2014":"You can only claim one train offer at a time.","2015":"Show Train Log","2016":"\ud83c\udf89 All orders were completed! Rewards have been mailed out.","2017":"This order has already been claimed.","2020":"Train is","2030":"Offers Update in","2040":"Welcome, Mayor.","2041":"\ud83d\udcb0 Tax Rate: ","2042":"Proposed: ","2043":"Update","2044":"\u26a0\ufe0f Only the Mayor can set the tax rate.","2045":"\ud83d\uddf3\ufe0f Elections","2046":"Current Phase:","2047":"Phase Timer:","2048":"\ud83d\udce2 Campaign Promises","2060":"Voting begins in:","2061":"Voting ends in:","2062":"Voting has ended. Results announced in:","2063":"Next campaign begins in:","2070":"\ud83d\udce2 Campaign Promises","2071":"No one has made a campaign promise yet.","2072":"Enter your campaign promise (max 200 characters)...","2073":"Submit Campaign Promise","2074":"Cast Your Vote","2075":"No candidates available for voting.","2076":"Campaign promise:","2077":"You have already voted in this election.","2078":"There were no candidates.","2079":"How\'s your Mayor doing?","2080":"Welcome, Mayor.","2081":"Enter settlement name...","2082":"Your Settlement:","2083":"Update Name","2084":"Visit the \ud83c\udfdb\ufe0f Government Panel to view stats on how the settlement is doing, to help guide your election decision.","2085":"Current Mayor:","2090":"\ud83c\udfe4 Community Buildings","2092":"\ud83c\udfeb Schools: ","2093":"\ud83c\udfeb No Schools built yet.","2094":"\ud83c\udfe5 Hospitals: ","2095":"\ud83c\udfe5 No Hospitals built yet.","2096":"\ud83d\udc3e Animal Yards: ","2097":"\ud83d\udc3e No Animal Yards built yet.","2098":"\ud83c\udfe4 Libraries: ","2099":"\ud83c\udfe4 No Libraries built yet.","3000":"GOV PANEL:","3001":"Your Settlement:","3002":"\ud83d\ude0a Pop.","3003":"\ud83d\udcb0 Tax Rate:","3004":"The tax rate is set by the Mayor, for this Settlement, and a percentage of all taxes collected are added to the Mayor\'s bank account.","3005":"Mayors are elected at the Courthouse in Town.","3006":"\ud83c\udfdb\ufe0f Government Officials","3007":"No government officials elected yet.","3009":"Only the Mayor can build Schools, Hospitals and Libraries in the Town.","3010":"\ud83c\udfeb Schools give citizens access to certain Skills that cannot be gained elsewhere.","3011":"\ud83c\udfe5 Hospitals supply Doctors, who can heal adventurers returning from the Valley.","3012":"\ud83c\udfe4 Libraries are a source of Books, which are vital to Adventurers looking to learn new skills.","3013":"\ud83d\ude82 The Mayor can influence demand for goods at the Train.","3020":"View Tax Log","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"SEASON PANEL STRINGS","3051":"(Net worth is recalculated twice per day.)","3052":"No data available for top citizens.","3053":"It\'s","3054":"Loading...","3055":"Season ends in:","3056":"We are in between seasons.","3057":"At the end of the season, bonus rewards will be sent to the top players in the Frontier, as well as to all players in the top Settlement.","3058":"\ud83c\udfc6 Top Citizens in the Frontier","3059":"\ud83c\udfd9\ufe0f Leading Settlement","3060":"Total Wealth:","3061":"Population:","3062":"Unknown","3063":"No data available","3064":"View Season Log","4000":"LOGIN PANEL:","4001":"Don\'t have a profile? Create a new free profile to start playing:","4002":"New Profile","4003":"Username","4004":"You will not be asked for an email address.","4005":"With your own profile, you\'ll be granted your own homestead to cultivate in a Settlement with other players, in a Frontier full of Settlements. Adventure awaits you in the Valley.","4006":"Password","4007":"Login","4008":"Username","4009":"Login to your profile to continue playing. If you don\'t have an","4010":"Already have a profile?","4050":"PROFILE PANEL:","4051":"Hi, ","4052":"Change Username:","4053":"Change Password:","4054":"Profile Management","4055":"Profile Status:","4056":"Logout","4057":"Delete Your Profile","4058":"Player ID:","4059":"Homestead Relocation","4060":"Relocations Remaining:","4061":"Visit the Store to purchase more Relocations.","4062":"Settings","4063":"Language:","4064":"Range Indicator:","4065":"Change Avatar","4066":"Back to Login","4067":"Select Language","5000":"MORE MODAL STRINGS:","5001":"\ud83d\udc80 You have died.","5002":"You have been returned home. Any backpack \ud83c\udf92 items you had were lost.","5003":"Be more careful next time.","5005":"\ud83d\ude00 Welcome to Valley View\u2122","5006":"Please login, or create a free profile.","5007":"\xa9 Valley View Studios, 2025, All Rights Reserved.","5010":"\ud83d\udce8 Inbox","5011":"You have no messages","5015":"\ud83d\uded2 Store","5016":"Purchases will be delivered to the Inbox. We are unable to offer returns. All purchases are final.","5017":"Be aware that most inventory items are wiped between seasons, so please check the season clock before purchasing, and see the seasons panel for more information.","5020":"\ud83d\udeab You are currently logged out.","5021":"Click the Login or Create Profile button to begin.","5025":"\ud83d\ude4f Thank you for your support!","5026":"Your purchase has been delivered to your Inbox.","5027":"Enjoy Valley View!","5030":"\ud83d\ude00 Welcome to Valley View!","5031":"No player is logged in or the server is offline.","5032":"Please refresh the page, check your internet connetion, or return later.","5035":"We are between seasons!","5036":"Valley View is temporarily unavailable while we reset the season.","5040":"\ud83d\udcf0 Town News","5041":"Here\'s what\'s happening in Town right now:","5045":"Use ","5046":"Do you want to use a","5047":"You have ","5050":"\u26a0\ufe0f Confirm Homestead Move","5051":"Are you sure you want to move your homestead? This cannot be undone.","5052":"Close this dialog to cancel.","5060":"\u2b50\ufe0f Congratulations!","5061":"You now have a Gold Pass. Go to your Profile panel to customize your player icon, and discover other Gold benefits.","5062":"Thank you for your support!","5100":"Recent Tax Collections","5101":"No tax collection history available yet.","5102":"\ud83d\uddd3\ufe0f Date","5103":"\ud83d\udcb0 Total Collected","5104":"Mayor","5105":"\ud83d\udcb0 Mayor Take","5110":"","6000":"TROPHY STRINGS:","6001":"Here are your lifetime Trophies:","6002":"You have no trophies yet. Earn trophies for achievements throughout the game.","6003":"Trophy Earned!","7000":"NOTIFICAITION STRINGS:","7001":"Tip:","7005":"Use A-W-S-D or the Arrow Keys to Move.","7006":"Look for the \ud83d\udcaa icon to open the Skills panel.","7007":"Stand on grass, then find the \ud83d\udc2e Buy panel to purchase a cow. You\'ll first need the Husbandry skill.","7009":"Keep checking your \u2705 To-Do-List, and keep checking with \ud83e\udd20 Kent and \ud83d\udc75\ud83c\udffb the Shepherd.","7015":"Click + and - at the top of the screen to zoom in and out.","8999":"HOW TO PLAY STRINGS:","9000":"Welcome to Valley View!","9001":"What\u2019s it about?","9002":"Valley view is a game that explores how people might self organize and create micro societies in a world of asymmetric resources and interdependence, with both owned and shared spaces.","9003":"While there are no explicit specialization paths, there are three main vectors of play which are interdependent. These are: the FARMER, the ADVENTURER, and the POLITICIAN. You are encouraged to lean upon each other.","9004":"First, the basics:","9005":"Use A-W-S-D keys to MOVE. Click to interact with things that are within your interaction radius.","9006":"Explore \ud83c\udf31 FARMING, \u2692\ufe0f BUILD, and \ud83d\udc2e BUY to improve your Homestead and generate resources.","9007":"Generate \ud83d\udcb0 MONEY at the \ud83d\udce5 TRADING POST. Post resources for sale to other players, or sell them to the game for partial value.","9008":"More:","9009":"As you create wealth, improve yourself with SKILLS and ABILITIES. For example, purchase the \ud83d\udc34 HORSERIDING SKILL to venture into the Valley.","9010":"Zoom out (- and +) to see how big the world is. Your Homestead is one of many in a SETTLEMENT. Each SETTLEMENT has a shared TOWN. Your Settlement is one of many in the FRONTIER.","9011":"When you are ready, explore the VALLEY, which is full of danger and wonders. The secrets of the wizard PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f and the lost king LEONTES \ud83e\udd34, among others, can be found in the Valley.","9012":"Your Goals:","9013":"Feel free to create your own goals. Also, at the end of each \ud83d\uddd3\ufe0f SEASON, which runs three months, both individuals and settlements will be ranked, and top placement generates additional wealth. Your homsestead, all of your skills, and some of your wealth will carry over into the next Season.","9014":"Farm, craft, trade, explore, fight, and enjoy!","9020":"How to Earn Money","9021":"There are a few ways to make \ud83d\udcb0 MONEY.","9022":"As you are getting started, open the \ud83d\udce5 TRADING POST, which you will find in the upper left corner of your Homestead. Here, you can sell goods, including crops and crafts.","9023":"The \ud83d\udce5 TRADING POST will buy goods from you at 25% of their value. To maximize your earnings, you should trade with other players. They will have things you need, and vice versa.","9024":"As you advance, you\'ll be able to travel into TOWN using the \ud83c\udfdb\ufe0f SIGNPOST next to the TRAIN. There, you will find places like the BANK, which will buy specific items from you at a premium.","9025":"Spending Money","9026":"Surprise, most things cost Money. Initially, you will want to spend money on \ud83d\udcaa SKILLS, \ud83d\udc2e FARM ANIMALS, and \u2692\ufe0f CRAFTING STATIONS. Explore the panels at the left side of the screen. These will help you generate more resources, which in turn will help you earn more Money.","9027":"In TOWN you will disocver more Shops and Traders.","9030":"How to Earn Gems","9031":"Gems are a rare resource that can be used to purchase various things to help accelerate your play.","9032":"You can purchase Gems in the Store, or by clicking here:","9033":"On rare occassions, Gems can be found in the Valley, or earned as rewards for crushing it with the Train, or finishing strong at the end of a Season.","9040":"No Brainer:","9041":"100 \ud83d\udc8e Gems for ","9042":"Best Value:","9043":"500 \ud83d\udc8e Gems for ","9044":"Most Popular:","9045":"1000 \ud83d\udc8e Gems for ","9050":"Benefits","9051":"A Gold Pass gives you access to premium features and benefits in Valley View for the duration of a season.","9052":"With a Gold Pass, you can enjoy the following benefits:","9053":"\u2705 Premium avatars: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 Near unlimited Warehouse capacity","9055":"\u2705 Near unlimited Backpack capacity","9056":"\u2705 2 additional Trade Stall slots","9057":"\u2705 Lower Tax rate","9058":"\u2705 Half your MaxHP restored on death","9059":"\u2705 You can run for office","9060":"Thank you for your Gold Pass purchase.","9061":"Purchase a Gold Pass","9999":"ERROR STRINGS:","10000":"\ud83d\udd0c Server is Down","10001":"The server is currently down. We apologize for the inconvencient, please check back soon.","10002":"(This message will disappear when the server is back up.)","10100":"APP.JS STRINGS:","10101":"Welcome to Valley View!","10102":"Please login, or create a free profile.","10103":"\ud83c\udf92 Inventory","10104":"\ud83d\uded2 Store","10105":"\ud83d\udce8, Inbox","10106":"\ud83d\udce2 Share","10107":"\ud83d\udcac Chat","10108":"You Have a Gold Pass","10109":"\u2194\ufe0f Move Keys: ","10110":"\ud83d\udd79\ufe0f How to Play","10111":"You are the Mayor","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Health: ","10113":"\ud83d\uddd3\ufe0f It\'s","10114":"Next Season starts in:","10115":"\ud83d\uddd3\ufe0f Next Season:","10116":"\ud83c\udfdb\ufe0f Happening Now in Town:","10117":"\ud83d\udcb0 Next Tax Collection:","10118":"In: ","10119":"Now collecting taxes...","10120":"\ud83c\udfdb\ufe0f Elections: ","10121":"Ends: ","10122":"\ud83d\ude82 Train: ","10123":"\ud83c\udfe6 Bank: ","10124":"New Offers: ","10125":"Read the News!","10126":"Who\'s here:","10127":"No PCs present in the grid.","10128":"Save Changes","10129":"","10130":"You Have a Gold Pass","10131":"Gold Pass Benefits","10132":"Cancel Relocation","10133":"Relocate Homestead","11000":"ADDED STRINGS:","11001":"Wait for the timer to end, or for another player to buy this item.","12001":"Farming","12002":"Build","12003":"Animals","12004":"To Do List","12005":"Skills","12006":"Combat","12007":"Government","12008":"Seasons","12009":"Home","12010":"Profile","12011":"Decorations","12012":"Tools","12013":"Trophies","15000":"\ud83d\uddd3\ufe0f Season Rules","15001":"Seasons last three months.","15002":"Rewards","15003":"\ud83d\udcb0 Net worth will be calculated based on your money, inventory items, and items on your homestead.","15004":"\ud83c\udfc6 The top 3 players across the frontier will have rewards sent to your mailbox, and also earn a \u201cSeason Winner\u201d trophy.","15005":"\ud83c\udfc6 The top player in the frontier will also earn the \u201cSeason Champion\u201d trophy.","15006":"\ud83c\udf81 All players in the top settlement will receive additional rewards in your mailbox.","15007":"Resetting Players and Locations","15008":"\ud83c\udfe0 You will be relocated back to your homestead if you are away from home when the season ends.","15009":"\ud83c\udfe0 Your homesteads will NOT reset \u2013 all layout, tiles and resources carry over.","15010":"\ud83c\udf92 Your inventory WILL be wiped, with the exception of rare items like Prospero\u2019s Orb, King\u2019s Crown, Golden & Skeleton Keys, Trident).","15011":"\ud83d\udc8e You will keep all Gems.","15012":"\ud83d\udcb0 Money will be nerfed to 10% of the current amount (25% for Gold Pass holders).","15013":"\u2705 All quests will be wiped.","15014":"\ud83d\udcaa Your skills & powers carry over.","15015":"\u2764\ufe0f Your relationships carry over.","15016":"\u2b50\ufe0f Your Gold Pass status will be revoked for the new season.","15017":"\ud83c\udf32 All town and valley grids will be reset with fresh tiles, resources and enemies.","15018":"What Changes?","15019":"\ud83c\udf83 Towns will have tiles and resources according to the new season content.","15020":"\ud83d\ude00 New players joining (and creating new homesteads) will get starter tiles and resources according to the new season content.","15021":"\ud83d\ude82 Train orders are affected by the seasons.","15022":"\ud83c\udfc6 New rewards and trophies can be earned.","30000":"TROPHIES:","30001":"First Farm Worker","30002":"Skill Builder","30003":"Trains Completed","30004":"Season Winner","30005":"Season Champion","200000":"RESOURCES","200009":"Gold Account","200010":"Money","200011":"Stub","200012":"Signpost N","200013":"Signpost E","200014":"Signpost S","200015":"Signpost W","200016":"Signpost NW","200017":"Signpost NE","200018":"Signpost SE","200019":"Signpost SW","200020":"Signpost Town","200021":"Signpost Home","200022":"Trade Stall","200023":"Trading Post","200024":"Warehouse","200025":"Abandoned House","200026":"Farm House","200027":"Repair","200028":"Mountain","200029":"Mountain Large","200030":"Bank","200031":"Courthouse","200032":"Train","200033":"Mailbox","200034":"Oak Tree","200035":"Pine Tree","200036":"Palm Tree","200037":"Holiday Tree","200038":"Snowman","200039":"Rocks","200040":"Clay Pit","200041":"Wood","200042":"Stone","200043":"Clay","200044":"Wheat Plot","200045":"Carrot Plot","200046":"Corn Plot","200047":"Sugarcane Plot","200048":"Strawberry Plot","200049":"Apple Tree","200050":"Lemon Tree","200051":"Grape Vine","200052":"Garlic Plot","200053":"Olive Tree","200054":"Tomato Vine","200055":"Oak Tree Plot","200056":"Wheat","200057":"Carrot","200058":"Corn","200059":"Sugarcane","200060":"Strawberry","200061":"Apple","200062":"Lemon","200063":"Grapes","200064":"Garlic","200065":"Olive","200066":"Tomato","200067":"Blueberry","200068":"Milk","200069":"Wool","200070":"Egg","200071":"Flour","200072":"Chicken Feed","200073":"Sugar","200074":"Cornmeal","200075":"Lumber","200076":"Butter","200077":"Cream","200078":"Cheese","200079":"Thread","200080":"Cloth","200081":"Sweater","200082":"Jacket","200083":"Heavy Jacket","200084":"Runic Tunic","200085":"Bread","200086":"Cornbread","200087":"Apple Pie","200088":"Strawberry Pie","200089":"Lemon Cookie","200090":"Olive Bread","200091":"Garlic Bread","200092":"Queen\'s Cake","200093":"Tomato Soup","200094":"Carrot Soup","200095":"Omelette","200096":"Pizza","200097":"Honey","200098":"Apple Cider","200099":"Wine","200100":"Port","200101":"Olive Oil","200102":"Aged Wine","200103":"Pottery","200104":"Furniture","200105":"Ink","200106":"Urns","200107":"Rosemary","200108":"Mushroom","200109":"Magic Mushroom","200110":"Daisy","200111":"Tulip","200112":"Sunflower","200113":"Feverfew","200114":"Potion A","200115":"Potion B","200116":"Potion C","200117":"Gem","200118":"Book","200119":"Pelt","200120":"Bear Skin","200121":"Bones","200122":"Silver","200123":"Gold","200124":"Diamond Ring","200125":"King\'s Crown","200126":"Portrait","200127":"Trident","200128":"Skeleton Key","200129":"Golden Key","200130":"Scroll","200131":"Prospero\'s Orb","200132":"Tent","200133":"Boat","200134":"Shrine","200135":"Castle","200136":"Restaurant","200137":"Restroom","200138":"General Store","200139":"Warrior\'s Den","200140":"Magic Shop","200141":"Ancient Temple","200142":"Adventure Camp","200143":"Laboratory","200144":"School","200145":"Animal Stall","200146":"Mill","200147":"Dairy","200148":"Chicken Coop","200149":"Lumber Yard","200150":"Loom","200151":"Oven","200152":"Kitchen","200153":"Beehive","200154":"Studio","200155":"Winery","200156":"Library","200157":"Animal Yard","200158":"Hospital","200159":"Cow","200160":"Sheep","200161":"Brown Cow","200162":"Doctor","200163":"Surgeon","200164":"Fairy","200165":"Kent","200166":"Portia","200167":"The Shepherd","200168":"Hotspur","200169":"Cassio","200170":"Mistress Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampire","200175":"Santa Claus","200176":"Prospero","200177":"Falstaff","200178":"Apothecary","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Juliet","200184":"Mermaid","200185":"Farmer","200186":"Farm Hand","200187":"Rancher","200188":"Lumberjack","200189":"Coyote","200190":"Bear","200191":"Spider","200192":"Zombie","200193":"Duke Angelo","200194":"Ghost","200195":"Ogre","200196":"Demon","200197":"Dragon","200198":"Coyote Spawner","200199":"Bear Spawner","200200":"Spider Spawner","200201":"Zombie Spawner","200202":"Ghost Spawner","200203":"Demon Spawner","200204":"Dragon Spawner","200205":"Grower","200206":"Green Thumb","200207":"Husbandry","200208":"Bulk Animal Collect","200209":"Axe","200210":"Pickaxe","200211":"Builder","200212":"Bulk Harvest","200213":"Bulk Replant","200214":"Logging","200215":"Better Logging","200216":"Bulk Crafting","200217":"Bulk Restart Craft","200218":"Better Axe","200219":"Better Pickaxe","200220":"Storehouse","200221":"Depot","200222":"TBD Storage 3","200223":"TBD Storage 4","200224":"Masonry","200225":"Mechanics","200226":"Textiles","200227":"Artistry","200228":"Beekeeper","200229":"Tailor","200230":"Politics","200231":"Education","200232":"Chemistry","200233":"Cooking","200234":"Creamery","200235":"Baker","200236":"Winemaker","200237":"Miller","200238":"Artisan","200239":"Cuisinier","200240":"Weaver","200241":"Fowler","200242":"Fromager","200243":"Virtuose Culinaire","200244":"Apiarch","200245":"Vintner","200246":"Law","200247":"Medicine","200248":"Surgery","200249":"Backpack","200250":"Rucksack","200251":"Enchanted Pack","200252":"Horse","200253":"Tracking","200254":"Scout","200255":"Padding","200256":"Light Armor","200257":"Chainmail","200258":"Plate Armor","200259":"Heavy Armor","200260":"Mystic Armor","200261":"Caliban\'s Breastplate","200262":"Blessed Veil","200263":"Magic Helmet","200264":"Magic Gloves","200265":"Boots of Protection","200266":"Knife","200267":"Short Sword","200268":"Long Sword","200269":"Great Sword","200270":"Halberd","200271":"Sword of Song","200272":"Magic Halberd","200273":"Glowing Sword","200274":"Giant Axe","200275":"Legendary Sword","200276":"Dragonslayer","200277":"Darts","200278":"Short Bow","200279":"Long Bow","200280":"Spear","200281":"Crossbow","200282":"Magic Spear","200283":"Magic Crossbow","200284":"Titania\'s Bow","200285":"Legendary Crossbow","200286":"Tempest","200287":"Maelstrom","200288":"Oblivion","200289":"Titan","200290":"Jab","200291":"Flurry","200292":"Barrage","200293":"Steady Hand","200294":"Pinpoint","200295":"Unerring","200296":"Focus","200297":"Precision","200298":"Horizon Eye","200299":"Fortitude","200300":"Stoneheart","200301":"Unbreakable","200500":"Crate","200501":"Stone Wall","200502":"Stone Wall Large","200503":"Green Wall","200504":"Black Wall","200505":"Sand Wall","200506":"Blue Wall","200507":"Orange Wall","200508":"Plant","200509":"Cactus","200510":"Harp","200511":"Flag","200512":"Stack of Books","200513":"Chair","200514":"Toilet","200515":"Bed","200516":"Teddy Bear","200517":"Big Hole","200518":"Slide","200519":"Fountain","200520":"Fountain Large","200521":"Large Decorative Palm Tree","hp":"Hit Points","maxhp":"Max Hit Points","range":"Range","attackrange":"Attack Range","attackbonus":"Attack Bonus","damage":"Damage","speed":"Attack Speed","iscamping":"Is Camping","armorclass":"Armor Class","backpackCapacity":"Backpack Capacity","warehouseCapacity":"Warehouse Capacity"}'),h=JSON.parse('{"0":"Valley View","1":"Server is not running.","3":"\ud83c\udf31 Land successfully tilled.","4":"\u26a0\ufe0f You don\'t have enough resources.","5":"\u2692\ufe0f Construction completed successfully.","6":"\ud83d\udcb0 Items sold.","7":"\ud83c\udfe0 This homsetead is unoccupied.","8":"\ud83d\udeab This area is off limits.","9":"The Valley is full of wonders, and must be explored on foot.","10":"\ud83c\udfe0 [username]\'s homestead.","11":"\ud83c\udfe0 Unknown owner\'s homestead.","12":"Settlement view. Depending on your location, you may need to scroll to see the Town.","13":"Frontier view.","14":"\ud83c\udfdb\ufe0f Welcome to town.","15":"\ud83d\udc34 You need a Horse to travel here. Visit the Adventure Camp in Town.","16":"You\'re in the valley.","17":"You do not own a hometead here.","18":"\ud83d\udeab You can\'t go that way.","19":"\ud83c\udf92 You need a Backpack to collect resources away from your homestead. Buy one at the Adventure Camp.","20":"\ud83d\udeab Not enough room in the Warehouse.","21":"\ud83c\udf92 Not enough room in the Backpack. Open Inventory to manage Backpack contents.","22":"Items purchased.","23":"\u26a0\ufe0f You can\'t build that here.","24":"\ud83c\udfaf Out of range","25":"\ud83c\udf92 Nothing in the Backpack.","26":"\ud83c\udf92 You must be at your homestead to empty your Backpack.","27":"\u26fa\ufe0f You don\'t have a tent.","28":"\u26fa\ufe0f You are now camping.","29":"\u26a0\ufe0f \u26fa\ufe0f Failed to camp / decamp.","30":"\u26fa\ufe0f No longer camping.","31":"\u26fa\ufe0f Cannot attack while camping.","32":"\u26fa\ufe0f You need to decamp first.","33":"\ud83d\udce6 Moved items to the Warehouse.","34":"\ud83c\udf92 Emptied backpack.","35":"You need a ","36":"You used a ","50":"\ud83d\udeab That username is already taken.","70":"Session Expired","71":"You\'ve been away for a while. Refreshing ensures your session works properly.","72":"This page will auto-refresh in 30 seconds unless you do it now.","73":"\ud83d\udd04 Refresh Now","74":"\ud83c\udf92 A Backpack is required to own a Tent.","75":"You do not own a Backpack. You can purchase one at the Adventure Camp in Town.","76":"Your Warehouse is empty.","77":"Your Backpack is empty.","78":"Manage Contents","80":"Acquired ","90":"\ud83d\udeab This is not your homestead.","91":"\ud83d\udc34 Horse required.","94":"\ud83d\udce2 Share Valley View!","95":"Invite others to help out and join the adventure!","96":"Have Feedback?","97":"@ Email Us","98":"\u23f3 Loading ...","99":"\u26a0\ufe0f Something went wrong.","100":"TRAVELING STRINGS:","101":"\ud83d\udc34 Traveling home ... please wait.","102":"\ud83d\udc34 Traveling to town ... please wait.","103":"\ud83d\udc34 Traveling to the next location ... please wait.","104":"\ud83d\udeab No town in this settlement yet.","105":"\u26a0\ufe0f There was a problem trying to travel.","106":"\ud83d\udeab You cannot travel beyond the frontier.","110":"\u27a1\ufe0f Walk onto Signposts to use them","111":"Welcome to town.","112":"Welcome home.","120":"You don\'t have any homestead moves left.","121":"You have successfully moved your homestead.","122":"You cannot move to the valley!","123":"You cannot move to the town!","124":"That homestead is occupied.","125":"Where are you moving to?","130":"Select your language:","131":"Confirm","140":"TRADE STALL STRINGS:","141":"Sold","151":"You cannot fill another player\'s trade stall.","152":"You do not have enough money to buy this item.","153":"is selling:","154":"are selling","155":"Transaction failed. This item has already been sold.","156":"Click to sell","157":"Bought by","158":" limit per order.","159":"Ready to sell","160":"Items to Sell","161":"Item","162":"Available","163":"Price","164":"Amount","165":"All","166":"Add","167":"Sell","168":"Yes, Sell All","169":"Buy","170":"Unlocked trading slot","171":"Gold Pass Required","172":"Locked","173":"Limit of","174":"to Sell","175":"Unlock for","176":"Wood","177":"Need","178":"to unlock this slot","179":"This Outpost only accepts items from your backpack. Any player can collect money from an Outpost.","180":"INVENTORY STRINGS:","181":"\ud83d\udce6 Warehouse","182":"\ud83c\udf92 Backpack","183":"Capacity: ","184":"Manage Contents","185":"Quantity","186":"Amount","187":"Add to Warehouse","188":"Discard","189":"Add All to Warehouse","190":"Discard All","191":"Item","192":"Action","193":"Discard Items","194":"Expand Warehouse","195":"Expand Backpack at the Adventure Camp in Town.","199":"Near unlimited capacity with Gold Pass (among other benefits).","200":"QUESTS","201":"\u2705 Action item completed. You have your reward.","202":"\u2705 Action item accepted.","203":"No action items at the moment.","204":"To Do List:","205":"Nothing new at this time. Check your \u2705 To Do list!","206":"Return to the NPC who gave you this quest to collect your reward.","207":"In Progress","208":"Get Reward","209":"Accept","299":"FARMING STRINGS:","300":"Added","301":"\ud83c\udf31 Tilled","302":"\ud83c\udf31 Planted","303":"\ud83c\udf31 Must plant on dirt","304":"\ud83c\udf31 Can\'t plant here","305":"\u26a0\ufe0f Not enough resources","306":"\u26a0\ufe0f Can\'t build here","310":"You need to till the land for planting.","311":"Your farm animals will need plenty of grass to graze on.","312":"Pavement can be useful to control wandering animals.","313":"","315":"Select Crops to Harvest:","316":"Select All","317":"Deselect All","318":"Collect","319":"Select Animals to Collect:","320":"Cannot terraform here.","340":"Not avilable unless you\'re on foot.","341":"Select Crafting Stations to Collect:","342":"Harvest?","343":"Replant?","344":"No crops ready to harvest.","345":"Ready to Collect:","346":"Collect?","347":"Buy 1 for: ","350":"The Farm Hand will help you automate harvesting and planting of crops.","351":"The Rancher will help you automate collecting from animals.","352":"The Lumberjack will help you automate chopping trees for wood.","353":"The Crafter will help you automate collecting from crafting stations.","354":"Kent is your Farm Manager. He can help you run your homestead.","355":"The Shepherd will guide you in the management of your farm animals.","400":"BUYING, CRAFTING, SKILLS, HEALING, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Already at maximum hit points.","402":"\u26a0\ufe0f  resources.","403":"\u26a0\ufe0f Youre inventory is full.","404":"Working...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Hit Points healed by +","410":"\ud83c\udfd5\ufe0f To use a purchased tent, click on your own player icon.","420":"will trade you:","421":"Used In:","422":"Base Value:","423":"No trades available.","424":"No recipes available.","425":"Sell for refund","426":"Expensive starter crops, but in case you run out:","427":"Purchase the Farm Hand\'s Bulk Harvest skill to harvest all crops at once.","428":"Click to instantly harvest all crops.","429":"You have no crops to harvest.","430":"Purchase these farm skills:","431":"Purchase the Farm Hand\'s Bulk Animal Collect skill to collect from all animals at once.","432":"Purchase the Farm Hand\'s Logging skill to chop multiple trees at once and collect the wood.","433":"Purchase Better Logging to increase the number of trees chopped at once.","434":"Click to instantly collect from all animals.","435":"Click to instantly chop multiple trees and collect wood.","436":"You have no animals to collect from.","437":"You have no trees to chop.","438":"Remove Crop","439":"Crop returned.","440":"Started ","441":"\u231b\ufe0f Ready in ","442":"\ud83c\udfe0 House repairs complete!","450":"\u274c Cannot afford crafting costs","451":"\u26a0\ufe0f Crafting already in progress","452":"\u274c Failed to start crafting.","453":"\u274c Failed to repair house.","454":"\u274c Failed to hire worker.","455":" has arrived!","456":"No more workers available.","457":"Ready!","458":"Time: ","459":"Instant","460":"Requires: ","461":"Costs: ","462":"Gives: ","463":"Heals: ","464":"Purchase Bulk Crafting to collect from ready crafting stations all at once.","465":"Click to instantly collect from all ready crafting stations.","466":"You have no crafting stations ready to collect from.","467":"Bulk Crafting","468":"Restarted: ","469":"Collected","470":"Cannot travel right now, farming actions in progress.","471":"\u26a0\ufe0f Already in progress.","472":"Harvested","475":"Restart?","476":"Station","477":"Your farm workers are busy...","478":"\ud83c\udf31 Working","479":"Logging complete","480":"Crafted","481":"with","482":"applied","483":"replanted","490":"Sell for refund (Dev only)","500":"COMBAT STRINGS","501":"\ud83c\udfaf Out of range.","502":"\ud83c\udfaf Hit!","503":"\u274c Miss","504":"\ud83d\udc80 Killed","505":"\u26a0\ufe0f Error","510":"\u2764\ufe0f\u200d\ud83e\ude79 You\'re taking damage ...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Your Health: ","512":"Your Health Unavailable","600":"RELATIONSHIP STRINGS:","601":"Relationship:","602":"You\'ve met","603":"You\'re now friends with","604":"You have a crush on","605":"You\'re in love with","606":"You and","607":"are now married.","608":"are now rivals.","609":"is now your rival because of this.","610":"isn\'t going to be very happy about this...","611":"aren\'t going to be very happy about this...","612":"will be very happy about this.","613":"approve of this.","614":"and","615":"Your relationship with","616":"has changed.","620":"You need to move closer to interact with this character.","621":"for being married.","622":"for being friends.","623":"for being in love.","630":"Greet","631":"Talk","632":"Trade","633":"Quest","634":"Met","635":"Friend","636":"Married","637":"Rival","638":"Love","639":"Crush","640":"Joke","641":"Make Friends","642":"Insult","643":"Hug","644":"Kiss","645":"Apologize","646":"Give Gift","647":"Compliment","648":"Flatter","649":"Profess Love","650":"Propose","651":"Taunt","652":"Tease","653":"End Marriage","700":"FTUE STRINGS:","701":"\ud83d\udc78 Welcome to Valley View","702":"Welcome, traveler! You\'ve arrived in Valley View, a frontier land of opportunity, mystery and adventure.","705":"Aspiration","706":"Valley View is a big world. It\'s up to you how you want to spend your time. Which of these aspirations best suits your style of play? (This choice will not limit your options in any way.)","721":"\ud83e\udd20 Meet Kent the Farm Manager","722":"First things first! Harvest some \ud83c\udf3e Wheat and sell it at the \ud83d\udce5 Trading Post for \ud83d\udcb0 Money.","723":"\ud83c\udf31 Get Farming","724":"Well done, you\'re making money now, so start Farming! Plant crops using the \ud83c\udf31 Farming panel, harvest them, and sell.","727":"\ud83d\udc75\ud83c\udffb Hire the Shepherd","728":"Nice work! Now hire the \ud83d\udc75\ud83c\udffb Shepherd from the \ud83c\udfe0 Farm House, and she\'ll help bring some \ud83d\udc2e animal life to the farm, so you can continue to expand your business.","729":"\ud83d\udc2e Animal Husbandry","730":"Welcome \ud83d\udc75\ud83c\udffb Shepherd! Now visit the \ud83d\udc2e Animal Panel to acquire a cow. Cows need \ud83d\udfe9 grass to graze, so place them carefully. And you already have your first \ud83d\udfeb Animal Stall; this is where you can produce milk once the cow is full.","731":"\u26cf\ufe0f Shape the Land","732":"Crops need dirt. Cows and sheep need \ud83d\udfe9 grass. Pavement can help contain the movements of people and animals. Use the \u26cf\ufe0f Tools to pave the land to your liking, and learn the  \ud83e\ude93 axe skill to chop trees for wood.","733":"\u2692\ufe0f Builder","734":"You\'ve mastered the \ud83e\ude93 axe -- excellent! Wood is useful for a number of things, including building crafting stations. You can also chop your way to the \ud83d\ude82 Train Station at the edge of your Homestead, where you can eventually travel into Town.","737":"Time to Explore","738":"Your Homestead is part of a larger Settlement of other players sharing a large Frontier. Zoom out (+ and -) to see the whole Settlement and Frontier. Use \u27a1\ufe0f Signposts to travel, or walk to the edge of any map. ENJOY PLAYING VALLEY VIEW!","750":"\ud83c\udf31 Farmer","751":"Cultivate your homestead, grow crops, tend animals, and craft goods to sell and trade with other players. Invest in farming and crafting skills to grow your profits.","752":"\u2694\ufe0f Adventurer","753":"Venture into the Valley for resources and rare items. Fight animals and creatures, uncover hidden locations, and meet magical characters. Invest in combat skills to become a formidable fighter.","754":"\ud83c\udfdb\ufe0f Politician","755":"Run for Mayor, set the tax rate, and earn tax revenue for your self. Invest in community buildings for the whole Town, like Hospitals, Schools, and Libraries, and help your settlement thrive.","795":"Skip Tutorial","796":"OK","797":"Back","798":"Play","800":"MORE CRAFTING STATION STRINGS:","801":"Acquire the ","802":" Skill at the ","803":" to increase the output of this station by ","805":"Your ","806":" Skill increases the base output of this station by ","810":"You can also purchase this skill directly: ","820":"Makes: ","821":"Base Amount: ","825":"You have ","826":"Scrolls.","827":"Scroll","899":"DEBUG STRINGS:","900":"Debug: Inventory cleared.","901":"Debug: Quest history cleared.","902":"Debug: Resources added.","903":"Debug: Grid successfully reset.","904":"Debug: Skills added.","905":"Debug: Skills & Powers cleared.","906":"Debug: Combat Stats reset.","999":"PANEL UI STRINGS:","1000":"[Description needed]","1001":"Resources collected at the homestead go into the warehouse. Resources collected in town or in the valley will go into the backpack. To buy a backpack, visit the Store in town. To empty the backpack or warehouse, use the Manage buttons.","1002":"Build crafting stations on your Homestead using resources from your warehouse.","1003":"Purchased animals will appear at your player icon, and immediately begin life on the homestead.","1004":"Till land to dirt in order to plant crops. Plant grass to give farm animals something to graze on.","1005":"Acquire Skills and Upgrades to improve various attributes. Make sure to explore the Town to find additional places and ways to gain Skills and Upgrades.","1006":"Manage your ongoing To Do list here. Look for quest-giving characters on your homestead as well as Town, or even the Valley.","1007":"Governments in Valley View are formed at the settlement level. The elected mayor implements policies and builds buildings to help the community thrive.","1008":"Buy and sell with other players. If no players buy your items before the timer expires, sell them to the game for a fraction of their base value.","1009":"[Crafting description]","1010":"[Mailbox description]","1011":"This Animal Stall is empty. Make sure animals have grass to eat, and they will eventually come to the stall for harvesting.","1012":"Elections take place in the Courthouse. Here, Mayors have the power to set the tax rate and rename the Settlement.","1013":" ","1014":" ","1015":"The game takes place over the course of continually changing seasons.","1016":" ","1017":"Visit the Bank to exchange items for Money, including rare items like Gold and Silver. Return to the bank regulalry for different offers.","1018":"","1019":"[Profile description]","1021":"\xa9 Valley View Studios, 2025, All Rights Reserved.","1022":"[Train description]","1023":"Workers help you run your homestead. Hire them at the Farm House.","1024":"[Combat description]","1025":"[Shop description]","1026":"Earning and spending Money.","1027":"These are the benefits of a Gold Pass.","1028":"[Decorations panel description]","1029":"[Animal panel]","1030":"[Crop panel]","1031":"Buy decorations for your homesetead. You will be able to sell these for a full refund.","1032":"The Farm House is where you can hire people to help you run your homestead.","1033":"Terraform the land with these tools. Animals need grass for grazing, crops need dirt to grow on. Pavement can be useful for controlling movements of animals and characters.","1034":"Earning and spending Gems.","1035":"This is your collection of lifetime Trophies.","1036":"Reveal mysterious scrolls at this Ancient Temple.","1101":"Inventory","1102":"\u2692\ufe0f Build","1103":"\ud83d\uded2 Buy","1104":"\ud83c\udf31 Farming","1105":"\ud83d\udcaa Skills","1106":"\u2705 To Do List","1107":"\ud83c\udfdb\ufe0f Government","1108":"\ud83d\udce5 Trade","1109":"Crafting","1110":"\ud83d\udcea Mailbox","1111":"\ud83d\udc3e Animals","1112":"\ud83c\udfdb\ufe0f Courthouse","1113":"Helper Character","1114":"\ud83d\ude00 Player Character","1115":"\ud83d\uddd3\ufe0f Season","1116":"\ud83d\udd01 Trader","1117":"\ud83c\udfe6 Bank","1118":"\ud83d\udd79\ufe0f How to Play","1119":"\ud83d\ude00 Profile","1120":"\ud83d\udc1e Debug","1121":"\ud83d\ude00 Welcome","1122":"\ud83d\ude82 Train","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Farm Hand","1124":"\u2694\ufe0f Combat","1125":"\ud83d\uded2 Shop","1126":"\ud83d\udcb0 About Money","1127":"\u2b50\ufe0f Gold Pass","1128":"\ud83e\udeb4 Decorations","1129":"\ud83d\udc3e Animals","1130":"\ud83c\udf31 Crops & Trees","1131":"\ud83e\udeb4 Decorations","1132":"\ud83c\udfe0 Farm House","1133":"\u26cf\ufe0f Tools","1134":"\ud83d\udc8e Gems","1135":"\ud83c\udfc6 Trophies","1136":"\ud83d\uded5 Ancient Temple","1200":"TRADER STORY STRINGS","1201":"Ah, the forest hides many secrets\u2026 and I? I\u2019ve stolen a few. These Gems, they\u2019re not mine, but Titania has more than she needs. You\u2019ve something I crave: Olive Bread, warm and rich. Trade with me, and I might whisper tales of glowing eyes in the dark, wings that shimmer at moonrise, and dragons that speak in riddles. Keep an ear open, and a dagger close.","1202":"My bounty is as boundless as the sea, my love as deep... but he is gone, and all that remains is a portrait and pain. Angelo took both. Bring me Romeo\u2019s likeness, torn from my chamber, and I\u2019ll give you Tulips red as the blood spilt on Verona\u2019s stones. Let this be our new balcony: you below, bearing justice.","1203":"Give me life, give me love, but most of all... give me Port! In exchange, a sprig of Feverfew, dearer than gold to some, especially that wide-eyed Helena. Says she\u2019s after crowns and legends, poor girl. Me? I\u2019m after a full belly and a gentle nap. \u2018Thou art so fat-witted with drinking of old sack,\u2019 they once told me. Ha! They were not wrong.","1204":"Here\u2019s rosemary, for remembrance\u2014and nightshade, for regrets. My potions are not for the faint of will. With the right leaf, I can mend your limbs or muddle your tongue. \u2018I do remember an apothecary,\u2019 said a boy once, and he paid the price. But you? You look wiser. Bring me rare roots and bitter seeds, and I\u2019ll mix you something worth the danger.","1205":"Something is rotten, still. I feel it in the soil. I once ruled, loved, lost. Helena burned through me like summer lightning. And Leontes? He could not forgive the thaw. \u2018The lady doth protest too much,\u2019 they said; let them. If you see Helena, tell her the roses know her name. If you see Leontes, tell him I have not forgotten the winter.","1206":"My grief is a statue; silent, but never still. I buried my crown in snow the day Gertrude chose her garden over me. \u2018Exit, pursued by a bear\u2019? No, I fled myself. Now I wait, among stone and silence. Bring me what was once mine, the King\u2019s Crown, and I\u2019ll pay in Gold, more than the weight of memory. But beware: some thrones carry curses.","1207":"This bridge is mine, by Sycorax my mother.\u2019 Prospero tried to steal it with spells and smiles. They called me beast, but I am of earth and storm, born to wild truth. I trade bones for Silver, tokens of the dead for coin of the living. Touch nothing lightly in these woods. Bring me what others fear, and I shall make you rich... or haunted.","1208":"","1301":"Skills to purchase:","1302":"Upgrades to purchase:","1303":"Skills you have:","1304":"Upgrades you have:","1305":"You have no skills yet.","1306":"You have no upgrades yet.","1400":"MODAL STRINGS","1401":"BANK MODAL","1402":"These offers good for","1403":"Will buy","1404":"for","1405":"No offers available.","1406":"New offers in","1407":"Generating new orders. Thank you for your patience.","1408":"\u26a0\ufe0f You don\'t have enough items.","1409":"\u26a0\ufe0f You don\'t have enough skills.","1410":"\u26a0\ufe0f You don\'t have enough upgrades.","1500":"TOWN NEWS STRINGS:","1501":"News for ","1502":"The current Mayor is","1503":", and the tax rate is","1504":"Here\'s what\'s happening in Town right now:","1505":"It\'s election season, and campaigning is in full swing. Stop by the Courthouse in Town to run for Mayor.","1506":"Voting for the next Mayor has begun. Cast your vote at the Courthouse in Town.","1507":"The Train is arriving, offering to buy:","1508":"The Train is departing. When it returns, it will be buying:","1509":"The Train is here, offering to buy:","1510":" ","1511":"Visit the Bank to sell gold, silver, and diamonds. The Bank is currently updating its offers.","1512":"There is currently no mayor. ","1513":"The Train is departing in","1514":"When it returns, it will be buying:","1515":"The tax rate is","1516":"The Bank is currently buying:","1517":"The Train will be departing in","1518":"The votes in the latest election for Mayor are being counted. Results expected in ","1600":"MAILBOX STRINGS:","1601":"Loading messages...","1602":"You have no messages.","1603":"Received","1604":"Collect","1605":"Most messages will be deleted afer 14 days. Store purchases will not be deleted.","1606":"\ud83d\udcea Mailbox","1607":"\ud83d\uddd1\ufe0f Message deleted.","1700":"STORE STRINGS:","1701":"\ud83d\uded2 Store","1702":"Purchases will be delivered to the Inbox.","1703":"\ud83d\ude4f Thank you for your support! We are a tiny developer with few resources, but passionate about creating a fun space for a positive community.","1704":"Please consider making purchases so we can continue to improve the game.","2000":"TRAIN, BANK, COURTHOUSE, etc. STRINGS:","2002":"Completed","2003":"\ud83d\ude82 Next Shipment Preview:","2004":"\ud83c\udf81 Rewards for filling all orders (sent to all who complete at least one order):","2005":"Click to fulfill","2006":"Your Order","2007":"Claimed","2008":"Claim Order","2009":"Claimed by you:","2010":"Available to claim:","2011":"Claimed by others:","2012":"Completed:","2013":"Claimed by you:","2014":"You can only claim one train offer at a time.","2015":"Show Train Log","2016":"\ud83c\udf89 All orders were completed! Rewards have been mailed out.","2017":"This order has already been claimed.","2020":"Train is","2030":"Offers Update in","2040":"Welcome, Mayor.","2041":"\ud83d\udcb0 Tax Rate: ","2042":"Proposed: ","2043":"Update","2044":"\u26a0\ufe0f Only the Mayor can set the tax rate.","2045":"\ud83d\uddf3\ufe0f Elections","2046":"Current Phase:","2047":"Phase Timer:","2048":"\ud83d\udce2 Campaign Promises","2060":"Voting begins in:","2061":"Voting ends in:","2062":"Voting has ended. Results announced in:","2063":"Next campaign begins in:","2070":"\ud83d\udce2 Campaign Promises","2071":"No one has made a campaign promise yet.","2072":"Enter your campaign promise (max 200 characters)...","2073":"Submit Campaign Promise","2074":"Cast Your Vote","2075":"No candidates available for voting.","2076":"Campaign promise:","2077":"You have already voted in this election.","2078":"There were no candidates.","2079":"How\'s your Mayor doing?","2080":"Welcome, Mayor.","2081":"Enter settlement name...","2082":"Your Settlement:","2083":"Update Name","2084":"Visit the \ud83c\udfdb\ufe0f Government Panel to view stats on how the settlement is doing, to help guide your election decision.","2085":"Current Mayor:","2090":"\ud83c\udfe4 Community Buildings","2092":"\ud83c\udfeb Schools: ","2093":"\ud83c\udfeb No Schools built yet.","2094":"\ud83c\udfe5 Hospitals: ","2095":"\ud83c\udfe5 No Hospitals built yet.","2096":"\ud83d\udc3e Animal Yards: ","2097":"\ud83d\udc3e No Animal Yards built yet.","2098":"\ud83c\udfe4 Libraries: ","2099":"\ud83c\udfe4 No Libraries built yet.","3000":"GOV PANEL:","3001":"Your Settlement:","3002":"\ud83d\ude0a Pop.","3003":"\ud83d\udcb0 Tax Rate:","3004":"The tax rate is set by the Mayor, for this Settlement, and a percentage of all taxes collected are added to the Mayor\'s bank account.","3005":"Mayors are elected at the Courthouse in Town.","3006":"\ud83c\udfdb\ufe0f Government Officials","3007":"No government officials elected yet.","3009":"Only the Mayor can build Schools, Hospitals and Libraries in the Town.","3010":"\ud83c\udfeb Schools give citizens access to certain Skills that cannot be gained elsewhere.","3011":"\ud83c\udfe5 Hospitals supply Doctors, who can heal adventurers returning from the Valley.","3012":"\ud83c\udfe4 Libraries are a source of Books, which are vital to Adventurers looking to learn new skills.","3013":"\ud83d\ude82 The Mayor can influence demand for goods at the Train.","3020":"View Tax Log","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"SEASON PANEL STRINGS","3051":"(Net worth is recalculated twice per day.)","3052":"No data available for top citizens.","3053":"It\'s","3054":"Loading...","3055":"Season ends in:","3056":"We are in between seasons.","3057":"At the end of the season, bonus rewards will be sent to the top players in the Frontier, as well as to all players in the top Settlement.","3058":"\ud83c\udfc6 Top Citizens in the Frontier","3059":"\ud83c\udfd9\ufe0f Leading Settlement","3060":"Total Wealth:","3061":"Population:","3062":"Unknown","3063":"No data available","3064":"View Season Log","4000":"LOGIN PANEL:","4001":"Don\'t have a profile? Create a new free profile to start playing:","4002":"New Profile","4003":"Username","4004":"You will not be asked for an email address.","4005":"With your own profile, you\'ll be granted your own homestead to cultivate in a Settlement with other players, in a Frontier full of Settlements. Adventure awaits you in the Valley.","4006":"Password","4007":"Login","4008":"Username","4009":"Login to your profile to continue playing. If you don\'t have an","4010":"Already have a profile?","4050":"PROFILE PANEL:","4051":"Hi, ","4052":"Change Username:","4053":"Change Password:","4054":"Profile Management","4055":"Profile Status:","4056":"Logout","4057":"Delete Your Profile","4058":"Player ID:","4059":"Homestead Relocation","4060":"Relocations Remaining:","4061":"Visit the Store to purchase more Relocations.","4062":"Settings","4063":"Language:","4064":"Range Indicator:","4065":"Change Avatar","4066":"Back to Login","4067":"Select Language","5000":"MORE MODAL STRINGS:","5001":"\ud83d\udc80 You have died.","5002":"You have been returned home. Any backpack \ud83c\udf92 items you had were lost.","5003":"Be more careful next time.","5005":"\ud83d\ude00 Welcome to Valley View\u2122","5006":"Please login, or create a free profile.","5007":"\xa9 Valley View Studios, 2025, All Rights Reserved.","5010":"\ud83d\udce8 Inbox","5011":"You have no messages","5015":"\ud83d\uded2 Store","5016":"Purchases will be delivered to the Inbox. We are unable to offer returns. All purchases are final.","5017":"Be aware that most inventory items are wiped between seasons, so please check the season clock before purchasing, and see the seasons panel for more information.","5020":"\ud83d\udeab You are currently logged out.","5021":"Click the Login or Create Profile button to begin.","5025":"\ud83d\ude4f Thank you for your support!","5026":"Your purchase has been delivered to your Inbox.","5027":"Enjoy Valley View!","5030":"\ud83d\ude00 Welcome to Valley View!","5031":"No player is logged in or the server is offline.","5032":"Please refresh the page, check your internet connetion, or return later.","5035":"We are between seasons!","5036":"Valley View is temporarily unavailable while we reset the season.","5040":"\ud83d\udcf0 Town News","5041":"Here\'s what\'s happening in Town right now:","5045":"Use ","5046":"Do you want to use a","5047":"You have ","5050":"\u26a0\ufe0f Confirm Homestead Move","5051":"Are you sure you want to move your homestead? This cannot be undone.","5052":"Close this dialog to cancel.","5060":"\u2b50\ufe0f Congratulations!","5061":"You now have a Gold Pass. Go to your Profile panel to customize your player icon, and discover other Gold benefits.","5062":"Thank you for your support!","5100":"Recent Tax Collections","5101":"No tax collection history available yet.","5102":"\ud83d\uddd3\ufe0f Date","5103":"\ud83d\udcb0 Total Collected","5104":"Mayor","5105":"\ud83d\udcb0 Mayor Take","5110":"","6000":"TROPHY STRINGS:","6001":"Here are your lifetime Trophies:","6002":"You have no trophies yet. Earn trophies for achievements throughout the game.","6003":"Trophy Earned!","7000":"NOTIFICAITION STRINGS:","7001":"Tip:","7005":"Use A-W-S-D or the Arrow Keys to Move.","7006":"Look for the \ud83d\udcaa icon to open the Skills panel.","7007":"Stand on grass, then find the \ud83d\udc2e Buy panel to purchase a cow. You\'ll first need the Husbandry skill.","7009":"Keep checking your \u2705 To-Do-List, and keep checking with \ud83e\udd20 Kent and \ud83d\udc75\ud83c\udffb the Shepherd.","7015":"Click + and - at the top of the screen to zoom in and out.","8999":"HOW TO PLAY STRINGS:","9000":"Welcome to Valley View!","9001":"What\u2019s it about?","9002":"Valley view is a game that explores how people might self organize and create micro societies in a world of asymmetric resources and interdependence, with both owned and shared spaces.","9003":"While there are no explicit specialization paths, there are three main vectors of play which are interdependent. These are: the FARMER, the ADVENTURER, and the POLITICIAN. You are encouraged to lean upon each other.","9004":"First, the basics:","9005":"Use A-W-S-D keys to MOVE. Click to interact with things that are within your interaction radius.","9006":"Explore \ud83c\udf31 FARMING, \u2692\ufe0f BUILD, and \ud83d\udc2e BUY to improve your Homestead and generate resources.","9007":"Generate \ud83d\udcb0 MONEY at the \ud83d\udce5 TRADING POST. Post resources for sale to other players, or sell them to the game for partial value.","9008":"More:","9009":"As you create wealth, improve yourself with SKILLS and ABILITIES. For example, purchase the \ud83d\udc34 HORSERIDING SKILL to venture into the Valley.","9010":"Zoom out (- and +) to see how big the world is. Your Homestead is one of many in a SETTLEMENT. Each SETTLEMENT has a shared TOWN. Your Settlement is one of many in the FRONTIER.","9011":"When you are ready, explore the VALLEY, which is full of danger and wonders. The secrets of the wizard PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f and the lost king LEONTES \ud83e\udd34, among others, can be found in the Valley.","9012":"Your Goals:","9013":"Feel free to create your own goals. Also, at the end of each \ud83d\uddd3\ufe0f SEASON, which runs three months, both individuals and settlements will be ranked, and top placement generates additional wealth. Your homsestead, all of your skills, and some of your wealth will carry over into the next Season.","9014":"Farm, craft, trade, explore, fight, and enjoy!","9020":"How to Earn Money","9021":"There are a few ways to make \ud83d\udcb0 MONEY.","9022":"As you are getting started, open the \ud83d\udce5 TRADING POST, which you will find in the upper left corner of your Homestead. Here, you can sell goods, including crops and crafts.","9023":"The \ud83d\udce5 TRADING POST will buy goods from you at 25% of their value. To maximize your earnings, you should trade with other players. They will have things you need, and vice versa.","9024":"As you advance, you\'ll be able to travel into TOWN using the \ud83c\udfdb\ufe0f SIGNPOST next to the TRAIN. There, you will find places like the BANK, which will buy specific items from you at a premium.","9025":"Spending Money","9026":"Surprise, most things cost Money. Initially, you will want to spend money on \ud83d\udcaa SKILLS, \ud83d\udc2e FARM ANIMALS, and \u2692\ufe0f CRAFTING STATIONS. Explore the panels at the left side of the screen. These will help you generate more resources, which in turn will help you earn more Money.","9027":"In TOWN you will disocver more Shops and Traders.","9030":"How to Earn Gems","9031":"Gems are a rare resource that can be used to purchase various things to help accelerate your play.","9032":"You can purchase Gems in the Store, or by clicking here:","9033":"On rare occassions, Gems can be found in the Valley, or earned as rewards for crushing it with the Train, or finishing strong at the end of a Season.","9040":"No Brainer:","9041":"100 \ud83d\udc8e Gems for ","9042":"Best Value:","9043":"500 \ud83d\udc8e Gems for ","9044":"Most Popular:","9045":"1000 \ud83d\udc8e Gems for ","9050":"Benefits","9051":"A Gold Pass gives you access to premium features and benefits in Valley View for the duration of a season.","9052":"With a Gold Pass, you can enjoy the following benefits:","9053":"\u2705 Premium avatars: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 Near unlimited Warehouse capacity","9055":"\u2705 Near unlimited Backpack capacity","9056":"\u2705 2 additional Trade Stall slots","9057":"\u2705 Lower Tax rate","9058":"\u2705 Half your MaxHP restored on death","9059":"\u2705 You can run for office","9060":"Thank you for your Gold Pass purchase.","9061":"Purchase a Gold Pass","9999":"ERROR STRINGS:","10000":"\ud83d\udd0c Server is Down","10001":"The server is currently down. We apologize for the inconvencient, please check back soon.","10002":"(This message will disappear when the server is back up.)","10100":"APP.JS STRINGS:","10101":"Welcome to Valley View!","10102":"Please login, or create a free profile.","10103":"\ud83c\udf92 Inventory","10104":"\ud83d\uded2 Store","10105":"\ud83d\udce8, Inbox","10106":"\ud83d\udce2 Share","10107":"\ud83d\udcac Chat","10108":"You Have a Gold Pass","10109":"\u2194\ufe0f Move Keys: ","10110":"\ud83d\udd79\ufe0f How to Play","10111":"You are the Mayor","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Health: ","10113":"\ud83d\uddd3\ufe0f It\'s","10114":"Next Season starts in:","10115":"\ud83d\uddd3\ufe0f Next Season:","10116":"\ud83c\udfdb\ufe0f Happening Now in Town:","10117":"\ud83d\udcb0 Next Tax Collection:","10118":"In: ","10119":"Now collecting taxes...","10120":"\ud83c\udfdb\ufe0f Elections: ","10121":"Ends: ","10122":"\ud83d\ude82 Train: ","10123":"\ud83c\udfe6 Bank: ","10124":"New Offers: ","10125":"Read the News!","10126":"Who\'s here:","10127":"No PCs present in the grid.","10128":"Save Changes","10129":"","10130":"You Have a Gold Pass","10131":"Gold Pass Benefits","10132":"Cancel Relocation","10133":"Relocate Homestead","11000":"ADDED STRINGS:","11001":"Wait for the timer to end, or for another player to buy this item.","12001":"Farming","12002":"Build","12003":"Animals","12004":"To Do List","12005":"Skills","12006":"Combat","12007":"Government","12008":"Seasons","12009":"Home","12010":"Profile","12011":"Decorations","12012":"Tools","12013":"Trophies","15000":"\ud83d\uddd3\ufe0f Season Rules","15001":"Seasons last three months.","15002":"Rewards","15003":"\ud83d\udcb0 Net worth will be calculated based on your money, inventory items, and items on your homestead.","15004":"\ud83c\udfc6 The top 3 players across the frontier will have rewards sent to your mailbox, and also earn a \u201cSeason Winner\u201d trophy.","15005":"\ud83c\udfc6 The top player in the frontier will also earn the \u201cSeason Champion\u201d trophy.","15006":"\ud83c\udf81 All players in the top settlement will receive additional rewards in your mailbox.","15007":"Resetting Players and Locations","15008":"\ud83c\udfe0 You will be relocated back to your homestead if you are away from home when the season ends.","15009":"\ud83c\udfe0 Your homesteads will NOT reset \u2013 all layout, tiles and resources carry over.","15010":"\ud83c\udf92 Your inventory WILL be wiped, with the exception of rare items like Prospero\u2019s Orb, King\u2019s Crown, Golden & Skeleton Keys, Trident).","15011":"\ud83d\udc8e You will keep all Gems.","15012":"\ud83d\udcb0 Money will be nerfed to 10% of the current amount (25% for Gold Pass holders).","15013":"\u2705 All quests will be wiped.","15014":"\ud83d\udcaa Your skills & powers carry over.","15015":"\u2764\ufe0f Your relationships carry over.","15016":"\u2b50\ufe0f Your Gold Pass status will be revoked for the new season.","15017":"\ud83c\udf32 All town and valley grids will be reset with fresh tiles, resources and enemies.","15018":"What Changes?","15019":"\ud83c\udf83 Towns will have tiles and resources according to the new season content.","15020":"\ud83d\ude00 New players joining (and creating new homesteads) will get starter tiles and resources according to the new season content.","15021":"\ud83d\ude82 Train orders are affected by the seasons.","15022":"\ud83c\udfc6 New rewards and trophies can be earned.","30000":"TROPHIES:","30001":"First Farm Worker","30002":"Skill Builder","30003":"Trains Completed","30004":"Season Winner","30005":"Season Champion","200000":"RESOURCES","200009":"Gold Account","200010":"Money","200011":"Stub","200012":"Signpost N","200013":"Signpost E","200014":"Signpost S","200015":"Signpost W","200016":"Signpost NW","200017":"Signpost NE","200018":"Signpost SE","200019":"Signpost SW","200020":"Signpost Town","200021":"Signpost Home","200022":"Trade Stall","200023":"Trading Post","200024":"Warehouse","200025":"Abandoned House","200026":"Farm House","200027":"Repair","200028":"Mountain","200029":"Mountain Large","200030":"Bank","200031":"Courthouse","200032":"Train","200033":"Mailbox","200034":"Oak Tree","200035":"Pine Tree","200036":"Palm Tree","200037":"Holiday Tree","200038":"Snowman","200039":"Rocks","200040":"Clay Pit","200041":"Wood","200042":"Stone","200043":"Clay","200044":"Wheat Plot","200045":"Carrot Plot","200046":"Corn Plot","200047":"Sugarcane Plot","200048":"Strawberry Plot","200049":"Apple Tree","200050":"Lemon Tree","200051":"Grape Vine","200052":"Garlic Plot","200053":"Olive Tree","200054":"Tomato Vine","200055":"Oak Tree Plot","200056":"Wheat","200057":"Carrot","200058":"Corn","200059":"Sugarcane","200060":"Strawberry","200061":"Apple","200062":"Lemon","200063":"Grapes","200064":"Garlic","200065":"Olive","200066":"Tomato","200067":"Blueberry","200068":"Milk","200069":"Wool","200070":"Egg","200071":"Flour","200072":"Chicken Feed","200073":"Sugar","200074":"Cornmeal","200075":"Lumber","200076":"Butter","200077":"Cream","200078":"Cheese","200079":"Thread","200080":"Cloth","200081":"Sweater","200082":"Jacket","200083":"Heavy Jacket","200084":"Runic Tunic","200085":"Bread","200086":"Cornbread","200087":"Apple Pie","200088":"Strawberry Pie","200089":"Lemon Cookie","200090":"Olive Bread","200091":"Garlic Bread","200092":"Queen\'s Cake","200093":"Tomato Soup","200094":"Carrot Soup","200095":"Omelette","200096":"Pizza","200097":"Honey","200098":"Apple Cider","200099":"Wine","200100":"Port","200101":"Olive Oil","200102":"Aged Wine","200103":"Pottery","200104":"Furniture","200105":"Ink","200106":"Urns","200107":"Rosemary","200108":"Mushroom","200109":"Magic Mushroom","200110":"Daisy","200111":"Tulip","200112":"Sunflower","200113":"Feverfew","200114":"Potion A","200115":"Potion B","200116":"Potion C","200117":"Gem","200118":"Book","200119":"Pelt","200120":"Bear Skin","200121":"Bones","200122":"Silver","200123":"Gold","200124":"Diamond Ring","200125":"King\'s Crown","200126":"Portrait","200127":"Trident","200128":"Skeleton Key","200129":"Golden Key","200130":"Scroll","200131":"Prospero\'s Orb","200132":"Tent","200133":"Boat","200134":"Shrine","200135":"Castle","200136":"Restaurant","200137":"Restroom","200138":"General Store","200139":"Warrior\'s Den","200140":"Magic Shop","200141":"Ancient Temple","200142":"Adventure Camp","200143":"Laboratory","200144":"School","200145":"Animal Stall","200146":"Mill","200147":"Dairy","200148":"Chicken Coop","200149":"Lumber Yard","200150":"Loom","200151":"Oven","200152":"Kitchen","200153":"Beehive","200154":"Studio","200155":"Winery","200156":"Library","200157":"Animal Yard","200158":"Hospital","200159":"Cow","200160":"Sheep","200161":"Brown Cow","200162":"Doctor","200163":"Surgeon","200164":"Fairy","200165":"Kent","200166":"Portia","200167":"The Shepherd","200168":"Hotspur","200169":"Cassio","200170":"Mistress Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampire","200175":"Santa Claus","200176":"Prospero","200177":"Falstaff","200178":"Apothecary","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Juliet","200184":"Mermaid","200185":"Farmer","200186":"Farm Hand","200187":"Rancher","200188":"Lumberjack","200189":"Coyote","200190":"Bear","200191":"Spider","200192":"Zombie","200193":"Duke Angelo","200194":"Ghost","200195":"Ogre","200196":"Demon","200197":"Dragon","200198":"Coyote Spawner","200199":"Bear Spawner","200200":"Spider Spawner","200201":"Zombie Spawner","200202":"Ghost Spawner","200203":"Demon Spawner","200204":"Dragon Spawner","200205":"Grower","200206":"Green Thumb","200207":"Husbandry","200208":"Bulk Animal Collect","200209":"Axe","200210":"Pickaxe","200211":"Builder","200212":"Bulk Harvest","200213":"Bulk Replant","200214":"Logging","200215":"Better Logging","200216":"Bulk Crafting","200217":"Bulk Restart Craft","200218":"Better Axe","200219":"Better Pickaxe","200220":"Storehouse","200221":"Depot","200222":"TBD Storage 3","200223":"TBD Storage 4","200224":"Masonry","200225":"Mechanics","200226":"Textiles","200227":"Artistry","200228":"Beekeeper","200229":"Tailor","200230":"Politics","200231":"Education","200232":"Chemistry","200233":"Cooking","200234":"Creamery","200235":"Baker","200236":"Winemaker","200237":"Miller","200238":"Artisan","200239":"Cuisinier","200240":"Weaver","200241":"Fowler","200242":"Fromager","200243":"Virtuose Culinaire","200244":"Apiarch","200245":"Vintner","200246":"Law","200247":"Medicine","200248":"Surgery","200249":"Backpack","200250":"Rucksack","200251":"Enchanted Pack","200252":"Horse","200253":"Tracking","200254":"Scout","200255":"Padding","200256":"Light Armor","200257":"Chainmail","200258":"Plate Armor","200259":"Heavy Armor","200260":"Mystic Armor","200261":"Caliban\'s Breastplate","200262":"Blessed Veil","200263":"Magic Helmet","200264":"Magic Gloves","200265":"Boots of Protection","200266":"Knife","200267":"Short Sword","200268":"Long Sword","200269":"Great Sword","200270":"Halberd","200271":"Sword of Song","200272":"Magic Halberd","200273":"Glowing Sword","200274":"Giant Axe","200275":"Legendary Sword","200276":"Dragonslayer","200277":"Darts","200278":"Short Bow","200279":"Long Bow","200280":"Spear","200281":"Crossbow","200282":"Magic Spear","200283":"Magic Crossbow","200284":"Titania\'s Bow","200285":"Legendary Crossbow","200286":"Tempest","200287":"Maelstrom","200288":"Oblivion","200289":"Titan","200290":"Jab","200291":"Flurry","200292":"Barrage","200293":"Steady Hand","200294":"Pinpoint","200295":"Unerring","200296":"Focus","200297":"Precision","200298":"Horizon Eye","200299":"Fortitude","200300":"Stoneheart","200301":"Unbreakable","200500":"Crate","200501":"Stone Wall","200502":"Stone Wall Large","200503":"Green Wall","200504":"Black Wall","200505":"Sand Wall","200506":"Blue Wall","200507":"Orange Wall","200508":"Plant","200509":"Cactus","200510":"Harp","200511":"Flag","200512":"Stack of Books","200513":"Chair","200514":"Toilet","200515":"Bed","200516":"Teddy Bear","200517":"Big Hole","200518":"Slide","200519":"Fountain","200520":"Fountain Large","200521":"Large Decorative Palm Tree","hp":"Hit Points","maxhp":"Max Hit Points","range":"Range","attackrange":"Attack Range","attackbonus":"Attack Bonus","damage":"Damage","speed":"Attack Speed","iscamping":"Is Camping","armorclass":"Armor Class","backpackCapacity":"Backpack Capacity","warehouseCapacity":"Warehouse Capacity"}'),p=JSON.parse('{"0":"Valley View","1":"Server is not running.","3":"\ud83c\udf31 Land successfully tilled.","4":"\u26a0\ufe0f You don\'t have enough resources.","5":"\u2692\ufe0f Construction completed successfully.","6":"\ud83d\udcb0 Items sold.","7":"\ud83c\udfe0 This homsetead is unoccupied.","8":"\ud83d\udeab This area is off limits.","9":"The Valley is full of wonders, and must be explored on foot.","10":"\ud83c\udfe0 [username]\'s homestead.","11":"\ud83c\udfe0 Unknown owner\'s homestead.","12":"Settlement view. Depending on your location, you may need to scroll to see the Town.","13":"Frontier view.","14":"\ud83c\udfdb\ufe0f Welcome to town.","15":"\ud83d\udc34 You need a Horse to travel here. Visit the Adventure Camp in Town.","16":"You\'re in the valley.","17":"You do not own a hometead here.","18":"\ud83d\udeab You can\'t go that way.","19":"\ud83c\udf92 You need a Backpack to collect resources away from your homestead. Buy one at the Adventure Camp.","20":"\ud83d\udeab Not enough room in the Warehouse.","21":"\ud83c\udf92 Not enough room in the Backpack. Open Inventory to manage Backpack contents.","22":"Items purchased.","23":"\u26a0\ufe0f You can\'t build that here.","24":"\ud83c\udfaf Out of range","25":"\ud83c\udf92 Nothing in the Backpack.","26":"\ud83c\udf92 You must be at your homestead to empty your Backpack.","27":"\u26fa\ufe0f You don\'t have a tent.","28":"\u26fa\ufe0f You are now camping.","29":"\u26a0\ufe0f \u26fa\ufe0f Failed to camp / decamp.","30":"\u26fa\ufe0f No longer camping.","31":"\u26fa\ufe0f Cannot attack while camping.","32":"\u26fa\ufe0f You need to decamp first.","33":"\ud83d\udce6 Moved items to the Warehouse.","34":"\ud83c\udf92 Emptied backpack.","35":"You need a ","36":"You used a ","50":"\ud83d\udeab That username is already taken.","70":"Session Expired","71":"You\'ve been away for a while. Refreshing ensures your session works properly.","72":"This page will auto-refresh in 30 seconds unless you do it now.","73":"\ud83d\udd04 Refresh Now","74":"\ud83c\udf92 A Backpack is required to own a Tent.","75":"You do not own a Backpack. You can purchase one at the Adventure Camp in Town.","76":"Your Warehouse is empty.","77":"Your Backpack is empty.","78":"Manage Contents","80":"Acquired ","90":"\ud83d\udeab This is not your homestead.","91":"\ud83d\udc34 Horse required.","94":"\ud83d\udce2 Share Valley View!","95":"Invite others to help out and join the adventure!","96":"Have Feedback?","97":"@ Email Us","98":"\u23f3 Loading ...","99":"\u26a0\ufe0f Something went wrong.","100":"TRAVELING STRINGS:","101":"\ud83d\udc34 Traveling home ... please wait.","102":"\ud83d\udc34 Traveling to town ... please wait.","103":"\ud83d\udc34 Traveling to the next location ... please wait.","104":"\ud83d\udeab No town in this settlement yet.","105":"\u26a0\ufe0f There was a problem trying to travel.","106":"\ud83d\udeab You cannot travel beyond the frontier.","110":"\u27a1\ufe0f Walk onto Signposts to use them","111":"Welcome to town.","112":"Welcome home.","120":"You don\'t have any homestead moves left.","121":"You have successfully moved your homestead.","122":"You cannot move to the valley!","123":"You cannot move to the town!","124":"That homestead is occupied.","125":"Where are you moving to?","130":"Select your language:","131":"Confirm","140":"TRADE STALL STRINGS:","141":"Sold","151":"You cannot fill another player\'s trade stall.","152":"You do not have enough money to buy this item.","153":"is selling:","154":"are selling","155":"Transaction failed. This item has already been sold.","156":"Click to sell","157":"Bought by","158":" limit per order.","159":"Ready to sell","160":"Items to Sell","161":"Item","162":"Available","163":"Price","164":"Amount","165":"All","166":"Add","167":"Sell","168":"Yes, Sell All","169":"Buy","170":"Unlocked trading slot","171":"Gold Pass Required","172":"Locked","173":"Limit of","174":"to Sell","175":"Unlock for","176":"Wood","177":"Need","178":"to unlock this slot","179":"This Outpost only accepts items from your backpack. Any player can collect money from an Outpost.","180":"INVENTORY STRINGS:","181":"\ud83d\udce6 Warehouse","182":"\ud83c\udf92 Backpack","183":"Capacity: ","184":"Manage Contents","185":"Quantity","186":"Amount","187":"Add to Warehouse","188":"Discard","189":"Add All to Warehouse","190":"Discard All","191":"Item","192":"Action","193":"Discard Items","194":"Expand Warehouse","195":"Expand Backpack at the Adventure Camp in Town.","199":"Near unlimited capacity with Gold Pass (among other benefits).","200":"QUESTS","201":"\u2705 Action item completed. You have your reward.","202":"\u2705 Action item accepted.","203":"No action items at the moment.","204":"To Do List:","205":"Nothing new at this time. Check your \u2705 To Do list!","206":"Return to the NPC who gave you this quest to collect your reward.","207":"In Progress","208":"Get Reward","209":"Accept","299":"FARMING STRINGS:","300":"Added","301":"\ud83c\udf31 Tilled","302":"\ud83c\udf31 Planted","303":"\ud83c\udf31 Must plant on dirt","304":"\ud83c\udf31 Can\'t plant here","305":"\u26a0\ufe0f Not enough resources","306":"\u26a0\ufe0f Can\'t build here","310":"You need to till the land for planting.","311":"Your farm animals will need plenty of grass to graze on.","312":"Pavement can be useful to control wandering animals.","313":"","315":"Select Crops to Harvest:","316":"Select All","317":"Deselect All","318":"Collect","319":"Select Animals to Collect:","320":"Cannot terraform here.","340":"Not avilable unless you\'re on foot.","341":"Select Crafting Stations to Collect:","342":"Harvest?","343":"Replant?","344":"No crops ready to harvest.","345":"Ready to Collect:","346":"Collect?","347":"Buy 1 for: ","350":"The Farm Hand will help you automate harvesting and planting of crops.","351":"The Rancher will help you automate collecting from animals.","352":"The Lumberjack will help you automate chopping trees for wood.","353":"The Crafter will help you automate collecting from crafting stations.","354":"Kent is your Farm Manager. He can help you run your homestead.","355":"The Shepherd will guide you in the management of your farm animals.","400":"BUYING, CRAFTING, SKILLS, HEALING, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Already at maximum hit points.","402":"\u26a0\ufe0f  resources.","403":"\u26a0\ufe0f Youre inventory is full.","404":"Working...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Hit Points healed by +","410":"\ud83c\udfd5\ufe0f To use a purchased tent, click on your own player icon.","420":"will trade you:","421":"Used In:","422":"Base Value:","423":"No trades available.","424":"No recipes available.","425":"Sell for refund","426":"Expensive starter crops, but in case you run out:","427":"Purchase the Farm Hand\'s Bulk Harvest skill to harvest all crops at once.","428":"Click to instantly harvest all crops.","429":"You have no crops to harvest.","430":"Purchase these farm skills:","431":"Purchase the Farm Hand\'s Bulk Animal Collect skill to collect from all animals at once.","432":"Purchase the Farm Hand\'s Logging skill to chop multiple trees at once and collect the wood.","433":"Purchase Better Logging to increase the number of trees chopped at once.","434":"Click to instantly collect from all animals.","435":"Click to instantly chop multiple trees and collect wood.","436":"You have no animals to collect from.","437":"You have no trees to chop.","438":"Remove Crop","439":"Crop returned.","440":"Started ","441":"\u231b\ufe0f Ready in ","442":"\ud83c\udfe0 House repairs complete!","450":"\u274c Cannot afford crafting costs","451":"\u26a0\ufe0f Crafting already in progress","452":"\u274c Failed to start crafting.","453":"\u274c Failed to repair house.","454":"\u274c Failed to hire worker.","455":" has arrived!","456":"No more workers available.","457":"Ready!","458":"Time: ","459":"Instant","460":"Requires: ","461":"Costs: ","462":"Gives: ","463":"Heals: ","464":"Purchase Bulk Crafting to collect from ready crafting stations all at once.","465":"Click to instantly collect from all ready crafting stations.","466":"You have no crafting stations ready to collect from.","467":"Bulk Crafting","468":"Restarted: ","469":"Collected","470":"Cannot travel right now, farming actions in progress.","471":"\u26a0\ufe0f Already in progress.","472":"Harvested","475":"Restart?","476":"Station","477":"Your farm workers are busy...","478":"\ud83c\udf31 Working","479":"Logging complete","480":"Crafted","481":"with","482":"applied","483":"replanted","490":"Sell for refund (Dev only)","500":"COMBAT STRINGS","501":"\ud83c\udfaf Out of range.","502":"\ud83c\udfaf Hit!","503":"\u274c Miss","504":"\ud83d\udc80 Killed","505":"\u26a0\ufe0f Error","510":"\u2764\ufe0f\u200d\ud83e\ude79 You\'re taking damage ...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Your Health: ","512":"Your Health Unavailable","600":"RELATIONSHIP STRINGS:","601":"Relationship:","602":"You\'ve met","603":"You\'re now friends with","604":"You have a crush on","605":"You\'re in love with","606":"You and","607":"are now married.","608":"are now rivals.","609":"is now your rival because of this.","610":"isn\'t going to be very happy about this...","611":"aren\'t going to be very happy about this...","612":"will be very happy about this.","613":"approve of this.","614":"and","615":"Your relationship with","616":"has changed.","620":"You need to move closer to interact with this character.","621":"for being married.","622":"for being friends.","623":"for being in love.","630":"Greet","631":"Talk","632":"Trade","633":"Quest","634":"Met","635":"Friend","636":"Married","637":"Rival","638":"Love","639":"Crush","640":"Joke","641":"Make Friends","642":"Insult","643":"Hug","644":"Kiss","645":"Apologize","646":"Give Gift","647":"Compliment","648":"Flatter","649":"Profess Love","650":"Propose","651":"Taunt","652":"Tease","653":"End Marriage","700":"FTUE STRINGS:","701":"\ud83d\udc78 Welcome to Valley View","702":"Welcome, traveler! You\'ve arrived in Valley View, a frontier land of opportunity, mystery and adventure.","705":"Aspiration","706":"Valley View is a big world. It\'s up to you how you want to spend your time. Which of these aspirations best suits your style of play? (This choice will not limit your options in any way.)","721":"\ud83e\udd20 Meet Kent the Farm Manager","722":"First things first! Harvest some \ud83c\udf3e Wheat and sell it at the \ud83d\udce5 Trading Post for \ud83d\udcb0 Money.","723":"\ud83c\udf31 Get Farming","724":"Well done, you\'re making money now, so start Farming! Plant crops using the \ud83c\udf31 Farming panel, harvest them, and sell.","727":"\ud83d\udc75\ud83c\udffb Hire the Shepherd","728":"Nice work! Now hire the \ud83d\udc75\ud83c\udffb Shepherd from the \ud83c\udfe0 Farm House, and she\'ll help bring some \ud83d\udc2e animal life to the farm, so you can continue to expand your business.","729":"\ud83d\udc2e Animal Husbandry","730":"Welcome \ud83d\udc75\ud83c\udffb Shepherd! Now visit the \ud83d\udc2e Animal Panel to acquire a cow. Cows need \ud83d\udfe9 grass to graze, so place them carefully. And you already have your first \ud83d\udfeb Animal Stall; this is where you can produce milk once the cow is full.","731":"\u26cf\ufe0f Shape the Land","732":"Crops need dirt. Cows and sheep need \ud83d\udfe9 grass. Pavement can help contain the movements of people and animals. Use the \u26cf\ufe0f Tools to pave the land to your liking, and learn the  \ud83e\ude93 axe skill to chop trees for wood.","733":"\u2692\ufe0f Builder","734":"You\'ve mastered the \ud83e\ude93 axe -- excellent! Wood is useful for a number of things, including building crafting stations. You can also chop your way to the \ud83d\ude82 Train Station at the edge of your Homestead, where you can eventually travel into Town.","737":"Time to Explore","738":"Your Homestead is part of a larger Settlement of other players sharing a large Frontier. Zoom out (+ and -) to see the whole Settlement and Frontier. Use \u27a1\ufe0f Signposts to travel, or walk to the edge of any map. ENJOY PLAYING VALLEY VIEW!","750":"\ud83c\udf31 Farmer","751":"Cultivate your homestead, grow crops, tend animals, and craft goods to sell and trade with other players. Invest in farming and crafting skills to grow your profits.","752":"\u2694\ufe0f Adventurer","753":"Venture into the Valley for resources and rare items. Fight animals and creatures, uncover hidden locations, and meet magical characters. Invest in combat skills to become a formidable fighter.","754":"\ud83c\udfdb\ufe0f Politician","755":"Run for Mayor, set the tax rate, and earn tax revenue for your self. Invest in community buildings for the whole Town, like Hospitals, Schools, and Libraries, and help your settlement thrive.","795":"Skip Tutorial","796":"OK","797":"Back","798":"Play","800":"MORE CRAFTING STATION STRINGS:","801":"Acquire the ","802":" Skill at the ","803":" to increase the output of this station by ","805":"Your ","806":" Skill increases the base output of this station by ","810":"You can also purchase this skill directly: ","820":"Makes: ","821":"Base Amount: ","825":"You have ","826":"Scrolls.","827":"Scroll","899":"DEBUG STRINGS:","900":"Debug: Inventory cleared.","901":"Debug: Quest history cleared.","902":"Debug: Resources added.","903":"Debug: Grid successfully reset.","904":"Debug: Skills added.","905":"Debug: Skills & Powers cleared.","906":"Debug: Combat Stats reset.","999":"PANEL UI STRINGS:","1000":"[Description needed]","1001":"Resources collected at the homestead go into the warehouse. Resources collected in town or in the valley will go into the backpack. To buy a backpack, visit the Store in town. To empty the backpack or warehouse, use the Manage buttons.","1002":"Build crafting stations on your Homestead using resources from your warehouse.","1003":"Purchased animals will appear at your player icon, and immediately begin life on the homestead.","1004":"Till land to dirt in order to plant crops. Plant grass to give farm animals something to graze on.","1005":"Acquire Skills and Upgrades to improve various attributes. Make sure to explore the Town to find additional places and ways to gain Skills and Upgrades.","1006":"Manage your ongoing To Do list here. Look for quest-giving characters on your homestead as well as Town, or even the Valley.","1007":"Governments in Valley View are formed at the settlement level. The elected mayor implements policies and builds buildings to help the community thrive.","1008":"Buy and sell with other players. If no players buy your items before the timer expires, sell them to the game for a fraction of their base value.","1009":"[Crafting description]","1010":"[Mailbox description]","1011":"This Animal Stall is empty. Make sure animals have grass to eat, and they will eventually come to the stall for harvesting.","1012":"Elections take place in the Courthouse. Here, Mayors have the power to set the tax rate and rename the Settlement.","1013":" ","1014":" ","1015":"The game takes place over the course of continually changing seasons.","1016":" ","1017":"Visit the Bank to exchange items for Money, including rare items like Gold and Silver. Return to the bank regulalry for different offers.","1018":"","1019":"[Profile description]","1021":"\xa9 Valley View Studios, 2025, All Rights Reserved.","1022":"[Train description]","1023":"Workers help you run your homestead. Hire them at the Farm House.","1024":"[Combat description]","1025":"[Shop description]","1026":"Earning and spending Money.","1027":"These are the benefits of a Gold Pass.","1028":"[Decorations panel description]","1029":"[Animal panel]","1030":"[Crop panel]","1031":"Buy decorations for your homesetead. You will be able to sell these for a full refund.","1032":"The Farm House is where you can hire people to help you run your homestead.","1033":"Terraform the land with these tools. Animals need grass for grazing, crops need dirt to grow on. Pavement can be useful for controlling movements of animals and characters.","1034":"Earning and spending Gems.","1035":"This is your collection of lifetime Trophies.","1036":"Reveal mysterious scrolls at this Ancient Temple.","1101":"Inventory","1102":"\u2692\ufe0f Build","1103":"\ud83d\uded2 Buy","1104":"\ud83c\udf31 Farming","1105":"\ud83d\udcaa Skills","1106":"\u2705 To Do List","1107":"\ud83c\udfdb\ufe0f Government","1108":"\ud83d\udce5 Trade","1109":"Crafting","1110":"\ud83d\udcea Mailbox","1111":"\ud83d\udc3e Animals","1112":"\ud83c\udfdb\ufe0f Courthouse","1113":"Helper Character","1114":"\ud83d\ude00 Player Character","1115":"\ud83d\uddd3\ufe0f Season","1116":"\ud83d\udd01 Trader","1117":"\ud83c\udfe6 Bank","1118":"\ud83d\udd79\ufe0f How to Play","1119":"\ud83d\ude00 Profile","1120":"\ud83d\udc1e Debug","1121":"\ud83d\ude00 Welcome","1122":"\ud83d\ude82 Train","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Farm Hand","1124":"\u2694\ufe0f Combat","1125":"\ud83d\uded2 Shop","1126":"\ud83d\udcb0 About Money","1127":"\u2b50\ufe0f Gold Pass","1128":"\ud83e\udeb4 Decorations","1129":"\ud83d\udc3e Animals","1130":"\ud83c\udf31 Crops & Trees","1131":"\ud83e\udeb4 Decorations","1132":"\ud83c\udfe0 Farm House","1133":"\u26cf\ufe0f Tools","1134":"\ud83d\udc8e Gems","1135":"\ud83c\udfc6 Trophies","1136":"\ud83d\uded5 Ancient Temple","1200":"TRADER STORY STRINGS","1201":"Ah, the forest hides many secrets\u2026 and I? I\u2019ve stolen a few. These Gems, they\u2019re not mine, but Titania has more than she needs. You\u2019ve something I crave: Olive Bread, warm and rich. Trade with me, and I might whisper tales of glowing eyes in the dark, wings that shimmer at moonrise, and dragons that speak in riddles. Keep an ear open, and a dagger close.","1202":"My bounty is as boundless as the sea, my love as deep... but he is gone, and all that remains is a portrait and pain. Angelo took both. Bring me Romeo\u2019s likeness, torn from my chamber, and I\u2019ll give you Tulips red as the blood spilt on Verona\u2019s stones. Let this be our new balcony: you below, bearing justice.","1203":"Give me life, give me love, but most of all... give me Port! In exchange, a sprig of Feverfew, dearer than gold to some, especially that wide-eyed Helena. Says she\u2019s after crowns and legends, poor girl. Me? I\u2019m after a full belly and a gentle nap. \u2018Thou art so fat-witted with drinking of old sack,\u2019 they once told me. Ha! They were not wrong.","1204":"Here\u2019s rosemary, for remembrance\u2014and nightshade, for regrets. My potions are not for the faint of will. With the right leaf, I can mend your limbs or muddle your tongue. \u2018I do remember an apothecary,\u2019 said a boy once, and he paid the price. But you? You look wiser. Bring me rare roots and bitter seeds, and I\u2019ll mix you something worth the danger.","1205":"Something is rotten, still. I feel it in the soil. I once ruled, loved, lost. Helena burned through me like summer lightning. And Leontes? He could not forgive the thaw. \u2018The lady doth protest too much,\u2019 they said; let them. If you see Helena, tell her the roses know her name. If you see Leontes, tell him I have not forgotten the winter.","1206":"My grief is a statue; silent, but never still. I buried my crown in snow the day Gertrude chose her garden over me. \u2018Exit, pursued by a bear\u2019? No, I fled myself. Now I wait, among stone and silence. Bring me what was once mine, the King\u2019s Crown, and I\u2019ll pay in Gold, more than the weight of memory. But beware: some thrones carry curses.","1207":"This bridge is mine, by Sycorax my mother.\u2019 Prospero tried to steal it with spells and smiles. They called me beast, but I am of earth and storm, born to wild truth. I trade bones for Silver, tokens of the dead for coin of the living. Touch nothing lightly in these woods. Bring me what others fear, and I shall make you rich... or haunted.","1208":"","1301":"Skills to purchase:","1302":"Upgrades to purchase:","1303":"Skills you have:","1304":"Upgrades you have:","1305":"You have no skills yet.","1306":"You have no upgrades yet.","1400":"MODAL STRINGS","1401":"BANK MODAL","1402":"These offers good for","1403":"Will buy","1404":"for","1405":"No offers available.","1406":"New offers in","1407":"Generating new orders. Thank you for your patience.","1408":"\u26a0\ufe0f You don\'t have enough items.","1409":"\u26a0\ufe0f You don\'t have enough skills.","1410":"\u26a0\ufe0f You don\'t have enough upgrades.","1500":"TOWN NEWS STRINGS:","1501":"News for ","1502":"The current Mayor is","1503":", and the tax rate is","1504":"Here\'s what\'s happening in Town right now:","1505":"It\'s election season, and campaigning is in full swing. Stop by the Courthouse in Town to run for Mayor.","1506":"Voting for the next Mayor has begun. Cast your vote at the Courthouse in Town.","1507":"The Train is arriving, offering to buy:","1508":"The Train is departing. When it returns, it will be buying:","1509":"The Train is here, offering to buy:","1510":" ","1511":"Visit the Bank to sell gold, silver, and diamonds. The Bank is currently updating its offers.","1512":"There is currently no mayor. ","1513":"The Train is departing in","1514":"When it returns, it will be buying:","1515":"The tax rate is","1516":"The Bank is currently buying:","1517":"The Train will be departing in","1518":"The votes in the latest election for Mayor are being counted. Results expected in ","1600":"MAILBOX STRINGS:","1601":"Loading messages...","1602":"You have no messages.","1603":"Received","1604":"Collect","1605":"Most messages will be deleted afer 14 days. Store purchases will not be deleted.","1606":"\ud83d\udcea Mailbox","1607":"\ud83d\uddd1\ufe0f Message deleted.","1700":"STORE STRINGS:","1701":"\ud83d\uded2 Store","1702":"Purchases will be delivered to the Inbox.","1703":"\ud83d\ude4f Thank you for your support! We are a tiny developer with few resources, but passionate about creating a fun space for a positive community.","1704":"Please consider making purchases so we can continue to improve the game.","2000":"TRAIN, BANK, COURTHOUSE, etc. STRINGS:","2002":"Completed","2003":"\ud83d\ude82 Next Shipment Preview:","2004":"\ud83c\udf81 Rewards for filling all orders (sent to all who complete at least one order):","2005":"Click to fulfill","2006":"Your Order","2007":"Claimed","2008":"Claim Order","2009":"Claimed by you:","2010":"Available to claim:","2011":"Claimed by others:","2012":"Completed:","2013":"Claimed by you:","2014":"You can only claim one train offer at a time.","2015":"Show Train Log","2016":"\ud83c\udf89 All orders were completed! Rewards have been mailed out.","2017":"This order has already been claimed.","2020":"Train is","2030":"Offers Update in","2040":"Welcome, Mayor.","2041":"\ud83d\udcb0 Tax Rate: ","2042":"Proposed: ","2043":"Update","2044":"\u26a0\ufe0f Only the Mayor can set the tax rate.","2045":"\ud83d\uddf3\ufe0f Elections","2046":"Current Phase:","2047":"Phase Timer:","2048":"\ud83d\udce2 Campaign Promises","2060":"Voting begins in:","2061":"Voting ends in:","2062":"Voting has ended. Results announced in:","2063":"Next campaign begins in:","2070":"\ud83d\udce2 Campaign Promises","2071":"No one has made a campaign promise yet.","2072":"Enter your campaign promise (max 200 characters)...","2073":"Submit Campaign Promise","2074":"Cast Your Vote","2075":"No candidates available for voting.","2076":"Campaign promise:","2077":"You have already voted in this election.","2078":"There were no candidates.","2079":"How\'s your Mayor doing?","2080":"Welcome, Mayor.","2081":"Enter settlement name...","2082":"Your Settlement:","2083":"Update Name","2084":"Visit the \ud83c\udfdb\ufe0f Government Panel to view stats on how the settlement is doing, to help guide your election decision.","2085":"Current Mayor:","2090":"\ud83c\udfe4 Community Buildings","2092":"\ud83c\udfeb Schools: ","2093":"\ud83c\udfeb No Schools built yet.","2094":"\ud83c\udfe5 Hospitals: ","2095":"\ud83c\udfe5 No Hospitals built yet.","2096":"\ud83d\udc3e Animal Yards: ","2097":"\ud83d\udc3e No Animal Yards built yet.","2098":"\ud83c\udfe4 Libraries: ","2099":"\ud83c\udfe4 No Libraries built yet.","3000":"GOV PANEL:","3001":"Your Settlement:","3002":"\ud83d\ude0a Pop.","3003":"\ud83d\udcb0 Tax Rate:","3004":"The tax rate is set by the Mayor, for this Settlement, and a percentage of all taxes collected are added to the Mayor\'s bank account.","3005":"Mayors are elected at the Courthouse in Town.","3006":"\ud83c\udfdb\ufe0f Government Officials","3007":"No government officials elected yet.","3009":"Only the Mayor can build Schools, Hospitals and Libraries in the Town.","3010":"\ud83c\udfeb Schools give citizens access to certain Skills that cannot be gained elsewhere.","3011":"\ud83c\udfe5 Hospitals supply Doctors, who can heal adventurers returning from the Valley.","3012":"\ud83c\udfe4 Libraries are a source of Books, which are vital to Adventurers looking to learn new skills.","3013":"\ud83d\ude82 The Mayor can influence demand for goods at the Train.","3020":"View Tax Log","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"SEASON PANEL STRINGS","3051":"(Net worth is recalculated twice per day.)","3052":"No data available for top citizens.","3053":"It\'s","3054":"Loading...","3055":"Season ends in:","3056":"We are in between seasons.","3057":"At the end of the season, bonus rewards will be sent to the top players in the Frontier, as well as to all players in the top Settlement.","3058":"\ud83c\udfc6 Top Citizens in the Frontier","3059":"\ud83c\udfd9\ufe0f Leading Settlement","3060":"Total Wealth:","3061":"Population:","3062":"Unknown","3063":"No data available","3064":"View Season Log","4000":"LOGIN PANEL:","4001":"Don\'t have a profile? Create a new free profile to start playing:","4002":"New Profile","4003":"Username","4004":"You will not be asked for an email address.","4005":"With your own profile, you\'ll be granted your own homestead to cultivate in a Settlement with other players, in a Frontier full of Settlements. Adventure awaits you in the Valley.","4006":"Password","4007":"Login","4008":"Username","4009":"Login to your profile to continue playing. If you don\'t have an","4010":"Already have a profile?","4050":"PROFILE PANEL:","4051":"Hi, ","4052":"Change Username:","4053":"Change Password:","4054":"Profile Management","4055":"Profile Status:","4056":"Logout","4057":"Delete Your Profile","4058":"Player ID:","4059":"Homestead Relocation","4060":"Relocations Remaining:","4061":"Visit the Store to purchase more Relocations.","4062":"Settings","4063":"Language:","4064":"Range Indicator:","4065":"Change Avatar","4066":"Back to Login","4067":"Select Language","5000":"MORE MODAL STRINGS:","5001":"\ud83d\udc80 You have died.","5002":"You have been returned home. Any backpack \ud83c\udf92 items you had were lost.","5003":"Be more careful next time.","5005":"\ud83d\ude00 Welcome to Valley View\u2122","5006":"Please login, or create a free profile.","5007":"\xa9 Valley View Studios, 2025, All Rights Reserved.","5010":"\ud83d\udce8 Inbox","5011":"You have no messages","5015":"\ud83d\uded2 Store","5016":"Purchases will be delivered to the Inbox. We are unable to offer returns. All purchases are final.","5017":"Be aware that most inventory items are wiped between seasons, so please check the season clock before purchasing, and see the seasons panel for more information.","5020":"\ud83d\udeab You are currently logged out.","5021":"Click the Login or Create Profile button to begin.","5025":"\ud83d\ude4f Thank you for your support!","5026":"Your purchase has been delivered to your Inbox.","5027":"Enjoy Valley View!","5030":"\ud83d\ude00 Welcome to Valley View!","5031":"No player is logged in or the server is offline.","5032":"Please refresh the page, check your internet connetion, or return later.","5035":"We are between seasons!","5036":"Valley View is temporarily unavailable while we reset the season.","5040":"\ud83d\udcf0 Town News","5041":"Here\'s what\'s happening in Town right now:","5045":"Use ","5046":"Do you want to use a","5047":"You have ","5050":"\u26a0\ufe0f Confirm Homestead Move","5051":"Are you sure you want to move your homestead? This cannot be undone.","5052":"Close this dialog to cancel.","5060":"\u2b50\ufe0f Congratulations!","5061":"You now have a Gold Pass. Go to your Profile panel to customize your player icon, and discover other Gold benefits.","5062":"Thank you for your support!","5100":"Recent Tax Collections","5101":"No tax collection history available yet.","5102":"\ud83d\uddd3\ufe0f Date","5103":"\ud83d\udcb0 Total Collected","5104":"Mayor","5105":"\ud83d\udcb0 Mayor Take","5110":"","6000":"TROPHY STRINGS:","6001":"Here are your lifetime Trophies:","6002":"You have no trophies yet. Earn trophies for achievements throughout the game.","6003":"Trophy Earned!","7000":"NOTIFICAITION STRINGS:","7001":"Tip:","7005":"Use A-W-S-D or the Arrow Keys to Move.","7006":"Look for the \ud83d\udcaa icon to open the Skills panel.","7007":"Stand on grass, then find the \ud83d\udc2e Buy panel to purchase a cow. You\'ll first need the Husbandry skill.","7009":"Keep checking your \u2705 To-Do-List, and keep checking with \ud83e\udd20 Kent and \ud83d\udc75\ud83c\udffb the Shepherd.","7015":"Click + and - at the top of the screen to zoom in and out.","8999":"HOW TO PLAY STRINGS:","9000":"Welcome to Valley View!","9001":"What\u2019s it about?","9002":"Valley view is a game that explores how people might self organize and create micro societies in a world of asymmetric resources and interdependence, with both owned and shared spaces.","9003":"While there are no explicit specialization paths, there are three main vectors of play which are interdependent. These are: the FARMER, the ADVENTURER, and the POLITICIAN. You are encouraged to lean upon each other.","9004":"First, the basics:","9005":"Use A-W-S-D keys to MOVE. Click to interact with things that are within your interaction radius.","9006":"Explore \ud83c\udf31 FARMING, \u2692\ufe0f BUILD, and \ud83d\udc2e BUY to improve your Homestead and generate resources.","9007":"Generate \ud83d\udcb0 MONEY at the \ud83d\udce5 TRADING POST. Post resources for sale to other players, or sell them to the game for partial value.","9008":"More:","9009":"As you create wealth, improve yourself with SKILLS and ABILITIES. For example, purchase the \ud83d\udc34 HORSERIDING SKILL to venture into the Valley.","9010":"Zoom out (- and +) to see how big the world is. Your Homestead is one of many in a SETTLEMENT. Each SETTLEMENT has a shared TOWN. Your Settlement is one of many in the FRONTIER.","9011":"When you are ready, explore the VALLEY, which is full of danger and wonders. The secrets of the wizard PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f and the lost king LEONTES \ud83e\udd34, among others, can be found in the Valley.","9012":"Your Goals:","9013":"Feel free to create your own goals. Also, at the end of each \ud83d\uddd3\ufe0f SEASON, which runs three months, both individuals and settlements will be ranked, and top placement generates additional wealth. Your homsestead, all of your skills, and some of your wealth will carry over into the next Season.","9014":"Farm, craft, trade, explore, fight, and enjoy!","9020":"How to Earn Money","9021":"There are a few ways to make \ud83d\udcb0 MONEY.","9022":"As you are getting started, open the \ud83d\udce5 TRADING POST, which you will find in the upper left corner of your Homestead. Here, you can sell goods, including crops and crafts.","9023":"The \ud83d\udce5 TRADING POST will buy goods from you at 25% of their value. To maximize your earnings, you should trade with other players. They will have things you need, and vice versa.","9024":"As you advance, you\'ll be able to travel into TOWN using the \ud83c\udfdb\ufe0f SIGNPOST next to the TRAIN. There, you will find places like the BANK, which will buy specific items from you at a premium.","9025":"Spending Money","9026":"Surprise, most things cost Money. Initially, you will want to spend money on \ud83d\udcaa SKILLS, \ud83d\udc2e FARM ANIMALS, and \u2692\ufe0f CRAFTING STATIONS. Explore the panels at the left side of the screen. These will help you generate more resources, which in turn will help you earn more Money.","9027":"In TOWN you will disocver more Shops and Traders.","9030":"How to Earn Gems","9031":"Gems are a rare resource that can be used to purchase various things to help accelerate your play.","9032":"You can purchase Gems in the Store, or by clicking here:","9033":"On rare occassions, Gems can be found in the Valley, or earned as rewards for crushing it with the Train, or finishing strong at the end of a Season.","9040":"No Brainer:","9041":"100 \ud83d\udc8e Gems for ","9042":"Best Value:","9043":"500 \ud83d\udc8e Gems for ","9044":"Most Popular:","9045":"1000 \ud83d\udc8e Gems for ","9050":"Benefits","9051":"A Gold Pass gives you access to premium features and benefits in Valley View for the duration of a season.","9052":"With a Gold Pass, you can enjoy the following benefits:","9053":"\u2705 Premium avatars: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 Near unlimited Warehouse capacity","9055":"\u2705 Near unlimited Backpack capacity","9056":"\u2705 2 additional Trade Stall slots","9057":"\u2705 Lower Tax rate","9058":"\u2705 Half your MaxHP restored on death","9059":"\u2705 You can run for office","9060":"Thank you for your Gold Pass purchase.","9061":"Purchase a Gold Pass","9999":"ERROR STRINGS:","10000":"\ud83d\udd0c Server is Down","10001":"The server is currently down. We apologize for the inconvencient, please check back soon.","10002":"(This message will disappear when the server is back up.)","10100":"APP.JS STRINGS:","10101":"Welcome to Valley View!","10102":"Please login, or create a free profile.","10103":"\ud83c\udf92 Inventory","10104":"\ud83d\uded2 Store","10105":"\ud83d\udce8, Inbox","10106":"\ud83d\udce2 Share","10107":"\ud83d\udcac Chat","10108":"You Have a Gold Pass","10109":"\u2194\ufe0f Move Keys: ","10110":"\ud83d\udd79\ufe0f How to Play","10111":"You are the Mayor","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Health: ","10113":"\ud83d\uddd3\ufe0f It\'s","10114":"Next Season starts in:","10115":"\ud83d\uddd3\ufe0f Next Season:","10116":"\ud83c\udfdb\ufe0f Happening Now in Town:","10117":"\ud83d\udcb0 Next Tax Collection:","10118":"In: ","10119":"Now collecting taxes...","10120":"\ud83c\udfdb\ufe0f Elections: ","10121":"Ends: ","10122":"\ud83d\ude82 Train: ","10123":"\ud83c\udfe6 Bank: ","10124":"New Offers: ","10125":"Read the News!","10126":"Who\'s here:","10127":"No PCs present in the grid.","10128":"Save Changes","10129":"","10130":"You Have a Gold Pass","10131":"Gold Pass Benefits","10132":"Cancel Relocation","10133":"Relocate Homestead","11000":"ADDED STRINGS:","11001":"Wait for the timer to end, or for another player to buy this item.","12001":"Farming","12002":"Build","12003":"Animals","12004":"To Do List","12005":"Skills","12006":"Combat","12007":"Government","12008":"Seasons","12009":"Home","12010":"Profile","12011":"Decorations","12012":"Tools","12013":"Trophies","15000":"\ud83d\uddd3\ufe0f Season Rules","15001":"Seasons last three months.","15002":"Rewards","15003":"\ud83d\udcb0 Net worth will be calculated based on your money, inventory items, and items on your homestead.","15004":"\ud83c\udfc6 The top 3 players across the frontier will have rewards sent to your mailbox, and also earn a \u201cSeason Winner\u201d trophy.","15005":"\ud83c\udfc6 The top player in the frontier will also earn the \u201cSeason Champion\u201d trophy.","15006":"\ud83c\udf81 All players in the top settlement will receive additional rewards in your mailbox.","15007":"Resetting Players and Locations","15008":"\ud83c\udfe0 You will be relocated back to your homestead if you are away from home when the season ends.","15009":"\ud83c\udfe0 Your homesteads will NOT reset \u2013 all layout, tiles and resources carry over.","15010":"\ud83c\udf92 Your inventory WILL be wiped, with the exception of rare items like Prospero\u2019s Orb, King\u2019s Crown, Golden & Skeleton Keys, Trident).","15011":"\ud83d\udc8e You will keep all Gems.","15012":"\ud83d\udcb0 Money will be nerfed to 10% of the current amount (25% for Gold Pass holders).","15013":"\u2705 All quests will be wiped.","15014":"\ud83d\udcaa Your skills & powers carry over.","15015":"\u2764\ufe0f Your relationships carry over.","15016":"\u2b50\ufe0f Your Gold Pass status will be revoked for the new season.","15017":"\ud83c\udf32 All town and valley grids will be reset with fresh tiles, resources and enemies.","15018":"What Changes?","15019":"\ud83c\udf83 Towns will have tiles and resources according to the new season content.","15020":"\ud83d\ude00 New players joining (and creating new homesteads) will get starter tiles and resources according to the new season content.","15021":"\ud83d\ude82 Train orders are affected by the seasons.","15022":"\ud83c\udfc6 New rewards and trophies can be earned.","30000":"TROPHIES:","30001":"First Farm Worker","30002":"Skill Builder","30003":"Trains Completed","30004":"Season Winner","30005":"Season Champion","200000":"RESOURCES","200009":"Gold Account","200010":"Money","200011":"Stub","200012":"Signpost N","200013":"Signpost E","200014":"Signpost S","200015":"Signpost W","200016":"Signpost NW","200017":"Signpost NE","200018":"Signpost SE","200019":"Signpost SW","200020":"Signpost Town","200021":"Signpost Home","200022":"Trade Stall","200023":"Trading Post","200024":"Warehouse","200025":"Abandoned House","200026":"Farm House","200027":"Repair","200028":"Mountain","200029":"Mountain Large","200030":"Bank","200031":"Courthouse","200032":"Train","200033":"Mailbox","200034":"Oak Tree","200035":"Pine Tree","200036":"Palm Tree","200037":"Holiday Tree","200038":"Snowman","200039":"Rocks","200040":"Clay Pit","200041":"Wood","200042":"Stone","200043":"Clay","200044":"Wheat Plot","200045":"Carrot Plot","200046":"Corn Plot","200047":"Sugarcane Plot","200048":"Strawberry Plot","200049":"Apple Tree","200050":"Lemon Tree","200051":"Grape Vine","200052":"Garlic Plot","200053":"Olive Tree","200054":"Tomato Vine","200055":"Oak Tree Plot","200056":"Wheat","200057":"Carrot","200058":"Corn","200059":"Sugarcane","200060":"Strawberry","200061":"Apple","200062":"Lemon","200063":"Grapes","200064":"Garlic","200065":"Olive","200066":"Tomato","200067":"Blueberry","200068":"Milk","200069":"Wool","200070":"Egg","200071":"Flour","200072":"Chicken Feed","200073":"Sugar","200074":"Cornmeal","200075":"Lumber","200076":"Butter","200077":"Cream","200078":"Cheese","200079":"Thread","200080":"Cloth","200081":"Sweater","200082":"Jacket","200083":"Heavy Jacket","200084":"Runic Tunic","200085":"Bread","200086":"Cornbread","200087":"Apple Pie","200088":"Strawberry Pie","200089":"Lemon Cookie","200090":"Olive Bread","200091":"Garlic Bread","200092":"Queen\'s Cake","200093":"Tomato Soup","200094":"Carrot Soup","200095":"Omelette","200096":"Pizza","200097":"Honey","200098":"Apple Cider","200099":"Wine","200100":"Port","200101":"Olive Oil","200102":"Aged Wine","200103":"Pottery","200104":"Furniture","200105":"Ink","200106":"Urns","200107":"Rosemary","200108":"Mushroom","200109":"Magic Mushroom","200110":"Daisy","200111":"Tulip","200112":"Sunflower","200113":"Feverfew","200114":"Potion A","200115":"Potion B","200116":"Potion C","200117":"Gem","200118":"Book","200119":"Pelt","200120":"Bear Skin","200121":"Bones","200122":"Silver","200123":"Gold","200124":"Diamond Ring","200125":"King\'s Crown","200126":"Portrait","200127":"Trident","200128":"Skeleton Key","200129":"Golden Key","200130":"Scroll","200131":"Prospero\'s Orb","200132":"Tent","200133":"Boat","200134":"Shrine","200135":"Castle","200136":"Restaurant","200137":"Restroom","200138":"General Store","200139":"Warrior\'s Den","200140":"Magic Shop","200141":"Ancient Temple","200142":"Adventure Camp","200143":"Laboratory","200144":"School","200145":"Animal Stall","200146":"Mill","200147":"Dairy","200148":"Chicken Coop","200149":"Lumber Yard","200150":"Loom","200151":"Oven","200152":"Kitchen","200153":"Beehive","200154":"Studio","200155":"Winery","200156":"Library","200157":"Animal Yard","200158":"Hospital","200159":"Cow","200160":"Sheep","200161":"Brown Cow","200162":"Doctor","200163":"Surgeon","200164":"Fairy","200165":"Kent","200166":"Portia","200167":"The Shepherd","200168":"Hotspur","200169":"Cassio","200170":"Mistress Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampire","200175":"Santa Claus","200176":"Prospero","200177":"Falstaff","200178":"Apothecary","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Juliet","200184":"Mermaid","200185":"Farmer","200186":"Farm Hand","200187":"Rancher","200188":"Lumberjack","200189":"Coyote","200190":"Bear","200191":"Spider","200192":"Zombie","200193":"Duke Angelo","200194":"Ghost","200195":"Ogre","200196":"Demon","200197":"Dragon","200198":"Coyote Spawner","200199":"Bear Spawner","200200":"Spider Spawner","200201":"Zombie Spawner","200202":"Ghost Spawner","200203":"Demon Spawner","200204":"Dragon Spawner","200205":"Grower","200206":"Green Thumb","200207":"Husbandry","200208":"Bulk Animal Collect","200209":"Axe","200210":"Pickaxe","200211":"Builder","200212":"Bulk Harvest","200213":"Bulk Replant","200214":"Logging","200215":"Better Logging","200216":"Bulk Crafting","200217":"Bulk Restart Craft","200218":"Better Axe","200219":"Better Pickaxe","200220":"Storehouse","200221":"Depot","200222":"TBD Storage 3","200223":"TBD Storage 4","200224":"Masonry","200225":"Mechanics","200226":"Textiles","200227":"Artistry","200228":"Beekeeper","200229":"Tailor","200230":"Politics","200231":"Education","200232":"Chemistry","200233":"Cooking","200234":"Creamery","200235":"Baker","200236":"Winemaker","200237":"Miller","200238":"Artisan","200239":"Cuisinier","200240":"Weaver","200241":"Fowler","200242":"Fromager","200243":"Virtuose Culinaire","200244":"Apiarch","200245":"Vintner","200246":"Law","200247":"Medicine","200248":"Surgery","200249":"Backpack","200250":"Rucksack","200251":"Enchanted Pack","200252":"Horse","200253":"Tracking","200254":"Scout","200255":"Padding","200256":"Light Armor","200257":"Chainmail","200258":"Plate Armor","200259":"Heavy Armor","200260":"Mystic Armor","200261":"Caliban\'s Breastplate","200262":"Blessed Veil","200263":"Magic Helmet","200264":"Magic Gloves","200265":"Boots of Protection","200266":"Knife","200267":"Short Sword","200268":"Long Sword","200269":"Great Sword","200270":"Halberd","200271":"Sword of Song","200272":"Magic Halberd","200273":"Glowing Sword","200274":"Giant Axe","200275":"Legendary Sword","200276":"Dragonslayer","200277":"Darts","200278":"Short Bow","200279":"Long Bow","200280":"Spear","200281":"Crossbow","200282":"Magic Spear","200283":"Magic Crossbow","200284":"Titania\'s Bow","200285":"Legendary Crossbow","200286":"Tempest","200287":"Maelstrom","200288":"Oblivion","200289":"Titan","200290":"Jab","200291":"Flurry","200292":"Barrage","200293":"Steady Hand","200294":"Pinpoint","200295":"Unerring","200296":"Focus","200297":"Precision","200298":"Horizon Eye","200299":"Fortitude","200300":"Stoneheart","200301":"Unbreakable","200500":"Crate","200501":"Stone Wall","200502":"Stone Wall Large","200503":"Green Wall","200504":"Black Wall","200505":"Sand Wall","200506":"Blue Wall","200507":"Orange Wall","200508":"Plant","200509":"Cactus","200510":"Harp","200511":"Flag","200512":"Stack of Books","200513":"Chair","200514":"Toilet","200515":"Bed","200516":"Teddy Bear","200517":"Big Hole","200518":"Slide","200519":"Fountain","200520":"Fountain Large","200521":"Large Decorative Palm Tree","hp":"Hit Points","maxhp":"Max Hit Points","range":"Range","attackrange":"Attack Range","attackbonus":"Attack Bonus","damage":"Damage","speed":"Attack Speed","iscamping":"Is Camping","armorclass":"Armor Class","backpackCapacity":"Backpack Capacity","warehouseCapacity":"Warehouse Capacity"}');var m=n(579);const f={en:o,fr:a,es:s,de:l,it:i,pt:c,ru:d,no:u,sv:h,fi:p},g=(0,r.createContext)(o),y=e=>{let{language:t="en",children:n}=e;const r=f[null===t||void 0===t?void 0:t.toLowerCase()]||o;return console.log("\ud83e\uddec StringsProvider:",{rawLanguage:t,normalized:null===t||void 0===t?void 0:t.toLowerCase(),resolvedFile:r}),(0,m.jsx)(g.Provider,{value:r,children:n})},v=()=>(0,r.useContext)(g)},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,s=o>>>1;r<s;){var i=2*(r+1)-1,l=e[i],c=i+1,d=e[c];if(0>a(l,n))c<o&&0>a(d,l)?(e[r]=d,e[c]=n,r=c):(e[r]=l,e[i]=n,r=i);else{if(!(c<o&&0>a(d,n)))break e;e[r]=d,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var i=Date,l=i.now();t.unstable_now=function(){return i.now()-l}}var c=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(d);null!==t;){if(null===t.callback)o(d);else{if(!(t.startTime<=e))break;o(d),t.sortIndex=t.expirationTime,n(c,t)}t=r(d)}}function w(e){if(g=!1,x(e),!f)if(null!==r(c))f=!0,M(S);else{var t=r(d);null!==t&&j(w,t.startTime-e)}}function S(e,n){f=!1,g&&(g=!1,v(A),A=-1),m=!0;var a=p;try{for(x(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!P());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var i=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof i?h.callback=i:h===r(c)&&o(c),x(n)}else o(c);h=r(c)}if(null!==h)var l=!0;else{var u=r(d);null!==u&&j(w,u.startTime-n),l=!1}return l}finally{h=null,p=a,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,C=!1,k=null,A=-1,I=5,E=-1;function P(){return!(t.unstable_now()-E<I)}function _(){if(null!==k){var e=t.unstable_now();E=e;var n=!0;try{n=k(!0,e)}finally{n?T():(C=!1,k=null)}}else C=!1}if("function"===typeof b)T=function(){b(_)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,R=N.port2;N.port1.onmessage=_,T=function(){R.postMessage(null)}}else T=function(){y(_,0)};function M(e){k=e,C||(C=!0,T())}function j(e,n){A=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,M(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,o,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return e={id:u++,callback:o,priorityLevel:e,startTime:a,expirationTime:i=a+i,sortIndex:-1},a>s?(e.sortIndex=a,n(d,e),null===r(c)&&e===r(d)&&(g?(v(A),A=-1):g=!0,j(w,a-s))):(e.sortIndex=i,n(c,e),f||m||(f=!0,M(S))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},7283:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,s){if("function"!==typeof r)throw new TypeError("The listener must be a function");var i=new o(r,a||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],i]:e._events[l].push(i):(e._events[l]=i,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function i(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),i.prototype.eventNames=function(){var e,r,o=[];if(0===this._eventsCount)return o;for(r in e=this._events)t.call(e,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},i.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,a=r.length,s=new Array(a);o<a;o++)s[o]=r[o].fn;return s},i.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},i.prototype.emit=function(e,t,r,o,a,s){var i=n?n+e:e;if(!this._events[i])return!1;var l,c,d=this._events[i],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,o),!0;case 5:return d.fn.call(d.context,t,r,o,a),!0;case 6:return d.fn.call(d.context,t,r,o,a,s),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var h,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,r);break;case 4:d[c].fn.call(d[c].context,t,r,o);break;default:if(!l)for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];d[c].fn.apply(d[c].context,l)}}return!0},i.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},i.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},i.prototype.removeListener=function(e,t,r,o){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var i=this._events[a];if(i.fn)i.fn!==t||o&&!i.once||r&&i.context!==r||s(this,a);else{for(var l=0,c=[],d=i.length;l<d;l++)(i[l].fn!==t||o&&!i[l].once||r&&i[l].context!==r)&&c.push(i[l]);c.length?this._events[a]=1===c.length?c[0]:c:s(this,a)}return this},i.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=n,i.EventEmitter=i,e.exports=i},7297:(e,t,n)=>{"use strict";var r,o=n(4781),a=n(5558);try{r=[].__proto__===Array.prototype}catch(c){if(!c||"object"!==typeof c||!("code"in c)||"ERR_PROTO_ACCESS"!==c.code)throw c}var s=!!r&&a&&a(Object.prototype,"__proto__"),i=Object,l=i.getPrototypeOf;e.exports=s&&"function"===typeof s.get?o([s.get]):"function"===typeof l&&function(e){return l(null==e?e:i(e))}},7544:e=>{"use strict";e.exports=JSON.parse('{"0":"Secrets of Elsinore","1":"Server is not running.","2":"Map","3":"Land successfully tilled.","4":"\u26a0\ufe0f You don\'t have enough resources.","5":"\u2692\ufe0f Construction completed successfully.","6":"\ud83d\udcb0 Items sold.","7":"\ud83c\udfe0 This homsetead is unoccupied.","8":"\ud83d\udeab This area is off limits.","9":"The Valley is full of wonders, and must be explored on foot.","10":"\ud83c\udfe0 [username]\'s homestead.","11":"\ud83c\udfe0 Unknown owner\'s homestead.","12":"Settlement view. Depending on your location, you may need to scroll to see the Town.","13":"Frontier view.","14":"\ud83c\udfdb\ufe0f Welcome to town.","15":"\ud83d\udc34 You need a Horse to travel here. Visit the Adventure Camp in Town.","16":"You\'re in the valley.","17":"You do not own a homestead here.","18":"\ud83d\udeab You can\'t go that way.","19":"\ud83c\udf92 You need a Backpack to collect resources away from your homestead. Buy one at the Adventure Camp.","20":"\ud83d\udeab Not enough room in the Warehouse.","21":"\ud83c\udf92 Not enough room in the Backpack. Open Inventory to manage Backpack contents.","22":"Items purchased.","23":"\u26a0\ufe0f You can\'t build that here.","24":"\ud83c\udfaf Out of range","25":"\ud83c\udf92 Nothing in the Backpack.","26":"\ud83c\udf92 You must be at your homestead to empty your Backpack.","27":"\u26fa\ufe0f You don\'t have a tent.","28":"\u26fa\ufe0f You are now camping.","29":"\u26a0\ufe0f \u26fa\ufe0f Failed to camp / decamp.","30":"\u26fa\ufe0f No longer camping.","31":"\u26fa\ufe0f Cannot attack while camping.","32":"\u26fa\ufe0f You need to decamp first.","33":"\ud83d\udce6 Moved items to the Warehouse.","34":"\ud83c\udf92 Emptied backpack.","35":"You need a ","36":"You used a ","37":"\ud83d\udef6 You don\'t have a boat.","38":"Player Info:","40":"Can\'t interact through walls.","41":"You\'re full","42":"Earns: ","44":"No backpack","45":"Kent will buy:","46":"Kent returns in:","47":"I can buy goods fom you.","48":"Need some advice?","49":"Heals remaining:","50":"\ud83d\udeab That username is already taken.","51":"Total Heals: ","70":"Session Expired","71":"You\'ve been away for a while. Refreshing ensures your session works properly.","72":"This page will auto-refresh in 30 seconds unless you do it now.","73":"\ud83d\udd04 Refresh Now","74":"\ud83c\udf92 A Backpack is required to own a Tent.","75":"You do not own a Backpack. You can purchase one at the Adventure Camp in Town.","76":"Your Warehouse is empty.","77":"Your Backpack is empty.","78":"\ud83c\udf7d\ufe0f Eat","80":"Acquired ","81":"Pitching a tent in Town or the Valley prevents you being attacked.","82":"A boat will allow you to travel by water.","88":"Your warehouse is at maximum capacity.","89":" capacity for Gold Pass","90":"\ud83d\udeab This is not your homestead.","91":"\ud83d\udc34 Horse required.","94":"\ud83d\udce2 Share \'Secrets of Elsinore\'!","95":"Invite others to help out and join the adventure!","96":"Have Feedback?","97":"@ Email Us","98":"\u23f3 Loading ...","99":"\u26a0\ufe0f Something went wrong.","100":"TRAVELING STRINGS:","101":"\ud83d\udc34 Traveling home ... please wait.","102":"\ud83d\udc34 Traveling to town ... please wait.","103":"\ud83d\udc34 Traveling to the next location ... please wait.","104":"\ud83d\udeab No town in this settlement yet.","105":"\u26a0\ufe0f There was a problem trying to travel.","106":"\ud83d\udeab You cannot travel beyond the frontier.","107":"Your Homestead","108":"Your Town","109":"You\'ll need a Home Deed from the Constable to claim your Homestead.","110":"\u27a1\ufe0f Walk onto Signposts to use them","111":"\ud83c\udfdb\ufe0f Welcome to town.","112":"\ud83c\udfe0 Welcome home.","120":"You don\'t have any homestead moves left.","121":"You have successfully moved your homestead.","122":"You cannot move to the valley!","123":"You cannot move to the town!","124":"That homestead is occupied.","125":"Where are you moving to?","126":"This homestead is unoccupied.","130":"Select your language","131":"Confirm","132":"\ud83d\udcc1 Wallet","140":"TRADE STALL STRINGS:","141":"Sold","151":"You cannot fill another player\'s trade stall.","152":"You do not have enough money to buy this item.","153":"is selling:","154":"are selling","155":"Transaction failed. This item has already been sold.","156":"Click to sell","157":"Bought by","158":" LIMIT PER ORDER","159":"Ready to sell","160":"\ud83d\udce5 Trading Post: Add Items to Sell","161":"Item","162":"You Have","163":"Price Ea.","164":"Amount to Add","165":"All","166":"Add","167":"Sell","168":"Yes, Sell All","169":"Buy","170":"Unlocked trading slot","171":"Gold Pass Required","172":"Locked","173":"Limit of","174":"to Sell","175":"Unlock for","176":"Wood","177":"Need","178":"to unlock this slot","179":"This Outpost only accepts items from your backpack. Any player can collect money from an Outpost.","180":"To Backpack","181":"\ud83d\udce6 Warehouse","182":"\ud83c\udf92 Backpack","183":"Capacity: ","184":"Manage","185":"Quantity","186":"Amount","187":"\ud83c\udf92 Backpack Management","188":"Discard","189":"Add All to Warehouse","190":"Discard All","191":"Item","192":"Action","193":"\ud83d\udce6 Warehouse Management","194":"Expand","195":"Expand Backpack at the Adventure Camp in Town.","196":"Add ","197":"Warehouse upgraded","198":" to Warehouse capacity.","199":"Significantly more capacity with Gold Pass (among other benefits).","200":"QUESTS","201":"\u2705 Action item completed. You have your reward.","202":"\u2705 Action item accepted.","203":"No action items at the moment.","204":"To Do List:","205":"Nothing new at this time. Check your \u2705 To Do list!","206":"Return to the NPC who gave you this quest to collect your reward.","207":"In Progress","208":"Get Reward","209":"Accept","299":"FARMING STRINGS:","300":"Added","301":"Tilled","302":"\ud83c\udf31 Planted","303":"\ud83c\udf31 Must plant on dirt","304":"\ud83c\udf31 Can\'t plant here","305":"\u26a0\ufe0f Not enough resources","306":"\u26a0\ufe0f Can\'t build here","307":"\ud83c\udf31 Must plant on moss.","308":"\ud83c\udf31 Must plant on sand","310":"You need to till the land for planting, as well as pigs.","311":"Your farm animals will need plenty of grass to graze on.","312":"Pavement can be useful to control wandering animals.","313":"Cobblestone paths add decoration to your homestead.","315":"Select Crops to Harvest:","316":"Select All","317":"Deselect All","318":"Collect","319":"Select Animals to Collect:","320":"Cannot terraform here.","340":"Not avilable unless you\'re on foot.","341":"Select Crafting Stations to Collect:","342":"Harvest?","343":"Replant?","344":"No crops ready to harvest.","345":"Ready to Collect:","346":"Collect?","347":"Buy 1 for: ","350":"The Farm Hand will help you automate harvesting and planting of crops.","351":"The Rancher will help you automate collecting from animals.","352":"The Lumberjack will help you automate chopping trees for wood.","353":"The Crafter will help you automate collecting from crafting stations.","354":"Kent is your Farm Manager. He can help you run your homestead.","355":"The Shepherd will guide you in the management of your farm animals.","356":"Bulk Harvest Results","357":"Crops Harvested","358":"Crops Replanted","359":"Items Found!","360":"Continue","361":"Seeds used","362":"Global Market","363":"No items currently available for purchase","364":"items available","365":"Buy","366":"Close","367":"Your Trade Slots:","368":"Send Goods Home","369":"Send items from your backpack directly to your warehouse at home.","400":"BUYING, CRAFTING, SKILLS, HEALING, ETC.","401":"\u2764\ufe0f\u200d\ud83e\ude79 Already at maximum hit points.","402":"\u26a0\ufe0f  resources.","403":"\u26a0\ufe0f Youre inventory is full.","404":"Working...","405":"\u2764\ufe0f\u200d\ud83e\ude79 Health +","406":"Maximum reached for this location.","407":"Maximum reached for this location.","408":"Need more Hospitals.","410":"\ud83c\udfd5\ufe0f To use a purchased tent, click on your own player icon.","420":"Trades:","421":"Used In:","422":"Base Value:","423":"No trades available.","424":"No recipes available.","425":"Sell for refund","426":"If you have less than 10 of these crops, you can purchase them here:","427":"Purchase the Farm Hand\'s Bulk Harvest skill to harvest all crops at once.","428":"Click to instantly harvest all crops.","429":"You have no crops to harvest.","430":"Purchase these farm skills:","431":"Purchase the Farm Hand\'s Bulk Animal Collect skill to collect from all animals at once.","432":"Purchase the Farm Hand\'s Logging skill to chop multiple trees at once and collect the wood.","433":"Purchase Better Logging to increase the number of trees chopped at once.","434":"Click to instantly collect from all animals.","435":"Click to instantly chop multiple trees and collect wood.","436":"You have no animals to collect from.","437":"You have no trees to chop.","438":"Remove","439":"Crop returned.","440":"Started ","441":"\u231b\ufe0f Ready in ","442":"\ud83c\udfe0 House repairs complete!","450":"\u274c Cannot afford crafting costs","451":"\u26a0\ufe0f Crafting already in progress","452":"\u274c Failed to start crafting.","453":"\u274c Failed to repair house.","454":"\u274c Failed to hire worker.","455":" has arrived!","456":"No more workers available.","457":"Ready to collect!","458":"Time: ","459":"Instant","460":"Requires: ","461":"Costs: ","462":"Gives: ","463":"Heals: ","464":"Purchase Bulk Crafting to collect from ready crafting stations all at once.","465":"Click to instantly collect from all ready crafting stations.","466":"You have no crafting stations ready to collect from.","467":"Bulk Crafting","468":"Restarted: ","469":"+","470":"Cannot travel right now, farming actions in progress.","471":"\u26a0\ufe0f Already in progress.","472":"Harvested","475":"Restart?","476":"Station","477":"Your farm workers are busy...","478":"\ud83c\udf31 Working","479":"Logging","480":"Crafted","481":"with","482":"applied","483":"replanted","490":"Sell for refund (Dev only)","500":"COMBAT STRINGS","501":"\ud83c\udfaf Out of range.","502":"\ud83c\udfaf Hit!","503":"\u274c Miss","504":"\ud83d\udc80 Killed","505":"\u26a0\ufe0f Error","510":"\u2764\ufe0f\u200d\ud83e\ude79 You\'re taking damage ...","511":"\u2764\ufe0f\u200d\ud83e\ude79 Your Health: ","512":"Your Health Unavailable","520":"You must be in town or at home to equip weapons and armor.","522":"\ud83d\udee1\ufe0f Equipped Armor:","523":"No armor available","524":"\u2694\ufe0f Equipped Weapon:","525":"No weapons available","526":"Magic Enhancements:","527":"No magic enhancements available","528":"Other Equipment:","550":"\ud83d\udee1\ufe0f Max Health","551":"\ud83d\udee1\ufe0f Armor Class","552":"\ud83c\udfaf Attack Bonus","553":"\u2694\ufe0f Damage","554":"\u2694\ufe0f Speed","555":"\ud83d\udc41\ufe0f Attack Range","556":"\u26fa\ufe0f Is Camping","557":"\ud83d\udef6 In Boat","558":"Yes","559":"No","600":"RELATIONSHIP STRINGS:","601":"Relationship:","602":"You\'ve met","603":"You\'re now friends with","604":"You have a crush on","605":"You\'re in love with","606":"You and","607":"are now married.","608":"are now rivals.","609":"is now your rival because of this.","610":"isn\'t going to be very happy about this...","611":"aren\'t going to be very happy about this...","612":"will be very happy about this.","613":"approve of this.","614":"and","615":"Your relationship with","616":"has changed.","619":"Interests:","620":"You need to move closer to interact with this character.","621":"for being married.","622":"for being friends.","623":"for being in love.","625":"Build a relationship to unlock tasks with ","626":"Build a relationship to unlock trades with ","627":"With a better relationship, {npc} may have additional tasks for you.","628":"With a better relationship, {npc} may have additional trades for you.","630":"Greet","631":"Talk","632":"Trade","633":"Quest","634":"Met","635":"Friend","636":"Married","637":"Rival","638":"Love","639":"Crush","640":"Joke","641":"Make Friends","642":"Insult","643":"Hug","644":"Kiss","645":"Apologize","646":"Give Gift","647":"Compliment","648":"Flatter","649":"Profess Love","650":"Propose","651":"Taunt","652":"Tease","653":"End Marriage","660":"In love with: ","661":"Friends with: ","662":"Rivals with:","663":"Married to: ","700":"FTUE STRINGS:","701":"\ud83d\udc78 Welcome to Secrets of Elsinore","702":"You have arrived in Elsinore, a land of opportunity, mystery and adventure.","705":"Aspiration","706":"Elsinore is a big world. It\'s up to you how you want to spend your time. Which of these aspirations best suits your style of play? (This choice will not limit your options in any way.)","721":"\ud83c\udfe0 Welcome to your Homestead!","722":"You\'ll want to start earning \ud83d\udcb0 Money right away. Harvest some \ud83c\udf3e Wheat, and then sell it to \ud83e\udd20 Kent.","723":"\ud83d\udcaa Grower","724":"You\'re on your way! To get more out of your farm, acquire the \ud83d\udcaa Grower skill and plant more types of crops.","727":"\ud83c\udf3d Planting","728":"Great, now start Farming! You can plant new crops using the \ud83c\udf3d Farming panel.","729":"\ud83d\udc2e Animal Life","730":"Excellent! While we let that grow, let\'s bring some life to the farm. First, acquire the \ud83d\udcaa Husbandry skill. Then visit the \ud83d\udc2e Animal Panel to buy a cow.","731":"\ud83c\udf33 Wood","732":"Marvelous! Now, Elsinore is rich with forests. Wood is a vital resource for crafting and building. To chop trees, you\'ll need to acquire the \ud83d\udcaa Axe skill.","733":"\u2692\ufe0f Builder","734":"Nice, you\'ve gained the \ud83e\ude93 Axe! In addition to building crafting stations, you can also chop your way to the \ud83d\ude82 Train Station at the edge of your Homestead. Use the \u27a1\ufe0f Signpost to travel into Town.","737":"Time to Explore","738":"Your Homestead is part of a larger Settlement of other players sharing a large Frontier. Use \ud83c\udfdb\ufe0f Signposts to travel, or walk to the edge of any map. ENJOY PLAYING!","740":"I awoke from a strange nightmare, to find myself in a dark forest, before the entrance to a cave.","741":"Use the A-W-S-D (or arrow) keys to move your character around. CLICK on the exit.","742":"This looks like the entrance to a town. Greet the Constable who guards the gate.","750":"\ud83c\udf3d Farmer","751":"Cultivate your homestead, grow crops, tend animals, and craft goods to sell and trade with other players. Invest in farming and crafting skills to grow your profits.","752":"\u2694\ufe0f Adventurer","753":"Venture into the Valley for resources and rare items. Fight animals and creatures, uncover hidden locations, and meet magical characters. Invest in combat skills to become a formidable fighter.","754":"\ud83c\udfdb\ufe0f Politician","755":"Run for Mayor, set the tax rate, and earn tax revenue for your self. Invest in community buildings for the whole Town, like Hospitals, Schools, and Libraries, and help your settlement thrive.","780":"Let us know what you think of Secrets of Elsinore","781":"I\'ll keep playing; here\'s why (check all that apply):","782":"I doubt I\'ll return; here\'s why (check all that apply):","783":"Play","784":"Looks fun","785":"I like the visuals","786":"I like farming","787":"I look forward to collaborating with others","790":"I couldn\'t figure it out","791":"I don\'t like the visuals","792":"I had a technical issue","793":"It\'s just not for me","794":"Play","795":"Skip Tutorial","796":"OK","797":"Back","798":"Play","800":"MORE CRAFTING STATION STRINGS:","801":"Acquire the ","802":" Skill at the ","803":" to increase the output of this station by ","805":"Your ","806":" Skill increases the base output of this station by ","810":"You can also purchase this skill directly: ","811":"Level Up!","812":"Congratulations! You\'ve reached level {level}!","813":"Level up! You are now level {level}!","814":"The {feature} unlocks at level {level}.","815":"Your current level: {level}","820":"Makes: ","821":"Base Amount: ","825":"You have ","826":"Scrolls.","827":"Scroll","828":"You already have this.","829":"Revealing scroll...","830":"Failed to reveal scroll","831":"Reveal","832":"You need scrolls to use the Ancient Temple. Find scrolls by exploring the world.","899":"DEBUG STRINGS:","900":"Debug: Inventory cleared.","901":"Debug: Quest history cleared.","902":"Debug: Resources added.","903":"Debug: Grid successfully reset.","904":"Debug: Skills added.","905":"Debug: Skills & Powers cleared.","906":"Debug: Combat Stats reset.","999":"PANEL UI STRINGS:","1000":"[Description needed]","1001":"Resources collected at the homestead go into the warehouse. Resources collected in town or in the valley will go into the backpack. To buy a backpack, visit the Store in town.","1002":"Build crafting stations on your Homestead using resources from your warehouse.","1003":"Purchased animals will appear at your player icon, and immediately begin life on the homestead.","1004":"Till land to dirt in order to plant crops. Plant grass to give farm animals something to graze on.","1005":"Acquire Skills to improve various attributes. Make sure to explore the Town to find additional places and ways to gain Skills.","1006":"Manage your ongoing To Do list here. Look for quest-giving characters on your homestead as well as Town, or even the Valley.","1007":"Governments in Elsinore are formed at the settlement level. The elected mayor implements policies and builds buildings to help the community thrive.","1008":"Buy and sell with other players. If no players buy your items before the timer expires, sell them to the game.","1009":"","1010":"","1011":"This Animal Stall is empty. Make sure animals have grass to eat, and they will eventually come to the stall for harvesting.","1012":"Elections take place in the Courthouse. Here, Mayors have the power to set the tax rate and rename the Settlement.","1013":" ","1014":" ","1015":"The game takes place over the course of continually changing seasons.","1016":" ","1017":"Visit the Bank to exchange items for Money, including rare items like Gold and Silver. Return to the bank regulalry for different offers.","1018":"","1019":"","1021":"\xa9 Valley View Studio, 2025, All Rights Reserved.","1022":"","1023":"Workers help you run your homestead. Hire them at the Farm House.","1024":"","1025":"","1026":"Earning and spending Money.","1027":"These are the benefits of a Gold Pass.","1028":"[Decorations panel description]","1029":"","1030":"","1031":"Buy decorations for your homesetead. You will be able to sell these for a full refund.","1032":"The Farm House is where you can hire people to help you run your homestead.","1033":"Terraform the land with these tools. Animals need grass for grazing, crops need dirt to grow on. Pavement can be useful for controlling movements of animals and characters.","1034":"Earning and spending Gems.","1035":"This is your collection of lifetime Trophies.","1036":"Reveal mysterious scrolls at this Ancient Temple.","1037":"Participate in the Carnival with others in your Settlement. Complete all orders as a team to win prizes.","1038":"Keep checking with Kent to sell your goods.","1039":"Acquire these zoo animals to populate your homestead, and dig up rare items.","1040":"View the top players across the whole frontier.","1101":"Inventory","1102":"\ud83d\uded6 Build","1103":"\ud83d\udc2e Animals","1104":"\ud83c\udf3d Farming","1105":"\ud83d\udcaa Skills","1106":"\u2705 To Do List","1107":"\ud83c\udfdb\ufe0f Government","1108":"\ud83d\udce5 Trade","1109":"Crafting","1110":"\ud83d\udcea Mailbox","1111":"\ud83d\udc3e Animals","1112":"\ud83c\udfdb\ufe0f Courthouse","1113":"Helper Character","1114":"Player Character","1115":"\ud83d\uddd3\ufe0f Season","1116":"\ud83d\udd01 Trader","1117":"\ud83c\udfe6 Bank","1118":"\ud83d\udd79\ufe0f How to Play","1119":"Profile","1120":"\ud83d\udc1e Debug","1121":"\ud83d\ude00 Welcome","1122":"\ud83d\ude82 Train","1123":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e Farm Hand","1124":"\u2694\ufe0f Combat","1125":"\ud83d\uded2 Shop","1126":"\ud83d\udcb0 About Money","1127":"\u2b50\ufe0f Gold Pass","1128":"\ud83e\udeb4 Decorations","1129":"\ud83d\udc3e Animals","1130":"\ud83c\udf3d Crops & Trees","1131":"\ud83e\udeb4 Decorations","1132":"\ud83c\udfe0 Farm House","1133":"\u26cf\ufe0f Tools","1134":"\ud83d\udc8e Gems","1135":"\ud83c\udfc6 Trophies","1136":"\ud83d\uded5 Ancient Temple","1137":"\ud83c\udfa1 Carnival","1138":"\ud83e\udd20 Kent","1139":"\ud83d\udc12 Zoo Animals","1140":"\ud83d\udcca Leaders","1141":"\ud83d\udce5 Outpost","1190":"\u2699\ufe0f Settings","1301":"Available skills:","1302":"Upgrades to purchase:","1303":"Skills you have:","1304":"Upgrades you have:","1305":"You have no skills yet.","1306":"You have no upgrades yet.","1350":"CARNIVAL STRINGS","1351":"Show Carnival Log","1352":"Carnival is","1400":"MODAL STRINGS","1401":"BANK MODAL","1402":"These offers good for","1403":"Will buy","1404":"for","1405":"No offers available.","1406":"New offers in","1407":"Generating new orders. Thank you for your patience.","1408":"\u26a0\ufe0f You don\'t have enough items.","1409":"\u26a0\ufe0f You don\'t have enough skills.","1410":"\u26a0\ufe0f You don\'t have enough upgrades.","1500":"TOWN NEWS STRINGS:","1501":"News for ","1502":"The current Mayor is","1503":", and the tax rate is","1504":"Here\'s what\'s happening in Town right now:","1505":"It\'s election season, and campaigning is in full swing. Stop by the Courthouse in Town to run for Mayor.","1506":"Voting for the next Mayor has begun. Cast your vote at the Courthouse in Town.","1507":"The Train is arriving, offering to buy:","1508":"The Train is departing. When it returns, it will be buying:","1509":"The Train is here, offering to buy:","1510":" ","1511":"Visit the Bank to sell gold, silver, and diamonds. The Bank is currently updating its offers.","1512":"There is currently no mayor. ","1513":"The Train is departing in","1514":"When it returns, it will be buying:","1515":"The tax rate is","1516":"The Bank is currently buying:","1517":"The Train will be departing in","1518":"The votes in the latest election for Mayor are being counted. Results expected in ","1600":"MAILBOX STRINGS:","1601":"Loading messages...","1602":"You have no messages.","1603":"Received","1604":"Collect","1605":"Most messages will be deleted afer 14 days. Store purchases will not be deleted.","1606":"\ud83d\udcea Mailbox","1607":"\ud83d\uddd1\ufe0f Message deleted.","1700":"STORE STRINGS:","1701":"\ud83d\uded2 Store","1702":"Purchases will be delivered to the Inbox.","1703":"\ud83d\ude4f Thank you for your support! We are a tiny developer with few resources, but passionate about creating a fun space for a positive community.","1704":"Please consider making purchases so we can continue to improve the game.","2000":"TRAIN, BANK, COURTHOUSE, etc. STRINGS:","2002":"Completed","2003":"\ud83d\ude82 Next Shipment Preview:","2004":"\ud83c\udf81 Rewards for filling all orders (sent to all who complete at least one order):","2005":"Click to fulfill","2006":"Your Order","2007":"Claimed","2008":"Claim Order","2009":"Claimed by you:","2010":"Available to claim:","2011":"Claimed by others:","2012":"Completed:","2013":"Claimed by you:","2014":"You can only claim one train offer at a time.","2015":"Show Train Log","2016":"\ud83c\udf89 All orders were completed! Rewards have been mailed out.","2017":"This order has already been claimed.","2018":"\ud83c\udfa1 Next Carnival Preview:","2019":"Rewards for filling all orders:","2020":"Train is","2030":"Offers Update in","2040":"Welcome, Mayor.","2041":"\ud83d\udcb0 Tax Rate: ","2042":"Proposed: ","2043":"Update","2044":"\u26a0\ufe0f Only the Mayor can set the tax rate.","2045":"\ud83d\uddf3\ufe0f Elections:","2046":"Current Phase:","2047":"Phase Timer:","2048":"\ud83d\udce2 Campaign Promises","2050":"This is not your home settlement.","2060":"Voting begins:","2061":"Voting ends in:","2062":"Voting has ended. Results announced in:","2063":"Next campaign begins in:","2070":"\ud83d\udce2 Campaign Promises","2071":"No one has made a campaign promise yet.","2072":"Enter your campaign promise (max 200 characters)...","2073":"Submit Campaign Promise","2074":"Cast Your Vote","2075":"No candidates available for voting.","2076":"Campaign promise:","2077":"You have already voted in this election.","2078":"There were no candidates.","2079":"How\'s your Mayor doing?","2080":"Welcome, Mayor.","2081":"Enter settlement name...","2082":"Your Settlement:","2083":"Update Name","2084":"Visit the \ud83c\udfdb\ufe0f Government Panel to view stats on how the settlement is doing, to help guide your election decision.","2085":"Current Mayor:","2090":"\ud83c\udfe4 Community Buildings","2092":"\ud83c\udfeb Schools: ","2093":"\ud83c\udfeb No Schools built yet.","2094":"\ud83c\udfe5 Hospitals: ","2095":"\ud83c\udfe5 No Hospitals built yet.","2096":"\ud83d\udc3e Animal Yards: ","2097":"\ud83d\udc3e No Animal Yards built yet.","2098":"\ud83c\udfe4 Libraries: ","2099":"\ud83c\udfe4 No Libraries built yet.","3000":"GOV PANEL:","3001":"Your Settlement:","3002":"\ud83d\ude0a Pop.","3003":"\ud83d\udcb0 Tax Rate:","3004":"The tax rate is set by the Mayor, for this Settlement, and a percentage of all taxes collected are added to the Mayor\'s bank account.","3005":"Mayors are elected at the Courthouse in Town.","3006":"\ud83c\udfdb\ufe0f Government Officials","3007":"No government officials elected yet.","3009":"Only the Mayor can build Schools, Hospitals and Libraries in the Town.","3010":"\ud83c\udfeb Schools give citizens access to certain Skills that cannot be gained elsewhere.","3011":"\ud83c\udfe5 Hospitals supply Doctors, who can heal adventurers returning from the Valley.","3012":"\ud83c\udfe4 Libraries are a source of Books, which are vital to Adventurers looking to learn new skills.","3013":"\ud83d\ude82 The Mayor can influence demand for goods at the Train.","3020":"View Tax Log","3021":"","3022":"","3023":"","3024":"","3025":"","3050":"SEASON PANEL STRINGS","3051":"(Net worth is recalculated twice per day.)","3052":"No data available for top citizens.","3053":"It\'s","3054":"Loading...","3055":"Season ends in:","3056":"We are in between seasons.","3057":"At the end of the season, bonus rewards will be sent to the top players in the Frontier, as well as to all players in the top Settlement.","3058":"\ud83c\udfc6 Top Citizens in the Frontier","3059":"\ud83c\udfd9\ufe0f Leading Settlement","3060":"Total Wealth:","3061":"Population:","3062":"Unknown","3063":"No data available","3064":"View Season Log","4000":"LOGIN PANEL:","4001":"Don\'t have a profile? Create a new free profile to start playing:","4002":"Create a New Profile","4003":"Username","4004":"You will not be asked for an email address.","4005":"With your own profile, you\'ll be granted your own homestead to cultivate in a Settlement with other players, in a Frontier full of Settlements. Adventure awaits you in the Valley.","4006":"Password","4007":"Login","4008":"Username","4009":"Login to your profile to continue playing. If you don\'t have an","4010":"Already have a profile?","4050":"PROFILE PANEL:","4051":"Hi, ","4052":"Change Username:","4053":"Change Password:","4054":"Profile Management","4055":"Profile Status:","4056":"Logout","4057":"Delete Your Profile","4058":"Player ID:","4059":"Homestead Relocation","4060":"Relocations Remaining:","4061":"Visit the Store to purchase more Relocations.","4062":"Settings","4063":"Language:","4064":"Range Indicator:","4065":"Change Avatar","4066":"Back to Login","4067":"Select Language","4068":"Begin Your Journey!","4069":"Choose Username","4070":"Select a Password","4071":"Choose your player icon:","5000":"MORE MODAL STRINGS:","5001":"\ud83d\udc80 You have died.","5002":"You have been returned home. Any backpack \ud83c\udf92 items you had were lost.","5003":"Be more careful next time.","5004":"\ud83d\udc80 You have fallen!","5005":"\ud83d\udc78 Welcome to Secrets of Elsinore","5006":"Please login, or create a free profile.","5007":"\xa9 Valley View Studios, 2025, All Rights Reserved.","5010":"\ud83d\udce8 Inbox","5011":"You have no messages","5015":"\ud83d\uded2 Store","5016":"Purchases will be delivered to the Inbox. We are unable to offer returns. All purchases are final.","5017":"Be aware that most inventory items are wiped between seasons, so please check the season clock before purchasing, and see the seasons panel for more information.","5020":"\ud83d\udeab You are currently logged out.","5021":"Click the Login or Create Profile button to begin.","5025":"\ud83d\ude4f Thank you for your support!","5026":"Your purchase has been delivered to your Inbox.","5027":"Enjoy Secrets of Elsinore!","5030":"\ud83d\udc78 Welcome to Secrets of Elsinore!","5031":"No player is logged in or the server is offline.","5032":"Please refresh the page, check your internet connetion, or return later.","5035":"We are between seasons!","5036":"Secrets of Elsinore is temporarily unavailable while we reset the season.","5040":"\ud83d\udcf0 Town News","5041":"Here\'s what\'s happening in Town right now:","5045":"Use ","5046":"Do you want to use a","5047":"You have ","5050":"\u26a0\ufe0f Confirm Homestead Move","5051":"Are you sure you want to move your homestead? This cannot be undone.","5052":"Close this dialog to cancel.","5060":"\u2b50\ufe0f Congratulations!","5061":"You now have a Gold Pass. Go to your Profile panel to customize your player icon, and discover other Gold benefits.","5062":"Thank you for your support!","5070":"Your journey doesn\'t have to end here...","5071":"Choose your fate:","5072":"Revive for","5073":"Accept Your Death","5074":"Need more gems?","5100":"Recent Tax Collections","5101":"No tax collection history available yet.","5102":"\ud83d\uddd3\ufe0f Date","5103":"\ud83d\udcb0 Total Collected","5104":"Mayor","5105":"\ud83d\udcb0 Mayor Take","5110":"","6000":"TROPHY STRINGS:","6001":"Here are your lifetime Trophies:","6002":"You have no trophies yet. Earn trophies for achievements throughout the game.","6003":"Trophy Earned!","7000":"NOTIFICAITION STRINGS:","7001":"Tip:","7002":"Congratulations!","7003":"Click on \ud83e\udd20 Kent to sell goods.","7004":"Note:","7005":"Use A-W-S-D or the Arrow Keys to move. Move onto dirt, and then select \ud83c\udf31 Wheat Plot.","7006":"Look for the \ud83d\udcaa icon to open the Skills panel. Keep selling goods to \ud83e\udd20 Kent to earn Money and \ud83d\udd37 XP.","7007":"After aquiring Husbandry, move onto a \ud83d\udfe9 grass tile, then find the \ud83d\udc2e Animal panel to purchase a \ud83d\udc2e Cow.","7008":"Crops need dirt. Cows and sheep need \ud83d\udfe9 grass. Pavement can help contain the movements of people and animals. Use the \u26cf\ufe0f Tools to shape the land to your liking.","7009":"Keep checking your \u2705 To-Do-List, and keep checking with \ud83e\udd20 Kent and \ud83d\udc75\ud83c\udffb the Shepherd.","7015":"Click + and - at the top of the screen to zoom in and out.","7017":"You have acquired an equippable item. Visit the \u2694\ufe0f Combat panel to equip it.","7020":"To instantly travel home, click the Settlement where your Homestead is located.","7021":"You made it to the Valley! Be sure to zoom out (+ and -) to keep track of your location. If you get lost, zoom out to the Frontier view to travel back home.","7049":"Tutorial","7050":"Use A-W-S-D or the Arrow Keys to move. Try talking to Constable Elbow.","7051":"You can buy a Home Deed from Constable Elbow, when you\'re ready to start settling your Homestead. Or you can explore, and gear up for adventure.","7052":"With your Home Deed, you can use the \ud83c\udfe0 Signpost Home to travel to your Homestead at any time.","7053":"Welcome to your Homestead! This land is yours to build. Make \ud83d\udcb0 Money by selling your goods to \ud83e\udd20 Kent.","7054":"Great, now start farming! You can plant crops using the \ud83c\udf3d Farming panel. Crops must be planted on dirt.","7055":"You\'re on your way! Keep farming and selling. When you\'re ready, travel back to Town using the \ud83c\udfdb\ufe0f Signpost, and get a Key to the Town from Constable Elbow.","7056":"You\'re welcome into Town now! Explore everything the Town has to offer, including building more Skills, meeting Townspeople, and more ways to earn Money.","7057":"Go to the \ud83c\udfea General Store in town to acquire an Axe.","7058":"Go to the \ud83c\udfea General Store in town to acquire a Pickaxe.","7060":"\ud83e\udd20 Kent will buy your Wheat for Money. Sell some Wheat to get started!","7061":"Now travel to the Town to get your Town Key from Constable Elbow. Use the \ud83c\udfdb\ufe0f Signpost Town to travel there.","7062":"Great job! I\'m the Shepherd, and I\'ll help you with your \u2705 To Do List. Check in with me when tasks are complete.","8000":"PET & TEMPLE STRINGS:","8001":"COMMON","8002":"UNCOMMON","8003":"RARE","8004":"EPIC","8005":"LEGENDARY","8010":"This pet is hungry.","8011":"Feed","8012":" to send it searching for treasures.","8014":" is searching for treasures ...","8015":"Check back in:","8016":" has found something!","8999":"HOW TO PLAY STRINGS:","9000":"Welcome to Secrets of Elsinore!","9001":"What\u2019s it about?","9002":"Secrets of Elsinore is a game that explores how people might self organize and create micro societies in a world of asymmetric resources and interdependence, with both owned and shared spaces.","9003":"While there are no explicit specialization paths, there are three main vectors of play which are interdependent. These are: the FARMER, the ADVENTURER, and the POLITICIAN. You are encouraged to lean upon each other.","9004":"First, the basics:","9005":"Use A-W-S-D keys to MOVE. Click to interact with things that are within your interaction radius.","9006":"Explore \ud83c\udf3d FARMING, \u2692\ufe0f BUILD, and \ud83d\udc2e BUY to improve your Homestead and generate resources.","9007":"Generate \ud83d\udcb0 MONEY from \ud83e\udd20 KENT or at the \ud83d\udce5 TRADING POST.","9008":"More:","9009":"As you create wealth, improve yourself with SKILLS and ABILITIES. For example, purchase the \ud83d\udc34 HORSERIDING SKILL to venture into the Valley.","9010":"Zoom out (- and +) to see how big the world is. Your Homestead is one of many in a SETTLEMENT. Each SETTLEMENT has a shared TOWN. Your Settlement is one of many in the FRONTIER.","9011":"When you are ready, explore the VALLEY, which is full of danger and wonders. The secrets of the wizard PROSPERO \ud83e\uddd9\u200d\u2642\ufe0f and the lost king LEONTES \ud83e\udd34, among others, can be found in the Valley.","9012":"Your Goals:","9013":"Feel free to create your own goals. Also, at the end of each \ud83d\uddd3\ufe0f SEASON, which runs three months, both individuals and settlements will be ranked, and top placement generates additional wealth. Your homsestead, all of your skills, and your inventory will carry over into the next Season.","9014":"Farm, craft, trade, explore, fight, and enjoy!","9020":"How to Earn Money","9021":"There are a few ways to make \ud83d\udcb0 MONEY.","9022":"As you are getting started, check with \ud83e\udd20 KENT. He will buy goods, including crops and crafts.","9023":"Different slots at the \ud83d\udce5 TRADING POST have different timers. During the timer, you can only sell the goods if another player buys them. After the timer, you can sell the goods to the game. Try trading with other players. They will have things you need, and vice versa.","9024":"In Town, you will find places like the \ud83c\udfe6 BANK, which will buy specific items from you at a premium.","9025":"Spending Money","9026":"Surprise, most things cost Money. Initially, you will want to spend money on \ud83d\udcaa SKILLS, \ud83d\udc2e FARM ANIMALS, and \ud83d\uded6 CRAFTING STATIONS. Explore the panels at the left side of the screen. These will help you generate more resources, which in turn will help you earn more Money.","9027":"In TOWN you will disocver more Shops and Traders.","9030":"How to Earn Gems","9031":"Gems are a rare resource that can be used to purchase various things to help accelerate your play.","9032":"You can purchase Gems in the Store, or by clicking here:","9033":"On rare occassions, Gems can be found in the Valley, or earned as rewards for crushing it with the Train, or finishing strong at the end of a Season.","9040":"No Brainer:","9041":"100 \ud83d\udc8e Gems for ","9042":"Best Value:","9043":"500 \ud83d\udc8e Gems for ","9044":"Most Popular:","9045":"1000 \ud83d\udc8e Gems for ","9050":"Benefits","9051":"A Gold Pass gives you access to premium features and benefits in Secrets of Elsinore for the duration of a season.","9052":"With a Gold Pass, you can enjoy the following benefits:","9053":"\u2705 Premium avatars: \ud83d\udc31\ud83e\udd21\ud83d\udc7d\ud83e\udd16\ud83d\udca9\ud83d\udc7e","9054":"\u2705 +100,000 Warehouse capacity","9055":"\u2705 +5,000 Backpack capacity","9056":"\u2705 2 additional Trade Stall slots","9057":"\u2705 Lower Tax rate","9058":"\u2705 Half your MaxHP restored on death","9059":"\u2705 You can run for office","9060":"Thank you for your Gold Pass purchase.","9061":"Purchase a Gold Pass","9999":"ERROR STRINGS:","10000":"\ud83d\udd0c Server is Down","10001":"The server is currently down. We apologize for the inconvencient, please check back soon.","10002":"(This message will disappear when the server is back up.)","10100":"APP.JS STRINGS:","10101":"Welcome to Secrets of Elsinore!","10102":"Please login, or create a free profile.","10103":"\ud83c\udf92 Inventory","10104":"\ud83d\uded2 Store","10105":"\ud83d\udce8, Inbox","10106":"\ud83d\udce2 Share","10107":"\ud83d\udcac Chat","10108":"You Have a Gold Pass","10109":"Controls:","10110":"\ud83d\udd79\ufe0f How to Play","10111":"You are the Mayor","10112":"\u2764\ufe0f\u200d\ud83e\ude79 Health","10113":"\ud83d\uddd3\ufe0f It\'s","10114":"Next Season starts in:","10115":"\ud83d\uddd3\ufe0f Next Season:","10116":"\ud83c\udfdb\ufe0f Happening Now in Town:","10117":"\ud83d\udcb0 Next Tax Collection:","10118":"In: ","10119":"Now collecting taxes...","10120":"\ud83c\udfdb\ufe0f Elections: ","10121":"Ends: ","10122":"\ud83d\ude82 Train: ","10123":"\ud83c\udfe6 Bank: ","10124":"New Offers: ","10125":"Read the Town News!","10126":"Who\'s here:","10127":"No PCs present in the grid.","10128":"Save Changes","10129":"","10130":"You Have a Gold Pass","10131":"Gold Pass Benefits","10132":"Cancel Relocation","10133":"Relocate Homestead","10135":"A-W-S-D to Move","10136":"I for Inventory","10137":"+/- to Zoom","10138":"You have unlocked:","10139":"New quests from:","10140":"Range does not apply","10141":"Range applies here","10149":"Level","10150":"\u2b06\ufe0f Level","10151":"\ud83d\udd37 XP:","10152":"\ud83d\udef6 Get in Boat","10153":"\ud83d\udef6 Get Out of Boat","10154":"\ud83c\udfd5\ufe0f Pitch Tent","10155":"\u26fa Put Away Tent","10156":"Available","10157":"Health","10158":"Amount to Eat","10159":"Health Gain","10160":"Max","10161":"\ud83c\udf7d\ufe0f Eat Food to Restore Health","10162":"You don\'t have any edible items in your ","10170":"The door is open to you.","10171":"You don\'t have access.","10175":"Acquire more skills at various locations in town.","10180":"\ud83d\udce5 Trading Post: Request Items to Buy","10181":" LIMIT PER REQUEST","10182":"You are entering ","10183":"You are leaving ","10184":"The Valley","10185":"Elsinore","10186":"In a Dungeon","10187":"Place with cursor","11000":"ADDED STRINGS:","11001":"Wait for the timer to end, or for another player to buy this item.","12001":"Farming","12002":"Build","12003":"Animals","12004":"To Do List","12005":"Skills","12006":"Combat","12007":"Government","12008":"Seasons","12009":"Home","12010":"Profile","12011":"Decorations","12012":"Tools","12013":"Trophies","12014":"Zoo Animals","15000":"\ud83d\uddd3\ufe0f Season Rules","15001":"Seasons last three months.","15002":"Rewards","15003":"\ud83d\udcb0 Net worth will be calculated based on your money, inventory items, and items on your homestead.","15004":"\ud83c\udfc6 The top 3 players across the frontier will have rewards sent to your mailbox, and also earn a \u201cSeason Winner\u201d trophy.","15005":"\ud83c\udfc6 The top player in the frontier will also earn the \u201cSeason Champion\u201d trophy.","15006":"\ud83c\udf81 All players in the top settlement will receive additional rewards in your mailbox.","15007":"Resetting Players and Locations","15008":"\ud83c\udfe0 You will be relocated back to your homestead if you are away from home when the season ends.","15009":"\ud83c\udfe0 Your homesteads will NOT reset \u2013 all layout, tiles and resources carry over.","15010":"\ud83c\udf92 Unlike prior seasons, your inventory NOT be wiped.","15011":"\ud83d\udc8e You will keep all Gems.","15012":"\ud83d\udcb0 Unlike prior seasons, Money will NOT be nerfed.","15013":"\u2705 All quests will be wiped.","15014":"\ud83d\udcaa Your skills & powers carry over.","15015":"\u2764\ufe0f Your relationships carry over.","15016":"\u2b50\ufe0f Your Gold Pass status will be revoked for the new season.","15017":"\ud83c\udf32 All town and valley grids will be reset with fresh tiles, resources and enemies.","15018":"What Changes?","15019":"\ud83c\udf83 Towns will have tiles and resources according to the new season content.","15020":"\ud83d\ude00 New players joining (and creating new homesteads) will get starter tiles and resources according to the new season content.","15021":"\ud83d\ude82 Train orders are affected by the seasons.","15022":"\ud83c\udfc6 New rewards and trophies can be earned.","15030":"\ud83d\uddd3\ufe0f Read About Seasons","16000":"STORY STRINGS","16001":"Well met, {username}. I am Portia, and I stand for the laws that bind our community together. Help me build the institutions that make us civilized\u2014schools, hospitals, libraries\u2014and I shall see you rewarded with influence and station. But know this: all that glisters is not gold, and that scoundrel Iago is but fool\'s gold indeed. Aid him, and we are done.","16002":"Hail, soldier! I am glad of thee, for these lands need more fighters, to beat back the evil we face. Visit the Warrior\'s Den and the Armory, and ready thyself for battle!","16003":"Good to make your acquaintance {username}. Cassio is my name, and I stand for the honor of my sister Juliet, and seek the head of that coward Duke Angelo. He hides himself in the Valley. And make friends not with that thief Iago, or I shall not do business with you.","16004":"Well aren\'t you a peach? I\'m Mistress Quickly, and I specialize in the culinary arts. I\'ll gladly help you build your skills with food, we need more kitchen magicians in these lands!","16005":"Most pleased to make your acquatince, {username}. My name is Feste, and I\'m the local artisan in these parts. I can help you build up your creative skills, for there is good money to be made crafting fine things for the people.","16006":"Why hello, kind traveler. I am Helena, and I live here among the fields of Mother Nature. As you explore these lands, know that I alone possess the Golden Key to the castle where King Leontes lost his crown. Though I pine for his queen\'s love, I would sacrifice my dreams to see Leontes returned to her and to his former glory.","16007":"You have traveled far [usernmae]. I am Titania, Queen of the Fairies. You have now come to the place beyond which the dangers will but grow. If you meet Propero, make not an enemy of him, or you will get nothing from me.","16008":"Well, you\'ve done it. I never dreamed there would be such a one as to defeat my dragons and reach me in this place. The Orb of Merlin is yours. Perhaps the Oracle can bring us Hope after all. Seek her deep within the Valley.","16009":"[Prospero]","16010":"Give me life, give me love, but most of all... give me Port! In exchange, a sprig of Feverfew, dearer than gold to some, especially that wide-eyed Helena. Says she\u2019s after crowns and legends, poor girl. Me? I\u2019m after a full belly and a gentle nap. \u2018Thou art so fat-witted with drinking of old sack,\u2019 they once told me. Ha! They were not wrong.","16011":"Here\u2019s rosemary, for remembrance, and nightshade, for regrets. My potions are not for the faint of will. With the right leaf, I can mend your limbs or muddle your tongue. \u2018I do remember an apothecary,\u2019 said a boy once, and he paid the price. But you? You look wiser. Bring me rare roots and bitter seeds, and I\u2019ll mix you something worth the danger.","16012":"Ah, traveler, the woods are rife with whisper\'d plots, and Portia keeps one clutched to her breast like a miser his coin. Bring me her secret, prithee, and I shall set in thy hand a Brass Bell most rare. Its voice rings truer than any oath she\u2019s sworn. Do this, and I\u2019ll breathe to thee murmurs of moonlit mischief, rivalries root-deep, and the turning of fortunes yet unseen.","16013":"Something is rotten, still. I feel it in the soil. I once ruled, loved, lost. Helena burned through me like summer lightning. And Leontes? He could not forgive the thaw. \u2018The lady doth protest too much,\u2019 they said; let them. If you see Helena, tell her the roses know her name. If you see Leontes, tell him I have not forgotten the winter.","16014":"My grief is a statue; silent, but never still. I buried my crown in snow the day Gertrude chose her garden over me. \u2018Exit, pursued by a bear\u2019? No, I fled myself. Now I wait, among stone and silence. Bring me what was once mine, the King\u2019s Crown, and I\u2019ll pay in Gold, more than the weight of memory. But beware: some thrones carry curses.","16015":"This bridge is mine, by Sycorax my mother.\u2019 Prospero tried to steal it with spells and smiles. They called me beast, but I am of earth and storm, born to wild truth. I trade bones for Silver, tokens of the dead for coin of the living. Touch nothing lightly in these woods. Bring me what others fear, and I shall make you rich... or haunted.","16016":"My bounty is as boundless as the sea, my love as deep... but he is gone, and all that remains is a portrait and pain. Angelo took both. Bring me Romeo\u2019s likeness, torn from my chamber, and I\u2019ll give you Tulips red as the blood spilt on Verona\u2019s stones. Let this be our new balcony: you below, bearing justice.","16017":"Hello, friend. Do you seek the Trident of the old gods? It is one of the seven artifacts needed ot satisfy the Oracle. I require much gold to part with it.","16018":"Welcome {username}. Congratulations, for you have come a great distance. I sense the heroism in you. Bring me the seven artifacts that bind these peoples, and I will give you the Hope to restore the Golden Age!","16019":"Greetings {username}! For centuries, the gentle people of Elsinore lived in harmony, ruled by the benevolent King Leontes. But of late an evil scourge grows in the Valley, and threatens our peaceful ways. It is said that a single Quest can restore Hope to these lands, and push back the darkness. Seek the Oracle in the Valley, adventurer, and bring us Hope!","16020":"Well met, hunter! Hast thou pelts to trade? I\'ll pay thee fair coin for whatever furs the valley\'s wilds have yielded to thy skill. The colder months draw nigh, and folk seek warmth. Thy hunt fills my coffers; my coin fills thy purse. \'Tis a bargain as snug as the name I bear!","16101":"","16102":"","16103":"Thou hast proven thy worth, {username}, and I count thee among my allies. Know this: I carry a Skeleton Key from my days seeking justice for Juliet\u2014it opens an ancient shrine where I once pursued Angelo\'s trail. But that tale is not yet thine to hear. Earn my full trust, and I shall share both the key and the secrets it guards.","16104":"Oh, {username}, thou hast won this old heart! Though Hotspur still holds my dreams, thou art dearer to me than most. For thee alone, I might part with my Blueberries. Make a Queen\'s Cake with them, and Gertrude will shower thee with diamonds. Love unlocks what friendship cannot, sweet one.","16105":"Ah, {username}, we are friends now, and a fool\'s counsel is worth more than a wise man\'s silence. Heed me well: Iago hath made enemies of half this realm\u2014Cassio, Portia, and others besides. \'Better a witty fool than a foolish wit,\' they say. Be not foolish: ally thyself with that knave, and thou\'lt find many doors closed to thee.","16106":"Thou hast become dear to me, {username}. I would trust thee with my heart\'s burden: bring me Feverfew, that herb which soothes all aching souls, and I shall give thee the Golden Key to Leontes\' castles. Though it unlocks his doors, it cannot unlock Gertrude\'s heart\u2014that key is lost to me. Yet mayhap thou canst restore what I cannot.","16107":"","16108":"","16109":"","16110":"","16111":"","16112":"","16113":"","16114":"","16115":"","16116":"","16117":"","16118":"","16119":"","16120":"","16201":"I love thee truly, {username}.","16202":"I love thee truly, {username}.","16203":"I love thee truly, {username}.","16204":"I love thee truly, {username}.","16205":"I love thee truly, {username}.","16206":"I love thee truly, {username}.","16207":"I love thee truly, {username}.","16208":"I love thee truly, {username}.","16209":"I love thee truly, {username}.","16210":"I love thee truly, {username}.","16211":"I love thee truly, {username}.","16212":"I love thee truly, {username}.","16213":"I love thee truly, {username}.","16214":"I love thee truly, {username}.","16215":"I love thee truly, {username}.","16216":"I love thee truly, {username}.","16217":"I love thee truly, {username}.","16218":"I love thee truly, {username}.","16219":"I love thee truly, {username}.","16220":"I love thee truly, {username}.","21000":"Cat","21001":"Poodle","21002":"Monkey","21003":"Duck","21004":"Donkey","21005":"Owl","21006":"Parrot","21007":"Eagle","21008":"Zebra","21009":"Giraffe","21010":"Orangutan","21011":"Dodo Bird","30000":"TROPHIES:","30001":"First Farm Worker","30002":"Skill Builder","30003":"Trains Completed","30004":"Season Winner","30005":"Season Champion","30006":"Meet the Cast","30007":"Explore the Valley","30008":"Fighter","30009":"Scroll Revealer","30010":"Adventurer","30011":"Mariner","30012":"Kill the Duke","30013":"Prospero\'s Orb","30014":"Carnivals Completed","200000":"RESOURCES","200009":"Gold Account","200010":"Money","200011":"Stub","200012":"Signpost N","200013":"Signpost E","200014":"Signpost S","200015":"Signpost W","200016":"Signpost NW","200017":"Signpost NE","200018":"Signpost SE","200019":"Signpost SW","200020":"Signpost Town","200021":"Signpost Home","200022":"Trade Stall","200023":"Trading Post","200024":"Warehouse","200025":"Abandoned House","200026":"Farm House","200027":"Repair","200028":"Mountain","200029":"Mountain Large","200030":"Bank","200031":"Courthouse","200032":"Train","200033":"Mailbox","200034":"Oak Tree","200035":"Pine Tree","200036":"Palm Tree","200037":"Holiday Tree","200038":"Snowman","200039":"Rocks","200040":"Clay Pit","200041":"Wood","200042":"Stone","200043":"Clay","200044":"Wheat Plot","200045":"Carrot Plot","200046":"Corn Plot","200047":"Sugarcane Plot","200048":"Strawberry Plot","200049":"Apple Tree","200050":"Lemon Tree","200051":"Grape Vine","200052":"Garlic Plot","200053":"Olive Tree","200054":"Tomato Vine","200055":"Oak Tree Plot","200056":"Wheat","200057":"Carrot","200058":"Corn","200059":"Sugarcane","200060":"Strawberry","200061":"Apple","200062":"Lemon","200063":"Grapes","200064":"Garlic","200065":"Olive","200066":"Tomato","200067":"Blueberry","200068":"Milk","200069":"Wool","200070":"Egg","200071":"Flour","200072":"Chicken Feed","200073":"Sugar","200074":"Cornmeal","200075":"Lumber","200076":"Butter","200077":"Cream","200078":"Cheese","200079":"Thread","200080":"Cloth","200081":"Sweater","200082":"Jacket","200083":"Heavy Jacket","200084":"Runic Tunic","200085":"Bread","200086":"Cornbread","200087":"Apple Pie","200088":"Strawberry Pie","200089":"Lemon Cookie","200090":"Olive Bread","200091":"Garlic Bread","200092":"Queen\'s Cake","200093":"Tomato Soup","200094":"Carrot Soup","200095":"Omelette","200096":"Pizza","200097":"Honey","200098":"Apple Cider","200099":"Wine","200100":"Port","200101":"Olive Oil","200102":"Aged Wine","200103":"Pottery","200104":"Furniture","200105":"Ink","200106":"Urns","200107":"Rosemary","200108":"Mushroom","200109":"Magic Mushroom","200110":"Daisy","200111":"Tulip","200112":"Sunflower","200113":"Feverfew","200114":"Potion A","200115":"Potion B","200116":"Potion C","200117":"Gem","200118":"Book","200119":"Pelt","200120":"Bear Skin","200121":"Bones","200122":"Silver","200123":"Gold","200124":"Diamond Ring","200125":"King\'s Crown","200126":"Portrait","200127":"Trident","200128":"Skeleton Key","200129":"Golden Key","200130":"Scroll","200131":"Prospero\'s Orb","200132":"Tent","200133":"Boat","200134":"Shrine","200135":"Castle","200136":"Restaurant","200137":"Restroom","200138":"General Store","200139":"Warrior\'s Den","200140":"Magic Shop","200141":"Ancient Temple","200142":"Adventure Camp","200143":"Laboratory","200144":"School","200145":"Animal Stall","200146":"Mill","200147":"Dairy","200148":"Chicken Coop","200149":"Lumber Yard","200150":"Loom","200151":"Oven","200152":"Kitchen","200153":"Beehive","200154":"Studio","200155":"Winery","200156":"Library","200157":"Animal Yard","200158":"Hospital","200159":"Cow","200160":"Sheep","200161":"Brown Cow","200162":"Doctor","200163":"Surgeon","200164":"Fairy","200165":"Kent","200166":"Portia","200167":"The Shepherd","200168":"Hotspur","200169":"Cassio","200170":"Mistress Quickly","200171":"Feste","200172":"Helena","200173":"Titania","200174":"Vampire","200175":"Santa Claus","200176":"Prospero","200177":"Falstaff","200178":"Apothecary","200179":"Iago","200180":"Gertrude","200181":"Leontes","200182":"Caliban","200183":"Juliet","200184":"Mermaid","200185":"Farmer","200186":"Farm Hand","200187":"Rancher","200188":"Lumberjack","200189":"Coyote","200190":"Bear","200191":"Spider","200192":"Zombie","200193":"Duke Angelo","200194":"Ghost","200195":"Ogre","200196":"Demon","200197":"Dragon","200198":"Coyote Spawner","200199":"Bear Spawner","200200":"Spider Spawner","200201":"Zombie Spawner","200202":"Ghost Spawner","200203":"Demon Spawner","200204":"Dragon Spawner","200205":"Grower","200206":"Green Thumb","200207":"Husbandry","200208":"Bulk Animal Collect","200209":"Axe","200210":"Pickaxe","200211":"Builder","200212":"Bulk Harvest","200213":"Bulk Replant","200214":"Logging","200215":"Better Logging","200216":"Bulk Crafting","200217":"Bulk Restart Craft","200218":"Better Axe","200219":"Better Pickaxe","200220":"Storehouse","200221":"Depot","200222":"TBD Storage 3","200223":"TBD Storage 4","200224":"Masonry","200225":"Mechanics","200226":"Textiles","200227":"Artistry","200228":"Beekeeper","200229":"Tailor","200230":"Politics","200231":"Education","200232":"Chemistry","200233":"Cooking","200234":"Creamery","200235":"Baker","200236":"Winemaker","200237":"Miller","200238":"Artisan","200239":"Cuisinier","200240":"Weaver","200241":"Fowler","200242":"Fromager","200243":"Virtuose Culinaire","200244":"Apiarch","200245":"Vintner","200246":"Law","200247":"Medicine","200248":"Surgery","200249":"Backpack","200250":"Rucksack","200251":"Enchanted Pack","200252":"Horse","200253":"Tracking","200254":"Scout","200255":"Padding","200256":"Light Armor","200257":"Chainmail","200258":"Plate Armor","200259":"Heavy Armor","200260":"Mystic Armor","200261":"Caliban\'s Breastplate","200262":"Blessed Veil","200263":"Magic Helmet","200264":"Magic Gloves","200265":"Boots of Protection","200266":"Knife","200267":"Short Sword","200268":"Long Sword","200269":"Great Sword","200270":"Halberd","200271":"Sword of Song","200272":"Magic Halberd","200273":"Glowing Sword","200274":"Giant Axe","200275":"Legendary Sword","200276":"Dragonslayer","200277":"Darts","200278":"Short Bow","200279":"Long Bow","200280":"Spear","200281":"Crossbow","200282":"Magic Spear","200283":"Magic Crossbow","200284":"Titania\'s Bow","200285":"Legendary Crossbow","200286":"Tempest","200287":"Maelstrom","200288":"Oblivion","200289":"Titan","200290":"Jab","200291":"Flurry","200292":"Barrage","200293":"Steady Hand","200294":"Pinpoint","200295":"Unerring","200296":"Focus","200297":"Precision","200298":"Horizon Eye","200299":"Fortitude","200300":"Stoneheart","200301":"Unbreakable","200500":"Crate","200501":"Stone Wall","200502":"Stone Wall Large","200503":"Green Wall","200504":"Black Wall","200505":"Sand Wall","200506":"Blue Wall","200507":"Orange Wall","200508":"Plant","200509":"Cactus","200510":"Harp","200511":"Flag","200512":"Stack of Books","200513":"Chair","200514":"Toilet","200515":"Bed","200516":"Teddy Bear","200517":"Big Hole","200518":"Slide","200519":"Fountain","200520":"Fountain Large","200521":"Large Decorative Palm Tree","200600":"Potato","200601":"Lettuce","200602":"Pepper","200603":"Orange","200604":"Mixed Salad","200605":"Sandwich","200606":"Potato Bake","200607":"Brandy","200608":"Saw","200609":"Shovel","200610":"Screwdriver","200611":"Hammer","200612":"Bolt","200613":"Phoenix","200614":"Phoenix Feather","200615":"Brass Bell","200616":"Vampire\'s Blood","200617":"Hope","200618":"Yellow Heart","200619":"Green Heart","200620":"Purple Heart","200621":"Carnival","200622":"Guild","200623":"Pig","200800":"Only Found in Scrolls","200801":"Quest for Hope:","armorclass":"Armor Class","attackbonus":"Attack Bonus","attackrange":"Attack Range","backpackCapacity":"Backpack Capacity","damage":"Damage","hp":"Hit Points","iscamping":"Is Camping","maxhp":"Max Hit Points","range":"Range","speed":"Attack Speed","warehouseCapacity":"Warehouse Capacity"}')},7583:e=>{"use strict";e.exports=Math.pow},7605:(e,t,n)=>{"use strict";n.d(t,{FV:()=>a,ZW:()=>c,f0:()=>s,gd:()=>l,qJ:()=>i});var r=n(3488),o=n(6213);n(8146);const a=async e=>{try{const t=(await o.A.get(`${r.A}/api/load-grid/${e}`)).data;if(t.resources&&Array.isArray(t.resources)){const n=t.resources.find((e=>"Signpost Town"===e.type));if(n)return console.log(`\u2705 Found Signpost Town at (${n.x}, ${n.y}) on homestead grid ${e}`),{x:n.x,y:n.y};console.log(`\u26a0\ufe0f Signpost Town not found on homestead grid ${e}, using default (1, 1)`)}}catch(t){console.error(`\u274c Error fetching homestead grid data for grid ${e}:`,t)}return{x:1,y:1}},s=async e=>{try{const t=(await o.A.get(`${r.A}/api/load-grid/${e}`)).data;if(t.resources&&Array.isArray(t.resources)){const n=t.resources.find((e=>"Signpost Home"===e.type));if(n)return console.log(`\u2705 Found Signpost Home at (${n.x}, ${n.y}) on town grid ${e}, placing player at (${n.x-1}, ${n.y})`),{x:n.x-1,y:n.y};console.log(`\u26a0\ufe0f Signpost Home not found on town grid ${e}, using default (0, 0)`)}}catch(t){console.error(`\u274c Error fetching town grid data for grid ${e}:`,t)}return{x:0,y:0}},i=async e=>{try{console.log(`Fetching homestead owner for gridId: ${e}`);const t=await o.A.get(`${r.A}/api/load-grid/${e}`),{ownerId:n=null,gridType:a=null}=t.data;if(console.log("ownerId =",n),!n)return console.log("\ud83c\udfe1 This homestead is unoccupied."),{username:null,gridType:a};const s=await o.A.get(`${r.A}/api/player/${n._id}`),{username:i=null}=s.data;return i?(console.log(`\ud83c\udfe1 Homestead belongs to: ${i}`),{username:i,gridType:a}):(console.warn("\ud83d\udea8 Owner's player document not found!"),{username:null,gridType:a})}catch(t){return console.error("\u274c Error fetching homestead owner:",t),{username:null,gridType:null}}},l=(e,t)=>e&&t&&"undefined"!==typeof e.x&&"undefined"!==typeof e.y&&"undefined"!==typeof t.x&&"undefined"!==typeof t.y?Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)):(console.warn("Skipping distance calculation due to invalid position:",{pos1:e,pos2:t}),1/0),c=(e,t)=>{var n,r;if(!e||!Array.isArray(t))return 1;const o=e.range||1,a=(null===(n=e.skills)||void 0===n?void 0:n.reduce(((e,n)=>{const r=t.find((e=>e.type===n.type));return"range"===(null===r||void 0===r?void 0:r.output)&&"number"===typeof r.qtycollected?e+r.qtycollected:e}),0))||0;return"homestead"===(null===e||void 0===e||null===(r=e.location)||void 0===r?void 0:r.gtype)?o+a+5:o+a}},7651:(e,t,n)=>{"use strict";var r=n(1251);e.exports=r.getPrototypeOf||null},7724:e=>{"use strict";var t=Object.prototype.toString,n=Math.max,r=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var o=0;o<t.length;o+=1)n[o+e.length]=t[o];return n};e.exports=function(e){var o=this;if("function"!==typeof o||"[object Function]"!==t.apply(o))throw new TypeError("Function.prototype.bind called on incompatible "+o);for(var a,s=function(e,t){for(var n=[],r=t||0,o=0;r<e.length;r+=1,o+=1)n[o]=e[r];return n}(arguments,1),i=n(0,o.length-s.length),l=[],c=0;c<i;c++)l[c]="$"+c;if(a=Function("binder","return function ("+function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n}(l,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof a){var t=o.apply(this,r(s,arguments));return Object(t)===t?t:this}return o.apply(e,r(s,arguments))})),o.prototype){var d=function(){};d.prototype=o.prototype,a.prototype=new d,d.prototype=null}return a}},7792:(e,t,n)=>{"use strict";var r=n(2816);e.exports=function(e){return r(e)||0===e?e:e<0?-1:1}},7858:(e,t,n)=>{"use strict";var r=n(2),o=n(8117),a=n(8206),s=n(4902),i=r("%Map%",!0),l=o("Map.prototype.get",!0),c=o("Map.prototype.set",!0),d=o("Map.prototype.has",!0),u=o("Map.prototype.delete",!0),h=o("Map.prototype.size",!0);e.exports=!!i&&function(){var e,t={assert:function(e){if(!t.has(e))throw new s("Side channel does not contain "+a(e))},delete:function(t){if(e){var n=u(e,t);return 0===h(e)&&(e=void 0),n}return!1},get:function(t){if(e)return l(e,t)},has:function(t){return!!e&&d(e,t)},set:function(t,n){e||(e=new i),c(e,t,n)}};return t}},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},8014:(e,t,n)=>{"use strict";n.d(t,{A:()=>S});var r=n(8665),o=n(2667),a=n(7605),s=n(5823);async function i(e){const t=async()=>{await o.Ay.updateNPC(e,this.id,{state:this.state,grazeEnd:this.grazeEnd,position:this.position})},n=s.default.getTiles(),r=s.default.getResources(),i=Object.values(o.Ay.getNPCsInGrid(e)||{});if(e=e||this.gridId,n&&r)if("processing"!==this.state)switch(this.state){case"idle":if(!await this.handleIdleState(n,r,i,4,(async()=>{this.grazeEnd&&Date.now()>=this.grazeEnd?this.state="processing":this.state="hungry",await t()})))return;break;case"hungry":{const e=Date.now();if(this.grazeEnd&&e>=this.grazeEnd){console.log(`\u23f3 Grazing already done \u2014 NPC ${this.id} skipping hungry. SKIP_STALL mode: entering processing.`),this.state="processing",await t();break}if(!this.targetGrassTile){const e="Pig"===this.type?"d":"g",t=await this.findTileInRange(e,n,r);if(!Array.isArray(t)||0===t.length){const t="d"===e?"dirt":"grass";console.warn(`No ${t} tiles found for NPC ${this.id}. Transitioning to idle.`),this.state="idle";break}const o=t.filter((e=>{if(r.some((t=>t.x===e.x&&t.y===e.y)))return!1;return!i.some((t=>{var n,r;return t.id!==this.id&&"graze"===t.action&&Math.floor(null===(n=t.position)||void 0===n?void 0:n.x)===e.x&&Math.floor(null===(r=t.position)||void 0===r?void 0:r.y)===e.y}))}));if(0===o.length){const t="d"===e?"dirt":"grass";console.warn(`No unoccupied ${t} tiles found for NPC ${this.id}. Transitioning to idle.`),this.state="idle";break}o.sort(((e,t)=>(0,a.gd)(this.position,e)-(0,a.gd)(this.position,t))),this.targetGrassTile=o[0]}if(!this.targetGrassTile||"number"!==typeof this.targetGrassTile.x||"number"!==typeof this.targetGrassTile.y){console.warn(`\ud83d\udc04 [Hungry] NPC ${this.id} has invalid targetGrassTile. Roaming to unstuck.`),this.targetGrassTile=null,this.state="roam",await t();break}{const e=this.targetGrassTile.x-Math.floor(this.position.x),o=this.targetGrassTile.y-Math.floor(this.position.y);let a=null;if(0===e&&0===o){if(i.some((e=>{var t,n;return e.id!==this.id&&"graze"===e.action&&Math.floor(null===(t=e.position)||void 0===t?void 0:t.x)===this.targetGrassTile.x&&Math.floor(null===(n=e.position)||void 0===n?void 0:n.y)===this.targetGrassTile.y}))){console.warn("Another animal took our target grass tile! Finding new one."),this.targetGrassTile=null;break}this.state="grazing",this.targetGrassTile=null,await t();break}if(e>0&&o>0?a="SE":e>0&&o<0?a="NE":e<0&&o>0?a="SW":e<0&&o<0?a="NW":e>0?a="E":e<0?a="W":o>0?a="S":o<0&&(a="N"),!a){console.warn(`NPC ${this.id} could not determine direction to grass tile.`),this.state="idle",this.targetGrassTile=null;break}if(!this.isMoving){this.isMoving=!0;const e=await this.moveOneTile(a,n,r,i);if(this.position.x=Math.floor(this.position.x),this.position.y=Math.floor(this.position.y),this.isMoving=!1,!e){console.warn(`NPC ${this.id} is stuck and cannot move toward the grass. Switching to idle.`),this.targetGrassTile=null,this.state="idle",await t();break}}if(this.targetGrassTile&&Math.floor(this.position.x)===this.targetGrassTile.x&&Math.floor(this.position.y)===this.targetGrassTile.y){i.some((e=>{var t,n;return e.id!==this.id&&"graze"===e.action&&Math.floor(null===(t=e.position)||void 0===t?void 0:t.x)===this.targetGrassTile.x&&Math.floor(null===(n=e.position)||void 0===n?void 0:n.y)===this.targetGrassTile.y}))?(console.warn("Another animal took our target grass tile! Finding new one."),this.targetGrassTile=null):(this.state="grazing",this.targetGrassTile=null,await t())}}break}case"grazing":{const e=Date.now();this.grazeEnd||(this.grazeEnd=e+1e3*this.growTime,await t()),e>=this.grazeEnd&&(console.log(`\ud83d\udc04 NPC ${this.id} finished grazing. SKIP_STALL mode: entering processing state in-place.`),this.state="processing",await t());break}case"stall":{const a=o.Ay.getNPCsInGrid(e);if(this.stallRetries||(this.stallRetries=0),this.failedStalls||(this.failedStalls=[]),!this.targetStall&&(this.targetStall=this.findNearestResource("stall",n,r,this.failedStalls),!this.targetStall)){console.log("No availalbe stall, returning to idle."),this.state="idle",this.stallRetries=0,this.failedStalls=[];break}if(!r.find((e=>e.x===this.targetStall.x&&e.y===this.targetStall.y))){console.warn(`Target stall at (${this.targetStall.x}, ${this.targetStall.y}) is no longer valid. Transitioning to idle.`),this.state="idle",this.targetStall=null;break}const s=this.targetStall.x-Math.floor(this.position.x),d=this.targetStall.y-Math.floor(this.position.y);let u=null;if(0!==s&&0!==d?s>0&&d>0?u="SE":s>0&&d<0?u="NE":s<0&&d>0?u="SW":s<0&&d<0&&(u="NW"):0!==s?u=s>0?"E":"W":0!==d&&(u=d>0?"S":"N"),!u&&Math.floor(this.position.x)!==this.targetStall.x&&Math.floor(this.position.y)!==this.targetStall.y){console.warn(`NPC ${this.id} could not determine direction to stall.`),this.state="idle",this.targetStall=null;break}if(!this.isMoving){this.isMoving=!0;const e=await this.moveOneTile(u,n,r,i);if(this.position.x=Math.floor(this.position.x),this.position.y=Math.floor(this.position.y),this.isMoving=!1,!e){if(this.stallRetries++,this.stallRetries<5);else{console.warn(`NPC ${this.id} cannot reach stall at (${this.targetStall.x}, ${this.targetStall.y}). Trying alternative.`),this.failedStalls||(this.failedStalls=[]),this.failedStalls.push({x:this.targetStall.x,y:this.targetStall.y}),this.targetStall=null,this.stallRetries=0;this.findNearestResource("stall",n,r,this.failedStalls)||(this.state="idle",this.failedStalls=[],this.triedStall=!0)}await t();break}await t()}const h=Math.floor(this.position.x)===this.targetStall.x&&Math.floor(this.position.y)===this.targetStall.y,p=Math.abs(Math.floor(this.position.x)-this.targetStall.x)<=1&&Math.abs(Math.floor(this.position.y)-this.targetStall.y)<=1;if(h||p&&this.stallRetries>2){const n=Object.values(a||{}).filter((e=>{var t,n;return e.id!==this.id&&Math.floor(null===(t=e.position)||void 0===t?void 0:t.x)===this.targetStall.x&&Math.floor(null===(n=e.position)||void 0===n?void 0:n.y)===this.targetStall.y&&"graze"===e.action}));if(console.log(`\ud83d\udc2e NPC ${this.id} reached stall at (${this.targetStall.x}, ${this.targetStall.y}). Other animals at same position: ${n.length}`),n.length>0){console.log("\ud83d\udc2e Stall is occupied! Adding to failed list and trying another."),this.failedStalls||(this.failedStalls=[]),this.failedStalls.push({x:this.targetStall.x,y:this.targetStall.y}),this.targetStall=null,this.stallRetries=0,await t();break}this.state="processing",console.log(`\ud83d\udc2e\u2705 NPC ${this.id} transitioning to processing state. GrazeEnd: ${this.grazeEnd}`);try{var l;await t(),console.log(`\ud83d\udc2e\u2705 NPC ${this.id} state update to 'processing' sent to server`),await new Promise((e=>setTimeout(e,500)));const n=null===(l=o.Ay.getNPCsInGrid(e))||void 0===l?void 0:l[this.id];n&&"processing"!==n.state?(console.error(`\u274c State update verification failed! NPC ${this.id} state is ${n.state} instead of 'processing'`),this.state="processing",await t(),console.log(`\ud83d\udc2e\ud83d\udd04 Retried state update for NPC ${this.id}`),await new Promise((e=>setTimeout(e,500)))):console.log(`\ud83d\udc2e\u2705 Verified NPC ${this.id} is in processing state`)}catch(c){console.error(`\u274c Failed to update NPC ${this.id} to processing state:`,c)}}break}case"processing":if(this.grazeEnd&&Date.now()>=this.grazeEnd){console.log(`\ud83d\udc2e NPC ${this.id} is in processing state and ready for collection. GrazeEnd: ${this.grazeEnd}`);const e=Date.now()-this.grazeEnd;e>36e5&&(console.warn(`\u26a0\ufe0f NPC ${this.id} has been in processing state for ${Math.floor(e/1e3)} seconds. Resetting to emptystall.`),this.state="emptystall",await t())}break;case"emptystall":this.targetStall=null,this.grazeEnd=null,this.state="roam",await t();break;case"roam":await this.handleRoamState(n,r,i,(async()=>{this.grazeEnd?(console.log(`\ud83d\ude10 NPC ${this.id} completed roam but grazing NOT done. Going idle.`),this.state="idle"):(console.log(`\ud83c\udf31 NPC ${this.id} has no grazeEnd, transitioning to hungry.`),this.state="hungry"),await t()}));break;default:console.warn(`NPC ${this.id} is in an unhandled state: ${this.state}`)}else(!this.lastProcessingLog||Date.now()-this.lastProcessingLog>5e3)&&(this.lastProcessingLog=Date.now());else console.error(`Tiles or resources are missing for NPC ${this.id}.`)}var l=n(1431),c=n(1593);async function d(e){const t=s.default.getTiles(),n=s.default.getResources(),r=Object.values(o.Ay.getNPCsInGrid(e)||{});if(e=e||this.gridId,!t||!n)return void console.error(`Tiles or resources are missing for NPC ${this.id}.`);"roam"!==this.state&&(this.state="roam",await o.Ay.updateNPC(e,this.id,{state:this.state,position:this.position}));Object.values(l.default.getPlayersInGrid(e)||{}).some((e=>(0,a.gd)(e.position,this.position)<=(this.range||3)&&e.hp>0&&!(0,c.iZ)(this.position,e.position)))||await this.handleRoamState(t,n,r,(()=>{}))}var u=n(6894);function h(e,t,n){const r=n.size||1;return e>=n.x&&e<n.x+r&&t>=n.y&&t<n.y+r}function p(e,t){const n=s.default.getResources(),r=function(e,t){const n=[];let r=Math.floor(e.x),o=Math.floor(e.y);const a=Math.floor(t.x),s=Math.floor(t.y),i=Math.abs(a-r),l=Math.abs(s-o),c=r<a?1:-1,d=o<s?1:-1;let u=i-l,h=r,p=o;for(;r===Math.floor(e.x)&&o===Math.floor(e.y)||r===a&&o===s||(n.push({x:r,y:o}),h!==r&&p!==o&&(n.push({x:h,y:o}),n.push({x:r,y:p}))),r!==a||o!==s;){h=r,p=o;const e=2*u;e>-l&&(u-=l,r+=c),e<i&&(u+=i,o+=d)}return n}(e,t);for(const o of r){if(n.find((e=>("wall"===e.action||"door"===e.action)&&h(o.x,o.y,e))))return!1}return!0}const m=async function(e){await o.Ay.updateNPC(e,this.id,{state:this.state,position:this.position})};async function f(e,t){const n=s.default.getTiles(),r=s.default.getResources(),a=Object.values(o.Ay.getNPCsInGrid(e)||{}),i=Object.values(l.default.getPlayersInGrid(e)||{});this.state&&"idle"!==this.state||(this.state="roam",await m.call(this,e));const c=i.filter((e=>{if(e.hp<=0)return!1;return!(g(this.position,e.position)>this.range)&&p(this.position,e.position)}));if(c.length>0&&"roam"===this.state){const t=c[Math.floor(Math.random()*c.length)];return console.log(`\u26a1 NPC ${this.id} spotted PC ${t.username}! Entering pursue state.`),this.targetPC=t,this.state="pursue",this.pursueTimerStart=null,void await m.call(this,e)}switch(this.state){case"idle":this.pursueTimerStart=null,await this.handleIdleState(n,r,a,2,(async()=>{this.state="roam",this.targetPC=null,await m.call(this,e)}));break;case"pursue":{var d;if(this.targetPC=i.find((e=>{var t;return e.playerId===(null===(t=this.targetPC)||void 0===t?void 0:t.playerId)})),!this.targetPC){this.state="roam",this.pursueTimerStart=null,await m.call(this,e);break}if(!p(this.position,this.targetPC.position)){var h;console.log(`\ud83d\udc41\ufe0f NPC ${this.id} lost sight of ${null===(h=this.targetPC)||void 0===h?void 0:h.username} during pursuit. Returning to roam.`),this.state="roam",this.pursueTimerStart=null,this.targetPC=null,await m.call(this,e);break}const t=g(this.position,this.targetPC.position);if(t<=this.attackrange){if(p(this.position,this.targetPC.position)){console.log(`NPC ${this.id} is already in attack range (${t} <= ${this.attackrange}) and can see target. Switching to attack!`),this.state="attack",await m.call(this,e);break}console.log(`NPC ${this.id} is in range but can't see ${this.targetPC.username} due to walls. Continuing pursuit.`)}this.pursueTimerStart||(this.pursueTimerStart=Date.now());const o=Date.now()-this.pursueTimerStart,s=g(this.position,null===(d=this.targetPC)||void 0===d?void 0:d.position),l=function(e,t){let n=null,r=1/0;return t.forEach((t=>{if(t.hp<=0)return;const o=g(e,t.position);o<r&&p(e,t.position)&&(r=o,n=t)})),n}(this.position,i);if(l&&l.playerId!==this.targetPC.playerId){s-g(this.position,l.position)>=2&&(console.log(`\ud83d\udd04 NPC ${this.id} switching target from ${this.targetPC.username} to much closer PC ${l.username}.`),this.targetPC=l)}const c=p(this.position,this.targetPC.position);if(s>2*this.range&&o>5e3||!c){var f,y;if(c)console.log(`\ud83d\udc3a NPC ${this.id} gave up chasing ${null===(f=this.targetPC)||void 0===f?void 0:f.username} (too far).`);else console.log(`\ud83d\udc41\ufe0f NPC ${this.id} lost sight of ${null===(y=this.targetPC)||void 0===y?void 0:y.username} (wall blocking). Giving up pursuit.`);this.state="roam",this.pursueTimerStart=null,this.targetPC=null,await m.call(this,e);break}console.log(`NPC ${this.id} is pursuing PC ${this.targetPC.username}.`);const u=async()=>{const t=this.targetPC.position.x-this.position.x,o=this.targetPC.position.y-this.position.y;let s=null;Math.abs(t)>Math.abs(o)?s=t>0?"E":"W":0!==o&&(s=o>0?"S":"N"),Math.abs(t)===Math.abs(o)&&(t>0&&o>0?s="SE":t>0&&o<0?s="NE":t<0&&o>0?s="SW":t<0&&o<0&&(s="NW"));const i=g(this.position,this.targetPC.position);if(console.log(`\ud83c\udfaf NPC ${this.id} distance to player: ${i} | range: ${this.attackrange}`),i<=this.attackrange){if(p(this.position,this.targetPC.position))return console.log(`NPC ${this.id} can see and attack ${this.targetPC.username}. Transitioning to attack!`),this.state="attack",void await m.call(this,e);console.log(`NPC ${this.id} is in range but can't see ${this.targetPC.username} due to walls. Continuing pursuit.`)}if(!s)return;await this.moveOneTile(s,n,r,a)?this.stuckCounter=0:(console.log(`NPC ${this.id} could not move in direction ${s}.`),this.stuckCounter||(this.stuckCounter=0),this.stuckCounter++,this.stuckCounter>=3&&(console.log(`NPC ${this.id} appears stuck after ${this.stuckCounter} failed moves. Using idle to unstick.`),this.state="idle",this.stuckCounter=0,await m.call(this,e)))};await u();break}case"attack":if(this.targetPC=i.find((e=>{var t;return e.playerId===(null===(t=this.targetPC)||void 0===t?void 0:t.playerId)})),this.targetPC=i.find((e=>{var t;return e.playerId===(null===(t=this.targetPC)||void 0===t?void 0:t.playerId)})),!this.targetPC){this.pursueTimerStart=null,this.state="roam",await m.call(e);break}if(this.targetPC.hp<=0||this.targetPC.iscamping){this.state="roam",await m.call(this,e);break}if(g(this.position,this.targetPC.position)>this.attackrange){this.state="pursue",await m.call(this,e);break}if(!p(this.position,this.targetPC.position)){console.log(`NPC ${this.id} lost sight of ${this.targetPC.username} due to walls. Returning to 'pursue' state.`),this.state="pursue",await m.call(this,e);break}if(Math.floor(20*Math.random())+1+this.attackbonus>=this.targetPC.armorclass){const n=Math.floor(6*Math.random())+1+this.damage,r=-n;try{const o=Math.max(0,this.targetPC.hp+r);u.A.addFloatingText(`- ${n} \u2764\ufe0f\u200d\ud83e\ude79 HP`,this.targetPC.position.x,this.targetPC.position.y,t),l.default.updatePC(e,this.targetPC.playerId,{hp:o,lastUpdated:Date.now()})}catch(v){console.error(`Error applying damage to player ${this.targetPC.username}:`,v)}}else u.A.addFloatingText(503,this.targetPC.position.x,this.targetPC.position.y,t),setTimeout((()=>{this.state="attack"}),this.speed);break;case"roam":this.pursueTimerStart=null,await this.handleRoamState(n,r,a,(()=>{}));break;default:console.warn(`Unhandled state: ${this.state}`)}}function g(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}async function y(e){const t=s.default.getTiles(),n=s.default.getResources(),r=Object.values(o.Ay.getNPCsInGrid(e)||{});if(e=e||this.gridId,!t||!n)return void console.error(`Tiles or resources are missing for NPC ${this.id}.`);"roam"!==this.state&&(this.state="roam",await o.Ay.updateNPC(e,this.id,{state:this.state,position:this.position}));Object.values(l.default.getPlayersInGrid(e)||{}).some((e=>(0,a.gd)(e.position,this.position)<=(e.range||3)&&e.hp>0&&!(0,c.iZ)(this.position,e.position)))||await this.handleRoamState(t,n,r,(()=>{}))}async function v(e){if(!o.Ay.getNPCsInGrid(e))return void console.warn(`GridState unavailable for gridId ${e}.`);const t=o.Ay.getNPCsInGrid(e),n=Object.values(t||{}),r=l.default.getPlayersInGrid(e),s=Object.values(r||{}),i=this.position.x,c=this.position.y;switch(this.state){case"idle":s.some((e=>(0,a.gd)(e.position,this.position)<this.range))&&(console.log(`[Spawner] ${this.type} detected PCs nearby. Transitioning to spawn state.`),this.state="spawn",await o.Ay.updateNPC(e,this.id,{state:this.state,position:this.position,nextspawn:this.nextspawn}));break;case"spawn":if(n.filter((e=>e.type===this.requires)).length>=this.qtycollected)return console.log(`[Spawner] Max ${this.requires} reached (${this.qtycollected}). Returning to idle.`),this.state="idle",void await o.Ay.updateNPC(e,this.id,{state:this.state,position:this.position,nextspawn:this.nextspawn});if(!this.nextspawn||Date.now()>=this.nextspawn){console.log(`[Spawner] Spawning new ${this.requires} at (${this.position.x}, ${this.position.y}).`);const t={x:this.position.x,y:this.position.y};await o.Ay.spawnNPC(e,{type:this.requires},t),this.nextspawn=Date.now()+1e3*this.speed,await o.Ay.updateNPC(e,this.id,{state:this.state,position:this.position,nextspawn:this.nextspawn})}else console.log("[Spawner] Waiting for next spawn cycle.");s.some((e=>(0,a.gd)(e.position,this.position)<this.range))||(console.log("[Spawner] No PCs nearby. Returning to idle."),this.state="idle",await o.Ay.updateNPC(e,this.id,{state:this.state,position:this.position,nextspawn:this.nextspawn}));break;default:console.warn(`Unhandled state for NPC ${this.id}: ${this.state}`)}this.position.x===i&&this.position.y===c||console.error(`[Spawner] ERROR: Spawner ${this.id} moved from (${i}, ${c}) to (${this.position.x}, ${this.position.y})!`)}async function b(e){const t=s.default.getTiles(),n=s.default.getResources();Object.values(o.Ay.getNPCsInGrid(e)||{});e=e||this.gridId,t&&n||console.error(`Tiles or resources are missing for NPC ${this.id}.`)}async function x(e){const t=s.default.getTiles(),n=s.default.getResources();Object.values(o.Ay.getNPCsInGrid(e)||{});if(e=e||this.gridId,t&&n)if("idle"===this.state);else console.warn(`NPC ${this.id} is in an unhandled state: ${this.state}`);else console.error(`Tiles or resources are missing for NPC ${this.id}.`)}class w{constructor(e,t,n,r,o){var a;if(!r||"object"!==typeof r)throw console.error(`Invalid properties passed to NPC constructor for type ${t}:`,r),new Error("NPC constructor requires valid properties.");this.updateInterval=r.updateInterval||1e3,this.id=e,this.type=t,this.position={x:Math.floor(n.x),y:Math.floor(n.y)},this.symbol=r.symbol,this.hp=r.hp||0,this.output=r.output,this.maxhp=r.maxhp||0,this.range=r.range,this.action=r.action,this.state=r.state||"idle",this.speed=r.speed,this.growTime=r.growtime||0,this.processingStartTime=void 0,this.nextspawn=null!==(a=r.nextspawn)&&void 0!==a?a:"spawn"===this.action?Date.now()+5e3:null,this.grazeEnd=r.grazeEnd||null,this.lastUpdated=Date.now(),this.gridId=r.gridId||o;const{type:s,id:i,...l}=r;Object.assign(this,l),console.log(`\u2705 NPC ${this.id} constructed at position (${this.position.x}, ${this.position.y}) with state: ${this.state}`)}update(e,t,n,r){e-this.lastUpdated<this.updateInterval||(this.processState(t,n,r),this.lastUpdated=e)}async processState(e,t,n){try{switch(this.action){case"graze":await this.handleFarmAnimalBehavior(t);break;case"pet":break;case"quest":await this.handleQuestGiverBehavior(t);break;case"trade":await this.handleTraderBehavior(t);break;case"worker":await this.handleWorkerBehavior(t);break;case"heal":await this.handleHealBehavior(t);break;case"attack":await this.handleEnemyBehavior(t,n);break;case"spawn":await this.handleSpawnBehavior(t);break;default:console.warn(`Unhandled NPC action: ${this.action}`)}}catch(r){console.error(`Error in NPC ${this.id} processState:`,r)}}async handleIdleState(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};if(this.idleTimer||(this.idleTimer=0),this.idleTimer++,this.idleTimer>=r){this.idleTimer=0;const r=["N","S","E","W","NE","SE","SW","NW"].filter((r=>{const{x:o,y:a}=this.getAdjacentTile(r);return this.isValidTile(o,a,e,t,n)}));if(r.length>0){const o=r[Math.floor(Math.random()*r.length)];await this.moveOneTile(o,e,t,n)}return o(),!0}return!1}async handleRoamState(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};this.roamSteps=this.roamSteps||0;const o=this.range||4;if(!this.currentDirection){const e=["N","S","E","W","NE","SE","SW","NW"];this.currentDirection=e[Math.floor(Math.random()*e.length)]}const a=({N:["N","NE","NW"],S:["S","SE","SW"],E:["E","NE","SE"],W:["W","NW","SW"],NE:["NE","N","E"],SE:["SE","S","E"],SW:["SW","S","W"],NW:["NW","N","W"]}[this.currentDirection]||[this.currentDirection]).filter((r=>{const{x:o,y:a}=this.getAdjacentTile(r);return this.isValidTile(o,a,e,t,n)}));if(a.length>0){const r=a[Math.floor(Math.random()*a.length)];await this.moveOneTile(r,e,t,n),this.roamSteps++}else this.currentDirection=null;(this.roamSteps>=o||0===a.length)&&(this.roamSteps=0,this.currentDirection=null,r())}async handlePursueState(e,t,n,r,o,s){const i=e.x-this.position.x,l=e.y-this.position.y;let c=null;Math.abs(i)>Math.abs(l)?c=i>0?"E":"W":0!==l&&(c=l>0?"S":"N"),Math.abs(i)===Math.abs(l)&&(i>0&&l>0?c="SE":i>0&&l<0?c="NE":i<0&&l>0?c="SW":i<0&&l<0&&(c="NW"));const d=(0,a.gd)(this.position,e);if(console.log(`\ud83c\udfaf NPC ${this.id} distance to player: ${d} | range: ${this.attackrange}`),d<=this.attackrange)return this.state="attack",void await s();if(!c)return;if(!await this.moveOneTile(c,t,n,r))return void(d<=this.attackrange?(console.log(`\ud83c\udfaf NPC ${this.id} blocked but in attack range! Transitioning to attack.`),this.state="attack",await s()):(console.warn(`\ud83d\udeab NPC ${this.id} couldn't move toward target. Stuck? Returning to idle.`),this.state="idle",this.pursueTimerStart=null,this.targetPC=null));const u=(0,a.gd)(this.position,e);console.log(`\ud83c\udfaf NPC ${this.id} NEW distance to player: ${u} | range: ${this.attackrange}`),u<=this.attackrange&&(this.state="attack",await s())}async moveOneTile(e,t,n,a){if("spawn"===this.action)return console.warn(`Spawner ${this.id} cannot move!`),!1;const s={N:{x:0,y:-1},S:{x:0,y:1},E:{x:1,y:0},W:{x:-1,y:0},NE:{x:1,y:-1},SE:{x:1,y:1},SW:{x:-1,y:1},NW:{x:-1,y:-1}}[e];if(!s)return console.error(`Invalid direction: ${e}`),!1;const i=Math.floor(this.position.x+s.x),l=Math.floor(this.position.y+s.y);if(!this.isValidTile(i,l,t,n,a))return console.warn(`NPC ${this.id} cannot move to invalid tile (${i}, ${l}).`),!1;return this.position.x=i,this.position.y=l,o.Ay.updateNPCPosition(this.gridId,this.id,{x:i,y:l}),new Promise((e=>{setTimeout((()=>{r.Ay&&r.Ay.connected&&r.Ay.emit("npc-moved",{gridId:this.gridId,npcId:this.id,newPosition:{x:i,y:l},emitterId:r.Ay.id}),e(!0)}),1200)}))}getAdjacentTile(e){const t={N:{x:0,y:-1},S:{x:0,y:1},E:{x:1,y:0},W:{x:-1,y:0},NE:{x:1,y:-1},SE:{x:1,y:1},SW:{x:-1,y:1},NW:{x:-1,y:-1}}[e];return t?{x:this.position.x+t.x,y:this.position.y+t.y}:(console.error(`Invalid direction: ${e}`),{x:this.position.x,y:this.position.y})}isValidTile(e,t,n,r,o){if(e=Math.floor(e),t=Math.floor(t),!n||!Array.isArray(n))return!1;if(!r||!Array.isArray(r))return!1;if(e<0||t<0||t>=n.length||e>=n[0].length)return!1;if(!(!0===this[`validon${n[t][e]}`]))return!1;const a=r.find((n=>n.x===e&&n.y===t));if(a&&!a.passable)return!1;if(!Array.isArray(o))return console.warn("NPC list is invalid or undefined. Skipping NPC collision check."),!0;const s=o.find((n=>Math.floor(n.position.x)===e&&Math.floor(n.position.y)===t&&n.id!==this.id));if(s){if(!("graze"===this.action&&"graze"===s.action))return!1}return!0}async findTileInRange(e,t,n){const r=Math.floor(this.range||3),o=Math.floor(this.position.x),a=Math.floor(this.position.y);if(!t||0===t.length||!Array.isArray(t))return[];const s=[];for(let l=-r;l<=r;l++)for(let n=-r;n<=r;n++){var i;const r=o+l,c=a+n;r<0||c<0||c>=t.length||r>=(null===(i=t[c])||void 0===i?void 0:i.length)||t[c][r]===e&&s.push({x:r,y:c})}return console.log(`Found ${s.length} potential tiles for type "${e}".`),s}findNearestResource(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!n||!Array.isArray(n)||0===n.length)return null;const s={x:Math.floor(this.position.x),y:Math.floor(this.position.y)},i=Object.values(o.Ay.getNPCsInGrid(this.gridId)||{}),l=n.filter((t=>{if(t.category!==e||"number"!==typeof t.x||"number"!==typeof t.y)return!1;if(r.some((e=>e.x===t.x&&e.y===t.y)))return!1;if("stall"===e){if(i.some((e=>{var n,r;return e.id!==this.id&&"graze"===e.action&&Math.floor(null===(n=e.position)||void 0===n?void 0:n.x)===t.x&&Math.floor(null===(r=e.position)||void 0===r?void 0:r.y)===t.y})))return!1}return!0}));if(0===l.length)return null;l.sort(((e,t)=>{const n={x:Math.floor(e.x),y:Math.floor(e.y)},r={x:Math.floor(t.x),y:Math.floor(t.y)};return(0,a.gd)(s,n)-(0,a.gd)(s,r)}));return l[0]}findAllResources(e,t,n){if(!n||!Array.isArray(n)||0===n.length)return[];const r={x:Math.floor(this.position.x),y:Math.floor(this.position.y)},o=n.filter((t=>t.category===e&&"number"===typeof t.x&&"number"===typeof t.y));return o.sort(((e,t)=>{const n={x:Math.floor(e.x),y:Math.floor(e.y)},o={x:Math.floor(t.x),y:Math.floor(t.y)};return(0,a.gd)(r,n)-(0,a.gd)(r,o)})),o}}!function(e){e.prototype.handleFarmAnimalBehavior=i}(w),function(e){e.prototype.handleQuestGiverBehavior=d}(w),function(e){e.prototype.handleEnemyBehavior=f}(w),function(e){e.prototype.handleHealBehavior=y}(w),function(e){e.prototype.handleSpawnBehavior=v}(w),function(e){e.prototype.handleWorkerBehavior=b}(w),function(e){e.prototype.handleTraderBehavior=x}(w);const S=w},8117:(e,t,n)=>{"use strict";var r=n(2),o=n(4781),a=o([r("%String.prototype.indexOf%")]);e.exports=function(e,t){var n=r(e,!!t);return"function"===typeof n&&a(e,".prototype.")>-1?o([n]):n}},8146:(e,t,n)=>{"use strict";n.d(t,{G9:()=>T,Mp:()=>v,O5:()=>x,Xs:()=>g,_M:()=>f,aI:()=>w,hC:()=>m,sk:()=>y,uq:()=>S,zz:()=>b});var r=n(3488),o=n(6213);let a=null,s=null,i=null,l=null,c=null,d=null,u=null,h=null,p=null;async function m(){if(!a)try{const e=await o.A.get(`${r.A}/api/skills-tuning`);a=e.data,console.log("Skills tuning loaded:",a)}catch(e){console.error("Error fetching master skills:",e),a={}}return a}async function f(){if(!s)try{const e=await o.A.get(`${r.A}/api/resources`);s=e.data,console.log("Master resources loaded:",s)}catch(e){console.error("Error fetching master resources:",e),s=[]}return s}async function g(){if(!i)try{const e=await o.A.get(`${r.A}/api/global-tuning`);i=e.data,console.log("Global tuning loaded:",i)}catch(e){console.error("Error fetching global tuning:",e),i={}}return i}async function y(){if(!l)try{const e=await o.A.get(`${r.A}/api/interactions`);l=e.data,console.log("Master interactions loaded:",l)}catch(e){console.error("Error fetching master interactions:",e),l=[]}return l}async function v(){if(!c)try{const e=await o.A.get(`${r.A}/api/traders`);c=e.data,console.log("Master traders loaded:",c)}catch(e){console.error("Error fetching master traders:",e),c=[]}return c}async function b(){if(!d)try{const e=await o.A.get(`${r.A}/api/trophies`);d=e.data,console.log("Master trophies loaded:",d)}catch(e){console.error("Error fetching master trophies:",e),d=[]}return d}async function x(){if(!u)try{const e=await o.A.get(`${r.A}/api/warehouse`);u=e.data,console.log("Master warehouse loaded:",u)}catch(e){console.error("Error fetching master warehouse:",e),u=[]}return u}async function w(){if(!h)try{const e=await o.A.get(`${r.A}/api/xp-levels`);h=e.data,console.log("Master XP levels loaded:",h)}catch(e){console.error("Error fetching master XP levels:",e),h=[]}return h}async function S(){if(!p)try{const e=await o.A.get(`${r.A}/api/ftue-steps`);p=e.data,console.log("FTUE steps loaded:",p)}catch(e){console.error("Error fetching FTUE steps:",e),p=[]}return p}function T(){return p||[]}},8206:(e,t,n)=>{var r="function"===typeof Map&&Map.prototype,o=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,a=r&&o&&"function"===typeof o.get?o.get:null,s=r&&Map.prototype.forEach,i="function"===typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=i&&l&&"function"===typeof l.get?l.get:null,d=i&&Set.prototype.forEach,u="function"===typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,h="function"===typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"===typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,f=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,v=String.prototype.slice,b=String.prototype.replace,x=String.prototype.toUpperCase,w=String.prototype.toLowerCase,S=RegExp.prototype.test,T=Array.prototype.concat,C=Array.prototype.join,k=Array.prototype.slice,A=Math.floor,I="function"===typeof BigInt?BigInt.prototype.valueOf:null,E=Object.getOwnPropertySymbols,P="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?Symbol.prototype.toString:null,_="function"===typeof Symbol&&"object"===typeof Symbol.iterator,N="function"===typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===_||"symbol")?Symbol.toStringTag:null,R=Object.prototype.propertyIsEnumerable,M=("function"===typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function j(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||S.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"===typeof e){var r=e<0?-A(-e):A(e);if(r!==e){var o=String(r),a=v.call(t,o.length+1);return b.call(o,n,"$&_")+"."+b.call(b.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,n,"$&_")}var D=n(2634),O=D.custom,B=q(O)?O:null,L={__proto__:null,double:'"',single:"'"},F={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function $(e,t,n){var r=n.quoteStyle||t,o=L[r];return o+e+o}function G(e){return b.call(String(e),/"/g,"&quot;")}function z(e){return!N||!("object"===typeof e&&(N in e||"undefined"!==typeof e[N]))}function U(e){return"[object Array]"===Y(e)&&z(e)}function H(e){return"[object RegExp]"===Y(e)&&z(e)}function q(e){if(_)return e&&"object"===typeof e&&e instanceof Symbol;if("symbol"===typeof e)return!0;if(!e||"object"!==typeof e||!P)return!1;try{return P.call(e),!0}catch(t){}return!1}e.exports=function e(t,r,o,i){var l=r||{};if(W(l,"quoteStyle")&&!W(L,l.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(W(l,"maxStringLength")&&("number"===typeof l.maxStringLength?l.maxStringLength<0&&l.maxStringLength!==1/0:null!==l.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var f=!W(l,"customInspect")||l.customInspect;if("boolean"!==typeof f&&"symbol"!==f)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(W(l,"indent")&&null!==l.indent&&"\t"!==l.indent&&!(parseInt(l.indent,10)===l.indent&&l.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(W(l,"numericSeparator")&&"boolean"!==typeof l.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=l.numericSeparator;if("undefined"===typeof t)return"undefined";if(null===t)return"null";if("boolean"===typeof t)return t?"true":"false";if("string"===typeof t)return X(t,l);if("number"===typeof t){if(0===t)return 1/0/t>0?"0":"-0";var S=String(t);return x?j(t,S):S}if("bigint"===typeof t){var A=String(t)+"n";return x?j(t,A):A}var E="undefined"===typeof l.depth?5:l.depth;if("undefined"===typeof o&&(o=0),o>=E&&E>0&&"object"===typeof t)return U(t)?"[Array]":"[Object]";var O=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"===typeof e.indent&&e.indent>0))return null;n=C.call(Array(e.indent+1)," ")}return{base:n,prev:C.call(Array(t+1),n)}}(l,o);if("undefined"===typeof i)i=[];else if(K(i,t)>=0)return"[Circular]";function F(t,n,r){if(n&&(i=k.call(i)).push(n),r){var a={depth:l.depth};return W(l,"quoteStyle")&&(a.quoteStyle=l.quoteStyle),e(t,a,o+1,i)}return e(t,l,o+1,i)}if("function"===typeof t&&!H(t)){var V=function(e){if(e.name)return e.name;var t=y.call(g.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),Z=ne(t,F);return"[Function"+(V?": "+V:" (anonymous)")+"]"+(Z.length>0?" { "+C.call(Z,", ")+" }":"")}if(q(t)){var re=_?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):P.call(t);return"object"!==typeof t||_?re:J(re)}if(function(e){if(!e||"object"!==typeof e)return!1;if("undefined"!==typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"===typeof e.nodeName&&"function"===typeof e.getAttribute}(t)){for(var oe="<"+w.call(String(t.nodeName)),ae=t.attributes||[],se=0;se<ae.length;se++)oe+=" "+ae[se].name+"="+$(G(ae[se].value),"double",l);return oe+=">",t.childNodes&&t.childNodes.length&&(oe+="..."),oe+="</"+w.call(String(t.nodeName))+">"}if(U(t)){if(0===t.length)return"[]";var ie=ne(t,F);return O&&!function(e){for(var t=0;t<e.length;t++)if(K(e[t],"\n")>=0)return!1;return!0}(ie)?"["+te(ie,O)+"]":"[ "+C.call(ie,", ")+" ]"}if(function(e){return"[object Error]"===Y(e)&&z(e)}(t)){var le=ne(t,F);return"cause"in Error.prototype||!("cause"in t)||R.call(t,"cause")?0===le.length?"["+String(t)+"]":"{ ["+String(t)+"] "+C.call(le,", ")+" }":"{ ["+String(t)+"] "+C.call(T.call("[cause]: "+F(t.cause),le),", ")+" }"}if("object"===typeof t&&f){if(B&&"function"===typeof t[B]&&D)return D(t,{depth:E-o});if("symbol"!==f&&"function"===typeof t.inspect)return t.inspect()}if(function(e){if(!a||!e||"object"!==typeof e)return!1;try{a.call(e);try{c.call(e)}catch(oe){return!0}return e instanceof Map}catch(t){}return!1}(t)){var ce=[];return s&&s.call(t,(function(e,n){ce.push(F(n,t,!0)+" => "+F(e,t))})),ee("Map",a.call(t),ce,O)}if(function(e){if(!c||!e||"object"!==typeof e)return!1;try{c.call(e);try{a.call(e)}catch(t){return!0}return e instanceof Set}catch(n){}return!1}(t)){var de=[];return d&&d.call(t,(function(e){de.push(F(e,t))})),ee("Set",c.call(t),de,O)}if(function(e){if(!u||!e||"object"!==typeof e)return!1;try{u.call(e,u);try{h.call(e,h)}catch(oe){return!0}return e instanceof WeakMap}catch(t){}return!1}(t))return Q("WeakMap");if(function(e){if(!h||!e||"object"!==typeof e)return!1;try{h.call(e,h);try{u.call(e,u)}catch(oe){return!0}return e instanceof WeakSet}catch(t){}return!1}(t))return Q("WeakSet");if(function(e){if(!p||!e||"object"!==typeof e)return!1;try{return p.call(e),!0}catch(t){}return!1}(t))return Q("WeakRef");if(function(e){return"[object Number]"===Y(e)&&z(e)}(t))return J(F(Number(t)));if(function(e){if(!e||"object"!==typeof e||!I)return!1;try{return I.call(e),!0}catch(t){}return!1}(t))return J(F(I.call(t)));if(function(e){return"[object Boolean]"===Y(e)&&z(e)}(t))return J(m.call(t));if(function(e){return"[object String]"===Y(e)&&z(e)}(t))return J(F(String(t)));if("undefined"!==typeof window&&t===window)return"{ [object Window] }";if("undefined"!==typeof globalThis&&t===globalThis||"undefined"!==typeof n.g&&t===n.g)return"{ [object globalThis] }";if(!function(e){return"[object Date]"===Y(e)&&z(e)}(t)&&!H(t)){var ue=ne(t,F),he=M?M(t)===Object.prototype:t instanceof Object||t.constructor===Object,pe=t instanceof Object?"":"null prototype",me=!he&&N&&Object(t)===t&&N in t?v.call(Y(t),8,-1):pe?"Object":"",fe=(he||"function"!==typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(me||pe?"["+C.call(T.call([],me||[],pe||[]),": ")+"] ":"");return 0===ue.length?fe+"{}":O?fe+"{"+te(ue,O)+"}":fe+"{ "+C.call(ue,", ")+" }"}return String(t)};var V=Object.prototype.hasOwnProperty||function(e){return e in this};function W(e,t){return V.call(e,t)}function Y(e){return f.call(e)}function K(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function X(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return X(v.call(e,0,t.maxStringLength),t)+r}var o=F[t.quoteStyle||"single"];return o.lastIndex=0,$(b.call(b.call(e,o,"\\$1"),/[\x00-\x1f]/g,Z),"single",t)}function Z(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+x.call(t.toString(16))}function J(e){return"Object("+e+")"}function Q(e){return e+" { ? }"}function ee(e,t,n,r){return e+" ("+t+") {"+(r?te(n,r):C.call(n,", "))+"}"}function te(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+C.call(e,","+n)+"\n"+t.prev}function ne(e,t){var n=U(e),r=[];if(n){r.length=e.length;for(var o=0;o<e.length;o++)r[o]=W(e,o)?t(e[o],e):""}var a,s="function"===typeof E?E(e):[];if(_){a={};for(var i=0;i<s.length;i++)a["$"+s[i]]=s[i]}for(var l in e)W(e,l)&&(n&&String(Number(l))===l&&l<e.length||_&&a["$"+l]instanceof Symbol||(S.call(/[^\w$]/,l)?r.push(t(l,e)+": "+t(e[l],e)):r.push(l+": "+t(e[l],e))));if("function"===typeof E)for(var c=0;c<s.length;c++)R.call(e,s[c])&&r.push("["+t(s[c])+"]: "+t(e[s[c]],e));return r}},8258:e=>{"use strict";e.exports=Object.getOwnPropertyDescriptor},8665:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>qe,pV:()=>Ue,xY:()=>He,kf:()=>ze,jg:()=>$e,zK:()=>Le,j0:()=>De,ZR:()=>Me,zN:()=>je,Wc:()=>Ge,Bp:()=>Oe,uv:()=>Fe,BD:()=>Be});var r={};n.r(r),n.d(r,{Decoder:()=>we,Encoder:()=>be,PacketType:()=>ve,protocol:()=>ye});var o=n(8014),a=n(6894),s=n(2667),i=n(1431);const l=Object.create(null);l.open="0",l.close="1",l.ping="2",l.pong="3",l.message="4",l.upgrade="5",l.noop="6";const c=Object.create(null);Object.keys(l).forEach((e=>{c[l[e]]=e}));const d={type:"error",data:"parser error"},u="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),h="function"===typeof ArrayBuffer,p=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,m=(e,t,n)=>{let{type:r,data:o}=e;return u&&o instanceof Blob?t?n(o):f(o,n):h&&(o instanceof ArrayBuffer||p(o))?t?n(o):f(new Blob([o]),n):n(l[r]+(o||""))},f=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function g(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let y;const v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let We=0;We<64;We++)b[v.charCodeAt(We)]=We;const x="function"===typeof ArrayBuffer,w=(e,t)=>{if("string"!==typeof e)return{type:"message",data:T(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:S(e.substring(1),t)};return c[n]?e.length>1?{type:c[n],data:e.substring(1)}:{type:c[n]}:d},S=(e,t)=>{if(x){const n=(e=>{let t,n,r,o,a,s=.75*e.length,i=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);const c=new ArrayBuffer(s),d=new Uint8Array(c);for(t=0;t<i;t+=4)n=b[e.charCodeAt(t)],r=b[e.charCodeAt(t+1)],o=b[e.charCodeAt(t+2)],a=b[e.charCodeAt(t+3)],d[l++]=n<<2|r>>4,d[l++]=(15&r)<<4|o>>2,d[l++]=(3&o)<<6|63&a;return c})(e);return T(n,t)}return{base64:!0,data:e}},T=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,C=String.fromCharCode(30);function k(){return new TransformStream({transform(e,t){!function(e,t){u&&e.data instanceof Blob?e.data.arrayBuffer().then(g).then(t):h&&(e.data instanceof ArrayBuffer||p(e.data))?t(g(e.data)):m(e,!1,(e=>{y||(y=new TextEncoder),t(y.encode(e))}))}(e,(n=>{const r=n.length;let o;if(r<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,r);else if(r<65536){o=new Uint8Array(3);const e=new DataView(o.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{o=new Uint8Array(9);const e=new DataView(o.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!==typeof e.data&&(o[0]|=128),t.enqueue(o),t.enqueue(n)}))}})}let A;function I(e){return e.reduce(((e,t)=>e+t.length),0)}function E(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let o=0;o<t;o++)n[o]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function P(e){if(e)return function(e){for(var t in P.prototype)e[t]=P.prototype[t];return e}(e)}P.prototype.on=P.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},P.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},P.prototype.off=P.prototype.removeListener=P.prototype.removeAllListeners=P.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},P.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t)}return this},P.prototype.emitReserved=P.prototype.emit,P.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},P.prototype.hasListeners=function(e){return!!this.listeners(e).length};const _="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),N="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function R(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const M=N.setTimeout,j=N.clearTimeout;function D(e,t){t.useNativeTimers?(e.setTimeoutFn=M.bind(N),e.clearTimeoutFn=j.bind(N)):(e.setTimeoutFn=N.setTimeout.bind(N),e.clearTimeoutFn=N.clearTimeout.bind(N))}function O(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class B extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class L extends P{constructor(e){super(),this.writable=!1,D(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new B(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=w(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}class F extends L{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(C),r=[];for(let o=0;o<n.length;o++){const e=w(n[o],t);if(r.push(e),"error"===e.type)break}return r})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let o=0;e.forEach(((e,a)=>{m(e,!1,(e=>{r[a]=e,++o===n&&t(r.join(C))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=O()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let $=!1;try{$="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Ve){}const G=$;function z(){}class U extends F{constructor(e){if(super(e),"undefined"!==typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}class H extends P{constructor(e,t,n){super(),this.createRequest=e,D(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var e;const t=R(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(r){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{n.setRequestHeader("Accept","*/*")}catch(r){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn((()=>{this._onError("number"===typeof n.status?n.status:0)}),0))},n.send(this._data)}catch(r){return void this.setTimeoutFn((()=>{this._onError(r)}),0)}"undefined"!==typeof document&&(this._index=H.requestsCount++,H.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if("undefined"!==typeof this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=z,e)try{this._xhr.abort()}catch(t){}"undefined"!==typeof document&&delete H.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(H.requestsCount=0,H.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",q);else if("function"===typeof addEventListener){addEventListener("onpagehide"in N?"pagehide":"unload",q,!1)}function q(){for(let e in H.requests)H.requests.hasOwnProperty(e)&&H.requests[e].abort()}const V=function(){const e=W({xdomain:!1});return e&&null!==e.responseType}();function W(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||G))return new XMLHttpRequest}catch(n){}if(!t)try{return new(N[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}const Y="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class K extends L{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=Y?{}:R(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(Ve){return this.emitReserved("error",Ve)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;m(n,this.supportsBinary,(e=>{try{this.doWrite(n,e)}catch(t){}r&&_((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){"undefined"!==typeof this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=O()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const X=N.WebSocket||N.MozWebSocket;const Z={websocket:class extends K{createSocket(e,t,n){return Y?new X(e,t,n):t?new X(e,t):new X(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends L{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(Ve){return this.emitReserved("error",Ve)}this._transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((e=>{const t=function(e,t){A||(A=new TextDecoder);const n=[];let r=0,o=-1,a=!1;return new TransformStream({transform(s,i){for(n.push(s);;){if(0===r){if(I(n)<1)break;const e=E(n,1);a=128===(128&e[0]),o=127&e[0],r=o<126?3:126===o?1:2}else if(1===r){if(I(n)<2)break;const e=E(n,2);o=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(2===r){if(I(n)<8)break;const e=E(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),a=t.getUint32(0);if(a>Math.pow(2,21)-1){i.enqueue(d);break}o=a*Math.pow(2,32)+t.getUint32(4),r=3}else{if(I(n)<o)break;const e=E(n,o);i.enqueue(w(a?e:A.decode(e),t)),r=0}if(0===o||o>e){i.enqueue(d);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=k();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const o=()=>{n.read().then((e=>{let{done:t,value:n}=e;t||(this.onPacket(n),o())})).catch((e=>{}))};o();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then((()=>this.onOpen()))}))}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;this._writer.write(n).then((()=>{r&&_((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends U{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=V&&!t}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd},this.opts),new H(W,this.uri(),e)}}},J=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Q=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ee(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let o=J.exec(e||""),a={},s=14;for(;s--;)a[Q[s]]=o[s]||"";return-1!=n&&-1!=r&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,a.path),a.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}(0,a.query),a}const te="function"===typeof addEventListener&&"function"===typeof removeEventListener,ne=[];te&&addEventListener("offline",(()=>{ne.forEach((e=>e()))}),!1);class re extends P{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"===typeof e&&(t=e,e=null),e){const n=ee(e);t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=ee(t.host).host);D(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach((e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e})),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let r=0,o=n.length;r<o;r++){let e=n[r].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),te&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ne.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);const e=this.opts.rememberUpgrade&&re.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(e=>this._onClose("transport close",e)))}onOpen(){this.readyState="open",re.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(e+="string"===typeof(t=r)?function(e){let t=0,n=0;for(let r=0,o=e.length;r<o;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this._maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,_((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,r){if("function"===typeof t&&(r=t,t=void 0),"function"===typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}_onError(e){if(re.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),te&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=ne.indexOf(this._offlineEventListener);-1!==e&&ne.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}re.protocol=4;class oe extends re{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;re.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;re.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function o(){n||(n=!0,c(),t.close(),t=null)}const a=e=>{const n=new Error("probe error: "+e);n.transport=t.name,o(),this.emitReserved("upgradeError",n)};function s(){a("transport closed")}function i(){a("socket closed")}function l(e){t&&e.name!==t.name&&o()}const c=()=>{t.removeListener("open",r),t.removeListener("error",a),t.removeListener("close",s),this.off("close",i),this.off("upgrading",l)};t.once("open",r),t.once("error",a),t.once("close",s),this.once("close",i),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}class ae extends oe{constructor(e){const t="object"===typeof e?e:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(!t.transports||t.transports&&"string"===typeof t.transports[0])&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map((e=>Z[e])).filter((e=>!!e))),super(e,t)}}const se="function"===typeof ArrayBuffer,ie=Object.prototype.toString,le="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===ie.call(Blob),ce="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===ie.call(File);function de(e){return se&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||le&&e instanceof Blob||ce&&e instanceof File}function ue(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(ue(e[t]))return!0;return!1}if(de(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return ue(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&ue(e[n]))return!0;return!1}function he(e){const t=[],n=e.data,r=e;return r.data=pe(n,t),r.attachments=t.length,{packet:r,buffers:t}}function pe(e,t){if(!e)return e;if(de(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=pe(e[r],t);return n}if("object"===typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=pe(e[r],t));return n}return e}function me(e,t){return e.data=fe(e.data,t),delete e.attachments,e}function fe(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=fe(e[n],t);else if("object"===typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=fe(e[n],t));return e}const ge=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ye=5;var ve;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(ve||(ve={}));class be{constructor(e){this.replacer=e}encode(e){return e.type!==ve.EVENT&&e.type!==ve.ACK||!ue(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===ve.EVENT?ve.BINARY_EVENT:ve.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==ve.BINARY_EVENT&&e.type!==ve.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=he(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}function xe(e){return"[object Object]"===Object.prototype.toString.call(e)}class we extends P{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===ve.BINARY_EVENT;n||t.type===ve.BINARY_ACK?(t.type=n?ve.EVENT:ve.ACK,this.reconstructor=new Se(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!de(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===ve[n.type])throw new Error("unknown packet type "+n.type);if(n.type===ve.BINARY_EVENT||n.type===ve.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const o=e.substring(r,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!we.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case ve.CONNECT:return xe(t);case ve.DISCONNECT:return void 0===t;case ve.CONNECT_ERROR:return"string"===typeof t||xe(t);case ve.EVENT:case ve.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===ge.indexOf(t[0]));case ve.ACK:case ve.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Se{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=me(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Te(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Ce=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ke extends P{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Te(e,"open",this.onopen.bind(this)),Te(e,"packet",this.onpacket.bind(this)),Te(e,"error",this.onerror.bind(this)),Te(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){var t,n,r;if(Ce.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if(a.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const i={type:ve.EVENT,data:a,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"===typeof a[a.length-1]){const e=this.ids++,t=a.pop();this._registerAckCallback(e,t),i.id=e}const l=null===(n=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===n?void 0:n.writable,c=this.connected&&!(null===(r=this.io.engine)||void 0===r?void 0:r._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,t){var n,r=this;const o=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===o)return void(this.acks[e]=t);const a=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),o),s=function(){r.io.clearTimeoutFn(a);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];t.apply(r,n)};s.withError=!0,this.acks[e]=s}emitWithAck(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Promise(((t,r)=>{const o=(e,n)=>e?r(e):t(n);o.withError=!0,n.push(o),this.emit(e,...n)}))}_addToQueue(e){var t=this;let n;"function"===typeof e[e.length-1]&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(r!==t._queue[0])return;if(null!==e)r.tryCount>t._opts.retries&&(t._queue.shift(),n&&n(e));else if(t._queue.shift(),n){for(var o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];n(null,...a)}return r.pending=!1,t._drainQueue()})),this._queue.push(r),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ve.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((e=>{if(!this.sendBuffer.some((t=>String(t.id)===e))){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}}))}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ve.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ve.EVENT:case ve.BINARY_EVENT:this.onevent(e);break;case ve.ACK:case ve.BINARY_ACK:this.onack(e);break;case ve.DISCONNECT:this.ondisconnect();break;case ve.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];t.packet({type:ve.ACK,id:e,data:o})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ve.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Ae(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ae.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Ae.prototype.reset=function(){this.attempts=0},Ae.prototype.setMin=function(e){this.ms=e},Ae.prototype.setMax=function(e){this.max=e},Ae.prototype.setJitter=function(e){this.jitter=e};class Ie extends P{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"===typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,D(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Ae({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const o=t.parser||r;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ae(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Te(t,"open",(function(){n.onopen(),e&&e()})),o=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},a=Te(t,"error",o);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{r(),o(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Te(e,"ping",this.onping.bind(this)),Te(e,"data",this.ondata.bind(this)),Te(e,"error",this.onerror.bind(this)),Te(e,"close",this.onclose.bind(this)),Te(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){_((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new ke(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){if(this.nsps[n].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ee={};function Pe(e,t){"object"===typeof e&&(t=e,e=void 0);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),r=ee(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+t,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),r=n.source,o=n.id,a=n.path,s=Ee[o]&&a in Ee[o].nsps;let i;return t.forceNew||t["force new connection"]||!1===t.multiplex||s?i=new Ie(r,t):(Ee[o]||(Ee[o]=new Ie(r,t)),i=Ee[o]),n.query&&!t.query&&(t.query=n.queryKey),i.socket(n.path,t)}Object.assign(Pe,{Manager:Ie,Socket:ke,io:Pe,connect:Pe});var _e=n(4517),Ne=n(4255);console.log("\ud83d\udd0c socketManager.js loaded - VERSION 2 with join-grid fix");const Re=Pe("https://vvgame-server.onrender.com",{transports:["websocket"],autoConnect:!1});function Me(e,t,n,r,o,a){if(console.log("\ud83c\udf10 useEffect for PC join & leave running. gridId:",e,"socket:",!!Re),console.log("  \ud83c\udf10 isMasterResourcesReady = ",n),!e||!t||!n)return;const s=t=>{let{gridId:n,playerId:o,username:a,playerData:s,emitterId:l}=t;l!==Re.id?(n||(console.warn(`\u26a0\ufe0f Received player-joined event with undefined gridId for ${a}. Assuming they joined current grid.`),n=e),n===e?(console.log(`\ud83d\udc4b Player ${a} joined current grid ${e} with data:`,s),console.log("\ud83d\udea8 [SOCKET DEBUG] Received player-joined-sync data:",{playerId:o,username:a,playerDataKeys:s?Object.keys(s):"undefined",playerDataHP:null===s||void 0===s?void 0:s.hp,playerDataMaxHP:null===s||void 0===s?void 0:s.maxhp,playerDataArmorClass:null===s||void 0===s?void 0:s.armorclass,playerDataAttackBonus:null===s||void 0===s?void 0:s.attackbonus,fullPlayerData:s}),r((e=>{var t,r;const a=null===(t=e[n])||void 0===t||null===(r=t.pcs)||void 0===r?void 0:r[o],l=new Date(null===s||void 0===s?void 0:s.lastUpdated).getTime()||0,c=new Date(null===a||void 0===a?void 0:a.lastUpdated).getTime()||0;var d;return!a||l>c?(console.log(`\u23e9 Inserting or updating PC ${o} from player-joined-sync.`),i.default.updatePCLocal?i.default.updatePCLocal(n,o,s):console.warn("\ud83d\uded1 playersInGridManager.updatePCLocal is not defined."),{...e,[n]:{...e[n],pcs:{...(null===(d=e[n])||void 0===d?void 0:d.pcs)||{},[o]:s}}}):(console.log(`\u23f3 Skipping player-joined-sync for ${o}; local is newer.`),e)}))):console.log(`\ud83d\udc4b Player ${a} joined grid ${n} (not current grid ${e})`)):console.log("\ud83d\ude00 Ignoring player-joined event from self.")},l=t=>{let{gridId:n,playerId:s,username:l,emitterId:c}=t;console.log("\ud83d\udce5 [SOCKET] Received player-left-sync event:",{leftGridId:n,playerId:s,username:l,emitterId:c,currentGrid:e}),c!==Re.id?(n||(console.warn(`\u26a0\ufe0f Received player-left event with undefined gridId for ${l}. Checking if they're in current grid.`),n=e),n===e?(console.log(`\ud83d\udc4b Player ${l} left current grid ${e}`),i.default.removePC?i.default.removePC(n,s):console.warn("\ud83d\uded1 playersInGridManager.removePC is not defined."),r((e=>{var t,r;if(null===(t=e[n])||void 0===t||!t.pcs)return console.warn(`\u26a0\ufe0f No players found in grid ${n} when trying to remove ${l}`),e;if(!e[n].pcs[s])return console.warn(`\u26a0\ufe0f Player ${l} (${s}) not found in grid ${n} when trying to remove`),e;console.log(`\u2705 Removing player ${l} (${s}) from grid ${n}`);const i={...null===(r=e[n])||void 0===r?void 0:r.pcs};return delete i[s],o===l&&a&&(console.log(`\ud83c\udfae Removed player ${l} was the NPCController, clearing controller`),a(null)),{...e,[n]:{...e[n],pcs:i}}}))):console.log(`\ud83d\udc4b Player ${l} left grid ${n} (not current grid ${e})`)):console.log("\ud83d\ude00 Ignoring player-left event from self.")},c=t=>{let{gridId:n,pcs:s}=t;console.log(`\ud83d\udce6 Received current PCs for grid ${n}:`,s),Object.entries(s||{}).forEach((e=>{let[t,n]=e})),console.log(`\ud83d\udce6 Processing PC list for grid ${n} (current grid: ${e})`);const l=n;if(r((e=>({...e,[l]:{...e[l],pcs:s||{}}}))),i.default.setAllPCs&&i.default.setAllPCs(l,s||{}),o&&a){Object.values(s||{}).some((e=>e.username===o))||(console.log(`\ud83c\udfae NPCController ${o} is not in the current player list, clearing controller`),a(null))}};return console.log("\ud83e\uddf2 [NPCsInGrid join/leave] Subscribing to PC and NPC join/leave sync events for grid:",e),Re.on("player-joined-sync",s),Re.on("player-left-sync",l),Re.on("current-grid-players",c),()=>{Re.off("player-joined-sync",s),Re.off("player-left-sync",l),Re.off("current-grid-players",c)}}function je(e,t,n,r,o,s){if(console.log("\ud83c\udf10\ud83c\udf10\ud83c\udf10\ud83c\udf10\ud83c\udf10\ud83c\udf10 useEffect for PC & NPC grid-state-sync running. gridId:",t,"socket:",!!Re),!t)return;const l=t=>{const o=Object.entries(t).filter((e=>{let[t]=e;return"emitterId"!==t}));if(0===o.length)return void console.warn("\u274c No grid data found in sync-PCs payload:",t);const[l,c]=o[0],{pcs:d,playersInGridLastUpdated:u}=c||{};if(!d||"object"!==typeof d)return void console.warn("\ud83d\udce4 Invalid sync-PCs payload (missing pcs):",t);const[h,p]=Object.entries(d)[0],m=(null===n||void 0===n?void 0:n._id)||(null===n||void 0===n?void 0:n.playerId);if(n&&h===String(m))return void console.log(`\ud83d\udee1\ufe0f Blocking socket sync for own player (${h}) - should never update local player from socket`);const{emitterId:f}=t;if(f===Re.id)return void console.log("\ud83d\udce4 Skipping sync-PCs from self (emitterId = socket.id)");const g=new Date(null===p||void 0===p?void 0:p.lastUpdated).getTime();r((t=>{var n,r,o,c,d;const m=null===(n=t[l])||void 0===n||null===(r=n.pcs)||void 0===r?void 0:r[h],f=new Date(null===m||void 0===m?void 0:m.lastUpdated).getTime()||0,y=Object.keys(p).filter((e=>"lastUpdated"!==e&&JSON.stringify(p[e])!==JSON.stringify(null===m||void 0===m?void 0:m[e])));if(y.length>0&&(console.log(`\ud83d\udd04 PC ${h} changed fields: ${y.join(", ")}`),y.includes("hp")&&null!==m&&void 0!==m&&m.hp&&(null===p||void 0===p?void 0:p.hp)<m.hp)){const t=m.hp-p.hp;a.A.addFloatingText(`- ${t} \u2764\ufe0f\u200d\ud83e\ude79 HP`,p.position.x,p.position.y,e)}if(g<=f)return console.log(`\u23f3 Skipping stale update for PC ${h}.`),t;if(null===(o=t[l])||void 0===o||null===(c=o.pcs)||void 0===c||!c[h])return console.log(`\u26a0\ufe0f Skipping update for PC ${h} - no longer in local grid ${l}`),t;console.log(`\u23e9 Updating PC ${h} from socket event.`),s&&s((e=>e.has(h)?e:(console.log(`\ud83d\udce1 Marking player ${h} as connected (received state update)`),new Set(e).add(h))));const v={...t,[l]:{...t[l],pcs:{...t[l].pcs,[h]:{...t[l].pcs[h],...p}}}};try{i.default.updatePC(l,h,p)}catch(w){console.warn(`\u26a0\ufe0f Memory manager update failed for PC ${h}:`,w.message)}const b=null===m||void 0===m?void 0:m.position,x=null===p||void 0===p?void 0:p.position;return b&&x&&(b.x!==x.x||b.y!==x.y)&&(0,_e.d)(h,b,x,e),v[l].playersInGridLastUpdated=u||(null===(d=t[l])||void 0===d?void 0:d.playersInGridLastUpdated),v}))};return console.log("\ud83e\uddf2 Subscribing to PC sync events for grid:",t),Re.on("sync-PCs",l),()=>{console.log("\ud83e\uddf9 Unsubscribing from PC sync events for grid:",t),Re.off("sync-PCs",l)}}function De(e,t,n,r){if(!t)return;const i=t=>{const{emitterId:i}=t;if(i===Re.id)return void console.log("\ud83d\udce4 Skipping sync-NPCs from self (emitterId = socket.id)");const l=Object.entries(t).filter((e=>{let[t]=e;return"emitterId"!==t}));if(0===l.length)return void console.warn("\u274c No grid data found in sync-NPCs payload:",t);const[c,d]=l[0],{npcs:u,NPCsInGridLastUpdated:h}=d||{};if(!u||"object"!==typeof u)return void console.warn("\ud83d\udce4 Invalid sync-NPCs payload (missing npcs):",t);const p=r.isControllingGrid(c);console.log("IsNPCController:",p),n((t=>{var n;const r={...t.npcs},i=null===(n=s.Ay.NPCsInGrid)||void 0===n?void 0:n[c];return Object.entries(u).forEach((t=>{let[n,s]=t;if(!s)return delete r[n],void(null!==i&&void 0!==i&&i.npcs?delete i.npcs[n]:console.warn(`\u26a0\ufe0f liveGrid.npcs missing for gridId ${c}`));const l=r[n];if(new Date(s.lastUpdated).getTime()>(null!==l&&void 0!==l&&l.lastUpdated?new Date(l.lastUpdated).getTime():0)){const t=Object.keys(s).filter((e=>"lastUpdated"!==e&&JSON.stringify(s[e])!==JSON.stringify(null===l||void 0===l?void 0:l[e])));if(t.length>0&&(console.log(`\ud83d\udd04 NPC ${n} changed fields: ${t.join(", ")}`),t.includes("hp")&&null!==l&&void 0!==l&&l.hp&&(null===s||void 0===s?void 0:s.hp)<l.hp)){const t=l.hp-s.hp;a.A.addFloatingText(`- ${t} \u2764\ufe0f\u200d\ud83e\ude79 HP`,s.position.x,s.position.y,e)}const d=new o.A(s.id,s.type,s.position,s,s.gridId||c);r[n]=d,null!==i&&void 0!==i&&i.npcs?i.npcs[n]=d:console.warn(`\u26a0\ufe0f liveGrid.npcs missing for gridId ${c}`)}else console.log(`  \u23f3 Skipped NPC ${n}, newer or same version already present.`)})),{...t,npcs:r}}))},l=r=>{let{npcId:a,newPosition:i,emitterId:l}=r;a&&i&&(l&&l===Re.id?console.log(`\ud83d\udce4 Skipping NPC animation for own broadcast (NPC ${a})`):n((n=>{const r={...n.npcs},l=r[a];if(l){const n=null===l||void 0===l?void 0:l.position,c=l instanceof o.A?l:new o.A(l.id,l.type,l.position,l,l.gridId||t);n&&i&&(n.x!==i.x||n.y!==i.y)&&(console.log("Calling animateRemotePC for NPC",a,n,i),(0,_e.d)(a,n,i,e,30)),c.position=i,r[a]=c,c instanceof o.A?s.Ay.NPCsInGrid[t].npcs[a]=c:console.warn(`\ud83d\uded1 Tried to inject non-NPC instance into live NPCsInGrid for ${a}`)}return{...n,npcs:r}})))},c=e=>{let{gridId:t,npcId:r}=e;n((e=>{var n;const o={...e.npcs};delete o[r];const a=null===(n=s.Ay.NPCsInGrid)||void 0===n?void 0:n[t];return null!==a&&void 0!==a&&a.npcs&&(delete a.npcs[r],console.log(`\ud83e\udde0 Removed NPC ${r} from live NPCsInGrid (remove-NPC event)`)),{...e,npcs:o}}))};return Re.on("sync-NPCs",i),Re.on("npc-moved-sync",l),Re.on("remove-NPC",c),()=>{Re.off("sync-NPCs",i),Re.off("npc-moved-sync",l),Re.off("remove-NPC",c)}}function Oe(e,t,n,r,o,a){if(!t||!Re||!n)return void console.warn("Master Resources not ready or missing gridId/socket.");const s=t=>{let{updatedResources:n}=t;null!==n&&void 0!==n&&n.length&&r((t=>{if(null===o||void 0===o||!o.length)return console.warn("\u23f3 Skipping resource enrichment; masterResources not yet ready"),t;const r=[...t];n.forEach((t=>{if(!t||"number"!==typeof t.x||"number"!==typeof t.y)return void console.warn("\u26a0\ufe0f Skipping invalid socket resource:",t);if(null===t.type){const n=r.findIndex((e=>e.x===t.x&&e.y===t.y));return(0,Ne.MV)(t.x,t.y,e),void(-1!==n&&r.splice(n,1))}o.find((e=>e.type===t.type))||console.warn(`\u26a0\ufe0f No matching resource template found for ${t.type}`);const n=a(t,o),s=r.filter((e=>!(e.x===t.x&&e.y===t.y)));s.push(n),r.splice(0,r.length,...s)}));const s=[...r];return r.forEach((e=>{if(e.size&&e.size>1){const t=e.anchorKey||`${e.type}-${e.x}-${e.y}`;for(let n=0;n<e.size;n++)for(let r=0;r<e.size;r++){if(0===n&&0===r)continue;const o={type:"shadow",x:e.x+n,y:e.y-r,parentAnchorKey:t,passable:e.passable};s.push(o)}}})),s}))};return console.log("\ud83e\uddf2 [resources] Subscribing to real-time updates for grid:",t),Re.on("resource-sync",s),()=>{Re.off("resource-sync",s)}}function Be(e,t,n){if(!e||!Re)return void console.warn("Missing gridId or socket.");const r=e=>{let{updatedTiles:r}=e;r.forEach((e=>{})),null!==r&&void 0!==r&&r.length&&t((e=>n(e,r)))};return console.log("\ud83e\uddf2 [tiles] Subscribing to real-time tile updates for grid:",e),Re.on("tile-sync",r),()=>{console.log("\ud83e\uddf9 Unsubscribing from tile-sync for grid:",e),Re.off("tile-sync",r)}}function Le(e,t,n){if(console.log("\ud83c\udf10 useEffect for npc-controller running. gridId:",e,"socket:",!!Re),Re&&t)return e&&Re.emit("set-username",{username:t.username}),Re.on("npc-controller-update",(e=>{let{controllerUsername:t}=e;n(t)})),Re.on("npc-controller-assigned",(e=>{let{gridId:t}=e;console.log(`\ud83c\udfae Assigned as NPC controller for grid ${t}`)})),Re.on("npc-controller-revoked",(e=>{let{gridId:t}=e;console.log(`\ud83c\udfae Revoked as NPC controller for grid ${t}`)})),()=>{Re.off("npc-controller-update"),Re.off("npc-controller-assigned"),Re.off("npc-controller-revoked")}}function Fe(){if(Re)return Re.on("force-refresh",(e=>{let{reason:t}=e;console.warn(`\ud83d\udd01 Server requested refresh: ${t}`),window.location.reload()})),()=>{Re.off("force-refresh")}}function $e(e,t,n){const r=()=>{console.log("\ud83d\udce1 Socket connected/reconnected!"),n(!0),e&&null!==t&&void 0!==t&&t._id&&(console.log(`\ud83d\udce1 Re-joining grid room: ${e}`),Re.emit("join-grid",{gridId:e,playerId:t._id}),Re.emit("join-player-room",{playerId:t._id}),null!==t&&void 0!==t&&t.username&&Re.emit("set-username",{username:t.username})),Re.emit("player-connected",{playerId:t._id,gridId:e})},o=()=>{console.warn("\ud83d\udcf4 Socket disconnected."),n(!1),Re.emit("player-disconnected",{playerId:t._id,gridId:e})};return Re.on("connect",r),Re.on("disconnect",o),()=>{Re.off("connect",r),Re.off("disconnect",o)}}function Ge(e,t){if(!Re||!e)return;console.log("\ud83c\udf10 useEffect for player-connected/disconnected running. gridId:",e),console.log("\ud83d\udd04 Requesting connected players list on startup."),Re.emit("request-connected-players",{gridId:e});const n=e=>{let{playerId:n}=e;console.log(`\ud83d\udce1 Player connected: ${n}`),t((e=>new Set(e).add(n)))},r=e=>{let{playerId:n}=e;console.log(`\ud83d\udcf4 Player disconnected: ${n}`),t((e=>{const t=new Set(e);return t.delete(n),t}))},o=e=>{let{connectedPlayerIds:n}=e;console.log("\ud83d\udce6 Received full list of currently connected players:",n),t(new Set(n))};return Re.on("player-connected",n),Re.on("player-disconnected",r),Re.on("connected-players",o),()=>{Re.off("player-connected",n),Re.off("player-disconnected",r),Re.off("connected-players",o)}}function ze(e){if(!Re)return;const t=t=>{console.log("\ud83d\udcac Incoming chat message:",t);const{scope:n,scopeId:r}=t;e((e=>{const n=e[r]||[];return{...e,[r]:[...n,t]}}));Re.emit("chat-badge-update",{playerId:null,username:null,hasUpdate:!0})};return Re.on("receive-chat-message",t),()=>{Re.off("receive-chat-message",t)}}function Ue(e){let{playerId:t,username:n,message:r,scope:o,scopeId:a}=e;Re&&Re.emit("send-chat-message",{playerId:t,username:n,message:r,scope:o,scopeId:a,emitterId:Re.id})}function He(e,t,n){if(console.log("\ud83d\udce1 socketListenForBadgeUpdates called with player:",null===e||void 0===e?void 0:e.username),!Re||!e)return;const r=r=>{let{type:o,playerId:a,username:s,hasUpdate:i}=r;console.log("\ud83e\uddea handleBadge invoked with:",{type:o,playerId:a,username:s,hasUpdate:i}),console.log("\ud83d\udd14 SOCKET LISTENER: Received badge update:",{type:o,playerId:a,username:s,hasUpdate:i}),console.log("\ud83d\udcdb Comparing currentPlayer._id:",e._id,"to incoming:",a);const l="chat"===o||(a&&String(e._id)===String(a)||s&&e.username===s);console.log("\ud83d\udd14 isMatch:",l,"for currentPlayer:",e.username),l&&(console.log(`\ud83d\udcdb Badge update received for ${o}.`),n(e,t,o,i))};return Re.on("mailbox-badge-update",(e=>r({...e,type:"mailbox"}))),Re.on("store-badge-update",(e=>r({...e,type:"store"}))),Re.on("chat-badge-update",(e=>r({...e,type:"chat"}))),()=>{Re.off("mailbox-badge-update"),Re.off("store-badge-update"),Re.off("chat-badge-update")}}const qe=Re},8712:(e,t,n)=>{"use strict";var r=n(8206),o=n(4902),a=function(e,t,n){for(var r,o=e;null!=(r=o.next);o=r)if(r.key===t)return o.next=r.next,n||(r.next=e.next,e.next=r),r};e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new o("Side channel does not contain "+r(e))},delete:function(t){var n=e&&e.next,r=function(e,t){if(e)return a(e,t,!0)}(e,t);return r&&n&&n===r&&(e=void 0),!!r},get:function(t){return function(e,t){if(e){var n=a(e,t);return n&&n.value}}(e,t)},has:function(t){return function(e,t){return!!e&&!!a(e,t)}(e,t)},set:function(t,n){e||(e={next:void 0}),function(e,t,n){var r=a(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(e,t,n)}};return t}},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},9106:(e,t,n)=>{"use strict";n.d(t,{Eu:()=>g,V5:()=>v,ZH:()=>l,di:()=>b,zQ:()=>y});var r=n(1431),o=n(2667),a=n(5823),s=n(6894),i=n(6704);const l={},c=new Set,d=["Shift","Control","Alt","Meta","CapsLock","NumLock","ScrollLock"];let u=0,h=null,p=null;const m=20,f=60;function g(e,t,l,g,y,b,x,w,S,T,C,k,A){let I=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,E=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;if(d.includes(e.key))return;const P=e.code&&e.code.startsWith("Numpad")?e.code:e.key;c.add(P);Date.now()-u<f||(p={currentPlayer:t,TILE_SIZE:l,masterResources:g,setCurrentPlayer:y,setGridId:b,setGrid:x,setTileTypes:w,setResources:S,updateStatus:T,closeAllPanels:C,localPlayerMoveTimestampRef:k,bulkOperationContext:A,strings:I,transitionFadeControl:E},h||(h=setTimeout((()=>{h=null,u=Date.now();const e=p;e&&async function(e,t,l,d,u,h,p,m,f,g,y,b){let x=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,w=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null;const S={ArrowUp:{dx:0,dy:-1},ArrowDown:{dx:0,dy:1},ArrowLeft:{dx:-1,dy:0},ArrowRight:{dx:1,dy:0},w:{dx:0,dy:-1},W:{dx:0,dy:-1},s:{dx:0,dy:1},S:{dx:0,dy:1},a:{dx:-1,dy:0},A:{dx:-1,dy:0},d:{dx:1,dy:0},D:{dx:1,dy:0},Numpad8:{dx:0,dy:-1},Numpad2:{dx:0,dy:1},Numpad4:{dx:-1,dy:0},Numpad6:{dx:1,dy:0},Numpad7:{dx:-1,dy:-1},Numpad9:{dx:1,dy:-1},Numpad1:{dx:-1,dy:1},Numpad3:{dx:1,dy:1}};let T=0,C=0;for(const n of c){const e=S[n];e&&(T+=e.dx,C+=e.dy)}if(0===T&&0===C)return;if(T=Math.max(-1,Math.min(1,T)),C=Math.max(-1,Math.min(1,C)),e.iscamping)return void s.A.addFloatingText(32,e.location.x,e.location.y,t);const k=e._id.toString(),A=e.location.g,I=r.default.getPlayersInGrid(A);if(!I||!I[k])return;const E=I[k].position,P=Math.round(E.x+T),_=Math.round(E.y+C);if(!Array.isArray(l))return void console.error("masterResources is not an array:",l);if(!await async function(e,t,r,s,l,c,d,u,h,p,m,f,g){let y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,v=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const b=a.default.getTiles(),x=a.default.getResources();if(!Array.isArray(x))return console.warn("\u26d4 Movement blocked: resources is not an array yet.",x),!1;if(e<0||t<0||e>63||t>63){const n=e<0?"Signpost W":e>63?"Signpost E":t<0?"Signpost N":t>63?"Signpost S":null;if(!n)return console.warn(`\u26d4 Invalid movement direction from (${e}, ${t}).`),!1;console.log(`\ud83d\udce6 Attempting directional travel via: ${n}`),null!==v&&void 0!==v&&v.startTransition&&(console.log("\ud83c\udf11 [IMMEDIATE FADE] Starting fade transition for boundary crossing"),v.startTransition());const r=s.skills;return(0,i.handleTransitSignpost)(s,n,l,c,d,u,h,p,m,r,f,g,null,y,null,v),!1}const w=await async function(e,t,r,a,s){var i;let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;if(e=Math.floor(e),t=Math.floor(t),e<0||t<0||t>=r.length||e>=r[0].length)return console.warn(`\u26d4 Tile (${e}, ${t}) is out of bounds.`),!1;const h=r[t][e];if(!h)return console.warn(`\u26d4 Invalid tile at (${e}, ${t}) - No tileType found.`),!1;if(null!==l&&void 0!==l&&l.isinboat)return"w"===h?(console.log(`\ud83d\udea4 Boat player can move to water tile (${e}, ${t})`),!0):(console.warn(`\u26d4 Boat player cannot move to non-water tile (${e}, ${t}): ${h}`),!1);const p=s.find((e=>e.type===h));if(!p||!p.passable)return console.warn(`\u26d4 Tile (${e}, ${t}) is not passable according to masterResources.`),!1;const m=a.find((n=>n.x===e&&n.y===t));if(m&&!1===m.passable){if("door"===m.action){const{canPassThroughDoor:r}=await n.e(803).then(n.bind(n,1803));return!!r(m,l,c,d,u)&&(console.log(`\u2705 Player has access - allowing passage through door at (${e}, ${t})`),!0)}return console.warn(`\u26d4 Tile (${e}, ${t}) contains an impassable resource (${m.type}).`),!1}if(null!==l&&void 0!==l&&null!==(i=l.location)&&void 0!==i&&i.g){const n=o.Ay.getNPCsInGrid(l.location.g);if(n){const r=Object.values(n).find((n=>{var r,o;return Math.floor(null===(r=n.position)||void 0===r?void 0:r.x)===e&&Math.floor(null===(o=n.position)||void 0===o?void 0:o.y)===t}));if(r&&!1===r.passable)return console.warn(`\u26d4 Tile (${e}, ${t}) contains an impassable NPC (${r.type}).`),!1}}return!0}(e,t,b,x,r,s,p,y,m);w||console.warn(`\u26d4 Movement blocked: Tile (${e}, ${t}) is not passable.`);return w}(P,_,l,e,d,u,h,p,m,f,t,g,b,x,w))return void console.warn(`\u26d4 Player blocked from moving to (${P}, ${_}).`);const N={x:P,y:_},R=Date.now();y&&(y.current=R);r.default.updatePC(A,k,{position:N,lastUpdated:R}),v(N,t)}(e.currentPlayer,e.TILE_SIZE,e.masterResources,e.setCurrentPlayer,e.setGridId,e.setGrid,e.setTileTypes,e.setResources,e.updateStatus,e.closeAllPanels,e.localPlayerMoveTimestampRef,e.bulkOperationContext,e.strings,e.transitionFadeControl).catch((e=>{console.error("Error processing movement:",e)}))}),m)))}function y(e){const t=e.code&&e.code.startsWith("Numpad")?e.code:e.key;c.delete(t),d.includes(e.key)&&c.clear()}function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=document.querySelector(".homestead");if(!r)return console.log(`\ud83d\udcf7 [CAMERA] No container found, retrying... (attempt ${n+1})`),void(n<5&&requestAnimationFrame((()=>v(e,t,n+1))));if(!e||"number"!==typeof e.x||"number"!==typeof e.y)return void console.warn("\u26a0\ufe0f [CAMERA] Cannot center camera - invalid position:",e);const o=r.clientWidth,a=r.clientHeight,s=e.x*t-o/2+t/2,i=e.y*t-a/2+t/2,l=r.scrollWidth-r.clientWidth,c=r.scrollHeight-r.clientHeight;if(l<=0&&c<=0&&s>0&&n<10)return console.log(`\ud83d\udcf7 [CAMERA] Container not ready, retrying... (attempt ${n+1})`),void requestAnimationFrame((()=>v(e,t,n+1)));const d=Math.max(0,Math.min(s,l)),u=Math.max(0,Math.min(i,c));r.scrollTo({left:d,top:u,behavior:"smooth"})}function b(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=document.querySelector(".homestead");if(!r)return console.log(`\ud83d\udcf7 [CAMERA FAST] No container found, retrying... (attempt ${n+1})`),void(n<5&&requestAnimationFrame((()=>b(e,t,n+1))));if(!e||"number"!==typeof e.x||"number"!==typeof e.y)return void console.warn("\u26a0\ufe0f [CAMERA FAST] Cannot center camera - invalid position:",e);const o=r.clientWidth,a=r.clientHeight,s=e.x*t-o/2+t/2,i=e.y*t-a/2+t/2,l=r.scrollWidth-r.clientWidth,c=r.scrollHeight-r.clientHeight;if(console.log("\ud83d\udcf7 [CAMERA FAST DEBUG] ========== ZOOM CAMERA CENTER =========="),console.log(`\ud83d\udcf7 [CAMERA FAST DEBUG] Input: position=(${e.x}, ${e.y}), TILE_SIZE=${t}, retry=${n}`),console.log(`\ud83d\udcf7 [CAMERA FAST DEBUG] Viewport: width=${o}, height=${a}`),console.log(`\ud83d\udcf7 [CAMERA FAST DEBUG] Target player pixel: x=${e.x*t}, y=${e.y*t}`),console.log(`\ud83d\udcf7 [CAMERA FAST DEBUG] Calculated scroll: centerX=${s}, centerY=${i}`),console.log(`\ud83d\udcf7 [CAMERA FAST DEBUG] Container: scrollWidth=${r.scrollWidth}, scrollHeight=${r.scrollHeight}`),console.log(`\ud83d\udcf7 [CAMERA FAST DEBUG] Max scroll: maxScrollLeft=${l}, maxScrollTop=${c}`),l<=0&&c<=0&&s>0&&n<10)return console.log(`\ud83d\udcf7 [CAMERA FAST] Container not ready (maxScroll=0), retrying... (attempt ${n+1})`),void requestAnimationFrame((()=>b(e,t,n+1)));const d=Math.max(0,Math.min(s,l)),u=Math.max(0,Math.min(i,c));console.log(`\ud83d\udcf7 [CAMERA FAST DEBUG] Final clamped scroll: clampedX=${d}, clampedY=${u}`),console.log("\ud83d\udcf7 [CAMERA FAST DEBUG] ========================================="),r.scrollTo({left:d,top:u})}"undefined"!==typeof window&&(window.addEventListener("blur",(()=>{c.clear(),h&&(clearTimeout(h),h=null)})),document.addEventListener("visibilitychange",(()=>{document.hidden&&(c.clear(),h&&(clearTimeout(h),h=null))})),window.debugMovementKeys=()=>(console.log("Currently pressed keys:",Array.from(c)),Array.from(c)),window.resetMovementKeys=()=>{c.clear(),h&&(clearTimeout(h),h=null),console.log("Movement keys reset")})},9108:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,r="RFC1738",o="RFC3986";e.exports={default:o,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:r,RFC3986:o}},9269:(e,t,n)=>{"use strict";var r=n(4902),o=n(8206),a=n(8712),s=n(7858),i=n(5322)||s||a;e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new r("Side channel does not contain "+o(e))},delete:function(t){return!!e&&e.delete(t)},get:function(t){return e&&e.get(t)},has:function(t){return!!e&&e.has(t)},set:function(t,n){e||(e=i()),e.set(t,n)}};return t}},9304:e=>{"use strict";e.exports=Error},9534:e=>{"use strict";e.exports=function(){if("function"!==typeof Symbol||"function"!==typeof Object.getOwnPropertySymbols)return!1;if("symbol"===typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"===typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(var r in e[t]=42,e)return!1;if("function"===typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"===typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var o=Object.getOwnPropertySymbols(e);if(1!==o.length||o[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"===typeof Object.getOwnPropertyDescriptor){var a=Object.getOwnPropertyDescriptor(e,t);if(42!==a.value||!0!==a.enumerable)return!1}return!0}},9804:(e,t,n)=>{"use strict";function r(e){if("number"!==typeof e||e<0)return-1;const t=e%1e4,n=Math.floor(t/1e3)%10,r=Math.floor(t/100)%10,o=Math.floor(t/10)%10,a=t%10;if(n>7||r>7||o>7||a>7)return-1;return 64*(8*n+r)+(8*o+a)}function o(e){if(e<0||e>4095)return-1;const t=Math.floor(e/64),n=e%64;return 1e3*Math.floor(t/8)+100*(t%8)+10*Math.floor(n/8)+n%8}function a(e){if(!e)return new Uint8Array(512);if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);if("Buffer"===e.type&&Array.isArray(e.data))return new Uint8Array(e.data);if("string"===typeof e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}return new Uint8Array(512)}function s(e,t){if(!e)return!1;const n=r(t);if(n<0)return!1;const o=a(e),s=Math.floor(n/8),i=n%8;return!(s>=o.length)&&0!==(o[s]&1<<i)}function i(e){if(!e)return[];const t=a(e),n=[];for(let r=0;r<t.length&&r<512;r++){const e=t[r];if(0!==e)for(let t=0;t<8;t++)if(e&1<<t){const e=8*r+t;if(e<=4095){const t=o(e);t>=0&&n.push(t)}}}return n}n.d(t,{BE:()=>i,isGridVisited:()=>s})},9820:e=>{"use strict";e.exports=EvalError},9957:(e,t,n)=>{"use strict";n.d(t,{F:()=>a});n(3488);var r=n(1593),o=n(5823);const a=async(e,t,n,a,s,i,l,c)=>{try{if(!t)return void console.error("\ud83d\udea8 [CRITICAL] GridId is missing. Cannot initialize grid.");console.log("\ud83d\udd04 Initializing grid for gridId:",t);const e=await(0,r.FD)(t,i,l),{tiles:d,resources:u}=e;console.log("\ud83d\udd0d [DEBUG] fetchGridData result:",{gridDataKeys:Object.keys(e||{}),tilesLength:(null===d||void 0===d?void 0:d.length)||0,resourcesLength:(null===u||void 0===u?void 0:u.length)||0,tilesType:typeof d,resourcesType:typeof u,firstTile:null===d||void 0===d?void 0:d[0],firstResource:null===u||void 0===u?void 0:u[0]});const h=[],p=u||[];for(const t of p){let e=t;if(c&&c.length>0){const n=c.find((e=>e.type===t.type));n&&(e={...n,...t})}if(h.push(e),e.size&&e.size>1){const t=e.anchorKey||`${e.type}-${e.x}-${e.y}`;for(let n=0;n<e.size;n++)for(let r=0;r<e.size;r++){if(0===n&&0===r)continue;const o=e.x+n,a={type:"shadow",x:o,y:e.y-r,parentAnchorKey:t,passable:e.passable};h.push(a)}}}console.log("\ud83d\udd27 [DEBUG] Setting state:",{tilesLength:(d||[]).length,processedResourcesLength:h.length,aboutToSetGrid:!0,aboutToSetResources:!0,aboutToSetTileTypes:!0}),n(d||[]),a(h),s(d||[]),o.default.setTiles(d||[]),o.default.setResources(h),console.log("\u2705 Grid, tiles, and resources initialized for gridId:",t),console.log("\ud83d\udd0d [DEBUG] Final verification in AppInit:",{globalTilesLength:o.default.getTiles().length,globalResourcesLength:o.default.getResources().length})}catch(d){console.error("Error initializing grid:",d)}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=e,n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+"."+{95:"55ffbb04",453:"9da13e97",803:"b10beecf"}[e]+".chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="game-client:";n.l=(r,o,a,s)=>{if(e[r])e[r].push(o);else{var i,l;if(void 0!==a)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+a){i=u;break}}i||(l=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,n.nc&&i.setAttribute("nonce",n.nc),i.setAttribute("data-webpack",t+a),i.src=r),e[r]=[o];var h=(t,n)=>{i.onerror=i.onload=null,clearTimeout(p);var o=e[r];if(delete e[r],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(n))),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),l&&document.head.appendChild(i)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/",(()=>{var e={792:0};n.f.j=(t,r)=>{var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else{var a=new Promise(((n,r)=>o=e[t]=[n,r]));r.push(o[2]=a);var s=n.p+n.u(t),i=new Error;n.l(s,(r=>{if(n.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",i.name="ChunkLoadError",i.type=a,i.request=s,o[1](i)}}),"chunk-"+t,t)}};var t=(t,r)=>{var o,a,s=r[0],i=r[1],l=r[2],c=0;if(s.some((t=>0!==e[t]))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(l)l(n)}for(t&&t(r);c<s.length;c++)a=s[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkgame_client=self.webpackChunkgame_client||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{BaseTextureCache:()=>jt,BoundingBox:()=>Nt,CanvasRenderTarget:()=>Bt,DATA_URI:()=>vt,EventEmitter:()=>ve,ProgramCache:()=>Rt,TextureCache:()=>Mt,clearTextureCache:()=>Ot,correctBlendMode:()=>mt,createIndicesForQuads:()=>bt,decomposeDataUri:()=>zt,deprecation:()=>Se,destroyTextureCache:()=>Dt,detectVideoAlphaMode:()=>Pe,determineCrossOrigin:()=>Ut,earcut:()=>be,getBufferType:()=>xt,getCanvasBoundingBox:()=>$t,getResolutionOfUrl:()=>Ht,hex2rgb:()=>ct,hex2string:()=>dt,interleaveTypedArrays:()=>St,isMobile:()=>ye,isPow2:()=>Ct,isWebGLSupported:()=>Re,log2:()=>kt,nextPow2:()=>Tt,path:()=>Ae,premultiplyBlendMode:()=>pt,premultiplyRgba:()=>ft,premultiplyTint:()=>gt,premultiplyTintToRgba:()=>yt,removeItems:()=>At,rgb2hex:()=>ht,sayHello:()=>Ne,sign:()=>It,skipHello:()=>_e,string2hex:()=>ut,trimCanvas:()=>Gt,uid:()=>Pt,url:()=>Te});var t=n(5043),r=n(7037),o=n(4391),a=n(6213),s=n(3488),i=n(8665);const l=async e=>{console.log(`\ud83d\udd0d [DEV CHECK] Checking developer status for username: "${e}"`),console.log(`\ud83d\udd0d [DEV CHECK] API_BASE: ${s.A}`);try{var t;const n=`${s.A}/api/check-developer-status/${e}`;console.log(`\ud83d\udd0d [DEV CHECK] Full URL: ${n}`);const r=await a.A.get(n);console.log("\ud83d\udd0d [DEV CHECK] Response:",r.data);const o=!(null===(t=r.data)||void 0===t||!t.isDeveloper);return console.log(`\ud83d\udd0d [DEV CHECK] Result: ${o}`),o}catch(n){return console.warn("\u26a0\ufe0f Failed to check developer status:",n),!1}};function c(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=`badges_${e.username}`,a={...JSON.parse(localStorage.getItem(o))||{},[n]:r};localStorage.setItem(o,JSON.stringify(a)),t(a)}var d=n(579);const u=e=>{let{currentGridId:n,currentSettlementId:r,currentFrontierId:o,currentPlayer:a,onClose:l}=e;const[u,h]=(0,t.useState)([]),[p,m]=(0,t.useState)(""),f=(0,t.useRef)(null),g=(null===a||void 0===a?void 0:a._id)||"unknown";(0,t.useEffect)((()=>{var e;(console.log("\ud83d\udfe8 Chat component mounted with frontierId:",o),i.Ay&&i.Ay.connected&&o?(console.log("\ud83d\udce1 Joining frontier chat room from Chat.js"),i.Ay.emit("join-chat-rooms",{gridId:null,settlementId:null,frontierId:o})):console.warn("\u26a0\ufe0f Socket not connected or no frontierId when Chat mounted."),a)&&c(a,(()=>{}),"chat",null===(e=!1)||e)}),[o]),(0,t.useEffect)((()=>{if(i.Ay)return i.Ay.on("receive-chat-message",(e=>{"frontier"===e.scope&&(!e.username&&null!==a&&void 0!==a&&a.username&&(e.username=a.username),console.log("\ud83d\udce8 Received chat message via socket:",e),h((t=>[...t,e])))})),()=>{i.Ay.off("receive-chat-message")}}),[i.Ay]),(0,t.useEffect)((()=>{(async()=>{if(o)try{const e=await fetch(`${s.A}/api/chat/frontier/${o}`),t=await e.json();h(t)}catch(e){console.error("Failed to fetch chat history:",e)}})()}),[o]),(0,t.useEffect)((()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[u]);const y=e=>{e.preventDefault();const t=p.trim();t&&o&&(console.log("\ud83d\udce8 Sending chat message:",t),(0,i.pV)({playerId:g,username:(null===a||void 0===a?void 0:a.username)||"unknown",message:t,scope:"frontier",scopeId:o}),m(""))};return(0,d.jsxs)("div",{className:"chat-container",children:[(0,d.jsxs)("div",{className:"chat-panel-header",children:[(0,d.jsx)("h3",{children:"\ud83d\udcac Chat"}),(0,d.jsx)("button",{className:"chat-close-button",onClick:l,children:"\u2716"})]}),(0,d.jsxs)("div",{className:"chat-panel",children:[(0,d.jsxs)("div",{className:"chat-messages",children:[u.map(((e,t)=>(0,d.jsxs)("div",{className:"chat-message",children:[(0,d.jsx)("strong",{children:e.username||"???"}),": ",e.message||"[empty]"]},e.id||t))),(0,d.jsx)("div",{ref:f})]}),(0,d.jsxs)("div",{className:"chat-input",children:[(0,d.jsx)("input",{type:"text",value:p,onChange:e=>m(e.target.value),onKeyDown:e=>{console.log("\ud83d\udce8 Key pressed:",e.key),"Enter"===e.key&&(e.preventDefault(),y(e))},placeholder:"Message everyone..."}),(0,d.jsx)("button",{type:"button",onClick:y,children:"Send"})]})]})]})};var h=n(4876),p=n(9957),m=n(8146);const f={g:"#82bb4dff",s:"#97968bff",d:"#c98f59ff",w:"#58a0d8ff",p:"#f5bf89ff",l:"#c4583d",n:"#e0ca24ff",o:"#ffffff",x:"#acaa89ff",y:"#000000ff",z:"#3f7449ff",c:"#6c3b3bff",v:"#44551dff",u:"#1b712cff"};const g={0:"g",1:"s",2:"d",3:"w",4:"p",5:"l",6:"n",7:"o",8:"x",9:"y",10:"z",11:"c",12:"v",13:"u"},y=(Object.fromEntries(Object.entries(g).map((e=>{let[t,n]=e;return[n,parseInt(t)]}))),["w","l","s","d","g","p","n","o","x","y","z","c","v","u"]),v="#ff0000";function b(e){return f[e]||v}const x={g:!0,s:!0,w:!0,l:!0,n:!0,o:!0,d:!1,p:!0,x:!0,y:!1,z:!1,c:!1,v:!1,u:!1};function w(e,t,n,r,o){const a=Math.max(1,.08*o+.01*r%(.04*o)),s=.15+.01*r%.1;e.save(),e.translate(t,n),e.rotate(.5*r%60-30),e.fillStyle=`rgba(0, 50, 0, ${s})`,e.beginPath();[[.3,1],[0,.8],[.1,.6],[0,.4],[.15,.2],[.4,.3],[.6,.1],[.8,.3],[1,.5],[.85,.8],[.7,1]].forEach(((t,n)=>{let[r,o]=t;const s=r*a-a/2,i=o*a-a/2;0===n?e.moveTo(s,i):e.lineTo(s,i)})),e.closePath(),e.fill(),e.restore()}function S(e,t,n,r,o){var a,s,i,l,c,d,u,h,p,m,f,g;let v=[];switch(t){case"topLeft":v=[(null===(a=o[n-1])||void 0===a?void 0:a[r])||"d",(null===(s=o[n])||void 0===s?void 0:s[r-1])||"d",(null===(i=o[n-1])||void 0===i?void 0:i[r-1])||"d"];break;case"topRight":v=[(null===(l=o[n-1])||void 0===l?void 0:l[r])||"d",(null===(c=o[n])||void 0===c?void 0:c[r+1])||"d",(null===(d=o[n-1])||void 0===d?void 0:d[r+1])||"d"];break;case"bottomRight":v=[(null===(u=o[n+1])||void 0===u?void 0:u[r])||"d",(null===(h=o[n])||void 0===h?void 0:h[r+1])||"d",(null===(p=o[n+1])||void 0===p?void 0:p[r+1])||"d"];break;case"bottomLeft":v=[(null===(m=o[n+1])||void 0===m?void 0:m[r])||"d",(null===(f=o[n])||void 0===f?void 0:f[r-1])||"d",(null===(g=o[n+1])||void 0===g?void 0:g[r-1])||"d"]}if(v=v.filter((t=>t!==e)),v.length>0&&v.every((e=>e===v[0])))return b(v[0]);if(v.length>1){if([...new Set(v)].length>1)return b(e)}for(const x of y)if(v.includes(x))return b(x);return b("d")}function T(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;const i=document.createElement("canvas");i.width=t,i.height=t;const l=i.getContext("2d"),c="far"===s?null:function(e,t,n,r){if(!x[e])return null;const o={topLeft:!1,topRight:!1,bottomRight:!1,bottomLeft:!1},a=[{neighbors:[{row:t-1,col:n},{row:t,col:n-1}],corner:"topLeft"},{neighbors:[{row:t-1,col:n},{row:t,col:n+1}],corner:"topRight"},{neighbors:[{row:t+1,col:n},{row:t,col:n+1}],corner:"bottomRight"},{neighbors:[{row:t+1,col:n},{row:t,col:n-1}],corner:"bottomLeft"}];for(const s of a){const t=s.neighbors.every((t=>{var n;return((null===(n=r[t.row])||void 0===n?void 0:n[t.col])||"d")!==e}));o[s.corner]=t}return o}(e,r,o,a);if(l.fillStyle=b(e),l.fillRect(0,0,t,t),c){const n=t/2;c.topLeft&&(l.fillStyle=S(e,"topLeft",r,o,a),l.fillRect(0,0,n,n)),c.topRight&&(l.fillStyle=S(e,"topRight",r,o,a),l.fillRect(n,0,n,n)),c.bottomRight&&(l.fillStyle=S(e,"bottomRight",r,o,a),l.fillRect(n,n,n,n)),c.bottomLeft&&(l.fillStyle=S(e,"bottomLeft",r,o,a),l.fillRect(0,n,n,n)),l.fillStyle=b(e);const s=8;l.beginPath(),l.moveTo(c.topLeft?s:0,0),l.lineTo(t-(c.topRight?s:0),0),c.topRight&&l.quadraticCurveTo(t,0,t,s),l.lineTo(t,t-(c.bottomRight?s:0)),c.bottomRight&&l.quadraticCurveTo(t,t,t-s,t),l.lineTo(c.bottomLeft?s:0,t),c.bottomLeft&&l.quadraticCurveTo(0,t,0,t-s),l.lineTo(0,c.topLeft?s:0),c.topLeft&&l.quadraticCurveTo(0,0,s,0),l.closePath(),l.fill()}if("g"===e){const e=[157,331,523,769][n]||500;if(0===n){[[25,30],[70,45],[45,70]].forEach(((n,r)=>{let[o,a]=n;const s=(e+73*r)%1e3;w(l,(o+.1*s%20-10)/100*t,(a+.2*s%20-10)/100*t,s,t)}))}else if(1===n){[[20,20],[75,25],[30,75],[80,80]].forEach(((n,r)=>{let[o,a]=n;const s=(e+91*r)%1e3;w(l,(o+.15*s%15-7)/100*t,(a+.18*s%15-7)/100*t,s,t)}))}else if(2===n){[[50,40],[60,55],[45,60],[35,45]].forEach(((n,r)=>{let[o,a]=n;const s=(e+113*r)%1e3;w(l,(o+.25*s%30-15)/100*t,(a+.3*s%25-12)/100*t,s,t)}))}else{[[40,35],[65,60]].forEach(((n,r)=>{let[o,a]=n;const s=(e+137*r)%1e3;w(l,(o+.2*s%30-15)/100*t,(a+.25*s%25-12)/100*t,s,t)}))}if((e+17*n)%5===0){const n=1.41*e%1e3,r=(15+.83*n%70)/100*t,o=(25+1.37*n%50)/100*t,a=Math.max(2,.12*t+.01*n%(.04*t));l.save(),l.translate(r,o),l.rotate(.7*n%60-30),l.fillStyle="rgba(220, 220, 40, 0.6)",l.beginPath();[[.3,1],[0,.8],[.1,.6],[0,.4],[.15,.2],[.4,.3],[.6,.1],[.8,.3],[1,.5],[.85,.8],[.7,1]].forEach(((e,t)=>{let[n,r]=e;const o=n*a-a/2,s=r*a-a/2;0===t?l.moveTo(o,s):l.lineTo(o,s)})),l.closePath(),l.fill(),l.restore()}}if("d"===e){const e=600+150*n,r=4+e%4;for(let n=0;n<r;n++){const r=(e+139*n)%1e3,o=(5+.91*r%90)/100*t,a=(5+1.23*r%90)/100*t,s=Math.max(1,.06*t+.01*r%(.03*t)),i=.12+.01*r%.08;l.save(),l.translate(o,a),l.rotate(.7*r%180*Math.PI/180),l.fillStyle=`rgba(80, 50, 30, ${i})`;const c=2*s,d=.5*s;l.fillRect(-c/2,-d/2,c,d),l.restore()}if(e%6===0){const n=1.61*e%1e3,r=(10+.79*n%80)/100*t,o=(10+1.47*n%80)/100*t,a=Math.max(1,.08*t+.01*n%(.02*t));l.fillStyle="rgba(160, 130, 90, 0.25)",l.beginPath(),l.arc(r,o,a/2,0,2*Math.PI),l.fill()}}if("p"===e){const a="#67c257",s=Math.max(4,.15*t);l.fillStyle=a,l.globalAlpha=.4,l.fillRect(0,0,t,t),l.globalAlpha=1;const i=(e,t,n,r,o)=>{l.beginPath(),l.moveTo(e+o,t),l.lineTo(e+n-o,t),l.quadraticCurveTo(e+n,t,e+n,t+o),l.lineTo(e+n,t+r-o),l.quadraticCurveTo(e+n,t+r,e+n-o,t+r),l.lineTo(e+o,t+r),l.quadraticCurveTo(e,t+r,e,t+r-o),l.lineTo(e,t+o),l.quadraticCurveTo(e,t,e+o,t),l.closePath()};l.save(),i(0,0,t,t,s),l.clip(),l.fillStyle=b(e),l.fillRect(0,0,t,t);const c=Math.max(1,.001*t);l.fillStyle=a,l.globalAlpha=.6,l.fillRect(0,0,t,c),l.fillRect(0,t-c,t,c),l.fillRect(0,0,c,t),l.fillRect(t-c,0,c,t),l.globalAlpha=1;const d=Math.max(1,.01*t),u=c;l.fillStyle="rgba(220, 215, 200, 0.7)",l.fillRect(u,u,t-2*u,d),l.fillRect(u,u,d,t-2*u),l.fillStyle="rgba(80, 65, 45, 0.7)",l.fillRect(u,t-u-d,t-2*u,d),l.fillRect(t-u-d,u,d,t-2*u),l.restore();const h=(73*r+137*o+211*n)%1e3,p=2+h%3;for(let e=0;e<p;e++){const n=(h+179*e)%1e3;let r,o,a;const s=n%4,i=2*c;0===s?(r=.7*n%(.8*t)+.1*t,o=.3*n%(c+i),a=!0):1===s?(r=.8*n%(.8*t)+.1*t,o=t-c-i+.4*n%(c+i),a=!0):2===s?(r=.5*n%(c+i),o=.9*n%(.8*t)+.1*t,a=!1):(r=t-c-i+.6*n%(c+i),o=1.1*n%(.8*t)+.1*t,a=!1);const d=Math.max(4,.15*t),u=Math.max(1,.02*t);l.fillStyle="rgba(27, 151, 27, 0.7)",l.save(),l.translate(r,o);const p=.01*n%(.3*Math.PI)-.15*Math.PI;if(l.rotate(p),a){l.fillRect(-d/2,-u/2,d,u);for(let e=0;e<3;e++){const t=(e-1)*d*.3,r=u*(.5+(n+23*e)%100/200);l.beginPath(),l.ellipse(t,0,r,1.5*r,0,0,2*Math.PI),l.fill()}}else{l.fillRect(-u/2,-d/2,u,d);for(let e=0;e<3;e++){const t=(e-1)*d*.3,r=u*(.5+(n+29*e)%100/200);l.beginPath(),l.ellipse(0,t,1.5*r,r,0,0,2*Math.PI),l.fill()}}l.restore()}}if("x"===e){const a="#307823ff",s=Math.max(4,.15*t);l.fillStyle=a,l.globalAlpha=.4,l.fillRect(0,0,t,t),l.globalAlpha=1;const i=(e,t,n,r,o)=>{l.beginPath(),l.moveTo(e+o,t),l.lineTo(e+n-o,t),l.quadraticCurveTo(e+n,t,e+n,t+o),l.lineTo(e+n,t+r-o),l.quadraticCurveTo(e+n,t+r,e+n-o,t+r),l.lineTo(e+o,t+r),l.quadraticCurveTo(e,t+r,e,t+r-o),l.lineTo(e,t+o),l.quadraticCurveTo(e,t,e+o,t),l.closePath()};l.save(),i(0,0,t,t,s),l.clip(),l.fillStyle=b(e),l.fillRect(0,0,t,t);const c=Math.max(1,.006*t);l.fillStyle=a,l.globalAlpha=.6,l.fillRect(0,0,t,c),l.fillRect(0,t-c,t,c),l.fillRect(0,0,c,t),l.fillRect(t-c,0,c,t),l.globalAlpha=1;const d=Math.max(1,.06*t),u=c;l.fillStyle="rgba(200, 212, 220, 0.7)",l.fillRect(u,u,t-2*u,d),l.fillRect(u,u,d,t-2*u),l.fillStyle="rgba(45, 54, 80, 0.7)",l.fillRect(u,t-u-d,t-2*u,d),l.fillRect(t-u-d,u,d,t-2*u),l.restore();const h=(73*r+137*o+211*n)%1e3,p=2+h%3;for(let e=0;e<p;e++){const n=(h+179*e)%1e3;let r,o,a;const s=n%4,i=2*c;0===s?(r=.7*n%(.8*t)+.1*t,o=.3*n%(c+i),a=!0):1===s?(r=.8*n%(.8*t)+.1*t,o=t-c-i+.4*n%(c+i),a=!0):2===s?(r=.5*n%(c+i),o=.9*n%(.8*t)+.1*t,a=!1):(r=t-c-i+.6*n%(c+i),o=1.1*n%(.8*t)+.1*t,a=!1);const d=Math.max(4,.15*t),u=Math.max(1,.02*t);l.fillStyle="rgba(19, 100, 19, 0.7)",l.save(),l.translate(r,o);const p=.01*n%(.3*Math.PI)-.15*Math.PI;if(l.rotate(p),a){l.fillRect(-d/2,-u/2,d,u);for(let e=0;e<3;e++){const t=(e-1)*d*.3,r=u*(.5+(n+23*e)%100/200);l.beginPath(),l.ellipse(t,0,r,1.5*r,0,0,2*Math.PI),l.fill()}}else{l.fillRect(-u/2,-d/2,u,d);for(let e=0;e<3;e++){const t=(e-1)*d*.3,r=u*(.5+(n+29*e)%100/200);l.beginPath(),l.ellipse(0,t,1.5*r,r,0,0,2*Math.PI),l.fill()}}l.restore()}}if("s"===e||"x"===e){const e=(73*r+137*o+211*n)%1e3;if(e%3===0){const n=1+e%2;for(let r=0;r<n;r++){const n=(e+179*r)%1e3,o=(20+.6*n%60)/100*t,a=(20+1.1*n%60)/100*t;l.save(),l.strokeStyle="rgba(89, 93, 98, 0.7)",l.lineWidth=Math.max(1,.008*t),l.lineCap="round",l.lineJoin="round";const s=function(e,o,a,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.3;const c=Math.sqrt((a-e)**2+(s-o)**2),d=Math.max(4,Math.floor(c/(.05*t)));l.moveTo(e,o);for(let u=1;u<=d;u++){const c=u/d,h=e+(a-e)*c,p=o+(s-o)*c,m=Math.atan2(s-o,a-e)+Math.PI/2,f=(n+23*u+67*r)%1e3,g=Math.sin(c*Math.PI*2)*i*t*.02,y=(.1*f%1-.5)*i*t*.015,v=h+Math.cos(m)*(g+y),b=p+Math.sin(m)*(g+y);l.lineTo(v,b)}},i=.15*t+.01*n%(.1*t),c=.8*n%360*Math.PI/180,d=o+Math.cos(c)*i,u=a+Math.sin(c)*i;l.beginPath(),s(o,a,d,u),l.stroke();const h=.6+.01*n%.3,p=o+Math.cos(c)*i*h,m=a+Math.sin(c)*i*h,f=i*(.4+.01*n%.3),g=30+n%40,y=c-g*Math.PI/180,v=p+Math.cos(y)*f,b=m+Math.sin(y)*f;l.beginPath(),s(p,m,v,b,.2),l.stroke();const x=c+g*Math.PI/180,w=p+Math.cos(x)*f,S=m+Math.sin(x)*f;l.beginPath(),s(p,m,w,S,.2),l.stroke(),l.restore()}}}return i}const C=e=>{let{grid:n,tileTypes:r,TILE_SIZE:o,zoomLevel:a,handleTileClick:s}=e;const i=(0,t.useRef)(null),l=(0,t.useRef)(new Map),c=(0,t.useRef)(null);(0,t.useEffect)((()=>{l.current.clear()}),[o,a]);const u=(0,t.useCallback)(((e,t,n)=>{const s=(73*t+37*n)%("far"===a?1:"g"===e||"d"===e||"s"===e?4:1),i=`${e}-${o}-${a}-${s}-${t}-${n}`;return l.current.has(i)||l.current.set(i,T(e,o,s,t,n,r,a)),l.current.get(i)}),[o,r,a]),h=(0,t.useCallback)((()=>{var e;const t=i.current;if(!t||!n||!r)return;const a=t.getContext("2d"),s=n.length,l=(null===(e=n[0])||void 0===e?void 0:e.length)||0;t.width=l*o,t.height=s*o,a.clearRect(0,0,t.width,t.height);for(let n=0;n<s;n++)for(let e=0;e<l;e++){var c;const t=(null===(c=r[n])||void 0===c?void 0:c[e])||"unknown",s=u(t,n,e);a.drawImage(s,e*o,n*o,o,o)}}),[n,r,o,u]);(0,t.useEffect)((()=>{const e=JSON.stringify({grid:n,tileTypes:r,TILE_SIZE:o,zoomLevel:a});e!==c.current&&(h(),c.current=e)}),[h,n,r,o,a]);const p=(0,t.useCallback)((e=>{var t;const r=i.current;if(!r||!s)return;const a=r.getBoundingClientRect(),l=e.clientX-a.left,c=e.clientY-a.top,d=Math.floor(l/o),u=Math.floor(c/o);u>=0&&u<n.length&&d>=0&&d<((null===(t=n[0])||void 0===t?void 0:t.length)||0)&&s(u,d)}),[s,o,n]);return(0,d.jsx)("canvas",{ref:i,onClick:p,style:{position:"absolute",top:0,left:0,zIndex:1,cursor:"pointer",imageRendering:"pixelated"}})};const k={g:100,o:90,z:80,n:70,d:60,c:50,s:40,l:30,w:20,v:15,u:15,p:0,x:0,y:0},A={g:"organic",z:"organic",o:"organic",n:"organic",d:"organic",c:"organic",s:"organic",w:"organic",l:"organic",p:"straight",x:"straight",y:"straight",v:"organic",u:"organic"};function I(e){return"organic"===A[e]}function E(e,t,n,r){var o,a;return null!==(o=null===(a=e[t])||void 0===a?void 0:a[n])&&void 0!==o?o:r}function P(e,t,n,r,o,a,s,i,l){e.fillStyle=s,e.fillRect(t,n,r,o),e.fillStyle=i,e.fillRect(t,n,r,a),e.fillRect(t,n,a,o),e.fillStyle=l,e.fillRect(t,n+o-a,r,a),e.fillRect(t+r-a,n,a,o)}function _(e,t,n,r,o,a,s){if("x"===a){const a=r/2,i=Math.max(1,Math.floor(.12*a)),l="rgba(180, 180, 185, 0.7)",c="rgba(90, 90, 95, 0.5)",d=[[0,0],[a,0],[0,a],[a,a]],u=function(e){const t={r:128,g:128,b:128};if(!e||"string"!==typeof e)return t;const n=e.replace("#","");let r,o,a;if(3===n.length||4===n.length)r=parseInt(n[0]+n[0],16),o=parseInt(n[1]+n[1],16),a=parseInt(n[2]+n[2],16);else{if(6!==n.length&&8!==n.length)return t;r=parseInt(n.substring(0,2),16),o=parseInt(n.substring(2,4),16),a=parseInt(n.substring(4,6),16)}return isNaN(r)||isNaN(o)||isNaN(a)?t:{r:r,g:o,b:a}}(o);d.forEach(((r,o)=>{let[d,h]=r;const p=(s+37*o)%1e3,m=p%20-10,f=Math.min(255,Math.max(0,u.r+m)),g=Math.min(255,Math.max(0,u.g+m)),y=Math.min(255,Math.max(0,u.b+m));if(P(e,t+d,n+h,a,a,i,`rgb(${f}, ${g}, ${y})`,l,c),p%3===0){e.strokeStyle="rgba(60, 60, 65, 0.3)",e.lineWidth=1;const r=t+d+i+p%30/100*(a-2*i),o=n+h+i+1.3*p%30/100*(a-2*i),s=r+(p%20-10)/100*a*.5,l=o+.7*p%20/100*a*.5;e.beginPath(),e.moveTo(r,o),e.lineTo(s,l),e.stroke()}}))}else{const a=Math.max(2,Math.floor(.08*r));P(e,t,n,r,r,a,o,"rgba(220, 200, 160, 0.5)","rgba(160, 140, 100, 0.6)")}if("p"===a&&s%5<3){const o=3*s%1e3,a="rgba(50, 130, 50, 0.85)",i=1+o%2;for(let l=0;l<i;l++){const i=(7*s+41*l)%4,c=(o+100*l)%1e3,d=(.2+c%60/100)*r,u=2+c%2,h=.064*r;e.fillStyle=a;for(let o=0;o<u;o++){const a=r*(.04+(c+17*o)%100/1500),s=Math.max(1,.04*r);let l,u;switch(i){case 0:l=t+d+o*h,u=n,e.beginPath(),e.moveTo(l-s,u),e.lineTo(l,u+a),e.lineTo(l+s,u),e.closePath(),e.fill();break;case 1:l=t+r,u=n+d+o*h,e.beginPath(),e.moveTo(l,u-s),e.lineTo(l-a,u),e.lineTo(l,u+s),e.closePath(),e.fill();break;case 2:l=t+d+o*h,u=n+r,e.beginPath(),e.moveTo(l-s,u),e.lineTo(l,u-a),e.lineTo(l+s,u),e.closePath(),e.fill();break;case 3:l=t,u=n+d+o*h,e.beginPath(),e.moveTo(l,u-s),e.lineTo(l+a,u),e.lineTo(l,u+s),e.closePath(),e.fill()}}}}}function N(e,t,n,r,o,a){if("g"===t){const t=a%4,s=[157,331,523,769][t]||500;let i;i=0===t?[[25,30],[70,45],[45,70]]:1===t?[[20,20],[75,25],[30,75],[80,80]]:2===t?[[50,40],[60,55],[45,60],[35,45]]:[[40,35],[65,60]],i.forEach(((t,i)=>{let[l,c]=t;const d=(s+73*i+11*a)%1e3;!function(e,t,n,r,o){const a=Math.max(1,.08*o+.01*r%(.04*o)),s=.15+.01*r%.1;e.save(),e.translate(t,n),e.rotate(.5*r%60-30),e.fillStyle=`rgba(0, 50, 0, ${s})`,e.beginPath(),[[.3,1],[0,.8],[.1,.6],[0,.4],[.15,.2],[.4,.3],[.6,.1],[.8,.3],[1,.5],[.85,.8],[.7,1]].forEach(((t,n)=>{let[r,o]=t;const s=r*a-a/2,i=o*a-a/2;0===n?e.moveTo(s,i):e.lineTo(s,i)})),e.closePath(),e.fill(),e.restore()}(e,n+(l+(.1*d%20-10))/100*o,r+(c+(.2*d%20-10))/100*o,d,o)}));if((31*a+17*t)%100<20){const s=[[15,25],[75,65],[40,80],[85,20],[55,35],[25,70],[70,45],[35,15]][(7*a+3*t)%8],i=(37*a+53*t)%1e3,l=i%20-10,c=7*i%20-10,d=n+(s[0]+l)/100*o,u=r+(s[1]+c)/100*o,h=Math.max(2,.12*o+i%40/1e3*o);e.save(),e.translate(d,u),e.rotate(.7*i%60-30),e.fillStyle="rgba(220, 220, 40, 0.6)",e.beginPath();[[.3,1],[0,.8],[.1,.6],[0,.4],[.15,.2],[.4,.3],[.6,.1],[.8,.3],[1,.5],[.85,.8],[.7,1]].forEach(((t,n)=>{let[r,o]=t;const a=r*h-h/2,s=o*h-h/2;0===n?e.moveTo(a,s):e.lineTo(a,s)})),e.closePath(),e.fill(),e.restore()}}else if("d"===t){const t=[173,349,541,797][a%4]||500,s=[[15,25],[45,15],[75,35],[25,55],[55,45],[85,65],[35,85],[65,75],[20,70],[80,20]];e.fillStyle="rgba(60, 35, 20, 0.35)",s.forEach(((s,i)=>{let[l,c]=s;const d=(t+73*i+13*a)%1e3,u=n+(l+(.15*d%20-10))/100*o,h=r+(c+(.23*d%20-10))/100*o,p=Math.max(.8,o*(.012+d%8/2e3));e.beginPath(),e.arc(u,h,p,0,2*Math.PI),e.fill()}));const i=[[30,20],[60,40],[20,60],[70,80],[50,70],[85,45]];if(e.fillStyle="rgba(130, 95, 60, 0.25)",i.forEach(((s,i)=>{let[l,c]=s;const d=(t+89*i+17*a+300)%1e3,u=n+(l+(.18*d%18-9))/100*o,h=r+(c+(.27*d%18-9))/100*o,p=Math.max(.6,o*(.01+d%6/2e3));e.beginPath(),e.arc(u,h,p,0,2*Math.PI),e.fill()})),a%4===0){const s=(t+1.5*a)%1e3,i=n+(20+.6*s%60)/100*o,l=r+(20+.8*s%60)/100*o,c=Math.max(1.5,.02*o);e.fillStyle="rgba(90, 70, 50, 0.3)",e.beginPath(),e.arc(i,l,c,0,2*Math.PI),e.fill()}}else if("n"===t){const t=[191,373,557,811][a%4]||500,s=[[20,30],[50,20],[80,40],[30,60],[60,50],[90,70],[40,80],[70,70],[25,75],[75,25]];e.fillStyle="rgba(140, 110, 20, 0.4)",s.forEach(((s,i)=>{let[l,c]=s;const d=(t+79*i+11*a)%1e3,u=n+(l+(.15*d%20-10))/100*o,h=r+(c+(.23*d%20-10))/100*o,p=Math.max(.8,o*(.012+d%8/2e3));e.beginPath(),e.arc(u,h,p,0,2*Math.PI),e.fill()}));const i=[[35,25],[65,45],[25,65],[75,85],[55,75],[80,40]];if(e.fillStyle="rgba(160, 130, 50, 0.3)",i.forEach(((s,i)=>{let[l,c]=s;const d=(t+83*i+19*a+400)%1e3,u=n+(l+(.18*d%18-9))/100*o,h=r+(c+(.27*d%18-9))/100*o,p=Math.max(.6,o*(.01+d%6/2e3));e.beginPath(),e.arc(u,h,p,0,2*Math.PI),e.fill()})),a%5===0){const s=(t+1.7*a)%1e3,i=n+(20+.6*s%60)/100*o,l=r+(20+.8*s%60)/100*o,c=Math.max(1.5,.02*o);e.fillStyle="rgba(220, 200, 150, 0.35)",e.beginPath(),e.arc(i,l,c,0,2*Math.PI),e.fill()}}else if("s"===t){if(a%100<48){const t=3*a%1e3,s="rgba(70, 80, 90, 0.6)",i="rgba(120, 130, 140, 0.3)";e.lineCap="round",e.lineJoin="round";const l=(t,n,r,a,l,c)=>{const d=(t+r)/2,u=(n+a)/2,h=Math.atan2(a-n,r-t)+Math.PI/2,p=(c%60-30)/100*o*.05,m=d+Math.cos(h)*p,f=u+Math.sin(h)*p;e.strokeStyle=s,e.lineWidth=l,e.beginPath(),e.moveTo(t,n),e.quadraticCurveTo(m,f,r,a),e.stroke(),e.strokeStyle=i,e.lineWidth=Math.max(.5,.4*l),e.beginPath(),e.moveTo(t+.5,n+.5),e.quadraticCurveTo(m+.5,f+.5,r+.5,a+.5),e.stroke()},c=1+t%2;for(let e=0;e<c;e++){const a=(t+137*e)%1e3;let s,i;const c=a%6;0===c?(s=n,i=r+(a%80+10)/100*o):1===c?(s=n+o,i=r+(1.3*a%80+10)/100*o):2===c?(s=n+(a%80+10)/100*o,i=r):3===c?(s=n+(1.5*a%80+10)/100*o,i=r+o):(s=n+(25+a%50)/100*o,i=r+(25+1.2*a%50)/100*o);const d=.8*a%(2*Math.PI),u=o*(.15+a%25/100),h=Math.max(1,.012*o),p=2+a%2;let m=s,f=i,g=s,y=i,v=d;for(let e=0;e<p;e++){const t=(e+1)/p,n=(a+47*e)%1e3,r=d+(n%30-15)/180*Math.PI,o=u/p,s=m+Math.cos(r)*o,i=f+Math.sin(r)*o;l(m,f,s,i,h*(1-.3*t),n),e===Math.floor(.5*p)&&(g=s,y=i,v=r),m=s,f=i}if(a%3!==0){const e=(25+a%35)*Math.PI/180,t=u*(.3+a%20/100),n=v-e,r=g+Math.cos(n)*t,o=y+Math.sin(n)*t;l(g,y,r,o,.7*h,a+100);const s=v+e;if(l(g,y,g+Math.cos(s)*t,y+Math.sin(s)*t,.7*h,a+200),a%5===0){const e=.4*t,s=n-20*Math.PI/180;l(r,o,r+Math.cos(s)*e,o+Math.sin(s)*e,.4*h,a+300)}}}}const t=2+a%3;e.fillStyle="rgba(100, 110, 120, 0.1)";for(let s=0;s<t;s++){const t=(a+89*s)%1e3,i=n+(t%90+5)/100*o,l=r+(1.4*t%90+5)/100*o,c=Math.max(1,.03*o);e.beginPath(),e.arc(i,l,c,0,2*Math.PI),e.fill()}}else if("o"===t){const t=a%4,s=[197,389,571,827][t]||500,i=[[[10,15],[85,40],[45,90],[60,5]],[[5,55],[50,20],[90,75],[35,60]],[[75,10],[20,80],[95,50],[40,35]],[[55,95],[15,30],[80,65],[45,5]]][t];e.fillStyle="rgba(220, 230, 240, 0.35)",i.forEach(((t,i)=>{let[l,c]=t;const d=(s+71*i+17*a)%1e3,u=n+(l+(.12*d%16-8))/100*o,h=r+(c+(.17*d%16-8))/100*o,p=Math.max(2,o*(.04+d%10/500));e.beginPath(),e.arc(u,h,p,0,2*Math.PI),e.fill()}));const l=[[[30,5],[85,60],[15,85]],[[70,15],[10,50],[55,80]],[[90,30],[40,70],[5,20]],[[25,45],[75,90],[50,10]]][t];if(e.fillStyle="rgba(255, 255, 255, 0.6)",l.forEach(((t,i)=>{let[l,c]=t;const d=(s+97*i+23*a+500)%1e3,u=n+(l+(.15*d%14-7))/100*o,h=r+(c+(.2*d%14-7))/100*o,p=Math.max(1,o*(.015+d%5/1500));e.beginPath(),e.arc(u,h,p,0,2*Math.PI),e.fill()})),a%6===0){const t=(s+1.9*a)%1e3,i=n+(5+.9*t%90)/100*o,l=r+(5+1.1*t%90)/100*o,c=Math.max(3,.06*o);e.fillStyle="rgba(230, 238, 245, 0.3)",e.beginPath(),e.arc(i,l,c,0,2*Math.PI),e.fill()}}else if("z"===t){const t=a%4,s=[163,337,509,733][t]||500;[[[20,25],[65,35],[35,70],[80,75],[50,50]],[[15,50],[55,20],[85,55],[40,85],[70,70]],[[30,15],[75,45],[20,75],[60,65],[45,40]],[[45,25],[80,30],[25,60],[65,80],[15,35]]][t].forEach(((t,i)=>{let[l,c]=t;const d=(s+67*i+13*a)%1e3,u=n+(l+(.15*d%20-10))/100*o,h=r+(c+(.2*d%20-10))/100*o,p=Math.max(3,o*(.08+d%40/500));e.fillStyle="rgba(45, 140, 55, 0.5)",e.beginPath();const m=6+d%3;for(let n=0;n<m;n++){const t=n/m*Math.PI*2,r=.6+d*(n+1)%100/250,o=u+Math.cos(t)*p*r,a=h+Math.sin(t)*p*r;0===n?e.moveTo(o,a):e.lineTo(o,a)}e.closePath(),e.fill()}));(29*a+13*t)%100<40&&[[[25,40],[70,25],[45,80]],[[60,50],[20,70],[80,15]],[[35,30],[75,70],[15,55]],[[50,15],[30,85],[85,45]]][t].forEach(((t,i)=>{let[l,c]=t;const d=(s+83*i+19*a+400)%1e3,u=n+(l+(.12*d%16-8))/100*o,h=r+(c+(.18*d%16-8))/100*o,p=Math.max(2,o*(.06+d%30/600));e.fillStyle="rgba(180, 200, 50, 0.55)",e.beginPath();const m=5+d%2;for(let n=0;n<m;n++){const t=n/m*Math.PI*2,r=.7+d*(n+2)%100/300,o=u+Math.cos(t)*p*r,a=h+Math.sin(t)*p*r;0===n?e.moveTo(o,a):e.lineTo(o,a)}e.closePath(),e.fill()}));const i=[[[40,55],[75,85]],[[30,40],[85,25]],[[55,75],[15,20]],[[70,50],[25,80]]][t];if(e.fillStyle="rgba(100, 180, 80, 0.4)",i.forEach(((t,i)=>{let[l,c]=t;const d=(s+101*i+7*a+200)%1e3,u=n+(l+(.1*d%14-7))/100*o,h=r+(c+(.15*d%14-7))/100*o,p=Math.max(1.5,o*(.025+d%15/800));e.beginPath(),e.arc(u,h,p,0,2*Math.PI),e.fill()})),a%3===0){const t=(s+2.3*a)%1e3,i=n+(15+.7*t%70)/100*o,l=r+(15+.9*t%70)/100*o,c=Math.max(2,.04*o);e.fillStyle="rgba(10, 60, 20, 0.3)",e.beginPath(),e.arc(i,l,c,0,2*Math.PI),e.fill()}}}function R(e,t,n,r,o){const a=document.createElement("canvas");a.width=t,a.height=t;const s=a.getContext("2d"),i=b(e),l=(127*n+53*r)%1e4;return"p"===e||"x"===e?(s.fillStyle=b("g"),s.fillRect(0,0,t,t),_(s,0,0,t,i,e,l),a):(s.fillStyle=i,s.fillRect(0,0,t,t),N(s,e,0,0,t,l),o&&function(e,t,n,r,o,a){if(!I(t))return;const s=k[t]||0,i=Math.max(2,Math.floor(.2*n)),l=E(a,r-1,o,t),c=E(a,r+1,o,t),d=E(a,r,o-1,t),u=E(a,r,o+1,t),h=E(a,r-1,o-1,t),p=E(a,r-1,o+1,t),m=E(a,r+1,o-1,t),f=E(a,r+1,o+1,t),g=(t,r)=>{switch(e.fillStyle=r,e.beginPath(),t){case"topLeft":e.moveTo(0,0),e.lineTo(i,0),e.quadraticCurveTo(0,0,0,i),e.closePath();break;case"topRight":e.moveTo(n-i,0),e.lineTo(n,0),e.lineTo(n,i),e.quadraticCurveTo(n,0,n-i,0),e.closePath();break;case"bottomLeft":e.moveTo(0,n-i),e.lineTo(0,n),e.lineTo(i,n),e.quadraticCurveTo(0,n,0,n-i),e.closePath();break;case"bottomRight":e.moveTo(n,n-i),e.lineTo(n,n),e.lineTo(n-i,n),e.quadraticCurveTo(n,n,n,n-i),e.closePath()}e.fill()};if(l!==t&&d!==t&&l===d){const e=k[l]||0;(h===l&&I(l)||e>s)&&g("topLeft",b(l))}if(l!==t&&u!==t&&l===u){const e=k[l]||0;(p===l&&I(l)||e>s)&&g("topRight",b(l))}if(c!==t&&d!==t&&c===d){const e=k[c]||0;(m===c&&I(c)||e>s)&&g("bottomLeft",b(c))}if(c!==t&&u!==t&&c===u){const e=k[c]||0;(f===c&&I(c)||e>s)&&g("bottomRight",b(c))}}(s,e,t,n,r,o),a)}const M=e=>{let{grid:n,tileTypes:r,TILE_SIZE:o,zoomLevel:a,handleTileClick:s}=e;const i=(0,t.useRef)(null),l=(0,t.useRef)(new Map),c=(0,t.useRef)(null),u=(0,t.useRef)(null);(0,t.useEffect)((()=>{l.current.clear()}),[o,a]),(0,t.useEffect)((()=>{var e;if(!r||!u.current)return void(u.current=r);const t=r.length,n=(null===(e=r[0])||void 0===e?void 0:e.length)||0,s=new Set;for(let l=0;l<t;l++)for(let e=0;e<n;e++){var i,c;if((null===(i=r[l])||void 0===i?void 0:i[e])!==(null===(c=u.current[l])||void 0===c?void 0:c[e]))for(let i=-1;i<=1;i++)for(let c=-1;c<=1;c++){const u=l+i,h=e+c;if(u>=0&&u<t&&h>=0&&h<n){var d;const e=`${(null===(d=r[u])||void 0===d?void 0:d[h])||"g"}-${o}-${a}-${u}-${h}`;s.add(e)}}}s.forEach((e=>{l.current.delete(e)})),u.current=r}),[r,o,a]);const h=(0,t.useCallback)(((e,t,n)=>{const s=`${e}-${o}-${a}-${t}-${n}`;return l.current.has(s)||l.current.set(s,R(e,o,t,n,r)),l.current.get(s)}),[o,r,a]),p=(0,t.useCallback)((()=>{var e;const t=i.current;if(!t||!n||!r)return;const a=t.getContext("2d"),s=n.length,l=(null===(e=n[0])||void 0===e?void 0:e.length)||0;t.width=l*o,t.height=s*o,a.clearRect(0,0,t.width,t.height);for(let n=0;n<s;n++)for(let e=0;e<l;e++){var c;const t=(null===(c=r[n])||void 0===c?void 0:c[e])||"g",s=h(t,n,e);a.drawImage(s,e*o,n*o,o,o)}}),[n,r,o,h]);(0,t.useEffect)((()=>{const e=JSON.stringify({grid:n,tileTypes:r,TILE_SIZE:o,zoomLevel:a});e!==c.current&&(p(),c.current=e)}),[p,n,r,o,a]);const m=(0,t.useCallback)((e=>{var t;const r=i.current;if(!r||!s)return;const a=r.getBoundingClientRect(),l=e.clientX-a.left,c=e.clientY-a.top,d=Math.floor(l/o),u=Math.floor(c/o);u>=0&&u<n.length&&d>=0&&d<((null===(t=n[0])||void 0===t?void 0:t.length)||0)&&s(u,d)}),[s,o,n]);return(0,d.jsx)("canvas",{ref:i,onClick:m,style:{position:"absolute",top:0,left:0,zIndex:1,cursor:"pointer",imageRendering:"pixelated"}})};var j=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(j||{}),D=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(D||{}),O=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(O||{}),B=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(B||{}),L=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(L||{}),F=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(F||{}),$=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))($||{}),G=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(G||{}),z=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(z||{}),U=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(U||{}),H=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(H||{}),q=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(q||{}),V=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(V||{}),W=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(W||{}),Y=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(Y||{}),K=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(K||{}),X=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(X||{}),Z=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(Z||{}),J=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(J||{});const Q={ADAPTER:{createCanvas:(e,t)=>{const n=document.createElement("canvas");return n.width=e,n.height=t,n},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>(new DOMParser).parseFromString(e,"text/xml")},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var ee=/iPhone/i,te=/iPod/i,ne=/iPad/i,re=/\biOS-universal(?:.+)Mac\b/i,oe=/\bAndroid(?:.+)Mobile\b/i,ae=/Android/i,se=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,ie=/Silk/i,le=/Windows Phone/i,ce=/\bWindows(?:.+)ARM\b/i,de=/BlackBerry/i,ue=/BB10/i,he=/Opera Mini/i,pe=/\b(CriOS|Chrome)(?:.+)Mobile/i,me=/Mobile(?:.+)Firefox\b/i,fe=function(e){return"undefined"!==typeof e&&"MacIntel"===e.platform&&"number"===typeof e.maxTouchPoints&&e.maxTouchPoints>1&&"undefined"===typeof MSStream};function ge(e){var t={userAgent:"",platform:"",maxTouchPoints:0};e||"undefined"===typeof navigator?"string"===typeof e?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var n=t.userAgent,r=n.split("[FBAN");"undefined"!==typeof r[1]&&(n=r[0]),"undefined"!==typeof(r=n.split("Twitter"))[1]&&(n=r[0]);var o=function(e){return function(t){return t.test(e)}}(n),a={apple:{phone:o(ee)&&!o(le),ipod:o(te),tablet:!o(ee)&&(o(ne)||fe(t))&&!o(le),universal:o(re),device:(o(ee)||o(te)||o(ne)||o(re)||fe(t))&&!o(le)},amazon:{phone:o(se),tablet:!o(se)&&o(ie),device:o(se)||o(ie)},android:{phone:!o(le)&&o(se)||!o(le)&&o(oe),tablet:!o(le)&&!o(se)&&!o(oe)&&(o(ie)||o(ae)),device:!o(le)&&(o(se)||o(ie)||o(oe)||o(ae))||o(/\bokhttp\b/i)},windows:{phone:o(le),tablet:o(ce),device:o(le)||o(ce)},other:{blackberry:o(de),blackberry10:o(ue),opera:o(he),firefox:o(me),chrome:o(pe),device:o(de)||o(ue)||o(he)||o(me)||o(pe)},any:!1,phone:!1,tablet:!1};return a.any=a.apple.device||a.android.device||a.windows.device||a.other.device,a.phone=a.apple.phone||a.android.phone||a.windows.phone,a.tablet=a.apple.tablet||a.android.tablet||a.windows.tablet,a}const ye=(ge.default??ge)(globalThis.navigator);Q.RETINA_PREFIX=/@([0-9\.]+)x/,Q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var ve=n(7283),be=n(973),xe=n(4080);const we={};function Se(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;if(we[t])return;let r=(new Error).stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`):(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}\nDeprecated since v${e}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`),console.warn(r))),we[t]=!0}const Te={get parse(){return Se("7.3.0","utils.url.parse is deprecated, use native URL API instead."),xe.qg},get format(){return Se("7.3.0","utils.url.format is deprecated, use native URL API instead."),xe.GP},get resolve(){return Se("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),xe.hd}};function Ce(e){if("string"!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function ke(e){return e.split("?")[0].split("#")[0]}const Ae={toPosix(e){return t="\\",n="/",e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n);var t,n},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),isBlobUrl:e=>e.startsWith("blob:"),hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){Ce(e),e=this.toPosix(e);const t=/^file:\/\/\//.exec(e);if(t)return t[0];const n=/^[^/:]+:\/{0,2}/.exec(e);return n?n[0]:""},toAbsolute(e,t,n){if(Ce(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;const r=ke(this.toPosix(t??Q.ADAPTER.getBaseUrl())),o=ke(this.toPosix(n??this.rootname(r)));return(e=this.toPosix(e)).startsWith("/")?Ae.join(o,e.slice(1)):this.isAbsolute(e)?e:this.join(r,e)},normalize(e){if(Ce(e),0===e.length)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;let t="";const n=(e=this.toPosix(e)).startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const r=e.endsWith("/");return(e=function(e,t){let n="",r=0,o=-1,a=0,s=-1;for(let i=0;i<=e.length;++i){if(i<e.length)s=e.charCodeAt(i);else{if(47===s)break;s=47}if(47===s){if(o!==i-1&&1!==a)if(o!==i-1&&2===a){if(n.length<2||2!==r||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){const e=n.lastIndexOf("/");if(e!==n.length-1){-1===e?(n="",r=0):(n=n.slice(0,e),r=n.length-1-n.lastIndexOf("/")),o=i,a=0;continue}}else if(2===n.length||1===n.length){n="",r=0,o=i,a=0;continue}t&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+=`/${e.slice(o+1,i)}`:n=e.slice(o+1,i),r=i-o-1;o=i,a=0}else 46===s&&-1!==a?++a:a=-1}return n}(e,!1)).length>0&&r&&(e+="/"),n?`/${e}`:t+e},isAbsolute(e){return Ce(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(){if(0===arguments.length)return".";let e;for(let t=0;t<arguments.length;++t){const n=t<0||arguments.length<=t?void 0:arguments[t];if(Ce(n),n.length>0)if(void 0===e)e=n;else{const r=(t-1<0||arguments.length<=t-1?void 0:arguments[t-1])??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?e+=`/../${n}`:e+=`/${n}`}}return void 0===e?".":this.normalize(e)},dirname(e){if(Ce(e),0===e.length)return".";let t=(e=this.toPosix(e)).charCodeAt(0);const n=47===t;let r=-1,o=!0;const a=this.getProtocol(e),s=e;for(let i=(e=e.slice(a.length)).length-1;i>=1;--i)if(t=e.charCodeAt(i),47===t){if(!o){r=i;break}}else o=!1;return-1===r?n?"/":this.isUrl(s)?a+e:a:n&&1===r?"//":a+e.slice(0,r)},rootname(e){Ce(e);let t="";if(t=(e=this.toPosix(e)).startsWith("/")?"/":this.getProtocol(e),this.isUrl(e)){const n=e.indexOf("/",t.length);t=-1!==n?e.slice(0,n):e,t.endsWith("/")||(t+="/")}return t},basename(e,t){Ce(e),t&&Ce(t),e=ke(this.toPosix(e));let n,r=0,o=-1,a=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let s=t.length-1,i=-1;for(n=e.length-1;n>=0;--n){const l=e.charCodeAt(n);if(47===l){if(!a){r=n+1;break}}else-1===i&&(a=!1,i=n+1),s>=0&&(l===t.charCodeAt(s)?-1===--s&&(o=n):(s=-1,o=i))}return r===o?o=i:-1===o&&(o=e.length),e.slice(r,o)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!a){r=n+1;break}}else-1===o&&(a=!1,o=n+1);return-1===o?"":e.slice(r,o)},extname(e){Ce(e);let t=-1,n=0,r=-1,o=!0,a=0;for(let s=(e=ke(this.toPosix(e))).length-1;s>=0;--s){const i=e.charCodeAt(s);if(47!==i)-1===r&&(o=!1,r=s+1),46===i?-1===t?t=s:1!==a&&(a=1):-1!==t&&(a=-1);else if(!o){n=s+1;break}}return-1===t||-1===r||0===a||1===a&&t===r-1&&t===n+1?"":e.slice(t,r)},parse(e){Ce(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;let n=(e=ke(this.toPosix(e))).charCodeAt(0);const r=this.isAbsolute(e);let o;t.root=this.rootname(e),o=r||this.hasProtocol(e)?1:0;let a=-1,s=0,i=-1,l=!0,c=e.length-1,d=0;for(;c>=o;--c)if(n=e.charCodeAt(c),47!==n)-1===i&&(l=!1,i=c+1),46===n?-1===a?a=c:1!==d&&(d=1):-1!==a&&(d=-1);else if(!l){s=c+1;break}return-1===a||-1===i||0===d||1===d&&a===i-1&&a===s+1?-1!==i&&(t.base=t.name=0===s&&r?e.slice(1,i):e.slice(s,i)):(0===s&&r?(t.name=e.slice(1,a),t.base=e.slice(1,i)):(t.name=e.slice(s,a),t.base=e.slice(s,i)),t.ext=e.slice(a,i)),t.dir=this.dirname(e),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let Ie,Ee;async function Pe(){return Ie??(Ie=(async()=>{const e=document.createElement("canvas").getContext("webgl");if(!e)return V.UNPACK;const t=await new Promise((e=>{const t=document.createElement("video");t.onloadeddata=()=>e(t),t.onerror=()=>e(null),t.autoplay=!1,t.crossOrigin="anonymous",t.preload="auto",t.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",t.load()}));if(!t)return V.UNPACK;const n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);const o=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,o),e.deleteFramebuffer(r),e.deleteTexture(n),e.getExtension("WEBGL_lose_context")?.loseContext(),o[0]<=o[3]?V.PMA:V.UNPACK})()),Ie}function _e(){Se("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function Ne(){Se("7.0.0",'sayHello is deprecated, please use Renderer\'s "hello" option')}function Re(){return typeof Ee>"u"&&(Ee=function(){const e={stencil:!0,failIfMajorPerformanceCaveat:Q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Q.ADAPTER.getWebGLRenderingContext())return!1;const t=Q.ADAPTER.createCanvas();let n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);const r=!!n?.getContextAttributes()?.stencil;if(n){const e=n.getExtension("WEBGL_lose_context");e&&e.loseContext()}return n=null,r}catch{return!1}}()),Ee}var Me={grad:.9,turn:360,rad:360/(2*Math.PI)},je=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},De=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*e)/n+0},Oe=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),e>n?n:e>t?e:t},Be=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},Le=function(e){return{r:Oe(e.r,0,255),g:Oe(e.g,0,255),b:Oe(e.b,0,255),a:Oe(e.a)}},Fe=function(e){return{r:De(e.r),g:De(e.g),b:De(e.b),a:De(e.a,3)}},$e=/^#([0-9a-f]{3,8})$/i,Ge=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},ze=function(e){var t=e.r,n=e.g,r=e.b,o=e.a,a=Math.max(t,n,r),s=a-Math.min(t,n,r),i=s?a===t?(n-r)/s:a===n?2+(r-t)/s:4+(t-n)/s:0;return{h:60*(i<0?i+6:i),s:a?s/a*100:0,v:a/255*100,a:o}},Ue=function(e){var t=e.h,n=e.s,r=e.v,o=e.a;t=t/360*6,n/=100,r/=100;var a=Math.floor(t),s=r*(1-n),i=r*(1-(t-a)*n),l=r*(1-(1-t+a)*n),c=a%6;return{r:255*[r,i,s,s,l,r][c],g:255*[l,r,r,i,s,s][c],b:255*[s,s,l,r,r,i][c],a:o}},He=function(e){return{h:Be(e.h),s:Oe(e.s,0,100),l:Oe(e.l,0,100),a:Oe(e.a)}},qe=function(e){return{h:De(e.h),s:De(e.s),l:De(e.l),a:De(e.a,3)}},Ve=function(e){return Ue((n=(t=e).s,{h:t.h,s:(n*=((r=t.l)<50?r:100-r)/100)>0?2*n/(r+n)*100:0,v:r+n,a:t.a}));var t,n,r},We=function(e){return{h:(t=ze(e)).h,s:(o=(200-(n=t.s))*(r=t.v)/100)>0&&o<200?n*r/100/(o<=100?o:200-o)*100:0,l:o/2,a:t.a};var t,n,r,o},Ye=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ke=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Xe=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ze=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Je={string:[[function(e){var t=$e.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?De(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?De(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=Xe.exec(e)||Ze.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:Le({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=Ye.exec(e)||Ke.exec(e);if(!t)return null;var n,r,o=He({h:(n=t[1],r=t[2],void 0===r&&(r="deg"),Number(n)*(Me[r]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return Ve(o)},"hsl"]],object:[[function(e){var t=e.r,n=e.g,r=e.b,o=e.a,a=void 0===o?1:o;return je(t)&&je(n)&&je(r)?Le({r:Number(t),g:Number(n),b:Number(r),a:Number(a)}):null},"rgb"],[function(e){var t=e.h,n=e.s,r=e.l,o=e.a,a=void 0===o?1:o;if(!je(t)||!je(n)||!je(r))return null;var s=He({h:Number(t),s:Number(n),l:Number(r),a:Number(a)});return Ve(s)},"hsl"],[function(e){var t=e.h,n=e.s,r=e.v,o=e.a,a=void 0===o?1:o;if(!je(t)||!je(n)||!je(r))return null;var s=function(e){return{h:Be(e.h),s:Oe(e.s,0,100),v:Oe(e.v,0,100),a:Oe(e.a)}}({h:Number(t),s:Number(n),v:Number(r),a:Number(a)});return Ue(s)},"hsv"]]},Qe=function(e,t){for(var n=0;n<t.length;n++){var r=t[n][0](e);if(r)return[r,t[n][1]]}return[null,void 0]},et=function(e){return"string"==typeof e?Qe(e.trim(),Je.string):"object"==typeof e&&null!==e?Qe(e,Je.object):[null,void 0]},tt=function(e,t){var n=We(e);return{h:n.h,s:Oe(n.s+100*t,0,100),l:n.l,a:n.a}},nt=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},rt=function(e,t){var n=We(e);return{h:n.h,s:n.s,l:Oe(n.l+100*t,0,100),a:n.a}},ot=function(){function e(e){this.parsed=et(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return De(nt(this.rgba),2)},e.prototype.isDark=function(){return nt(this.rgba)<.5},e.prototype.isLight=function(){return nt(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=Fe(this.rgba)).r,n=e.g,r=e.b,a=(o=e.a)<1?Ge(De(255*o)):"","#"+Ge(t)+Ge(n)+Ge(r)+a;var e,t,n,r,o,a},e.prototype.toRgb=function(){return Fe(this.rgba)},e.prototype.toRgbString=function(){return t=(e=Fe(this.rgba)).r,n=e.g,r=e.b,(o=e.a)<1?"rgba("+t+", "+n+", "+r+", "+o+")":"rgb("+t+", "+n+", "+r+")";var e,t,n,r,o},e.prototype.toHsl=function(){return qe(We(this.rgba))},e.prototype.toHslString=function(){return t=(e=qe(We(this.rgba))).h,n=e.s,r=e.l,(o=e.a)<1?"hsla("+t+", "+n+"%, "+r+"%, "+o+")":"hsl("+t+", "+n+"%, "+r+"%)";var e,t,n,r,o},e.prototype.toHsv=function(){return e=ze(this.rgba),{h:De(e.h),s:De(e.s),v:De(e.v),a:De(e.a,3)};var e},e.prototype.invert=function(){return at({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),at(tt(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),at(tt(this.rgba,-e))},e.prototype.grayscale=function(){return at(tt(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),at(rt(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),at(rt(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?at({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):De(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=We(this.rgba);return"number"==typeof e?at({h:e,s:t.s,l:t.l,a:t.a}):De(t.h)},e.prototype.isEqual=function(e){return this.toHex()===at(e).toHex()},e}(),at=function(e){return e instanceof ot?e:new ot(e)},st=[];[function(e,t){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var o in n)r[n[o]]=o;var a={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,s,i=r[this.toHex()];if(i)return i;if(null==t?void 0:t.closest){var l=this.toRgb(),c=1/0,d="black";if(!a.length)for(var u in n)a[u]=new e(n[u]).toRgb();for(var h in n){var p=(o=l,s=a[h],Math.pow(o.r-s.r,2)+Math.pow(o.g-s.g,2)+Math.pow(o.b-s.b,2));p<c&&(c=p,d=h)}return d}},t.string.push([function(t){var r=t.toLowerCase(),o="transparent"===r?"#0000":n[r];return o?new e(o).toRgb():null},"name"])}].forEach((function(e){st.indexOf(e)<0&&(e(ot,Je),st.push(e))}));const it=class e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16777215;this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(t){if(t instanceof e)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(e){return"string"==typeof e||"number"==typeof e||e instanceof Number||null===e?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):"object"==typeof e&&null!==e?{...e}:e}isSourceEqual(e,t){const n=typeof e;if(n!==typeof t)return!1;if("number"===n||"string"===n||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length===t.length&&e.every(((e,n)=>e===t[n]));if(null!==e&&null!==t){const n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every((n=>e[n]===t[n]))}return e===t}toRgba(){const[e,t,n,r]=this._components;return{r:e,g:t,b:n,a:r}}toRgb(){const[e,t,n]=this._components;return{r:e,g:t,b:n}}toRgbaString(){const[e,t,n]=this.toUint8RgbArray();return`rgba(${e},${t},${n},${this.alpha})`}toUint8RgbArray(e){const[t,n,r]=this._components;return(e=e??[])[0]=Math.round(255*t),e[1]=Math.round(255*n),e[2]=Math.round(255*r),e}toRgbArray(e){e=e??[];const[t,n,r]=this._components;return e[0]=t,e[1]=n,e[2]=r,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(t){const[n,r,o,a]=e.temp.setValue(t)._components;return this._components[0]*=n,this._components[1]*=r,this._components[2]*=o,this._components[3]*=a,this.refreshInt(),this._value=null,this}premultiply(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(1===e)return(255<<24)+this._int;if(0===e)return t?0:this._int;let n=this._int>>16&255,r=this._int>>8&255,o=255&this._int;return t&&(n=n*e+.5|0,r=r*e+.5|0,o=o*e+.5|0),(255*e<<24)+(n<<16)+(r<<8)+o}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,n,r]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(n*e)/e,this._components[2]=Math.round(r*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,n,r,o]=this._components;return e[0]=t,e[1]=n,e[2]=r,e[3]=o,e}normalize(t){let n,r,o,a;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){n=(t>>16&255)/255,r=(t>>8&255)/255,o=(255&t)/255,a=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[n,r,o,a=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[n,r,o,a=255]=t,n/=255,r/=255,o/=255,a/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const n=e.HEX_PATTERN.exec(t);n&&(t=`#${n[2]}`)}const s=at(t);s.isValid()&&(({r:n,g:r,b:o,a:a}=s.rgba),n/=255,r/=255,o/=255)}if(void 0===n)throw new Error(`Unable to convert color ${t}`);this._components[0]=n,this._components[1]=r,this._components[2]=o,this._components[3]=a,this.refreshInt()}refreshInt(){this._clamp(this._components);const[e,t,n]=this._components;this._int=(255*e<<16)+(255*t<<8)+(255*n|0)}_clamp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return"number"==typeof e?Math.min(Math.max(e,t),n):(e.forEach(((r,o)=>{e[o]=Math.min(Math.max(r,t),n)})),e)}};it.shared=new it,it.temp=new it,it.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let lt=it;function ct(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Se("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),lt.shared.setValue(e).toRgbArray(t)}function dt(e){return Se("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),lt.shared.setValue(e).toHex()}function ut(e){return Se("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),lt.shared.setValue(e).toNumber()}function ht(e){return Se("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),lt.shared.setValue(e).toNumber()}const pt=function(){const e=[],t=[];for(let r=0;r<32;r++)e[r]=r,t[r]=r;e[B.NORMAL_NPM]=B.NORMAL,e[B.ADD_NPM]=B.ADD,e[B.SCREEN_NPM]=B.SCREEN,t[B.NORMAL]=B.NORMAL_NPM,t[B.ADD]=B.ADD_NPM,t[B.SCREEN]=B.SCREEN_NPM;const n=[];return n.push(t),n.push(e),n}();function mt(e,t){return pt[t?1:0][e]}function ft(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Se("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),lt.shared.setValue(e).premultiply(t,r).toArray(n??new Float32Array(4))}function gt(e,t){return Se("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),lt.shared.setValue(e).toPremultiplied(t)}function yt(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Se("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),lt.shared.setValue(e).premultiply(t,r).toArray(n??new Float32Array(4))}const vt=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function bt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=6*e;if(t=t||new Uint16Array(n),t.length!==n)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${n}`);for(let r=0,o=0;r<n;r+=6,o+=4)t[r+0]=o+0,t[r+1]=o+1,t[r+2]=o+2,t[r+3]=o+0,t[r+4]=o+2,t[r+5]=o+3;return t}function xt(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}const wt={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function St(e,t){let n=0,r=0;const o={};for(let l=0;l<e.length;l++)r+=t[l],n+=e[l].length;const a=new ArrayBuffer(4*n);let s=null,i=0;for(let l=0;l<e.length;l++){const n=t[l],c=e[l],d=xt(c);o[d]||(o[d]=new wt[d](a)),s=o[d];for(let e=0;e<c.length;e++){s[(e/n|0)*r+i+e%n]=c[e]}i+=n}return new Float32Array(a)}function Tt(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}function Ct(e){return!(e&e-1)&&!!e}function kt(e){let t=(e>65535?1:0)<<4,n=((e>>>=t)>255?1:0)<<3;return t|=n,n=((e>>>=n)>15?1:0)<<2,t|=n,n=((e>>>=n)>3?1:0)<<1,t|=n,t|(e>>>=n)>>1}function At(e,t,n){const r=e.length;let o;if(t>=r||0===n)return;const a=r-(n=t+n>r?r-t:n);for(o=t;o<a;++o)e[o]=e[o+n];e.length=a}function It(e){return 0===e?0:e<0?-1:1}let Et=0;function Pt(){return++Et}const _t=class{constructor(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};_t.EMPTY=new _t(0,0,0,0);let Nt=_t;const Rt={},Mt=Object.create(null),jt=Object.create(null);function Dt(){let e;for(e in Mt)Mt[e].destroy();for(e in jt)jt[e].destroy()}function Ot(){let e;for(e in Mt)delete Mt[e];for(e in jt)delete jt[e]}class Bt{constructor(e,t,n){this._canvas=Q.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||Q.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Lt(e,t,n){for(let r=0,o=4*n*t;r<t;++r,o+=4)if(0!==e[o+3])return!1;return!0}function Ft(e,t,n,r,o){const a=4*t;for(let s=r,i=r*a+4*n;s<=o;++s,i+=a)if(0!==e[i+3])return!1;return!0}function $t(e){const{width:t,height:n}=e,r=e.getContext("2d",{willReadFrequently:!0});if(null===r)throw new TypeError("Failed to get canvas 2D context");const o=r.getImageData(0,0,t,n).data;let a=0,s=0,i=t-1,l=n-1;for(;s<n&&Lt(o,t,s);)++s;if(s===n)return Nt.EMPTY;for(;Lt(o,t,l);)--l;for(;Ft(o,t,a,s,l);)++a;for(;Ft(o,t,i,s,l);)--i;return++i,++l,new Nt(a,s,i,l)}function Gt(e){const t=$t(e),{width:n,height:r}=t;let o=null;if(!t.isEmpty()){const a=e.getContext("2d");if(null===a)throw new TypeError("Failed to get canvas 2D context");o=a.getImageData(t.left,t.top,n,r)}return{width:n,height:r,data:o}}function zt(e){const t=vt.exec(e);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function Ut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:globalThis.location;if(e.startsWith("data:"))return"";t=t||globalThis.location;const n=new URL(e,document.baseURI);return n.hostname!==t.hostname||n.port!==t.port||n.protocol!==t.protocol?"anonymous":""}function Ht(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=Q.RETINA_PREFIX?.exec(e);return n?parseFloat(n[1]):t}var qt=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(qt||{});const Vt=e=>{if("function"==typeof e||"object"==typeof e&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={..."object"!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if("object"!=typeof e)throw new Error("Invalid extension type");return"string"==typeof(e={...e}).type&&(e.type=[e.type]),e},Wt=(e,t)=>Vt(e).priority??t,Yt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(Vt).forEach((e=>{e.type.forEach((t=>this._removeHandlers[t]?.(e)))})),this},add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(Vt).forEach((e=>{e.type.forEach((t=>{const n=this._addHandlers,r=this._queue;n[t]?n[t]?.(e):(r[t]=r[t]||[],r[t]?.push(e))}))})),this},handle(e,t,n){const r=this._addHandlers,o=this._removeHandlers;if(r[e]||o[e])throw new Error(`Extension type ${e} already has a handler`);r[e]=t,o[e]=n;const a=this._queue;return a[e]&&(a[e]?.forEach((e=>t(e))),delete a[e]),this},handleByMap(e,t){return this.handle(e,(e=>{e.name&&(t[e.name]=e.ref)}),(e=>{e.name&&delete t[e.name]}))},handleByList(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return this.handle(e,(e=>{t.includes(e.ref)||(t.push(e.ref),t.sort(((e,t)=>Wt(t,n)-Wt(e,n))))}),(e=>{const n=t.indexOf(e.ref);-1!==n&&t.splice(n,1)}))}};class Kt{constructor(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const Xt=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Zt(e){let t="";for(let n=0;n<e;++n)n>0&&(t+="\nelse "),n<e-1&&(t+=`if(test == ${n}.0){}`);return t}class Jt{constructor(){this.data=0,this.blendMode=B.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==B.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new Jt;return e.depthTest=!1,e.blend=!0,e}}Jt.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Qt=[];function en(e,t){if(!e)return null;let n="";if("string"==typeof e){const t=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);t&&(n=t[1].toLowerCase())}for(let r=Qt.length-1;r>=0;--r){const o=Qt[r];if(o.test&&o.test(e,n))return new o(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class tn{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,n,r,o,a,s,i){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let d=0,u=c.length;d<u;d++)c[d][l](e,t,n,r,o,a,s,i);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return-1!==t&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(tn.prototype,{dispatch:{value:tn.prototype.emit},run:{value:tn.prototype.emit}});class nn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new tn("setRealSize"),this.onUpdate=new tn("update"),this.onError=new tn("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class rn extends nn{constructor(e,t){const{width:n,height:r}=t||{};if(!n||!r)throw new Error("BufferResource width or height invalid");super(n,r),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,n){const r=e.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===V.UNPACK);const o=t.realWidth,a=t.realHeight;return n.width===o&&n.height===a?r.texSubImage2D(t.target,0,0,0,o,a,t.format,n.type,this.data):(n.width=o,n.height=a,r.texImage2D(t.target,0,n.internalFormat,o,a,0,t.format,n.type,this.data)),!0}dispose(){this.data=null}static test(e){return null===e||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const on={scaleMode:U.NEAREST,alphaMode:V.NPM},an=class e extends ve{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),n=Object.assign({},e.defaultOptions,n);const{alphaMode:r,mipmap:o,anisotropicLevel:a,scaleMode:s,width:i,height:l,wrapMode:c,format:d,type:u,target:h,resolution:p,resourceOptions:m}=n;t&&!(t instanceof nn)&&(t=en(t,m),t.internal=!0),this.resolution=p||Q.RESOLUTION,this.width=Math.round((i||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=o,this.anisotropicLevel=a,this._wrapMode=c,this._scaleMode=s,this.format=d,this.type=u,this.target=h,this.alphaMode=r,this.uid=Pt(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=i>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let n;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,n=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,n=!0),n&&this.dirtyStyleId++,this}setSize(e,t,n){return n=n||this.resolution,this.setRealSize(e*n,t*n,n)}setRealSize(e,t,n){return this.resolution=n||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Ct(this.realWidth)&&Ct(this.realHeight)}setResolution(e){const t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT()),this}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete jt[this.cacheId],delete Mt[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.STRICT_TEXTURE_CACHE;const o="string"==typeof t;let a=null;if(o)a=t;else{if(!t._pixiId){const e=n?.pixiIdPrefix||"pixiid";t._pixiId=`${e}_${Pt()}`}a=t._pixiId}let s=jt[a];if(o&&r&&!s)throw new Error(`The cacheId "${a}" does not exist in BaseTextureCache.`);return s||(s=new e(t,n),s.cacheId=a,e.addToCache(s,a)),s}static fromBuffer(t,n,r,o){t=t||new Float32Array(n*r*4);const a=new rn(t,{width:n,height:r,...o?.resourceOptions});let s,i;return t instanceof Float32Array?(s=F.RGBA,i=G.FLOAT):t instanceof Int32Array?(s=F.RGBA_INTEGER,i=G.INT):t instanceof Uint32Array?(s=F.RGBA_INTEGER,i=G.UNSIGNED_INT):t instanceof Int16Array?(s=F.RGBA_INTEGER,i=G.SHORT):t instanceof Uint16Array?(s=F.RGBA_INTEGER,i=G.UNSIGNED_SHORT):t instanceof Int8Array?(s=F.RGBA,i=G.BYTE):(s=F.RGBA,i=G.UNSIGNED_BYTE),a.internal=!0,new e(a,Object.assign({},on,{type:i,format:s},o))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),jt[t]&&jt[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),jt[t]=e)}static removeFromCache(e){if("string"==typeof e){const t=jt[e];if(t){const n=t.textureCacheIds.indexOf(e);return n>-1&&t.textureCacheIds.splice(n,1),delete jt[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete jt[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};an.defaultOptions={mipmap:q.POW2,anisotropicLevel:0,scaleMode:U.LINEAR,wrapMode:H.CLAMP,alphaMode:V.UNPACK,target:$.TEXTURE_2D,format:F.RGBA,type:G.UNSIGNED_BYTE},an._globalBatch=0;let sn=an;class ln{constructor(){this.texArray=null,this.blend=0,this.type=L.TRIANGLES,this.start=0,this.size=0,this.data=null}}let cn=0;class dn{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=t,this.id=cn++,this.disposeRunner=new tn("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?J.ELEMENT_ARRAY_BUFFER:J.ARRAY_BUFFER}get index(){return this.type===J.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new dn(e)}}class un{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.FLOAT,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;this.buffer=e,this.size=t,this.normalized=n,this.type=r,this.stride=o,this.start=a,this.instance=s,this.divisor=i}destroy(){this.buffer=null}static from(e,t,n,r,o){return new un(e,t,n,r,o)}}const hn={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};const pn={5126:4,5123:2,5121:1};let mn=0;const fn={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};class gn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=mn++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new tn("disposeGeometry"),this.refCount=0}addAttribute(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof dn||(t instanceof Array&&(t=new Float32Array(t)),t=new dn(t));const l=e.split("|");if(l.length>1){for(let e=0;e<l.length;e++)this.addAttribute(l[e],t,n,r,o);return this}let c=this.buffers.indexOf(t);return-1===c&&(this.buffers.push(t),c=this.buffers.length-1),this.attributes[e]=new un(c,n,r,o,a,s,i),this.instanced=this.instanced||i,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof dn||(e instanceof Array&&(e=new Uint16Array(e)),e=new dn(e)),e.type=J.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const e=[],t=[],n=new dn;let r;for(r in this.attributes){const n=this.attributes[r],o=this.buffers[n.buffer];e.push(o.data),t.push(n.size*pn[n.type]/4),n.buffer=0}for(n.data=function(e,t){let n=0,r=0;const o={};for(let l=0;l<e.length;l++)r+=t[l],n+=e[l].length;const a=new ArrayBuffer(4*n);let s=null,i=0;for(let l=0;l<e.length;l++){const n=t[l],c=e[l],d=xt(c);o[d]||(o[d]=new hn[d](a)),s=o[d];for(let e=0;e<c.length;e++)s[(e/n|0)*r+i+e%n]=c[e];i+=n}return new Float32Array(a)}(e,t),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new gn;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new dn(this.buffers[t].data.slice(0));for(const t in this.attributes){const n=this.attributes[t];e.attributes[t]=new un(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=J.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new gn,n=[],r=[],o=[];let a;for(let s=0;s<e.length;s++){a=e[s];for(let e=0;e<a.buffers.length;e++)r[e]=r[e]||0,r[e]+=a.buffers[e].data.length,o[e]=0}for(let s=0;s<a.buffers.length;s++)n[s]=new(fn[xt(a.buffers[s].data)])(r[s]),t.buffers[s]=new dn(n[s]);for(let s=0;s<e.length;s++){a=e[s];for(let e=0;e<a.buffers.length;e++)n[e].set(a.buffers[e].data,o[e]),o[e]+=a.buffers[e].data.length}if(t.attributes=a.attributes,a.indexBuffer){t.indexBuffer=t.buffers[a.buffers.indexOf(a.indexBuffer)],t.indexBuffer.type=J.ELEMENT_ARRAY_BUFFER;let n=0,r=0,o=0,s=0;for(let e=0;e<a.buffers.length;e++)if(a.buffers[e]!==a.indexBuffer){s=e;break}for(const e in a.attributes){const t=a.attributes[e];(0|t.buffer)===s&&(r+=t.size*pn[t.type]/4)}for(let a=0;a<e.length;a++){const i=e[a].indexBuffer.data;for(let e=0;e<i.length;e++)t.indexBuffer.data[e+o]+=n;n+=e[a].buffers[s].data.length/r,o+=i.length}}return t}}class yn extends gn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(),this._buffer=new dn(null,e,!1),this._indexBuffer=new dn(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,G.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,G.FLOAT).addAttribute("aColor",this._buffer,4,!0,G.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,G.FLOAT).addIndex(this._indexBuffer)}}const vn=2*Math.PI,bn=180/Math.PI,xn=Math.PI/180;var wn=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(wn||{});class Sn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Sn(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.x=e,this.y=t,this}}Sn.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Tn=[new Sn,new Sn,new Sn,new Sn];class Cn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=Number(e),this.y=Number(t),this.width=Number(n),this.height=Number(r),this.type=wn.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Cn(0,0,0,0)}clone(){return new Cn(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return!(this.width<=0||this.height<=0)&&(e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height)}intersects(e,t){if(!t){const t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;const n=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>n}const n=this.left,r=this.right,o=this.top,a=this.bottom;if(r<=n||a<=o)return!1;const s=Tn[0].set(e.left,e.top),i=Tn[1].set(e.left,e.bottom),l=Tn[2].set(e.right,e.top),c=Tn[3].set(e.right,e.bottom);if(l.x<=s.x||i.y<=s.y)return!1;const d=Math.sign(t.a*t.d-t.b*t.c);if(0===d||(t.apply(s,s),t.apply(i,i),t.apply(l,l),t.apply(c,c),Math.max(s.x,i.x,l.x,c.x)<=n||Math.min(s.x,i.x,l.x,c.x)>=r||Math.max(s.y,i.y,l.y,c.y)<=o||Math.min(s.y,i.y,l.y,c.y)>=a))return!1;const u=d*(i.y-s.y),h=d*(s.x-i.x),p=u*n+h*o,m=u*r+h*o,f=u*n+h*a,g=u*r+h*a;if(Math.max(p,m,f,g)<=u*s.x+h*s.y||Math.min(p,m,f,g)>=u*c.x+h*c.y)return!1;const y=d*(s.y-l.y),v=d*(l.x-s.x),b=y*n+v*o,x=y*r+v*o,w=y*n+v*a,S=y*r+v*a;return!(Math.max(b,x,w,S)<=y*s.x+v*s.y||Math.min(b,x,w,S)>=y*c.x+v*c.y)}pad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){const t=Math.max(this.x,e.x),n=Math.min(this.x+this.width,e.x+e.width),r=Math.max(this.y,e.y),o=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(n-t,0),this.y=r,this.height=Math.max(o-r,0),this}ceil(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;const n=Math.ceil((this.x+this.width-t)*e)/e,r=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=n-this.x,this.height=r-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),n=Math.max(this.x+this.width,e.x+e.width),r=Math.min(this.y,e.y),o=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=n-t,this.y=r,this.height=o-r,this}}Cn.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class kn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=e,this.y=t,this.radius=n,this.type=wn.CIRC}clone(){return new kn(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const n=this.radius*this.radius;let r=this.x-e,o=this.y-t;return r*=r,o*=o,r+o<=n}getBounds(){return new Cn(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}kn.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class An{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=e,this.y=t,this.width=n,this.height=r,this.type=wn.ELIP}clone(){return new An(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let n=(e-this.x)/this.width,r=(t-this.y)/this.height;return n*=n,r*=r,n+r<=1}getBounds(){return new Cn(this.x-this.width,this.y-this.height,this.width,this.height)}}An.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class In{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=Array.isArray(t[0])?t[0]:t;if("number"!=typeof r[0]){const e=[];for(let t=0,n=r.length;t<n;t++)e.push(r[t].x,r[t].y);r=e}this.points=r,this.type=wn.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new In(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let n=!1;const r=this.points.length/2;for(let o=0,a=r-1;o<r;a=o++){const r=this.points[2*o],s=this.points[2*o+1],i=this.points[2*a],l=this.points[2*a+1];s>t!=l>t&&e<(t-s)/(l-s)*(i-r)+r&&(n=!n)}return n}}In.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((e,t)=>`${e}, ${t}`),"")}]`};class En{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;this.x=e,this.y=t,this.width=n,this.height=r,this.radius=o,this.type=wn.RREC}clone(){return new En(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+n&&t<=this.y+this.height-n||e>=this.x+n&&e<=this.x+this.width-n)return!0;let r=e-(this.x+n),o=t-(this.y+n);const a=n*n;if(r*r+o*o<=a||(r=e-(this.x+this.width-n),r*r+o*o<=a)||(o=t-(this.y+this.height-n),r*r+o*o<=a)||(r=e-(this.x+n),r*r+o*o<=a))return!0}return!1}}En.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Pn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.array=null,this.a=e,this.b=t,this.c=n,this.d=r,this.tx=o,this.ty=a}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,n,r,o,a){return this.a=e,this.b=t,this.c=n,this.d=r,this.tx=o,this.ty=a,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const n=t||this.array;return e?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(e,t){t=t||new Sn;const n=e.x,r=e.y;return t.x=this.a*n+this.c*r+this.tx,t.y=this.b*n+this.d*r+this.ty,t}applyInverse(e,t){t=t||new Sn;const n=1/(this.a*this.d+this.c*-this.b),r=e.x,o=e.y;return t.x=this.d*n*r+-this.c*n*o+(this.ty*this.c-this.tx*this.d)*n,t.y=this.a*n*o+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.a,o=this.c,a=this.tx;return this.a=r*t-this.b*n,this.b=r*n+this.b*t,this.c=o*t-this.d*n,this.d=o*n+this.d*t,this.tx=a*t-this.ty*n,this.ty=a*n+this.ty*t,this}append(e){const t=this.a,n=this.b,r=this.c,o=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*n+e.b*o,this.c=e.c*t+e.d*r,this.d=e.c*n+e.d*o,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*n+e.ty*o+this.ty,this}setTransform(e,t,n,r,o,a,s,i,l){return this.a=Math.cos(s+l)*o,this.b=Math.sin(s+l)*o,this.c=-Math.sin(s-i)*a,this.d=Math.cos(s-i)*a,this.tx=e-(n*this.a+r*this.c),this.ty=t-(n*this.b+r*this.d),this}prepend(e){const t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){const t=this.a,n=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,n=this.b,r=this.c,o=this.d,a=e.pivot,s=-Math.atan2(-r,o),i=Math.atan2(n,t),l=Math.abs(s+i);return l<1e-5||Math.abs(vn-l)<1e-5?(e.rotation=i,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=s,e.skew.y=i),e.scale.x=Math.sqrt(t*t+n*n),e.scale.y=Math.sqrt(r*r+o*o),e.position.x=this.tx+(a.x*t+a.y*r),e.position.y=this.ty+(a.x*n+a.y*o),e}invert(){const e=this.a,t=this.b,n=this.c,r=this.d,o=this.tx,a=e*r-t*n;return this.a=r/a,this.b=-t/a,this.c=-n/a,this.d=e/a,this.tx=(n*this.ty-r*o)/a,this.ty=-(e*this.ty-t*o)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Pn;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new Pn}static get TEMP_MATRIX(){return new Pn}}Pn.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const _n=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Nn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Rn=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Mn=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],jn=[],Dn=[],On=Math.sign;!function(){for(let e=0;e<16;e++){const t=[];jn.push(t);for(let n=0;n<16;n++){const r=On(_n[e]*_n[n]+Rn[e]*Nn[n]),o=On(Nn[e]*_n[n]+Mn[e]*Nn[n]),a=On(_n[e]*Rn[n]+Rn[e]*Mn[n]),s=On(Nn[e]*Rn[n]+Mn[e]*Mn[n]);for(let e=0;e<16;e++)if(_n[e]===r&&Nn[e]===o&&Rn[e]===a&&Mn[e]===s){t.push(e);break}}}for(let e=0;e<16;e++){const t=new Pn;t.set(_n[e],Nn[e],Rn[e],Mn[e],0,0),Dn.push(t)}}();const Bn={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>_n[e],uY:e=>Nn[e],vX:e=>Rn[e],vY:e=>Mn[e],inv:e=>8&e?15&e:7&-e,add:(e,t)=>jn[e][t],sub:(e,t)=>jn[e][Bn.inv(t)],rotate180:e=>4^e,isVertical:e=>2===(3&e),byDirection:(e,t)=>2*Math.abs(e)<=Math.abs(t)?t>=0?Bn.S:Bn.N:2*Math.abs(t)<=Math.abs(e)?e>0?Bn.E:Bn.W:t>0?e>0?Bn.SE:Bn.SW:e>0?Bn.NE:Bn.NW,matrixAppendRotationInv:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=Dn[Bn.inv(t)];o.tx=n,o.ty=r,e.append(o)}};class Ln{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._x=n,this._y=r,this.cb=e,this.scope=t}clone(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cb,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scope;return new Ln(e,t,this._x,this._y)}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}Ln.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Fn=class{constructor(){this.worldTransform=new Pn,this.localTransform=new Pn,this.position=new Ln(this.onChange,this,0,0),this.scale=new Ln(this.onChange,this,1,1),this.pivot=new Ln(this.onChange,this,0,0),this.skew=new Ln(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const n=e.worldTransform,r=this.worldTransform;r.a=t.a*n.a+t.b*n.c,r.b=t.a*n.b+t.b*n.d,r.c=t.c*n.a+t.d*n.c,r.d=t.c*n.b+t.d*n.d,r.tx=t.tx*n.a+t.ty*n.c+n.tx,r.ty=t.tx*n.b+t.ty*n.d+n.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};Fn.IDENTITY=new Fn;let $n=Fn;$n.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};const Gn=[{test:e=>"float"===e.type&&1===e.size&&!e.isArray,code:e=>`\n            if(uv["${e}"] !== ud["${e}"].value)\n            {\n                ud["${e}"].value = uv["${e}"]\n                gl.uniform1f(ud["${e}"].location, uv["${e}"])\n            }\n            `},{test:(e,t)=>("sampler2D"===e.type||"samplerCube"===e.type||"sampler2DArray"===e.type)&&1===e.size&&!e.isArray&&(null==t||void 0!==t.castToBaseTexture),code:e=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${e}"], t);\n\n            if(ud["${e}"].value !== t)\n            {\n                ud["${e}"].value = t;\n                gl.uniform1i(ud["${e}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(e,t)=>"mat3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.a,code:e=>`\n            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));\n            `,codeUbo:e=>`\n                var ${e}_matrix = uv.${e}.toArray(true);\n\n                data[offset] = ${e}_matrix[0];\n                data[offset+1] = ${e}_matrix[1];\n                data[offset+2] = ${e}_matrix[2];\n        \n                data[offset + 4] = ${e}_matrix[3];\n                data[offset + 5] = ${e}_matrix[4];\n                data[offset + 6] = ${e}_matrix[5];\n        \n                data[offset + 8] = ${e}_matrix[6];\n                data[offset + 9] = ${e}_matrix[7];\n                data[offset + 10] = ${e}_matrix[8];\n            `},{test:(e,t)=>"vec2"===e.type&&1===e.size&&!e.isArray&&void 0!==t.x,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${e}"].location, v.x, v.y);\n                }`,codeUbo:e=>`\n                v = uv.${e};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:e=>"vec2"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);\n                }\n            `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.width,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(e,t)=>"vec3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:e=>"vec4"===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])\n                }`}],zn={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Un={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const Hn={};let qn,Vn=Hn;function Wn(){if(!qn){qn=K.MEDIUM;const e=function(){if(Vn===Hn||Vn?.isContextLost()){const e=Q.ADAPTER.createCanvas();let t;Q.PREFER_ENV>=j.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Vn=t}return Vn}();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);t&&(qn=t.precision?K.HIGH:K.MEDIUM)}}return qn}const Yn={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Kn(e){return Yn[e]}let Xn=null;const Zn={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Jn(e,t){if(!Xn){const t=Object.keys(Zn);Xn={};for(let n=0;n<t.length;++n){const r=t[n];Xn[e[r]]=Zn[r]}}return Xn[t]}function Qn(e,t,n){if("precision"!==e.substring(0,9)){let r=t;return t===K.HIGH&&n!==K.HIGH&&(r=K.MEDIUM),`precision ${r} float;\n${e}`}return n!==K.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}let er=0;const tr={},nr=class e{constructor(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"pixi-shader",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.extra={},this.id=er++,this.vertexSrc=t||e.defaultVertexSrc,this.fragmentSrc=n||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=o,"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),tr[r]?(tr[r]++,r+=`-${tr[r]}`):tr[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}\n${this.fragmentSrc}`,this.vertexSrc=Qn(this.vertexSrc,e.defaultVertexPrecision,K.HIGH),this.fragmentSrc=Qn(this.fragmentSrc,e.defaultFragmentPrecision,Wn())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,n,r){const o=t+n;let a=Rt[o];return a||(Rt[o]=a=new e(t,n,r)),a}};nr.defaultVertexPrecision=K.HIGH,nr.defaultFragmentPrecision=ye.apple.device?K.HIGH:K.MEDIUM;let rr=nr,or=0;class ar{constructor(e,t,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=or++,this.static=!!t,this.ubo=!!n,e instanceof dn?(this.buffer=e,this.buffer.type=J.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new dn(new Float32Array(1)),this.buffer.type=J.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,n){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new ar(t,n)}static from(e,t,n){return new ar(e,t,n)}static uboFrom(e,t){return new ar(e,t??!0,!0)}}class sr{constructor(e,t){this.uniformBindCount=0,this.program=e,this.uniformGroup=t?t instanceof ar?t:new ar(t):new ar({}),this.disposeRunner=new tn("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const n in t.uniforms){const r=t.uniforms[n];if(!0===r.group&&this.checkUniformExists(e,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,n){const r=rr.from(e,t);return new sr(r,n)}}class ir{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=r;this.defaultGroupCache[e]=ar.from({uSamplers:t},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${e}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new rr(this.vertexSrc,n)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new Pn,default:this.defaultGroupCache[e]};return new sr(this.programCache[e],t)}generateSampleSrc(e){let t="";t+="\n",t+="\n";for(let n=0;n<e;n++)n>0&&(t+="\nelse "),n<e-1&&(t+=`if(vTextureId < ${n}.5)`),t+="\n{",t+=`\n\tcolor = texture2D(uSamplers[${n}], vTextureCoord);`,t+="\n}";return t+="\n",t+="\n",t}}class lr{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class cr{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}const dr=class e extends cr{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=yn,this.vertexSize=6,this.state=Jt.for2d(),this.size=4*e.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(e){let t=!0;const n=Q.ADAPTER.getNavigator();if(ye.tablet||ye.phone){if(ye.apple.device){const e=n.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(ye.android.device){const e=n.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?e:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!ye.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Se("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator(){let{vertex:t=e.defaultVertexSrc,fragment:n=e.defaultFragmentTemplate}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.shaderGenerator=new ir(t,n)}contextChange(){const t=this.renderer.gl;Q.PREFER_ENV===j.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),e.defaultMaxTextures),this.maxTextures=function(e,t){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const n=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=Xt.replace(/%forloop%/gi,Zt(e));if(t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))break;e=e/2|0}return e}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:n}=e,r=this.size/4,o=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new ln);for(;n.length<o;)n.push(new lr);for(let e=0;e<this.maxTextures;e++)this._tempBoundTextures[e]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:n}=this,r=e._textureArrayPool,o=this.renderer.batch,a=this._tempBoundTextures,s=this.renderer.textureGC.count;let i=++sn._globalBatch,l=0,c=r[0],d=0;o.copyBoundTextures(a,n);for(let e=0;e<this._bufferSize;++e){const u=t[e];t[e]=null,u._batchEnabled!==i&&(c.count>=n&&(o.boundArray(c,a,i,n),this.buildDrawCalls(c,d,e),d=e,c=r[++l],++i),u._batchEnabled=i,u.touched=s,c.elements[c.count++]=u)}c.count>0&&(o.boundArray(c,a,i,n),this.buildDrawCalls(c,d,this._bufferSize),++l,++i);for(let e=0;e<a.length;e++)a[e]=null;sn._globalBatch=i}buildDrawCalls(t,n,r){const{_bufferedElements:o,_attributeBuffer:a,_indexBuffer:s,vertexSize:i}=this,l=e._drawCallPool;let c=this._dcIndex,d=this._aIndex,u=this._iIndex,h=l[c];h.start=this._iIndex,h.texArray=t;for(let e=n;e<r;++e){const r=o[e],p=r._texture.baseTexture,m=pt[p.alphaMode?1:0][r.blendMode];o[e]=null,n<e&&h.blend!==m&&(h.size=u-h.start,n=e,h=l[++c],h.texArray=t,h.start=u),this.packInterleavedGeometry(r,a,s,d,u),d+=r.vertexData.length/2*i,u+=r.indices.length,h.blend=m}n<r&&(h.size=u-h.start,++c),this._dcIndex=c,this._aIndex=d,this._iIndex=u}bindAndClearTexArray(e){const t=this.renderer.texture;for(let n=0;n<e.count;n++)t.bind(e.elements[n],e.ids[n]),e.elements[n]=null;e.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:n,_indexBuffer:r}=this;e.canUploadSameBuffer?(t[this._flushId]._buffer.update(n.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(n.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:n,state:r}=this.renderer,o=e._drawCallPool;let a=null;for(let e=0;e<t;e++){const{texArray:t,type:s,size:i,start:l,blend:c}=o[e];a!==t&&(a=t,this.bindAndClearTexArray(t)),this.state.blendMode=c,r.set(this.state),n.drawElements(s,i,n.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),e.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Tt(Math.ceil(e/8)),n=kt(t),r=8*t;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);let o=this._aBuffers[r];return o||(this._aBuffers[r]=o=new Kt(r*this.vertexSize*4)),o}getIndexBuffer(e){const t=Tt(Math.ceil(e/12)),n=kt(t),r=12*t;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);let o=this._iBuffers[n];return o||(this._iBuffers[n]=o=new Uint16Array(r)),o}packInterleavedGeometry(e,t,n,r,o){const{uint32View:a,float32View:s}=t,i=r/this.vertexSize,l=e.uvs,c=e.indices,d=e.vertexData,u=e._texture.baseTexture._batchLocation,h=Math.min(e.worldAlpha,1),p=lt.shared.setValue(e._tintRGB).toPremultiplied(h,e._texture.baseTexture.alphaMode>0);for(let m=0;m<d.length;m+=2)s[r++]=d[m],s[r++]=d[m+1],s[r++]=l[m],s[r++]=l[m+1],a[r++]=p,s[r++]=u;for(let m=0;m<c.length;m++)n[o++]=i+c[m]}};dr.defaultBatchSize=4096,dr.extension={name:"batch",type:qt.RendererPlugin},dr._drawCallPool=[],dr._textureArrayPool=[];let ur=dr;Yt.add(ur);const hr=class e extends sr{constructor(t,n,r){super(rr.from(t||e.defaultVertexSrc,n||e.defaultFragmentSrc),r),this.padding=0,this.resolution=e.defaultResolution,this.multisample=e.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Jt}apply(e,t,n,r,o){e.applyFilter(this,t,n,r)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};hr.defaultResolution=1,hr.defaultMultisample=Z.NONE;let pr=hr;class mr{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new lt(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:n,backgroundAlpha:r}=e,o=n??t;void 0!==o&&(this.color=o),this.alpha=r}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}mr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},mr.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"background"},Yt.add(mr);class fr{constructor(e){this.renderer=e,this.emptyRenderer=new cr(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:n}=this.renderer.texture;for(let r=t-1;r>=0;--r)e[r]=n[r]||null,e[r]&&(e[r]._batchLocation=r)}boundArray(e,t,n,r){const{elements:o,ids:a,count:s}=e;let i=0;for(let l=0;l<s;l++){const e=o[l],s=e._batchLocation;if(s>=0&&s<r&&t[s]===e)a[l]=s;else for(;i<r;){const r=t[i];if(!r||r._batchEnabled!==n||r._batchLocation!==i){a[l]=i,e._batchLocation=i,t[i]=e;break}i++}}}destroy(){this.renderer=null}}fr.extension={type:qt.RendererSystem,name:"batch"},Yt.add(fr);let gr=0;class yr{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=gr++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,n=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:n,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=gr++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;void 0!==t.addEventListener&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let n;if(Q.PREFER_ENV>=j.WEBGL2&&(n=e.getContext("webgl2",t)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};1===this.webGLVersion?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,void 0!==e.removeEventListener&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=n||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}yr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},yr.extension={type:qt.RendererSystem,name:"context"},Yt.add(yr);class vr{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new tn("disposeFramebuffer"),this.multisample=Z.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return this.colorTextures[e]=t||new sn(null,{scaleMode:U.NEAREST,resolution:1,mipmap:q.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new sn(null,{scaleMode:U.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:q.OFF,format:F.DEPTH_COMPONENT,type:G.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const r=this.colorTextures[n],o=r.resolution;r.setSize(e/o,t/o)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(e/n,t/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class br extends sn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("number"==typeof e){e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=Z.NONE),super(null,e),this.mipmap=q.OFF,this.valid=!0,this._clear=new lt([0,0,0,0]),this.framebuffer=new vr(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class xr extends nn{constructor(e){const t=e;super(t.naturalWidth||t.videoWidth||t.displayWidth||t.width,t.naturalHeight||t.videoHeight||t.displayHeight||t.height),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,n){void 0!==n||t.startsWith("data:")?!1!==n&&(e.crossOrigin="string"==typeof n?n:"anonymous"):e.crossOrigin=Ut(t)}upload(e,t,n,r){const o=e.gl,a=t.realWidth,s=t.realHeight;if(r=r||this.source,typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement){if(!r.complete||0===r.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement&&r.readyState<=1)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===V.UNPACK),this.noSubImage||t.target!==o.TEXTURE_2D||n.width!==a||n.height!==s?(n.width=a,n.height=s,o.texImage2D(t.target,0,n.internalFormat,t.format,n.type,r)):o.texSubImage2D(o.TEXTURE_2D,0,0,0,t.format,n.type,r),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;this.resize(t,n),super.update()}dispose(){this.source=null}}class wr extends xr{constructor(e,t){if(t=t||{},"string"==typeof e){const n=new Image;xr.crossOrigin(n,e,t.crossorigin),n.src=e,e=n}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??Q.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.bitmap=null,this._load=null,!1!==t.autoLoad&&this.load()}load(e){return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise(((e,t)=>{const n=this.source;this.url=n.src;const r=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?r():(n.onload=r,n.onerror=e=>{t(e),this.onError.emit(e)})}))),this._load}process(){const e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,n=!e.crossOrigin||"anonymous"===e.crossOrigin;return this._process=fetch(e.src,{mode:n?"cors":"no-cors"}).then((e=>e.blob())).then((n=>t(n,0,0,e.width,e.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===V.UNPACK?"premultiply":"none"}))).then((e=>this.destroyed?Promise.reject():(this.bitmap=e,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(e,t,n){if("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,n,this.bitmap),!this.preserveBitmap){let e=!0;const r=t._glTextures;for(const o in r){const a=r[o];if(a!==n&&a.dirtyId!==t.dirtyId){e=!1;break}}e&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&("string"==typeof e||e instanceof HTMLImageElement)}}class Sr{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,n){const r=t.width,o=t.height;if(n){const t=e.width/2/r,a=e.height/2/o,s=e.x/r+t,i=e.y/o+a;n=Bn.add(n,Bn.NW),this.x0=s+t*Bn.uX(n),this.y0=i+a*Bn.uY(n),n=Bn.add(n,2),this.x1=s+t*Bn.uX(n),this.y1=i+a*Bn.uY(n),n=Bn.add(n,2),this.x2=s+t*Bn.uX(n),this.y2=i+a*Bn.uY(n),n=Bn.add(n,2),this.x3=s+t*Bn.uX(n),this.y3=i+a*Bn.uY(n)}else this.x0=e.x/r,this.y0=e.y/o,this.x1=(e.x+e.width)/r,this.y1=e.y/o,this.x2=(e.x+e.width)/r,this.y2=(e.y+e.height)/o,this.x3=e.x/r,this.y3=(e.y+e.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Sr.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Tr=new Sr;function Cr(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class kr extends ve{constructor(e,t,n,r,o,a,s){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new Cn(0,0,1,1)),e instanceof kr&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=r,this.valid=!1,this.destroyed=!1,this._uvs=Tr,this.uvMatrix=null,this.orig=n||t,this._rotate=Number(o||0),!0===o)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Sn(a.x,a.y):new Sn(0,0),this.defaultBorders=s,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:e}=this.baseTexture;e?.url&&Mt[e.url]&&kr.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,kr.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),n=new kr(this.baseTexture,!this.noFrame&&e,t,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=e),n}updateUvs(){this._uvs===Tr&&(this._uvs=new Sr),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.STRICT_TEXTURE_CACHE;const r="string"==typeof e;let o=null;if(r)o=e;else if(e instanceof sn){if(!e.cacheId){const n=t?.pixiIdPrefix||"pixiid";e.cacheId=`${n}-${Pt()}`,sn.addToCache(e,e.cacheId)}o=e.cacheId}else{if(!e._pixiId){const n=t?.pixiIdPrefix||"pixiid";e._pixiId=`${n}_${Pt()}`}o=e._pixiId}let a=Mt[o];if(r&&n&&!a)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return a||e instanceof sn?!a&&e instanceof sn&&(a=new kr(e),kr.addToCache(a,o)):(t.resolution||(t.resolution=Ht(e)),a=new kr(new sn(e,t)),a.baseTexture.cacheId=o,sn.addToCache(a.baseTexture,o),kr.addToCache(a,o)),a}static fromURL(e,t){const n=Object.assign({autoLoad:!1},t?.resourceOptions),r=kr.from(e,Object.assign({resourceOptions:n},t),!1),o=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):o.load().then((()=>Promise.resolve(r)))}static fromBuffer(e,t,n,r){return new kr(sn.fromBuffer(e,t,n,r))}static fromLoader(e,t,n,r){const o=new sn(e,Object.assign({scaleMode:sn.defaultOptions.scaleMode,resolution:Ht(t)},r)),{resource:a}=o;a instanceof wr&&(a.url=t);const s=new kr(o);return n||(n=t),sn.addToCache(s.baseTexture,n),kr.addToCache(s,n),n!==t&&(sn.addToCache(s.baseTexture,t),kr.addToCache(s,t)),s.baseTexture.valid?Promise.resolve(s):new Promise((e=>{s.baseTexture.once("loaded",(()=>e(s)))}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Mt[t]&&Mt[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),Mt[t]=e)}static removeFromCache(e){if("string"==typeof e){const t=Mt[e];if(t){const n=t.textureCacheIds.indexOf(e);return n>-1&&t.textureCacheIds.splice(n,1),delete Mt[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)Mt[e.textureCacheIds[t]]===e&&delete Mt[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:n,width:r,height:o}=e,a=t+r>this.baseTexture.width,s=n+o>this.baseTexture.height;if(a||s){const e=a&&s?"and":"or",i=`X: ${t} + ${r} = ${t+r} > ${this.baseTexture.width}`,l=`Y: ${n} + ${o} = ${n+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${i} ${e} ${l}`)}this.valid=r&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return kr._EMPTY||(kr._EMPTY=new kr(new sn),Cr(kr._EMPTY),Cr(kr._EMPTY.baseTexture)),kr._EMPTY}static get WHITE(){if(!kr._WHITE){const e=Q.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),kr._WHITE=new kr(sn.from(e)),Cr(kr._WHITE),Cr(kr._WHITE.baseTexture)}return kr._WHITE}}class Ar extends kr{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=this.baseTexture.resolution,o=Math.round(e*r)/r,a=Math.round(t*r)/r;this.valid=o>0&&a>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=a,n&&this.baseTexture.resize(o,a),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Ar(new br(e))}}class Ir{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z.NONE;const r=new br(Object.assign({width:e,height:t,resolution:1,multisample:n},this.textureOptions));return new Ar(r)}getOptimalTexture(e,t){let n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.NONE;e=Math.max(Math.ceil(e*r-1e-6),1),t=Math.max(Math.ceil(t*r-1e-6),1),this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight?n=o>1?-o:-1:(n=((65535&(e=Tt(e)))<<16|65535&(t=Tt(t)))>>>0,o>1&&(n+=4294967296*o)),this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(e,t,o)),a.filterPoolKey=n,a.setResolution(r),a}getFilterTexture(e,t,n){const r=this.getOptimalTexture(e.width,e.height,t||e.resolution,n||Z.NONE);return r.filterFrame=e.filterFrame,r}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Ir.SCREEN_KEY=-1;class Er extends gn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Pr extends gn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new dn(this.vertices),this.uvBuffer=new dn(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+t.width/e.width,this.uvs[3]=r,this.uvs[4]=n+t.width/e.width,this.uvs[5]=r+t.height/e.height,this.uvs[6]=n,this.uvs[7]=r+t.height/e.height,n=t.x,r=t.y,this.vertices[0]=n,this.vertices[1]=r,this.vertices[2]=n+t.width,this.vertices[3]=r,this.vertices[4]=n+t.width,this.vertices[5]=r+t.height,this.vertices[6]=n,this.vertices[7]=r+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class _r{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Z.NONE,this.sourceFrame=new Cn,this.destinationFrame=new Cn,this.bindingSourceFrame=new Cn,this.bindingDestinationFrame=new Cn,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Nr=[new Sn,new Sn,new Sn,new Sn],Rr=new Pn;class Mr{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Ir,this.statePool=[],this.quad=new Er,this.quadUv=new Pr,this.tempRect=new Cn,this.activeState={},this.globalUniforms=new ar({outputFrame:new Cn,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const n=this.renderer,r=this.defaultFilterStack,o=this.statePool.pop()||new _r,a=n.renderTexture;let s,i;if(a.current){const e=a.current;s=e.resolution,i=e.multisample}else s=n.resolution,i=n.multisample;let l=t[0].resolution||s,c=t[0].multisample??i,d=t[0].padding,u=t[0].autoFit,h=t[0].legacy??!0;for(let f=1;f<t.length;f++){const e=t[f];l=Math.min(l,e.resolution||s),c=Math.min(c,e.multisample??i),d=this.useMaxPadding?Math.max(d,e.padding):d+e.padding,u=u&&e.autoFit,h=h||(e.legacy??!0)}1===r.length&&(this.defaultFilterStack[0].renderTexture=a.current),r.push(o),o.resolution=l,o.multisample=c,o.legacy=h,o.target=e,o.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),o.sourceFrame.pad(d);const p=this.tempRect.copyFrom(a.sourceFrame);n.projection.transform&&this.transformAABB(Rr.copyFrom(n.projection.transform).invert(),p),u?(o.sourceFrame.fit(p),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(p)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,a.current?a.current.resolution:n.resolution,a.sourceFrame,a.destinationFrame,n.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,l,c),o.filters=t,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;const m=this.tempRect;m.x=0,m.y=0,m.width=o.sourceFrame.width,m.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(a.sourceFrame),o.bindingDestinationFrame.copyFrom(a.destinationFrame),o.transform=n.projection.transform,n.projection.transform=null,a.bind(o.renderTexture,o.sourceFrame,m),n.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),n=t.filters;this.activeState=t;const r=this.globalUniforms.uniforms;r.outputFrame=t.sourceFrame,r.resolution=t.resolution;const o=r.inputSize,a=r.inputPixel,s=r.inputClamp;if(o[0]=t.destinationFrame.width,o[1]=t.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],a[0]=Math.round(o[0]*t.resolution),a[1]=Math.round(o[1]*t.resolution),a[2]=1/a[0],a[3]=1/a[1],s[0]=.5*a[2],s[1]=.5*a[3],s[2]=t.sourceFrame.width*o[2]-.5*a[2],s[3]=t.sourceFrame.height*o[3]-.5*a[3],t.legacy){const e=r.filterArea;e[0]=t.destinationFrame.width,e[1]=t.destinationFrame.height,e[2]=t.sourceFrame.x,e[3]=t.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const i=e[e.length-1];if(this.renderer.framebuffer.blit(),1===n.length)n[0].apply(this,t.renderTexture,i.renderTexture,W.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let e=t.renderTexture,r=this.getOptimalFilterTexture(e.width,e.height,t.resolution);r.filterFrame=e.filterFrame;let o=0;for(o=0;o<n.length-1;++o){1===o&&t.multisample>1&&(r=this.getOptimalFilterTexture(e.width,e.height,t.resolution),r.filterFrame=e.filterFrame),n[o].apply(this,e,r,W.CLEAR,t);const a=e;e=r,r=a}n[o].apply(this,e,i.renderTexture,W.BLEND,t),o>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(e),this.returnFilterTexture(r)}t.clear(),this.statePool.push(t)}bindAndClear(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.CLEAR;const{renderTexture:n,state:r}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const t=this.tempRect;t.x=0,t.y=0,t.width=e.filterFrame.width,t.height=e.filterFrame.height,n.bind(e,e.filterFrame,t)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const o=1&r.stateId||this.forceClear;(t===W.CLEAR||t===W.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,n,r){const o=this.renderer;o.state.set(e.state),this.bindAndClear(n,r),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(L.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(L.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:n,destinationFrame:r}=this.activeState,{orig:o}=t._texture,a=e.set(r.width,0,0,r.height,n.x,n.y),s=t.worldTransform.copyTo(Pn.TEMP_MATRIX);return s.invert(),a.prepend(s),a.scale(1/o.width,1/o.height),a.translate(t.anchor.x,t.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.NONE;return this.texturePool.getOptimalTexture(e,t,n,r)}getFilterTexture(e,t,n){if("number"==typeof e){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,n||Z.NONE);return r.filterFrame=e.filterFrame,r}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const n=Nr[0],r=Nr[1],o=Nr[2],a=Nr[3];n.set(t.left,t.top),r.set(t.left,t.bottom),o.set(t.right,t.top),a.set(t.right,t.bottom),e.apply(n,n),e.apply(r,r),e.apply(o,o),e.apply(a,a);const s=Math.min(n.x,r.x,o.x,a.x),i=Math.min(n.y,r.y,o.y,a.y),l=Math.max(n.x,r.x,o.x,a.x),c=Math.max(n.y,r.y,o.y,a.y);t.x=s,t.y=i,t.width=l-s,t.height=c-i}roundFrame(e,t,n,r,o){if(!(e.width<=0||e.height<=0||n.width<=0||n.height<=0)){if(o){const{a:e,b:t,c:n,d:r}=o;if((Math.abs(t)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(r)>1e-4))return}(o=o?Rr.copyFrom(o):Rr.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.transformAABB(o,e),e.ceil(t),this.transformAABB(o.invert(),e)}}}Mr.extension={type:qt.RendererSystem,name:"filter"},Yt.add(Mr);class jr{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Z.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Dr=new Cn;class Or{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new vr(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Cn,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let t=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;Q.PREFER_ENV===j.WEBGL_LEGACY&&(t=null,n=null),t?e.drawBuffers=e=>t.drawBuffersWEBGL(e):(this.hasMRT=!1,e.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{gl:r}=this;if(e){const o=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,r.bindFramebuffer(r.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==n&&(e.dirtyId++,e.dirtyFormat++,o.mipLevel=n),o.dirtyId!==e.dirtyId&&(o.dirtyId=e.dirtyId,o.dirtyFormat!==e.dirtyFormat?(o.dirtyFormat=e.dirtyFormat,o.dirtySize=e.dirtySize,this.updateFramebuffer(e,n)):o.dirtySize!==e.dirtySize&&(o.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let t=0;t<e.colorTextures.length;t++){const n=e.colorTextures[t];this.renderer.texture.unbind(n.parentTextureArray||n)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const e=t.width>>n,r=t.height>>n,o=e/t.width;this.setViewport(t.x*o,t.y*o,e,r)}else{const t=e.width>>n,r=e.height>>n;this.setViewport(0,0,t,r)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,n,r){const o=this.viewport;e=Math.round(e),t=Math.round(t),n=Math.round(n),r=Math.round(r),(o.width!==n||o.height!==r||o.x!==e||o.y!==t)&&(o.x=e,o.y=t,o.width=n,o.height=r,this.gl.viewport(e,t,n,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:O.COLOR|O.DEPTH;const{gl:a}=this;a.clearColor(e,t,n,r),a.clear(o)}initFramebuffer(e){const{gl:t}=this,n=new jr(t.createFramebuffer());return n.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(e),e.disposeRunner.add(this),n}resizeFramebuffer(e){const{gl:t}=this,n=e.glFramebuffers[this.CONTEXT_UID];if(n.stencil){let r;t.bindRenderbuffer(t.RENDERBUFFER,n.stencil),r=1===this.renderer.context.webGLVersion?t.DEPTH_STENCIL:e.depth&&e.stencil?t.DEPTH24_STENCIL8:e.depth?t.DEPTH_COMPONENT24:t.STENCIL_INDEX8,n.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,n.multisample,r,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,r,e.width,e.height)}const r=e.colorTextures;let o=r.length;t.drawBuffers||(o=Math.min(o,1));for(let a=0;a<o;a++){const o=r[a],s=o.parentTextureArray||o;this.renderer.texture.bind(s,0),0===a&&n.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,n.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,n.multisample,s._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:n}=this,r=e.glFramebuffers[this.CONTEXT_UID],o=e.colorTextures;let a=o.length;n.drawBuffers||(a=Math.min(a,1)),r.multisample>1&&this.canMultisampleFramebuffer(e)?r.msaaBuffer=r.msaaBuffer||n.createRenderbuffer():r.msaaBuffer&&(n.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const s=[];for(let i=0;i<a;i++){const a=o[i],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),0===i&&r.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,r.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,r.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+i,a.target,l._glTextures[this.CONTEXT_UID].texture,t),s.push(n.COLOR_ATTACHMENT0+i))}if(s.length>1&&n.drawBuffers(s),e.depthTexture&&this.writeDepthTexture){const r=e.depthTexture;this.renderer.texture.bind(r,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r._glTextures[this.CONTEXT_UID].texture,t)}if(!e.stencil&&!e.depth||e.depthTexture&&this.writeDepthTexture)r.stencil&&(n.deleteRenderbuffer(r.stencil),r.stencil=null);else{let t,o;r.stencil=r.stencil||n.createRenderbuffer(),1===this.renderer.context.webGLVersion?(t=n.DEPTH_STENCIL_ATTACHMENT,o=n.DEPTH_STENCIL):e.depth&&e.stencil?(t=n.DEPTH_STENCIL_ATTACHMENT,o=n.DEPTH24_STENCIL8):e.depth?(t=n.DEPTH_ATTACHMENT,o=n.DEPTH_COMPONENT24):(t=n.STENCIL_ATTACHMENT,o=n.STENCIL_INDEX8),n.bindRenderbuffer(n.RENDERBUFFER,r.stencil),r.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,o,e.width,e.height):n.renderbufferStorage(n.RENDERBUFFER,o,e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,t,n.RENDERBUFFER,r.stencil)}}canMultisampleFramebuffer(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let n=Z.NONE;if(e<=1||null===t)return n;for(let r=0;r<t.length;r++)if(t[r]<=e){n=t[r];break}return 1===n&&(n=Z.NONE),n}blit(e,t,n){const{current:r,renderer:o,gl:a,CONTEXT_UID:s}=this;if(2!==o.context.webGLVersion||!r)return;const i=r.glFramebuffers[s];if(!i)return;if(!e){if(!i.msaaBuffer)return;const t=r.colorTextures[0];if(!t)return;i.blitFramebuffer||(i.blitFramebuffer=new vr(r.width,r.height),i.blitFramebuffer.addColorTexture(0,t)),(e=i.blitFramebuffer).colorTextures[0]!==t&&(e.colorTextures[0]=t,e.dirtyId++,e.dirtyFormat++),(e.width!==r.width||e.height!==r.height)&&(e.width=r.width,e.height=r.height,e.dirtyId++,e.dirtySize++)}t||((t=Dr).width=r.width,t.height=r.height),n||(n=t);const l=t.width===n.width&&t.height===n.height;this.bind(e),a.bindFramebuffer(a.READ_FRAMEBUFFER,i.framebuffer),a.blitFramebuffer(t.left,t.top,t.right,t.bottom,n.left,n.top,n.right,n.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const n=e.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!n)return;delete e.glFramebuffers[this.CONTEXT_UID];const o=this.managedFramebuffers.indexOf(e);o>=0&&this.managedFramebuffers.splice(o,1),e.disposeRunner.remove(this),t||(r.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&r.deleteRenderbuffer(n.msaaBuffer),n.stencil&&r.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&this.disposeFramebuffer(n.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<t.length;n++)this.disposeFramebuffer(t[n],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const n=e.width,r=e.height,o=this.gl,a=t.stencil=o.createRenderbuffer();let s,i;o.bindRenderbuffer(o.RENDERBUFFER,a),1===this.renderer.context.webGLVersion?(s=o.DEPTH_STENCIL_ATTACHMENT,i=o.DEPTH_STENCIL):e.depth?(s=o.DEPTH_STENCIL_ATTACHMENT,i=o.DEPTH24_STENCIL8):(s=o.STENCIL_ATTACHMENT,i=o.STENCIL_INDEX8),t.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,t.multisample,i,n,r):o.renderbufferStorage(o.RENDERBUFFER,i,n,r),o.framebufferRenderbuffer(o.FRAMEBUFFER,s,o.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Cn}destroy(){this.renderer=null}}Or.extension={type:qt.RendererSystem,name:"framebuffer"},Yt.add(Or);const Br={5126:4,5123:2,5121:1};class Lr{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==t.webGLVersion){let t=this.renderer.context.extensions.vertexArrayObject;Q.PREFER_ENV===j.WEBGL_LEGACY&&(t=null),t?(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==t.webGLVersion){const t=e.getExtension("ANGLE_instanced_arrays");t?(e.vertexAttribDivisor=(e,n)=>t.vertexAttribDivisorANGLE(e,n),e.drawElementsInstanced=(e,n,r,o,a)=>t.drawElementsInstancedANGLE(e,n,r,o,a),e.drawArraysInstanced=(e,n,r,o)=>t.drawArraysInstancedANGLE(e,n,r,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===t.webGLVersion||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:n}=this;let r=e.glVertexArrayObjects[this.CONTEXT_UID],o=!1;r||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=r={},o=!0);const a=r[t.program.id]||this.initGeometryVao(e,t,o);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?n.bindVertexArray(a):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let n=0;n<e.buffers.length;n++){const r=e.buffers[n];t.update(r)}}checkCompatibility(e,t){const n=e.attributes,r=t.attributeData;for(const o in r)if(!n[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(e,t){const n=e.attributes,r=t.attributeData,o=["g",e.id];for(const a in n)r[a]&&o.push(a,r[a].location);return o.join("-")}initGeometryVao(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=this.gl,o=this.CONTEXT_UID,a=this.renderer.buffer,s=t.program;s.glPrograms[o]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,s);const i=this.getSignature(e,s),l=e.glVertexArrayObjects[this.CONTEXT_UID];let c=l[i];if(c)return l[s.id]=c,c;const d=e.buffers,u=e.attributes,h={},p={};for(const m in d)h[m]=0,p[m]=0;for(const m in u)!u[m].size&&s.attributeData[m]?u[m].size=s.attributeData[m].size:u[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),h[u[m].buffer]+=u[m].size*Br[u[m].type];for(const m in u){const e=u[m],t=e.size;void 0===e.stride&&(h[e.buffer]===t*Br[e.type]?e.stride=0:e.stride=h[e.buffer]),void 0===e.start&&(e.start=p[e.buffer],p[e.buffer]+=t*Br[e.type])}c=r.createVertexArray(),r.bindVertexArray(c);for(let m=0;m<d.length;m++){const e=d[m];a.bind(e),n&&e._glBuffers[o].refCount++}return this.activateVao(e,s),l[s.id]=c,l[i]=c,r.bindVertexArray(null),a.unbind(J.ARRAY_BUFFER),c}disposeGeometry(e,t){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const n=e.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,o=e.buffers,a=this.renderer?.buffer;if(e.disposeRunner.remove(this),n){if(a)for(let e=0;e<o.length;e++){const n=o[e]._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0===n.refCount&&!t&&a.dispose(o[e],t))}if(!t)for(const e in n)if("g"===e[0]){const t=n[e];this._activeVao===t&&this.unbind(),r.deleteVertexArray(t)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let n=0;n<t.length;n++)this.disposeGeometry(this.managedGeometries[t[n]],e)}activateVao(e,t){const n=this.gl,r=this.CONTEXT_UID,o=this.renderer.buffer,a=e.buffers,s=e.attributes;e.indexBuffer&&o.bind(e.indexBuffer);let i=null;for(const l in s){const e=s[l],c=a[e.buffer],d=c._glBuffers[r];if(t.attributeData[l]){i!==d&&(o.bind(c),i=d);const r=t.attributeData[l].location;if(n.enableVertexAttribArray(r),n.vertexAttribPointer(r,e.size,e.type||n.FLOAT,e.normalized,e.stride,e.start),e.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(r,e.divisor)}}}}draw(e,t,n,r){const{gl:o}=this,a=this._activeGeometry;if(a.indexBuffer){const s=a.indexBuffer.data.BYTES_PER_ELEMENT,i=2===s?o.UNSIGNED_SHORT:o.UNSIGNED_INT;2===s||4===s&&this.canUseUInt32ElementIndex?a.instanced?o.drawElementsInstanced(e,t||a.indexBuffer.data.length,i,(n||0)*s,r||1):o.drawElements(e,t||a.indexBuffer.data.length,i,(n||0)*s):console.warn("unsupported index buffer type: uint32")}else a.instanced?o.drawArraysInstanced(e,n,t||a.getSize(),r||1):o.drawArrays(e,n,t||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Lr.extension={type:qt.RendererSystem,name:"geometry"},Yt.add(Lr);const Fr=new Pn;class $r{constructor(e,t){this._texture=e,this.mapCoord=new Pn,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){void 0===t&&(t=e);const n=this.mapCoord;for(let r=0;r<e.length;r+=2){const o=e[r],a=e[r+1];t[r]=o*n.a+a*n.c+n.tx,t[r+1]=o*n.b+a*n.d+n.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const n=t._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const r=t.orig,o=t.trim;o&&(Fr.set(r.width/o.width,0,0,r.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(Fr));const a=t.baseTexture,s=this.uClampFrame,i=this.clampMargin/a.resolution,l=this.clampOffset;return s[0]=(t._frame.x+i+l)/a.width,s[1]=(t._frame.y+i+l)/a.height,s[2]=(t._frame.x+t._frame.width-i+l)/a.width,s[3]=(t._frame.y+t._frame.height-i+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=t._frame.width===a.width&&t._frame.height===a.height&&0===t.rotate,!0}}class Gr extends pr{constructor(e,t,n){let r=null;"string"!=typeof e&&void 0===t&&void 0===n&&(r=e,e=void 0,t=void 0,n=void 0),super(e||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",t||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",n),this.maskSprite=r,this.maskMatrix=new Pn}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,n,r){const o=this._maskSprite,a=o._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new $r(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,o).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,t,n,r))}}class zr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.type=X.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=pr.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=X.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Ur{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let n=t;if(!n.isMaskData){const e=this.maskDataPool.pop()||new zr;e.pooled=!0,e.maskObject=t,n=e}const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(r),n._colorMask=r?r._colorMask:15,n.autoDetect&&this.detect(n),n._target=e,n.type!==X.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case X.SCISSOR:this.renderer.scissor.push(n);break;case X.STENCIL:this.renderer.stencil.push(n);break;case X.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case X.COLOR:this.pushColorMask(n)}n.type===X.SPRITE&&this.maskStack.push(n)}pop(e){const t=this.maskStack.pop();if(t&&t._target===e){if(t.enabled)switch(t.type){case X.SCISSOR:this.renderer.scissor.pop(t);break;case X.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case X.SPRITE:this.popSpriteMask(t);break;case X.COLOR:this.popColorMask(t)}if(t.reset(),t.pooled&&this.maskDataPool.push(t),0!==this.maskStack.length){const e=this.maskStack[this.maskStack.length-1];e.type===X.SPRITE&&e._filters&&(e._filters[0].maskSprite=e.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=X.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=X.SCISSOR:e.type=X.STENCIL:e.type=X.COLOR}pushSpriteMask(e){const{maskObject:t}=e,n=e._target;let r=e._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new Gr])),r[0].resolution=e.resolution,r[0].multisample=e.multisample,r[0].maskSprite=t;const o=n.filterArea;n.filterArea=t.getBounds(!0),this.renderer.filter.push(n,r),n.filterArea=o,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,n=e._colorMask=t&e.colorMask;n!==t&&this.renderer.gl.colorMask(0!==(1&n),0!==(2&n),0!==(4&n),0!==(8&n))}popColorMask(e){const t=e._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==t&&this.renderer.gl.colorMask(0!==(1&n),0!==(2&n),0!==(4&n),0!==(8&n))}destroy(){this.renderer=null}}Ur.extension={type:qt.RendererSystem,name:"mask"},Yt.add(Ur);class Hr{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,n=this.getStackLength();this.maskStack=e;const r=this.getStackLength();r!==n&&(0===r?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const qr=new Pn,Vr=[],Wr=class e extends Hr{constructor(e){super(e),this.glConst=Q.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:n}=e,{renderer:r}=this,o=r.renderTexture,a=n.getBounds(!0,Vr.pop()??new Cn);this.roundFrameToPixels(a,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),t&&a.fit(t),e._scissorRectLocal=a}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:n,c:r,d:o}=e;return(Math.abs(n)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(o)>1e-4)}testScissor(t){const{maskObject:n}=t;if(!n.isFastRect||!n.isFastRect()||e.isMatrixRotated(n.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,n,r,o,a){e.isMatrixRotated(a)||((a=a?qr.copyFrom(a):qr.identity()).translate(-r.x,-r.y).scale(o.width/r.width,o.height/r.height).translate(o.x,o.y),this.renderer.filter.transformAABB(a,t),t.fit(o),t.x=Math.round(t.x*n),t.y=Math.round(t.y*n),t.width=Math.round(t.width*n),t.height=Math.round(t.height*n))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&Vr.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};Wr.extension={type:qt.RendererSystem,name:"scissor"};let Yr=Wr;Yt.add(Yr);class Kr extends Hr{constructor(e){super(e),this.glConst=Q.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:n}=this.renderer,r=e._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),e._stencilCounter++;const o=e._colorMask;0!==o&&(e._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,r,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==o&&(e._colorMask=o,n.colorMask(0!==(1&o),0!==(2&o),0!==(4&o),0!==(8&o))),this._useCurrent()}pop(e){const t=this.renderer.gl;if(0===this.getStackLength())t.disable(t.STENCIL_TEST);else{const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,r=n?n._colorMask:15;0!==r&&(n._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==r&&(n._colorMask=r,t.colorMask(0!==(1&r),0!==(2&r),0!==(4&r),0!==(8&r))),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Kr.extension={type:qt.RendererSystem,name:"stencil"},Yt.add(Kr);class Xr{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Se("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract)},prepare:{enumerable:!1,get:()=>(Se("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare)},interaction:{enumerable:!1,get:()=>(Se("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events)}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}Xr.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"_plugin"},Yt.add(Xr);class Zr{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Pn,this.transform=null}update(e,t,n,r){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);const o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(e,t,n,r){const o=this.projectionMatrix,a=r?-1:1;o.identity(),o.a=1/t.width*2,o.d=a*(1/t.height*2),o.tx=-1-t.x*o.a,o.ty=-a-t.y*o.d}setTransform(e){}destroy(){this.renderer=null}}Zr.extension={type:qt.RendererSystem,name:"projection"},Yt.add(Zr);const Jr=new $n,Qr=new Cn;class eo{constructor(e){this.renderer=e,this._tempMatrix=new Pn}generateTexture(e,t){const{region:n,...r}=t||{},o=n?.copyTo(Qr)||e.getLocalBounds(Qr,!0),a=r.resolution||this.renderer.resolution;o.width=Math.max(o.width,1/a),o.height=Math.max(o.height,1/a),r.width=o.width,r.height=o.height,r.resolution=a,r.multisample??(r.multisample=this.renderer.multisample);const s=Ar.create(r);this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;const i=e.transform;return e.transform=Jr,this.renderer.render(e,{renderTexture:s,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=i,s}destroy(){}}eo.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"textureGenerator"},Yt.add(eo);const to=new Cn,no=new Cn;class ro{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Cn,this.destinationFrame=new Cn,this.viewportFrame=new Cn}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const r=this.renderer;let o,a,s;this.current=e,e?(o=e.baseTexture,s=o.resolution,t||(to.width=e.frame.width,to.height=e.frame.height,t=to),n||(no.x=e.frame.x,no.y=e.frame.y,no.width=t.width,no.height=t.height,n=no),a=o.framebuffer):(s=r.resolution,t||(to.width=r._view.screen.width,to.height=r._view.screen.height,t=to),n||(n=to,n.width=t.width,n.height=t.height));const i=this.viewportFrame;i.x=n.x*s,i.y=n.y*s,i.width=n.width*s,i.height=n.height*s,e||(i.y=r.view.height-(i.y+i.height)),i.ceil(),this.renderer.framebuffer.bind(a,i),this.renderer.projection.update(n,t,s,!a),e?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(n)}clear(e,t){const n=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=lt.shared.setValue(e||n);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const o=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,s=o.width!==a.width||o.height!==a.height;if(s){let{x:e,y:t,width:n,height:r}=this.viewportFrame;e=Math.round(e),t=Math.round(t),n=Math.round(n),r=Math.round(r),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(e,t,n,r)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,t),s&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}ro.extension={type:qt.RendererSystem,name:"renderTexture"},Yt.add(ro);class oo{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function ao(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}function so(e){const t=new Array(e);for(let n=0;n<t.length;n++)t[n]=!1;return t}function io(e,t){switch(e){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return so(2*t);case"bvec3":return so(3*t);case"bvec4":return so(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function lo(e,t){const n=e.getShaderSource(t).split("\n").map(((e,t)=>`${t}: ${e}`)),r=e.getShaderInfoLog(t),o=r.split("\n"),a={},s=o.map((e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((e=>!(!e||a[e])&&(a[e]=!0,!0))),i=[""];s.forEach((e=>{n[e-1]=`%c${n[e-1]}%c`,i.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const l=n.join("\n");i[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...i),console.groupEnd()}function co(e,t){const n=ao(e,e.VERTEX_SHADER,t.vertexSrc),r=ao(e,e.FRAGMENT_SHADER,t.fragmentSrc),o=e.createProgram();e.attachShader(o,n),e.attachShader(o,r);const a=t.extra?.transformFeedbackVaryings;if(a&&("function"!=typeof e.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(o,a.names,"separate"===a.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||function(e,t,n,r){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(n,e.COMPILE_STATUS)||lo(e,n),e.getShaderParameter(r,e.COMPILE_STATUS)||lo(e,r),console.error("PixiJS Error: Could not initialize shader."),""!==e.getProgramInfoLog(t)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}(e,o,n,r),t.attributeData=function(e,t){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let o=0;o<r;o++){const r=t.getActiveAttrib(e,o);if(r.name.startsWith("gl_"))continue;const a=Jn(t,r.type),s={type:a,name:r.name,size:Kn(a),location:t.getAttribLocation(e,r.name)};n[r.name]=s}return n}(o,e),t.uniformData=function(e,t){const n={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let o=0;o<r;o++){const r=t.getActiveUniform(e,o),a=r.name.replace(/\[.*?\]$/,""),s=!!r.name.match(/\[.*?\]$/),i=Jn(t,r.type);n[a]={name:a,index:o,type:i,size:r.size,isArray:s,value:io(i,r.size)}}return n}(o,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const n=Object.keys(t.attributeData);n.sort(((e,t)=>e>t?1:-1));for(let r=0;r<n.length;r++)t.attributeData[n[r]].location=r,e.bindAttribLocation(o,r,n[r]);e.linkProgram(o)}e.deleteShader(n),e.deleteShader(r);const s={};for(const i in t.uniformData){const n=t.uniformData[i];s[i]={location:e.getUniformLocation(o,i),value:io(n.type,n.size)}}return new oo(o,s)}function uo(e,t,n,r,o){n.buffer.update(o)}const ho={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},po={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function mo(e,t){if(!e.autoManage)return{size:0,syncFunc:uo};const n=function(e,t){const n=[];for(const r in e)t[r]&&n.push(t[r]);return n.sort(((e,t)=>e.index-t.index)),n}(e.uniforms,t),{uboElements:r,size:o}=function(e){const t=e.map((e=>({data:e,offset:0,dataLen:0,dirty:0})));let n=0,r=0,o=0;for(let a=0;a<t.length;a++){const e=t[a];if(n=po[e.data.type],e.data.size>1&&(n=Math.max(n,16)*e.data.size),e.dataLen=n,r%n!==0&&r<16){const e=r%n%16;r+=e,o+=e}r+n>16?(o=16*Math.ceil(o/16),e.offset=o,o+=n,r=n):(e.offset=o,r+=n,o+=n)}return o=16*Math.ceil(o/16),{uboElements:t,size:o}}(n),a=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let s=0;s<r.length;s++){const t=r[s],n=e.uniforms[t.data.name],o=t.data.name;let i=!1;for(let e=0;e<Gn.length;e++){const r=Gn[e];if(r.codeUbo&&r.test(t.data,n)){a.push(`offset = ${t.offset/4};`,Gn[e].codeUbo(t.data.name,n)),i=!0;break}}if(!i)if(t.data.size>1){const e=Kn(t.data.type),n=Math.max(po[t.data.type]/16,1),r=e/n,s=(4-r%4)%4;a.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${t.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${t.data.size*n}; i++)\n                {\n                    for(var j = 0; j < ${r}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${s};\n                }\n\n                `)}else{const e=ho[t.data.type];a.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${t.offset/4};\n                ${e};\n                `)}}return a.push("\n       renderer.buffer.update(buffer);\n    "),{size:o,syncFunc:new Function("ud","uv","renderer","syncData","buffer",a.join("\n"))}}let fo;let go=0;const yo={textureCount:0,uboCount:0};class vo{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=go++}systemCheck(){if(!function(){if("boolean"==typeof fo)return fo;try{fo=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{fo=!1}return fo}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const n=e.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),t||(yo.textureCount=0,yo.uboCount=0,this.syncUniformGroup(e.uniformGroup,yo)),r}setUniforms(e){const t=this.shader.program,n=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(n.uniformData,e,this.renderer)}syncUniformGroup(e,t){const n=this.getGlProgram();(!e.static||e.dirtyId!==n.uniformDirtyGroups[e.id])&&(n.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,n,t))}syncUniforms(e,t,n){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,n)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=function(e,t){const n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const r in e.uniforms){const o=t[r];if(!o){!0===e.uniforms[r]?.group&&(e.uniforms[r].ubo?n.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');\n                    `):n.push(`\n                        renderer.shader.syncUniformGroup(uv.${r}, syncData);\n                    `));continue}const a=e.uniforms[r];let s=!1;for(let e=0;e<Gn.length;e++)if(Gn[e].test(o,a)){n.push(Gn[e].code(r,a)),s=!0;break}if(!s){const e=(1!==o.size||o.isArray?Un:zn)[o.type].replace("location",`ud["${r}"].location`);n.push(`\n            cu = ud["${r}"];\n            cv = cu.value;\n            v = uv["${r}"];\n            ${e};`)}}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const n=this.getGlProgram();if(!e.static||0!==e.dirtyId||!n.uniformGroups[e.id]){e.dirtyId=0;const r=n.uniformGroups[e.id]||this.createSyncBufferGroup(e,n,t);e.buffer.update(),r(n.uniformData,e.uniforms,this.renderer,yo,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,n.uniformBufferBindings[t])}createSyncBufferGroup(e,t,n){const{gl:r}=this.renderer;this.renderer.buffer.bind(e.buffer);const o=this.gl.getUniformBlockIndex(t.program,n);t.uniformBufferBindings[n]=this.shader.uniformBindCount,r.uniformBlockBinding(t.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(e,this.shader.program.uniformData,"ubo");let s=this._uboCache[a];if(s||(s=this._uboCache[a]=mo(e,this.shader.program.uniformData)),e.autoManage){const t=new Float32Array(s.size/4);e.buffer.update(t)}return t.uniformGroups[e.id]=s.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,n){const r=e.uniforms,o=[`${n}-`];for(const a in r)o.push(a),t[a]&&o.push(t[a].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,n=e.program,r=co(t,n);return n.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}vo.extension={type:qt.RendererSystem,name:"shader"},Yt.add(vo);class bo{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}bo.defaultOptions={hello:!1},bo.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"startup"},Yt.add(bo);const xo=class e{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=B.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new Jt,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t[B.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.ADD]=[e.ONE,e.ONE],t[B.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.NONE]=[0,0],t[B.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[B.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[B.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[B.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[B.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[B.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[B.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[B.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[B.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[B.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[B.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,n=0;for(;t;)1&t&&this.map[n].call(this,!!(e.data&1<<n)),t>>=1,n++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],n=this.gl;2===t.length?n.blendFunc(t[0],t[1]):n.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,n.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const n=this.checks.indexOf(e);t&&-1===n?this.checks.push(e):!t&&-1!==n&&this.checks.splice(n,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};xo.extension={type:qt.RendererSystem,name:"state"};let wo=xo;Yt.add(wo);class So extends ve{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter((t=>e.systems[t])),n=[...t,...Object.keys(e.systems).filter((e=>!t.includes(e)))];for(const r of n)this.addSystem(e.systems[r],r)}addRunners(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{this.runners[e]=new tn(e)}))}addSystem(e,t){const n=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=n,this._systemsHash[t]=n;for(const r in this.runners)this.runners[r].add(n);return this}emitWithCustomOptions(e,t){const n=Object.keys(this._systemsHash);e.items.forEach((r=>{const o=n.find((e=>this._systemsHash[e]===r));r[e.name](t[o])}))}destroy(){Object.values(this.runners).forEach((e=>{e.destroy()})),this._systemsHash={}}}const To=class e{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=e.defaultMaxIdle,this.checkCountMax=e.defaultCheckCountMax,this.mode=e.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Y.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let n=!1;for(let r=0;r<t.length;r++){const o=t[r];o.resource&&this.count-o.touched>this.maxIdle&&(e.destroyTexture(o,!0),t[r]=null,n=!0)}if(n){let e=0;for(let n=0;n<t.length;n++)null!==t[n]&&(t[e++]=t[n]);t.length=e}}unload(e){const t=this.renderer.texture,n=e._texture;n&&!n.framebuffer&&t.destroyTexture(n);for(let r=e.children.length-1;r>=0;r--)this.unload(e.children[r])}destroy(){this.renderer=null}};To.defaultMode=Y.AUTO,To.defaultMaxIdle=3600,To.defaultCheckCountMax=600,To.extension={type:qt.RendererSystem,name:"textureGC"};let Co=To;Yt.add(Co);class ko{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=G.UNSIGNED_BYTE,this.internalFormat=F.RGBA,this.samplerType=0}}class Ao{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new sn,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(e){let t;return t="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[G.UNSIGNED_BYTE]:{[F.RGBA]:e.RGBA8,[F.RGB]:e.RGB8,[F.RG]:e.RG8,[F.RED]:e.R8,[F.RGBA_INTEGER]:e.RGBA8UI,[F.RGB_INTEGER]:e.RGB8UI,[F.RG_INTEGER]:e.RG8UI,[F.RED_INTEGER]:e.R8UI,[F.ALPHA]:e.ALPHA,[F.LUMINANCE]:e.LUMINANCE,[F.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[G.BYTE]:{[F.RGBA]:e.RGBA8_SNORM,[F.RGB]:e.RGB8_SNORM,[F.RG]:e.RG8_SNORM,[F.RED]:e.R8_SNORM,[F.RGBA_INTEGER]:e.RGBA8I,[F.RGB_INTEGER]:e.RGB8I,[F.RG_INTEGER]:e.RG8I,[F.RED_INTEGER]:e.R8I},[G.UNSIGNED_SHORT]:{[F.RGBA_INTEGER]:e.RGBA16UI,[F.RGB_INTEGER]:e.RGB16UI,[F.RG_INTEGER]:e.RG16UI,[F.RED_INTEGER]:e.R16UI,[F.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[G.SHORT]:{[F.RGBA_INTEGER]:e.RGBA16I,[F.RGB_INTEGER]:e.RGB16I,[F.RG_INTEGER]:e.RG16I,[F.RED_INTEGER]:e.R16I},[G.UNSIGNED_INT]:{[F.RGBA_INTEGER]:e.RGBA32UI,[F.RGB_INTEGER]:e.RGB32UI,[F.RG_INTEGER]:e.RG32UI,[F.RED_INTEGER]:e.R32UI,[F.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[G.INT]:{[F.RGBA_INTEGER]:e.RGBA32I,[F.RGB_INTEGER]:e.RGB32I,[F.RG_INTEGER]:e.RG32I,[F.RED_INTEGER]:e.R32I},[G.FLOAT]:{[F.RGBA]:e.RGBA32F,[F.RGB]:e.RGB32F,[F.RG]:e.RG32F,[F.RED]:e.R32F,[F.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[G.HALF_FLOAT]:{[F.RGBA]:e.RGBA16F,[F.RGB]:e.RGB16F,[F.RG]:e.RG16F,[F.RED]:e.R16F},[G.UNSIGNED_SHORT_5_6_5]:{[F.RGB]:e.RGB565},[G.UNSIGNED_SHORT_4_4_4_4]:{[F.RGBA]:e.RGBA4},[G.UNSIGNED_SHORT_5_5_5_1]:{[F.RGBA]:e.RGB5_A1},[G.UNSIGNED_INT_2_10_10_10_REV]:{[F.RGBA]:e.RGB10_A2,[F.RGBA_INTEGER]:e.RGB10_A2UI},[G.UNSIGNED_INT_10F_11F_11F_REV]:{[F.RGB]:e.R11F_G11F_B10F},[G.UNSIGNED_INT_5_9_9_9_REV]:{[F.RGB]:e.RGB9_E5},[G.UNSIGNED_INT_24_8]:{[F.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[G.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[F.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:{[G.UNSIGNED_BYTE]:{[F.RGBA]:e.RGBA,[F.RGB]:e.RGB,[F.ALPHA]:e.ALPHA,[F.LUMINANCE]:e.LUMINANCE,[F.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[G.UNSIGNED_SHORT_5_6_5]:{[F.RGB]:e.RGB},[G.UNSIGNED_SHORT_4_4_4_4]:{[F.RGBA]:e.RGBA},[G.UNSIGNED_SHORT_5_5_5_1]:{[F.RGBA]:e.RGBA}},t}(e),this.samplerTypes=function(e){let t;return t="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[e.RGB]:z.FLOAT,[e.RGBA]:z.FLOAT,[e.ALPHA]:z.FLOAT,[e.LUMINANCE]:z.FLOAT,[e.LUMINANCE_ALPHA]:z.FLOAT,[e.R8]:z.FLOAT,[e.R8_SNORM]:z.FLOAT,[e.RG8]:z.FLOAT,[e.RG8_SNORM]:z.FLOAT,[e.RGB8]:z.FLOAT,[e.RGB8_SNORM]:z.FLOAT,[e.RGB565]:z.FLOAT,[e.RGBA4]:z.FLOAT,[e.RGB5_A1]:z.FLOAT,[e.RGBA8]:z.FLOAT,[e.RGBA8_SNORM]:z.FLOAT,[e.RGB10_A2]:z.FLOAT,[e.RGB10_A2UI]:z.FLOAT,[e.SRGB8]:z.FLOAT,[e.SRGB8_ALPHA8]:z.FLOAT,[e.R16F]:z.FLOAT,[e.RG16F]:z.FLOAT,[e.RGB16F]:z.FLOAT,[e.RGBA16F]:z.FLOAT,[e.R32F]:z.FLOAT,[e.RG32F]:z.FLOAT,[e.RGB32F]:z.FLOAT,[e.RGBA32F]:z.FLOAT,[e.R11F_G11F_B10F]:z.FLOAT,[e.RGB9_E5]:z.FLOAT,[e.R8I]:z.INT,[e.R8UI]:z.UINT,[e.R16I]:z.INT,[e.R16UI]:z.UINT,[e.R32I]:z.INT,[e.R32UI]:z.UINT,[e.RG8I]:z.INT,[e.RG8UI]:z.UINT,[e.RG16I]:z.INT,[e.RG16UI]:z.UINT,[e.RG32I]:z.INT,[e.RG32UI]:z.UINT,[e.RGB8I]:z.INT,[e.RGB8UI]:z.UINT,[e.RGB16I]:z.INT,[e.RGB16UI]:z.UINT,[e.RGB32I]:z.INT,[e.RGB32UI]:z.UINT,[e.RGBA8I]:z.INT,[e.RGBA8UI]:z.UINT,[e.RGBA16I]:z.INT,[e.RGBA16UI]:z.UINT,[e.RGBA32I]:z.INT,[e.RGBA32UI]:z.UINT,[e.DEPTH_COMPONENT16]:z.FLOAT,[e.DEPTH_COMPONENT24]:z.FLOAT,[e.DEPTH_COMPONENT32F]:z.FLOAT,[e.DEPTH_STENCIL]:z.FLOAT,[e.DEPTH24_STENCIL8]:z.FLOAT,[e.DEPTH32F_STENCIL8]:z.FLOAT}:{[e.RGB]:z.FLOAT,[e.RGBA]:z.FLOAT,[e.ALPHA]:z.FLOAT,[e.LUMINANCE]:z.FLOAT,[e.LUMINANCE_ALPHA]:z.FLOAT,[e.DEPTH_STENCIL]:z.FLOAT},t}(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let r=0;r<t;r++)this.boundTextures[r]=null;this.emptyTextures={};const n=new ko(e.createTexture());e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new ko(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{gl:n}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const r=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(e.target,r.texture)),r.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),this.updateTexture(e)):r.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let e=0;e<n.length;e++)n[e]===this.unknownTexture&&this.bind(null,e)}for(let r=0;r<n.length;r++)n[r]===e&&(this.currentLocation!==r&&(t.activeTexture(t.TEXTURE0+r),this.currentLocation=r),t.bindTexture(e.target,this.emptyTextures[e.target].texture),n[r]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:n,CONTEXT_UID:r}=this;if(n)for(let o=e-1;o>=0;--o){const e=t[o];e&&e._glTextures[r].samplerType!==z.FLOAT&&this.renderer.texture.unbind(e)}}initTexture(e){const t=new ko(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){t.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??z.FLOAT,2===this.webGLVersion&&e.type===G.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const n=this.renderer;if(this.initTextureType(e,t),e.resource?.upload(n,e,t))t.samplerType!==z.FLOAT&&(this.hasIntegerTextures=!0);else{const r=e.realWidth,o=e.realHeight,a=n.gl;(t.width!==r||t.height!==o||t.dirtyId<0)&&(t.width=r,t.height=o,a.texImage2D(e.target,0,t.internalFormat,r,o,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:n}=this;if((e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),n.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const t=this.managedTextures.indexOf(e);-1!==t&&At(this.managedTextures,t,1)}}updateTextureStyle(e){const t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==q.POW2&&2===this.webGLVersion||e.isPowerOfTwo?t.mipmap=e.mipmap>=1:t.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?t.wrapMode=e.wrapMode:t.wrapMode=H.CLAMP,e.resource?.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const n=this.gl;if(t.mipmap&&e.mipmap!==q.ON_MANUAL&&n.generateMipmap(e.target),n.texParameteri(e.target,n.TEXTURE_WRAP_S,t.wrapMode),n.texParameteri(e.target,n.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===U.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const t=this.renderer.context.extensions.anisotropicFiltering;if(t&&e.anisotropicLevel>0&&e.scaleMode===U.LINEAR){const r=Math.min(e.anisotropicLevel,n.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===U.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(e.target,n.TEXTURE_MAG_FILTER,e.scaleMode===U.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}Ao.extension={type:qt.RendererSystem,name:"texture"},Yt.add(Ao);class Io{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:n}=this,r=e._glTransformFeedbacks[n]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:n,renderer:r}=this;t&&r.shader.bind(t),n.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:n,CONTEXT_UID:r}=this,o=t.createTransformFeedback();e._glTransformFeedbacks[r]=o,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,o);for(let a=0;a<e.buffers.length;a++){const o=e.buffers[a];o&&(n.buffer.update(o),o._glBuffers[r].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[r].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),o}disposeTransformFeedback(e,t){const n=e._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;e.disposeRunner.remove(this);const o=this.renderer.buffer;if(o)for(let a=0;a<e.buffers.length;a++){const n=e.buffers[a];if(!n)continue;const r=n._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0===r.refCount&&!t&&o.dispose(n,t))}n&&(t||r.deleteTransformFeedback(n),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Io.extension={type:qt.RendererSystem,name:"transformFeedback"},Yt.add(Io);class Eo{constructor(e){this.renderer=e}init(e){this.screen=new Cn(0,0,e.width,e.height),this.element=e.view||Q.ADAPTER.createCanvas(),this.resolution=e.resolution||Q.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const n=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=n,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",n,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Eo.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Eo.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"_view"},Yt.add(Eo),Q.PREFER_ENV=j.WEBGL2,Q.STRICT_TEXTURE_CACHE=!1,Q.RENDER_OPTIONS={...yr.defaultOptions,...mr.defaultOptions,...Eo.defaultOptions,...bo.defaultOptions},Object.defineProperties(Q,{WRAP_MODE:{get:()=>sn.defaultOptions.wrapMode,set(e){Se("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),sn.defaultOptions.wrapMode=e}},SCALE_MODE:{get:()=>sn.defaultOptions.scaleMode,set(e){Se("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),sn.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get:()=>sn.defaultOptions.mipmap,set(e){Se("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),sn.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get:()=>sn.defaultOptions.anisotropicLevel,set(e){Se("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),sn.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get:()=>(Se("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),pr.defaultResolution),set(e){pr.defaultResolution=e}},FILTER_MULTISAMPLE:{get:()=>(Se("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),pr.defaultMultisample),set(e){pr.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get:()=>ur.defaultMaxTextures,set(e){Se("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),ur.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get:()=>ur.defaultBatchSize,set(e){Se("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),ur.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get:()=>ur.canUploadSameBuffer,set(e){Se("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),ur.canUploadSameBuffer=e}},GC_MODE:{get:()=>Co.defaultMode,set(e){Se("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Co.defaultMode=e}},GC_MAX_IDLE:{get:()=>Co.defaultMaxIdle,set(e){Se("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Co.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get:()=>Co.defaultCheckCountMax,set(e){Se("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Co.defaultCheckCountMax=e}},PRECISION_VERTEX:{get:()=>rr.defaultVertexPrecision,set(e){Se("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),rr.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get:()=>rr.defaultFragmentPrecision,set(e){Se("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),rr.defaultFragmentPrecision=e}}});var Po=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(Po||{});class _o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=n,this.once=r}match(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const No=class e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new _o(null,null,1/0),this.deltaMS=1/e.targetFPMS,this.elapsedMS=1/e.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Po.NORMAL;return this._addListener(new _o(e,t,n))}addOnce(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Po.NORMAL;return this._addListener(new _o(e,t,n,!0))}_addListener(e){let t=this._head.next,n=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(n);break}n=t,t=t.next}e.previous||e.connect(n)}else e.connect(n);return this._startIfPossible(),this}remove(e,t){let n=this._head.next;for(;n;)n=n.match(e,t)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(){let t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now();if(n>this.lastTime){if(t=this.elapsedMS=n-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const e=n-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=n-e%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*e.targetFPMS;const r=this._head;let o=r.next;for(;o;)o=o.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=n}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const n=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,n)/1e3,e.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!e._shared){const t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared}static get system(){if(!e._system){const t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system}};No.targetFPMS=.06;let Ro=No;Object.defineProperties(Q,{TARGET_FPMS:{get:()=>Ro.targetFPMS,set(e){Se("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ro.targetFPMS=e}}});class Mo{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Po.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ro.shared:new Ro,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Mo.extension=qt.Application,Yt.add(Mo);const jo=[];Yt.handleByList(qt.Renderer,jo);const Do="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Oo{constructor(e){this.renderer=e}contextChange(e){let t;if(1===this.renderer.context.webGLVersion){const n=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,n)}else{const n=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n)}t>=Z.HIGH?this.multisample=Z.HIGH:t>=Z.MEDIUM?this.multisample=Z.MEDIUM:t>=Z.LOW?this.multisample=Z.LOW:this.multisample=Z.NONE}destroy(){}}Oo.extension={type:qt.RendererSystem,name:"_multisample"},Yt.add(Oo);class Bo{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Lo{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:n}=this,r=e._glBuffers[n]||this.createGLBuffer(e);t.bindBuffer(e.type,r.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:n,CONTEXT_UID:r}=this;if(this.boundBufferBases[t]!==e){const o=e._glBuffers[r]||this.createGLBuffer(e);this.boundBufferBases[t]=e,n.bindBufferBase(n.UNIFORM_BUFFER,t,o.buffer)}}bindBufferRange(e,t,n){const{gl:r,CONTEXT_UID:o}=this;n=n||0;const a=e._glBuffers[o]||this.createGLBuffer(e);r.bindBufferRange(r.UNIFORM_BUFFER,t||0,a.buffer,256*n,256)}update(e){const{gl:t,CONTEXT_UID:n}=this,r=e._glBuffers[n]||this.createGLBuffer(e);if(e._updateID!==r.updateID)if(r.updateID=e._updateID,t.bindBuffer(e.type,r.buffer),r.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;r.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const n=e._glBuffers[this.CONTEXT_UID],r=this.gl;e.disposeRunner.remove(this),n&&(t||r.deleteBuffer(n.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let n=0;n<t.length;n++)this.dispose(this.managedBuffers[t[n]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:n}=this;return e._glBuffers[t]=new Bo(n.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}Lo.extension={type:qt.RendererSystem,name:"buffer"},Yt.add(Lo);class Fo{constructor(e){this.renderer=e}render(e,t){const n=this.renderer;let r,o,a,s;if(t&&(r=t.renderTexture,o=t.clear,a=t.transform,s=t.skipUpdateTransform),this.renderingToScreen=!r,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=a,!n.context.isLost){if(r||(this.lastObjectRendered=e),!s){const t=e.enableTempParent();e.updateTransform(),e.disableTempParent(t)}n.renderTexture.bind(r),n.batch.currentRenderer.start(),(o??n.background.clearBeforeRender)&&n.renderTexture.clear(),e.render(n),n.batch.currentRenderer.flush(),r&&(t.blit&&n.framebuffer.blit(),r.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Fo.extension={type:qt.RendererSystem,name:"objectRenderer"},Yt.add(Fo);const $o=class e extends So{constructor(t){super(),this.type=D.WEBGL,t=Object.assign({},Q.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ar({projectionMatrix:new Pn},!0);const n={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:e.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(n),"useContextAlpha"in t&&(Se("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=e.__plugins,this.options=t,this.startup.run(this.options)}static test(e){return!e?.forceCanvas&&Re()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Se("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Se("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Se("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Se("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Se("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Se("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){Se("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Se("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};$o.extension={type:qt.Renderer,priority:1},$o.__plugins={},$o.__systems={};let Go=$o;Yt.handleByMap(qt.RendererPlugin,Go.__plugins),Yt.handleByMap(qt.RendererSystem,Go.__systems),Yt.add(Go);class zo extends nn{constructor(e,t){const{width:n,height:r}=t||{};super(n,r),this.items=[],this.itemDirtyIds=[];for(let o=0;o<e;o++){const e=new sn;this.items.push(e),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let n=0;n<this.length;n++)e[n]&&(e[n].castToBaseTexture?this.addBaseTextureAt(e[n].castToBaseTexture(),n):e[n]instanceof nn?this.addResourceAt(e[n],n):this.addResourceAt(en(e[n],t),n))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map((e=>e.resource)).filter((e=>e)).map((e=>e.load()));return this._load=Promise.all(e).then((()=>{const{realWidth:e,realHeight:t}=this.items[0];return this.resize(e,t),this.update(),Promise.resolve(this)})),this._load}}class Uo extends xr{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return!!(t&&e instanceof t)||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const Ho=class e extends zo{constructor(t,n){const{width:r,height:o,autoLoad:a,linkBaseTexture:s}=n||{};if(t&&t.length!==e.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:o});for(let i=0;i<e.SIDES;i++)this.items[i].target=$.TEXTURE_CUBE_MAP_POSITIVE_X+i;this.linkBaseTexture=!1!==s,t&&this.initFromArray(t,n),!1!==a&&this.load()}bind(e){super.bind(e),e.target=$.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,n){if(void 0===n&&(n=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,t)}else e.target=$.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(t,n,r){const o=this.itemDirtyIds;for(let a=0;a<e.SIDES;a++){const e=this.items[a];(o[a]<e.dirtyId||r.dirtyId<n.dirtyId)&&(e.valid&&e.resource?(e.resource.upload(t,e,r),o[a]=e.dirtyId):o[a]<-1&&(t.gl.texImage2D(e.target,0,r.internalFormat,n.realWidth,n.realHeight,0,n.format,r.type,null),o[a]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===e.SIDES}};Ho.SIDES=6;let qo=Ho;class Vo extends xr{constructor(e,t){let n,r,o;t=t||{},"string"==typeof e?(n=Vo.EMPTY,r=e,o=!0):(n=e,r=null,o=!1),super(n),this.url=r,this.crossOrigin=t.crossOrigin??!0,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??o,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(e,t)=>{if(null!==this.url)try{const t=await Q.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await t.blob();if(this.destroyed)return;const r=await createImageBitmap(n,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===V.UNPACK?"premultiply":"none"});if(this.destroyed)return void r.close();this.source=r,this.update(),e(this)}catch(n){if(this.destroyed)return;t(n),this.onError.emit(n)}else e(this)}))),this._load}upload(e,t,n){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),super.upload(e,t,n)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof e||e instanceof ImageBitmap)}static get EMPTY(){return Vo._EMPTY=Vo._EMPTY??Q.ADAPTER.createCanvas(0,0),Vo._EMPTY}}const Wo=class e extends xr{constructor(e,t){t=t||{},super(Q.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.update(),t(this)},e.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const e=new Image;xr.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,n=e.height;if(!t||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=t*this.scale,o=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/n*t,o=this._overrideHeight||this._overrideWidth/t*n),r=Math.round(r),o=Math.round(o);const a=this.source;a.width=r,a.height=o,a._pixiId=`canvas_${Pt()}`,a.getContext("2d").drawImage(e,0,0,t,n,0,0,r,o),this._resolve(),this._resolve=null}}static getSize(t){const n=e.SVG_SIZE.exec(t),r={};return n&&(r[n[1]]=Math.round(parseFloat(n[3])),r[n[5]]=Math.round(parseFloat(n[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,n){return"svg"===n||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&e.SVG_XML.test(t)}};Wo.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Wo.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Yo=Wo;const Ko=class e extends xr{constructor(t,n){if(n=n||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");!1!==n.autoLoad&&r.setAttribute("preload","auto"),!1!==n.playsinline&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),!0===n.muted&&(r.setAttribute("muted",""),r.muted=!0),!0===n.loop&&r.setAttribute("loop",""),!1!==n.autoPlay&&r.setAttribute("autoplay",""),"string"==typeof t&&(t=[t]);const o=t[0].src||t[0];xr.crossOrigin(r,o,n.crossorigin);for(let n=0;n<t.length;++n){const o=document.createElement("source");let{src:a,mime:s}=t[n];if(a=a||t[n],a.startsWith("data:"))s=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const t=a.split("?").shift().toLowerCase(),n=t.slice(t.lastIndexOf(".")+1);s=s||e.MIME_TYPES[n]||`video/${n}`}o.src=a,s&&(o.type=s),r.appendChild(o)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=n.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==n.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==n.autoLoad&&this.load()}update(){if(!this.destroyed){if(this._updateFPS){const e=Ro.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(((t,n)=>{this.valid?t(this):(this._resolve=t,this._reject=n,e.load())})),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Ro.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Ro.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Ro.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,n){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.includes(n)}};Ko.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Ko.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Xo=Ko;Qt.push(Vo,wr,Uo,Xo,class extends xr{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}},Yo,rn,qo,class extends zo{constructor(e,t){const{width:n,height:r}=t||{};let o,a;Array.isArray(e)?(o=e,a=e.length):a=e,super(a,{width:n,height:r}),o&&this.initFromArray(o,t)}addBaseTextureAt(e,t){if(!e.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(e.resource,t),this}bind(e){super.bind(e),e.target=$.TEXTURE_2D_ARRAY}upload(e,t,n){const{length:r,itemDirtyIds:o,items:a}=this,{gl:s}=e;n.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,r,0,t.format,n.type,null);for(let i=0;i<r;i++){const e=a[i];o[i]<e.dirtyId&&(o[i]=e.dirtyId,e.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,i,e.resource.width,e.resource.height,1,t.format,n.type,e.resource.source))}return!0}});let Zo;function Jo(e){const t=Q.ADAPTER.createCanvas(6,1),n=t.getContext("2d");return n.fillStyle=e,n.fillRect(0,0,6,1),t}function Qo(){if(typeof document>"u")return!1;if(void 0!==Zo)return Zo;const e=Jo("#ff00ff"),t=Jo("#ffff00"),n=Q.ADAPTER.createCanvas(6,1).getContext("2d");n.globalCompositeOperation="multiply",n.drawImage(e,0,0),n.drawImage(t,2,0);const r=n.getImageData(2,0,1,1);if(r){const e=r.data;Zo=255===e[0]&&0===e[1]&&0===e[2]}else Zo=!1;return Zo}sn.prototype.getDrawableSource=function(){const e=this.resource;return e?e.bitmap||e.source:null},br.prototype._canvasRenderTarget=null,kr.prototype.patternCache=null,kr.prototype.tintCache=null;const ea=new Pn;class ta{constructor(e){this.activeResolution=1,this.smoothProperty="imageSmoothingEnabled",this.blendModes=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Qo()?(e[B.NORMAL]="source-over",e[B.ADD]="lighter",e[B.MULTIPLY]="multiply",e[B.SCREEN]="screen",e[B.OVERLAY]="overlay",e[B.DARKEN]="darken",e[B.LIGHTEN]="lighten",e[B.COLOR_DODGE]="color-dodge",e[B.COLOR_BURN]="color-burn",e[B.HARD_LIGHT]="hard-light",e[B.SOFT_LIGHT]="soft-light",e[B.DIFFERENCE]="difference",e[B.EXCLUSION]="exclusion",e[B.HUE]="hue",e[B.SATURATION]="saturation",e[B.COLOR]="color",e[B.LUMINOSITY]="luminosity"):(e[B.NORMAL]="source-over",e[B.ADD]="lighter",e[B.MULTIPLY]="source-over",e[B.SCREEN]="source-over",e[B.OVERLAY]="source-over",e[B.DARKEN]="source-over",e[B.LIGHTEN]="source-over",e[B.COLOR_DODGE]="source-over",e[B.COLOR_BURN]="source-over",e[B.HARD_LIGHT]="source-over",e[B.SOFT_LIGHT]="source-over",e[B.DIFFERENCE]="source-over",e[B.EXCLUSION]="source-over",e[B.HUE]="source-over",e[B.SATURATION]="source-over",e[B.COLOR]="source-over",e[B.LUMINOSITY]="source-over"),e[B.NORMAL_NPM]=e[B.NORMAL],e[B.ADD_NPM]=e[B.ADD],e[B.SCREEN_NPM]=e[B.SCREEN],e[B.SRC_IN]="source-in",e[B.SRC_OUT]="source-out",e[B.SRC_ATOP]="source-atop",e[B.DST_OVER]="destination-over",e[B.DST_IN]="destination-in",e[B.DST_OUT]="destination-out",e[B.DST_ATOP]="destination-atop",e[B.XOR]="xor",e[B.SUBTRACT]="source-over",e}(),this._activeBlendMode=null,this._projTransform=null,this._outerBlend=!1,this.renderer=e}init(){const e=this.renderer.background.alpha<1;if(this.rootContext=this.renderer.view.getContext("2d",{alpha:e}),this.activeContext=this.rootContext,!this.rootContext.imageSmoothingEnabled){const e=this.rootContext;e.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":e.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":e.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":e.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")}}setContextTransform(e,t,n){let r=e;const o=this._projTransform,a=this.activeResolution;n=n||a,o&&(r=ea,r.copyFrom(e),r.prepend(o)),t?this.activeContext.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*a|0,r.ty*a|0):this.activeContext.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*a,r.ty*a)}clear(e,t){const{activeContext:n,renderer:r}=this,o=e?lt.shared.setValue(e):this.renderer.background.backgroundColor;n.clearRect(0,0,r.width,r.height),e&&(n.globalAlpha=t??this.renderer.background.alpha,n.fillStyle=o.toHex(),n.fillRect(0,0,r.width,r.height),n.globalAlpha=1)}setBlendMode(e,t){const n=e===B.SRC_IN||e===B.SRC_OUT||e===B.DST_IN||e===B.DST_ATOP;!t&&n&&(e=B.NORMAL),this._activeBlendMode!==e&&(this._activeBlendMode=e,this._outerBlend=n,this.activeContext.globalCompositeOperation=this.blendModes[e])}resize(){this.smoothProperty&&(this.rootContext[this.smoothProperty]=sn.defaultOptions.scaleMode===U.LINEAR)}invalidateBlendMode(){this._activeBlendMode=this.blendModes.indexOf(this.activeContext.globalCompositeOperation)}destroy(){this.renderer=null,this.rootContext=null,this.activeContext=null,this.smoothProperty=null}}ta.extension={type:qt.CanvasRendererSystem,name:"canvasContext"},Yt.add(ta);class na{constructor(e){this._foundShapes=[],this.renderer=e}pushMask(e){const t=this.renderer,n=e.maskObject||e;t.canvasContext.activeContext.save();const r=this._foundShapes;if(this.recursiveFindShapes(n,r),r.length>0){const e=t.canvasContext.activeContext;e.beginPath();for(let t=0;t<r.length;t++){const e=r[t],n=e.transform.worldTransform;this.renderer.canvasContext.setContextTransform(n),this.renderGraphicsShape(e)}r.length=0,e.clip()}}recursiveFindShapes(e,t){e.geometry&&e.geometry.graphicsData&&t.push(e);const{children:n}=e;if(n)for(let r=0;r<n.length;r++)this.recursiveFindShapes(n[r],t)}renderGraphicsShape(e){e.finishPoly();const t=this.renderer.canvasContext.activeContext,n=e.geometry.graphicsData,r=n.length;if(0!==r)for(let o=0;o<r;o++){const e=n[o],r=e.shape;if(r.type===wn.POLY){let n=r.points;const o=e.holes;let a,s,i,l;t.moveTo(n[0],n[1]);for(let e=1;e<n.length/2;e++)t.lineTo(n[2*e],n[2*e+1]);if(o.length>0){a=0,i=n[0],l=n[1];for(let e=2;e+2<n.length;e+=2)a+=(n[e]-i)*(n[e+3]-l)-(n[e+2]-i)*(n[e+1]-l);for(let e=0;e<o.length;e++)if(n=o[e].shape.points,n){s=0,i=n[0],l=n[1];for(let e=2;e+2<n.length;e+=2)s+=(n[e]-i)*(n[e+3]-l)-(n[e+2]-i)*(n[e+1]-l);if(s*a<0){t.moveTo(n[0],n[1]);for(let e=2;e<n.length;e+=2)t.lineTo(n[e],n[e+1])}else{t.moveTo(n[n.length-2],n[n.length-1]);for(let e=n.length-4;e>=0;e-=2)t.lineTo(n[e],n[e+1])}o[e].shape.closeStroke&&t.closePath()}}n[0]===n[n.length-2]&&n[1]===n[n.length-1]&&t.closePath()}else if(r.type===wn.RECT)t.rect(r.x,r.y,r.width,r.height),t.closePath();else if(r.type===wn.CIRC)t.arc(r.x,r.y,r.radius,0,2*Math.PI),t.closePath();else if(r.type===wn.ELIP){const e=2*r.width,n=2*r.height,o=r.x-e/2,a=r.y-n/2,s=.5522848,i=e/2*s,l=n/2*s,c=o+e,d=a+n,u=o+e/2,h=a+n/2;t.moveTo(o,h),t.bezierCurveTo(o,h-l,u-i,a,u,a),t.bezierCurveTo(u+i,a,c,h-l,c,h),t.bezierCurveTo(c,h+l,u+i,d,u,d),t.bezierCurveTo(u-i,d,o,h+l,o,h),t.closePath()}else if(r.type===wn.RREC){const e=r.x,n=r.y,o=r.width,a=r.height;let s=r.radius;const i=Math.min(o,a)/2;s=s>i?i:s,t.moveTo(e,n+s),t.lineTo(e,n+a-s),t.quadraticCurveTo(e,n+a,e+s,n+a),t.lineTo(e+o-s,n+a),t.quadraticCurveTo(e+o,n+a,e+o,n+a-s),t.lineTo(e+o,n+s),t.quadraticCurveTo(e+o,n,e+o-s,n),t.lineTo(e+s,n),t.quadraticCurveTo(e,n,e,n+s),t.closePath()}}}popMask(e){e.canvasContext.activeContext.restore(),e.canvasContext.invalidateBlendMode()}destroy(){}}na.extension={type:qt.CanvasRendererSystem,name:"mask"},Yt.add(na);class ra{constructor(e){this.renderer=e}render(e,t){const n=this.renderer;if(!n.view)return;const r=n.canvasContext;let o,a,s,i;t&&(o=t.renderTexture,a=t.clear,s=t.transform,i=t.skipUpdateTransform),this.renderingToScreen=!o,n.emit("prerender");const l=n.resolution;o?(o=o.castToBaseTexture(),o._canvasRenderTarget||(o._canvasRenderTarget=new Bt(o.width,o.height,o.resolution),o.resource=new Uo(o._canvasRenderTarget.canvas),o.valid=!0),r.activeContext=o._canvasRenderTarget.context,n.canvasContext.activeResolution=o._canvasRenderTarget.resolution):(r.activeContext=r.rootContext,r.activeResolution=l);const c=r.activeContext;if(r._projTransform=s||null,o||(this.lastObjectRendered=e),!i){const t=e.enableTempParent();e.updateTransform(),e.disableTempParent(t)}if(c.save(),c.setTransform(1,0,0,1,0,0),c.globalAlpha=1,r._activeBlendMode=B.NORMAL,r._outerBlend=!1,c.globalCompositeOperation=r.blendModes[B.NORMAL],a??n.background.clearBeforeRender)if(this.renderingToScreen){c.clearRect(0,0,n.width,n.height);const e=n.background;e.alpha>0&&(c.globalAlpha=e.backgroundColor.alpha,c.fillStyle=e.backgroundColor.toHex(),c.fillRect(0,0,n.width,n.height),c.globalAlpha=1)}else o._canvasRenderTarget.clear(),o.clear.alpha>0&&(c.globalAlpha=o.clear.alpha,c.fillStyle=o.clear.toHex(),c.fillRect(0,0,o.realWidth,o.realHeight),c.globalAlpha=1);const d=r.activeContext;r.activeContext=c,e.renderCanvas(n),r.activeContext=d,c.restore(),r.activeResolution=l,r._projTransform=null,n.emit("postrender")}destroy(){this.lastObjectRendered=null,this.render=null}}ra.extension={type:qt.CanvasRendererSystem,name:"objectRenderer"},Yt.add(ra);const{deprecation:oa}=e,aa=class e extends So{constructor(t){super(),this.type=D.CANVAS,this.rendererLogId="Canvas",t=Object.assign({},Q.RENDER_OPTIONS,t);const n={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:e.__systems,priority:["textureGenerator","background","_view","_plugin","startup","mask","canvasContext","objectRenderer"]};this.setup(n),"useContextAlpha"in t&&(oa("7.0.0","options.useContextAlpha is deprecated, use options.backgroundAlpha instead"),t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=e.__plugins,this.options=t,this.startup.run(this.options)}static test(){return!0}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}reset(){}render(e,t){this.objectRenderer.render(e,t)}clear(){this.canvasContext.clear()}destroy(e){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}resize(e,t){this._view.resizeView(e,t)}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get clearBeforeRender(){return this.background.clearBeforeRender}get blendModes(){return oa("7.0.0","renderer.blendModes has been deprecated, please use renderer.canvasContext.blendModes instead"),this.canvasContext.blendModes}get maskManager(){return oa("7.0.0","renderer.maskManager has been deprecated, please use renderer.mask instead"),this.mask}get refresh(){return oa("7.0.0","renderer.refresh has been deprecated"),!0}get rootContext(){return oa("7.0.0","renderer.rootContext has been deprecated, please use renderer.canvasContext.rootContext instead"),this.canvasContext.rootContext}get context(){return oa("7.0.0","renderer.context has been deprecated, please use renderer.canvasContext.activeContext instead"),this.canvasContext.activeContext}get smoothProperty(){return oa("7.0.0","renderer.smoothProperty has been deprecated, please use renderer.canvasContext.smoothProperty instead"),this.canvasContext.smoothProperty}setBlendMode(e,t){oa("7.0.0","renderer.setBlendMode has been deprecated, use renderer.canvasContext.setBlendMode instead"),this.canvasContext.setBlendMode(e,t)}invalidateBlendMode(){oa("7.0.0","renderer.invalidateBlendMode has been deprecated, use renderer.canvasContext.invalidateBlendMode instead"),this.canvasContext.invalidateBlendMode()}setContextTransform(e,t,n){oa("7.0.0","renderer.setContextTransform has been deprecated, use renderer.canvasContext.setContextTransform instead"),this.canvasContext.setContextTransform(e,t,n)}get backgroundColor(){return oa("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){oa("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return oa("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){oa("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get preserveDrawingBuffer(){return oa("7.0.0","renderer.preserveDrawingBuffer has been deprecated"),!1}get useContextAlpha(){return oa("7.0.0","renderer.useContextAlpha has been deprecated"),!1}};aa.extension={type:qt.Renderer,priority:0},aa.__plugins={},aa.__systems={};let sa=aa;Yt.handleByMap(qt.CanvasRendererPlugin,sa.__plugins),Yt.handleByMap(qt.CanvasRendererSystem,sa.__systems),Yt.add(sa);const ia={canvas:null,getTintedCanvas:(e,t)=>{const n=e.texture,r=lt.shared.setValue(t).toHex();n.tintCache=n.tintCache||{};const o=n.tintCache[r];let a;if(o){if(o.tintId===n._updateID)return n.tintCache[r];a=n.tintCache[r]}else a=Q.ADAPTER.createCanvas();if(ia.tintMethod(n,t,a),a.tintId=n._updateID,ia.convertTintToImage&&void 0!==a.toDataURL){const e=new Image;e.src=a.toDataURL(),n.tintCache[r]=e}else n.tintCache[r]=a;return a},getTintedPattern:(e,t)=>{const n=lt.shared.setValue(t).toHex();e.patternCache=e.patternCache||{};let r=e.patternCache[n];return r?.tintId===e._updateID||(ia.canvas||(ia.canvas=Q.ADAPTER.createCanvas()),ia.tintMethod(e,t,ia.canvas),r=ia.canvas.getContext("2d").createPattern(ia.canvas,"repeat"),r.tintId=e._updateID,e.patternCache[n]=r),r},tintWithMultiply:(e,t,n)=>{const r=n.getContext("2d"),o=e._frame.clone(),a=e.baseTexture.resolution;o.x*=a,o.y*=a,o.width*=a,o.height*=a,n.width=Math.ceil(o.width),n.height=Math.ceil(o.height),r.save(),r.fillStyle=lt.shared.setValue(t).toHex(),r.fillRect(0,0,o.width,o.height),r.globalCompositeOperation="multiply";const s=e.baseTexture.getDrawableSource();r.drawImage(s,o.x,o.y,o.width,o.height,0,0,o.width,o.height),r.globalCompositeOperation="destination-atop",r.drawImage(s,o.x,o.y,o.width,o.height,0,0,o.width,o.height),r.restore()},tintWithOverlay:(e,t,n)=>{const r=n.getContext("2d"),o=e._frame.clone(),a=e.baseTexture.resolution;o.x*=a,o.y*=a,o.width*=a,o.height*=a,n.width=Math.ceil(o.width),n.height=Math.ceil(o.height),r.save(),r.globalCompositeOperation="copy",r.fillStyle=`#${`00000${(0|t).toString(16)}`.slice(-6)}`,r.fillRect(0,0,o.width,o.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.getDrawableSource(),o.x,o.y,o.width,o.height,0,0,o.width,o.height),r.restore()},tintWithPerPixel:(e,t,n)=>{const r=n.getContext("2d"),o=e._frame.clone(),a=e.baseTexture.resolution;o.x*=a,o.y*=a,o.width*=a,o.height*=a,n.width=Math.ceil(o.width),n.height=Math.ceil(o.height),r.save(),r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.getDrawableSource(),o.x,o.y,o.width,o.height,0,0,o.width,o.height),r.restore();const[s,i,l]=lt.shared.setValue(t).toArray(),c=r.getImageData(0,0,o.width,o.height),d=c.data;for(let u=0;u<d.length;u+=4)d[u+0]*=s,d[u+1]*=i,d[u+2]*=l;r.putImageData(c,0,0)},roundColor:e=>(Se("7.3.0","PIXI.canvasUtils.roundColor is deprecated"),lt.shared.setValue(e).round(ia.cacheStepsPerColorChannel).toNumber()),cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:Qo(),tintMethod:null};ia.tintMethod=ia.canUseMultiply?ia.tintWithMultiply:ia.tintWithPerPixel;class la{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?Cn.EMPTY:((e=e||new Cn(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:n,b:r,c:o,d:a,tx:s,ty:i}=e,l=n*t.x+o*t.y+s,c=r*t.x+a*t.y+i;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(e){let t=this.minX,n=this.minY,r=this.maxX,o=this.maxY,a=e[0],s=e[1];t=a<t?a:t,n=s<n?s:n,r=a>r?a:r,o=s>o?s:o,a=e[2],s=e[3],t=a<t?a:t,n=s<n?s:n,r=a>r?a:r,o=s>o?s:o,a=e[4],s=e[5],t=a<t?a:t,n=s<n?s:n,r=a>r?a:r,o=s>o?s:o,a=e[6],s=e[7],t=a<t?a:t,n=s<n?s:n,r=a>r?a:r,o=s>o?s:o,this.minX=t,this.minY=n,this.maxX=r,this.maxY=o}addFrame(e,t,n,r,o){this.addFrameMatrix(e.worldTransform,t,n,r,o)}addFrameMatrix(e,t,n,r,o){const a=e.a,s=e.b,i=e.c,l=e.d,c=e.tx,d=e.ty;let u=this.minX,h=this.minY,p=this.maxX,m=this.maxY,f=a*t+i*n+c,g=s*t+l*n+d;u=f<u?f:u,h=g<h?g:h,p=f>p?f:p,m=g>m?g:m,f=a*r+i*n+c,g=s*r+l*n+d,u=f<u?f:u,h=g<h?g:h,p=f>p?f:p,m=g>m?g:m,f=a*t+i*o+c,g=s*t+l*o+d,u=f<u?f:u,h=g<h?g:h,p=f>p?f:p,m=g>m?g:m,f=a*r+i*o+c,g=s*r+l*o+d,u=f<u?f:u,h=g<h?g:h,p=f>p?f:p,m=g>m?g:m,this.minX=u,this.minY=h,this.maxX=p,this.maxY=m}addVertexData(e,t,n){let r=this.minX,o=this.minY,a=this.maxX,s=this.maxY;for(let i=t;i<n;i+=2){const t=e[i],n=e[i+1];r=t<r?t:r,o=n<o?n:o,a=t>a?t:a,s=n>s?n:s}this.minX=r,this.minY=o,this.maxX=a,this.maxY=s}addVertices(e,t,n,r){this.addVerticesMatrix(e.worldTransform,t,n,r)}addVerticesMatrix(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:o;const s=e.a,i=e.b,l=e.c,c=e.d,d=e.tx,u=e.ty;let h=this.minX,p=this.minY,m=this.maxX,f=this.maxY;for(let g=n;g<r;g+=2){const e=t[g],n=t[g+1],r=s*e+l*n+d,y=c*n+i*e+u;h=Math.min(h,r-o),m=Math.max(m,r+o),p=Math.min(p,y-a),f=Math.max(f,y+a)}this.minX=h,this.minY=p,this.maxX=m,this.maxY=f}addBounds(e){const t=this.minX,n=this.minY,r=this.maxX,o=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<n?e.minY:n,this.maxX=e.maxX>r?e.maxX:r,this.maxY=e.maxY>o?e.maxY:o}addBoundsMask(e,t){const n=e.minX>t.minX?e.minX:t.minX,r=e.minY>t.minY?e.minY:t.minY,o=e.maxX<t.maxX?e.maxX:t.maxX,a=e.maxY<t.maxY?e.maxY:t.maxY;if(n<=o&&r<=a){const e=this.minX,t=this.minY,s=this.maxX,i=this.maxY;this.minX=n<e?n:e,this.minY=r<t?r:t,this.maxX=o>s?o:s,this.maxY=a>i?a:i}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const n=e.minX>t.x?e.minX:t.x,r=e.minY>t.y?e.minY:t.y,o=e.maxX<t.x+t.width?e.maxX:t.x+t.width,a=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(n<=o&&r<=a){const e=this.minX,t=this.minY,s=this.maxX,i=this.maxY;this.minX=n<e?n:e,this.minY=r<t?r:t,this.maxX=o>s?o:s,this.maxY=a>i?a:i}}pad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,n,r,o,a){e-=o,t-=a,n+=o,r+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>r?this.maxY:r}}class ca extends ve{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new $n,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new la,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let n=0;n<t.length;++n){const r=t[n];Object.defineProperty(ca.prototype,r,Object.getOwnPropertyDescriptor(e,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new Cn),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new Cn),e=this._localBoundsRect),this._localBounds||(this._localBounds=new la);const t=this.transform,n=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=n?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,e);return this.parent=n,this.transform=t,this._bounds=r,this._bounds.updateID+=this._boundsID-o,a}toGlobal(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,n,r){return t&&(e=t.toGlobal(e,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,n)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.position.x=e,this.position.y=t,this.scale.x=n||1,this.scale.y=r||1,this.rotation=o,this.skew.x=a,this.skew.y=s,this.pivot.x=i,this.pivot.y=l,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new da),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*bn}set angle(e){this.transform.rotation=e*xn}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=e,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class da extends ca{constructor(){super(...arguments),this.sortDirty=null}}ca.prototype.displayObjectUpdateTransform=ca.prototype.updateTransform;const ua=new Pn;function ha(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const pa=class e extends ca{constructor(){super(),this.children=[],this.sortableChildren=e.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(){if(arguments.length>1)for(let e=0;e<arguments.length;e++)this.addChild(e<0||arguments.length<=e?void 0:arguments[e]);else{const e=arguments.length<=0?void 0:arguments[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return arguments.length<=0?void 0:arguments[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const n=this.getChildIndex(e),r=this.getChildIndex(t);this.children[n]=t,this.children[r]=e,this.onChildrenChange(n<r?n:r)}getChildIndex(e){const t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(e);At(this.children,n,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(){if(arguments.length>1)for(let e=0;e<arguments.length;e++)this.removeChild(e<0||arguments.length<=e?void 0:arguments[e]);else{const e=arguments.length<=0?void 0:arguments[0],t=this.children.indexOf(e);if(-1===t)return null;e.parent=null,e.transform._parentID=-1,At(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t)}return arguments.length<=0?void 0:arguments[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,At(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.children.length;const n=e,r=t-n;let o;if(r>0&&r<=t){o=this.children.splice(n,r);for(let e=0;e<o.length;++e)o[e].parent=null,o[e].transform&&(o[e].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let e=0;e<o.length;++e)o[e].emit("removed",this),this.emit("childRemoved",o[e],this,e);return o}if(0===r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,n=this.children.length;t<n;++t){const n=this.children[t];n._lastSortedIndex=t,!e&&0!==n.zIndex&&(e=!0)}e&&this.children.length>1&&this.children.sort(ha),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.visible&&t.renderable)if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=super.getLocalBounds(e);if(!t)for(let r=0,o=this.children.length;r<o;++r){const e=this.children[r];e.visible&&e.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(t){const n=t.renderTexture.sourceFrame;if(!(n.width>0&&n.height>0))return;let r,o;this.cullArea?(r=this.cullArea,o=this.worldTransform):this._render!==e.prototype._render&&(r=this.getBounds(!0));const a=t.projection.transform;if(a&&(o?(o=ua.copyFrom(o),o.prepend(a)):o=a),r&&n.intersects(r,o))this._render(t);else if(this.cullArea)return;for(let e=0,s=this.children.length;e<s;++e){const n=this.children[e],r=n.cullable;n.cullable=r||!this.cullArea,n.render(t),n.cullable=r}}render(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].render(e)}}renderAdvanced(e){const t=this.filters,n=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let e=0;e<t.length;e++)t[e].enabled&&this._enabledFilters.push(t[e])}const r=t&&this._enabledFilters?.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==X.NONE));if(r&&e.batch.flush(),t&&this._enabledFilters?.length&&e.filter.push(this,this._enabledFilters),n&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].render(e)}r&&e.batch.flush(),n&&e.mask.pop(this),t&&this._enabledFilters?.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t="boolean"==typeof e?e:e?.children,n=this.removeChildren(0,this.children.length);if(t)for(let r=0;r<n.length;++r)n[r].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}};pa.defaultSortableChildren=!1;let ma=pa;ma.prototype.containerUpdateTransform=ma.prototype.updateTransform,Object.defineProperties(Q,{SORTABLE_CHILDREN:{get:()=>ma.defaultSortableChildren,set(e){Se("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ma.defaultSortableChildren=e}}});const fa=new Sn,ga=new Uint16Array([0,1,2,0,2,3]);class ya extends ma{constructor(e){super(),this._anchor=new Ln(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new lt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=B.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||kr.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=ga,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Q.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=It(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=It(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,n=t.a,r=t.b,o=t.c,a=t.d,s=t.tx,i=t.ty,l=this.vertexData,c=e.trim,d=e.orig,u=this._anchor;let h=0,p=0,m=0,f=0;if(c?(p=c.x-u._x*d.width,h=p+c.width,f=c.y-u._y*d.height,m=f+c.height):(p=-u._x*d.width,h=p+d.width,f=-u._y*d.height,m=f+d.height),l[0]=n*p+o*f+s,l[1]=a*f+r*p+i,l[2]=n*h+o*f+s,l[3]=a*f+r*h+i,l[4]=n*h+o*m+s,l[5]=a*m+r*h+i,l[6]=n*p+o*m+s,l[7]=a*m+r*p+i,this._roundPixels){const e=Q.RESOLUTION;for(let t=0;t<l.length;++t)l[t]=Math.round(l[t]*e)/e}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,n=e.orig,r=this._anchor,o=this.transform.worldTransform,a=o.a,s=o.b,i=o.c,l=o.d,c=o.tx,d=o.ty,u=-r._x*n.width,h=u+n.width,p=-r._y*n.height,m=p+n.height;if(t[0]=a*u+i*p+c,t[1]=l*p+s*u+d,t[2]=a*h+i*p+c,t[3]=l*p+s*h+d,t[4]=a*h+i*m+c,t[5]=l*m+s*h+d,t[6]=a*u+i*m+c,t[7]=l*m+s*u+d,this._roundPixels){const e=Q.RESOLUTION;for(let n=0;n<t.length;++n)t[n]=Math.round(t[n]*e)/e}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return 0===this.children.length?(this._localBounds||(this._localBounds=new la),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Cn),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,fa);const t=this._texture.orig.width,n=this._texture.orig.height,r=-t*this.anchor.x;let o=0;return fa.x>=r&&fa.x<r+t&&(o=-n*this.anchor.y,fa.y>=o&&fa.y<o+n)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e?.texture){const t="boolean"==typeof e?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const n=e instanceof kr?e:kr.from(e,t);return new ya(n)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=It(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=It(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||kr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const va=new Sn;class ba extends ya{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;super(e),this.tileTransform=new $n,this._width=t,this._height=n,this.uvMatrix=this.texture.uvMatrix||new $r(e),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(e){this.tileTransform.scale.copyFrom(e)}get tilePosition(){return this.tileTransform.position}set tilePosition(e){this.tileTransform.position.copyFrom(e)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(e){const t=this._texture;!t||!t.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))}_calculateBounds(){const e=this._width*-this._anchor._x,t=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,t,n,r)}getLocalBounds(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Cn),e=this._localBoundsRect),this._bounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,va);const t=this._width,n=this._height,r=-t*this.anchor._x;if(va.x>=r&&va.x<r+t){const e=-n*this.anchor._y;if(va.y>=e&&va.y<e+n)return!0}return!1}destroy(e){super.destroy(e),this.tileTransform=null,this.uvMatrix=null}static from(e,t){const n=e instanceof kr?e:kr.from(e,t);return new ba(n,t.width,t.height)}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}}var xa="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const wa=new Pn;class Sa extends cr{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new Pr,this.state=Jt.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=sr.from(xa,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",t),this.shader=e.context.webGLVersion>1?sr.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",t):sr.from(xa,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",t)}render(e){const t=this.renderer,n=this.quad;let r=n.vertices;r[0]=r[6]=e._width*-e.anchor.x,r[1]=r[3]=e._height*-e.anchor.y,r[2]=r[4]=e._width*(1-e.anchor.x),r[5]=r[7]=e._height*(1-e.anchor.y);const o=e.uvRespectAnchor?e.anchor.x:0,a=e.uvRespectAnchor?e.anchor.y:0;r=n.uvs,r[0]=r[6]=-o,r[1]=r[3]=-a,r[2]=r[4]=1-o,r[5]=r[7]=1-a,n.invalidate();const s=e._texture,i=s.baseTexture,l=i.alphaMode>0,c=e.tileTransform.localTransform,d=e.uvMatrix;let u=i.isPowerOfTwo&&s.frame.width===i.width&&s.frame.height===i.height;u&&(i._glTextures[t.CONTEXT_UID]?u=i.wrapMode!==H.CLAMP:i.wrapMode===H.CLAMP&&(i.wrapMode=H.REPEAT));const h=u?this.simpleShader:this.shader,p=s.width,m=s.height,f=e._width,g=e._height;wa.set(c.a*p/f,c.b*p/g,c.c*m/f,c.d*m/g,c.tx/f,c.ty/g),wa.invert(),u?wa.prepend(d.mapCoord):(h.uniforms.uMapCoord=d.mapCoord.toArray(!0),h.uniforms.uClampFrame=d.uClampFrame,h.uniforms.uClampOffset=d.uClampOffset),h.uniforms.uTransform=wa.toArray(!0),h.uniforms.uColor=lt.shared.setValue(e.tint).premultiply(e.worldAlpha,l).toArray(h.uniforms.uColor),h.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),h.uniforms.uSampler=s,t.shader.bind(h),t.geometry.bind(n),this.state.blendMode=mt(e.blendMode,l),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Sa.extension={name:"tilingSprite",type:qt.RendererPlugin},Yt.add(Sa);const Ta=new Pn,Ca=new Pn,ka=[new Sn,new Sn,new Sn,new Sn];ba.prototype._renderCanvas=function(e){const t=this._texture;if(!t.baseTexture.valid)return;const n=e.canvasContext.activeContext,r=this.worldTransform,o=t.baseTexture,a=o.getDrawableSource(),s=o.resolution;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tintValue){this._textureID=this._texture._updateID;const e=new Bt(t._frame.width,t._frame.height,s);16777215!==this.tintValue?(this._tintedCanvas=ia.getTintedCanvas(this,this.tintValue),e.context.drawImage(this._tintedCanvas,0,0)):e.context.drawImage(a,-t._frame.x*s,-t._frame.y*s),this._cachedTint=this.tintValue,this._canvasPattern=e.context.createPattern(e.canvas,"repeat")}n.globalAlpha=this.worldAlpha,e.canvasContext.setBlendMode(this.blendMode),this.tileTransform.updateLocalTransform();const i=this.tileTransform.localTransform,l=this._width,c=this._height;Ta.identity(),Ca.copyFrom(i),this.uvRespectAnchor||Ca.translate(-this.anchor.x*l,-this.anchor.y*c),Ca.scale(1/s,1/s),Ta.prepend(Ca),Ta.prepend(r),e.canvasContext.setContextTransform(Ta),n.fillStyle=this._canvasPattern;const d=this.anchor.x*-l,u=this.anchor.y*-c;ka[0].set(d,u),ka[1].set(d+l,u),ka[2].set(d+l,u+c),ka[3].set(d,u+c);for(let h=0;h<4;h++)Ca.applyInverse(ka[h],ka[h]);n.beginPath(),n.moveTo(ka[0].x,ka[0].y);for(let h=1;h<4;h++)n.lineTo(ka[h].x,ka[h].y);n.closePath(),n.fill()};class Aa{constructor(e,t,n){this.geometry=new gn,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<e.length;++r){let n=e[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||G.FLOAT,offset:n.offset},t[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new dn(bt(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const e=this.dynamicProperties[a];e.offset=t,t+=e.size,this.dynamicStride+=e.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new dn(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const e=this.staticProperties[a];e.offset=r,r+=e.size,this.staticStride+=e.size}const o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new dn(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const t=this.dynamicProperties[a];e.addAttribute(t.attributeName,this.dynamicBuffer,0,t.type===G.UNSIGNED_BYTE,t.type,4*this.dynamicStride,4*t.offset)}for(let a=0;a<this.staticProperties.length;++a){const t=this.staticProperties[a];e.addAttribute(t.attributeName,this.staticBuffer,0,t.type===G.UNSIGNED_BYTE,t.type,4*this.staticStride,4*t.offset)}}uploadDynamic(e,t,n){for(let r=0;r<this.dynamicProperties.length;r++){const o=this.dynamicProperties[r];o.uploadFunction(e,t,n,o.type===G.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,n){for(let r=0;r<this.staticProperties.length;r++){const o=this.staticProperties[r];o.uploadFunction(e,t,n,o.type===G.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class Ia extends cr{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new Pn,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:G.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=sr.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=Jt.for2d()}render(e){const t=e.children,n=e._maxSize,r=e._batchSize,o=this.renderer;let a=t.length;if(0===a)return;a>n&&!e.autoResize&&(a=n);let s=e._buffers;s||(s=e._buffers=this.generateBuffers(e));const i=t[0]._texture.baseTexture,l=i.alphaMode>0;this.state.blendMode=mt(e.blendMode,l),o.state.set(this.state);const c=o.gl,d=e.worldTransform.copyTo(this.tempMatrix);d.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=lt.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=i,this.renderer.shader.bind(this.shader);let u=!1;for(let h=0,p=0;h<a;h+=r,p+=1){let n=a-h;n>r&&(n=r),p>=s.length&&s.push(this._generateOneMoreBuffer(e));const i=s[p];i.uploadDynamic(t,h,n);const l=e._bufferUpdateIDs[p]||0;u=u||i._updateID<l,u&&(i._updateID=e._updateID,i.uploadStatic(t,h,n)),o.geometry.bind(i.geometry),c.drawElements(c.TRIANGLES,6*n,c.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],n=e._maxSize,r=e._batchSize,o=e._properties;for(let a=0;a<n;a+=r)t.push(new Aa(this.properties,o,r));return t}_generateOneMoreBuffer(e){const t=e._batchSize,n=e._properties;return new Aa(this.properties,n,t)}uploadVertices(e,t,n,r,o,a){let s=0,i=0,l=0,c=0;for(let d=0;d<n;++d){const n=e[t+d],u=n._texture,h=n.scale.x,p=n.scale.y,m=u.trim,f=u.orig;m?(i=m.x-n.anchor.x*f.width,s=i+m.width,c=m.y-n.anchor.y*f.height,l=c+m.height):(s=f.width*(1-n.anchor.x),i=f.width*-n.anchor.x,l=f.height*(1-n.anchor.y),c=f.height*-n.anchor.y),r[a]=i*h,r[a+1]=c*p,r[a+o]=s*h,r[a+o+1]=c*p,r[a+2*o]=s*h,r[a+2*o+1]=l*p,r[a+3*o]=i*h,r[a+3*o+1]=l*p,a+=4*o}}uploadPosition(e,t,n,r,o,a){for(let s=0;s<n;s++){const n=e[t+s].position;r[a]=n.x,r[a+1]=n.y,r[a+o]=n.x,r[a+o+1]=n.y,r[a+2*o]=n.x,r[a+2*o+1]=n.y,r[a+3*o]=n.x,r[a+3*o+1]=n.y,a+=4*o}}uploadRotation(e,t,n,r,o,a){for(let s=0;s<n;s++){const n=e[t+s].rotation;r[a]=n,r[a+o]=n,r[a+2*o]=n,r[a+3*o]=n,a+=4*o}}uploadUvs(e,t,n,r,o,a){for(let s=0;s<n;++s){const n=e[t+s]._texture._uvs;n?(r[a]=n.x0,r[a+1]=n.y0,r[a+o]=n.x1,r[a+o+1]=n.y1,r[a+2*o]=n.x2,r[a+2*o+1]=n.y2,r[a+3*o]=n.x3,r[a+3*o+1]=n.y3,a+=4*o):(r[a]=0,r[a+1]=0,r[a+o]=0,r[a+o+1]=0,r[a+2*o]=0,r[a+2*o+1]=0,r[a+3*o]=0,r[a+3*o+1]=0,a+=4*o)}}uploadTint(e,t,n,r,o,a){for(let s=0;s<n;++s){const n=e[t+s],i=lt.shared.setValue(n._tintRGB).toPremultiplied(n.alpha,n.texture.baseTexture.alphaMode>0);r[a]=i,r[a+o]=i,r[a+2*o]=i,r[a+3*o]=i,a+=4*o}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Ia.extension={name:"particle",type:qt.RendererPlugin},Yt.add(Ia),class extends ma{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16384,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super();n>16384&&(n=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=n,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=B.NORMAL,this.autoResize=r,this.roundPixels=!0,this.baseTexture=null,this.setProperties(t),this._tintColor=new lt(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintColor.toRgbArray(this.tintRgb)}render(e){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(()=>this.onChildrenChange(0)))),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))}onChildrenChange(e){const t=Math.floor(e/this._batchSize);for(;this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID}dispose(){if(this._buffers){for(let e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}}destroy(e){super.destroy(e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}.prototype.renderCanvas=function(e){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable)return;const t=e.canvasContext.activeContext,n=this.worldTransform;let r=!0,o=0,a=0,s=0,i=0;e.canvasContext.setBlendMode(this.blendMode),t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(let l=0;l<this.children.length;++l){const c=this.children[l];if(!c.visible||!c._texture.valid)continue;const d=c._texture.frame;if(t.globalAlpha=this.worldAlpha*c.alpha,c.rotation%(2*Math.PI)===0)r&&(e.canvasContext.setContextTransform(n,!1,1),r=!1),o=c.anchor.x*(-d.width*c.scale.x)+c.position.x+.5,a=c.anchor.y*(-d.height*c.scale.y)+c.position.y+.5,s=d.width*c.scale.x,i=d.height*c.scale.y;else{r||(r=!0),c.displayObjectUpdateTransform();const t=c.worldTransform;e.canvasContext.setContextTransform(t,this.roundPixels,1),o=c.anchor.x*-d.width+.5,a=c.anchor.y*-d.height+.5,s=d.width,i=d.height}const u=c._texture.baseTexture.resolution,h=e.canvasContext.activeResolution;t.drawImage(c._texture.baseTexture.getDrawableSource(),d.x*u,d.y*u,d.width*u,d.height*u,o*h,a*h,s*h,i*h)}},ma.prototype._renderCanvas=function(e){},ma.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&e.mask.pushMask(this._mask),this._renderCanvas(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].renderCanvas(e);this._mask&&e.mask.popMask(e)}},ca.prototype.renderCanvas=function(e){};var Ea=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(Ea||{});const Pa={willReadFrequently:!0},_a=class e{static get experimentalLetterSpacingSupported(){let t=e._experimentalLetterSpacingSupported;if(void 0!==t){const n=Q.ADAPTER.getCanvasRenderingContext2D().prototype;t=e._experimentalLetterSpacingSupported="letterSpacing"in n||"textLetterSpacing"in n}return t}constructor(e,t,n,r,o,a,s,i,l){this.text=e,this.style=t,this.width=n,this.height=r,this.lines=o,this.lineWidths=a,this.lineHeight=s,this.maxLineWidth=i,this.fontProperties=l}static measureText(t,n,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e._canvas;r=r??n.wordWrap;const a=n.toFontString(),s=e.measureFont(a);0===s.fontSize&&(s.fontSize=n.fontSize,s.ascent=n.fontSize);const i=o.getContext("2d",Pa);i.font=a;const l=(r?e.wordWrap(t,n,o):t).split(/(?:\r\n|\r|\n)/),c=new Array(l.length);let d=0;for(let m=0;m<l.length;m++){const t=e._measureText(l[m],n.letterSpacing,i);c[m]=t,d=Math.max(d,t)}let u=d+n.strokeThickness;n.dropShadow&&(u+=n.dropShadowDistance);const h=n.lineHeight||s.fontSize+n.strokeThickness;let p=Math.max(h,s.fontSize+2*n.strokeThickness)+n.leading+(l.length-1)*(h+n.leading);return n.dropShadow&&(p+=n.dropShadowDistance),new e(t,n,u,p,l,c,h+n.leading,d,s)}static _measureText(t,n,r){let o=!1;e.experimentalLetterSpacingSupported&&(e.experimentalLetterSpacing?(r.letterSpacing=`${n}px`,r.textLetterSpacing=`${n}px`,o=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let a=r.measureText(t).width;return a>0&&(o?a-=n:a+=(e.graphemeSegmenter(t).length-1)*n),a}static wordWrap(t,n){const r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:e._canvas).getContext("2d",Pa);let o=0,a="",s="";const i=Object.create(null),{letterSpacing:l,whiteSpace:c}=n,d=e.collapseSpaces(c),u=e.collapseNewlines(c);let h=!d;const p=n.wordWrapWidth+l,m=e.tokenize(t);for(let f=0;f<m.length;f++){let t=m[f];if(e.isNewline(t)){if(!u){s+=e.addLine(a),h=!d,a="",o=0;continue}t=" "}if(d){const n=e.isBreakingSpace(t),r=e.isBreakingSpace(a[a.length-1]);if(n&&r)continue}const c=e.getFromCache(t,l,i,r);if(c>p)if(""!==a&&(s+=e.addLine(a),a="",o=0),e.canBreakWords(t,n.breakWords)){const c=e.wordWrapSplit(t);for(let d=0;d<c.length;d++){let u=c[d],m=u,f=1;for(;c[d+f];){const r=c[d+f];if(e.canBreakChars(m,r,t,d,n.breakWords))break;u+=r,m=r,f++}d+=f-1;const g=e.getFromCache(u,l,i,r);g+o>p&&(s+=e.addLine(a),h=!1,a="",o=0),a+=u,o+=g}}else{a.length>0&&(s+=e.addLine(a),a="",o=0);const n=f===m.length-1;s+=e.addLine(t,!n),h=!1,a="",o=0}else c+o>p&&(h=!1,s+=e.addLine(a),a="",o=0),(a.length>0||!e.isBreakingSpace(t)||h)&&(a+=t,o+=c)}return s+=e.addLine(a,!1),s}static addLine(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t=e.trimRight(t),t=n?`${t}\n`:t}static getFromCache(t,n,r,o){let a=r[t];return"number"!=typeof a&&(a=e._measureText(t,n,o)+n,r[t]=a),a}static collapseSpaces(e){return"normal"===e||"pre-line"===e}static collapseNewlines(e){return"normal"===e}static trimRight(t){if("string"!=typeof t)return"";for(let n=t.length-1;n>=0;n--){const r=t[n];if(!e.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&e._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,n){return"string"==typeof t&&e._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const n=[];let r="";if("string"!=typeof t)return n;for(let o=0;o<t.length;o++){const a=t[o],s=t[o+1];e.isBreakingSpace(a,s)||e.isNewline(a)?(""!==r&&(n.push(r),r=""),n.push(a)):r+=a}return""!==r&&n.push(r),n}static canBreakWords(e,t){return t}static canBreakChars(e,t,n,r,o){return!0}static wordWrapSplit(t){return e.graphemeSegmenter(t)}static measureFont(t){if(e._fonts[t])return e._fonts[t];const n={ascent:0,descent:0,fontSize:0},r=e._canvas,o=e._context;o.font=t;const a=e.METRICS_STRING+e.BASELINE_SYMBOL,s=Math.ceil(o.measureText(a).width);let i=Math.ceil(o.measureText(e.BASELINE_SYMBOL).width);const l=Math.ceil(e.HEIGHT_MULTIPLIER*i);if(i=i*e.BASELINE_MULTIPLIER|0,0===s||0===l)return e._fonts[t]=n,n;r.width=s,r.height=l,o.fillStyle="#f00",o.fillRect(0,0,s,l),o.font=t,o.textBaseline="alphabetic",o.fillStyle="#000",o.fillText(a,0,i);const c=o.getImageData(0,0,s,l).data,d=c.length,u=4*s;let h=0,p=0,m=!1;for(h=0;h<i;++h){for(let e=0;e<u;e+=4)if(255!==c[p+e]){m=!0;break}if(m)break;p+=u}for(n.ascent=i-h,p=d-u,m=!1,h=l;h>i;--h){for(let e=0;e<u;e+=4)if(255!==c[p+e]){m=!0;break}if(m)break;p-=u}return n.descent=h-i,n.fontSize=n.ascent+n.descent,e._fonts[t]=n,n}static clearMetrics(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t?delete e._fonts[t]:e._fonts={}}static get _canvas(){if(!e.__canvas){let t;try{const n=new OffscreenCanvas(0,0);if(n.getContext("2d",Pa)?.measureText)return e.__canvas=n,n;t=Q.ADAPTER.createCanvas()}catch{t=Q.ADAPTER.createCanvas()}t.width=t.height=10,e.__canvas=t}return e.__canvas}static get _context(){return e.__context||(e.__context=e._canvas.getContext("2d",Pa)),e.__context}};_a.METRICS_STRING="|\xc9q\xc5",_a.BASELINE_SYMBOL="M",_a.BASELINE_MULTIPLIER=1.4,_a.HEIGHT_MULTIPLIER=2,_a.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map((e=>e.segment))}return e=>[...e]})(),_a.experimentalLetterSpacing=!1,_a._fonts={},_a._newlines=[10,13],_a._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Na=_a;const Ra=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ma=class e{constructor(e){this.styleID=0,this.reset(),Oa(this,e,e)}clone(){const t={};return Oa(t,this,e.defaultStyle),new e(t)}reset(){Oa(this,e.defaultStyle,e.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Da(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Da(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){(function(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Da(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let n=t.length-1;n>=0;n--){let e=t[n].trim();!/([\"\'])[^\'\"]+\1/.test(e)&&!Ra.includes(e)&&(e=`"${e}"`),t[n]=e}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};Ma.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ea.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let ja=Ma;function Da(e){const t=lt.shared,n=e=>{const n=t.setValue(e);return 1===n.alpha?n.toHex():n.toRgbaString()};return Array.isArray(e)?e.map(n):n(e)}function Oa(e,t,n){for(const r in n)Array.isArray(t[r])?e[r]=t[r].slice():e[r]=t[r]}const Ba={texture:!0,children:!1,baseTexture:!0},La=class e extends ya{constructor(t,n,r){let o=!1;r||(r=Q.ADAPTER.createCanvas(),o=!0),r.width=3,r.height=3;const a=kr.from(r);a.orig=new Cn,a.trim=new Cn,super(a),this._ownCanvas=o,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=e.defaultResolution??Q.RESOLUTION,this._autoResolution=e.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=n,this.localStyleID=-1}static get experimentalLetterSpacing(){return Na.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Se("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Na.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const n=this.context,r=Na.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=r.width,a=r.height,s=r.lines,i=r.lineHeight,l=r.lineWidths,c=r.maxLineWidth,d=r.fontProperties;let u,h;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,o)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+2*t.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=t.strokeThickness,n.textBaseline=t.textBaseline,n.lineJoin=t.lineJoin,n.miterLimit=t.miterLimit;const p=t.dropShadow?2:1;for(let m=0;m<p;++m){const e=t.dropShadow&&0===m,o=e?Math.ceil(Math.max(1,a)+2*t.padding):0,p=o*this._resolution;if(e){n.fillStyle="black",n.strokeStyle="black";const e=t.dropShadowColor,r=t.dropShadowBlur*this._resolution,o=t.dropShadowDistance*this._resolution;n.shadowColor=lt.shared.setValue(e).setAlpha(t.dropShadowAlpha).toRgbaString(),n.shadowBlur=r,n.shadowOffsetX=Math.cos(t.dropShadowAngle)*o,n.shadowOffsetY=Math.sin(t.dropShadowAngle)*o+p}else n.fillStyle=this._generateFillStyle(t,s,r),n.strokeStyle=t.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let f=(i-d.fontSize)/2;i-d.fontSize<0&&(f=0);for(let n=0;n<s.length;n++)u=t.strokeThickness/2,h=t.strokeThickness/2+n*i+d.ascent+f,"right"===t.align?u+=c-l[n]:"center"===t.align&&(u+=(c-l[n])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(s[n],u+t.padding,h+t.padding-o,!0),t.fill&&this.drawLetterSpacing(s[n],u+t.padding,h+t.padding-o)}this.updateTexture()}drawLetterSpacing(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=this._style.letterSpacing;let a=!1;if(Na.experimentalLetterSpacingSupported&&(Na.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===o||a)return void(r?this.context.strokeText(e,t,n):this.context.fillText(e,t,n));let s=t;const i=Na.graphemeSegmenter(e);let l=this.context.measureText(e).width,c=0;for(let d=0;d<i.length;++d){const e=i[d];r?this.context.strokeText(e,s,n):this.context.fillText(e,s,n);let t="";for(let n=d+1;n<i.length;++n)t+=i[n];c=this.context.measureText(t).width,s+=l-c+o,l=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const t=Gt(e);t.data&&(e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0))}const t=this._texture,n=this._style,r=n.trim?0:n.padding,o=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-2*r,t.orig.height=t._frame.height-2*r,this._onTextureUpdate(),o.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),-1===this._textureID&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,n){const r=e.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];let o;const a=e.dropShadow?e.dropShadowDistance:0,s=e.padding||0,i=this.canvas.width/this._resolution-a-2*s,l=this.canvas.height/this._resolution-a-2*s,c=r.slice(),d=e.fillGradientStops.slice();if(!d.length){const e=c.length+1;for(let t=1;t<e;++t)d.push(t/e)}if(c.unshift(r[0]),d.unshift(0),c.push(r[r.length-1]),d.push(1),e.fillGradientType===Ea.LINEAR_VERTICAL){o=this.context.createLinearGradient(i/2,s,i/2,l+s);const r=n.fontProperties.fontSize+e.strokeThickness;for(let e=0;e<t.length;e++){const a=n.lineHeight*(e-1)+r,s=n.lineHeight*e;let i=s;e>0&&a>s&&(i=(s+a)/2);const u=s+r,h=n.lineHeight*(e+1);let p=u;e+1<t.length&&h<u&&(p=(u+h)/2);const m=(p-i)/l;for(let e=0;e<c.length;e++){let t=0;t="number"==typeof d[e]?d[e]:e/c.length;let n=Math.min(1,Math.max(0,i/l+t*m));n=Number(n.toFixed(5)),o.addColorStop(n,c[e])}}}else{o=this.context.createLinearGradient(s,l/2,i+s,l/2);const e=c.length+1;let t=1;for(let n=0;n<c.length;n++){let r;r="number"==typeof d[n]?d[n]:t/e,o.addColorStop(r,c[n]),t++}}return o}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},Ba,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=It(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=It(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},this._style=e instanceof ja?e:new ja(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};La.defaultAutoResolution=!0;let Fa=La;Fa.prototype._renderCanvas=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),ya.prototype._renderCanvas.call(this,e)};const $a=new Pn;ca.prototype._cacheAsBitmap=!1,ca.prototype._cacheData=null,ca.prototype._cacheAsBitmapResolution=null,ca.prototype._cacheAsBitmapMultisample=null;class Ga{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ca.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;let t;this._cacheAsBitmap=e,e?(this._cacheData||(this._cacheData=new Ga),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),ca.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},ca.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;const t=this.alpha;this.alpha=1,e.batch.flush();const n=this.getLocalBounds(new Cn,!0);if(this.filters?.length){const e=this.filters[0].padding;n.pad(e)}const r=this.cacheAsBitmapResolution||e.resolution;n.ceil(r),n.width=Math.max(n.width,1/r),n.height=Math.max(n.height,1/r);const o=e.renderTexture.current,a=e.renderTexture.sourceFrame.clone(),s=e.renderTexture.destinationFrame.clone(),i=e.projection.transform,l=Ar.create({width:n.width,height:n.height,resolution:r,multisample:this.cacheAsBitmapMultisample??e.multisample}),c=`cacheAsBitmap_${Pt()}`;this._cacheData.textureCacheId=c,sn.addToCache(l.baseTexture,c),kr.addToCache(l,c);const d=this.transform.localTransform.copyTo($a).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:l,clear:!0,transform:d,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=i,e.renderTexture.bind(o,a,s),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const u=new ya(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-n.x/n.width,u.anchor.y=-n.y/n.height,u.alpha=t,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},ca.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},ca.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;const t=this.getLocalBounds(new Cn,!0),n=this.alpha;this.alpha=1;const r=e.canvasContext.activeContext,o=e._projTransform,a=this.cacheAsBitmapResolution||e.resolution;t.ceil(a),t.width=Math.max(t.width,1/a),t.height=Math.max(t.height,1/a);const s=Ar.create({width:t.width,height:t.height,resolution:a}),i=`cacheAsBitmap_${Pt()}`;this._cacheData.textureCacheId=i,sn.addToCache(s.baseTexture,i),kr.addToCache(s,i);const l=$a;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=t.x,l.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:s,clear:!0,transform:l,skipUpdateTransform:!1}),e.canvasContext.activeContext=r,e._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const c=new ya(s);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-t.x/t.width,c.anchor.y=-t.y/t.height,c.alpha=n,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)},ca.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ca.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ca.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,sn.removeFromCache(this._cacheData.textureCacheId),kr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ca.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},ca.prototype.name=null,ma.prototype.getChildByName=function(e,t){for(let n=0,r=this.children.length;n<r;n++)if(this.children[n].name===e)return this.children[n];if(t)for(let n=0,r=this.children.length;n<r;n++){const t=this.children[n];if(!t.getChildByName)continue;const r=t.getChildByName(e,!0);if(r)return r}return null},ca.prototype.getGlobalPosition=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Sn,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};const za={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Ua=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class Ha extends pr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pr.defaultResolution,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;const a=function(e,t){const n=Math.ceil(e/2);let r,o="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",a="";r=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let s=0;s<e;s++){let e=r.replace("%index%",s.toString());e=e.replace("%sampleIndex%",s-(n-1)+".0"),a+=e,a+="\n"}return o=o.replace("%blur%",a),o=o.replace("%size%",e.toString()),o}(o,e),s=function(e){const t=za[e],n=t.length;let r,o=Ua,a="";for(let s=0;s<e;s++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());r=s,s>=n&&(r=e-s-1),o=o.replace("%value%",t[r].toString()),a+=o,a+="\n"}return o=o.replace("%blur%",a),o=o.replace("%size%",e.toString()),o}(o);super(a,s),this.horizontal=e,this.resolution=r,this._quality=0,this.quality=n,this.blur=t}apply(e,t,n,r){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/t.width):this.uniforms.strength=1/n.height*(n.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,n,r);else{const o=e.getFilterTexture(),a=e.renderer;let s=t,i=o;this.state.blend=!1,e.applyFilter(this,s,i,W.CLEAR);for(let t=1;t<this.passes-1;t++){e.bindAndClear(s,W.BLIT),this.uniforms.uSampler=i;const t=i;i=s,s=t,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,i,n,r),e.returnFilterTexture(o)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class qa extends pr{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Do,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",e),this.alpha=1}_loadMatrix(e){let t=e;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(this._multiply(t,this.uniforms.m,e),t=this._colorMatrix(t)),this.uniforms.m=t}_multiply(e,t,n){return e[0]=t[0]*n[0]+t[1]*n[5]+t[2]*n[10]+t[3]*n[15],e[1]=t[0]*n[1]+t[1]*n[6]+t[2]*n[11]+t[3]*n[16],e[2]=t[0]*n[2]+t[1]*n[7]+t[2]*n[12]+t[3]*n[17],e[3]=t[0]*n[3]+t[1]*n[8]+t[2]*n[13]+t[3]*n[18],e[4]=t[0]*n[4]+t[1]*n[9]+t[2]*n[14]+t[3]*n[19]+t[4],e[5]=t[5]*n[0]+t[6]*n[5]+t[7]*n[10]+t[8]*n[15],e[6]=t[5]*n[1]+t[6]*n[6]+t[7]*n[11]+t[8]*n[16],e[7]=t[5]*n[2]+t[6]*n[7]+t[7]*n[12]+t[8]*n[17],e[8]=t[5]*n[3]+t[6]*n[8]+t[7]*n[13]+t[8]*n[18],e[9]=t[5]*n[4]+t[6]*n[9]+t[7]*n[14]+t[8]*n[19]+t[9],e[10]=t[10]*n[0]+t[11]*n[5]+t[12]*n[10]+t[13]*n[15],e[11]=t[10]*n[1]+t[11]*n[6]+t[12]*n[11]+t[13]*n[16],e[12]=t[10]*n[2]+t[11]*n[7]+t[12]*n[12]+t[13]*n[17],e[13]=t[10]*n[3]+t[11]*n[8]+t[12]*n[13]+t[13]*n[18],e[14]=t[10]*n[4]+t[11]*n[9]+t[12]*n[14]+t[13]*n[19]+t[14],e[15]=t[15]*n[0]+t[16]*n[5]+t[17]*n[10]+t[18]*n[15],e[16]=t[15]*n[1]+t[16]*n[6]+t[17]*n[11]+t[18]*n[16],e[17]=t[15]*n[2]+t[16]*n[7]+t[17]*n[12]+t[18]*n[17],e[18]=t[15]*n[3]+t[16]*n[8]+t[17]*n[13]+t[18]*n[18],e[19]=t[15]*n[4]+t[16]*n[9]+t[17]*n[14]+t[18]*n[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const n=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}tint(e,t){const[n,r,o]=lt.shared.setValue(e).toArray(),a=[n,0,0,0,0,0,r,0,0,0,0,0,o,0,0,0,0,0,1,0];this._loadMatrix(a,t)}greyscale(e,t){const n=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}blackAndWhite(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)}hue(e,t){e=(e||0)/180*Math.PI;const n=Math.cos(e),r=Math.sin(e),o=1/3,a=(0,Math.sqrt)(o),s=[n+(1-n)*o,o*(1-n)-a*r,o*(1-n)+a*r,0,0,o*(1-n)+a*r,n+o*(1-n),o*(1-n)-a*r,0,0,o*(1-n)-a*r,o*(1-n)+a*r,n+o*(1-n),0,0,0,0,0,1,0];this._loadMatrix(s,t)}contrast(e,t){const n=(e||0)+1,r=-.5*(n-1),o=[n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0];this._loadMatrix(o,t)}saturate(){let e=arguments.length>1?arguments[1]:void 0;const t=2*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/3+1,n=-.5*(t-1),r=[t,n,n,0,0,n,t,n,0,0,n,n,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}desaturate(){this.saturate(-1)}negative(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)}sepia(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)}technicolor(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)}polaroid(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)}toBGR(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)}kodachrome(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)}browni(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)}vintage(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)}colorTone(e,t,n,r,o){e=e||.2,t=t||.15,n=n||16770432,r=r||3375104;const a=lt.shared,[s,i,l]=a.setValue(n).toArray(),[c,d,u]=a.setValue(r).toArray(),h=[.3,.59,.11,0,0,s,i,l,e,0,c,d,u,t,0,s-c,i-d,l-u,0,0];this._loadMatrix(h,o)}night(e,t){const n=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}predator(e,t){const n=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(n,t)}lsd(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}qa.prototype.grayscale=qa.prototype.greyscale;const Va={AlphaFilter:class extends pr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},BlurFilter:class extends pr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pr.defaultResolution,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;super(),this._repeatEdgePixels=!1,this.blurXFilter=new Ha(!0,e,t,n,r),this.blurYFilter=new Ha(!1,e,t,n,r),this.resolution=n,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,n,r){const o=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(o&&a){const o=e.getFilterTexture();this.blurXFilter.apply(e,t,o,W.CLEAR),this.blurYFilter.apply(e,o,n,r),e.returnFilterTexture(o)}else a?this.blurYFilter.apply(e,t,n,r):this.blurXFilter.apply(e,t,n,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}},BlurFilterPass:Ha,ColorMatrixFilter:qa,DisplacementFilter:class extends pr{constructor(e,t){const n=new Pn;e.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=n,null==t&&(t=20),this.scale=new Sn(t,t)}apply(e,t,n,r){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const o=this.maskSprite.worldTransform,a=Math.sqrt(o.a*o.a+o.b*o.b),s=Math.sqrt(o.c*o.c+o.d*o.d);0!==a&&0!==s&&(this.uniforms.rotation[0]=o.a/a,this.uniforms.rotation[1]=o.b/a,this.uniforms.rotation[2]=o.c/s,this.uniforms.rotation[3]=o.d/s),e.applyFilter(this,t,n,r)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}},FXAAFilter:class extends pr{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends pr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random();super(Do,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}};Object.entries(Va).forEach((e=>{let[t,n]=e;Object.defineProperty(Va,t,{get:()=>(Se("7.1.0",`filters.${t} has moved to ${t}`),n)})}));const Wa=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Ro.system.add(this.tickerUpdate,this,Po.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ro.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class Ya{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Ya.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Sn,this.page=new Sn,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,n,r,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Ka extends Ya{constructor(){super(...arguments),this.client=new Sn,this.movement=new Sn,this.offset=new Sn,this.global=new Sn,this.screen=new Sn}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,n){return e.worldTransform.applyInverse(n||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,n,r,o,a,s,i,l,c,d,u,h,p,m){throw new Error("Method not implemented.")}}class Xa extends Ka{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Za extends Ka{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Za.DOM_DELTA_PIXEL=0,Za.DOM_DELTA_LINE=1,Za.DOM_DELTA_PAGE=2;const Ja=new Sn,Qa=new Sn;class es{constructor(e){this.dispatch=new ve,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort(((e,t)=>e.priority-t.priority))}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let n=0,r=t.length;n<r;n++)t[n].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Wa.pauseUpdate=!0;const n=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,Ja.set(e,t),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,t){if(!e.target)return;const n=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let r=0,o=n.length-1;r<o;r++)if(e.currentTarget=n[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let r=n.length-2;r>=0;r--)if(e.currentTarget=n[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._allInteractiveElements;if(0===n.length)return;e.eventPhase=e.BUBBLING_PHASE;const r=Array.isArray(t)?t:[t];for(let o=n.length-1;o>=0;o--)r.forEach((t=>{e.currentTarget=n[o],this.notifyTarget(e,t)}))}propagationPath(e){const t=[e];for(let n=0;n<2048&&e!==this.rootTarget;n++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=!1;if(this._interactivePrune(e))return null;if(("dynamic"===e.eventMode||"dynamic"===t)&&(Wa.pauseUpdate=!1),e.interactiveChildren&&e.children){const i=e.children;for(let l=i.length-1;l>=0;l--){const c=i[l],d=this.hitTestMoveRecursive(c,this._isInteractive(t)?t:c.eventMode,n,r,o,a||o(e,n));if(d){if(d.length>0&&!d[d.length-1].parent)continue;const t=e.isInteractive();(d.length>0||t)&&(t&&this._allInteractiveElements.push(e),d.push(e)),0===this._hitElements.length&&(this._hitElements=d),s=!0}}}const i=this._isInteractive(t),l=e.isInteractive();return i&&l&&this._allInteractiveElements.push(e),a||this._hitElements.length>0?null:s?this._hitElements:i&&!o(e,n)&&r(e,n)?l?[e]:[]:null}hitTestRecursive(e,t,n,r,o){if(this._interactivePrune(e)||o(e,n))return null;if(("dynamic"===e.eventMode||"dynamic"===t)&&(Wa.pauseUpdate=!1),e.interactiveChildren&&e.children){const a=e.children;for(let s=a.length-1;s>=0;s--){const i=a[s],l=this.hitTestRecursive(i,this._isInteractive(t)?t:i.eventMode,n,r,o);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const t=e.isInteractive();return(l.length>0||t)&&l.push(e),l}}}const a=this._isInteractive(t),s=e.isInteractive();return a&&r(e,n)?s?[e]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}_interactivePrune(e){return!(e&&!e.isMask&&e.visible&&e.renderable&&"none"!==e.eventMode&&("passive"!==e.eventMode||e.interactiveChildren)&&!e.isMask)}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,Qa),!e.hitArea.contains(Qa.x,Qa.y)))return!0;if(e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;if(n&&!n.containsPoint?.(t))return!0}return!1}hitTestFn(e,t){return"passive"!==e.eventMode&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(t))}notifyTarget(e,t){const n=`on${t=t??e.type}`;e.currentTarget[n]?.(e);const r=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,r),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof Xa))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),"touch"===t.pointerType)this.dispatchEvent(t,"touchstart");else if("mouse"===t.pointerType||"pen"===t.pointerType){const e=2===t.button;this.dispatchEvent(t,e?"rightdown":"mousedown")}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof Xa))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const n="mouse"===t.pointerType||"pen"===t.pointerType,r=this.trackingData(e.pointerId),o=this.findMountedTarget(r.overTargets);if(r.overTargets?.length>0&&o!==t.target){const r="mousemove"===e.type?"mouseout":"pointerout",a=this.createPointerEvent(e,r,o);if(this.dispatchEvent(a,"pointerout"),n&&this.dispatchEvent(a,"mouseout"),!t.composedPath().includes(o)){const r=this.createPointerEvent(e,"pointerleave",o);for(r.eventPhase=r.AT_TARGET;r.target&&!t.composedPath().includes(r.target);)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;this.freeEvent(r)}this.freeEvent(a)}if(o!==t.target){const r="mousemove"===e.type?"mouseover":"pointerover",a=this.clonePointerEvent(t,r);this.dispatchEvent(a,"pointerover"),n&&this.dispatchEvent(a,"mouseover");let s=o?.parent;for(;s&&s!==this.rootTarget.parent&&s!==t.target;)s=s.parent;if(!s||s===this.rootTarget.parent){const e=this.clonePointerEvent(t,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==o&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),n&&this.notifyTarget(e,"mouseenter"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(a)}const a=[],s=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(t,"pointermove"),s&&a.push("globalpointermove"),"touch"===t.pointerType&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),s&&a.push("globaltouchmove")),n&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),s&&a.push("globalmousemove"),this.cursor=t.target?.cursor),a.length>0&&this.all(t,a),this._allInteractiveElements.length=0,this._hitElements.length=0,r.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){if(!(e instanceof Xa))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),n=this.createPointerEvent(e),r="mouse"===n.pointerType||"pen"===n.pointerType;this.dispatchEvent(n,"pointerover"),r&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursor=n.target?.cursor);const o=this.clonePointerEvent(n,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;t.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(o)}mapPointerOut(e){if(!(e instanceof Xa))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId);if(t.overTargets){const n="mouse"===e.pointerType||"pen"===e.pointerType,r=this.findMountedTarget(t.overTargets),o=this.createPointerEvent(e,"pointerout",r);this.dispatchEvent(o),n&&this.dispatchEvent(o,"mouseout");const a=this.createPointerEvent(e,"pointerleave",r);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),n&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;t.overTargets=null,this.freeEvent(o),this.freeEvent(a)}this.cursor=null}mapPointerUp(e){if(!(e instanceof Xa))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=performance.now(),n=this.createPointerEvent(e);if(this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType)this.dispatchEvent(n,"touchend");else if("mouse"===n.pointerType||"pen"===n.pointerType){const e=2===n.button;this.dispatchEvent(n,e?"rightup":"mouseup")}const r=this.trackingData(e.pointerId),o=this.findMountedTarget(r.pressTargetsByButton[e.button]);let a=o;if(o&&!n.composedPath().includes(o)){let t=o;for(;t&&!n.composedPath().includes(t);){if(n.currentTarget=t,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType)this.notifyTarget(n,"touchendoutside");else if("mouse"===n.pointerType||"pen"===n.pointerType){const e=2===n.button;this.notifyTarget(n,e?"rightupoutside":"mouseupoutside")}t=t.parent}delete r.pressTargetsByButton[e.button],a=t}if(a){const o=this.clonePointerEvent(n,"click");o.target=a,o.path=null,r.clicksByButton[e.button]||(r.clicksByButton[e.button]={clickCount:0,target:o.target,timeStamp:t});const s=r.clicksByButton[e.button];if(s.target===o.target&&t-s.timeStamp<200?++s.clickCount:s.clickCount=1,s.target=o.target,s.timeStamp=t,o.detail=s.clickCount,"mouse"===o.pointerType){const e=2===o.button;this.dispatchEvent(o,e?"rightclick":"click")}else"touch"===o.pointerType&&this.dispatchEvent(o,"tap");this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(n)}mapPointerUpOutside(e){if(!(e instanceof Xa))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),n=this.findMountedTarget(t.pressTargetsByButton[e.button]),r=this.createPointerEvent(e);if(n){let o=n;for(;o;)r.currentTarget=o,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):("mouse"===r.pointerType||"pen"===r.pointerType)&&this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),o=o.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(r)}mapWheel(e){if(!(e instanceof Za))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let n=1;n<e.length&&e[n].parent===t;n++)t=e[n];return t}createPointerEvent(e,t,n){const r=this.allocateEvent(Xa);return this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.nativeEvent=e.nativeEvent,r.originalEvent=e,r.target=n??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],"string"==typeof t&&(r.type=t),r}createWheelEvent(e){const t=this.allocateEvent(Za);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const n=this.allocateEvent(Xa);return n.nativeEvent=e.nativeEvent,n.originalEvent=e.originalEvent,this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.target=e.target,n.path=e.composedPath().slice(),n.type=t??n.type,n}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof Xa&&t instanceof Xa&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Ka&&t instanceof Ka&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const n=e.currentTarget._events[t];if(n&&e.currentTarget.isInteractive())if("fn"in n)n.once&&e.currentTarget.removeListener(t,n.fn,void 0,!0),n.fn.call(n.context,e);else for(let r=0,o=n.length;r<o&&!e.propagationImmediatelyStopped;r++)n[r].once&&e.currentTarget.removeListener(t,n[r].fn,void 0,!0),n[r].fn.call(n[r].context,e)}}const ts={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ns=class e{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new es(null),Wa.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Xa(null),this.rootWheelEvent=new Za(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...e.defaultEventFeatures},{set:(e,t,n)=>("globalMove"===t&&(this.rootBoundary.enableGlobalMoveEvents=n),e[t]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:n,resolution:r}=this.renderer;this.setTargetElement(n),this.resolution=r,e._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const n=this.cursorStyles[e];if(n)switch(typeof n){case"string":t&&(this.domElement.style.cursor=n);break;case"function":n(e);break;case"object":t&&Object.assign(this.domElement.style,n)}else t&&"string"==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let n=0,r=t.length;n<r;n++){const e=t[n],r=this.bootstrapEvent(this.rootPointerEvent,e);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Wa.pointerMoved();const t=this.normalizeToPointerData(e);for(let n=0,r=t.length;n<r;n++){const e=this.bootstrapEvent(this.rootPointerEvent,t[n]);this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const n=t!==this.domElement?"outside":"",r=this.normalizeToPointerData(e);for(let o=0,a=r.length;o<a;o++){const e=this.bootstrapEvent(this.rootPointerEvent,r[o]);e.type+=n,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let n=0,r=t.length;n<r;n++){const e=this.bootstrapEvent(this.rootPointerEvent,t[n]);this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Wa.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Wa.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Wa.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,n){const r=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},o=1/this.resolution;e.x=(t-r.left)*(this.domElement.width/r.width)*o,e.y=(n-r.top)*(this.domElement.height/r.height)*o}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let n=0,r=e.changedTouches.length;n<r;n++){const r=e.changedTouches[n];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=1===e.touches.length&&"touchstart"===e.type),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=e.type,t.push(r)}else if(globalThis.MouseEvent&&(!(e instanceof MouseEvent)||this.supportsPointerEvents&&e instanceof globalThis.PointerEvent))t.push(e);else{const n=e;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=1),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,t.push(n)}return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=ts[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};ns.extension={name:"events",type:[qt.RendererSystem,qt.CanvasRendererSystem]},ns.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let rs=ns;function os(e){return"dynamic"===e||"static"===e}Yt.add(rs);const as={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??os(rs.defaultEventMode)},set interactive(e){Se("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??rs.defaultEventMode},set eventMode(e){this._internalInteractive=os(e),this._internalEventMode=e},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,t,n){const r="boolean"==typeof n&&n||"object"==typeof n&&n.capture,o="object"==typeof n?n.signal:void 0,a="object"==typeof n&&!0===n.once,s="function"==typeof t?void 0:t;e=r?`${e}capture`:e;const i="function"==typeof t?t:t.handleEvent,l=this;o&&o.addEventListener("abort",(()=>{l.off(e,i,s)})),a?l.once(e,i,s):l.on(e,i,s)},removeEventListener(e,t,n){const r="function"==typeof t?void 0:t;e="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${e}capture`:e,t="function"==typeof t?t:t.handleEvent,this.off(e,t,r)},dispatchEvent(e){if(!(e instanceof Ya))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};ca.mixin(as);ca.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class ss{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(ye.tablet||ye.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex=2..toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let n=0;n<t.length;n++)this.updateAccessibleObjects(t[n])}update(){const e=performance.now();if(ye.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:n,width:r,height:o}=this.renderer.view.getBoundingClientRect(),{width:a,height:s,resolution:i}=this.renderer,l=r/a*i,c=o/s*i;let d=this.div;d.style.left=`${t}px`,d.style.top=`${n}px`,d.style.width=`${a}px`,d.style.height=`${s}px`;for(let u=0;u<this.children.length;u++){const e=this.children[u];if(e.renderId!==this.renderId)e._accessibleActive=!1,At(this.children,u,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,u--;else{d=e._accessibleDiv;let t=e.hitArea;const n=e.worldTransform;e.hitArea?(d.style.left=(n.tx+t.x*n.a)*l+"px",d.style.top=(n.ty+t.y*n.d)*c+"px",d.style.width=t.width*n.a*l+"px",d.style.height=t.height*n.d*c+"px"):(t=e.getBounds(),this.capHitArea(t),d.style.left=t.x*l+"px",d.style.top=t.y*c+"px",d.style.width=t.width*l+"px",d.style.height=t.height*c+"px",d.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(d.title=e.accessibleTitle),d.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&d.setAttribute("aria-label",e.accessibleHint)),(e.accessibleTitle!==d.title||e.tabIndex!==d.tabIndex)&&(d.title=e.accessibleTitle,d.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:n}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>n&&(e.height=n-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2..toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:(!e.accessibleHint||null===e.accessibleHint)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:n}=e.target,r=this.renderer.events.rootBoundary,o=Object.assign(new Ya(r),{target:n});r.rootTarget=this.renderer.lastObjectRendered,t.forEach((e=>r.dispatchEvent(o,e)))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this.activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}ss.extension={name:"accessibility",type:[qt.RendererPlugin,qt.CanvasRendererPlugin]},Yt.add(ss);const is=class e{constructor(t){this.stage=new ma,t=Object.assign({forceCanvas:!1},t),this.renderer=function(e){for(const t of jo)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}(t),e._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,n){const r=e._plugins.slice(0);r.reverse(),r.forEach((e=>{e.destroy.call(this)})),this.stage.destroy(n),this.stage=null,this.renderer.destroy(t),this.renderer=null}};is._plugins=[];let ls=is;Yt.handleByList(qt.Application,ls._plugins);class cs{static init(e){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,t;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,t=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:r}=this._resizeTo;e=n,t=r}this.renderer.resize(e,t),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}cs.extension=qt.Application,Yt.add(cs);const ds={loader:qt.LoadParser,resolver:qt.ResolveParser,cache:qt.CacheParser,detection:qt.DetectionParser};Yt.handle(qt.Asset,(e=>{const t=e.ref;Object.entries(ds).filter((e=>{let[n]=e;return!!t[n]})).forEach((e=>{let[n,r]=e;return Yt.add(Object.assign(t[n],{extension:t[n].extension??r}))}))}),(e=>{const t=e.ref;Object.keys(ds).filter((e=>!!t[e])).forEach((e=>Yt.remove(t[e])))}));class us{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach((e=>{this._assetList.push(e)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<t;n++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function hs(e,t){const n=e.split("?")[0],r=Ae.extname(n).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const ps=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Array.isArray(e)||(e=[e]),t?e.map((e=>"string"==typeof e||n?t(e):e)):e};const ms=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const n=ps(e);let r;for(let s=0;s<this.parsers.length;s++){const e=this.parsers[s];if(e.test(t)){r=e.getCacheableAssets(n,t);break}}r||(r={},n.forEach((e=>{r[e]=t})));const o=Object.keys(r),a={cacheKeys:o,keys:n};if(n.forEach((e=>{this._cacheMap.set(e,a)})),o.forEach((e=>{const n=r?r[e]:t;this._cache.has(e)&&this._cache.get(e)!==n&&console.warn("[Cache] already has key:",e),this._cache.set(e,r[e])})),t instanceof kr){const e=t;n.forEach((t=>{e.baseTexture!==kr.EMPTY.baseTexture&&sn.addToCache(e.baseTexture,t),kr.addToCache(e,t)}))}}remove(e){if(!this._cacheMap.has(e))return void console.warn(`[Assets] Asset id ${e} was not found in the Cache`);const t=this._cacheMap.get(e);t.cacheKeys.forEach((e=>{this._cache.delete(e)})),t.keys.forEach((e=>{this._cacheMap.delete(e)}))}get parsers(){return this._parsers}},fs=e=>!Array.isArray(e);class gs{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,n)=>(this._parsersValidated=!1,e[t]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const n={promise:null,parser:null};return n.promise=(async()=>{let r=null,o=null;if(t.loadParser&&(o=this._parserHash[t.loadParser],o||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!o){for(let n=0;n<this.parsers.length;n++){const r=this.parsers[n];if(r.load&&r.test?.(e,t,this)){o=r;break}}if(!o)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await o.load(e,t,this),n.parser=o;for(let e=0;e<this.parsers.length;e++){const o=this.parsers[e];o.parse&&o.parse&&await(o.testParse?.(r,t,this))&&(r=await o.parse(r,t,this)||r,n.parser=o)}return r})(),n}async load(e,t){this._parsersValidated||this._validateParsers();let n=0;const r={},o=fs(e),a=ps(e,(e=>({alias:[e],src:e}))),s=a.length,i=a.map((async e=>{const o=Ae.toAbsolute(e.src);if(!r[e.src])try{this.promiseCache[o]||(this.promiseCache[o]=this._getLoadPromiseAndParser(o,e)),r[e.src]=await this.promiseCache[o].promise,t&&t(++n/s)}catch(a){throw delete this.promiseCache[o],delete r[e.src],new Error(`[Loader.load] Failed to load ${o}.\n${a}`)}}));return await Promise.all(i),o?r[a[0].src]:r}async unload(e){const t=ps(e,(e=>({alias:[e],src:e}))).map((async e=>{const t=Ae.toAbsolute(e.src),n=this.promiseCache[t];if(n){const r=await n.promise;delete this.promiseCache[t],n.parser?.unload?.(r,e,this)}}));await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((e=>e.name)).reduce(((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t})),{})}}var ys=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(ys||{});function vs(e,t){if(Array.isArray(t)){for(const n of t)if(e.startsWith(`data:${n}`))return!0;return!1}return e.startsWith(`data:${t}`)}const bs={extension:{type:qt.LoadParser,priority:ys.Low},name:"loadJson",test:e=>vs(e,"application/json")||hs(e,".json"),load:async e=>await(await Q.ADAPTER.fetch(e)).json()};Yt.add(bs);const xs={name:"loadTxt",extension:{type:qt.LoadParser,priority:ys.Low},test:e=>vs(e,"text/plain")||hs(e,".txt"),load:async e=>await(await Q.ADAPTER.fetch(e)).text()};Yt.add(xs);const ws=["normal","bold","100","200","300","400","500","600","700","800","900"],Ss=[".ttf",".otf",".woff",".woff2"],Ts=["font/ttf","font/otf","font/woff","font/woff2"],Cs=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const ks=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;const As={extension:{type:qt.LoadParser,priority:ys.Low},name:"loadWebFont",test:e=>vs(e,Ts)||hs(e,Ss),async load(e,t){const n=Q.ADAPTER.getFontFaceSet();if(n){const o=[],a=t.data?.family??function(e){const t=Ae.extname(e),n=Ae.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1)));let r=n.length>0;for(const a of n)if(!a.match(Cs)){r=!1;break}let o=n.join(" ");return r||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}(e),s=t.data?.weights?.filter((e=>ws.includes(e)))??["normal"],i=t.data??{};for(let t=0;t<s.length;t++){const l=s[t],c=new FontFace(a,`url(${r=e,ks.test(r)?r:encodeURI(r)})`,{...i,weight:l});await c.load(),n.add(c),o.push(c)}return 1===o.length?o[0]:o}var r;return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach((e=>Q.ADAPTER.getFontFaceSet().delete(e)))}};Yt.add(As);let Is=null;class Es{constructor(){Is||(Is=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != "function")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(Is)}}Es.revokeObjectURL=function(){Is&&(URL.revokeObjectURL(Is),Is=null)};let Ps=null;class _s{constructor(){Ps||(Ps=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(Ps)}}_s.revokeObjectURL=function(){Ps&&(URL.revokeObjectURL(Ps),Ps=null)};let Ns,Rs=0;const Ms=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((e=>{const{worker:t}=new Es;t.addEventListener("message",(n=>{t.terminate(),Es.revokeObjectURL(),e(n.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Ns&&(Ns=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<Ns&&(this._createdWorkers++,e=(new _s).worker,e.addEventListener("message",(e=>{this.complete(e.data),this.returnWorker(e.target),this.next()}))),e}returnWorker(e){this.workerPool.push(e)}complete(e){void 0!==e.error?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const n=new Promise(((n,r)=>{this.queue.push({id:e,arguments:t,resolve:n,reject:r})}));return this.next(),n}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),n=t.id;this.resolveHash[Rs]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:Rs++,id:n})}};function js(e,t,n){e.resource.internal=!0;const r=new kr(e),o=()=>{delete t.promiseCache[n],ms.has(n)&&ms.remove(n)};return r.baseTexture.once("destroyed",(()=>{n in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),o())})),r.once("destroyed",(()=>{e.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),o())})),r}const Ds=[".jpeg",".jpg",".png",".webp",".avif"],Os=["image/jpeg","image/png","image/webp","image/avif"];const Bs={name:"loadTextures",extension:{type:qt.LoadParser,priority:ys.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>vs(e,Os)||hs(e,Ds),async load(e,t,n){const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let o;o=r?this.config.preferWorkers&&await Ms.isImageBitmapSupported()?await Ms.loadImageBitmap(e):await async function(e){const t=await Q.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const n=await t.blob();return await createImageBitmap(n)}(e):await new Promise(((t,n)=>{const r=new Image;r.crossOrigin=this.config.crossOrigin,r.src=e,r.complete?t(r):(r.onload=()=>t(r),r.onerror=e=>n(e))}));const a={...t.data};a.resolution??(a.resolution=Ht(e)),r&&void 0===a.resourceOptions?.ownsImageBitmap&&(a.resourceOptions={...a.resourceOptions},a.resourceOptions.ownsImageBitmap=!0);const s=new sn(o,a);return s.resource.src=e,js(s,n,e)},unload(e){e.destroy(!0)}};Yt.add(Bs);const Ls={extension:{type:qt.LoadParser,priority:ys.High},name:"loadSVG",test:e=>vs(e,"image/svg+xml")||hs(e,".svg"),testParse:async e=>Yo.test(e),async parse(e,t,n){const r=new Yo(e,t?.data?.resourceOptions);await r.load();const o=new sn(r,{resolution:Ht(e),...t?.data});return o.resource.src=t.src,js(o,n,t.src)},load:async(e,t)=>(await Q.ADAPTER.fetch(e)).text(),unload:Bs.unload};Yt.add(Ls);const Fs=[".mp4",".m4v",".webm",".ogv"],$s=["video/mp4","video/webm","video/ogg"],Gs={name:"loadVideo",extension:{type:qt.LoadParser,priority:ys.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:e=>vs(e,$s)||hs(e,Fs),async load(e,t,n){let r;const o=await(await Q.ADAPTER.fetch(e)).blob(),a=URL.createObjectURL(o);try{const o={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...t?.data?.resourceOptions,autoLoad:!0},s=new Xo(a,o);await s.load();const i=new sn(s,{alphaMode:await Pe(),resolution:Ht(e),...t?.data});i.resource.src=e,r=js(i,n,e),r.baseTexture.once("destroyed",(()=>{URL.revokeObjectURL(a)}))}catch(s){throw URL.revokeObjectURL(a),s}return r},unload(e){e.destroy(!0)}};function zs(e,t,n,r,o){const a=t[n];for(let s=0;s<a.length;s++){const i=a[s];n<t.length-1?zs(e.replace(r[n],i),t,n+1,r,o):o.push(e.replace(r[n],i))}}function Us(e){const t=e.match(/\{(.*?)\}/g),n=[];if(t){const r=[];t.forEach((e=>{const t=e.substring(1,e.length-1).split(",");r.push(t)})),zs(e,r,0,t,n)}else n.push(e);return n}Yt.add(Gs);class Hs{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))})),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if("string"==typeof e)this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&")}}getAlias(e){const{alias:t,name:n,src:r,srcs:o}=e;return ps(t||n||r||o,(e=>"string"==typeof e?e:Array.isArray(e)?e.map((e=>e?.src??e?.srcs??e)):e?.src||e?.srcs?e.src??e.srcs:e),!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach((e=>{this.addBundle(e.name,e.assets)}))}addBundle(e,t){const n=[];Array.isArray(t)?t.forEach((t=>{const r=t.src??t.srcs,o=t.alias??t.name;let a;if("string"==typeof o){const t=this._createBundleAssetId(e,o);n.push(t),a=[o,t]}else{const t=o.map((t=>this._createBundleAssetId(e,t)));n.push(...t),a=[...o,...t]}this.add({...t,alias:a,src:r})})):Object.keys(t).forEach((r=>{const o=[r,this._createBundleAssetId(e,r)];if("string"==typeof t[r])this.add({alias:o,src:t[r]});else if(Array.isArray(t[r]))this.add({alias:o,src:t[r]});else{const e=t[r],n=e.src??e.srcs;this.add({...e,alias:o,src:Array.isArray(n)?n:[n]})}n.push(...o)})),this._bundles[e]=n}add(e,t,n,r,o){const a=[];let s;"string"==typeof e||Array.isArray(e)&&"string"==typeof e[0]?(Se("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),a.push({alias:e,src:t,data:n,format:r,loadParser:o})):Array.isArray(e)?a.push(...e):a.push(e),s=e=>{this.hasKey(e)&&console.warn(`[Resolver] already has key: ${e} overwriting`)},ps(a).forEach((e=>{const{src:t,srcs:n}=e;let{data:r,format:o,loadParser:a}=e;const i=ps(t||n).map((e=>"string"==typeof e?Us(e):Array.isArray(e)?e:[e])),l=this.getAlias(e);Array.isArray(l)?l.forEach(s):s(l);const c=[];i.forEach((e=>{e.forEach((e=>{let t={};if("object"!=typeof e){t.src=e;for(let n=0;n<this._parsers.length;n++){const r=this._parsers[n];if(r.test(e)){t=r.parse(e);break}}}else r=e.data??r,o=e.format??o,a=e.loadParser??a,t={...t,...e};if(!l)throw new Error(`[Resolver] alias is undefined for this asset: ${t.src}`);t=this.buildResolvedAsset(t,{aliases:l,data:r,format:o,loadParser:a}),c.push(t)}))})),l.forEach((e=>{this._assetMap[e]=c}))}))}resolveBundle(e){const t=fs(e);e=ps(e);const n={};return e.forEach((e=>{const t=this._bundles[e];if(t){const r=this.resolve(t),o={};for(const t in r){const n=r[t];o[this._extractAssetIdFromBundle(e,t)]=n}n[e]=o}})),t?n[e[0]]:n}resolveUrl(e){const t=this.resolve(e);if("string"!=typeof e){const e={};for(const n in t)e[n]=t[n].src;return e}return t.src}resolve(e){const t=fs(e);e=ps(e);const n={};return e.forEach((e=>{if(!this._resolverHash[e])if(this._assetMap[e]){let t=this._assetMap[e];const n=t[0],r=this._getPreferredOrder(t);r?.priority.forEach((e=>{r.params[e].forEach((n=>{const r=t.filter((t=>!!t[e]&&t[e]===n));r.length&&(t=r)}))})),this._resolverHash[e]=t[0]??n}else this._resolverHash[e]=this.buildResolvedAsset({alias:[e],src:e},{});n[e]=this._resolverHash[e]})),t?n[e[0]]:n}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const t=e[0],n=this._preferredOrder.find((e=>e.params.format.includes(t.format)));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;return`${e}${/\?/.test(e)?"&":"?"}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:n,data:r,loadParser:o,format:a}=t;return(this._basePath||this._rootPath)&&(e.src=Ae.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=n??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...r||{},...e.data},e.loadParser=o??e.loadParser,e.format=a??e.format??Ae.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}const qs=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Hs,this.loader=new gs,this.cache=ms,this._backgroundLoader=new us(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;"string"==typeof t&&(t=await this.load(t)),this.resolver.addManifest(t)}const t=e.texturePreference?.resolution??1,n="number"==typeof t?[t]:t,r=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:n}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,n,r,o){this.resolver.add(e,t,n,r,o)}async load(e,t){this._initialized||await this.init();const n=fs(e),r=ps(e).map((e=>{if("string"!=typeof e){const t=this.resolver.getAlias(e);return t.some((e=>!this.resolver.hasKey(e)))&&this.add(e),Array.isArray(t)?t[0]:t}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e})),o=this.resolver.resolve(r),a=await this._mapLoadToResolve(o,t);return n?a[r[0]]:a}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let n=!1;"string"==typeof e&&(n=!0,e=[e]);const r=this.resolver.resolveBundle(e),o={},a=Object.keys(r);let s=0,i=0;const l=()=>{t?.(++s/i)},c=a.map((e=>{const t=r[e];return i+=Object.keys(t).length,this._mapLoadToResolve(t,l).then((t=>{o[e]=t}))}));return await Promise.all(c),n?o[e[0]]:o}async backgroundLoad(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach((e=>{this._backgroundLoader.add(Object.values(e))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return ms.get(e);const t={};for(let n=0;n<e.length;n++)t[n]=ms.get(e[n]);return t}async _mapLoadToResolve(e,t){const n=Object.values(e),r=Object.keys(e);this._backgroundLoader.active=!1;const o=await this.loader.load(n,t);this._backgroundLoader.active=!0;const a={};return n.forEach(((e,t)=>{const n=o[e.src],s=[e.src];e.alias&&s.push(...e.alias),a[r[t]]=n,ms.set(s,n)})),a}async unload(e){this._initialized||await this.init();const t=ps(e).map((e=>"string"!=typeof e?e.src:e)),n=this.resolver.resolve(t);await this._unloadFromResolved(n)}async unloadBundle(e){this._initialized||await this.init(),e=ps(e);const t=this.resolver.resolveBundle(e),n=Object.keys(t).map((e=>this._unloadFromResolved(t[e])));await Promise.all(n)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach((e=>{ms.remove(e.src)})),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const n of e.detections)e.skipDetections||await n.test()?t=await n.add(t):e.skipDetections||(t=await n.remove(t));return t=t.filter(((e,n)=>t.indexOf(e)===n)),t}get detections(){return this._detections}get preferWorkers(){return Bs.config.preferWorkers}set preferWorkers(e){Se("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach((t=>{t.config&&Object.keys(t.config).filter((t=>t in e)).forEach((n=>{t.config[n]=e[n]}))}))}};Yt.handleByList(qt.LoadParser,qs.loader.parsers).handleByList(qt.ResolveParser,qs.resolver.parsers).handleByList(qt.CacheParser,qs.cache.parsers).handleByList(qt.DetectionParser,qs.detections);const Vs={extension:qt.CacheParser,test:e=>Array.isArray(e)&&e.every((e=>e instanceof kr)),getCacheableAssets:(e,t)=>{const n={};return e.forEach((e=>{t.forEach(((t,r)=>{n[e+(0===r?"":r+1)]=t}))})),n}};async function Ws(e){if("Image"in globalThis)return new Promise((t=>{const n=new Image;n.onload=()=>{t(!0)},n.onerror=()=>{t(!1)},n.src=e}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(e)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}Yt.add(Vs);const Ys={extension:{type:qt.DetectionParser,priority:1},test:async()=>Ws("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter((e=>"avif"!==e))};Yt.add(Ys);const Ks={extension:{type:qt.DetectionParser,priority:0},test:async()=>Ws("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter((e=>"webp"!==e))};Yt.add(Ks);const Xs=["png","jpg","jpeg"],Zs={extension:{type:qt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...Xs],remove:async e=>e.filter((e=>!Xs.includes(e)))};Yt.add(Zs);const Js="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Qs(e){return!Js&&""!==document.createElement("video").canPlayType(e)}const ei={extension:{type:qt.DetectionParser,priority:0},test:async()=>Qs("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter((e=>"webm"!==e))};Yt.add(ei);const ti={extension:{type:qt.DetectionParser,priority:0},test:async()=>Qs("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter((e=>"mp4"!==e&&"m4v"!==e))};Yt.add(ti);const ni={extension:{type:qt.DetectionParser,priority:0},test:async()=>Qs("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter((e=>"ogv"!==e))};Yt.add(ni);const ri={extension:qt.ResolveParser,test:Bs.test,parse:e=>({resolution:parseFloat(Q.RETINA_PREFIX.exec(e)?.[1]??"1"),format:Ae.extname(e).slice(1),src:e})};Yt.add(ri);const oi=(e,t)=>{const n=t.split("?")[1];return n&&(e+=`?${n}`),e};var ai=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e))(ai||{});const si={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let ii,li;function ci(){li={bptc:ii.getExtension("EXT_texture_compression_bptc"),astc:ii.getExtension("WEBGL_compressed_texture_astc"),etc:ii.getExtension("WEBGL_compressed_texture_etc"),s3tc:ii.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:ii.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:ii.getExtension("WEBGL_compressed_texture_pvrtc")||ii.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:ii.getExtension("WEBGL_compressed_texture_etc1"),atc:ii.getExtension("WEBGL_compressed_texture_atc")}}const di={extension:{type:qt.DetectionParser,priority:2},test:async()=>{const e=Q.ADAPTER.createCanvas().getContext("webgl");return e?(ii=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{li||ci();const t=[];for(const n in li)li[n]&&t.push(n);return[...t,...e]},remove:async e=>(li||ci(),e.filter((e=>!(e in li))))};Yt.add(di);class ui extends rn{constructor(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:1,height:1,autoLoad:!0};"string"==typeof e?(t=e,n=new Uint8Array):(t=null,n=e),super(n,r),this.origin=t,this.buffer=n?new Kt(n):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==r.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load||(this._load=fetch(this.origin).then((e=>e.blob())).then((e=>e.arrayBuffer())).then((e=>(this.data=new Uint32Array(e),this.buffer=new Kt(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)))),this._load}}class hi extends ui{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=hi._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||hi._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,n){const r=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;r.pixelStorei(r.UNPACK_ALIGNMENT,4);for(let o=0,a=this.levels;o<a;o++){const{levelID:e,levelWidth:t,levelHeight:n,levelBuffer:a}=this._levelBuffers[o];r.compressedTexImage2D(r.TEXTURE_2D,e,this.format,t,n,0,a)}return!0}onBlobLoaded(){this._levelBuffers=hi._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(36196===e)return"etc1";if(35986===e||35987===e||34798===e)return"atc";if(e>=36492&&e<=36495)return"bptc";if(37808===e)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,n,r,o,a,s){const i=new Array(n);let l=e.byteOffset,c=a,d=s,u=c+r-1&~(r-1),h=d+o-1&~(o-1),p=u*h*si[t];for(let m=0;m<n;m++)i[m]={levelID:m,levelWidth:n>1?c:u,levelHeight:n>1?d:h,levelBuffer:new Uint8Array(e.buffer,l,p)},l+=p,c=c>>1||1,d=d>>1||1,u=c+r-1&~(r-1),h=d+o-1&~(o-1),p=u*h*si[t];return i}}const pi=124,mi=3,fi=4,gi=7,yi=19,vi=2,bi=0,xi=1,wi=2,Si=3,Ti=827611204,Ci=861165636,ki=894720068,Ai={[Ti]:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Ci]:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,[ki]:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT},Ii={70:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:ai.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:ai.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:ai.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:ai.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};const Ei=[171,75,84,88,32,49,49,187,13,10,26,10],Pi=12,_i=16,Ni=24,Ri=28,Mi=36,ji=40,Di=44,Oi=48,Bi=52,Li=56,Fi=60,$i={[G.UNSIGNED_BYTE]:1,[G.UNSIGNED_SHORT]:2,[G.INT]:4,[G.UNSIGNED_INT]:4,[G.FLOAT]:4,[G.HALF_FLOAT]:8},Gi={[F.RGBA]:4,[F.RGB]:3,[F.RG]:2,[F.RED]:1,[F.LUMINANCE]:1,[F.LUMINANCE_ALPHA]:2,[F.ALPHA]:1},zi={[G.UNSIGNED_SHORT_4_4_4_4]:2,[G.UNSIGNED_SHORT_5_5_5_1]:2,[G.UNSIGNED_SHORT_5_6_5]:2};function Ui(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new DataView(t);if(!function(e,t){for(let n=0;n<Ei.length;n++)if(t.getUint8(n)!==Ei[n])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}(e,r))return null;const o=67305985===r.getUint32(Pi,!0),a=r.getUint32(_i,o),s=r.getUint32(Ni,o),i=r.getUint32(Ri,o),l=r.getUint32(Mi,o),c=r.getUint32(ji,o)||1,d=r.getUint32(Di,o)||1,u=r.getUint32(Oi,o)||1,h=r.getUint32(Bi,o),p=r.getUint32(Li,o),m=r.getUint32(Fi,o);if(0===c||1!==d)throw new Error("Only 2D textures are supported");if(1!==h)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const f=l+3&-4,g=c+3&-4,y=new Array(u);let v,b=l*c;if(0===a&&(b=f*g),v=0!==a?$i[a]?$i[a]*Gi[s]:zi[a]:si[i],void 0===v)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const x=n?function(e,t,n){const r=new Map;let o=0;for(;o<t;){const a=e.getUint32(64+o,n),s=64+o+4,i=3-(a+3)%4;if(0===a||a>t-o){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<a&&0!==e.getUint8(s+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=(new TextDecoder).decode(new Uint8Array(e.buffer,s,l)),d=new DataView(e.buffer,s+l+1,a-l-1);r.set(c,d),o+=4+a+i}return r}(r,m,o):null;let w=b*v,S=l,T=c,C=f,k=g,A=64+m;for(let I=0;I<p;I++){const e=r.getUint32(A,o);let n=A+4;for(let r=0;r<u;r++){let e=y[r];e||(e=y[r]=new Array(p)),e[I]={levelID:I,levelWidth:p>1||0!==a?S:C,levelHeight:p>1||0!==a?T:k,levelBuffer:new Uint8Array(t,n,w)},n+=w}A+=e+4,A=A%4!==0?A+4-A%4:A,S=S>>1||1,T=T>>1||1,C=S+4-1&-4,k=T+4-1&-4,w=C*k*v}return 0!==a?{uncompressed:y.map((e=>{let t=e[0].levelBuffer,n=!1;return a===G.FLOAT?t=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):a===G.UNSIGNED_INT?(n=!0,t=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):a===G.INT&&(n=!0,t=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new rn(t,{width:e[0].levelWidth,height:e[0].levelHeight}),type:a,format:n?Hi(s):s}})),kvData:x}:{compressed:y.map((e=>new hi(null,{format:i,width:l,height:c,levels:p,levelBuffers:e}))),kvData:x}}function Hi(e){switch(e){case F.RGBA:return F.RGBA_INTEGER;case F.RGB:return F.RGB_INTEGER;case F.RG:return F.RG_INTEGER;case F.RED:return F.RED_INTEGER;default:return e}}const qi={extension:{type:qt.LoadParser,priority:ys.High},name:"loadDDS",test:e=>hs(e,".dds"),async load(e,t,n){const r=function(e){const t=new Uint32Array(e);if(542327876!==t[0])throw new Error("Invalid DDS file magic word");const n=new Uint32Array(e,0,pi/Uint32Array.BYTES_PER_ELEMENT),r=n[mi],o=n[fi],a=n[gi],s=new Uint32Array(e,yi*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),i=s[1];if(4&i){const n=s[vi];if(808540228!==n){const t=Ai[n],s=new Uint8Array(e,128);return[new hi(s,{format:t,width:o,height:r,levels:a})]}const i=128,l=new Uint32Array(t.buffer,i,20/Uint32Array.BYTES_PER_ELEMENT),c=l[bi],d=l[xi],u=l[wi],h=l[Si],p=Ii[c];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===d)throw new Error("DDSParser does not supported 3D texture data");const m=new Array,f=148;if(1===h)m.push(new Uint8Array(e,f));else{const t=si[p];let n=0,s=o,i=r;for(let e=0;e<a;e++)n+=Math.max(1,s+3&-4)*Math.max(1,i+3&-4)*t,s>>>=1,i>>>=1;let l=f;for(let r=0;r<h;r++)m.push(new Uint8Array(e,l,n)),l+=n}return m.map((e=>new hi(e,{format:p,width:o,height:r,levels:a})))}throw 64&i?new Error("DDSParser does not support uncompressed texture data."):512&i?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&i?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&i?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await(await Q.ADAPTER.fetch(e)).arrayBuffer()).map((r=>js(new sn(r,{mipmap:q.OFF,alphaMode:V.NO_PREMULTIPLIED_ALPHA,resolution:Ht(e),...t.data}),n,e)));return 1===r.length?r[0]:r},unload(e){Array.isArray(e)?e.forEach((e=>e.destroy(!0))):e.destroy(!0)}};Yt.add(qi);const Vi={extension:{type:qt.LoadParser,priority:ys.High},name:"loadKTX",test:e=>hs(e,".ktx"),async load(e,t,n){const r=await(await Q.ADAPTER.fetch(e)).arrayBuffer(),{compressed:o,uncompressed:a,kvData:s}=Ui(e,r),i=o??a,l={mipmap:q.OFF,alphaMode:V.NO_PREMULTIPLIED_ALPHA,resolution:Ht(e),...t.data},c=i.map((t=>{i===a&&Object.assign(l,{type:t.type,format:t.format});const r=t.resource??t,o=new sn(r,l);return o.ktxKeyValueData=s,js(o,n,e)}));return 1===c.length?c[0]:c},unload(e){Array.isArray(e)?e.forEach((e=>e.destroy(!0))):e.destroy(!0)}};Yt.add(Vi);const Wi=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],Yi={extension:qt.ResolveParser,test:e=>{const t=Ae.extname(e).slice(1);return["basis","ktx","dds"].includes(t)},parse:e=>{const t=e.split("."),n=t.pop();if(["ktx","dds"].includes(n)){const n=t.pop();if(Wi.includes(n))return{resolution:parseFloat(Q.RETINA_PREFIX.exec(e)?.[1]??"1"),format:n,src:e}}return{resolution:parseFloat(Q.RETINA_PREFIX.exec(e)?.[1]??"1"),format:n,src:e}}};Yt.add(Yi);const Ki=new Cn,Xi=class e{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,n,r){const o=new Image;return o.src=await this.base64(e,t,n,r),o}async base64(e,t,n,r){const o=this.canvas(e,r);if(void 0!==o.toBlob)return new Promise(((e,r)=>{o.toBlob((t=>{if(!t)return void r(new Error("ICanvas.toBlob failed!"));const n=new FileReader;n.onload=()=>e(n.result),n.onerror=r,n.readAsDataURL(t)}),t,n)}));if(void 0!==o.toDataURL)return o.toDataURL(t,n);if(void 0!==o.convertToBlob){const e=await o.convertToBlob({type:t,quality:n});return new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=n,r.readAsDataURL(e)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,n){const{pixels:r,width:o,height:a,flipY:s,premultipliedAlpha:i}=this._rawPixels(t,n);s&&e._flipY(r,o,a),i&&e._unpremultiplyAlpha(r);const l=new Bt(o,a,1),c=new ImageData(new Uint8ClampedArray(r.buffer),o,a);return l.context.putImageData(c,0,0),l.canvas}pixels(t,n){const{pixels:r,width:o,height:a,flipY:s,premultipliedAlpha:i}=this._rawPixels(t,n);return s&&e._flipY(r,o,a),i&&e._unpremultiplyAlpha(r),r}_rawPixels(e,t){const n=this.renderer;if(!n)throw new Error("The Extract has already been destroyed");let r,o,a=!1,s=!1,i=!1;e&&(e instanceof Ar?o=e:(o=n.generateTexture(e,{region:t,resolution:n.resolution,multisample:n.multisample}),i=!0,t&&(Ki.width=t.width,Ki.height=t.height,t=Ki)));const l=n.gl;if(o){if(r=o.baseTexture.resolution,t=t??o.frame,a=!1,s=o.baseTexture.alphaMode>0&&o.baseTexture.format===F.RGBA,!i){n.renderTexture.bind(o);const e=o.framebuffer.glFramebuffers[n.CONTEXT_UID];e.blitFramebuffer&&n.framebuffer.bind(e.blitFramebuffer)}}else r=n.resolution,t||((t=Ki).width=n.width/r,t.height=n.height/r),a=!0,s=this._rendererPremultipliedAlpha,n.renderTexture.bind();const c=Math.max(Math.round(t.width*r),1),d=Math.max(Math.round(t.height*r),1),u=new Uint8Array(4*c*d);return l.readPixels(Math.round(t.x*r),Math.round(t.y*r),c,d,l.RGBA,l.UNSIGNED_BYTE,u),i&&o?.destroy(!0),{pixels:u,width:c,height:d,flipY:a,premultipliedAlpha:s}}destroy(){this.renderer=null}static _flipY(e,t,n){const r=t<<2,o=n>>1,a=new Uint8Array(r);for(let s=0;s<o;s++){const t=s*r,o=(n-s-1)*r;a.set(e.subarray(t,t+r)),e.copyWithin(t,o,o+r),e.set(a,o)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let n=0;n<t;n+=4){const t=e[n+3];if(0!==t){const r=255.001/t;e[n]=e[n]*r+.5,e[n+1]=e[n+1]*r+.5,e[n+2]=e[n+2]*r+.5}}}};Xi.extension={name:"extract",type:qt.RendererSystem};let Zi=Xi;Yt.add(Zi);const Ji={build(e){const t=e.points;let n,r,o,a,s,i;if(e.type===wn.CIRC){const t=e.shape;n=t.x,r=t.y,s=i=t.radius,o=a=0}else if(e.type===wn.ELIP){const t=e.shape;n=t.x,r=t.y,s=t.width,i=t.height,o=a=0}else{const t=e.shape,l=t.width/2,c=t.height/2;n=t.x+l,r=t.y+c,s=i=Math.max(0,Math.min(t.radius,Math.min(l,c))),o=l-s,a=c-i}if(!(s>=0&&i>=0&&o>=0&&a>=0))return void(t.length=0);const l=Math.ceil(2.3*Math.sqrt(s+i)),c=8*l+(o?4:0)+(a?4:0);if(t.length=c,0===c)return;if(0===l)return t.length=8,t[0]=t[6]=n+o,t[1]=t[3]=r+a,t[2]=t[4]=n-o,void(t[5]=t[7]=r-a);let d=0,u=4*l+(o?2:0)+2,h=u,p=c;{const e=o+s,i=a,l=n+e,c=n-e,m=r+i;if(t[d++]=l,t[d++]=m,t[--u]=m,t[--u]=c,a){const e=r-i;t[h++]=c,t[h++]=e,t[--p]=e,t[--p]=l}}for(let m=1;m<l;m++){const e=Math.PI/2*(m/l),c=o+Math.cos(e)*s,f=a+Math.sin(e)*i,g=n+c,y=n-c,v=r+f,b=r-f;t[d++]=g,t[d++]=v,t[--u]=v,t[--u]=y,t[h++]=y,t[h++]=b,t[--p]=b,t[--p]=g}{const e=a+i,s=n+o,l=n-o,c=r+e,u=r-e;t[d++]=s,t[d++]=c,t[--p]=u,t[--p]=s,o&&(t[d++]=l,t[d++]=c,t[--p]=u,t[--p]=l)}},triangulate(e,t){const n=e.points,r=t.points,o=t.indices;if(0===n.length)return;let a=r.length/2;const s=a;let i,l;if(e.type!==wn.RREC){const t=e.shape;i=t.x,l=t.y}else{const t=e.shape;i=t.x+t.width/2,l=t.y+t.height/2}const c=e.matrix;r.push(e.matrix?c.a*i+c.c*l+c.tx:i,e.matrix?c.b*i+c.d*l+c.ty:l),a++,r.push(n[0],n[1]);for(let d=2;d<n.length;d+=2)r.push(n[d],n[d+1]),o.push(a++,s,a);o.push(s+1,s,a)}};function Qi(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.length;if(n<6)return;let r=0;for(let o=0,a=e[n-2],s=e[n-1];o<n;o+=2){const t=e[o],n=e[o+1];r+=(t-a)*(n+s),a=t,s=n}if(!t&&r>0||t&&r<=0){const t=n/2;for(let r=t+t%2;r<n;r+=2){const t=n-r-2,o=n-r-1,a=r,s=r+1;[e[t],e[a]]=[e[a],e[t]],[e[o],e[s]]=[e[s],e[o]]}}}const el={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let n=e.points;const r=e.holes,o=t.points,a=t.indices;if(n.length>=6){Qi(n,!1);const e=[];for(let o=0;o<r.length;o++){const t=r[o];Qi(t.points,!0),e.push(n.length/2),n=n.concat(t.points)}const t=be(n,e,2);if(!t)return;const s=o.length/2;for(let n=0;n<t.length;n+=3)a.push(t[n]+s),a.push(t[n+1]+s),a.push(t[n+2]+s);for(let r=0;r<n.length;r++)o.push(n[r])}}},tl={build(e){const t=e.shape,n=t.x,r=t.y,o=t.width,a=t.height,s=e.points;s.length=0,o>=0&&a>=0&&s.push(n,r,n+o,r,n+o,r+a,n,r+a)},triangulate(e,t){const n=e.points,r=t.points;if(0===n.length)return;const o=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),t.indices.push(o,o+1,o+2,o+1,o+2,o+3)}},nl={build(e){Ji.build(e)},triangulate(e,t){Ji.triangulate(e,t)}};var rl=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(rl||{}),ol=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(ol||{});const al={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(!this.adaptive||!e||isNaN(e))return t;let n=Math.ceil(e/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}};class sl{static curveTo(e,t,n,r,o,a){const s=a[a.length-2],i=a[a.length-1]-t,l=s-e,c=r-t,d=n-e,u=Math.abs(i*d-l*c);if(u<1e-8||0===o)return(a[a.length-2]!==e||a[a.length-1]!==t)&&a.push(e,t),null;const h=i*i+l*l,p=c*c+d*d,m=i*c+l*d,f=o*Math.sqrt(h)/u,g=o*Math.sqrt(p)/u,y=f*m/h,v=g*m/p,b=f*d+g*l,x=f*c+g*i,w=l*(g+y),S=i*(g+y),T=d*(f+v),C=c*(f+v);return{cx:b+e,cy:x+t,radius:o,startAngle:Math.atan2(S-x,w-b),endAngle:Math.atan2(C-x,T-b),anticlockwise:l*c>d*i}}static arc(e,t,n,r,o,a,s,i,l){const c=s-a,d=al._segmentsCount(Math.abs(c)*o,40*Math.ceil(Math.abs(c)/vn)),u=c/(2*d),h=2*u,p=Math.cos(u),m=Math.sin(u),f=d-1,g=f%1/f;for(let y=0;y<=f;++y){const e=u+a+h*(y+g*y),t=Math.cos(e),s=-Math.sin(e);l.push((p*t+m*s)*o+n,(p*-s+m*t)*o+r)}}}class il{static curveLength(e,t,n,r,o,a,s,i){let l=0,c=0,d=0,u=0,h=0,p=0,m=0,f=0,g=0,y=0,v=0,b=e,x=t;for(let w=1;w<=10;++w)c=w/10,d=c*c,u=d*c,h=1-c,p=h*h,m=p*h,f=m*e+3*p*c*n+3*h*d*o+u*s,g=m*t+3*p*c*r+3*h*d*a+u*i,y=b-f,v=x-g,b=f,x=g,l+=Math.sqrt(y*y+v*v);return l}static curveTo(e,t,n,r,o,a,s){const i=s[s.length-2],l=s[s.length-1];s.length-=2;const c=al._segmentsCount(il.curveLength(i,l,e,t,n,r,o,a));let d=0,u=0,h=0,p=0,m=0;s.push(i,l);for(let f=1,g=0;f<=c;++f)g=f/c,d=1-g,u=d*d,h=u*d,p=g*g,m=p*g,s.push(h*i+3*u*g*e+3*d*p*n+m*o,h*l+3*u*g*t+3*d*p*r+m*a)}}function ll(e,t,n,r,o,a,s,i){let l,c;s?(l=r,c=-n):(l=-r,c=n);const d=e-n*o+l,u=t-r*o+c,h=e+n*a+l,p=t+r*a+c;return i.push(d,u,h,p),2}function cl(e,t,n,r,o,a,s,i){const l=n-e,c=r-t;let d=Math.atan2(l,c),u=Math.atan2(o-e,a-t);i&&d<u?d+=2*Math.PI:!i&&d>u&&(u+=2*Math.PI);let h=d;const p=u-d,m=Math.abs(p),f=Math.sqrt(l*l+c*c),g=1+(15*m*Math.sqrt(f)/Math.PI|0),y=p/g;if(h+=y,i){s.push(e,t,n,r);for(let n=1,r=h;n<g;n++,r+=y)s.push(e,t,e+Math.sin(r)*f,t+Math.cos(r)*f);s.push(e,t,o,a)}else{s.push(n,r,e,t);for(let n=1,r=h;n<g;n++,r+=y)s.push(e+Math.sin(r)*f,t+Math.cos(r)*f,e,t);s.push(o,a,e,t)}return 2*g}function dl(e,t){e.lineStyle.native?function(e,t){let n=0;const r=e.shape,o=e.points||r.points,a=r.type!==wn.POLY||r.closeStroke;if(0===o.length)return;const s=t.points,i=t.indices,l=o.length/2,c=s.length/2;let d=c;for(s.push(o[0],o[1]),n=1;n<l;n++)s.push(o[2*n],o[2*n+1]),i.push(d,d+1),d++;a&&i.push(d,c)}(e,t):function(e,t){const n=e.shape;let r=e.points||n.points.slice();const o=t.closePointEps;if(0===r.length)return;const a=e.lineStyle,s=new Sn(r[0],r[1]),i=new Sn(r[r.length-2],r[r.length-1]),l=n.type!==wn.POLY||n.closeStroke,c=Math.abs(s.x-i.x)<o&&Math.abs(s.y-i.y)<o;if(l){r=r.slice(),c&&(r.pop(),r.pop(),i.set(r[r.length-2],r[r.length-1]));const e=.5*(s.x+i.x),t=.5*(i.y+s.y);r.unshift(e,t),r.push(e,t)}const d=t.points,u=r.length/2;let h=r.length;const p=d.length/2,m=a.width/2,f=m*m,g=a.miterLimit*a.miterLimit;let y=r[0],v=r[1],b=r[2],x=r[3],w=0,S=0,T=-(v-x),C=y-b,k=0,A=0,I=Math.sqrt(T*T+C*C);T/=I,C/=I,T*=m,C*=m;const E=a.alignment,P=2*(1-E),_=2*E;l||(a.cap===ol.ROUND?h+=cl(y-T*(P-_)*.5,v-C*(P-_)*.5,y-T*P,v-C*P,y+T*_,v+C*_,d,!0)+2:a.cap===ol.SQUARE&&(h+=ll(y,v,T,C,P,_,!0,d))),d.push(y-T*P,v-C*P,y+T*_,v+C*_);for(let M=1;M<u-1;++M){y=r[2*(M-1)],v=r[2*(M-1)+1],b=r[2*M],x=r[2*M+1],w=r[2*(M+1)],S=r[2*(M+1)+1],T=-(v-x),C=y-b,I=Math.sqrt(T*T+C*C),T/=I,C/=I,T*=m,C*=m,k=-(x-S),A=b-w,I=Math.sqrt(k*k+A*A),k/=I,A/=I,k*=m,A*=m;const e=b-y,t=v-x,n=b-w,o=S-x,s=e*n+t*o,i=t*n-o*e,l=i<0;if(Math.abs(i)<.001*Math.abs(s)){d.push(b-T*P,x-C*P,b+T*_,x+C*_),s>=0&&(a.join===rl.ROUND?h+=cl(b,x,b-T*P,x-C*P,b-k*P,x-A*P,d,!1)+4:h+=2,d.push(b-k*_,x-A*_,b+k*P,x+A*P));continue}const c=(-T+y)*(-C+x)-(-T+b)*(-C+v),u=(-k+w)*(-A+x)-(-k+b)*(-A+S),p=(e*u-n*c)/i,E=(o*c-t*u)/i,N=(p-b)*(p-b)+(E-x)*(E-x),R=b+(p-b)*P,j=x+(E-x)*P,D=b-(p-b)*_,O=x-(E-x)*_,B=l?P:_,L=N<=Math.min(e*e+t*t,n*n+o*o)+B*B*f;let F=a.join;if(F===rl.MITER&&N/f>g&&(F=rl.BEVEL),L)switch(F){case rl.MITER:d.push(R,j,D,O);break;case rl.BEVEL:l?d.push(R,j,b+T*_,x+C*_,R,j,b+k*_,x+A*_):d.push(b-T*P,x-C*P,D,O,b-k*P,x-A*P,D,O),h+=2;break;case rl.ROUND:l?(d.push(R,j,b+T*_,x+C*_),h+=cl(b,x,b+T*_,x+C*_,b+k*_,x+A*_,d,!0)+4,d.push(R,j,b+k*_,x+A*_)):(d.push(b-T*P,x-C*P,D,O),h+=cl(b,x,b-T*P,x-C*P,b-k*P,x-A*P,d,!1)+4,d.push(b-k*P,x-A*P,D,O))}else{switch(d.push(b-T*P,x-C*P,b+T*_,x+C*_),F){case rl.MITER:l?d.push(D,O,D,O):d.push(R,j,R,j),h+=2;break;case rl.ROUND:h+=l?cl(b,x,b+T*_,x+C*_,b+k*_,x+A*_,d,!0)+2:cl(b,x,b-T*P,x-C*P,b-k*P,x-A*P,d,!1)+2}d.push(b-k*P,x-A*P,b+k*_,x+A*_),h+=2}}y=r[2*(u-2)],v=r[2*(u-2)+1],b=r[2*(u-1)],x=r[2*(u-1)+1],T=-(v-x),C=y-b,I=Math.sqrt(T*T+C*C),T/=I,C/=I,T*=m,C*=m,d.push(b-T*P,x-C*P,b+T*_,x+C*_),l||(a.cap===ol.ROUND?h+=cl(b-T*(P-_)*.5,x-C*(P-_)*.5,b-T*P,x-C*P,b+T*_,x+C*_,d,!1)+2:a.cap===ol.SQUARE&&(h+=ll(b,x,T,C,P,_,!1,d)));const N=t.indices,R=al.epsilon*al.epsilon;for(let M=p;M<h+p-2;++M)y=d[2*M],v=d[2*M+1],b=d[2*(M+1)],x=d[2*(M+1)+1],w=d[2*(M+2)],S=d[2*(M+2)+1],!(Math.abs(y*(x-S)+b*(S-v)+w*(v-x))<R)&&N.push(M,M+1,M+2)}(e,t)}class ul{static curveLength(e,t,n,r,o,a){const s=e-2*n+o,i=t-2*r+a,l=2*n-2*e,c=2*r-2*t,d=4*(s*s+i*i),u=4*(s*l+i*c),h=l*l+c*c,p=2*Math.sqrt(d+u+h),m=Math.sqrt(d),f=2*d*m,g=2*Math.sqrt(h),y=u/m;return(f*p+m*u*(p-g)+(4*h*d-u*u)*Math.log((2*m+y+p)/(y+g)))/(4*f)}static curveTo(e,t,n,r,o){const a=o[o.length-2],s=o[o.length-1],i=al._segmentsCount(ul.curveLength(a,s,e,t,n,r));let l=0,c=0;for(let d=1;d<=i;++d){const u=d/i;l=a+(e-a)*u,c=s+(t-s)*u,o.push(l+(e+(n-e)*u-l)*u,c+(t+(r-t)*u-c)*u)}}}const hl={[wn.POLY]:el,[wn.CIRC]:Ji,[wn.ELIP]:Ji,[wn.RECT]:tl,[wn.RREC]:nl},pl=[],ml=[];class fl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.points=[],this.holes=[],this.shape=e,this.lineStyle=n,this.fillStyle=t,this.matrix=r,this.type=e.type}clone(){return new fl(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class gl{constructor(){this.reset()}begin(e,t,n){this.reset(),this.style=e,this.start=t,this.attribStart=n}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const yl=new Sn,vl=class e extends yn{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new la,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),ml.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),pl.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e){const t=new fl(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return this.graphicsData.push(t),this.dirty++,this}drawHole(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.graphicsData.length)return null;const n=new fl(e,null,null,t),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let n=0;n<t.length;++n){const r=t[n];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(e,yl):yl.copyFrom(e),r.shape.contains(yl.x,yl.y))){let e=!1;if(r.holes)for(let t=0;t<r.holes.length;t++)if(r.holes[t].shape.contains(yl.x,yl.y)){e=!0;break}if(!e)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let n=null,r=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],r=n.style);for(let i=this.shapeIndex;i<t.length;i++){this.shapeIndex++;const o=t[i],a=o.fillStyle,s=o.lineStyle;hl[o.type].build(o),o.matrix&&this.transformPoints(o.points,o.matrix),(a.visible||s.visible)&&this.processHoles(o.holes);for(let t=0;t<2;t++){const i=0===t?a:s;if(!i.visible)continue;const l=i.texture.baseTexture,c=this.indices.length,d=this.points.length/2;l.wrapMode=H.REPEAT,0===t?this.processFill(o):this.processLine(o);const u=this.points.length/2-d;0!==u&&(n&&!this._compareStyles(r,i)&&(n.end(c,d),n=null),n||(n=pl.pop()||new gl,n.begin(i,c,d),this.batches.push(n),r=i),this.addUvs(this.points,e,i.texture,d,u,i.matrix))}}const o=this.indices.length,a=this.points.length/2;if(n&&n.end(o,a),0===this.batches.length)return void(this.batchable=!0);const s=a>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&s===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=s?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const t=this.graphicsData[e],n=t.fillStyle,r=t.lineStyle;if(n&&!n.texture.baseTexture.valid||r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,n=e.length;t<n;t++){const n=e[t];for(let e=0;e<n.size;e++){const t=n.start+e;this.indicesUint16[t]=this.indicesUint16[t]-n.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE}buildDrawCalls(){let e=++sn._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),ml.push(this.drawCalls[d]);this.drawCalls.length=0;const t=this.colors,n=this.textureIds;let r=ml.pop();r||(r=new ln,r.texArray=new lr),r.texArray.count=0,r.start=0,r.size=0,r.type=L.TRIANGLES;let o=0,a=null,s=0,i=!1,l=L.TRIANGLES,c=0;this.drawCalls.push(r);for(let d=0;d<this.batches.length;d++){const u=this.batches[d],h=8,p=u.style,m=p.texture.baseTexture;i!==!!p.native&&(i=!!p.native,l=i?L.LINES:L.TRIANGLES,a=null,o=h,e++),a!==m&&(a=m,m._batchEnabled!==e&&(o===h&&(e++,o=0,r.size>0&&(r=ml.pop(),r||(r=new ln,r.texArray=new lr),this.drawCalls.push(r)),r.start=c,r.size=0,r.texArray.count=0,r.type=l),m.touched=1,m._batchEnabled=e,m._batchLocation=o,m.wrapMode=H.REPEAT,r.texArray.elements[r.texArray.count++]=m,o++)),r.size+=u.size,c+=u.size,s=m._batchLocation,this.addColors(t,p.color,p.alpha,u.attribSize,u.attribStart),this.addTextureIds(n,s,u.attribSize,u.attribStart)}sn._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,n=this.colors,r=this.textureIds,o=new ArrayBuffer(3*e.length*4),a=new Float32Array(o),s=new Uint32Array(o);let i=0;for(let l=0;l<e.length/2;l++)a[i++]=e[2*l],a[i++]=e[2*l+1],a[i++]=t[2*l],a[i++]=t[2*l+1],s[i++]=n[l],a[i++]=r[l];this._buffer.update(o),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?el.triangulate(e,this):hl[e.type].triangulate(e,this)}processLine(e){dl(e,this);for(let t=0;t<e.holes.length;t++)dl(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const n=e[t];hl[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let n=0;n<e.length/2;n++){const r=e[2*n],o=e[2*n+1];e[2*n]=t.a*r+t.c*o+t.tx,e[2*n+1]=t.b*r+t.d*o+t.ty}}addColors(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const a=lt.shared.setValue(t).toLittleEndianNumber(),s=lt.shared.setValue(a).toPremultiplied(n);e.length=Math.max(e.length,o+r);for(let i=0;i<r;i++)e[o+i]=s}addTextureIds(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.length=Math.max(e.length,r+n);for(let o=0;o<n;o++)e[r+o]=t}addUvs(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=0;const i=t.length,l=n.frame;for(;s<o;){let n=e[2*(r+s)],o=e[2*(r+s)+1];if(a){const e=a.a*n+a.c*o+a.tx;o=a.b*n+a.d*o+a.ty,n=e}s++,t.push(n/l.width,o/l.height)}const c=n.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(t,n,i,o)}adjustUvs(e,t,n,r){const o=t.baseTexture,a=1e-6,s=n+2*r,i=t.frame,l=i.width/o.width,c=i.height/o.height;let d=i.x/i.width,u=i.y/i.height,h=Math.floor(e[n]+a),p=Math.floor(e[n+1]+a);for(let m=n+2;m<s;m+=2)h=Math.min(h,Math.floor(e[m]+a)),p=Math.min(p,Math.floor(e[m+1]+a));d-=h,u-=p;for(let m=n;m<s;m+=2)e[m]=(e[m]+d)*l,e[m+1]=(e[m+1]+u)*c}};vl.BATCHABLE_SIZE=100;let bl=vl;class xl{constructor(){this.color=16777215,this.alpha=1,this.texture=kr.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new xl;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=kr.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class wl extends xl{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ol.BUTT,this.join=rl.MITER,this.miterLimit=10}clone(){const e=new wl;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ol.BUTT,this.join=rl.MITER,this.miterLimit=10}}const Sl={},Tl=class e extends ma{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new xl,this._lineStyle=new wl,this._matrix=null,this._holeMode=!1,this.state=Jt.for2d(),this._geometry=e||new bl,this._geometry.refCount++,this._transformID=-1,this._tintColor=new lt(16777215),this.blendMode=B.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new e(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"number"==typeof e&&(e={width:e,color:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,alpha:arguments.length>2?arguments[2]:void 0,alignment:arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,native:arguments.length>4&&void 0!==arguments[4]&&arguments[4]}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:kr.WHITE,color:e?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ol.BUTT,join:rl.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const n=e.width>0&&e.alpha>0;return n?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:n},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new In,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new In,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,r=n[n.length-2],o=n[n.length-1];return(r!==e||o!==t)&&n.push(e,t),this}_initCurve(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,n,r){this._initCurve();const o=this.currentPath.points;return 0===o.length&&this.moveTo(0,0),ul.curveTo(e,t,n,r,o),this}bezierCurveTo(e,t,n,r,o,a){return this._initCurve(),il.curveTo(e,t,n,r,o,a,this.currentPath.points),this}arcTo(e,t,n,r,o){this._initCurve(e,t);const a=this.currentPath.points,s=sl.curveTo(e,t,n,r,o,a);if(s){const{cx:e,cy:t,radius:n,startAngle:r,endAngle:o,anticlockwise:a}=s;this.arc(e,t,n,r,o,a)}return this}arc(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(r===o)return this;if(!a&&o<=r?o+=vn:a&&r<=o&&(r+=vn),o-r===0)return this;const s=e+Math.cos(r)*n,i=t+Math.sin(r)*n,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const e=Math.abs(c[c.length-2]-s),t=Math.abs(c[c.length-1]-i);e<l&&t<l||c.push(s,i)}else this.moveTo(s,i),c=this.currentPath.points;return sl.arc(s,i,e,t,n,r,o,a,c),this}beginFill(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return this.beginTextureFill({texture:kr.WHITE,color:e,alpha:t})}normalizeColor(e){const t=lt.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:kr.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const n=e.alpha>0;return n?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:n},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,n,r){return this.drawShape(new Cn(e,t,n,r))}drawRoundedRect(e,t,n,r,o){return this.drawShape(new En(e,t,n,r,o))}drawCircle(e,t,n){return this.drawShape(new kn(e,t,n))}drawEllipse(e,t,n,r){return this.drawShape(new An(e,t,n,r))}drawPolygon(){let e,t=!0;for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=r[0];a.points?(t=a.closeStroke,e=a.points):e=Array.isArray(r[0])?r[0]:r;const s=new In(e);return s.closeStroke=t,this.drawShape(s),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return 1===e.length&&e[0].shape.type===wn.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,n=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(e.points);for(let r=0;r<n;r++){const n=e.batches[r],o=n.style.color,a=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),s=new Float32Array(e.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),i={vertexData:a,blendMode:t,indices:new Uint16Array(e.indicesUint16.buffer,2*n.start,n.size),uvs:s,_batchRGB:lt.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=i}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,n=this.batches.length;t<n;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}}_renderDirect(e){const t=this._resolveDirectShader(e),n=this._geometry,r=this.worldAlpha,o=t.uniforms,a=n.drawCalls;o.translationMatrix=this.transform.worldTransform,lt.shared.setValue(this._tintColor).premultiply(r).toArray(o.tint),e.shader.bind(t),e.geometry.bind(n,t),e.state.set(this.state);for(let s=0,i=a.length;s<i;s++)this._renderDrawCallDirect(e,n.drawCalls[s])}_renderDrawCallDirect(e,t){const{texArray:n,type:r,size:o,start:a}=t,s=n.count;for(let i=0;i<s;i++)e.texture.bind(n.elements[i],i);e.geometry.draw(r,o,a)}_resolveDirectShader(e){let t=this.shader;const n=this.pluginName;if(!t){if(!Sl[n]){const{maxTextures:t}=e.plugins[n],r=new Int32Array(t);for(let e=0;e<t;e++)r[e]=e;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Pn,default:ar.from({uSamplers:r},!0)},a=e.plugins[n]._shader.program;Sl[n]=new sr(a,o)}t=Sl[n]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:n,maxX:r,maxY:o}=e.bounds;this._bounds.addFrame(this.transform,t,n,r,o)}containsPoint(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=lt.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,n=t.a,r=t.b,o=t.c,a=t.d,s=t.tx,i=t.ty,l=this._geometry.points,c=this.vertexData;let d=0;for(let u=0;u<l.length;u+=2){const e=l[u],t=l[u+1];c[d++]=n*e+o*t+s,c[d++]=a*t+r*e+i}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};Tl.curves=al,Tl._TEMP_POINT=new Sn;let Cl=Tl;class kl{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const Al=new Sn,Il=new In,El=class e extends ma{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.TRIANGLES;super(),this.geometry=e,this.shader=t,this.state=n||Jt.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Q.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(t){const n=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===L.TRIANGLES&&n.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const r=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[r]),e.plugins[r].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,n=e._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const r=this.transform.worldTransform,o=r.a,a=r.b,s=r.c,i=r.d,l=r.tx,c=r.ty,d=this.vertexData;for(let u=0;u<d.length/2;u++){const e=t[2*u],n=t[2*u+1];d[2*u]=o*e+s*n+l,d[2*u+1]=a*e+i*n+c}if(this._roundPixels){const e=Q.RESOLUTION;for(let t=0;t<d.length;++t)d[t]=Math.round(d[t]*e)/e}this.vertexDirty=n}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new kl(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,Al);const t=this.geometry.getBuffer("aVertexPosition").data,n=Il.points,r=this.geometry.getIndex().data,o=r.length,a=4===this.drawMode?3:1;for(let s=0;s+2<o;s+=a){const e=2*r[s],o=2*r[s+1],a=2*r[s+2];if(n[0]=t[e],n[1]=t[e+1],n[2]=t[o],n[3]=t[o+1],n[4]=t[a],n[5]=t[a+1],Il.contains(Al.x,Al.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};El.BATCHABLE_SIZE=100;let Pl=El;class _l extends gn{constructor(e,t,n){super();const r=new dn(e),o=new dn(t,!0),a=new dn(n,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,G.FLOAT).addAttribute("aTextureCoord",o,2,!1,G.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class Nl extends sr{constructor(e,t){const n={uSampler:e,alpha:1,uTextureMatrix:Pn.IDENTITY,uColor:new Float32Array([1,1,1,1])};(t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t)).uniforms&&Object.assign(n,t.uniforms),super(t.program||rr.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n),this._colorDirty=!1,this.uvMatrix=new $r(e),this.batchable=void 0===t.program,this.pluginName=t.pluginName,this._tintColor=new lt(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;lt.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Rl extends _l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(),this.segWidth=n,this.segHeight=r,this.width=e,this.height=t,this.build()}build(){const e=this.segWidth*this.segHeight,t=[],n=[],r=[],o=this.segWidth-1,a=this.segHeight-1,s=this.width/o,i=this.height/a;for(let c=0;c<e;c++){const e=c%this.segWidth,r=c/this.segWidth|0;t.push(e*s,r*i),n.push(e/o,r/a)}const l=o*a;for(let c=0;c<l;c++){const e=c%o,t=c/o|0,n=t*this.segWidth+e,a=t*this.segWidth+e+1,s=(t+1)*this.segWidth+e,i=(t+1)*this.segWidth+e+1;r.push(n,a,s,a,i,s)}this.buffers[0].data=new Float32Array(t),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class Ml extends _l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(new Float32Array(4*t.length),new Float32Array(4*t.length),new Uint16Array(6*(t.length-1))),this.points=t,this._width=e,this.textureScale=n,this.build()}get width(){return this._width}build(){const e=this.points;if(!e)return;const t=this.getBuffer("aVertexPosition"),n=this.getBuffer("aTextureCoord"),r=this.getIndex();if(e.length<1)return;t.data.length/4!==e.length&&(t.data=new Float32Array(4*e.length),n.data=new Float32Array(4*e.length),r.data=new Uint16Array(6*(e.length-1)));const o=n.data,a=r.data;o[0]=0,o[1]=0,o[2]=0,o[3]=1;let s=0,i=e[0];const l=this._width*this.textureScale,c=e.length;for(let u=0;u<c;u++){const t=4*u;if(this.textureScale>0){const t=i.x-e[u].x,n=i.y-e[u].y,r=Math.sqrt(t*t+n*n);i=e[u],s+=r/l}else s=u/(c-1);o[t]=s,o[t+1]=0,o[t+2]=s,o[t+3]=1}let d=0;for(let u=0;u<c-1;u++){const e=2*u;a[d++]=e,a[d++]=e+1,a[d++]=e+2,a[d++]=e+2,a[d++]=e+1,a[d++]=e+3}n.update(),r.update(),this.updateVertices()}updateVertices(){const e=this.points;if(e.length<1)return;let t,n=e[0],r=0,o=0;const a=this.buffers[0].data,s=e.length,i=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<s;l++){const c=e[l],d=4*l;t=l<e.length-1?e[l+1]:c,o=-(t.x-n.x),r=t.y-n.y;let u=10*(1-l/(s-1));u>1&&(u=1);const h=Math.sqrt(r*r+o*o);h<1e-6?(r=0,o=0):(r/=h,o/=h,r*=i,o*=i),a[d]=c.x+r,a[d+1]=c.y+o,a[d+2]=c.x-r,a[d+3]=c.y-o,n=c}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class jl extends Pl{constructor(e,t,n){super(new Rl(e.width,e.height,t,n),new Nl(kr.WHITE)),this.texture=e,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const e=this.geometry,{width:t,height:n}=this.shader.texture;this.autoResize&&(e.width!==t||e.height!==n)&&(e.width=this.shader.texture.width,e.height=this.shader.texture.height,e.build())}set texture(e){this.shader.texture!==e&&(this.shader.texture=e,this._textureID=-1,e.baseTexture.valid?this.textureUpdated():e.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(e)}destroy(e){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(e)}}class Dl extends jl{constructor(e,t,n,r,o){super(kr.WHITE,4,4),this._origWidth=e.orig.width,this._origHeight=e.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=t??e.defaultBorders?.left??10,this._rightWidth=r??e.defaultBorders?.right??10,this._topHeight=n??e.defaultBorders?.top??10,this._bottomHeight=o??e.defaultBorders?.bottom??10,this.texture=e}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(e){this.geometry.getBuffer("aVertexPosition").data=e}updateHorizontalVertices(){const e=this.vertices,t=this._getMinScale();e[9]=e[11]=e[13]=e[15]=this._topHeight*t,e[17]=e[19]=e[21]=e[23]=this._height-this._bottomHeight*t,e[25]=e[27]=e[29]=e[31]=this._height}updateVerticalVertices(){const e=this.vertices,t=this._getMinScale();e[2]=e[10]=e[18]=e[26]=this._leftWidth*t,e[4]=e[12]=e[20]=e[28]=this._width-this._rightWidth*t,e[6]=e[14]=e[22]=e[30]=this._width}_getMinScale(){const e=this._leftWidth+this._rightWidth,t=this._width>e?1:this._width/e,n=this._topHeight+this._bottomHeight,r=this._height>n?1:this._height/n;return Math.min(t,r)}get width(){return this._width}set width(e){this._width=e,this._refresh()}get height(){return this._height}set height(e){this._height=e,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(e){this._leftWidth=e,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(e){this._rightWidth=e,this._refresh()}get topHeight(){return this._topHeight}set topHeight(e){this._topHeight=e,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(e){this._bottomHeight=e,this._refresh()}_refresh(){const e=this.texture,t=this.geometry.buffers[1].data;this._origWidth=e.orig.width,this._origHeight=e.orig.height;const n=1/this._origWidth,r=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=n*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-n*this._rightWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class Ol{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Bl(e,t){let n=!1;if(e?._textures?.length)for(let r=0;r<e._textures.length;r++)if(e._textures[r]instanceof kr){const o=e._textures[r].baseTexture;t.includes(o)||(t.push(o),n=!0)}return n}function Ll(e,t){if(e.baseTexture instanceof sn){const n=e.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function Fl(e,t){if(e._texture&&e._texture instanceof kr){const n=e._texture.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function $l(e,t){return t instanceof Fa&&(t.updateText(!0),!0)}function Gl(e,t){if(t instanceof ja){const e=t.toFontString();return Na.measureFont(e),!0}return!1}function zl(e,t){if(e instanceof Fa){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const n=e._texture.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function Ul(e,t){return e instanceof ja&&(t.includes(e)||t.push(e),!0)}const Hl=class e{constructor(t){this.limiter=new Ol(e.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(zl),this.registerFindHook(Ul),this.registerFindHook(Bl),this.registerFindHook(Ll),this.registerFindHook(Fl),this.registerUploadHook($l),this.registerUploadHook(Gl)}upload(e){return new Promise((t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Ro.system.addOnce(this.tick,this,Po.UTILITY))):t()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed)for(let n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)Ro.system.addOnce(this.tick,this,Po.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,n=e.length;t<n;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,n=this.addHooks.length;t<n&&!this.addHooks[t](e,this.queue);t++);if(e instanceof ma)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Ro.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Hl.uploadsPerFrame=4;let ql=Hl;function Vl(e,t){return t instanceof sn&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function Wl(e,t){if(!(t instanceof Cl))return!1;const{geometry:n}=t;t.finishPoly(),n.updateBatches();const{batches:r}=n;for(let o=0;o<r.length;o++){const{texture:t}=r[o].style;t&&Vl(e,t.baseTexture)}return n.batchable||e.geometry.bind(n,t._resolveDirectShader(e)),!0}function Yl(e,t){return e instanceof Cl&&(t.push(e),!0)}Object.defineProperties(Q,{UPLOADS_PER_FRAME:{get:()=>ql.uploadsPerFrame,set(e){Se("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),ql.uploadsPerFrame=e}}});class Kl extends ql{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(Yl),this.registerUploadHook(Vl),this.registerUploadHook(Wl)}}Kl.extension={name:"prepare",type:qt.RendererSystem},Yt.add(Kl);const Xl=class e{constructor(e,t,n){this.linkedSheets=[],(e instanceof sn||e instanceof kr)&&(e={texture:e,data:t,resolutionFilename:n});const{texture:r,data:o,resolutionFilename:a=null,cachePrefix:s=""}=e;this.cachePrefix=s,this._texture=r instanceof kr?r:null,this.baseTexture=r instanceof sn?r:this._texture.baseTexture,this.textures={},this.animations={},this.data=o;const i=this.baseTexture.resource;this.resolution=this._updateResolution(a||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const{scale:t}=this.data.meta;let n=Ht(e,null);return null===n&&(n="number"==typeof t?t:parseFloat(t??"1")),1!==n&&this.baseTexture.setResolution(n),n}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let n=t;const r=e.BATCH_SIZE;for(;n-t<r&&n<this._frameKeys.length;){const e=this._frameKeys[n],t=this._frames[e],r=t.frame;if(r){let n=null,o=null;const a=!1!==t.trimmed&&t.sourceSize?t.sourceSize:t.frame,s=new Cn(0,0,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution);n=t.rotated?new Cn(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new Cn(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==t.trimmed&&t.spriteSourceSize&&(o=new Cn(Math.floor(t.spriteSourceSize.x)/this.resolution,Math.floor(t.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[e]=new kr(this.baseTexture,n,s,o,t.rotated?2:0,t.anchor,t.borders),kr.addToCache(this.textures[e],this.cachePrefix+e.toString())}n++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let n=0;n<e[t].length;n++){const r=e[t][n];this.animations[t].push(this.textures[r])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*e.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Xl.BATCH_SIZE=1e3;let Zl=Xl;const Jl=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Ql(e,t,n){const r={};if(e.forEach((e=>{r[e]=t})),Object.keys(t.textures).forEach((e=>{r[`${t.cachePrefix}${e}`]=t.textures[e]})),!n){const n=Ae.dirname(e[0]);t.linkedSheets.forEach(((e,o)=>{Object.assign(r,Ql([`${n}/${t.data.meta.related_multi_packs[o]}`],e,!0))}))}return r}const ec={extension:qt.Asset,cache:{test:e=>e instanceof Zl,getCacheableAssets:(e,t)=>Ql(e,t,!1)},resolver:{test:e=>{const t=e.split("?")[0].split("."),n=t.pop(),r=t.pop();return"json"===n&&Jl.includes(r)},parse:e=>{const t=e.split(".");return{resolution:parseFloat(Q.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:qt.LoadParser,priority:ys.Normal},testParse:async(e,t)=>".json"===Ae.extname(t.src).toLowerCase()&&!!e.frames,async parse(e,t,n){const{texture:r,imageFilename:o,cachePrefix:a}=t?.data??{};let s,i=Ae.dirname(t.src);if(i&&i.lastIndexOf("/")!==i.length-1&&(i+="/"),r&&r.baseTexture)s=r;else{const r=oi(i+(o??e.meta.image),t.src);s=(await n.load([r]))[r]}const l=new Zl({texture:s.baseTexture,data:e,resolutionFilename:t.src,cachePrefix:a});await l.parse();const c=e?.meta?.related_multi_packs;if(Array.isArray(c)){const e=[];for(const o of c){if("string"!=typeof o)continue;let r=i+o;t.data?.ignoreMultiPack||(r=oi(r,t.src),e.push(n.load({src:r,data:{ignoreMultiPack:!0}})))}const r=await Promise.all(e);l.linkedSheets=r,r.forEach((e=>{e.linkedSheets=[l].concat(l.linkedSheets.filter((t=>t!==e)))}))}return l},unload(e){e.destroy(!0)}}};Yt.add(ec);class tc{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class nc{static test(e){return"string"==typeof e&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const o in t){const e=t[o].match(/^[a-z]+/gm)[0],r=t[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),a={};for(const t in r){const e=r[t].split("="),n=e[0],o=e[1].replace(/"/gm,""),s=parseFloat(o),i=isNaN(s)?o:s;a[n]=i}n[e].push(a)}const r=new tc;return n.info.forEach((e=>r.info.push({face:e.face,size:parseInt(e.size,10)}))),n.common.forEach((e=>r.common.push({lineHeight:parseInt(e.lineHeight,10)}))),n.page.forEach((e=>r.page.push({id:parseInt(e.id,10),file:e.file}))),n.char.forEach((e=>r.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)}))),n.kerning.forEach((e=>r.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)}))),n.distanceField.forEach((e=>r.distanceField.push({distanceRange:parseInt(e.distanceRange,10),fieldType:e.fieldType}))),r}}class rc{static test(e){const t=e;return"string"!=typeof e&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")}static parse(e){const t=new tc,n=e.getElementsByTagName("info"),r=e.getElementsByTagName("common"),o=e.getElementsByTagName("page"),a=e.getElementsByTagName("char"),s=e.getElementsByTagName("kerning"),i=e.getElementsByTagName("distanceField");for(let l=0;l<n.length;l++)t.info.push({face:n[l].getAttribute("face"),size:parseInt(n[l].getAttribute("size"),10)});for(let l=0;l<r.length;l++)t.common.push({lineHeight:parseInt(r[l].getAttribute("lineHeight"),10)});for(let l=0;l<o.length;l++)t.page.push({id:parseInt(o[l].getAttribute("id"),10)||0,file:o[l].getAttribute("file")});for(let l=0;l<a.length;l++){const e=a[l];t.char.push({id:parseInt(e.getAttribute("id"),10),page:parseInt(e.getAttribute("page"),10)||0,x:parseInt(e.getAttribute("x"),10),y:parseInt(e.getAttribute("y"),10),width:parseInt(e.getAttribute("width"),10),height:parseInt(e.getAttribute("height"),10),xoffset:parseInt(e.getAttribute("xoffset"),10),yoffset:parseInt(e.getAttribute("yoffset"),10),xadvance:parseInt(e.getAttribute("xadvance"),10)})}for(let l=0;l<s.length;l++)t.kerning.push({first:parseInt(s[l].getAttribute("first"),10),second:parseInt(s[l].getAttribute("second"),10),amount:parseInt(s[l].getAttribute("amount"),10)});for(let l=0;l<i.length;l++)t.distanceField.push({fieldType:i[l].getAttribute("fieldType"),distanceRange:parseInt(i[l].getAttribute("distanceRange"),10)});return t}}class oc{static test(e){return!("string"!=typeof e||!e.includes("<font>"))&&rc.test(Q.ADAPTER.parseXML(e))}static parse(e){return rc.parse(Q.ADAPTER.parseXML(e))}}const ac=[nc,rc,oc];function sc(e,t,n,r,o,a,s){const i=n.text,l=n.fontProperties;t.translate(r,o),t.scale(a,a);const c=s.strokeThickness/2,d=-s.strokeThickness/2;if(t.font=s.toFontString(),t.lineWidth=s.strokeThickness,t.textBaseline=s.textBaseline,t.lineJoin=s.lineJoin,t.miterLimit=s.miterLimit,t.fillStyle=function(e,t,n,r,o,a){const s=n.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];let i;const l=n.dropShadow?n.dropShadowDistance:0,c=n.padding||0,d=e.width/r-l-2*c,u=e.height/r-l-2*c,h=s.slice(),p=n.fillGradientStops.slice();if(!p.length){const e=h.length+1;for(let t=1;t<e;++t)p.push(t/e)}if(h.unshift(s[0]),p.unshift(0),h.push(s[s.length-1]),p.push(1),n.fillGradientType===Ea.LINEAR_VERTICAL){i=t.createLinearGradient(d/2,c,d/2,u+c);let e=0;const r=(a.fontProperties.fontSize+n.strokeThickness)/u;for(let t=0;t<o.length;t++){const n=a.lineHeight*t;for(let t=0;t<h.length;t++){let o=0;o="number"==typeof p[t]?p[t]:t/h.length;const a=n/u+o*r;let s=Math.max(e,a);s=Math.min(s,1),i.addColorStop(s,h[t]),e=s}}}else{i=t.createLinearGradient(c,u/2,d+c,u/2);const e=h.length+1;let n=1;for(let t=0;t<h.length;t++){let r;r="number"==typeof p[t]?p[t]:n/e,i.addColorStop(r,h[t]),n++}}return i}(e,t,s,a,[i],n),t.strokeStyle=s.stroke,s.dropShadow){const e=s.dropShadowColor,n=s.dropShadowBlur*a,r=s.dropShadowDistance*a;t.shadowColor=lt.shared.setValue(e).setAlpha(s.dropShadowAlpha).toRgbaString(),t.shadowBlur=n,t.shadowOffsetX=Math.cos(s.dropShadowAngle)*r,t.shadowOffsetY=Math.sin(s.dropShadowAngle)*r}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;s.stroke&&s.strokeThickness&&t.strokeText(i,c,d+n.lineHeight-l.descent),s.fill&&t.fillText(i,c,d+n.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function ic(e){return Array.from?Array.from(e):e.split("")}function lc(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}const cc=class e{constructor(e,t,n){const[r]=e.info,[o]=e.common,[a]=e.page,[s]=e.distanceField,i=Ht(a.file),l={};this._ownsTextures=n,this.font=r.face,this.size=r.size,this.lineHeight=o.lineHeight/i,this.chars={},this.pageTextures=l;for(let c=0;c<e.page.length;c++){const{id:n,file:r}=e.page[c];l[n]=t instanceof Array?t[c]:t[r],s?.fieldType&&"none"!==s.fieldType&&(l[n].baseTexture.alphaMode=V.NO_PREMULTIPLIED_ALPHA,l[n].baseTexture.mipmap=q.OFF)}for(let c=0;c<e.char.length;c++){const{id:t,page:n}=e.char[c];let{x:r,y:o,width:a,height:s,xoffset:d,yoffset:u,xadvance:h}=e.char[c];r/=i,o/=i,a/=i,s/=i,d/=i,u/=i,h/=i;const p=new Cn(r+l[n].frame.x/i,o+l[n].frame.y/i,a,s);this.chars[t]={xOffset:d,yOffset:u,xAdvance:h,kerning:{},texture:new kr(l[n].baseTexture,p),page:n}}for(let c=0;c<e.kerning.length;c++){let{first:t,second:n,amount:r}=e.kerning[c];t/=i,n/=i,r/=i,this.chars[n]&&(this.chars[n].kerning[t]=r)}this.distanceFieldRange=s?.distanceRange,this.distanceFieldType=s?.fieldType?.toLowerCase()??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(t,n,r){let o;if(t instanceof tc)o=t;else{const e=function(e){for(let t=0;t<ac.length;t++)if(ac[t].test(e))return ac[t];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");o=e.parse(t)}n instanceof kr&&(n=[n]);const a=new e(o,n,r);return e.available[a.font]=a,a}static uninstall(t){const n=e.available[t];if(!n)throw new Error(`No font found named '${t}'`);n.destroy(),delete e.available[t]}static from(t,n,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:o,padding:a,resolution:s,textureWidth:i,textureHeight:l,...c}=Object.assign({},e.defaultOptions,r),d=function(e){"string"==typeof e&&(e=[e]);const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];if(Array.isArray(r)){if(2!==r.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const e=r[0].charCodeAt(0),n=r[1].charCodeAt(0);if(n<e)throw new Error("[BitmapFont]: Invalid character range.");for(let r=e,o=n;r<=o;r++)t.push(String.fromCharCode(r))}else t.push(...ic(r))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}(o),u=n instanceof ja?n:new ja(n),h=i,p=new tc;p.info[0]={face:u.fontFamily,size:u.fontSize},p.common[0]={lineHeight:u.fontSize};let m,f,g,y=0,v=0,b=0;const x=[],w=[];for(let e=0;e<d.length;e++){m||(m=Q.ADAPTER.createCanvas(),m.width=i,m.height=l,f=m.getContext("2d"),g=new sn(m,{resolution:s,...c}),x.push(g),w.push(new kr(g)),p.page.push({id:w.length-1,file:""}));const t=d[e],n=Na.measureText(t,u,!1,m),r=n.width,o=Math.ceil(n.height),S=Math.ceil(("italic"===u.fontStyle?2:1)*r);if(v>=l-o*s){if(0===v)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--e,m=null,f=null,g=null,v=0,y=0,b=0;continue}if(b=Math.max(o+n.fontProperties.descent,b),S*s+y>=h){if(0===y)throw new Error(`[BitmapFont] textureWidth ${i}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--e,v+=b*s,v=Math.ceil(v),y=0,b=0;continue}sc(m,f,n,y,v,s,u);const T=lc(n.text);p.char.push({id:T,page:w.length-1,x:y/s,y:v/s,width:S,height:o,xoffset:0,yoffset:0,xadvance:r-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),y+=(S+2*a)*s,y=Math.ceil(y)}if(!r?.skipKerning)for(let e=0,T=d.length;e<T;e++){const t=d[e];for(let e=0;e<T;e++){const n=d[e],r=f.measureText(t).width,o=f.measureText(n).width,a=f.measureText(t+n).width-(r+o);a&&p.kerning.push({first:lc(t),second:lc(n),amount:a})}}const S=new e(p,w,!0);return void 0!==e.available[t]&&e.uninstall(t),e.available[t]=S,S}};cc.ALPHA=[["a","z"],["A","Z"]," "],cc.NUMERIC=[["0","9"]],cc.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],cc.ASCII=[[" ","~"]],cc.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:cc.ALPHANUMERIC},cc.available={};let dc=cc;const uc=[],hc=[],pc=[],mc=class e extends ma{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super();const{align:r,tint:o,maxWidth:a,letterSpacing:s,fontName:i,fontSize:l}=Object.assign({},e.styleDefaults,n);if(!dc.available[i])throw new Error(`Missing BitmapFont "${i}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new lt(o),this._font=void 0,this._fontName=i,this._fontSize=l,this.text=t,this._maxWidth=a,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new Ln((()=>{this.dirty=!0}),this,0,0),this._roundPixels=Q.ROUND_PIXELS,this.dirty=!0,this._resolution=Q.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const e=dc.available[this._fontName],t=this.fontSize,n=t/e.size,r=new Sn,o=[],a=[],s=[],i=ic(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/t,c="none"===e.distanceFieldType?uc:hc;let d=null,u=0,h=0,p=0,m=-1,f=0,g=0,y=0,v=0;for(let k=0;k<i.length;k++){const t=i[k],n=lc(t);if(/(?:\s)/.test(t)&&(m=k,f=u,v++),"\r"===t||"\n"===t){a.push(u),s.push(-1),h=Math.max(h,u),++p,++g,r.x=0,r.y+=e.lineHeight,d=null,v=0;continue}const c=e.chars[n];if(!c)continue;d&&c.kerning[d]&&(r.x+=c.kerning[d]);const b=pc.pop()||{texture:kr.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Sn};b.texture=c.texture,b.line=p,b.charCode=n,b.position.x=Math.round(r.x+c.xOffset+this._letterSpacing/2),b.position.y=Math.round(r.y+c.yOffset),b.prevSpaces=v,o.push(b),u=b.position.x+Math.max(c.xAdvance-c.xOffset,c.texture.orig.width),r.x+=c.xAdvance+this._letterSpacing,y=Math.max(y,c.yOffset+c.texture.height),d=n,-1!==m&&l>0&&r.x>l&&(++g,At(o,1+m-g,1+k-m),k=m,m=-1,a.push(f),s.push(o.length>0?o[o.length-1].prevSpaces:0),h=Math.max(h,f),p++,r.x=0,r.y+=e.lineHeight,d=null,v=0)}const b=i[i.length-1];"\r"!==b&&"\n"!==b&&(/(?:\s)/.test(b)&&(u=f),a.push(u),h=Math.max(h,u),s.push(-1));const x=[];for(let k=0;k<=p;k++){let e=0;"right"===this._align?e=h-a[k]:"center"===this._align?e=(h-a[k])/2:"justify"===this._align&&(e=s[k]<0?0:(h-a[k])/s[k]),x.push(e)}const w=o.length,S={},T=[],C=this._activePagesMeshData;c.push(...C);for(let k=0;k<w;k++){const t=o[k].texture,n=t.baseTexture.uid;if(!S[n]){let r=c.pop();if(!r){const t=new _l;let n,o;"none"===e.distanceFieldType?(n=new Nl(kr.EMPTY),o=B.NORMAL):(n=new Nl(kr.EMPTY,{program:rr.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),o=B.NORMAL_NPM);const a=new Pl(t,n);a.blendMode=o,r={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:a,vertices:null,uvs:null,indices:null}}r.index=0,r.indexCount=0,r.vertexCount=0,r.uvsCount=0,r.total=0;const{_textureCache:o}=this;o[n]=o[n]||new kr(t.baseTexture),r.mesh.texture=o[n],r.mesh.tint=this._tintColor.value,T.push(r),S[n]=r}S[n].total++}for(let k=0;k<C.length;k++)T.includes(C[k])||this.removeChild(C[k].mesh);for(let k=0;k<T.length;k++)T[k].mesh.parent!==this&&this.addChild(T[k].mesh);this._activePagesMeshData=T;for(const k in S){const e=S[k],t=e.total;if(!(e.indices?.length>6*t)||e.vertices.length<2*Pl.BATCHABLE_SIZE)e.vertices=new Float32Array(8*t),e.uvs=new Float32Array(8*t),e.indices=new Uint16Array(6*t);else{const t=e.total,n=e.vertices;for(let e=4*t*2;e<n.length;e++)n[e]=0}e.mesh.size=6*t}for(let k=0;k<w;k++){const e=o[k];let t=e.position.x+x[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(t=Math.round(t));const r=t*n,a=e.position.y*n,s=e.texture,i=S[s.baseTexture.uid],l=s.frame,c=s._uvs,d=i.index++;i.indices[6*d+0]=0+4*d,i.indices[6*d+1]=1+4*d,i.indices[6*d+2]=2+4*d,i.indices[6*d+3]=0+4*d,i.indices[6*d+4]=2+4*d,i.indices[6*d+5]=3+4*d,i.vertices[8*d+0]=r,i.vertices[8*d+1]=a,i.vertices[8*d+2]=r+l.width*n,i.vertices[8*d+3]=a,i.vertices[8*d+4]=r+l.width*n,i.vertices[8*d+5]=a+l.height*n,i.vertices[8*d+6]=r,i.vertices[8*d+7]=a+l.height*n,i.uvs[8*d+0]=c.x0,i.uvs[8*d+1]=c.y0,i.uvs[8*d+2]=c.x1,i.uvs[8*d+3]=c.y1,i.uvs[8*d+4]=c.x2,i.uvs[8*d+5]=c.y2,i.uvs[8*d+6]=c.x3,i.uvs[8*d+7]=c.y3}this._textWidth=h*n,this._textHeight=(r.y+e.lineHeight)*n;for(const k in S){const e=S[k];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const n=this._textWidth*this.anchor.x,r=this._textHeight*this.anchor.y;for(let o=0;o<e.total;o++)e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r,e.vertices[t++]-=n,e.vertices[t++]-=r}this._maxLineHeight=y*n;const t=e.mesh.geometry.getBuffer("aVertexPosition"),r=e.mesh.geometry.getBuffer("aTextureCoord"),o=e.mesh.geometry.getIndex();t.data=e.vertices,r.data=e.uvs,o.data=e.indices,t.update(),r.update(),o.update()}for(let k=0;k<o.length;k++)pc.push(o[k]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:n,size:r}=dc.available[this._fontName];if("none"!==n){const{a:n,b:o,c:a,d:s}=this.worldTransform,i=Math.sqrt(n*n+o*o),l=Math.sqrt(a*a+s*s),c=(Math.abs(i)+Math.abs(l))/2,d=this.fontSize/r,u=e._view.resolution;for(const e of this._activePagesMeshData)e.mesh.shader.uniforms.uFWidth=c*t*d*u}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=dc.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!dc.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??dc.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,n="none"===dc.available[this._fontName].distanceFieldType?uc:hc;n.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],n.filter((e=>t[e.mesh.texture.baseTexture.uid])).forEach((e=>{e.mesh.texture=kr.EMPTY}));for(const r in t)t[r].destroy(),delete t[r];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};mc.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const fc=[".xml",".fnt"],gc={extension:{type:qt.LoadParser,priority:ys.Normal},name:"loadBitmapFont",test:e=>fc.includes(Ae.extname(e).toLowerCase()),testParse:async e=>nc.test(e)||oc.test(e),async parse(e,t,n){const r=nc.test(e)?nc.parse(e):oc.parse(e),{src:o}=t,{page:a}=r,s=[];for(let c=0;c<a.length;++c){const e=a[c].file;let t=Ae.join(Ae.dirname(o),e);t=oi(t,o),s.push(t)}const i=await n.load(s),l=s.map((e=>i[e]));return dc.install(r,l,!0)},load:async(e,t)=>(await Q.ADAPTER.fetch(e)).text(),unload(e){e.destroy()}};Yt.add(gc);const yc=class e extends ja{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new e(Object.keys(e.defaultOptions).reduce(((e,n)=>({...e,[n]:t[n]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete e.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{availableFonts:r}=e;if(r[t]){const e=r[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return Q.ADAPTER.fetch(t).then((e=>e.blob())).then((async e=>new Promise(((t,n)=>{const r=URL.createObjectURL(e),o=new FileReader;o.onload=()=>t([r,o.result]),o.onerror=n,o.readAsDataURL(e)})))).then((async e=>{let[o,a]=e;const s=Object.assign({family:Ae.basename(t,Ae.extname(t)),weight:"normal",style:"normal",display:"auto",src:o,dataSrc:a,refs:1,originalUrl:t,fontFace:null},n);r[t]=s,this._fonts.push(s),this.styleID++;const i=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style,display:s.display});s.fontFace=i,await i.load(),document.fonts.add(i),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.filter((e=>!this._overrides.includes(e)));r.length>0&&(this._overrides.push(...r),this.styleID++)}removeOverride(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.filter((e=>this._overrides.includes(e)));r.length>0&&(this._overrides=this._overrides.filter((e=>!r.includes(e))),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((e,t)=>`${e}\n            @font-face {\n                font-family: "${t.family}";\n                src: url('${t.dataSrc}');\n                font-weight: ${t.weight};\n                font-style: ${t.style};\n                font-display: ${t.display};\n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=ht(e)),"number"==typeof e?dt(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,n=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(255*t|0).toString(16).padStart(2,"0"));const o=`${n}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${o} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${o} ${e}`}reset(){Object.assign(this,e.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise((e=>setTimeout(e,100))):Promise.resolve()}get isSafari(){const{userAgent:e}=Q.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};yc.availableFonts={},yc.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let vc=yc;const bc=class e extends ya{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(kr.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,o=kr.from(r,{scaleMode:Q.SCALE_MODE,resourceOptions:{autoLoad:!1}});o.orig=new Cn,o.trim=new Cn,this.texture=o;const a="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",i=document.createElementNS(a,"svg"),l=document.createElementNS(a,"foreignObject"),c=document.createElementNS(s,"div"),d=document.createElementNS(s,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",i.appendChild(l),this.maxWidth=e.defaultMaxWidth,this.maxHeight=e.defaultMaxHeight,this._domElement=c,this._styleElement=d,this._svgRoot=i,this._foreignObject=l,this._foreignObject.appendChild(d),this._foreignObject.appendChild(c),this._image=r,this._loadImage=new Image,this._autoResolution=e.defaultAutoResolution,this._resolution=e.defaultResolution??Q.RESOLUTION,this.text=t,this.style=n}measureText(e){const{text:t,style:n,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:n.toCSS(r)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const o=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:a,height:s}=o;(a>this.maxWidth||s>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const i=Math.min(this.maxWidth,Math.ceil(a)),l=Math.min(this.maxHeight,Math.ceil(s));return this._svgRoot.setAttribute("width",i.toString()),this._svgRoot.setAttribute("height",l.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(r)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:i+2*n.padding,height:l+2*n.padding}}async updateText(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{style:t,_image:n,_loadImage:r}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:o,height:a}=this.measureText();n.width=r.width=Math.ceil(Math.max(1,o)),n.height=r.height=Math.ceil(Math.max(1,a)),this._updateID++;const s=this._updateID;await new Promise((e=>{r.onload=async()=>{s<this._updateID||(await t.onBeforeDraw(),n.src=r.src,r.onload=null,r.src="",this.updateTexture()),e()};const o=(new XMLSerializer).serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(o)}`}))}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:n,resolution:r}=this,{padding:o}=e,{baseTexture:a}=t;t.trim.width=t._frame.width=n.width/r,t.trim.height=t._frame.height=n.height/r,t.trim.x=-o,t.trim.y=-o,t.orig.width=t._frame.width-2*o,t.orig.height=t._frame.height-2*o,this._onTextureUpdate(),a.setRealSize(n.width,n.height,r),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},e.defaultDestroyOptions,t),super.destroy(t);const n=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=n,this._svgRoot?.remove(),this._svgRoot=n,this._domElement?.remove(),this._domElement=n,this._foreignObject?.remove(),this._foreignObject=n,this._styleElement?.remove(),this._styleElement=n,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=n,this._image.src="",this._image=n}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=It(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=It(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&((e=e||{})instanceof vc?(this.ownsStyle=!1,this._style=e):e instanceof ja?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=vc.from(e)):(this.ownsStyle=!0,this._style=new vc(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(""===e||null===e||void 0===e?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};bc.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},bc.defaultMaxWidth=2024,bc.defaultMaxHeight=2024,bc.defaultAutoResolution=!0;const xc=new Cn;class wc{constructor(e){this.renderer=e}async image(e,t,n,r){const o=new Image;return o.src=await this.base64(e,t,n,r),o}async base64(e,t,n,r){const o=this.canvas(e,r);if(void 0!==o.toBlob)return new Promise(((e,r)=>{o.toBlob((t=>{if(!t)return void r(new Error("ICanvas.toBlob failed!"));const n=new FileReader;n.onload=()=>e(n.result),n.onerror=r,n.readAsDataURL(t)}),t,n)}));if(void 0!==o.toDataURL)return o.toDataURL(t,n);if(void 0!==o.convertToBlob){const e=await o.convertToBlob({type:t,quality:n});return new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=n,r.readAsDataURL(e)}))}throw new Error("CanvasExtract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const n=this.renderer;if(!n)throw new Error("The CanvasExtract has already been destroyed");let r,o,a;e&&(e instanceof Ar?a=e:(a=n.generateTexture(e,{region:t,resolution:n.resolution}),t&&(xc.width=t.width,xc.height=t.height,t=xc))),a?(r=a.baseTexture._canvasRenderTarget.context,o=a.baseTexture._canvasRenderTarget.resolution,t=t??a.frame):(r=n.canvasContext.rootContext,o=n._view.resolution,t||((t=xc).width=n.width/o,t.height=n.height/o));const s=Math.round(t.x*o),i=Math.round(t.y*o),l=Math.max(Math.round(t.width*o),1),c=Math.max(Math.round(t.height*o),1),d=new Bt(l,c,1),u=r.getImageData(s,i,l,c);return d.context.putImageData(u,0,0),d.canvas}pixels(e,t){const n=this.renderer;if(!n)throw new Error("The CanvasExtract has already been destroyed");let r,o,a;e&&(e instanceof Ar?a=e:(a=n.generateTexture(e,{region:t,resolution:n.resolution}),t&&(xc.width=t.width,xc.height=t.height,t=xc))),a?(r=a.baseTexture._canvasRenderTarget.context,o=a.baseTexture._canvasRenderTarget.resolution,t=t??a.frame):(r=n.canvasContext.rootContext,o=n.resolution,t||((t=xc).width=n.width/o,t.height=n.height/o));const s=Math.round(t.x*o),i=Math.round(t.y*o),l=Math.max(Math.round(t.width*o),1),c=Math.max(Math.round(t.height*o),1);return r.getImageData(s,i,l,c).data}destroy(){this.renderer=null}}let Sc;wc.extension={name:"extract",type:qt.CanvasRendererSystem},Yt.add(wc);const Tc=new Pn;Cl.prototype.generateCanvasTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=this.getLocalBounds(new Cn);n.width=Math.max(n.width,1/t),n.height=Math.max(n.height,1/t);const r=Ar.create({width:n.width,height:n.height,scaleMode:e,resolution:t});Sc||(Sc=new sa),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(Tc),Tc.invert(),Tc.tx-=n.x,Tc.ty-=n.y,Sc.render(this,{renderTexture:r,clear:!0,transform:Tc});const o=kr.from(r.baseTexture._canvasRenderTarget.canvas,{scaleMode:e});return o.baseTexture.setResolution(t),o},Cl.prototype.cachedGraphicsData=[],Cl.prototype._renderCanvas=function(e){!0!==this.isMask&&(this.finishPoly(),e.plugins.graphics.render(this))};class Cc{static offsetPolygon(e,t){const n=[],r=e.length;t=Cc.isPolygonClockwise(e)?t:-1*t;for(let o=0;o<r;o+=2){let a=o-2;a<0&&(a+=r);const s=(o+2)%r;let i=e[o]-e[a],l=e[o+1]-e[a+1],c=Math.sqrt(i*i+l*l);i/=c,l/=c,i*=t,l*=t;const d=-l,u=i,h=[e[a]+d,e[a+1]+u],p=[e[o]+d,e[o+1]+u];let m=e[s]-e[o],f=e[s+1]-e[o+1];c=Math.sqrt(m*m+f*f),m/=c,f/=c,m*=t,f*=t;const g=-f,y=m,v=[e[o]+g,e[o+1]+y],b=[e[s]+g,e[s+1]+y],x=Cc.findIntersection(h[0],h[1],p[0],p[1],v[0],v[1],b[0],b[1]);x&&n.push(...x)}return n}static findIntersection(e,t,n,r,o,a,s,i){const l=(i-a)*(n-e)-(s-o)*(r-t),c=(s-o)*(t-a)-(i-a)*(e-o);if(0===l)return 0===c&&0===(n-e)*(t-a)-(r-t)*(e-o)?[(e+n)/2,(t+r)/2]:null;const d=c/l;return[e+d*(n-e),t+d*(r-t)]}static isPolygonClockwise(e){let t=0;for(let n=0,r=e.length-2;n<e.length;r=n,n+=2)t+=(e[n]-e[r])*(e[n+1]+e[r+1]);return t>0}}class kc{constructor(e){this._svgMatrix=null,this._tempMatrix=new Pn,this.renderer=e}_calcCanvasStyle(e,t){let n;return e.texture&&e.texture.baseTexture!==kr.WHITE.baseTexture?e.texture.valid?(n=ia.getTintedPattern(e.texture,t),this.setPatternTransform(n,e.matrix||Pn.IDENTITY)):n="#808080":n=`#${`00000${(0|t).toString(16)}`.slice(-6)}`,n}render(e){const t=this.renderer,n=t.canvasContext.activeContext,r=e.worldAlpha,o=e.transform.worldTransform;t.canvasContext.setContextTransform(o),t.canvasContext.setBlendMode(e.blendMode);const a=e.geometry.graphicsData;let s,i;const l=lt.shared.setValue(e.tint).toArray();for(let c=0;c<a.length;c++){const e=a[c],d=e.shape,u=e.fillStyle,h=e.lineStyle,p=0|e.fillStyle.color,m=0|e.lineStyle.color;if(e.matrix&&t.canvasContext.setContextTransform(o.copyTo(this._tempMatrix).append(e.matrix)),u.visible&&(s=this._calcCanvasStyle(u,lt.shared.setValue(p).multiply(l).toNumber())),h.visible&&(i=this._calcCanvasStyle(h,lt.shared.setValue(m).multiply(l).toNumber())),n.lineWidth=h.width,n.lineCap=h.cap,n.lineJoin=h.join,n.miterLimit=h.miterLimit,e.type===wn.POLY){n.beginPath();const t=d;let o=t.points;const a=e.holes;let l,c,p,m,f;n.moveTo(o[0],o[1]);for(let e=2;e<o.length;e+=2)n.lineTo(o[e],o[e+1]);if(t.closeStroke&&n.closePath(),a.length>0){f=[],l=0,p=o[0],m=o[1];for(let e=2;e+2<o.length;e+=2)l+=(o[e]-p)*(o[e+3]-m)-(o[e+2]-p)*(o[e+1]-m);for(let e=0;e<a.length;e++)if(o=a[e].shape.points,o){c=0,p=o[0],m=o[1];for(let e=2;e+2<o.length;e+=2)c+=(o[e]-p)*(o[e+3]-m)-(o[e+2]-p)*(o[e+1]-m);if(c*l<0){n.moveTo(o[0],o[1]);for(let e=2;e<o.length;e+=2)n.lineTo(o[e],o[e+1])}else{n.moveTo(o[o.length-2],o[o.length-1]);for(let e=o.length-4;e>=0;e-=2)n.lineTo(o[e],o[e+1])}a[e].shape.closeStroke&&n.closePath(),f[e]=c*l<0}}u.visible&&(n.globalAlpha=u.alpha*r,n.fillStyle=s,n.fill()),h.visible&&this.paintPolygonStroke(t,h,i,a,f,r,n)}else if(e.type===wn.RECT){const e=d;if(u.visible&&(n.globalAlpha=u.alpha*r,n.fillStyle=s,n.fillRect(e.x,e.y,e.width,e.height)),h.visible){const t=h.width*(.5-(1-h.alignment)),o=e.width+2*t,a=e.height+2*t;n.globalAlpha=h.alpha*r,n.strokeStyle=i,n.strokeRect(e.x-t,e.y-t,o,a)}}else if(e.type===wn.CIRC){const e=d;if(n.beginPath(),n.arc(e.x,e.y,e.radius,0,2*Math.PI),n.closePath(),u.visible&&(n.globalAlpha=u.alpha*r,n.fillStyle=s,n.fill()),h.visible){if(.5!==h.alignment){const t=h.width*(.5-(1-h.alignment));n.beginPath(),n.arc(e.x,e.y,e.radius+t,0,2*Math.PI),n.closePath()}n.globalAlpha=h.alpha*r,n.strokeStyle=i,n.stroke()}}else if(e.type===wn.ELIP){const e=d,t=1===h.alignment;if(t||this.paintEllipse(e,u,h,s,r,n),h.visible){if(.5!==h.alignment){const t=.5522848,r=h.width*(.5-(1-h.alignment)),o=2*(e.width+r),a=2*(e.height+r),s=e.x-o/2,i=e.y-a/2,l=o/2*t,c=a/2*t,d=s+o,u=i+a,p=s+o/2,m=i+a/2;n.beginPath(),n.moveTo(s,m),n.bezierCurveTo(s,m-c,p-l,i,p,i),n.bezierCurveTo(p+l,i,d,m-c,d,m),n.bezierCurveTo(d,m+c,p+l,u,p,u),n.bezierCurveTo(p-l,u,s,m+c,s,m),n.closePath()}n.globalAlpha=h.alpha*r,n.strokeStyle=i,n.stroke()}t&&this.paintEllipse(e,u,h,s,r,n)}else if(e.type===wn.RREC){const e=d,t=1===h.alignment;if(t||this.paintRoundedRectangle(e,u,h,s,r,n),h.visible){if(.5!==h.alignment){const t=e.width,r=e.height,o=h.width*(.5-(1-h.alignment)),a=e.x-o,s=e.y-o,i=e.width+2*o,l=e.height+2*o,c=o*(h.alignment>=1?Math.min(i/t,l/r):Math.min(t/i,r/l));let d=e.radius+c;const u=Math.min(i,l)/2;d=d>u?u:d,n.beginPath(),n.moveTo(a,s+d),n.lineTo(a,s+l-d),n.quadraticCurveTo(a,s+l,a+d,s+l),n.lineTo(a+i-d,s+l),n.quadraticCurveTo(a+i,s+l,a+i,s+l-d),n.lineTo(a+i,s+d),n.quadraticCurveTo(a+i,s,a+i-d,s),n.lineTo(a+d,s),n.quadraticCurveTo(a,s,a,s+d),n.closePath()}n.globalAlpha=h.alpha*r,n.strokeStyle=i,n.stroke()}t&&this.paintRoundedRectangle(e,u,h,s,r,n)}}}paintPolygonStroke(e,t,n,r,o,a,s){if(.5!==t.alignment){const n=t.width*(.5-(1-t.alignment));let a,i=Cc.offsetPolygon(e.points,n);s.beginPath(),s.moveTo(i[0],i[1]);for(let e=2;e<i.length;e+=2)s.lineTo(i[e],i[e+1]);e.closeStroke&&s.closePath();for(let e=0;e<r.length;e++){if(a=r[e].shape.points,i=Cc.offsetPolygon(a,n),o[e]){s.moveTo(i[0],i[1]);for(let e=2;e<i.length;e+=2)s.lineTo(i[e],i[e+1])}else{s.moveTo(i[i.length-2],i[i.length-1]);for(let e=i.length-4;e>=0;e-=2)s.lineTo(i[e],i[e+1])}r[e].shape.closeStroke&&s.closePath()}}s.globalAlpha=t.alpha*a,s.strokeStyle=n,s.stroke()}paintEllipse(e,t,n,r,o,a){const s=2*e.width,i=2*e.height,l=e.x-s/2,c=e.y-i/2,d=.5522848,u=s/2*d,h=i/2*d,p=l+s,m=c+i,f=l+s/2,g=c+i/2;0===n.alignment&&a.save(),a.beginPath(),a.moveTo(l,g),a.bezierCurveTo(l,g-h,f-u,c,f,c),a.bezierCurveTo(f+u,c,p,g-h,p,g),a.bezierCurveTo(p,g+h,f+u,m,f,m),a.bezierCurveTo(f-u,m,l,g+h,l,g),a.closePath(),0===n.alignment&&a.clip(),t.visible&&(a.globalAlpha=t.alpha*o,a.fillStyle=r,a.fill()),0===n.alignment&&a.restore()}paintRoundedRectangle(e,t,n,r,o,a){const s=e.x,i=e.y,l=e.width,c=e.height;let d=e.radius;const u=Math.min(l,c)/2;d=d>u?u:d,0===n.alignment&&a.save(),a.beginPath(),a.moveTo(s,i+d),a.lineTo(s,i+c-d),a.quadraticCurveTo(s,i+c,s+d,i+c),a.lineTo(s+l-d,i+c),a.quadraticCurveTo(s+l,i+c,s+l,i+c-d),a.lineTo(s+l,i+d),a.quadraticCurveTo(s+l,i,s+l-d,i),a.lineTo(s+d,i),a.quadraticCurveTo(s,i,s,i+d),a.closePath(),0===n.alignment&&a.clip(),t.visible&&(a.globalAlpha=t.alpha*o,a.fillStyle=r,a.fill()),0===n.alignment&&a.restore()}setPatternTransform(e,t){if(!1!==this._svgMatrix){if(!this._svgMatrix){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t?.createSVGMatrix&&(this._svgMatrix=t.createSVGMatrix()),!this._svgMatrix||!e.setTransform)return void(this._svgMatrix=!1)}this._svgMatrix.a=t.a,this._svgMatrix.b=t.b,this._svgMatrix.c=t.c,this._svgMatrix.d=t.d,this._svgMatrix.e=t.tx,this._svgMatrix.f=t.ty,e.setTransform(this._svgMatrix.inverse())}}destroy(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null}}kc.extension={name:"graphics",type:qt.CanvasRendererPlugin},Yt.add(kc),Object.defineProperties(Q,{MESH_CANVAS_PADDING:{get:()=>Pl.defaultCanvasPadding,set(e){Se("7.1.0","settings.MESH_CANVAS_PADDING is deprecated, use Mesh.defaultCanvasPadding"),Pl.defaultCanvasPadding=e}}}),Nl.prototype._renderCanvas=function(e,t){e.plugins.mesh.render(t)},Dl.prototype._cachedTint=16777215,Dl.prototype._tintedCanvas=null,Dl.prototype._canvasUvs=null,Dl.prototype._renderCanvas=function(e){const t=e.canvasContext.activeContext,n=this.worldTransform,r=16777215!==this.tintValue,o=this.texture;if(!o.valid)return;r&&this._cachedTint!==this.tintValue&&(this._cachedTint=this.tintValue,this._tintedCanvas=ia.getTintedCanvas(this,this.tintValue));const a=r?this._tintedCanvas:o.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);const s=this.vertices,i=this._canvasUvs,l=r?0:o.frame.x,c=r?0:o.frame.y,d=l+o.frame.width,u=c+o.frame.height;i[0]=l,i[1]=l+this._leftWidth,i[2]=d-this._rightWidth,i[3]=d,i[4]=c,i[5]=c+this._topHeight,i[6]=u-this._bottomHeight,i[7]=u;for(let h=0;h<8;h++)i[h]*=o.baseTexture.resolution;t.globalAlpha=this.worldAlpha,e.canvasContext.setBlendMode(this.blendMode),e.canvasContext.setContextTransform(n,this.roundPixels);for(let h=0;h<3;h++)for(let e=0;e<3;e++){const n=2*e+8*h,r=Math.max(1,i[e+1]-i[e]),o=Math.max(1,i[h+5]-i[h+4]),l=Math.max(1,s[n+10]-s[n]),c=Math.max(1,s[n+11]-s[n+1]);t.drawImage(a,i[e],i[h+4],r,o,s[n],s[n+1],l,c)}};let Ac=!1;Pl.prototype._cachedTint=16777215,Pl.prototype._tintedCanvas=null,Pl.prototype._cachedTexture=null,Pl.prototype._renderCanvas=function(e){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(e,this):Ac||(Ac=!0,globalThis.console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))},Pl.prototype._canvasPadding=null,Pl.defaultCanvasPadding=0,Object.defineProperty(Pl.prototype,"canvasPadding",{get(){return this._canvasPadding??Pl.defaultCanvasPadding},set(e){this._canvasPadding=e}}),class extends Pl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kr.EMPTY,t=arguments.length>4?arguments[4]:void 0;const n=new _l(arguments.length>1?arguments[1]:void 0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0);n.getBuffer("aVertexPosition").static=!1;super(n,new Nl(e),null,t),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(e){this.geometry.getBuffer("aVertexPosition").data=e}_render(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(e)}}.prototype._renderCanvas=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(e,this)},class extends Pl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=new Ml(e.height,t,n),o=new Nl(e);n>0&&(e.baseTexture.wrapMode=H.REPEAT),super(r,o),this.autoUpdate=!0}_render(e){const t=this.geometry;(this.autoUpdate||t._width!==this.shader.texture.height)&&(t._width=this.shader.texture.height,t.update()),super._render(e)}}.prototype._renderCanvas=function(e){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(e,this)};class Ic{constructor(e){this.renderer=e}render(e){const t=this.renderer,n=e.worldTransform;t.canvasContext.activeContext.globalAlpha=e.worldAlpha,t.canvasContext.setBlendMode(e.blendMode),t.canvasContext.setContextTransform(n,e.roundPixels),e.drawMode!==L.TRIANGLES?this._renderTriangleMesh(e):this._renderTriangles(e)}_renderTriangleMesh(e){const t=e.geometry.buffers[0].data.length;for(let n=0;n<t-2;n++){const t=2*n;this._renderDrawTriangle(e,t,t+2,t+4)}}_renderTriangles(e){const t=e.geometry.getIndex().data,n=t.length;for(let r=0;r<n;r+=3){const n=2*t[r],o=2*t[r+1],a=2*t[r+2];this._renderDrawTriangle(e,n,o,a)}}_renderDrawTriangle(e,t,n,r){const o=this.renderer.canvasContext.activeContext,a=e.geometry.buffers[0].data,{uvs:s,texture:i}=e;if(!i.valid)return;const l=16777215!==e.tintValue,c=i.baseTexture,d=c.width,u=c.height;e._cachedTexture&&e._cachedTexture.baseTexture!==c&&(e._cachedTint=16777215,e._cachedTexture?.destroy(),e._cachedTexture=null,e._tintedCanvas=null),l&&e._cachedTint!==e.tintValue&&(e._cachedTint=e.tintValue,e._cachedTexture=e._cachedTexture||new kr(c),e._tintedCanvas=ia.getTintedCanvas({texture:e._cachedTexture},e.tintValue));const h=l?e._tintedCanvas:c.getDrawableSource(),p=s[t]*c.width,m=s[n]*c.width,f=s[r]*c.width,g=s[t+1]*c.height,y=s[n+1]*c.height,v=s[r+1]*c.height;let b=a[t],x=a[n],w=a[r],S=a[t+1],T=a[n+1],C=a[r+1];const k=e.canvasPadding/this.renderer.canvasContext.activeResolution;if(k>0){const{a:t,b:n,c:r,d:o}=e.worldTransform,a=(b+x+w)/3,s=(S+T+C)/3;let i=b-a,l=S-s,c=t*i+r*l,d=n*i+o*l,u=Math.sqrt(c*c+d*d),h=1+k/u;b=a+i*h,S=s+l*h,i=x-a,l=T-s,c=t*i+r*l,d=n*i+o*l,u=Math.sqrt(c*c+d*d),h=1+k/u,x=a+i*h,T=s+l*h,i=w-a,l=C-s,c=t*i+r*l,d=n*i+o*l,u=Math.sqrt(c*c+d*d),h=1+k/u,w=a+i*h,C=s+l*h}o.save(),o.beginPath(),o.moveTo(b,S),o.lineTo(x,T),o.lineTo(w,C),o.closePath(),o.clip();const A=p*y+g*f+m*v-y*f-g*m-p*v,I=b*y+g*w+x*v-y*w-g*x-b*v,E=p*x+b*f+m*w-x*f-b*m-p*w,P=p*y*w+g*x*f+b*m*v-b*y*f-g*m*w-p*x*v,_=S*y+g*C+T*v-y*C-g*T-S*v,N=p*T+S*f+m*C-T*f-S*m-p*C,R=p*y*C+g*T*f+S*m*v-S*y*f-g*m*C-p*T*v;o.transform(I/A,_/A,E/A,N/A,P/A,R/A),o.drawImage(h,0,0,d*c.resolution,u*c.resolution,0,0,d,u),o.restore(),this.renderer.canvasContext.invalidateBlendMode()}renderMeshFlat(e){const t=this.renderer.canvasContext.activeContext,n=e.geometry.getBuffer("aVertexPosition").data,r=n.length/2;t.beginPath();for(let o=1;o<r-2;++o){const e=2*o,r=n[e],a=n[e+1],s=n[e+2],i=n[e+3],l=n[e+4],c=n[e+5];t.moveTo(r,a),t.lineTo(s,i),t.lineTo(l,c)}t.fillStyle="#FF0000",t.fill(),t.closePath()}destroy(){this.renderer=null}}Ic.extension={name:"mesh",type:qt.CanvasRendererPlugin},Yt.add(Ic);function Ec(e,t){const n=e;if(t instanceof sn){const e=t.source,r=0===e.width?n.canvas.width:Math.min(n.canvas.width,e.width),o=0===e.height?n.canvas.height:Math.min(n.canvas.height,e.height);return n.ctx.drawImage(e,0,0,r,o,0,0,n.canvas.width,n.canvas.height),!0}return!1}class Pc extends ql{constructor(e){super(e),this.uploadHookHelper=this,this.canvas=Q.ADAPTER.createCanvas(16,16),this.ctx=this.canvas.getContext("2d"),this.registerUploadHook(Ec)}destroy(){super.destroy(),this.ctx=null,this.canvas=null}}Pc.extension={name:"prepare",type:qt.CanvasRendererSystem},Yt.add(Pc),ya.prototype._tintedCanvas=null,ya.prototype._renderCanvas=function(e){e.plugins.sprite.render(this)};const _c=new Pn;class Nc{constructor(e){this.renderer=e}render(e){const t=e._texture,n=this.renderer,r=n.canvasContext.activeContext,o=n.canvasContext.activeResolution;if(!t.valid)return;const a=t._frame.width,s=t._frame.height;let i=t._frame.width,l=t._frame.height;t.trim&&(Bn.isVertical(t.rotate)?(i=t.trim.height,l=t.trim.width):(i=t.trim.width,l=t.trim.height));let c=e.transform.worldTransform,d=0,u=0;const h=t.baseTexture.getDrawableSource();if(t.orig.width<=0||t.orig.height<=0||!t.valid||!h)return;n.canvasContext.setBlendMode(e.blendMode,!0),r.globalAlpha=e.worldAlpha;const p=t.baseTexture.scaleMode===U.LINEAR,m=n.canvasContext.smoothProperty;m&&r[m]!==p&&(r[m]=p),t.trim?(d=t.trim.width/2+t.trim.x-e.anchor.x*t.orig.width,u=t.trim.height/2+t.trim.y-e.anchor.y*t.orig.height):(d=(.5-e.anchor.x)*t.orig.width,u=(.5-e.anchor.y)*t.orig.height),t.rotate&&(c.copyTo(_c),c=_c,Bn.matrixAppendRotationInv(c,t.rotate,d,u),d=0,u=0),d-=i/2,u-=l/2,n.canvasContext.setContextTransform(c,e.roundPixels,1),e.roundPixels&&(d|=0,u|=0);const f=t.baseTexture.resolution,g=n.canvasContext._outerBlend;g&&(r.save(),r.beginPath(),r.rect(d*o,u*o,i*o,l*o),r.clip()),16777215!==e.tint?((e._cachedTint!==e.tintValue||e._tintedCanvas.tintId!==e._texture._updateID)&&(e._cachedTint=e.tintValue,e._tintedCanvas=ia.getTintedCanvas(e,e.tintValue)),r.drawImage(e._tintedCanvas,0,0,Math.floor(a*f),Math.floor(s*f),Math.floor(d*o),Math.floor(u*o),Math.floor(i*o),Math.floor(l*o))):r.drawImage(h,t._frame.x*f,t._frame.y*f,Math.floor(a*f),Math.floor(s*f),Math.floor(d*o),Math.floor(u*o),Math.floor(i*o),Math.floor(l*o)),g&&r.restore(),n.canvasContext.setBlendMode(B.NORMAL)}destroy(){this.renderer=null}}Nc.extension={name:"sprite",type:qt.CanvasRendererPlugin},Yt.add(Nc);const Rc=(e,t,n,r,o,a)=>{var s,i,l;if(!e)return null;const c=`${e.x}-${e.y}`,d=(Date.now(),null===t||void 0===t||null===(s=t.ready)||void 0===s?void 0:s.includes(c)),u=null===t||void 0===t||null===(i=t.inProgress)||void 0===i?void 0:i.includes(c),h=null===n||void 0===n||null===(l=n.ready)||void 0===l?void 0:l.includes(c);if(d)return{type:"ready",priority:1};if(u)return{type:"inprogress",priority:2};if(h&&"Trading Post"===e.type)return{type:"ready",priority:1};if(null!==r&&void 0!==r&&r.mailbox&&"Mailbox"===e.type)return{type:"ready",priority:1};if("Courthouse"===e.type){if("Campaigning"===o)return{type:"campaign",priority:3};if("Voting"===o)return{type:"voting",priority:1}}return null},Mc={ready:"checkmark.svg",completed:"checkmark.svg",voting:"checkmark.svg",inprogress:"clock.svg",campaign:"clock.svg",available:"hand.svg"},jc={ready:{emoji:"\u2705",color:"green"},completed:{emoji:"\u2705",color:"#32CD32"},voting:{emoji:"\u2705",color:"green"},inprogress:{emoji:"\ud83d\udd51",color:"orange"},campaign:{emoji:"\ud83d\udd50",color:"#FFD700"},available:{emoji:"\ud83d\udc4b",color:"#FFD700"},exclamation:{emoji:"\u2757",color:"#FF6B35"},attack:{emoji:"\u2694\ufe0f",color:"#DC143C"}},Dc=e=>{if(!e)return null;if("graze"===e.action&&"processing"===e.state){const t=Date.now();if(e.grazeEnd&&t>=e.grazeEnd)return{type:"ready",priority:1}}return null};var Oc=n(7605),Bc=n(2467),Lc=n(6894),Fc=n(2667),$c=n(1431),Gc=n(1593),zc=n(5823),Uc=n(3295),Hc=n(4255),qc=n(6352);function Vc(e,t,n){const r=e.position,o=function(e){if(!e||void 0===e.x||void 0===e.y)return console.error("Invalid location object",e),null;return{x:e.x,y:e.y}}(t.position);if(console.log("Fetched positions: playerPos =",r,"; targetPos =",o),!o)return console.error("Invalid target position",{targetPos:o}),Lc.A.addFloatingText(505,0,0,n),!1;const a=(0,Oc.gd)(r,o),s=e.attackrange||1;return console.log("playerRange = ",s),console.log("playerPos = ",r),a>s?(Lc.A.addFloatingText(501,o.x,o.y,n),console.log("target out of range: targetPos.x = ",o.x," targetPos.y= ",o.y),!1):!(0,Gc.iZ)(r,o)||(Lc.A.addFloatingText(40,o.x,o.y,n),console.log("Wall blocking attack from player to target"),!1)}function Wc(e,t,n){const r=Math.floor(20*Math.random())+1,o=r+(e.attackbonus||0);return console.log(`Attack roll: ${r}, Attack bonus: ${e.attackbonus}`),console.log(`Total hit roll: ${o}, Target armor class: ${t.armorclass}`),o>=t.armorclass?(Lc.A.addFloatingText(502,t.position.x,t.position.y-1,n),!0):(Lc.A.addFloatingText(503,t.position.x,t.position.y,n),!1)}function Yc(e){const t=Math.floor(6*Math.random())+1,n=(e.damage||0)+t;return console.log(`Damage roll: ${t}, player damage: ${e.damage}, Damage dealt: ${n}`),n}var Kc=n(5701),Xc=n(4450);const Zc=e=>{let{onClose:n,children:o,descriptionKey:a,panelName:s,titleKey:i,title:l}=e;const c=(0,r.k)(),{activePanel:u,openPanel:h,closePanel:p}=(0,Xc.d)();return(0,t.useEffect)((()=>{u===s&&h(s)}),[u,s,h]),u!==s?null:(0,d.jsxs)("div",{className:"panel-container","data-panel-name":s,children:[(0,d.jsxs)("div",{className:"panel-header",children:[(0,d.jsx)("h2",{className:"panel-title",children:l||c[i]||"Panel"}),(0,d.jsx)("button",{className:"panel-close-btn",onClick:()=>{p(),n()},children:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",width:"24",height:"24",children:[(0,d.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,d.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,d.jsx)("div",{className:"panel-content",children:o}),a&&(0,d.jsx)("div",{className:"panel-description",children:(0,d.jsx)("p",{children:c[a]})}),(0,d.jsx)("div",{className:"panel-buffer-space"})]})},Jc=e=>{let{onAction:n,children:r,disabled:o=!1,transactionKey:a,className:s="",style:i={},...l}=e;const[c,u]=(0,t.useState)(!1),[h]=(0,t.useState)((()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`));return(0,d.jsx)("button",{...l,onClick:async e=>{if(!c&&!o){e.preventDefault(),e.stopPropagation(),u(!0);try{await n(h,a)}catch(t){console.error("Transaction failed:",t)}finally{u(!1)}}},disabled:o||c,className:`${s} ${c?"processing":""}`,style:{...i,opacity:o||c?.6:1,cursor:o||c?"not-allowed":"pointer"},children:c?"\u23f3":r})},Qc=e=>{let{onClose:n,inventory:o,setInventory:i,backpack:l,setBackpack:c,currentPlayer:u,setCurrentPlayer:h,setResources:p,stationType:m,currentStationPosition:f,gridId:g,npcId:y,TILE_SIZE:v,updateStatus:b,masterResources:x,globalTuning:w,isDeveloper:S}=e;const[T,C]=(0,t.useState)(null),[k,A]=(0,t.useState)(null),[I,E]=(0,t.useState)(Date.now()),P=(0,r.k)();console.log("--------Inside Animal Panel:",{stationType:m,currentStationPosition:f}),(0,t.useEffect)((()=>{const e=x.find((e=>e.type===m));C(e)}),[m,x]),(0,t.useEffect)((()=>{const e=()=>{if(y&&g){const e=Fc.Ay.getNPCsInGrid(g),t=Object.values(e).find((e=>e.id===y));A(t)}};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[y,g]),(0,t.useEffect)((()=>{const e=setInterval((()=>{E(Date.now())}),1e3);return()=>clearInterval(e)}),[]);(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];i(e);const t=(await a.A.get(`${s.A}/api/inventory/${u.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(i(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[u]);return(0,d.jsx)(Zc,{onClose:n,titleKey:"1129",panelName:"AnimalPanel",children:(0,d.jsxs)("div",{className:"animal-panel-container",children:[(0,d.jsxs)("div",{className:"animal-panel-content",children:[(0,d.jsxs)("h2",{children:[(null===T||void 0===T?void 0:T.symbol)||"\ud83d\uded6"," ",(0,Bc.Z)(m,P)]}),k&&(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:(0,Bc.Z)(k.type,P)})," ",(e=>{if(!e)return"Unknown status";switch(e.state){case"processing":return"is ready.";case"hungry":return`is hungry and looking for ${"Pig"===e.type?"dirt":"grass"}.`;case"grazing":if(e.grazeEnd){const t=Math.max(0,e.grazeEnd-I);return`is grazing. ${Math.floor(t%36e5/6e4)}m ${Math.floor(t%6e4/1e3)}s`}return"is grazing.";case"roam":return"is roaming.";case"stall":return"is looking for an Animal Stall.";default:return`is in ${e.state} state.`}})(k)]})]}),("homestead"===u.location.gtype||S)&&(0,d.jsxs)("div",{className:"animal-panel-footer",children:[(0,d.jsx)("hr",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-success",onAction:async(e,t)=>{const r=[];for(let n=1;n<=3;n++){const e=T[`ingredient${n}`],t=T[`ingredient${n}qty`];e&&t&&r.push({type:e,quantity:t})}if(r.length)try{for(const{type:t,quantity:n}of r){if(!await(0,Kc.qf)({playerId:u.playerId,currentPlayer:u,resource:t,quantity:n,inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:b,masterResources:x,globalTuning:w}))return}h((e=>({...e,inventory:o,backpack:l})));try{y?(console.log(`\ud83d\udc04 Removing animal NPC ${y} (original position: ${f.x}, ${f.y})`),await Fc.Ay.removeNPC(g,y),console.log("\ud83e\uddf9 Animal NPC removed from NPCsInGrid.")):console.error("No NPC ID provided - cannot remove animal NPC")}catch(a){console.error("Error removing NPC:",a)}const e=r.filter((e=>"Money"===e.type)).reduce(((e,t)=>e+t.quantity),0);console.log(`Sold ${m} successfully for ${e} Money.`),b(`Sold ${(0,Bc.Z)(m,P)} for ${e} ${(0,Bc.Z)("Money",P)}.`),n()}catch(a){console.error("Error selling the stall:",a)}else console.error("No ingredients found for refund.")},transactionKey:`sell-refund-${m}-${f.x}-${f.y}-${g}`,children:P[425]})})]})]})})},ed=t.memo(Qc);function td(e,t,n,r,o,a){const s=[],i={harvest:o[469]||"Harvest complete",craft:o[480]||"Crafting complete",animal:o[469]||"Animal Collect complete",logging:o[479]||"Logging complete"}[e]||o[469]||"Complete";if(t&&Object.keys(t).length>0){const e=Object.entries(t).map((e=>{let[t,r]=e;const s=null===n||void 0===n?void 0:n[t],i=a(t,o);if(s&&s.hasSkills){const e=s.skills.join(", ");return`${r} ${i}, ${o[481]} ${e} ${o[482]} (${s.multiplier}x)`}return`${r} ${i}`})).join(", ");s.push(`${i} ${e}`)}if(r&&Object.keys(r).length>0){const e=Object.entries(r).map((e=>{let[t,n]=e;return`${n} ${a(t,o)}`})).join(", ");s.push(`${e} ${o[483]||"replanted"}`)}return s.join(" | ")}function nd(e,t,n,r,o,a){return td(e,{[t]:n},r?{[t]:r}:{},null,o,a)}async function rd(e,t,n,r,o,i,l,c,d,u,h,p,m){let f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:{},g=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null,y=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null,v=arguments.length>16&&void 0!==arguments[16]?arguments[16]:null;console.log(`\ud83d\udd12 [PROTECTED FARM ANIMAL] Starting protected collection for NPC ${e.id}`);const b=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x=`farm-animal-collect-${e.id}-${p}`;try{var w;console.log(`\ud83d\udc2e Attempting to collect animal - ID: ${e.id}, State: ${e.state}, GrazeEnd: ${e.grazeEnd}, Current Time: ${Date.now()}`);const i=null===(w=Fc.Ay.getNPCsInGrid(p))||void 0===w?void 0:w[e.id];if(i&&"processing"!==i.state)return console.warn(`\u26a0\ufe0f NPC ${e.id} state changed to ${i.state} before collection attempt`),m(`\u274c Animal not ready - state: ${i.state}`),{type:"error",message:`Animal not in processing state (${i.state})`};if(i&&i.grazeEnd){const t=Date.now()-i.grazeEnd;t>36e5&&(console.warn(`\u26a0\ufe0f NPC ${e.id} has expired grazeEnd - ${Math.floor(t/6e4)} minutes overdue`),console.warn(`\u26a0\ufe0f GrazeEnd was: ${new Date(i.grazeEnd).toISOString()}, Now: ${(new Date).toISOString()}`),m("Checking animal state..."))}const S=await a.A.post(`${s.A}/api/farm-animal/collect`,{playerId:l.playerId,gridId:p,npcId:e.id,npcPosition:{x:n,y:t},transactionId:b,transactionKey:x});if(S.data.success){const{collectedQuantity:a,collectedItem:s,skillsApplied:i,updatedNPC:b}=S.data,x=await(0,Kc.qf)({playerId:l.playerId,currentPlayer:l,resource:s,quantity:a,inventory:y||l.inventory,backpack:v||l.backpack,setInventory:r,setBackpack:o,setCurrentPlayer:c,updateStatus:m,masterResources:u,globalTuning:g});if(!0!==x&&(!x||!1===x.success))return console.error("\u274c Failed to add animal product to inventory - warehouse may be full"),console.error("\u274c gainIngredients result:",x),Lc.A.addFloatingText(f[41]||"You're full",n,t,d),{type:"error",message:"Warehouse full - item lost"};if(b){await Fc.Ay.updateNPC(p,e.id,b);const r=Fc.Ay.getNPCsInGrid(p),o=Object.values(r||{}).filter((r=>{var o,a;return r.id!==e.id&&Math.floor(null===(o=r.position)||void 0===o?void 0:o.x)===n&&Math.floor(null===(a=r.position)||void 0===a?void 0:a.y)===t&&"graze"===r.action}));if(o.length>0){console.log(`\ud83d\udc2e Found ${o.length} other animals at same stall position after collection`),console.log("\ud83d\udc2e Other animals at position:",o.map((e=>({id:e.id,state:e.state,grazeEnd:e.grazeEnd,targetStall:e.targetStall}))));for(const e of o)"processing"===e.state?console.log(`\ud83d\udc2e Animal ${e.id} remains in processing state at same stall - ready for collection`):"stall"===e.state?console.log(`\ud83d\udc2e Animal ${e.id} is still moving to stall`):console.log(`\ud83d\udc2e\u26a0\ufe0f Animal ${e.id} in unexpected state '${e.state}' at stall position`)}}if(!0===x){Lc.A.addFloatingText(`+${a} ${(0,Bc.Z)(s,f)}`,n,t,d);const e=(0,Kc.TM)(s,l.skills||[],h);m(nd("animal",s,a,e.hasSkills?e:null,f,Bc.Z))}return await(0,Uc.D)(l,"Collect",s,a,c),console.log(`Farm animal collection completed: ${a} ${s}`),{type:"success",message:`Collected ${a} ${s}.`,collectedItem:s,collectedQuantity:a,skillsApplied:i}}}catch(I){var S,T;if(console.error("Error in protected farm animal collection:",I),429===(null===(S=I.response)||void 0===S?void 0:S.status))return m(471),{type:"error",message:"Collection already in progress"};if(400===(null===(T=I.response)||void 0===T?void 0:T.status)){var C,k,A;const a=(null===(C=I.response)||void 0===C||null===(k=C.data)||void 0===k?void 0:k.error)||"Animal not ready for collection",s=null===(A=I.response)||void 0===A?void 0:A.data;if(console.error("\u274c 400 Error details:",s),"Warehouse full"===a||a.includes("Warehouse full"))return console.error(`\u274c Cannot collect: Warehouse is full (${null===s||void 0===s?void 0:s.currentUsage}/${null===s||void 0===s?void 0:s.capacity})`),Lc.A.addFloatingText(f[41]||"You're full",n,t,d),{type:"error",message:"Warehouse is full"};if(console.error(`\u274c Animal state mismatch - Client state: ${e.state}, Server error: ${a}`),console.error(`\u274c Animal details - ID: ${e.id}, GrazeEnd: ${e.grazeEnd}, Current Time: ${Date.now()}`),a.includes("state:")){const s=a.match(/\(state:\s*(\w+)\)/);if(s){const a=s[1];if(console.error(`\u274c Server reports NPC ${e.id} in state '${a}' but client has '${e.state}'`),"processing"===e.state&&"stall"===a)return console.log(`\ud83d\udc2e Animal ${e.id} was already collected (now looking for stall)`),m(f[815]||"This animal was already collected"),await Fc.Ay.updateNPC(p,e.id,{state:a,grazeEnd:null,targetStall:null}),{type:"error",message:"Animal already collected"};console.log(`\ud83d\udd04 Attempting to resync NPC ${e.id} state with server...`),await Fc.Ay.updateNPC(p,e.id,{state:a});const y=Fc.Ay.getNPCsInGrid(p),v=Object.values(y||{}).find((r=>{var o,a;return r.id!==e.id&&Math.floor(null===(o=r.position)||void 0===o?void 0:o.x)===n&&Math.floor(null===(a=r.position)||void 0===a?void 0:a.y)===t&&"graze"===r.action&&"processing"===r.state}));if(v)return console.log(`\ud83d\udc2e Found another processing animal at same position after sync. Trying to collect from NPC ${v.id}`),m("Trying another animal at this stall..."),await rd(v,t,n,r,o,i,l,c,d,u,h,p,m,f,g);m(`\u274c Animal not ready - server state: ${a}`)}}else m(`\u274c ${a}`);return{type:"error",message:a}}return m("\u274c Failed to collect from animal"),{type:"error",message:"Failed to collect from animal"}}}async function od(e,t,n,r,o,i,l,c,d,u,h,p,m,f,g,y,v){let b=arguments.length>17&&void 0!==arguments[17]?arguments[17]:{},x=arguments.length>18&&void 0!==arguments[18]?arguments[18]:null,w=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null;if(e)switch(console.log(`[\ud83d\udc2e\u2196\ufe0f handleNPCClick] NPC ${e.id} clicked with state=${e.state}`),e.action){case"quest":case"heal":case"worker":break;case"graze":if(console.log(`Handling grazing logic for NPC ${e.id}.`),"processing"!==e.state){console.log(`\ud83d\udc2e NPC ${e.id} clicked but not in processing state: ${e.state}`);const a=Fc.Ay.getNPCsInGrid(p),s=Object.values(a||{}).filter((e=>{var r,o;return Math.floor(null===(r=e.position)||void 0===r?void 0:r.x)===n&&Math.floor(null===(o=e.position)||void 0===o?void 0:o.y)===t&&"graze"===e.action}));s.length>1&&console.log(`\ud83d\udc2e Found ${s.length} animals at position (${n}, ${t}):`,s.map((e=>({id:e.id,state:e.state,grazeEnd:e.grazeEnd}))));const S=s.find((t=>t.id!==e.id&&"processing"===t.state));return S?(console.log(`\ud83d\udc2e Found another animal in processing state at same position. Switching to collect from NPC ${S.id} (state: ${S.state}) instead of ${e.id} (state: ${e.state})`),await od(S,t,n,r,o,i,l,c,d,u,h,p,m,f,g,y,v,b,x,w)):(v({type:e.type,position:{x:n,y:t},gridId:p,npcId:e.id}),y("AnimalPanel"),{type:"info",message:"NPC is not ready for collection."})}return await rd(e,t,n,r,o,i,l,c,d,u,h,p,g,b,w);case"attack":case"spawn":!async function(e,t,n,r,o,i){var l,c;let d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;console.log(`Handling attack on NPC ${e.id}.`);const u=t.location.g,h=t._id.toString();console.log("playerId = ",h);const p=null===(l=$c.default.getPlayersInGrid(u))||void 0===l?void 0:l[h];if(console.log("player = ",p),!p)return void console.error(`Player not found in playersInGrid for playerId: ${h}.`);const m=(null===(c=Fc.Ay.getNPCsInGrid(u))||void 0===c?void 0:c[e.id])||e;if(p.iscamping)return void Lc.A.addFloatingText(31,m.position.x,m.position.y,r);if(!Vc(p,m,r))return;if(!Wc(p,m,r))return;const f=Yc(p);if(Lc.A.addFloatingText(`- ${f} \u2764\ufe0f\u200d\ud83e\ude79 HP`,m.position.x,m.position.y,r),(0,Hc.MV)(m.position.x,m.position.y,r),m.hp-=f,await Fc.Ay.updateNPC(u,m.id,{hp:m.hp,position:m.position,state:m.state}),m.hp<=0){console.log(`NPC ${m.id} killed.`),Lc.A.addFloatingText(504,m.position.x,m.position.y-.5,r);try{await Fc.Ay.removeNPC(u,m.id),console.log(`NPC ${m.id} successfully removed from grid.`);const e=i.find((e=>e.type===m.type&&"npc"===e.category));if(e&&e.xp&&t.playerId)try{const o=await a.A.post(`${s.A}/api/addXP`,{playerId:t.playerId,xpAmount:e.xp});o.data.success&&(n((e=>({...e,xp:o.data.newXP}))),setTimeout((()=>{Lc.A.addFloatingText(`+${e.xp} XP`,m.position.x,m.position.y-1.2,r)}),500),console.log(`\ud83c\udfaf Awarded ${e.xp} XP for killing ${m.type}`))}catch(y){console.error("Error awarding XP:",y)}if(m.output){console.log(`Spawning resource: ${m.output} at NPC's death position.`);const e=i.find((e=>e.type===m.output)),t={...e,type:m.output,x:Math.floor(m.position.x),y:Math.floor(m.position.y),category:e.category||"doober",symbol:e.symbol||"\u2753",qtycollected:e.qtycollected||1},n=[...zc.default.getResources(),t];zc.default.setResources(n),o((e=>[...e,t])),await(0,Gc.mQ)(u,{type:m.output,x:Math.floor(m.position.x),y:Math.floor(m.position.y)},o,!0)}else console.warn(`NPC ${m.id} has no output resource defined.`)}catch(y){console.error("Error removing NPC or spawning resource:",y)}if("Duke Angelo"===m.type){var g;if(d&&null!==t&&void 0!==t&&t.playerId)try{console.log("\ud83c\udfc6 Awarding Kill the Duke trophy for defeating Duke Angelo"),await(0,qc.p)(t.playerId,"Kill the Duke",1,t,d,n),console.log("\u2705 Successfully awarded Kill the Duke trophy")}catch(y){console.error("\u274c Error awarding Kill the Duke trophy:",y)}if(null===(g=t.activeQuests)||void 0===g?void 0:g.find((e=>"Blood for Juliet"===e.questId)))await(0,Uc.D)(t,"Kill",m.type,1,n);else try{const e=await a.A.post(`${s.A}/api/add-player-quest`,{playerId:t.playerId,questId:"Blood for Juliet",startTime:Date.now(),progress:{goal1:1},completed:!0});e.data.success&&(n(e.data.player),Lc.A.addFloatingText("Quest: Blood for Juliet completed!",m.position.x,m.position.y-2,r),console.log("Auto-accepted and completed Blood for Juliet quest"))}catch(y){console.error("Error auto-accepting Blood for Juliet quest:",y)}}else await(0,Uc.D)(t,"Kill",m.type,1,n)}}(e,l,c,d,i,u,x);break;default:console.log(`Unhandled NPC action: ${e.action}`)}else console.warn("handleNPCClick was called with an undefined NPC.")}let ad=0;function sd(e,t){const n=(0,Bc.Z)(e.type,t);let r=`<p>${n}</p>`;switch(e.action){case"graze":switch(e.state){case"processing":r=`<p>${n}</p><p>is ready.</p>`;break;case"hungry":r=`<p>${n}</p><p>is hungry and</p><p>looking for ${"Pig"===e.type?"dirt":"grass"}.</p>`;break;case"grazing":{let t="";if(e.grazeEnd){const n=Math.max(0,e.grazeEnd-Date.now());t=`<p>${Math.floor(n%36e5/6e4)}m ${Math.floor(n%6e4/1e3)}s</p>`}r=`<p>${n}</p><p>is grazing.</p>${t}`;break}case"idle":r="<p>Zzzz...</p>";break;case"roam":r=`<p>${n}</p><p>is roaming.</p>`;break;case"stall":r=`<p>${n}</p><p>is looking for an Animal Stall.</p>`;break;default:r=`<p>${n}</p>`}break;case"quest":r="Kent"===e.type?`<p>${n}</p><p>"${(null===t||void 0===t?void 0:t[47])||"Kent says hi!"}"</p>`:`<p>${n}</p><p>"${(null===t||void 0===t?void 0:t[48])||"I have quests!"}"</p>`;break;case"trade":case"heal":case"worker":r=`<p>${n}</p>`;break;case"attack":case"spawn":r=`<p>${n}</p><p>HP: ${e.hp}/${e.maxhp}</p>`,e.state&&(r+=`<p>State: ${e.state}</p>`);break;default:r=`<p>${e.type}</p>`}return r}function id(e,t){var n,r,o,a,s;let{currentPlayer:i,playersInGrid:l,gridId:c,TILE_SIZE:d,masterResources:u,masterSkills:h,masterTrophies:p,globalTuning:m,strings:f,getNPCOverlay:g,onNPCClick:y,setHoverTooltip:v,setInventory:b,setBackpack:x,setResources:w,setCurrentPlayer:S,setModalContent:T,setIsModalOpen:C,updateStatus:k,openPanel:A,setActiveStation:I,isDeveloper:E=!1}=t;if(g){const t=g(e.id);if(t&&!t.clickable)return!1}const P=(null===i||void 0===i?void 0:i.gridId)===(null===i||void 0===i||null===(n=i.location)||void 0===n?void 0:n.g);if("homestead"===(null===i||void 0===i||null===(r=i.location)||void 0===r?void 0:r.gtype)&&!P&&!E)return!1;v&&v(null);const _=Date.now();if("attack"===e.action||"spawn"===e.action){var N;const e=$c.default.getPlayersInGrid(c),t=null===e||void 0===e?void 0:e[String(i._id)],n=null!==(N=null===t||void 0===t?void 0:t.speed)&&void 0!==N?N:5;if(console.log("\u2694\ufe0f Attack cooldown check:"),console.log("  Speed being used:",n),console.log("  pcState?.speed:",null===t||void 0===t?void 0:t.speed),_<ad)return!1;const r=.5+.75*(n-1),o=1e3*r;ad=_+o,console.log(`\u2694\ufe0f Setting new cooldown: ${o}ms (${r} seconds for speed ${n})`)}if("quest"===e.action||"heal"===e.action||"worker"===e.action||"trade"===e.action){var R,M,j,D;const t=(null===i||void 0===i?void 0:i.gridId)===(null===i||void 0===i||null===(R=i.location)||void 0===R?void 0:R.g),n=$c.default.getPlayerPosition(null===i||void 0===i||null===(M=i.location)||void 0===M?void 0:M.g,String(i._id)),r={x:Math.round((null===(j=e.position)||void 0===j?void 0:j.x)||0),y:Math.round((null===(D=e.position)||void 0===D?void 0:D.y)||0)};if(!t&&n&&"number"===typeof n.x&&"number"===typeof n.y){if(Math.sqrt(Math.pow(n.x-r.x,2)+Math.pow(n.y-r.y,2))>(0,Oc.ZW)(i,u))return Lc.A.addFloatingText(24,r.x,r.y,d),!1;if((0,Gc.iZ)(n,r))return Lc.A.addFloatingText(40,r.x,r.y,d),console.log("Wall blocking interaction from player to NPC"),!1}return y&&y(e),!0}return od(e,Math.round((null===(o=e.position)||void 0===o?void 0:o.y)||0),Math.round((null===(a=e.position)||void 0===a?void 0:a.x)||0),b,x,w,i,S,d,u,h,null===i||void 0===i||null===(s=i.location)||void 0===s?void 0:s.g,T,C,k,A,I,f,p,m),!0}function ld(){return{cooldownEnd:ad,isOnCooldown:Date.now()<ad}}var cd=n(6388);function dd(e){if(!e)return"cursor-pointer";switch(e.action){case"heal":case"worker":case"trade":case"quest":return"cursor-help";case"attack":case"spawn":return ld().isOnCooldown?"cursor-wait":"cursor-crosshair";default:return"cursor-pointer"}}function ud(e,t){if(!e)return;e.style.cursor={"cursor-pointer":"pointer","cursor-help":"help","cursor-wait":"wait","cursor-crosshair":"crosshair"}[t]||"default"}function hd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".homestead";const r=document.querySelector(n);if(!r)return{x:e,y:t};const o=r.getBoundingClientRect(),a=10;let s=e,i=t;const l=e+60;e-60<o.left+a?s=o.left+a+60:l>o.right-a&&(s=o.right-a-60);return t-60-10<o.top+a&&(i=t+20),i+60+a>o.bottom&&(i=Math.max(o.top+a+60,Math.min(t,o.bottom-a-60))),{x:s,y:i}}const pd=new class{constructor(){this.activeConversations=new Map,this.relationshipOutcomes=new Map,this.listeners=new Set}addSpeech(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];console.log("\ud83d\udde8\ufe0f ConversationManager.addSpeech:",{speakerId:e,emoji:t,topic:n,matchState:r}),console.log("\ud83d\udde8\ufe0f Current active conversations:",Array.from(this.activeConversations.keys())),this.activeConversations.set(e,{emoji:t,topic:n,timestamp:Date.now(),matchState:r}),this.notifyListeners()}removeSpeech(e){console.log("\ud83d\udde8\ufe0f ConversationManager.removeSpeech:",e),this.activeConversations.delete(e),this.notifyListeners()}getSpeech(e){return this.activeConversations.get(e)}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){this.listeners.forEach((e=>e()))}clear(){this.activeConversations.clear(),this.relationshipOutcomes.clear(),this.notifyListeners()}showOutcome(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=t?"\ud83d\udc4d":"\ud83d\udc4e",o=n||r;console.log("\ud83c\udfad showOutcome called:",{speakerId:e,isPositive:t,emoji:n,defaultEmoji:r,finalEmoji:o}),this.relationshipOutcomes.set(e,{type:t?"positive":"negative",emoji:o,timestamp:Date.now()}),this.notifyListeners(),setTimeout((()=>{this.relationshipOutcomes.delete(e),this.notifyListeners()}),2500)}getOutcome(e){return this.relationshipOutcomes.get(e)}getAllSpeeches(){return this.activeConversations}getAllOutcomes(){return this.relationshipOutcomes}},md=e=>{let{resources:n,npcs:r,pcs:o,craftingStatus:a,tradingStatus:s,badgeState:i,electionPhase:l,currentPlayer:c,hoverTooltip:u,setHoverTooltip:h,TILE_SIZE:p,strings:m,timers:f,generateResourceTooltip:g,generateNPCTooltip:y,generatePCTooltip:v,handleTileClick:b,onNPCClick:x,onPCClick:w,setInventory:S,setBackpack:T,setResources:C,setCurrentPlayer:k,masterSkills:A,masterResources:I,setModalContent:E,setIsModalOpen:P,updateStatus:_,openPanel:N,setActiveStation:R,masterTrophies:M,globalTuning:j,gridId:D,playersInGrid:O,onTileHover:B,cursorModeActive:L,isDeveloper:F=!1}=e;const $=(0,t.useRef)(null),G=(0,t.useRef)(null),[z,U]=(0,t.useState)(0),H=(0,t.useRef)(null),q=(0,t.useRef)(null),V=(0,t.useRef)(null),W=(0,t.useRef)(null);(0,t.useEffect)((()=>pd.subscribe((()=>{console.log("\ud83d\udde8\ufe0f RenderDynamicElementsCanvas: Conversation changed, triggering update"),U((e=>e+1))}))),[]);(0,t.useEffect)((()=>{const e=JSON.stringify({resources:null===n||void 0===n?void 0:n.map((e=>({x:e.x,y:e.y,type:e.type}))),npcs:null===r||void 0===r?void 0:r.filter((e=>"graze"===e.action)).map((e=>{var t,n;return{id:e.id,state:e.state,grazeEnd:e.grazeEnd,x:Math.floor((null===(t=e.position)||void 0===t?void 0:t.x)||0),y:Math.floor((null===(n=e.position)||void 0===n?void 0:n.y)||0)}})),TILE_SIZE:p,craftingReady:null===a||void 0===a?void 0:a.ready,craftingInProgress:null===a||void 0===a?void 0:a.inProgress,tradingReady:null===s||void 0===s?void 0:s.ready,mailboxBadge:null===i||void 0===i?void 0:i.mailbox,electionPhase:l,playerId:null===c||void 0===c?void 0:c.id});e!==G.current&&((async()=>{const e=$.current;if(!e||!n)return;const t=e.getContext("2d"),o=window.devicePixelRatio||1,c=64*p,d=64*p,u=c*o,h=d*o;e.width=u,e.height=h,e.style.width=c+"px",e.style.height=d+"px",t.scale(o,o),t.clearRect(0,0,c,d);const m=()=>p<=16?Math.max(6,.35*p):p<=30?Math.max(10,.35*p):Math.max(14,.35*p);for(const r of n){if("shadow"===r.type||"doober"===r.category||"source"===r.category)continue;const e=Rc(r,a,s,i,l);if(!e)continue;const n=e.type;if(!n||!Mc[n])continue;const o=r.x*p,c=r.y*p,d=m(),u=o+2,h=c+p-d-2,f=await cd.A.getOverlayTexture(Mc[n],d);f&&t.drawImage(f,u,h,d,d)}if(r)for(const n of r){var f,g;const e=Dc(n);if(!e)continue;const r=e.type;if(!r||!Mc[r])continue;const o=Math.floor((null===(f=n.position)||void 0===f?void 0:f.x)||0)*p,a=Math.floor((null===(g=n.position)||void 0===g?void 0:g.y)||0)*p,s=m(),i=o+2,l=a+p-s-2,c=await cd.A.getOverlayTexture(Mc[r],s);c&&t.drawImage(c,i,l,s,s)}})(),G.current=e)}),[n,r,p,a,s,i,l,c]);const Y=(0,t.useCallback)((()=>{q.current&&(clearInterval(q.current),q.current=null)}),[]),K=(0,t.useCallback)(((e,t)=>{"attack"!==e.action&&"spawn"!==e.action||(q.current&&(clearInterval(q.current),q.current=null),q.current=setInterval((()=>{if(!H.current||H.current.id!==e.id)return void(q.current&&(clearInterval(q.current),q.current=null));const n=dd(e);ld();ud(t,n)}),100))}),[]),X=(0,t.useCallback)((()=>{V.current&&(clearInterval(V.current),V.current=null,W.current=null)}),[]),Z=(0,t.useCallback)(((e,t,n)=>{X(),W.current={entity:e,entityType:t,position:n};("resource"===t&&("Dungeon Entrance"===e.type||"farmplot"===e.category&&e.growEnd||"crafting"===e.category&&e.craftEnd||"pet"===e.category&&e.craftEnd)||"npc"===t&&"graze"===e.action&&e.grazeEnd)&&(V.current=setInterval((()=>{if(!W.current)return void X();let r="";"resource"===t?r=g(e,m,f):"npc"===t&&(r=y(e,m)),r&&h({x:n.x,y:n.y,content:r})}),100))}),[m,f,X,h]);(0,t.useEffect)((()=>()=>{Y(),X()}),[Y,X]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("canvas",{ref:$,style:{position:"absolute",top:0,left:0,width:64*p+"px",height:64*p+"px",zIndex:20,pointerEvents:"none"}}),(0,d.jsx)("div",{onMouseMove:e=>{const t=$.current,a=e.currentTarget;if(!t)return;const s=t.getBoundingClientRect(),i=e.clientX-s.left,l=e.clientY-s.top,d=Math.floor(i/p),u=Math.floor(l/p);B&&L&&B(u>=0&&u<64&&d>=0&&d<64?{row:u,col:d}:null),window._tooltipDebugLogged||(console.log("RenderDynamicElementsCanvas - Available entities:",{resources:(null===n||void 0===n?void 0:n.length)||0,npcs:(null===r||void 0===r?void 0:r.length)||0,pcs:(null===o||void 0===o?void 0:o.length)||0,TILE_SIZE:p}),window._tooltipDebugLogged=!0);const b=null===r||void 0===r?void 0:r.find((e=>e&&e.position&&Math.floor(e.position.x)===d&&Math.floor(e.position.y)===u));if(b){const t=hd(e.clientX,e.clientY);h({x:t.x,y:t.y,content:y(b,m)}),Z(b,"npc",t),H.current={id:b.id};return ud(a,dd(b)),void K(b,a)}const x=null===n||void 0===n?void 0:n.find((e=>{if("shadow"===e.type)return!1;const t=e.size||1;return d>=e.x&&d<e.x+t&&u<=e.y&&u>e.y-t})),w=x&&"doober"!==x.category&&"deco"!==x.category&&"source"!==x.category?x:null;if(w){const t=hd(e.clientX,e.clientY);h({x:t.x,y:t.y,content:g(w,m,f)}),Z(w,"resource",t);return void ud(a,"cursor-pointer")}if(x){h(null),X();return void ud(a,(x.category,"cursor-pointer"))}const S=null===o||void 0===o?void 0:o.find((e=>e&&e.position&&Math.floor(e.position.x)===d&&Math.floor(e.position.y)===u&&String(e.playerId)!==String(null===c||void 0===c?void 0:c._id)));if(S){const t=hd(e.clientX,e.clientY);return h({x:t.x,y:t.y,content:v(S)}),void ud(a,null)}h(null),ud(a,null),H.current=null,Y(),X()},onMouseLeave:e=>{h(null),B&&B(null);const t=e.currentTarget;t&&ud(t,null),H.current=null,Y(),X()},onClick:e=>{const t=$.current;if(!t)return;const n=t.getBoundingClientRect(),a=e.clientX-n.left,s=e.clientY-n.top,i=Math.floor(a/p),l=Math.floor(s/p),d=null===r||void 0===r?void 0:r.find((e=>e&&e.position&&Math.floor(e.position.x)===i&&Math.floor(e.position.y)===l));if(d)return void id(d,{currentPlayer:c,playersInGrid:O,gridId:D,TILE_SIZE:p,masterResources:I,masterSkills:A,masterTrophies:M,globalTuning:j,strings:m,onNPCClick:x,setHoverTooltip:h,setInventory:S,setBackpack:T,setResources:C,setCurrentPlayer:k,setModalContent:E,setIsModalOpen:P,updateStatus:_,openPanel:N,setActiveStation:R,isDeveloper:F});const u=null===o||void 0===o?void 0:o.find((e=>e&&e.position&&Math.floor(e.position.x)===i&&Math.floor(e.position.y)===l));u&&w?w(u):b&&b(l,i)},style:{position:"absolute",top:0,left:0,width:64*p+"px",height:64*p+"px",zIndex:21,pointerEvents:"auto",background:"transparent",cursor:"inherit"}}),(()=>{const e=[];return null===r||void 0===r||r.forEach((t=>{const n=pd.getSpeech(t.type),r=pd.getOutcome(t.type)||pd.getOutcome(t.id),o=t.position;o&&(n&&!r&&e.push((0,d.jsx)("div",{className:"speaking-animation",style:{position:"absolute",left:o.x*p,top:o.y*p,width:p,height:p,pointerEvents:"none",zIndex:1100},children:(0,d.jsx)("div",{className:"conversation-speech-bubble npc"+("match"===n.matchState?" match":"rival"===n.matchState?" rival":""),style:{position:"absolute",left:"50%",bottom:"100%",transform:"translateX(-50%)",marginBottom:"10px",fontSize:.6*p+"px",width:1.5*p+"px",height:1.5*p+"px",padding:.3*p+"px",borderWidth:.06*p+"px"},children:(0,d.jsx)("div",{className:"speech-emoji",style:{fontSize:.9*p+"px"},children:n.topic||n.emoji})})},`speech-wrapper-npc-${t.id}`)),r&&e.push((0,d.jsx)("div",{style:{position:"absolute",left:o.x*p,top:o.y*p,width:p,height:p,pointerEvents:"none",zIndex:1100},children:(0,d.jsx)("div",{style:{position:"absolute",left:"50%",bottom:"100%",transform:"translateX(-50%)",marginBottom:"10px",fontSize:1.2*p+"px",textAlign:"center"},children:r.emoji})},`outcome-npc-${t.id}`)))})),null===o||void 0===o||o.forEach((t=>{const n=pd.getSpeech(t.playerId),r=pd.getOutcome(t.playerId),o=t.position;o&&(n&&!r&&e.push((0,d.jsx)("div",{className:"speaking-animation",style:{position:"absolute",left:o.x*p,top:o.y*p,width:p,height:p,pointerEvents:"none",zIndex:1100},children:(0,d.jsx)("div",{className:"conversation-speech-bubble pc"+("match"===n.matchState?" match":"rival"===n.matchState?" rival":""),style:{position:"absolute",left:"50%",bottom:"100%",transform:"translateX(-50%)",marginBottom:"10px",fontSize:.6*p+"px",width:1.5*p+"px",height:1.5*p+"px",padding:.3*p+"px",borderWidth:.06*p+"px"},children:(0,d.jsx)("div",{className:"speech-emoji",style:{fontSize:.9*p+"px"},children:n.topic||n.emoji})})},`speech-wrapper-pc-${t.playerId}`)),r&&e.push((0,d.jsx)("div",{style:{position:"absolute",left:o.x*p,top:o.y*p,width:p,height:p,pointerEvents:"none",zIndex:1100},children:(0,d.jsx)("div",{style:{position:"absolute",left:"50%",bottom:"100%",transform:"translateX(-50%)",marginBottom:"10px",fontSize:1.2*p+"px",textAlign:"center"},children:r.emoji})},`outcome-pc-${t.playerId}`)))})),e})()]})};const fd=new class{constructor(){this.cache=null,this.cacheTime=null,this.cacheExpiry=3e5,this.pendingRequest=null}async getQuests(){return this.pendingRequest?this.pendingRequest:this.cache&&this.cacheTime&&Date.now()-this.cacheTime<this.cacheExpiry?Promise.resolve(this.cache):(console.log("\ud83d\udd04 Fetching fresh quests from API"),this.pendingRequest=a.A.get(`${s.A}/api/quests`).then((e=>(this.cache=e.data,this.cacheTime=Date.now(),this.pendingRequest=null,this.cache))).catch((e=>{throw this.pendingRequest=null,e})),this.pendingRequest)}invalidate(){console.log("\ud83d\uddd1\ufe0f Invalidating quest cache"),this.cache=null,this.cacheTime=null}async getQuestsForNPC(e){return(await this.getQuests()).filter((t=>t.giver===e))}};function gd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||"doober"===e.category||"source"===e.category)return"";const r=[],o=Date.now(),a=(0,Bc.Z)(e.type,t);if("Dungeon Entrance"===e.type&&null!==n&&void 0!==n&&n.dungeon){r.push(`<p>${a}</p>`);const e=n.dungeon.endTime;if(e){const t=Math.max(0,e-o);let a=n.dungeon.phase;o>=e&&(a="open"===n.dungeon.phase?"resetting":"open");const s=Math.floor(t%864e5/36e5),i=Math.floor(t%36e5/6e4),l=Math.floor(t%6e4/1e3),c=[];s>0&&c.push(`${s}h`),i>0&&c.push(`${i}m`),(l>0||0===c.length)&&c.push(`${l}s`);const d=c.join(" ");"open"===a?r.push(`<p>Open - Resets in ${d}</p>`):"resetting"===a&&r.push(`<p>Closed - Opens in ${d}</p>`)}else r.push(`<p>${"open"===n.dungeon.phase?"Open":"Closed"}</p>`);return r.join("")}switch(e.category){case"farmplot":if(r.push(`<p>${a}</p>`),e.growEnd){const t=Math.max(0,e.growEnd-o),n=Math.floor(t/864e5),a=Math.floor(t%864e5/36e5),s=Math.floor(t%36e5/6e4),i=Math.floor(t%6e4/1e3);if(t>0){const e=[];n>0&&e.push(`${n}d`),a>0&&e.push(`${a}h`),s>0&&e.push(`${s}m`),(i>0||0===e.length)&&e.push(`${i}s`),r.push(`<p>${e.join(" ")} remaining</p>`)}}break;case"crafting":if(r.push(`<p>${a}</p>`),e.craftEnd){const t=Math.max(0,e.craftEnd-o),n=Math.floor(t/864e5),a=Math.floor(t%864e5/36e5),s=Math.floor(t%36e5/6e4),i=Math.floor(t%6e4/1e3);if(t>0){const e=[];n>0&&e.push(`${n}d`),a>0&&e.push(`${a}h`),s>0&&e.push(`${s}m`),(i>0||0===e.length)&&e.push(`${i}s`),r.push(`<p>\u23f3 ${e.join(" ")} remaining</p>`)}}break;default:r.push(`<p>${a}</p>`)}return r.join("")}function yd(e,t){const n=(0,Bc.Z)(e.type,t);let r=`<p>${n}</p>`;switch(e.action){case"graze":switch(e.state){case"processing":r=`<p>${n}</p><p>is ready.</p>`;break;case"hungry":r=`<p>${n}</p><p>is hungry and</p><p>looking for ${"Pig"===e.type?"dirt":"grass"}.</p>`;break;case"grazing":{let t="";if(e.grazeEnd){const n=Math.max(0,e.grazeEnd-Date.now());t=`<p>${Math.floor(n%36e5/6e4)}m ${Math.floor(n%6e4/1e3)}s</p>`}r=`<p>${n}</p><p>is grazing.</p>${t}`;break}case"idle":r="<p>Zzzz...</p>";break;case"roam":r=`<p>${n}</p><p>is roaming.</p>`;break;case"stall":r=`<p>${n}</p><p>is looking for an Animal Stall.</p>`;break;default:r=`<p>${n}</p>`}break;case"quest":r="Kent"===e.type?`<p>${n}</p><p>"${(null===t||void 0===t?void 0:t[47])||"I have special offers!"}"</p>`:`<p>${n}</p><p>"${(null===t||void 0===t?void 0:t[48])||"I might have work for you."}"</p>`;break;case"attack":case"spawn":r=`<p>${n}</p><p>HP: ${e.hp}/${e.maxhp}</p>`,e.state&&(r+=`<p>State: ${e.state}</p>`);break;default:r=`<p>${e.type}</p>`}return r}function vd(e,t){let n=`<p>${e.username||"Anonymous"}</p><p>\u2764\ufe0f\u200d\ud83e\ude79 HP: ${e.hp}</p>`;return e.iscamping&&(n+="<p>\ud83c\udfd5\ufe0f Camping</p>"),e.isinboat&&(n+="<p>\ud83d\udef6 In a boat</p>"),n}const bd=async(e,t)=>{if(!t)return null;try{let n=(await fd.getQuests()).filter((t=>t.giver===e.type)).filter((e=>{var n,r;const o=null===(n=t.activeQuests)||void 0===n?void 0:n.find((t=>t.questId===e.title));return o?o.completed&&!o.rewardCollected:!0===e.repeatable||"true"===e.repeatable||!(null!==(r=t.completedQuests)&&void 0!==r&&r.some((t=>t.questId===e.title)))}));const r=n.some((e=>{var n;const r=null===(n=t.activeQuests)||void 0===n?void 0:n.find((t=>t.questId===e.title));return r&&r.completed&&!r.rewardCollected}));let o=null;return r?o="completed":n.length>0&&(o="available"),o}catch(n){return console.error("Error checking quest NPC status:",n),null}},xd=(e,t)=>{if(!e.symbol||!t)return null;const n=t.find((t=>"trader"===t.category&&t.symbol===e.symbol));return n?n.input:null},wd=(e,t)=>{if("Kent"!==e.type||!t)return null;try{var n;const e=(null===t||void 0===t||null===(n=t.kentOffers)||void 0===n?void 0:n.offers)||[];return e.some((e=>{var n,r,o,a;return((null===t||void 0===t||null===(n=t.inventory)||void 0===n||null===(r=n.find((t=>t.type===e.item)))||void 0===r?void 0:r.quantity)||0)+((null===t||void 0===t||null===(o=t.backpack)||void 0===o||null===(a=o.find((t=>t.type===e.item)))||void 0===a?void 0:a.quantity)||0)>=e.quantity}))?"completed":null}catch(r){return console.error("Error checking Kent status:",r),null}},Sd=e=>{let{resources:n,npcs:r,pcs:o,badgeState:a,electionPhase:s,currentPlayer:i,masterResources:l,hoverTooltip:c,setHoverTooltip:u,handleTileClick:h,onNPCClick:p,onPCClick:m,TILE_SIZE:f,strings:g,timers:y,setInventory:v,setBackpack:b,setResources:x,setCurrentPlayer:w,masterSkills:S,masterTrophies:T,setModalContent:C,setIsModalOpen:k,updateStatus:A,openPanel:I,setActiveStation:E,globalTuning:P,gridId:_,onTileHover:N,cursorModeActive:R,isDeveloper:M=!1}=e;const j=Date.now(),D=t.useMemo((()=>n?n.reduce(((e,t)=>{if("crafting"!==t.category&&"farmhouse"!==t.category||!t.craftEnd){if("farmplot"===t.category&&t.isSearching){const n=`${t.x}-${t.y}`;e.searching.push(n)}else if("farmplot"===t.category&&t.growEnd){const n=`${t.x}-${t.y}`;t.growEnd<j&&e.ready.push(n)}else if("pet"===t.category){const n=`${t.x}-${t.y}`;t.craftEnd&&t.craftedItem&&(t.craftEnd<j?e.ready.push(n):e.inProgress.push(n))}}else{const n=`${t.x}-${t.y}`;t.craftEnd<j?e.ready.push(n):e.inProgress.push(n)}return e}),{ready:[],searching:[],hungry:[],inProgress:[]}):{ready:[],searching:[],hungry:[],inProgress:[]}),[n,j]),O=t.useMemo((()=>n&&null!==i&&void 0!==i&&i.tradeStall?n.reduce(((e,t)=>{if("Trading Post"===t.type&&i.tradeStall){if(i.tradeStall.some((e=>e&&(e.sellTime&&new Date(e.sellTime)<j||null!==e.boughtBy&&void 0!==e.boughtBy)))){const n=`${t.x}-${t.y}`;e.completed.push(n)}}return e}),{completed:[]}):{completed:[]}),[n,null===i||void 0===i?void 0:i.tradeStall,j]);return(0,d.jsx)(md,{resources:n,npcs:r,pcs:o,craftingStatus:D,tradingStatus:O,badgeState:a,electionPhase:s,currentPlayer:i,masterResources:l,hoverTooltip:c,setHoverTooltip:u,handleTileClick:h,onNPCClick:p,onPCClick:m,TILE_SIZE:f,strings:g,timers:y,generateResourceTooltip:gd,generateNPCTooltip:yd,generatePCTooltip:vd,checkQuestNPCStatus:bd,checkTradeNPCStatus:xd,checkKentNPCStatus:wd,setInventory:v,setBackpack:b,setResources:x,setCurrentPlayer:w,masterSkills:S,masterTrophies:T,setModalContent:C,setIsModalOpen:k,updateStatus:A,openPanel:I,setActiveStation:E,globalTuning:P,gridId:_,onTileHover:N,cursorModeActive:R,isDeveloper:M})},Td=e=>{let{app:n,npcs:r,pcs:o,currentPlayer:a,TILE_SIZE:s,masterResources:i}=e;const l=(0,t.useRef)(null),c=(0,t.useRef)(null),d=(0,t.useRef)(null),u=(0,t.useRef)([]),h=(0,t.useRef)(0),p=(0,t.useCallback)((function(e,t,n,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2;const i=2*Math.PI*r,l=Math.floor(i/14),c=8/i*2*Math.PI,d=6/i*2*Math.PI;e.lineStyle(s,o,a);let u=0;for(let h=0;h<l;h++)if(e.arc(t,n,r,u,u+c),u+=c+d,h<l-1){const o=t+Math.cos(u)*r,a=n+Math.sin(u)*r;e.moveTo(o,a)}}),[]),m=(0,t.useCallback)((e=>{const t=u.current;if(e<t.length){const n=t[e];return n.visible=!0,n}const n=new Cl;return t.push(n),l.current&&l.current.addChild(n),n}),[]),f=(0,t.useCallback)((e=>{const t=u.current;for(let n=e;n<t.length;n++)t[n].visible=!1}),[]);return(0,t.useEffect)((()=>{if(null===n||void 0===n||!n.stage)return;const e=n.stage.children.find((e=>"world"===e.name));if(!e)return;let t=e.children.find((e=>"vfx-range"===e.name));if(!t){t=new ma,t.name="vfx-range";const n=e.children.findIndex((e=>"npcs"===e.name));n>=0?e.addChildAt(t,n):e.addChildAt(t,Math.min(2,e.children.length))}return l.current=t,c.current||(c.current=new Cl,t.addChild(c.current)),d.current||(d.current=new Cl,t.addChild(d.current)),u.current.forEach((e=>{e.parent||t.addChild(e)})),()=>{c.current=null,d.current=null,u.current=[],h.current=0,l.current=null}}),[n]),(0,t.useEffect)((()=>{var e;const t=l.current,n=c.current,u=d.current;if(!t||!n||!u)return;const g=!1!==(null===a||void 0===a||null===(e=a.settings)||void 0===e?void 0:e.rangeOn);n.clear(),n.visible=!1,u.clear(),u.visible=!1;let y=0;if(!g)return void f(0);const v=null===o||void 0===o?void 0:o.find((e=>e&&String(e.playerId)===String(null===a||void 0===a?void 0:a._id)));if(null!==v&&void 0!==v&&v.position){var b;const e=v.position.x,t=v.position.y,r=(e+.5)*s,o=(t+.5)*s;if(!((null===a||void 0===a?void 0:a.gridId)===(null===a||void 0===a||null===(b=a.location)||void 0===b?void 0:b.g))){const e=(0,Oc.ZW)(a,i);if(e>1){const t=e*s;n.beginFill(8421504,.2),n.drawCircle(r,o,t),n.endFill(),n.visible=!0}const t=v.attackrange||(null===a||void 0===a?void 0:a.attackrange);if(t&&t>0){p(u,r,o,t*s,16711680,.4,3),u.visible=!0}}}if(r){const e=r.filter((e=>e&&e.position&&("attack"===e.action||"spawn"===e.action)&&e.attackrange&&e.attackrange>0));for(const t of e){var x,w,S,T;const e=null!==(x=null===(w=t.position)||void 0===w?void 0:w.x)&&void 0!==x?x:t.x,n=null!==(S=null===(T=t.position)||void 0===T?void 0:T.y)&&void 0!==S?S:t.y;if(void 0===e||void 0===n)continue;const r=(e+.5)*s,o=(n+.5)*s,a=t.attackrange*s,i=m(y);i.clear(),p(i,r,o,a,16777060,.4,2),y++}}f(y),h.current=y}),[r,o,a,i,s,p,m,f]),null},Cd=e=>{let{app:n,pcs:r,currentPlayer:o,TILE_SIZE:a,connectedPlayers:s}=e;const i=(0,t.useRef)(null),l=(0,t.useRef)([]),c=(0,t.useRef)(null),d=(0,t.useCallback)((e=>0===e.hp?"\ud83d\udc80":e.hp<100?"\ud83e\udd22":e.iscamping?"\ud83c\udfd5\ufe0f":e.isinboat?"\ud83d\udef6":e.icon||"\ud83e\uddd1"),[]),u=(0,t.useCallback)((e=>{const t=l.current;if(e<t.length){const n=t[e];return n.visible=!0,n}const n=new Fa("",{fontSize:32,fontFamily:"sans-serif"});return n.resolution=2,n.anchor.set(.5,.5),t.push(n),i.current&&i.current.addChild(n),n}),[]),h=(0,t.useCallback)((e=>{const t=l.current;for(let n=e;n<t.length;n++)t[n].visible=!1}),[]);return(0,t.useEffect)((()=>{if(null===n||void 0===n||!n.stage)return;const e=n.stage.children.find((e=>"world"===e.name));if(!e)return;let t=e.children.find((e=>"pcs"===e.name));if(!t){t=new ma,t.name="pcs";const n=e.children.findIndex((e=>"overlays"===e.name));n>=0?e.addChildAt(t,n):e.addChild(t)}return i.current=t,c.current||(c.current=new Cl,t.addChildAt(c.current,0)),l.current.forEach((e=>{e.parent||t.addChild(e)})),()=>{c.current=null,l.current=[],i.current=null}}),[n]),(0,t.useEffect)((()=>{const e=i.current,t=c.current;if(!e||!t)return;t.clear(),t.visible=!1;let n=0;if(!r||0===r.length)return void h(0);const l=.8*a;for(const i of r){var p,m;const e=null===(p=i.position)||void 0===p?void 0:p.x,r=null===(m=i.position)||void 0===m?void 0:m.y;if(void 0===e||void 0===r)continue;const c=o&&String(i.playerId)===String(o._id),h=c||(null===s||void 0===s?void 0:s.has(i.playerId)),f=d(i),g=u(n);g.text=f,g.style.fontSize=l,g.x=e*a+a/2,g.y=r*a+a/2,g.alpha=h?1:.4,c&&(t.beginFill(16776960,.3),t.drawCircle(g.x,g.y,.45*a),t.endFill(),t.visible=!0),n++}h(n)}),[r,o,s,a,d,u,h]),null},kd=e=>{let{app:n,hoveredTile:r,cursorMode:o,TILE_SIZE:a}=e;const s=(0,t.useRef)(null),i=(0,t.useRef)(null);return(0,t.useEffect)((()=>{if(null===n||void 0===n||!n.stage)return;const e=n.stage.children.find((e=>"world"===e.name));if(!e)return;let t=e.children.find((e=>"cursor-highlight"===e.name));if(!t){t=new ma,t.name="cursor-highlight";const n=e.children.findIndex((e=>"resources"===e.name));n>=0?e.addChildAt(t,n):e.addChildAt(t,Math.min(1,e.children.length))}return s.current=t,i.current||(i.current=new Cl,t.addChild(i.current)),()=>{i.current=null,s.current=null}}),[n]),(0,t.useEffect)((()=>{const e=i.current;if(!e)return;if(e.clear(),!r||!o)return void(e.visible=!1);const{row:t,col:n}=r;if(t<0||t>=64||n<0||n>=64)return void(e.visible=!1);e.visible=!0;const s=o.size||1;for(let r=0;r<s;r++)for(let o=0;o<s;o++){const s=n+r,i=t-o;if(s<0||s>=64||i<0||i>=64)continue;const l=s*a,c=i*a;e.beginFill(16777215,.25),e.drawRect(l,c,a,a),e.endFill(),e.lineStyle(2,16777215,.8),e.drawRect(l+1,c+1,a-2,a-2),e.lineStyle(1,16777215,.4),e.drawRect(l+3,c+3,a-6,a-6)}}),[r,o,a]),null},Ad=e=>{let{app:n,npcs:r,pcs:o,currentPlayer:a,TILE_SIZE:s}=e;const i=(0,t.useRef)(null),[l,c]=(0,t.useState)(0),d=(0,t.useRef)([]),u=(0,t.useRef)([]),h=(0,t.useRef)(0),p=(0,t.useRef)([]),m=(0,t.useRef)(new Set),f=(0,t.useRef)(null),g=(0,t.useCallback)((e=>"match"===e?5025616:"rival"===e?16007990:3355443),[]),y=(0,t.useCallback)((e=>{if(a&&String(e)===String(a._id)){const e=null===o||void 0===o?void 0:o.find((e=>String(e.playerId)===String(a._id)));if(null!==e&&void 0!==e&&e.position)return e.position}const t=null===r||void 0===r?void 0:r.find((t=>t&&t.type===e));if(null!==t&&void 0!==t&&t.position)return t.position;const n=null===o||void 0===o?void 0:o.find((t=>t&&String(t.playerId)===String(e)));return null!==n&&void 0!==n&&n.position?n.position:null}),[r,o,a]),v=(0,t.useCallback)((e=>{const t=d.current;if(e<t.length){const n=t[e];return n.graphics.visible=!0,n.text.visible=!0,n}const n=new Cl,r=new Fa("",{fontSize:32,fontFamily:"sans-serif"});r.resolution=2,r.anchor.set(.5,.5);const o={graphics:n,text:r};return t.push(o),i.current&&(i.current.addChild(n),i.current.addChild(r)),o}),[]),b=(0,t.useCallback)((e=>{const t=d.current;for(let n=e;n<t.length;n++)t[n].graphics.visible=!1,t[n].text.visible=!1}),[]),x=(0,t.useCallback)((()=>{const e=u.current,t=e.find((e=>!e.active));if(t)return t.active=!0,t.text.visible=!0,t;const n=new Fa("",{fontSize:32,fontFamily:"sans-serif"});n.resolution=2,n.anchor.set(.5,.5);const r={text:n,active:!0,startTime:0,startY:0};return e.push(r),i.current&&i.current.addChild(n),r}),[]),w=(0,t.useCallback)(((e,t,n,r,o)=>{e.clear(),e.beginFill(0,.2),e.drawCircle(t+2,n+4,r),e.endFill(),e.beginFill(16777215),e.drawCircle(t,n,r),e.endFill();const a=Math.max(2,.06*s);e.lineStyle(a,o),e.drawCircle(t,n,r);const i=.4*r,l=.5*r,c=n+r-a/2;e.beginFill(16777215),e.lineStyle(a,o),e.moveTo(t-i/2,c),e.lineTo(t,c+l),e.lineTo(t+i/2,c),e.lineTo(t-i/2,c),e.endFill(),e.lineStyle(0),e.beginFill(16777215),e.drawRect(t-i/2+1,c-a,i-2,a+2),e.endFill()}),[s]);return(0,t.useEffect)((()=>pd.subscribe((()=>{c((e=>e+1))}))),[]),(0,t.useEffect)((()=>{if(null===n||void 0===n||!n.stage)return;const e=n.stage.children.find((e=>"world"===e.name));if(!e)return;let t=e.children.find((e=>"speech"===e.name));return t||(t=new ma,t.name="speech",e.addChild(t)),i.current=t,d.current.forEach((e=>{e.graphics.parent||t.addChild(e.graphics),e.text.parent||t.addChild(e.text)})),u.current.forEach((e=>{e.text.parent||t.addChild(e.text)})),()=>{d.current=[],u.current=[],p.current=[],m.current.clear(),i.current=null,f.current&&null!==n&&void 0!==n&&n.ticker&&(n.ticker.remove(f.current),f.current=null)}}),[n]),(0,t.useEffect)((()=>{if(null===n||void 0===n||!n.ticker)return;f.current&&n.ticker.remove(f.current);const e=()=>{const e=Date.now();p.current.forEach((t=>{if(!t.active)return;const n=e-t.startTime,r=Math.min(n/2e3,1);t.text.y=t.startY-40*r,t.text.alpha=1-r,r>=1&&(t.active=!1,t.text.visible=!1)})),p.current=p.current.filter((e=>e.active))};return f.current=e,n.ticker.add(e),()=>{f.current&&null!==n&&void 0!==n&&n.ticker&&n.ticker.remove(f.current),f.current=null}}),[n]),(0,t.useEffect)((()=>{if(!i.current)return;let e=0;const t=pd.getAllSpeeches(),n=pd.getAllOutcomes();for(const[o,a]of t){const t=y(o);if(!t)continue;const n=.75*s,r=(t.x+.5)*s,i=t.y*s-.2*s-n,l=v(e),c=g(a.matchState);w(l.graphics,r,i,n,c);const d=a.topic||a.emoji||"\ud83d\udcac";l.text.text=d,l.text.style.fontSize=.9*s,l.text.x=r,l.text.y=i,e++}b(e),h.current=e;for(const[o,a]of n){const e=`${o}-${a.timestamp}`;if(m.current.has(e))continue;m.current.add(e);const t=y(o);if(!t)continue;const n=x(),r=(t.x+.5)*s,i=t.y*s-.5*s;n.text.text=a.emoji||("positive"===a.type?"\ud83d\udc4d":"\ud83d\udc4e"),n.text.style.fontSize=1.2*s,n.text.x=r,n.text.y=i,n.text.alpha=1,n.startTime=Date.now(),n.startY=i,n.speakerId=o,n.timestamp=a.timestamp,p.current.push(n)}const r=new Set(Array.from(n).map((e=>{let[t,n]=e;return`${t}-${n.timestamp}`})));m.current.forEach((e=>{r.has(e)||m.current.delete(e)}))}),[l,r,o,a,s,y,v,b,g,w,x]),null},Id=new Map,Ed=new Map,Pd=async(e,t)=>{const n=`overlay-${e}-${t}`;if(Id.has(n))return Id.get(n);if(Ed.has(n))return Ed.get(n);const r=(async()=>{try{const r=await fetch(`/assets/overlays/${e}`);if(!r.ok)return console.warn(`Overlay SVG not found: ${e}`),null;const o=await r.text(),a=document.createElement("canvas"),s=window.devicePixelRatio||1,i=Math.ceil(t*s);a.width=i,a.height=i;const l=a.getContext("2d");if(!l)return null;l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high";const c=new Blob([o],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(c),u=await new Promise((e=>{const t=new Image,n=setTimeout((()=>{URL.revokeObjectURL(d),e(null)}),5e3);t.onload=()=>{clearTimeout(n);try{l.drawImage(t,0,0,i,i);const n=kr.from(a);e(n)}catch(r){e(null)}finally{URL.revokeObjectURL(d)}},t.onerror=()=>{clearTimeout(n),URL.revokeObjectURL(d),e(null)},t.src=d}));return u&&Id.set(n,u),u}catch(r){return console.error(`Error loading overlay SVG ${e}:`,r),null}finally{Ed.delete(n)}})();return Ed.set(n,r),r},_d=e=>{let{app:n,npcs:r,currentPlayer:o,masterResources:a,TILE_SIZE:s}=e;const i=(0,t.useRef)(null),l=(0,t.useRef)([]),c=(0,t.useRef)(0),d=(0,t.useRef)(new Map),u=(0,t.useCallback)((e=>{const t=l.current,n=i.current;if(e<t.length){const n=t[e];return n.active=!0,n.sprite&&(n.sprite.visible=!1),n.text&&(n.text.visible=!1),n}const r=new ya;r.visible=!1;const o=new Fa("",{fontSize:12,fontFamily:"sans-serif"});o.resolution=2,o.visible=!1;const a={sprite:r,text:o,active:!0};return t.push(a),n&&(n.addChild(r),n.addChild(o)),a}),[]),h=(0,t.useCallback)((e=>{const t=l.current;for(let n=e;n<t.length;n++)t[n].active=!1,t[n].sprite&&(t[n].sprite.visible=!1),t[n].text&&(t[n].text.visible=!1)}),[]),p=(0,t.useCallback)((()=>s<=16?Math.max(6,.35*s):s<=30?Math.max(10,.35*s):Math.max(14,.35*s)),[s]);return(0,t.useEffect)((()=>{if(null===n||void 0===n||!n.stage)return;const e=n.stage.children.find((e=>"world"===e.name));if(!e)return;let t=e.children.find((e=>"npc-overlays"===e.name));if(!t){t=new ma,t.name="npc-overlays";const n=e.children.findIndex((e=>"overlays"===e.name));n>=0?e.addChildAt(t,n):e.addChild(t)}return i.current=t,l.current.forEach((e=>{e.sprite&&!e.sprite.parent&&t.addChild(e.sprite),e.text&&!e.text.parent&&t.addChild(e.text)})),()=>{l.current=[],d.current.clear(),Id.clear(),Ed.clear(),i.current=null}}),[n]),(0,t.useEffect)((()=>{if(!i.current||!r)return;c.current+=1;const e=c.current;return(async()=>{let t=0;const n=p();for(const h of r){if(e!==c.current)return;if(!i.current)return;if(!h.position)continue;let r=null;if("quest"===h.action){var l;const e=`${h.type}-${null===o||void 0===o?void 0:o._id}-${(null===o||void 0===o||null===(l=o.activeQuests)||void 0===l?void 0:l.length)||0}`;d.current.has(e)?r=d.current.get(e):(r=await bd(h,o),d.current.set(e,r)),r||"Kent"!==h.type||(r=wd(h,o))}else if("trade"===h.action){xd(h,a)&&(r="available")}if(e!==c.current)return;if(!r)continue;let p=Mc[r];!p&&r&&r.length<=3&&(p=Mc.available);const m=h.position.x*s+2,f=h.position.y*s+s-n-2,g=u(t);if(p){const r=await Pd(p,n);if(e!==c.current)return;if(r&&!1!==r.valid){g.sprite.texture=r,g.sprite.width=n,g.sprite.height=n,g.sprite.x=m,g.sprite.y=f,g.sprite.visible=!0,g.text.visible=!1,t++;continue}}const y=jc[r];y&&(g.text.text=y.emoji,g.text.style.fontSize=.8*n,g.text.x=m,g.text.y=f,g.text.visible=!0,g.sprite.visible=!1,t++)}h(t),t>0&&console.log(`\ud83d\udccc PixiJS rendered ${t} NPC overlays`)})(),()=>{d.current.clear()}}),[r,o,a,s,u,h,p]),null},Nd=new Map,Rd=new Map,Md=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=`${t?"overlay-":""}${e}`;if(Nd.has(n))return Nd.get(n);if(Rd.has(n))return Rd.get(n);const r=(async()=>{try{const r=t?"/assets/overlays/":"/assets/resources/",o=await fetch(`${r}${e}`);if(!o.ok)return console.warn(`SVG not found: ${e}`),null;const a=await o.text(),s=t?64:128,i=document.createElement("canvas"),l=window.devicePixelRatio||1,c=Math.ceil(s*l);i.width=c,i.height=c;const d=i.getContext("2d");if(!d)return console.error("Failed to get 2d context for SVG rendering"),null;d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high";const u=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),h=URL.createObjectURL(u),p=await new Promise((t=>{const n=new Image,r=setTimeout((()=>{console.warn(`SVG load timed out: ${e}`),URL.revokeObjectURL(h),t(null)}),5e3);n.onload=()=>{clearTimeout(r);try{d.drawImage(n,0,0,c,c);const e=kr.from(i);t(e)}catch(e){console.error("Error creating texture from SVG:",e),t(null)}finally{URL.revokeObjectURL(h)}},n.onerror=()=>{clearTimeout(r),console.warn(`Failed to load SVG image: ${e}`),URL.revokeObjectURL(h),t(null)},n.src=h}));return p&&Nd.set(n,p),p}catch(r){return console.error(`Error loading SVG ${e}:`,r),null}finally{Rd.delete(n)}})();return Rd.set(n,r),r},jd=e=>(e=>{if(!e)return 2263842;const t=e.replace("#","").substring(0,6);return parseInt(t,16)})(f[e]||v),Dd=e=>{let{grid:n,tileTypes:r,resources:o,npcs:a,pcs:s,currentPlayer:i,TILE_SIZE:l,zoomScale:c=1,zoomLevel:u,handleTileClick:h,masterResources:p,strings:m,craftingStatus:f,tradingStatus:g,badgeState:y,electionPhase:v,globalTuning:b,hoverTooltip:x,setHoverTooltip:w,onNPCClick:S,onPCClick:T,setInventory:C,setBackpack:k,setResources:A,setCurrentPlayer:I,masterSkills:E,masterTrophies:P,setModalContent:_,setIsModalOpen:N,updateStatus:R,openPanel:M,setActiveStation:j,gridId:D,timers:O,playersInGrid:B,isDeveloper:L=!1,connectedPlayers:F,cursorMode:$}=e;const G=(0,t.useRef)(null),z=(0,t.useRef)(null),U=(0,t.useRef)(null),H=(0,t.useRef)(null),q=(0,t.useRef)(null),V=(0,t.useRef)(null),W=(0,t.useRef)(null),[Y,K]=(0,t.useState)(null),X=(0,t.useRef)(0),Z=(0,t.useRef)(0),J=Date.now(),Q=(0,t.useMemo)((()=>o?o.reduce(((e,t)=>{if("crafting"!==t.category&&"farmhouse"!==t.category||!t.craftEnd){if("farmplot"===t.category&&t.isSearching){const n=`${t.x}-${t.y}`;e.searching.push(n)}else if("farmplot"===t.category&&t.growEnd){const n=`${t.x}-${t.y}`;t.growEnd<J&&e.ready.push(n)}else if("pet"===t.category){const n=`${t.x}-${t.y}`;t.craftEnd&&t.craftedItem&&(t.craftEnd<J?e.ready.push(n):e.inProgress.push(n))}}else{const n=`${t.x}-${t.y}`;t.craftEnd<J?e.ready.push(n):e.inProgress.push(n)}return e}),{ready:[],searching:[],hungry:[],inProgress:[]}):{ready:[],searching:[],hungry:[],inProgress:[]}),[o,J]),ee=(0,t.useMemo)((()=>o&&null!==i&&void 0!==i&&i.tradeStall?o.reduce(((e,t)=>{if("Trading Post"===t.type&&i.tradeStall){if(i.tradeStall.some((e=>e&&(e.sellTime&&new Date(e.sellTime)<J||null!==e.boughtBy&&void 0!==e.boughtBy)))){const n=`${t.x}-${t.y}`;e.completed.push(n)}}return e}),{completed:[]}):{completed:[]}),[o,null===i||void 0===i?void 0:i.tradeStall,J]),te=(0,t.useCallback)((e=>e.position||{x:e.x,y:e.y}),[]);(0,t.useEffect)((()=>{if(!G.current||z.current)return;return(()=>{const e=new ls({width:64*l,height:64*l,backgroundColor:1710638,resolution:window.devicePixelRatio||1,autoDensity:!0,antialias:!0});z.current=e,G.current.appendChild(e.view);const t=new ma;t.name="world",e.stage.addChild(t),U.current=t;const n=new ma;n.name="tiles",t.addChild(n),H.current=n;const r=new ma;r.name="resources",t.addChild(r),q.current=r;const o=new ma;o.name="npcs",t.addChild(o),V.current=o;const a=new ma;a.name="overlays",t.addChild(a),W.current=a,console.log(`\ud83c\udfae PixiJS initialized with ${1===e.renderer.type?"WebGL":"Canvas"} renderer`)})(),()=>{z.current&&(z.current.destroy(!0,{children:!0,texture:!0}),z.current=null),Nd.clear(),Rd.clear()}}),[]),(0,t.useEffect)((()=>{if(!z.current)return;const e=64*l*c;z.current.renderer.resize(e,e)}),[l,c]),(0,t.useEffect)((()=>{U.current&&U.current.scale.set(c)}),[c]),(0,t.useEffect)((()=>{var e;if(!H.current||!n||!r)return;const t=H.current;t.removeChildren();const o=n.length,a=(null===(e=n[0])||void 0===e?void 0:e.length)||0;for(let n=0;n<o;n++)for(let e=0;e<a;e++){var s;const o=(null===(s=r[n])||void 0===s?void 0:s[e])||"g",a=jd(o),i=new Cl;i.beginFill(a),i.drawRect(e*l,n*l,l,l),i.endFill(),i.lineStyle(.5,0,.1),i.drawRect(e*l,n*l,l,l),t.addChild(i)}console.log(`\ud83d\uddfa\ufe0f PixiJS rendered ${o*a} tiles`)}),[n,r]),(0,t.useEffect)((()=>{if(!q.current||!o)return;const e=q.current;X.current+=1;const t=X.current;e.removeChildren();(async()=>{const n=o.map((async e=>{const t=((e,t)=>{if(!t)return null;const n=t.find((t=>t.type===e));return(null===n||void 0===n?void 0:n.filename)||null})(e.type,p);return{resource:e,texture:t?await Md(t):null}})),r=await Promise.all(n);if(t!==X.current)return void console.log(`\ud83d\udeab Resource render v${t} cancelled after parallel load (now v${X.current})`);if(!q.current)return;let a=0,s=0;for(const{resource:t,texture:o}of r){const n=t.size||1,r=l*n,i=t.x*l,c=n>1?(t.y-n+1)*l:t.y*l;if(o&&!1!==o.valid){const t=new ya(o);t.width=r,t.height=r,t.x=i,t.y=c,e.addChild(t),a++;continue}if(!t.symbol)continue;let d;if(n>1)if("wall"===t.action)d=1.2*l*n;else{d=l*(n<=2?.8:3===n?1:1.2)*n}else d="wall"===t.action?1.1*l:.7*l;const u=new Fa(t.symbol,{fontSize:d,fontFamily:"sans-serif"});u.resolution=2,u.anchor.set(.5,.5),u.x=i+r/2,u.y=c+r/2,e.addChild(u),s++}console.log(`\ud83c\udf32 PixiJS rendered ${a} SVG + ${s} emoji resources (${o.length} total, parallel load)`)})()}),[o,p]),(0,t.useEffect)((()=>{if(!V.current||!a)return;const e=V.current;e.removeChildren();for(const t of a){const n=te(t),r=null===n||void 0===n?void 0:n.x,o=null===n||void 0===n?void 0:n.y;if(void 0===r||void 0===o)continue;if(!t.symbol)continue;const a=.8*l,s=new Fa(t.symbol,{fontSize:a,fontFamily:"sans-serif"});s.resolution=2,s.anchor.set(.5,.5),s.x=r*l+l/2,s.y=o*l+l/2,e.addChild(s)}console.log(`\ud83d\udc64 PixiJS rendered ${a.length} NPCs`)}),[a,te]),(0,t.useEffect)((()=>{if(!W.current||!o)return;const e=W.current;Z.current+=1;const t=Z.current;e.removeChildren();(async()=>{let n=0;for(const a of o){if(t!==Z.current)return void console.log(`\ud83d\udeab Overlay render v${t} cancelled (now v${Z.current})`);if(!W.current)return;if("doober"===a.category||"source"===a.category)continue;const r=Rc(a,Q,ee,y,v);if(!r)continue;const o=r.type,s=Mc[o],i=jc[o],c=.4*l,d=a.x*l+2,u=a.y*l+l-c-2;if(s){const r=await Md(s,!0);if(t!==Z.current)return void console.log(`\ud83d\udeab Overlay render v${t} cancelled after SVG load (now v${Z.current})`);if(r&&!1!==r.valid){if(!W.current)return;const t=new ya(r);t.width=c,t.height=c,t.x=d,t.y=u,e.addChild(t),n++;continue}}if(i){const t=new Fa(i.emoji,{fontSize:.8*c,fontFamily:"sans-serif"});t.resolution=2,t.x=d,t.y=u,e.addChild(t),n++}}if(a)for(const o of a){var r,s;if(t!==Z.current)return;if(!W.current)return;const a=Dc(o);if(!a)continue;const i=a.type;if(!i||!Mc[i])continue;const c=Math.floor((null===(r=o.position)||void 0===r?void 0:r.x)||0)*l,d=Math.floor((null===(s=o.position)||void 0===s?void 0:s.y)||0)*l,u=.4*l,h=c+2,p=d+l-u-2,m=Mc[i];if(m){const r=await Md(m,!0);if(t!==Z.current)return;if(r&&!1!==r.valid&&W.current){const t=new ya(r);t.width=u,t.height=u,t.x=h,t.y=p,e.addChild(t),n++;continue}}const f=jc[i];if(f){const t=new Fa(f.emoji,{fontSize:.8*u,fontFamily:"sans-serif"});t.resolution=2,t.x=h,t.y=p,e.addChild(t),n++}}n>0&&console.log(`\u2728 PixiJS rendered ${n} overlays`)})()}),[o,a,Q,ee,y,v,i]);const ne=(0,t.useCallback)((e=>{if(!G.current)return;const t=G.current.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top,o=n/c,d=r/c,u=Math.floor(o/l),f=Math.floor(d/l);if(f<0||f>=64||u<0||u>=64)return;const g=null===a||void 0===a?void 0:a.find((e=>e&&e.position&&Math.floor(e.position.x)===u&&Math.floor(e.position.y)===f));if(g)return void id(g,{currentPlayer:i,playersInGrid:B,gridId:D,TILE_SIZE:l,masterResources:p,masterSkills:E,masterTrophies:P,globalTuning:b,strings:m,onNPCClick:S,setHoverTooltip:w,setInventory:C,setBackpack:k,setResources:A,setCurrentPlayer:I,setModalContent:_,setIsModalOpen:N,updateStatus:R,openPanel:M,setActiveStation:j,isDeveloper:L});const y=null===s||void 0===s?void 0:s.find((e=>e&&e.position&&Math.floor(e.position.x)===u&&Math.floor(e.position.y)===f));y&&T?T(y):h&&h(f,u)}),[h,l,c,a,s,i,B,D,p,E,P,b,m,S,T,w,C,k,A,I,_,N,R,M,j,L]),re=(0,t.useCallback)((e=>{if(!G.current)return;const t=G.current.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top,d=n/c,u=r/c,h=Math.floor(d/l),p=Math.floor(u/l);if(p<0||p>=64||h<0||h>=64)return K(null),void(w&&w(null));if(K({row:p,col:h}),!w)return;const f=null===a||void 0===a?void 0:a.find((e=>e&&e.position&&Math.floor(e.position.x)===h&&Math.floor(e.position.y)===p));if(f){const t=hd(e.clientX,e.clientY);return void w({x:t.x,y:t.y,content:yd(f,m)})}const g=null===o||void 0===o?void 0:o.find((e=>{if("shadow"===e.type||"doober"===e.category||"source"===e.category||"deco"===e.category)return!1;const t=e.size||1;return h>=e.x&&h<e.x+t&&p<=e.y&&p>e.y-t}));if(g){const t=hd(e.clientX,e.clientY);return void w({x:t.x,y:t.y,content:gd(g,m,O)})}const y=null===s||void 0===s?void 0:s.find((e=>e&&e.position&&Math.floor(e.position.x)===h&&Math.floor(e.position.y)===p&&String(e.playerId)!==String(null===i||void 0===i?void 0:i._id)));if(y){const t=hd(e.clientX,e.clientY);w({x:t.x,y:t.y,content:vd(y)})}else w(null)}),[l,c,a,s,o,i,m,O,w]),oe=(0,t.useCallback)((()=>{K(null),w&&w(null)}),[w]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{ref:G,onClick:ne,onMouseMove:re,onMouseLeave:oe,style:{position:"absolute",top:0,left:0,width:64*l*c+"px",height:64*l*c+"px",zIndex:1,cursor:"pointer"}}),(0,d.jsx)(kd,{app:z.current,hoveredTile:Y,cursorMode:$,TILE_SIZE:l}),(0,d.jsx)(Td,{app:z.current,npcs:a,pcs:s,currentPlayer:i,TILE_SIZE:l,masterResources:p}),(0,d.jsx)(Cd,{app:z.current,pcs:s,currentPlayer:i,TILE_SIZE:l,connectedPlayers:F}),(0,d.jsx)(Ad,{app:z.current,npcs:a,pcs:s,currentPlayer:i,TILE_SIZE:l}),(0,d.jsx)(_d,{app:z.current,npcs:a,currentPlayer:i,masterResources:p,TILE_SIZE:l})]})},Od=e=>{let{resources:n,masterResources:r,globalTuning:o,TILE_SIZE:a,craftingStatus:s,tradingStatus:i,badgeState:l,electionPhase:c,currentPlayer:u,handleTileClick:h}=e;const p=(0,t.useRef)(null),m=(0,t.useRef)(null),f=(0,t.useRef)(!1),g=(0,t.useRef)(0),[y,v]=(0,t.useState)(0);(0,t.useEffect)((()=>((0,Hc.t7)((()=>{v((e=>e+1))})),()=>{(0,Hc.t7)(null)})),[]),(0,t.useEffect)((()=>{o&&cd.A.updateZoomTiers(o)}),[o]),(0,t.useEffect)((()=>()=>{f.current=!1}),[]);const b=(0,t.useCallback)((async()=>{const e=p.current;if(!e||!n)return;g.current+=1;const t=g.current;f.current&&console.log("\ud83d\udeab [RESOURCE RENDER] Another render in progress - this render will proceed and old one will be stale"),f.current=!0;const o=setTimeout((()=>{console.warn("\u23f0 [RESOURCE RENDER] Render timed out after 10 seconds, resetting lock"),f.current=!1}),1e4);try{const o=e.getContext("2d");if(!o)return void console.error("\u274c [RESOURCE RENDER] Failed to get 2d context");const s=window.devicePixelRatio||1,i=64*a,l=64*a,c=i*s,d=l*s;if(e.width=c,e.height=d,e.style.width=i+"px",e.style.height=l+"px",o.scale(s,s),o.clearRect(0,0,i,l),t!==g.current)return;for(const e of n){if(t!==g.current)return;(0,Hc.d9)(e.x,e.y)||await x(o,e,a,r)}if(t!==g.current)return void console.log(`\ud83d\udeab [RESOURCE RENDER] Render v${t} became stale before overlays, aborting`);const u=n.filter((e=>"shadow"!==e.type&&"doober"!==e.category&&"source"!==e.category&&!(0,Hc.d9)(e.x,e.y)));for(const e of u){if(t!==g.current)return;await S(o,e,a)}}finally{clearTimeout(o),t===g.current&&(f.current=!1)}}),[n,a,s,i,l,c,r]),x=async(e,t,n,r)=>{const o=t.x*n,a=t.y*n,s=t.size||1,i=n*s,l=s>1?a-(s-1)*n:a,c=((e,t)=>{if(!t)return null;const n=t.find((t=>t.type===e));return(null===n||void 0===n?void 0:n.filename)||null})(t.type,r);if(c){const r=await cd.A.getSVGTexture(c,i);r?e.drawImage(r,o,l,i,i):(console.warn(`\u274c [SVG DEBUG] Failed to load SVG for ${t.type}: ${c}`),w(e,t,o,l,n,s))}else t.symbol&&w(e,t,o,l,n,s)},w=(e,t,n,r,o,a)=>{let s;if(e.save(),e.textAlign="center",e.textBaseline="middle",a>1)if("wall"===t.action)s=1.2*o*a;else{s=o*(a<=2?.8:3===a?1:1.2)*a}else s="wall"===t.action?1.1*o:.7*o;e.font=`${s}px sans-serif`;const i=o*a,l=n+i/2,c=r+i/2;e.fillText(t.symbol,l,c),e.restore()},S=async(e,t,n)=>{const r=Rc(t,s,i,l,c);if(!r)return;const o=r.type;if(o&&Mc[o]){const r=t.x*n,a=t.y*n;t.size;let s;s=n<=16?Math.max(6,.35*n):n<=30?Math.max(10,.35*n):Math.max(14,.35*n);const i=r+2,l=a+n-s-2,c=await cd.A.getOverlayTexture(Mc[o],s);c?e.drawImage(c,i,l,s,s):console.warn(`Failed to load overlay texture for ${o}`)}};(0,t.useEffect)((()=>{const e=JSON.stringify({resources:null===n||void 0===n?void 0:n.map((e=>({x:e.x,y:e.y,type:e.type,symbol:e.symbol,size:e.size}))),TILE_SIZE:a,craftingReady:null===s||void 0===s?void 0:s.ready,craftingInProgress:null===s||void 0===s?void 0:s.inProgress,tradingReady:null===i||void 0===i?void 0:i.ready,mailboxBadge:null===l||void 0===l?void 0:l.mailbox,electionPhase:c,playerId:null===u||void 0===u?void 0:u.id,animationVersion:(0,Hc.pU)()});e!==m.current&&(b().catch((e=>{console.error("Error rendering resources:",e),f.current=!1})),m.current=e)}),[n,a,s,i,l,c,u,y]);const T=(0,t.useCallback)((e=>{if(!h)return;const t=p.current.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top,o=Math.floor(n/a),s=Math.floor(r/a);h(s,o)}),[h,a]);return(0,d.jsx)("canvas",{ref:p,onClick:T,style:{position:"absolute",top:0,left:0,width:64*a+"px",height:64*a+"px",zIndex:10,pointerEvents:"none"}})},Bd=e=>{let{resources:t,masterResources:n,globalTuning:r,TILE_SIZE:o,craftingStatus:a,tradingStatus:s,badgeState:i,electionPhase:l,currentPlayer:c,handleTileClick:u}=e;return(0,d.jsx)(Od,{resources:t,masterResources:n,globalTuning:r,TILE_SIZE:o,craftingStatus:a,tradingStatus:s,badgeState:i,electionPhase:l,currentPlayer:c,handleTileClick:u})},Ld=e=>{let{npcs:n,TILE_SIZE:r,currentPlayer:o,globalTuning:a,gridId:s,onNPCClick:i,onMouseEnter:l,onMouseLeave:c,checkQuestNPCStatus:u,checkTradeNPCStatus:h,checkKentNPCStatus:p,getOverlayContent:m,strings:f,masterResources:g,playersInGrid:y,setInventory:v,setBackpack:b,setResources:x,setCurrentPlayer:w,masterSkills:S,setModalContent:T,setIsModalOpen:C,updateStatus:k,openPanel:A,setActiveStation:I,masterTrophies:E,setHoverTooltip:P,isDeveloper:_=!1}=e;const N=(0,t.useRef)(null),R=((0,t.useRef)(null),(0,t.useRef)(null)),M=(0,t.useRef)(null),j=(0,t.useRef)(null),D=(0,t.useRef)({}),O=(0,t.useRef)(null),B=(0,t.useRef)(null);(0,t.useEffect)((()=>{}),[n]),(0,t.useEffect)((()=>{a&&cd.A.updateZoomTiers(a)}),[a]);const L=(0,t.useCallback)((()=>{const e=()=>{const t=Date.now();let n=!1;Object.keys(D.current).forEach((e=>{const r=D.current[e];if(!r||0===r.duration)return;const o=t-r.startTime;if(o>=r.duration)r.currentPos={...r.targetPos},r.duration=0;else{const e=o/r.duration;r.currentPos={x:r.startPos.x+(r.targetPos.x-r.startPos.x)*e,y:r.startPos.y+(r.targetPos.y-r.startPos.y)*e},n=!0}})),B.current&&B.current(),O.current=n?requestAnimationFrame(e):null};O.current=requestAnimationFrame(e)}),[]);(0,t.useEffect)((()=>{if(!n||0===n.length)return;let e=!1;n.forEach((t=>{const n=D.current[t.id],r={x:t.position.x,y:t.position.y};n?n.targetPos.x===r.x&&n.targetPos.y===r.y||(D.current[t.id]={startPos:{...n.currentPos},currentPos:{...n.currentPos},targetPos:{...r},startTime:Date.now(),duration:1200},e=!0,O.current||L()):(D.current[t.id]={startPos:{...r},currentPos:{...r},targetPos:{...r},startTime:Date.now(),duration:0},e=!0)})),B.current&&B.current()}),[n,L]),(0,t.useEffect)((()=>()=>{O.current&&(cancelAnimationFrame(O.current),O.current=null)}),[]);const F=(0,t.useCallback)((e=>{const t=D.current[e.id];return t?t.currentPos:e.position}),[]),$=(0,t.useCallback)((()=>{M.current&&(clearInterval(M.current),M.current=null)}),[]),G=(0,t.useCallback)((()=>{j.current&&(clearInterval(j.current),j.current=null)}),[]),z=(0,t.useCallback)((()=>{if(!R.current||!P)return;const e=Fc.Ay.getNPCsInGrid(s);if(!e)return;const t=Object.values(e).find((e=>e&&e.id===R.current.id));if(!t)return P(null),R.current=null,void $();const n=sd(t,f);R.current.tooltipData&&P({x:R.current.tooltipData.x,y:R.current.tooltipData.y,content:n})}),[s,f,P,$]),U=(0,t.useCallback)((()=>{M.current||(M.current=setInterval((()=>{if(!R.current||!P)return;const e=Fc.Ay.getNPCsInGrid(s);if(!e)return;const t=Object.values(e).find((e=>e&&e.id===R.current.id));if(!t)return P(null),R.current=null,void(M.current&&(clearInterval(M.current),M.current=null));const n=sd(t,f);R.current.tooltipData&&P({x:R.current.tooltipData.x,y:R.current.tooltipData.y,content:n})}),1e3))}),[s,f,P]);(0,t.useEffect)((()=>{z()}),[n,z]),(0,t.useEffect)((()=>()=>{$(),G()}),[$,G]);const H=(0,t.useCallback)((async()=>{const e=N.current;if(!e||!n)return;const t=e.getContext("2d"),o=window.devicePixelRatio||1,a=64*r,s=64*r,i=a*o,l=s*o;e.width=i,e.height=l,e.style.width=a+"px",e.style.height=s+"px",t.scale(o,o),t.clearRect(0,0,a,s),n.forEach((e=>{e&&e.position&&"undefined"!==typeof e.position.x&&"undefined"!==typeof e.position.y&&W(t,e,r)}));for(const c of n)c&&c.position&&"undefined"!==typeof c.position.x&&"undefined"!==typeof c.position.y&&(q(t,c,r),await Y(t,c,r))}),[n,r,u,h,p,F,o]);(0,t.useEffect)((()=>{B.current=H,n&&n.length>0&&H()}),[H,n]);const q=(e,t,n)=>{const r=F(t),o=r.x*n,a=r.y*n;t.type;V(e,t,o,a,n)},V=(e,t,n,r,o)=>{e.save(),e.font=.8*o+"px sans-serif",e.textAlign="center",e.textBaseline="middle";const a=n+o/2,s=r+o/2;e.fillText(t.symbol||"\u2753",a,s),e.restore()},W=(e,t,n)=>{var r;if(!(!1!==(null===o||void 0===o||null===(r=o.settings)||void 0===r?void 0:r.rangeOn)&&("attack"===t.action||"spawn"===t.action)&&t.attackrange&&t.attackrange>0))return;const a=F(t),s=(a.x+.5)*n,i=(a.y+.5)*n,l=t.attackrange*n;e.save(),e.strokeStyle="rgba(255, 255, 100, 0.3)",e.setLineDash([5,5]),e.lineWidth=2,e.beginPath(),e.arc(s,i,l,0,2*Math.PI),e.stroke(),e.restore()},Y=async(e,t,n)=>{let r=null;if("quest"===t.action&&u?(r=await u(t),!r&&"Kent"===t.type&&p&&(r=p(t))):"trade"===t.action&&h&&(r=h(t)),!r)return;let o=Mc[r];if(!o&&r&&r.length<=3&&(o=Mc.available),o){const r=F(t),a=r.x*n,s=r.y*n;let i;i=n<=16?Math.max(6,.35*n):n<=30?Math.max(10,.35*n):Math.max(14,.35*n);const l=a+2,c=s+n-i-2,d=await cd.A.getOverlayTexture(o,i);d?e.drawImage(d,l,c,i,i):console.warn(`Failed to load overlay texture for NPC ${t.type}: ${o}`)}};(0,t.useEffect)((()=>{B.current&&B.current()}),[n,r,u,h,p,o,H]);const K=(0,t.useCallback)((e=>{if(!i)return;const t=N.current.getBoundingClientRect(),l=e.clientX-t.left,c=e.clientY-t.top,d=Math.floor(l/r),u=Math.floor(c/r),h=null===n||void 0===n?void 0:n.find((e=>{const t=F(e);return Math.floor(t.x)===d&&Math.floor(t.y)===u}));if(h)e.preventDefault(),e.stopPropagation(),id(h,{currentPlayer:o,playersInGrid:y,gridId:s,TILE_SIZE:r,masterResources:g,masterSkills:S,masterTrophies:E,globalTuning:a,strings:f,onNPCClick:i,setHoverTooltip:P,setInventory:v,setBackpack:b,setResources:x,setCurrentPlayer:w,setModalContent:T,setIsModalOpen:C,updateStatus:k,openPanel:A,setActiveStation:I,isDeveloper:_});else{const t=N.current;if(t){t.style.pointerEvents="none";const n=document.elementFromPoint(e.clientX,e.clientY);if(t.style.pointerEvents="auto",n){const t=new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:e.clientX,clientY:e.clientY,button:e.button,buttons:e.buttons});n.dispatchEvent(t)}}}}),[i,n,r,F]),X=(0,t.useCallback)(((e,t)=>{"attack"!==e.action&&"spawn"!==e.action||(console.log("\ud83c\udfaf Starting cursor update interval for attack NPC:",e.id),j.current&&(clearInterval(j.current),j.current=null),j.current=setInterval((()=>{if(!R.current||R.current.id!==e.id)return console.log("\ud83c\udfaf Stopping cursor update - no longer hovering"),void(j.current&&(clearInterval(j.current),j.current=null));const n=dd(e),r=Date.now();console.log("\ud83c\udfaf Cursor update check:",{npc:e.id,cursorClass:n,currentTime:r,globalAttackCooldown:ld().cooldownEnd,isOnCooldown:ld().isOnCooldown}),ud(t,n)}),100))}),[]),Z=(0,t.useCallback)((e=>{const t=N.current;if(!t)return;const o=t.getBoundingClientRect(),a=e.clientX-o.left,s=e.clientY-o.top,i=Math.floor(a/r),l=Math.floor(s/r),c=null===n||void 0===n?void 0:n.find((e=>{const t=F(e);return Math.floor(t.x)===i&&Math.floor(t.y)===l}));if(c){ud(t,dd(c));const n=sd(c,f);if(P){const r=hd(e.clientX,e.clientY),o={x:r.x,y:r.y,content:n};P(o),R.current={id:c.id,tooltipData:o},U(),X(c,t)}}else ud(t,null),P&&P(null),R.current=null,$(),G()}),[l,P,f,n,r,F,U,$,X,G]),J=(0,t.useCallback)((e=>{P&&P(null),R.current=null,$(),G(),c&&c(e)}),[c,P,$]);return(0,d.jsx)("canvas",{ref:N,onClick:K,onMouseMove:Z,onMouseLeave:J,style:{position:"absolute",top:0,left:0,zIndex:15,pointerEvents:"auto"}})},Fd=e=>{let{npcs:t,TILE_SIZE:n,currentPlayer:r,globalTuning:o,gridId:a,onNPCClick:s,checkQuestNPCStatus:i,checkTradeNPCStatus:l,checkKentNPCStatus:c,strings:u,masterResources:h,playersInGrid:p,setInventory:m,setBackpack:f,setResources:g,setCurrentPlayer:y,masterSkills:v,setModalContent:b,setIsModalOpen:x,updateStatus:w,openPanel:S,setActiveStation:T,masterTrophies:C,setHoverTooltip:k,isDeveloper:A=!1}=e;return(0,d.jsx)(Ld,{npcs:t,TILE_SIZE:n,currentPlayer:r,globalTuning:o,gridId:a,onNPCClick:s,checkQuestNPCStatus:i,checkTradeNPCStatus:l,checkKentNPCStatus:c,strings:u,masterResources:h,playersInGrid:p,setInventory:m,setBackpack:f,setResources:g,setCurrentPlayer:y,masterSkills:v,setModalContent:b,setIsModalOpen:x,updateStatus:w,openPanel:S,setActiveStation:T,masterTrophies:C,setHoverTooltip:k,isDeveloper:A})};var $d=n(9106);const Gd=e=>{var n,r;let{pc:o,TILE_SIZE:a,currentPlayer:s,isCurrentPlayer:i,onPCClick:l,setCurrentPlayer:c,setInventory:u,setBackpack:h,masterResources:p,strings:m,setHoverTooltip:f,connectedPlayers:g}=e;const[y,v]=(0,t.useState)(!1),[b,x]=(0,t.useState)(null),[w,S]=(0,t.useState)(null),[T,C]=(0,t.useState)(null),k=(0,t.useRef)(null),A=(0,t.useRef)(null),I=(0,t.useRef)(a),[,E]=(0,t.useState)({}),P=$d.ZH[o.playerId]||o.position;(0,t.useEffect)((()=>{let e;const t=()=>{$d.ZH[o.playerId]&&E({}),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>{e&&cancelAnimationFrame(e)}}),[o.playerId]);I.current;(0,t.useEffect)((()=>{I.current=a}),[a]),(0,t.useEffect)((()=>{const e=()=>{const e=pd.getSpeech(o.playerId);S(e);const t=pd.getOutcome(o.playerId);C(t)};e();return pd.subscribe(e)}),[o.playerId]);const _=o.iscamping,N=o.isinboat,R=i&&!1!==(null===s||void 0===s||null===(n=s.settings)||void 0===n?void 0:n.rangeOn),M=R?(0,Oc.ZW)(s,p):0,j=R?o.attackrange:0,D=(null===s||void 0===s?void 0:s.gridId)===(null===s||void 0===s||null===(r=s.location)||void 0===r?void 0:r.g),O=i||(null===g||void 0===g?void 0:g.has(o.playerId));return(0,d.jsxs)(d.Fragment,{children:[R&&M>1&&!D&&(0,d.jsx)("div",{className:"attack-range player-range",style:{position:"absolute",left:P.x*a-M*a+a/2+"px",top:P.y*a-M*a+a/2+"px",width:2*M*a+"px",height:2*M*a+"px",backgroundColor:"rgba(128, 128, 128, 0.2)",borderRadius:"50%",pointerEvents:"none",zIndex:10}}),R&&j>0&&!D&&(0,d.jsx)("div",{className:"attack-range player-attack-range",style:{position:"absolute",left:P.x*a-j*a+a/2-3+"px",top:P.y*a-j*a+a/2-3+"px",width:2*j*a+"px",height:2*j*a+"px",border:"3px dotted rgba(255, 0, 0, 0.4)",borderRadius:"50%",pointerEvents:"none",zIndex:11}}),(0,d.jsx)("div",{ref:k,className:`pc ${i?"current-player":"other-player"} ${y?"hovered":""}`,style:{position:"absolute",left:P.x*a+"px",top:P.y*a+"px",width:`${a}px`,height:`${a}px`,fontSize:.7*a+"px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:16,pointerEvents:"auto",cursor:"pointer",opacity:O?1:.4},onClick:async e=>{e.stopPropagation(),l&&l(o)},onMouseEnter:()=>{if(v(!0),!i&&f){var e;const t=null===(e=k.current)||void 0===e?void 0:e.getBoundingClientRect();if(t){let e=`<p>${o.username||"Anonymous"}</p><p>\u2764\ufe0f\u200d\ud83e\ude79 HP: ${o.hp}</p>`;o.iscamping&&(e+="<p>\ud83c\udfd5\ufe0f Camping</p>"),o.isinboat&&(e+="<p>\ud83d\udef6 In a boat</p>"),f({x:t.left+t.width/2,y:t.top,content:e})}}},onMouseLeave:()=>{v(!1),A.current&&clearTimeout(A.current),f&&f(null)},children:(0,d.jsx)("span",{className:"pc-icon",children:0===o.hp?"\ud83d\udc80":o.hp<100?"\ud83e\udd22":_?"\ud83c\udfd5\ufe0f":N?"\ud83d\udef6":o.icon})})]})},zd=t.memo(Gd),Ud=e=>{let{pcs:t,TILE_SIZE:n,currentPlayer:r,gridId:o,onPCClick:a,setCurrentPlayer:s,setInventory:i,setBackpack:l,masterResources:c,strings:u,connectedPlayers:h}=e;return(0,d.jsx)("div",{style:{position:"absolute",top:0,left:0,width:64*n+"px",height:64*n+"px",overflow:"hidden",pointerEvents:"none",zIndex:16},children:t.map((e=>{if(!e||!e.position||"undefined"===typeof e.position.x||"undefined"===typeof e.position.y)return console.warn("PC missing position data:",e),null;const t=String(e.playerId)===String(null===r||void 0===r?void 0:r._id);return"695bd5b76545a9be8a36ee22"!==o||t?(0,d.jsx)("div",{style:{pointerEvents:"auto"},children:(0,d.jsx)(zd,{pc:e,TILE_SIZE:n,currentPlayer:r,isCurrentPlayer:t,onPCClick:a,setCurrentPlayer:s,setInventory:i,setBackpack:l,masterResources:c,strings:u,setHoverTooltip:()=>{},connectedPlayers:h},e.playerId)},`pc-container-${e.playerId}`):null}))})},Hd=e=>{let{pcs:t,TILE_SIZE:n,currentPlayer:r,gridId:o,onPCClick:a,setCurrentPlayer:s,setInventory:i,setBackpack:l,masterResources:c,strings:u,connectedPlayers:h}=e;return(0,d.jsx)(Ud,{pcs:t,TILE_SIZE:n,currentPlayer:r,gridId:o,onPCClick:a,setCurrentPlayer:s,setInventory:i,setBackpack:l,masterResources:c,strings:u,connectedPlayers:h})},qd=e=>{let{hoveredTile:n,cursorMode:r,TILE_SIZE:o,gridWidth:a,gridHeight:s}=e;const i=(0,t.useRef)(null);return(0,t.useEffect)((()=>{const e=i.current;if(!e)return;const t=e.getContext("2d");if(e.width=a*o,e.height=s*o,t.clearRect(0,0,e.width,e.height),!n||!r)return;const{row:l,col:c}=n;if(l<0||l>=s||c<0||c>=a)return;const d=r.size||1;for(let n=0;n<d;n++)for(let e=0;e<d;e++){const r=c+n,i=l-e;if(r<0||r>=a||i<0||i>=s)continue;const d=r*o,u=i*o;t.fillStyle="rgba(255, 255, 255, 0.25)",t.fillRect(d,u,o,o),t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=2,t.strokeRect(d+1,u+1,o-2,o-2),t.strokeStyle="rgba(255, 255, 255, 0.4)",t.lineWidth=1,t.strokeRect(d+3,u+3,o-6,o-6)}}),[n,r,o,a,s]),r?(0,d.jsx)("canvas",{ref:i,style:{position:"absolute",top:0,left:0,zIndex:5,pointerEvents:"none",imageRendering:"pixelated"}}):null},Vd=new Map;function Wd(e,t){Vd.delete(`${e}-${t}`)}var Yd=n(819);function Kd(e,t){var n;const r=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e.charCodeAt(n);return t%3}(t);return(null===(n={Saw:["common","uncommon","rare"],Shovel:["uncommon","rare","common"],Screwdriver:["rare","common","uncommon"]}[e])||void 0===n?void 0:n[r])||"common"}const Xd={common:100,uncommon:50,rare:20,epic:5,legendary:1};function Zd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if("number"===typeof e)return e*t;const n=Xd[e]||Xd.common,r=1+(100-n)/100;return n*Math.pow(t,r-1)}function Jd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e||0===e.length)return null;const n=e.reduce(((e,n)=>e+Zd(n.scrollchance,t)),0),r=Math.random()*n;let o=0;for(const a of e)if(o+=Zd(a.scrollchance,t),r<=o)return a;return e[0]}async function Qd(e,t,n,r,o,a,s,i,l,c,d,u,h,p,f,g,y,v,b,x,w,S,T,C,k,A,I){var E,P;let _=arguments.length>27&&void 0!==arguments[27]?arguments[27]:null,N=arguments.length>28&&void 0!==arguments[28]?arguments[28]:null;if(console.log(`Resource Clicked:  (${t}, ${n}):`,{resource:e,tileType:null===(E=h[t])||void 0===E?void 0:E[n]}),!e||!e.category)return void console.error(`Invalid resource at (${n}, ${t}):`,e);const R=(null===p||void 0===p?void 0:p.gridId)===(null===p||void 0===p||null===(P=p.location)||void 0===P?void 0:P.g),M=$c.default.getPlayerPosition(d,String(p._id)),j=n,D=t;if(!R&&M&&"number"===typeof M.x&&"number"===typeof M.y){if(Math.sqrt(Math.pow(M.x-j,2)+Math.pow(M.y-D,2))>(0,Oc.ZW)(p,x))return Lc.A.addFloatingText(24,n,t,u),void console.log("Resource out of range")}var O,B;O=n,B=t,Vd.set(`${O}-${B}`,Date.now());try{x&&0!==x.length||(x=await(0,m._M)()),w&&0!==w.length||(w=await(0,m.hC)());const h=p.skills;if(!Array.isArray(i)||!Array.isArray(l)){console.warn("Inventory or backpack is not initialized; fetching from server.");const{inventory:e,backpack:t}=await(0,Kc.Md)(p.playerId);a(e),s(t)}switch(e.category){case"doober":case"special":await eu(e,t,n,r,o,a,s,(null===p||void 0===p?void 0:p.inventory)||[],(null===p||void 0===p?void 0:p.backpack)||[],h,d,c,u,p,f,b,x,w,k,I,N,_);break;case"source":await tu(e,t,n,r,o,i,a,l,s,d,c,u,p,f,x,w,S,T,b,k);break;case"seed":console.log("Seed clicked; do nothing");break;case"deco":console.log("Deco clicked; placeholder for future functionality");break;default:console.warn(`Unhandled resource category: ${e.category}`)}}catch(L){console.error("Error handling resource click:",L),Wd(n,t)}finally{Wd(n,t)}}async function eu(e,t,n,r,o,a,s){var i;let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[],u=arguments.length>10?arguments[10]:void 0,h=arguments.length>12?arguments[12]:void 0,p=arguments.length>13?arguments[13]:void 0,m=arguments.length>14?arguments[14]:void 0,f=arguments.length>15?arguments[15]:void 0,g=arguments.length>16?arguments[16]:void 0,y=arguments.length>17?arguments[17]:void 0,v=arguments.length>18&&void 0!==arguments[18]?arguments[18]:{},b=arguments.length>19&&void 0!==arguments[19]?arguments[19]:null,x=arguments.length>20&&void 0!==arguments[20]?arguments[20]:null,w=arguments.length>21&&void 0!==arguments[21]?arguments[21]:null;console.log("handleDooberClick: Current Player:",p),console.log("handleDooberClick: Current backpack:",c);p.location.gtype;const S=e.qtycollected||1;if(!Array.isArray(l)||!Array.isArray(c))return void console.warn("Inventory or backpack missing; aborting doober click.");const T=`${e.type}-${n}-${t}`;if(window._processingDoobers&&window._processingDoobers.has(T))return void console.log("Already processing this doober, ignoring duplicate click");window._processingDoobers||(window._processingDoobers=new Set),window._processingDoobers.add(T),console.log("MasterSkills:",y);const C=S*d.filter((t=>{var n;const r=g.find((e=>e.type===t.type)),o="skill"===(null===r||void 0===r?void 0:r.category),a=((null===y||void 0===y||null===(n=y[t.type])||void 0===n?void 0:n[e.type])||1)>1;return o&&a})).map((e=>e.type)).reduce(((t,n)=>{var r;return t*((null===y||void 0===y||null===(r=y[n])||void 0===r?void 0:r[e.type])||1)}),1);console.log("[DEBUG] qtyCollected after multiplier:",C);const k="homestead"===(null===p||void 0===p||null===(i=p.location)||void 0===i?void 0:i.gtype);if(!(0,Kc.sy)(e.type)&&!k){var A;if(!(null===p||void 0===p||null===(A=p.skills)||void 0===A?void 0:A.some((e=>"Backpack"===e.type&&e.quantity>0))))return f(19),Lc.A.addFloatingText(v[44]||"No backpack",n,t,h),void(window._processingDoobers&&window._processingDoobers.delete(T))}if(!(0,Kc.Pu)({resource:e.type,quantity:C,currentPlayer:p,inventory:l,backpack:c,masterResources:g,globalTuning:x}))return console.warn("Pre-check: No room for resource. Showing error immediately."),Lc.A.addFloatingText(v[41]||"Not enough room",n,t,h),b&&b("InventoryPanel"),void(window._processingDoobers&&window._processingDoobers.delete(T));let I=null;if(!0===e.repeatable){const r=g.find((t=>"farmplot"===t.category&&t.output===e.type));if(r&&"tree"===r.source){const o=Date.now()+1e3*(r.growtime||0);I=(0,Yd.if)({type:r.type,x:n,y:t,growEnd:o},g),console.log(`\ud83c\udf33 Optimistic tree replacement: ${e.type} -> ${r.type}`)}}o((e=>{const r=e.filter((e=>!(e.x===n&&e.y===t)));return I?[...r,I]:r})),(0,Hc.MV)(n,t,h),Lc.A.addFloatingText(`+${C} ${(0,Bc.Z)(e.type,v)}`,n,t,h);try{console.log("Calling gainIngredients with: ",e.type);const r=await(0,Kc.qf)({playerId:p.playerId,currentPlayer:p,resource:e.type,quantity:C,inventory:l,backpack:c,setInventory:a,setBackpack:s,setCurrentPlayer:m,updateStatus:f,masterResources:g,globalTuning:x});if(!0===r);else if(r&&!1===r.success){if(r.isCapacityError)return console.warn("\u274c Capacity limit reached. Rolling back doober."),o((r=>[...I?r.filter((e=>!(e.x===n&&e.y===t&&e.type===I.type))):r,e])),r.isMissingBackpack||(Lc.A.addFloatingText(v[41]||"Not enough room",n,t,h),console.log("Opening inventory panel. openPanel function:",b),b?b("InventoryPanel"):console.warn("openPanel function not available!")),void(window._processingDoobers&&window._processingDoobers.delete(T));if(!r.isNetworkError)return console.warn("\u274c Client error during collection. Rolling back."),o((r=>[...I?r.filter((e=>!(e.x===n&&e.y===t&&e.type===I.type))):r,e])),void(window._processingDoobers&&window._processingDoobers.delete(T));console.warn("\u26a0\ufe0f Network error during collection, but server may have queued the operation. Not rolling back.")}const i=(0,Kc.TM)(e.type,d||[],y);f(nd("harvest",e.type,C,i.hasSkills?i:null,v,Bc.Z));const S=await(0,Gc.mQ)(u,{type:null,x:n,y:t},!0);if(null===S||void 0===S||!S.success)return void console.warn("\u26a0\ufe0f Grid update failed even though inventory succeeded.");if(await(0,Uc.D)(p,"Collect",e.type,C,m),await async function(e,t,n,r,o){let{currentPlayer:a,inventory:s,backpack:i,setInventory:l,setBackpack:c,setCurrentPlayer:d,updateStatus:u,masterResources:h,globalTuning:p,strings:m,FloatingTextManager:f,gainIngredients:g,trackQuestProgress:y,getLocalizedString:v,selectWeightedRandomItem:b}=o;if(!(0,Yd.AQ)(e,h)||"Wheat"===e)return{dropped:!1};console.log(`<> Collected crop: ${e}, checking for warehouse ingredient drops...`);const x=(null===p||void 0===p?void 0:p.harvestDropRate)||.1,w=Math.random();if(w>x)return console.log(`<\ufffd Drop roll failed: ${w.toFixed(3)} > ${x} (${(100*x).toFixed(0)}% chance)`),{dropped:!1};console.log(`<\ufffd Drop roll succeeded: ${w.toFixed(3)} <= ${x} (${(100*x).toFixed(0)}% chance)`);const S=h.filter((e=>"Warehouse"===e.requires&&e.scrollchance));if(0===S.length)return console.warn("\ufffd\x0f No warehouse ingredients found in masterResources"),{dropped:!1};const T=b(S.map((e=>({...e,scrollchance:Kd(e.type,a.playerId)}))),1);if(!T)return{dropped:!1};console.log(`<\ufffd Warehouse ingredient drop: ${T.type} x1 (${T.scrollchance})`);const C=T.symbol||"";return f.addFloatingText(`${C} +1 ${v(T.type,m)}`,t,n-30/r,r),await g({playerId:a.playerId,currentPlayer:a,resource:T.type,quantity:1,inventory:s,backpack:i,setInventory:l,setBackpack:c,setCurrentPlayer:d,updateStatus:u,masterResources:h,globalTuning:p})?(await y(a,"Collect",T.type,1,d),{dropped:!0,item:T.type,quantity:1,added:!0}):(console.warn("L Failed to add bonus warehouse ingredient to inventory - may be full"),{dropped:!0,item:T.type,quantity:1,added:!1})}(e.type,n,t,h,{currentPlayer:p,inventory:l,backpack:c,setInventory:a,setBackpack:s,setCurrentPlayer:m,updateStatus:f,masterResources:g,globalTuning:x,strings:v,FloatingTextManager:Lc.A,gainIngredients:Kc.qf,trackQuestProgress:Uc.D,getLocalizedString:Bc.Z,selectWeightedRandomItem:Jd}),w&&null!==p&&void 0!==p&&p.playerId)try{if("King's Crown"===e.type){console.log(`\ud83c\udfc6 Awarding King's Crown trophy for collecting ${C} crown(s)`);for(let e=0;e<C;e++)await(0,qc.p)(p.playerId,"King's Crown",1,p,w,m);console.log(`\u2705 Successfully awarded ${C} King's Crown trophy instance(s)`)}else if("Trident"===e.type){console.log(`\ud83c\udfc6 Awarding Trident trophy for collecting ${C} trident(s)`);for(let e=0;e<C;e++)await(0,qc.p)(p.playerId,"Trident",1,p,w,m);console.log(`\u2705 Successfully awarded ${C} Trident trophy instance(s)`)}}catch(E){console.error("\u274c Error awarding collection trophy:",E)}await(0,Kc.CP)(p.playerId,m),console.log("[DEBUG] Player state refreshed after inventory update."),!0===e.repeatable&&await async function(e,t,n,r,o,a,s){console.log(`\ud83c\udf31 handleReplant: Looking for farmplot that outputs ${e.type}`);const i=a.find((t=>"farmplot"===t.category&&t.output===e.type));if(!i)return void console.warn(`\u26a0\ufe0f handleReplant: No farmplot found that outputs ${e.type}`);console.log(`\ud83c\udf31 handleReplant: Found farmplot ${i.type}, planting at (${n}, ${t})`);const l=Date.now()+1e3*(i.growtime||0);console.log(`\u23f1\ufe0f handleReplant: growtime = ${i.growtime}, growEndTime = ${l}, secondsFromNow = ${(l-Date.now())/1e3}`);const c=(0,Yd.if)({type:i.type,x:n,y:t,growEnd:l},a);console.log("\ud83c\udf31 handleReplant: Enriched farmplot resource:",c);const d="tree"===i.source;!d&&c.symbol&&s&&(0,Hc.En)(n,t,s,c.symbol,null,c.filename);if(d){const e=zc.default.getResources();e.some((e=>e.x===n&&e.y===t&&e.type===i.type))||zc.default.setResources([...e,c])}else{const e=[...zc.default.getResources(),c];zc.default.setResources(e),r(e)}try{const e=await(0,Gc.mQ)(o,{type:i.type,x:n,y:t,growEnd:l},!0);if(null===e||void 0===e||!e.success)throw new Error("Server failed to confirm the replant.");console.log(`\u2705 handleReplant: Successfully planted ${i.type} at (${n}, ${t})`)}catch(E){console.error("\u274c handleReplant: Error during replanting:",E);const o=zc.default.getResources().filter((e=>!(e.x===n&&e.y===t&&e.type===i.type)));zc.default.setResources(o),r(o)}}(e,t,n,o,u,g,h)}catch(E){console.error("Error during doober collection:",E),o((r=>[...I?r.filter((e=>!(e.x===n&&e.y===t&&e.type===I.type))):r,e]))}finally{Wd(n,t),window._processingDoobers&&window._processingDoobers.delete(T)}}async function tu(e,t,n,r,o,a,s,i,l,c,d,u,p,m,f,g,y,v,b,x){if("convertTo"!==e.action)return;const w=f.find((t=>t.type===e.output));if(!w)return void console.warn(`\u26a0\ufe0f No matching resource found for output: ${e.output}`);const S=e.requires;if(f.some((e=>e.type===S&&"skill"===e.category))){var T;if(!(null===(T=p.skills)||void 0===T?void 0:T.some((e=>e.type===S)))){d(`${S} Required`,n,t,u);const e="Axe"===S?7057:"Pickaxe"===S?7058:null;return void(e&&(0,h.D)("FTUE",{title:x[7049],message:x[e],icon:"\ud83d\udcaa"}))}}(0,Hc.TL)(n,t,u,S);if(!e.output||"null"===e.output||!w){const e=zc.default.getResources().find((e=>e.x===n&&e.y===t)),r=zc.default.getResources().filter((r=>{if(r.x===n&&r.y===t)return!1;if(e&&e.size&&e.size>1&&"shadow"===r.type){const t=e.anchorKey||`${e.type}-${e.x}-${e.y}`;if(r.parentAnchorKey===t)return!1}return!0}));zc.default.setResources(r),o(r);try{const e=await(0,Gc.mQ)(c,{type:null,x:n,y:t},!0);if(null===e||void 0===e||!e.success)throw new Error("Server failed to confirm the resource removal.");console.log("\u2705 Resource removal completed successfully on the server.")}catch(C){console.error("\u274c Error during resource removal:",C),console.warn("Server update failed. The client may become out of sync.")}}else{const e=n,r=t,a={...w,x:e,y:r,symbol:w.symbol,qtycollected:w.qtycollected||1,category:w.category||"doober",growEnd:w.growEnd||null};console.log("Enriched newResource for local state: ",a);const s=zc.default.getResources().find((e=>e.x===n&&e.y===t)),i=[...zc.default.getResources().filter((e=>{if(e.x===n&&e.y===t)return!1;if(s&&s.size&&s.size>1&&"shadow"===e.type){const t=s.anchorKey||`${s.type}-${s.x}-${s.y}`;if(e.parentAnchorKey===t)return!1}return!0})),a];zc.default.setResources(i),o(i);try{const e=await(0,Gc.mQ)(c,{type:w.type,x:n,y:t},!0);if(null===e||void 0===e||!e.success)throw new Error("Server failed to confirm the source conversion.");console.log("\u2705 Source conversion completed successfully on the server.")}catch(C){console.error("\u274c Error during source conversion:",C),console.warn("Server update failed. The client may become out of sync.")}}try{await(0,Kc.CP)(p.playerId,m),Wd(n,t)}catch(C){console.error("\u274c Error during cleanup:",C)}}const nu=(0,t.createContext)(),ru=e=>{let{children:n}=e;const[r,o]=(0,t.useState)(!1);return(0,d.jsx)(nu.Provider,{value:{uiLocked:r,setUILocked:o},children:n})};var ou=n(6857),au=n(5364);const su=JSON.parse('[{"type":"Kent","symbol":"\ud83e\udd20","buff4friend":1,"buff4love":1,"buff4marriage":1,"interest1":"Money","interest2":"Money","interest3":"Money"},{"type":"The Shepherd","symbol":"\ud83d\udc75\ud83c\udffb","buff4friend":1,"buff4love":2,"buff4marriage":3,"interest1":"Cow","interest2":"Sheep","interest3":"Kent"},{"type":"Portia","symbol":"\ud83d\udc69\ud83c\udffb\u200d\u2696\ufe0f","dialogOnMet":16001,"dialogOnFriend":16101,"dialogOnLove":16201,"dialogOnRival":16301,"dialogOnMarried":16401,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"School","interest2":"Hospital","Iago":"rival"},{"type":"Hotspur","symbol":"\ud83d\udc82","dialogOnMet":16002,"dialogOnFriend":16102,"dialogOnLove":16202,"dialogOnRival":16302,"dialogOnMarried":16402,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Zombie","interest2":"Spider","Cassio":"rival"},{"type":"Cassio","symbol":"\ud83e\udddd","dialogOnMet":16003,"dialogOnFriend":16103,"dialogOnLove":16203,"dialogOnRival":16303,"dialogOnMarried":16403,"buff4friend":1,"buff4love":1,"buff4marriage":1,"interest1":"Duke Angelo","interest2":"Shrine","interest3":"Juliet","Hotspur":"rival","Iago":"rival","Juliet":"friend"},{"type":"Mistress Quickly","symbol":"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf73","dialogOnMet":16004,"dialogOnFriend":16104,"dialogOnLove":16204,"dialogOnRival":16304,"dialogOnMarried":16404,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Apple Pie","interest2":"Strawberry Pie","interest3":"Hotspur","Falstaff":"love"},{"type":"Feste","symbol":"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udfa8","dialogOnMet":16005,"dialogOnFriend":16105,"dialogOnLove":16205,"dialogOnRival":16305,"dialogOnMarried":16405,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Ink","interest2":"Portrait","interest3":"Caliban","Caliban":"friend"},{"type":"Helena","symbol":"\ud83e\uddd1\u200d\ud83c\udfa4","dialogOnMet":16006,"dialogOnFriend":16106,"dialogOnLove":16206,"dialogOnRival":16306,"dialogOnMarried":16406,"buff4friend":1,"buff4love":1,"buff4marriage":1,"interest1":"Feverfew","interest2":"Rosesmary","interest3":"Gertrude","Gertrude":"love"},{"type":"Titania","symbol":"\ud83e\udddd\u200d\u2640\ufe0f","dialogOnMet":16007,"dialogOnFriend":16107,"dialogOnLove":16207,"dialogOnRival":16307,"dialogOnMarried":16407,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Trident","interest2":"Dragon","interest3":"Prospero","Prospero":"friend"},{"type":"Vampire","symbol":"\ud83e\udddb\ud83c\udffb\u200d\u2642\ufe0f","dialogOnMet":16008,"dialogOnFriend":16108,"dialogOnLove":16208,"dialogOnRival":16308,"dialogOnMarried":16408,"buff4friend":1,"buff4love":1,"buff4marriage":1,"interest1":"Zombie","interest2":"Garlic","interest3":"Vampire\'s Blood"},{"type":"Prospero","symbol":"\ud83e\uddd9\ud83c\udffb","dialogOnMet":16009,"dialogOnFriend":16109,"dialogOnLove":16209,"dialogOnRival":16309,"dialogOnMarried":16409,"buff4friend":1,"buff4love":1,"buff4marriage":1,"interest1":"Prospero\'s Orb","interest2":"Titania","interest3":"Leontes","Titania":"friend","Leontes":"friend"},{"type":"Falstaff","symbol":"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udfed","dialogOnMet":16010,"dialogOnFriend":16110,"dialogOnLove":16210,"dialogOnRival":16310,"dialogOnMarried":16410,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Port","interest2":"Port","interest3":"Mistress Quickly","Mistress_Quickley":"love"},{"type":"Apothecary","symbol":"\ud83e\uddd5","dialogOnMet":16011,"dialogOnFriend":16111,"dialogOnLove":16211,"dialogOnRival":16311,"dialogOnMarried":16411,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Potion A","interest2":"Potion B"},{"type":"Iago","symbol":"\ud83e\udd77","dialogOnMet":16012,"dialogOnFriend":16112,"dialogOnLove":16212,"dialogOnRival":16312,"dialogOnMarried":16412,"buff4friend":1,"buff4love":1,"buff4marriage":1,"interest1":"Brass Bell","interest2":"Portia\'s Secret","Portia":"rival","Cassio":"rival"},{"type":"Gertrude","symbol":"\ud83d\udc78","dialogOnMet":16013,"dialogOnFriend":16113,"dialogOnLove":16213,"dialogOnRival":16313,"dialogOnMarried":16413,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Queen\'s Cake","interest2":"Diamond Ring","interest3":"Helena","Helena":"love"},{"type":"Leontes","symbol":"\ud83e\udec5","dialogOnMet":16014,"dialogOnFriend":16114,"dialogOnLove":16214,"dialogOnRival":16314,"dialogOnMarried":16414,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"King\'s Crown","interest2":"Gold","interest3":"Prospero","Prospero":"friend","Iago":"rival","Gertrude":"love"},{"type":"Caliban","symbol":"\ud83e\uddcc","dialogOnMet":16015,"dialogOnFriend":16115,"dialogOnLove":16215,"dialogOnRival":16315,"dialogOnMarried":16415,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Bones","interest2":"Magic Mushroom","interest3":"Titania","Feste":"friend","Titania":"love","Prospero":"rival"},{"type":"Juliet","symbol":"\ud83d\udc69\u200d\ud83e\uddb0","dialogOnMet":16016,"dialogOnFriend":16116,"dialogOnLove":16216,"dialogOnRival":16316,"dialogOnMarried":16416,"buff4friend":2,"buff4love":3,"buff4marriage":5,"interest1":"Tulip","interest2":"Sunflower","interest3":"Cassio","Cassio":"friend"},{"type":"Mermaid","symbol":"\ud83e\udddc\u200d\u2640\ufe0f","dialogOnMet":16017,"dialogOnFriend":16117,"dialogOnLove":16217,"dialogOnRival":16317,"dialogOnMarried":16417,"buff4friend":1,"buff4love":1,"buff4marriage":5,"interest1":"Trident","interest2":"Gold","interest3":"Boat"},{"type":"Oracle","symbol":"\ud83e\uddde\u200d\u2640\ufe0f","dialogOnMet":16018,"dialogOnFriend":16118,"dialogOnLove":16218,"dialogOnRival":16318,"dialogOnMarried":16418,"buff4friend":1,"buff4love":1,"buff4marriage":1,"interest1":"Hope","interest2":"Hope","interest3":"Hope"},{"type":"Constable Elbow","symbol":"\ud83e\uddd4\ud83c\udffc\u200d\u2642\ufe0f","dialogOnMet":16019,"dialogOnFriend":16119,"dialogOnLove":16219,"dialogOnRival":16319,"dialogOnMarried":16419,"buff4friend":1,"buff4love":1,"buff4marriage":1,"interest1":"Home Deed","interest2":"Town Key","interest3":"Kent"},{"type":"Snug","symbol":"\ud83e\uddd4\ud83c\udffd","dialogOnMet":16020,"dialogOnFriend":16120,"dialogOnLove":16220,"dialogOnRival":16320,"dialogOnMarried":16420,"buff4friend":2,"buff4love":1,"buff4marriage":1,"interest1":"Bear","interest2":"Coyote","interest3":"Hotspur","Hotspur":"friend"}]');const iu=function(e){let{isOpen:n=!1,onClose:o,npcName:a,relationshipType:s,username:i,symbol:l,dialogKey:c}=e;const u=(0,r.k)(),[h,p]=(0,t.useState)(0),[m,f]=(0,t.useState)([]),[g,y]=(0,t.useState)(0),[v,b]=(0,t.useState)(!1),x=(0,t.useRef)(null),w=(0,t.useRef)(!0),S={met:"dialogOnMet",friend:"dialogOnFriend",married:"dialogOnMarried",love:"dialogOnLove",rival:"dialogOnRival"},T=a?su.find((e=>e.type===a)):null,C=l||(null===T||void 0===T?void 0:T.symbol)||"?";let k=null;if(c)k=u[c];else if(T&&s){const e=null===T||void 0===T?void 0:T[S[s]];k=e?u[e]:null}const A=k?k.replace(/\{username\}/gi,i||"Adventurer"):null;if((0,t.useEffect)((()=>{if(!A)return void f([]);const e=A.match(/[^.!?]+[.!?]+/g)||[A],t=[];let n="";e.forEach((e=>{const r=e.trim();n.length>0&&n.length+r.length>150?(t.push(n.trim()),n=r):n+=(n?" ":"")+r})),n.trim()&&t.push(n.trim()),f(t),p(0),y(0),b(!0)}),[A]),(0,t.useEffect)((()=>{n?(p(0),y(0),b(!0)):x.current&&clearTimeout(x.current)}),[n,a,s,c,l]),(0,t.useEffect)((()=>{if(!n||!v)return;const e=(m[h]||"").split(/\s+/).filter((e=>e.length>0)).length;return g<e?x.current=setTimeout((()=>{y((e=>e+1))}),80):b(!1),()=>{x.current&&clearTimeout(x.current)}}),[n,v,g,h,m]),(0,t.useEffect)((()=>{w.current?w.current=!1:(y(0),b(!0))}),[h]),!n||!A||0===m.length)return null;const I=h>=m.length-1,E=(m[h]||"").split(/\s+/).filter((e=>e.length>0)),P=E.slice(0,g).join(" "),_=g>=E.length;return(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container modal-small story-modal",children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:o,children:"\xd7"}),(0,d.jsx)("div",{className:"story-modal-symbol",children:C}),(0,d.jsx)("div",{className:"modal-content story-modal-content",children:(0,d.jsxs)("p",{className:"story-modal-text",children:['"',P,'"']})}),m.length>1&&(0,d.jsxs)("div",{className:"story-modal-page-indicator",children:[h+1," / ",m.length]}),(0,d.jsx)("div",{className:"modal-buttons shared-buttons",children:I?(0,d.jsx)("button",{className:"btn-basic btn-modal btn-success",onClick:()=>{_?o():(y(E.length),b(!1))},children:u[796]||"OK"}):(0,d.jsx)("button",{className:"btn-basic btn-modal btn-success",onClick:()=>{_&&!I?p((e=>e+1)):_||(y(E.length),b(!1))},children:u[796]||"OK"})})]})})},lu=e=>{let{currentPlayer:n,setCurrentPlayer:o,onClose:i,openPanel:l,setActiveQuestGiver:c,gridId:u,masterFTUEsteps:p}=e;const m=(0,r.k)(),[f,g]=(0,t.useState)(null),[y,v]=(0,t.useState)(!1),[b,x]=(0,t.useState)([]),[w,S]=(0,t.useState)([]);(0,t.useEffect)((()=>{if(!0!==(null===n||void 0===n?void 0:n.firsttimeuser))return console.log("Player is not a first-time user, closing FTUE"),void i();if(0!==(null===n||void 0===n?void 0:n.ftuestep)){if(null!==n&&void 0!==n&&n.ftuestep){const e=p.find((e=>e.step===n.ftuestep));e?g(e):(console.log("No valid FTUE step found for step:",n.ftuestep),i())}}else{console.log("\ud83c\udf93 Player at FTUE step 0, showing step 1 content");const e=p.find((e=>1===e.step));e&&g(e)}}),[null===n||void 0===n?void 0:n.ftuestep,null===n||void 0===n?void 0:n.firsttimeuser,i]),(0,t.useEffect)((()=>{if(!f||!m)return;f.notificationKey&&(console.log(`\ud83c\udf93 Re-triggering notification for step ${f.step} on load`),(0,h.D)("FTUE",{title:m[7049],message:m[f.notificationKey],...f.notificationIcon&&{icon:f.notificationIcon}}));(async()=>{if(f.addQuests&&f.addQuests.length>0){console.log(`\ud83c\udf93 Step ${f.step}: Checking quests to add: ${f.addQuests.join(", ")}`);try{const e=(await a.A.get(`${s.A}/api/quests`)).data||[],t=(null===n||void 0===n?void 0:n.activeQuests)||[];let r=n;for(const a of f.addQuests){const s=e.find((e=>e.index===a));if(!s)continue;t.some((e=>e.questId===s.title))?console.log(`\ud83c\udf93 Quest "${s.title}" already exists, skipping`):(console.log(`\ud83c\udf93 Adding quest "${s.title}" (index ${a})`),r=await(0,au.p)(n.playerId,r,o,a))}}catch(e){console.error("Error adding FTUE quests:",e)}}})()}),[null===f||void 0===f?void 0:f.step]),(0,t.useEffect)((()=>{if(!1===(null===f||void 0===f?void 0:f.showModal)&&!y){const e=setTimeout((()=>{k()}),0);return()=>clearTimeout(e)}}),[null===f||void 0===f?void 0:f.showModal,null===f||void 0===f?void 0:f.step,y]);const T=async e=>{await(0,au.s1)(e,n.playerId,n,o,b,w),v(!1),await C()},C=async()=>{try{const e=0===n.ftuestep?1:n.ftuestep,t=n.ftuestep,r=e+1,d=p.some((e=>e.step===r)),f=p.find((t=>t.step===e));if(null!==f&&void 0!==f&&f.notificationKey&&(0,h.D)("FTUE",{title:m[7049],message:m[f.notificationKey],...f.notificationIcon&&{icon:f.notificationIcon}}),null!==f&&void 0!==f&&f.addQuests&&f.addQuests.length>0){console.log(`\ud83c\udf93 Step ${e}: Auto-adding quests ${f.addQuests.join(", ")}`);let t=n;for(const e of f.addQuests)t=await(0,au.p)(n.playerId,t,o,e)}if(d){if(null!==f&&void 0!==f&&f.continue){(await a.A.post(`${s.A}/api/update-profile`,{playerId:n.playerId,updates:{ftuestep:t+1}})).data.success&&o((e=>({...e,ftuestep:t+1})))}if(i(),null!==f&&void 0!==f&&f.openPanel&&l){if("NPCPanel"===f.openPanel&&f.panelTargetNPC){const e=Fc.Ay.getNPCsInGrid(u);if(e){const t=Object.values(e).find((e=>e.type===f.panelTargetNPC));if(t)return c(t),void l(f.openPanel)}}l(f.openPanel)}}else(0,au.aA)(n.playerId,n,o,i)}catch(e){console.error("Error in continueStepLogic:",e)}},k=async()=>{try{var e,t;const r=0===n.ftuestep?1:n.ftuestep,o=p.find((e=>e.step===r)),a=(null===n||void 0===n?void 0:n.ftueFeedback)&&((null===(e=n.ftueFeedback.positive)||void 0===e?void 0:e.length)>0||(null===(t=n.ftueFeedback.negative)||void 0===t?void 0:t.length)>0);if(null!==o&&void 0!==o&&o.showFeedbackModalAfter&&!a)return console.log(`\ud83c\udf93 Step ${r} has showFeedbackModalAfter, showing feedback modal`),void v(!0);await C()}catch(r){console.error("Error advancing FTUE step:",r)}},A=(e,t)=>{t?x((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e])):S((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))};return f||y?y?(0,d.jsx)("div",{className:"ftue-overlay",children:(0,d.jsxs)("div",{className:"ftue-modal",children:[(0,d.jsx)("div",{className:"ftue-header",children:(0,d.jsx)("h2",{children:m[780]})}),(0,d.jsxs)("div",{className:"ftue-feedback-content",children:[(0,d.jsxs)("div",{className:"ftue-feedback-section",children:[(0,d.jsx)("h3",{children:m[781]}),(0,d.jsxs)("div",{className:"ftue-feedback-options",children:[(0,d.jsxs)("label",{className:"ftue-checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:b.includes(784),onChange:()=>A(784,!0)}),m[784]]}),(0,d.jsxs)("label",{className:"ftue-checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:b.includes(785),onChange:()=>A(785,!0)}),m[785]]}),(0,d.jsxs)("label",{className:"ftue-checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:b.includes(786),onChange:()=>A(786,!0)}),m[786]]}),(0,d.jsxs)("label",{className:"ftue-checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:b.includes(787),onChange:()=>A(787,!0)}),m[787]]})]}),(0,d.jsx)("button",{className:"ftue-button ftue-button-primary",onClick:()=>T(!0),disabled:0===b.length,children:m[783]})]}),(0,d.jsxs)("div",{className:"ftue-feedback-section",children:[(0,d.jsx)("h3",{children:m[782]}),(0,d.jsxs)("div",{className:"ftue-feedback-options",children:[(0,d.jsxs)("label",{className:"ftue-checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:w.includes(790),onChange:()=>A(790,!1)}),m[790]]}),(0,d.jsxs)("label",{className:"ftue-checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:w.includes(791),onChange:()=>A(791,!1)}),m[791]]}),(0,d.jsxs)("label",{className:"ftue-checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:w.includes(792),onChange:()=>A(792,!1)}),m[792]]}),(0,d.jsxs)("label",{className:"ftue-checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:w.includes(793),onChange:()=>A(793,!1)}),m[793]]})]}),(0,d.jsx)("button",{className:"ftue-button ftue-button-primary",onClick:()=>T(!1),disabled:0===w.length,children:m[794]})]})]})]})}):!1===(null===f||void 0===f?void 0:f.showModal)?null:(0,d.jsx)(iu,{isOpen:!0,onClose:k,symbol:(null===n||void 0===n?void 0:n.icon)||"\ud83d\ude00",dialogKey:f.bodyKey,relationshipType:"FTUE",username:null===n||void 0===n?void 0:n.username}):null};var cu=n(7950);const du=e=>{let{doinkerTargets:n,doinkerType:r="resource",TILE_SIZE:o,visible:a,gridId:s,activePanel:i}=e;const[l,c]=(0,t.useState)([]),[u,h]=(0,t.useState)(null);if((0,t.useEffect)((()=>{if(!n||!a||"button"===r)return void c([]);const e=Array.isArray(n)?n:[n],t=()=>{const t=[];for(const n of e){let e=!1;const r=zc.default.getResources();if(r&&r.length>0){const o=r.find((e=>e.type===n));o&&(t.push({x:o.x,y:o.y,size:o.size||1,source:"resource",targetName:n}),e=!0)}if(!e&&s){const r=Fc.Ay.getNPCsInGrid(s);if(r&&Object.keys(r).length>0){const o=Object.values(r).find((e=>e.type===n));o&&o.position&&(t.push({x:o.position.x,y:o.position.y,size:1,source:"npc",targetName:n}),e=!0)}}}return t},o=t();o.length>0&&c(o);const i=setInterval((()=>{const e=t();c((t=>e.length!==t.length||e.some(((e,n)=>{const r=t[n];return!r||r.x!==e.x||r.y!==e.y||r.targetName!==e.targetName}))?e:t))}),500);return()=>clearInterval(i)}),[n,a,s,r]),(0,t.useEffect)((()=>{if("button"!==r||!a||!i||"string"!==typeof n)return void h(null);const e=()=>{const e=document.querySelector(`[data-panel-name="${i}"]`);if(!e)return null;const t=e.querySelector(n);if(!t)return null;const r=t.getBoundingClientRect();return{x:r.left+r.width/2,y:r.top,width:r.width,height:r.height}},t=e();t&&h(t);const o=setInterval((()=>{const t=e();h(t)}),500);return()=>clearInterval(o)}),[r,n,a,i]),!a)return null;if("button"===r){if(!u)return null}else if(0===l.length)return null;if("button"===r&&u){const e=40,t=30;return(0,cu.createPortal)((0,d.jsx)("div",{className:"ftue-doinker-button",style:{left:u.x-t/2+"px",top:u.y-e-10+"px",width:`${t}px`,height:`${e}px`},children:(0,d.jsxs)("svg",{width:t,height:e,viewBox:"0 0 40 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"ftue-doinker-arrow",children:[(0,d.jsx)("path",{d:"M15 0 L15 35 L5 35 L20 60 L35 35 L25 35 L25 0 Z",fill:"#e53935",stroke:"#b71c1c",strokeWidth:"2"}),(0,d.jsx)("path",{d:"M17 2 L17 33 L20 33 L20 2 Z",fill:"#ff6f60",opacity:"0.6"})]})},"doinker-button"),document.body)}return(0,d.jsx)(d.Fragment,{children:l.map(((e,t)=>{const n=(e.size-1)/2,r=(e.x+n+.5)*o,a=(e.y-n+.5)*o,s=Math.max(30,.8*o),i=Math.max(20,.5*o);return(0,d.jsx)("div",{className:"ftue-doinker",style:{left:`${r}px`,top:a-s-10+"px",width:`${i}px`,height:`${s}px`},children:(0,d.jsxs)("svg",{width:i,height:s,viewBox:"0 0 40 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"ftue-doinker-arrow",children:[(0,d.jsx)("path",{d:"M15 0 L15 35 L5 35 L20 60 L35 35 L25 35 L25 0 Z",fill:"#e53935",stroke:"#b71c1c",strokeWidth:"2"}),(0,d.jsx)("path",{d:"M17 2 L17 33 L20 33 L20 2 Z",fill:"#ff6f60",opacity:"0.6"})]})},`doinker-${e.targetName}-${t}`)}))})},uu=(0,t.createContext)(),hu=(0,t.createContext)();function pu(e){let{children:n}=e;const[r,o]=(0,t.useState)({});return(0,d.jsx)(uu.Provider,{value:r,children:(0,d.jsx)(hu.Provider,{value:o,children:n})})}const mu=(0,t.createContext)(),fu=(0,t.createContext)();function gu(e){let{children:n}=e;const[r,o]=(0,t.useState)({});return(0,d.jsx)(mu.Provider,{value:r,children:(0,d.jsx)(fu.Provider,{value:o,children:n})})}const yu=new class{constructor(){this.controlledGrids=new Map,this.setupSocketListeners(),this.retryTimeout=null}setupSocketListeners(){i.Ay.on("npc-controller-assigned",(e=>{let{gridId:t}=e;console.log(`\ud83c\udfae Assigned as NPC controller for grid ${t}`),this.setAsController(t)})),i.Ay.on("npc-controller-revoked",(e=>{let{gridId:t}=e;console.log(`\ud83c\udfae Revoked as NPC controller for grid ${t}`),this.removeController(t)})),i.Ay.on("npc-controller-update",(e=>{let{controllerUsername:t,gridId:n}=e;console.log(`\ud83c\udfae Controller update received for ${n}: ${t}`);const r=JSON.parse(localStorage.getItem("player"));t&&(null===r||void 0===r?void 0:r.username)===t?this.setAsController(n):this.removeController(n)})),i.Ay.on("connect",(()=>{console.log("\ud83d\udd0c NPCController socket connected")})),i.Ay.on("disconnect",(()=>{console.log("\ud83d\udd0c NPCController socket disconnected")})),i.Ay.on("join-grid-controller-response",(e=>{let{success:t,gridId:n}=e;console.log(`\ud83d\udce1 Received controller join response: success=${t}, gridId=${n}`)}))}joinGrid(e){if(!i.Ay.connected)return console.log("\u23f3 Socket not ready, retrying controller join in 1s..."),clearTimeout(this.retryTimeout),void(this.retryTimeout=setTimeout((()=>this.joinGrid(e)),1e3));console.log(`\ud83c\udfae Requesting controller status for grid ${e}`),i.Ay.emit("join-grid-controller",{gridId:e,timestamp:Date.now()})}leaveGrid(e){console.log(`\ud83c\udfae Leaving grid ${e}`),i.Ay.emit("leave-grid-controller",{gridId:e}),this.removeController(e)}setAsController(e){console.log(`\ud83c\udfae Setting controller status for grid ${e}`),this.controlledGrids.set(e,{isController:!0}),console.log("\ud83d\udd0d Controller Map after set:",Array.from(this.controlledGrids.entries()));const t=Fc.Ay.getNPCsInGrid(e);null!==t&&void 0!==t&&t.npcs&&Object.values(t.npcs).forEach((e=>{"function"===typeof e.update&&e.update(Date.now(),t)}))}removeController(e){this.controlledGrids.delete(e),console.log(`\ud83c\udfae Removed controller for grid ${e}`),console.log("\ud83d\udd0d Controller Map after remove:",Array.from(this.controlledGrids.entries()))}isControllingGrid(e){const t=this.controlledGrids.get(e);return!0===(null===t||void 0===t?void 0:t.isController)}},vu=(0,t.createContext)(),bu=e=>{let{children:n}=e;const o=(0,r.k)(),[a,s]=(0,t.useState)([]),i=t.useRef(0);return(0,d.jsx)(vu.Provider,{value:{messages:a,updateStatus:e=>{let t="";if("number"===typeof e){const n=o[e];if(!n)return void console.warn(`No string found for index ${e}. Falling back to default.`);t=n}else{if("string"!==typeof e)return void console.warn("Invalid status message input. Falling back to default.");t=e}const n={id:i.current++,text:t};s((e=>[n,...e]))}},children:n})},xu=()=>{const{messages:e}=t.useContext(vu),[n,r]=t.useState([]),[o,a]=t.useState(0),[s,i]=t.useState(0),[l,c]=t.useState(!1),u=t.useRef(null),h=t.useRef(null),p=t.useRef(null),m=t.useRef(null);t.useEffect((()=>{var t;if(0===e.length)return r([]),a(0),void i(0);const n=null===(t=e[0])||void 0===t?void 0:t.id;if(null===u.current){var o;i(0);const t=(null===(o=h.current)||void 0===o?void 0:o.offsetWidth)||200;a(-t),r(e),requestAnimationFrame((()=>{requestAnimationFrame((()=>{a(0)}))}))}else if(n!==u.current){var s;i(0);const t=(null===(s=h.current)||void 0===s?void 0:s.offsetWidth)||200;a(-t),r(e),requestAnimationFrame((()=>{requestAnimationFrame((()=>{a(0)}))}))}else r(e);u.current=n}),[e]),t.useEffect((()=>{if(p.current&&m.current){const e=p.current.scrollWidth,t=m.current.offsetWidth;c(s<e-t&&e>t)}}),[s,n]);return(0,d.jsxs)("div",{className:"status-bar",children:[s>0&&(0,d.jsx)("button",{className:"status-bar-arrow status-bar-arrow-left",onClick:()=>{var e;const t=(null===(e=m.current)||void 0===e?void 0:e.offsetWidth)||window.innerWidth,n=Math.max(s-t,0);i(n)},"aria-label":"Scroll left",children:"\u25c0"}),(0,d.jsxs)("div",{className:"status-bar-viewport",ref:m,children:[e.length>0&&e[0].id!==u.current&&(0,d.jsxs)("div",{style:{position:"absolute",visibility:"hidden",whiteSpace:"nowrap"},children:[(0,d.jsx)("span",{ref:h,className:"status-message",children:e[0].text}),(0,d.jsx)("span",{className:"status-separator",children:"\xa0\xa0\u2b25\xa0\xa0"})]}),(0,d.jsx)("div",{ref:p,className:"status-bar-messages",style:{transform:`translateX(${o-s}px)`,transition:0===o&&0===s?"transform 0.5s ease-out":0!==s?"transform 0.3s ease-out":"none"},children:n.map(((e,r)=>(0,d.jsxs)(t.Fragment,{children:[(0,d.jsx)("span",{className:"status-message",children:e.text}),r<n.length-1&&(0,d.jsx)("span",{className:"status-separator",children:"\xa0\xa0\u2b25\xa0\xa0"})]},e.id)))})]}),l&&(0,d.jsx)("button",{className:"status-bar-arrow status-bar-arrow-right",onClick:()=>{if(p.current&&m.current){const e=p.current.scrollWidth,t=m.current.offsetWidth,n=e-t,r=Math.min(s+t,n);i(r)}},"aria-label":"Scroll right",children:"\u25b6"})]})},wu=JSON.parse('{"homesteadOccupied":[["","","","","","","",""],["Homestead owned by:","","","","","","",""],["\ud83d\udc64","username","","","","","",""],["\ud83c\udfdb\ufe0f","role","","","","","",""],["\ud83d\udcb0","netWorth","","","","","",""],["","","","","","","",""],["\ud83d\udce5 Trade:","","","","","","",""],["","","","","","","",""],["","","","","","","",""]],"homesteadEmpty":[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]],"town":[["","","","","","","",""],["Town","","","","","","",""],["","\u2694\ufe0f","","\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf73","\ud83e\uddd5","","\ud83e\udddd",""],["","\ud83d\udee1\ufe0f","\ud83c\udfaa","\ud83d\udd2c","\ud83c\udfa8","","\ud83d\udc69\u200d\ud83e\uddb0",""],["","\ud83d\udc68\ud83c\udffb\u200d\ud83c\udfed","","","","","",""],["","\ud83c\udfe6","\ud83d\ude82","\ud83c\udfdb\ufe0f","\ud83c\udfea","","\ud83d\udc78",""],["","\ud83e\udd77","","\u26fa\ufe0f","","","\ud83d\uded5",""],["","","","","","","",""]],"reserved":[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]],"valley0":[["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"]],"valley1":[["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"]],"valley2":[["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"]],"valley3":[["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"]]}'),Su=(0,t.createContext)(),Tu=e=>{let{children:n}=e;const[r,o]=(0,t.useState)({});return(0,d.jsx)(Su.Provider,{value:{activeBulkOperations:r,startBulkOperation:(e,t)=>{o((n=>({...n,[t]:{type:e,startTime:Date.now(),active:!0}})))},endBulkOperation:e=>{o((t=>{const n={...t};return delete n[e],n}))},isAnyBulkOperationActive:()=>Object.keys(r).length>0,getActiveBulkOperations:()=>Object.entries(r).map((e=>{let[t,n]=e;return{id:t,...n}}))},children:n})},Cu=()=>{const e=(0,t.useContext)(Su);if(!e)throw new Error("useBulkOperation must be used within a BulkOperationProvider");return e},ku=e=>{switch(e){case"homestead":case"homesteadSet":case"homesteadSetN":case"homesteadSetNE":case"homesteadSetE":case"homesteadSetSE":case"homesteadSetS":case"homesteadSetSW":case"homesteadSetW":case"homesteadSetNW":return"var(--homestead-color)";case"valley0":case"valley1":case"valley2":case"valley3":case"valley0Set":case"valley1Set":case"valley2Set":case"valley3Set":return"var(--valley-color)";case"reserved":return"var(--reserved-color)";case"town":return"var(--town-color)";default:return"var(--unknown-color)"}};var Au=n(9804);const Iu={...f,unknown:"#808080"},Eu=64;const Pu=(0,t.memo)((e=>{let{encodedTiles:n,size:r=64,className:o="",style:a={}}=e;const s=(0,t.useRef)(null);return(0,t.useEffect)((()=>{const e=s.current;if(!e||!n)return;const t=function(e){if("string"!==typeof e||0===e.length)return null;try{const t=atob(e),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));const r=[];let o=0,a=0;for(const e of n)for(o=o<<8|e,a+=8;a>=4&&r.length<4096;){const e=g[o>>a-4&15]||"unknown";r.push(e),a-=4,o&=(1<<a)-1}for(;r.length<4096;)r.push("g");const s=[];for(let e=0;e<Eu;e++){const t=[];for(let n=0;n<Eu;n++){const o=e*Eu+n;t.push(r[o])}s.push(t)}return s}catch(t){return console.error("Error decoding tiles:",t),null}}(n);if(!t)return;const o=e.getContext("2d"),a=r/Eu;if(o.clearRect(0,0,r,r),a<1){const e=document.createElement("canvas");e.width=Eu,e.height=Eu;const n=e.getContext("2d");for(let r=0;r<Eu;r++)for(let e=0;e<Eu;e++){const o=t[r][e];n.fillStyle=Iu[o]||Iu.unknown,n.fillRect(e,r,1,1)}o.imageSmoothingEnabled=!0,o.drawImage(e,0,0,r,r)}else for(let n=0;n<Eu;n++)for(let e=0;e<Eu;e++){const r=t[n][e];o.fillStyle=Iu[r]||Iu.unknown,o.fillRect(e*a,n*a,a,a)}}),[n,r]),n?(0,d.jsx)("canvas",{ref:s,width:r,height:r,className:o,style:{imageRendering:"pixelated",...a}}):(0,d.jsx)("canvas",{ref:s,width:r,height:r,className:o,style:{backgroundColor:Iu.g,...a}})}));Pu.displayName="RenderVisitedGrid";const _u=Pu;const Nu=e=>{var n;let{currentPlayer:r,isDeveloper:o,setZoomLevel:i,isRelocating:l,setIsRelocating:c,setCurrentPlayer:u,setGridId:h,setGrid:p,setResources:m,setTileTypes:f,TILE_SIZE:g,masterResources:y,closeAllPanels:v,visibleSettlementId:b,setVisibleSettlementId:x}=e;const[w,S]=(0,t.useState)([]),[T,C]=(0,t.useState)(new Map),[k,A]=(0,t.useState)(null),[I,E]=(0,t.useState)({}),[P,_]=(0,t.useState)({}),[N,R]=(0,t.useState)({}),[M,j]=(0,t.useState)({visible:!1,content:"",x:0,y:0}),{updateStatus:D}=(0,t.useContext)(vu),O=Cu();if(T){w.flat().map((e=>e.ownerId)).filter(Boolean).filter((e=>!T.get(e)))}(0,t.useEffect)((()=>{(async()=>{try{console.log("\ud83d\udce6 Fetching settlement bundle for ID:",b);const n=await a.A.post(`${s.A}/api/get-settlement-bundle`,{settlementId:b});console.log("\u2705 Settlement bundle response:",n.data);const{gridStates:r,players:o,settlement:i}=n.data,l={};if(Array.isArray(o))for(const e of o)l[e._id]=e;E(r||{}),C(new Map(Object.entries(l||{}))),S((null===i||void 0===i?void 0:i.grids)||[]),console.log("\ud83d\udcd0 Settlement grid set:",null===i||void 0===i?void 0:i.grids);const c=((null===i||void 0===i?void 0:i.grids)||[]).flat().map((e=>e.gridId)).filter(Boolean),d=await a.A.post(`${s.A}/api/get-multiple-grid-states`,{gridIds:c}),u={};for(const a in d.data){var e,t;const n=(null===(e=d.data[a])||void 0===e||null===(t=e.playersInGrid)||void 0===t?void 0:t.pcs)||{};u[a]=n}_(u)}catch(n){console.error("Error fetching settlement bundle:",n),A("Failed to fetch settlement data")}})()}),[b]),(0,t.useEffect)((()=>{l&&D(125)}),[l]),(0,t.useEffect)((()=>{(async()=>{if(!w.length||null===r||void 0===r||!r.gridsVisited||!b)return;const e=(0,Au.BE)(r.gridsVisited),t=w.flat().filter((e=>void 0!==e.gridCoord&&e.gridId)).filter((t=>e.includes(t.gridCoord%1e4))).map((e=>e.gridCoord));if(0!==t.length)try{const e=await a.A.post(`${s.A}/api/grids-tiles`,{settlementId:b,gridCoords:t});e.data.success&&e.data.tilesMap&&(R(e.data.tilesMap),console.log(`\ud83d\udccd Fetched tiles for ${Object.keys(e.data.tilesMap).length} visited grids`))}catch(n){console.error("Error fetching visited grid tiles:",n)}})()}),[w,null===r||void 0===r?void 0:r.gridsVisited,b]),(0,t.useEffect)((()=>{var e;w.length>0&&null!==r&&void 0!==r&&null!==(e=r.location)&&void 0!==e&&e.g&&setTimeout((()=>{!function(e,t){var n;if(null===e||void 0===e||null===(n=e.location)||void 0===n||!n.g||!t||0===t.length)return void console.warn("Cannot center camera: missing player location or settlement grid");const r=e.location.g;let o=-1,a=-1;for(let i=0;i<t.length;i++){for(let e=0;e<t[i].length;e++){var s;if((null===(s=t[i][e])||void 0===s?void 0:s.gridId)===r){o=i,a=e;break}}if(-1!==o)break}-1!==o&&-1!==a?requestAnimationFrame((()=>{const e=document.querySelectorAll(".settlement-tile")[8*o+a];e?(e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),setTimeout((()=>{const t=e.getBoundingClientRect();if(!(t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth)){const e=t.left+t.width/2,n=t.top+t.height/2,r=window.innerWidth/2,o=window.innerHeight/2,a=window.scrollX+(e-r),s=window.scrollY+(n-o);window.scrollTo({left:Math.max(0,a),top:Math.max(0,s),behavior:"smooth"})}}),500)):console.warn("Player tile element not found")})):console.warn(`Player's grid ${r} not found in settlement`)}(r,w)}),300)}),[w,null===r||void 0===r||null===(n=r.location)||void 0===n?void 0:n.g]);const B=async(e,t)=>{if(console.log("Clicked tile:",e),e.settlementId&&e.settlementId!==b)return console.log("Switching visible settlement to:",e.settlementId),void x(e.settlementId);if(l)return"homestead"!==e.gridType?void D(123):1!=e.available?void D(124):void(!0===e.available&&((async(e,t,n,r,o)=>{console.log("At processRelocation; fromGridId =",n,"; targetGridCoord =",r),console.log("settlementGrid =",o);try{const o=await a.A.post(`${s.A}/api/relocate-homestead`,{fromGridId:n,targetGridCoord:r});try{console.log("\ud83d\udd04 Fetching updated player data...");const n=await a.A.get(`${s.A}/api/player/${e.playerId}`);console.log("\ud83d\udcca Updated player object:",n.data),n.data&&(t(n.data),localStorage.setItem("player",JSON.stringify(n.data)),console.log("\u2705 setCurrentPlayer + localStorage update complete"))}catch(k){console.error("\u274c Failed to refresh player data after relocation:",k)}return console.log("\u2705 Relocation successful:",o.data),o.data}catch(k){var i,l;return console.error("\u274c Relocation failed:",(null===(i=k.response)||void 0===i?void 0:i.data)||k.message),{success:!1,error:(null===(l=k.response)||void 0===l?void 0:l.data)||k.message}}})(r,u,r.gridId,e.gridCoord,w),c(!1),i("close"),D(121)));if(e.gridId===r.location.g){var n;if(i("far"),["valley0","valley1","valley2","valley3"].includes(e.gridType))D(16);else if("town"===e.gridType)D(111);else{const{username:e,gridType:t}=await(0,Oc.qJ)(r.location.g);await(0,Gc.qh)(t,e,D,r,r.location.g)}let o=null,a=null;return o=$c.default.getPlayersInGrid(e.gridId),a=null===(n=o)||void 0===n?void 0:n[r.playerId],void(0,$d.V5)(a.position,t)}if(o)try{let n=0,o=0;if("town"===e.gridType){console.log("\ud83c\udfd8\ufe0f Clicking on town grid, fetching Train location...");const t=await(0,Oc.f0)(e.gridId);n=t.x,o=t.y}else if("homestead"===e.gridType){console.log("\ud83c\udfe0 Clicking on homestead grid, fetching Signpost Town location...");const t=await(0,Oc.FV)(e.gridId);n=t.x,o=t.y}const a={x:n,y:o,g:e.gridId,s:r.location.s,f:r.location.f,gtype:e.gridType||"unknown",gridCoord:e.gridCoord||0};console.log("Built toLocation object:",a),console.log("About to call changePlayerLocation from SettlementView;  current player = ",r,"toLocatoin = ",a),await(0,Gc.t3)(r,r.location,a,u,h,p,f,m,t,v,D,O,y,null,null)}catch(k){console.error("Error changing player location:",k),D(10)}else console.log("\ud83d\udeab SettlementView travel disabled for non-developers")},L=(e,t)=>{const n=(e=>{if(!e.gridId)return"";const t=P[e.gridId];return t&&0!==Object.keys(t).length?Object.values(t).map((e=>`${e.username||"Unknown"}: ${e.hp||0} HP`)).join("\n"):""})(t);n&&j({visible:!0,content:n,x:e.clientX,y:e.clientY})},F=()=>{j((e=>({...e,visible:!1})))},$=e=>{let t=e.gridType;"homestead"===t&&(t=e.available?"homesteadEmpty":"homesteadOccupied");const n=wu[t]||Array(8).fill(Array(8).fill("")),o=e.gridId===r.location.g;let a=null;if(e.ownerId&&T){const t="object"===typeof e.ownerId?e.ownerId._id:e.ownerId;a=T.get(t)}e.ownerId;let s=0,i=0;const l=["valley0","valley1","valley2","valley3"].includes(t),c=l||"town"===t;let u=null,h=null;var p,m;o&&l&&e.gridId&&(u=$c.default.getPlayersInGrid(e.gridId),h=null===(p=u)||void 0===p?void 0:p[r.playerId],null!==(m=h)&&void 0!==m&&m.position&&(s=Math.floor(h.position.x/8),i=Math.floor(h.position.y/8)));const f=void 0!==e.gridCoord&&N[e.gridCoord],g=void 0!==e.gridCoord&&(0,Au.isGridVisited)(r.gridsVisited,e.gridCoord);return c&&f?(0,d.jsxs)("div",{className:"mini-cell",style:{position:"relative",width:"100%",height:"100%"},children:[(0,d.jsx)(_u,{encodedTiles:N[e.gridCoord],size:64,className:"visited-grid-canvas",style:{width:"100%",height:"100%",display:"block"}}),o&&(0,d.jsx)("div",{style:{position:"absolute",top:i/8*100+"%",left:s/8*100+"%",width:"12.5%",height:"12.5%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.9em",zIndex:1},children:r.icon})]}):c&&g&&!f?(0,d.jsx)("div",{className:"mini-cell",style:{position:"relative",width:"100%",height:"100%",backgroundColor:"var(--valley-visited-color)"},children:o&&(0,d.jsx)("div",{style:{position:"absolute",top:i/8*100+"%",left:s/8*100+"%",width:"12.5%",height:"12.5%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.6em",zIndex:1},children:r.icon})}):(0,d.jsx)("div",{className:"mini-grid",children:n.map(((e,n)=>e.map(((e,c)=>{let u=e;if((o&&l&&n===i&&c===s||o&&!l&&0===n&&0===c)&&(u=r.icon),"homesteadOccupied"===t)if(7===n&&c<6){if(a&&Array.isArray(a.tradeStall)){const e=a.tradeStall[c];if(null!==e&&void 0!==e&&e.resource&&(null===e||void 0===e||!e.boughtBy)){const t=y.find((t=>t.type===e.resource));null!==t&&void 0!==t&&t.symbol&&(u=t.symbol)}}}else if("username"===e){var h;u=(null===(h=a)||void 0===h?void 0:h.username)||""}else if("role"===e){var p;u=(null===(p=a)||void 0===p?void 0:p.role)||"Citizen"}else if("netWorth"===e){var m,f;u=`${(null===(m=a)||void 0===m||null===(f=m.netWorth)||void 0===f?void 0:f.toLocaleString())||"0"} (net worth)`}let g="";return"username"===e&&u&&(g="username-text"),"role"===e&&"Mayor"===u&&(g="mayor-text"),o&&u===r.icon&&(g="player-icon-current"),(0,d.jsx)("div",{className:"mini-cell",children:(0,d.jsx)("span",{className:g,children:u})},`${n}-${c}`)}))))})};return k?(0,d.jsxs)("div",{children:["Error: ",k]}):w.length?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"settlement-grid",children:w.map(((e,t)=>e.map(((e,n)=>(0,d.jsx)("div",{className:"settlement-tile",style:{backgroundColor:ku(e.gridType)},onClick:()=>B(e,g),onMouseMove:t=>L(t,e),onMouseLeave:F,children:$(e)},`${t}-${n}`)))))}),M.visible&&M.content&&(0,d.jsxs)("div",{className:"settlement-tooltip",style:{position:"fixed",left:M.x+12,top:M.y-10,transform:"translateY(-100%)",pointerEvents:"none"},children:[(0,d.jsx)("p",{children:"Who's Here:"}),M.content]})]}):(0,d.jsx)("div",{children:"Loading Settlement Grid..."})},Ru=JSON.parse('{"homesteadSet":[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]],"valley0Set":[["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"]],"valley1Set":[["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"],["\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33","\ud83c\udf33"]],"valley2Set":[["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"]],"valley3Set":[["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"],["\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32","\ud83c\udf32"]]}'),Mu=e=>{let{currentPlayer:n,isDeveloper:o,setZoomLevel:i,isRelocating:l,setIsRelocating:c,setCurrentPlayer:u,setGridId:p,setGrid:m,setResources:f,setTileTypes:g,TILE_SIZE:y,closeAllPanels:v,visibleSettlementId:b,setVisibleSettlementId:x,masterResources:w,masterTrophies:S}=e;const[T,C]=(0,t.useState)([]),[k,A]=(0,t.useState)({}),[I,E]=(0,t.useState)(null),{updateStatus:P}=(0,t.useContext)(vu),_=Cu(),N=(0,r.k)();(0,t.useEffect)((()=>{(async()=>{try{const e=await a.A.get(`${s.A}/api/frontier-bundle/${n.location.f}?playerSettlementId=${n.location.s}`),{frontierGrid:t,settlementGrids:r={}}=e.data;C(t);A(r)}catch(e){console.error("Error fetching frontier bundle:",e),E("Failed to fetch grid data")}})()}),[n.location.f]),(0,t.useEffect)((()=>{l&&P(125)}),[l]),(0,t.useEffect)((()=>{null!==n&&void 0!==n&&n.playerId&&N&&S&&(async()=>{var e;if(null===(e=n.trophies)||void 0===e?void 0:e.some((e=>"SawFrontierTip"===e.name)))console.log("\ud83d\udd07 Player already has SawFrontierTip trophy - skipping notification");else{console.log('\ud83c\udfc6 First time in Frontier view - awarding "SawFrontierTip" trophy');try{await(0,qc.p)(n.playerId,"SawFrontierTip",1,n,S,u),(0,h.D)("Tip",{title:N[7001],message:N[7020]}),console.log("\u2705 Frontier tip shown and trophy awarded")}catch(I){console.error("\u274c Error awarding SawFrontierTip trophy:",I),(0,h.D)("Tip",{title:N[7001],message:N[7020]})}}})()}),[null===n||void 0===n?void 0:n.playerId,N,S]);const R=(e,t,r)=>{var o,a;const s=Ru[e.settlementType]||Array(8).fill(Array(8).fill("")),i=((null===(o=k[e.settlementId])||void 0===o?void 0:o.grid)||[]).flat(),l=["valley0Set","valley1Set","valley2Set","valley3Set"].includes(e.settlementType),c=null===(a=e.settlementType)||void 0===a?void 0:a.startsWith("homesteadSet");return(0,d.jsx)("div",{className:"mini-grid",children:s.map(((e,o)=>e.map(((e,a)=>{const s=i[8*o+a];let u=e,h=c?{backgroundColor:"var(--color-bg-dirt)"}:{},p=!1;null!==s&&void 0!==s&&s.gridType?p=["valley0","valley1","valley2","valley3"].includes(s.gridType):l&&(p=!0);const m=1e3*t+100*r+10*o+a,f=(0,Au.isGridVisited)(n.gridsVisited,m);return p&&f&&(h={backgroundColor:"var(--valley-visited-color)"},u=""),(null===s||void 0===s?void 0:s.gridId)&&s.gridId===n.location.g?u=n.icon:"homestead"!==(null===s||void 0===s?void 0:s.gridType)||s.available?"town"===(null===s||void 0===s?void 0:s.gridType)&&(u="\ud83d\ude82"):u="\ud83c\udfe0",(0,d.jsx)("div",{className:"mini-cell",style:h,children:(0,d.jsx)("span",{children:u})},`${o}-${a}`)}))))})};return I?(0,d.jsxs)("div",{children:["Error: ",I]}):T.length?(0,d.jsx)("div",{className:"frontier-grid",children:T.map(((e,t)=>e.map(((e,r)=>(0,d.jsx)("div",{className:"frontier-tile",style:{backgroundColor:ku(e.settlementType)},onClick:()=>(async e=>{if(console.log("\ud83c\udfaf Tile clicked:",e),console.log("\ud83d\udc64 Current player state:",{id:null===n||void 0===n?void 0:n._id,playerId:null===n||void 0===n?void 0:n.playerId,location:null===n||void 0===n?void 0:n.location,gridId:null===n||void 0===n?void 0:n.gridId}),l)return e.settlementType.startsWith("homesteadSet")?(e.settlementId&&x(e.settlementId),void i("settlement")):void P(122);try{if(!e.settlementId)return console.warn("\u274c Missing settlementId in clicked tile"),void P("Invalid destination");if(e.settlementId===n.location.s)return console.log("\ud83c\udfe0 Player clicked current settlement - zooming in"),i("settlement"),void P(12);if(e.settlementType.startsWith("homesteadSet")){try{const t=((await a.A.get(`${s.A}/api/get-settlement-grid/${e.settlementId}`)).data.grid||[]).flat().find((e=>"homestead"===e.gridType&&e.gridId===n.gridId));if(t){console.log("Traveling to owned homestead:",t);const r=await(0,Oc.FV)(t.gridId),o={x:r.x,y:r.y,g:t.gridId,s:e.settlementId,f:n.location.f,gtype:t.gridType,gridCoord:t.gridCoord};return await(0,Gc.t3)(n,n.location,o,u,p,m,g,f,y,v,P,_,w,N,null),void i("far")}}catch(I){return console.error("Error checking for owned homestead:",I),void P(8)}return void P(17)}if(["valley0Set","valley1Set","valley2Set","valley3Set"].includes(e.settlementType))return void P(9)}catch(I){var t,r;console.error("\u274c Transit error details:",{message:I.message,response:null===(t=I.response)||void 0===t?void 0:t.data,status:null===(r=I.response)||void 0===r?void 0:r.status,tile:e}),P(99)}})(e),children:R(e,t,r)},`${t}-${r}`)))))}):(0,d.jsx)("div",{children:"Loading Frontier Grid..."})};var ju=n(6704);const Du=e=>{var n,r,o,a,s,i,l,c,u,h;let{currentPlayer:p,strings:m,setCurrentPlayer:f,setGridId:g,setGrid:y,setTileTypes:v,setResources:b,updateStatus:x,TILE_SIZE:w,closeAllPanels:S,bulkOperationContext:T,masterResources:C,masterTrophies:k,transitionFadeControl:A,timers:I,countdowns:E}=e;const P=(0,t.useMemo)((()=>{var e;if(null===p||void 0===p||null===(e=p.location)||void 0===e||!e.gridCoord)return null;const t=p.location.gridCoord;console.log("\ud83d\uddfa\ufe0f Calculating position from gridCoord:",t);const n=t.toString().padStart(8,"0"),r=parseInt(n[4],10),o=parseInt(n[5],10),a=parseInt(n[6],10),s=parseInt(n[7],10),i=8*r+a,l=8*o+s;return console.log("\ud83d\uddfa\ufe0f Parsed gridCoord:",{gridCoord:n,settlementRow:r,settlementCol:o,gridRow:a,gridCol:s,finalRow:i,finalCol:l}),{row:i,col:l}}),[null===p||void 0===p||null===(n=p.location)||void 0===n?void 0:n.gridCoord]),_=(0,t.useMemo)((()=>{if(null===p||void 0===p||!p.homesteadGridCoord)return null;const e=p.homesteadGridCoord;console.log("\ud83c\udfe0 Calculating homestead position from gridCoord:",e);const t=e.toString().padStart(8,"0"),n=parseInt(t[4],10),r=parseInt(t[5],10),o=parseInt(t[6],10),a=parseInt(t[7],10),s=8*n+o,i=8*r+a;return console.log("\ud83c\udfe0 Parsed homestead gridCoord:",{gridCoord:t,settlementRow:n,settlementCol:r,gridRow:o,gridCol:a,finalRow:s,finalCol:i}),{row:s,col:i}}),[null===p||void 0===p?void 0:p.homesteadGridCoord]),N="dungeon"===(null===p||void 0===p||null===(r=p.location)||void 0===r?void 0:r.gtype),R=(0,t.useMemo)((()=>{var e,t;return"town"===(null===p||void 0===p||null===(e=p.location)||void 0===e?void 0:e.gtype)&&(!(null===p||void 0===p||null===(t=p.location)||void 0===t||!t.s||null===p||void 0===p||!p.settlementId)&&p.location.s.toString()===p.settlementId.toString())}),[null===p||void 0===p||null===(o=p.location)||void 0===o?void 0:o.gtype,null===p||void 0===p||null===(a=p.location)||void 0===a?void 0:a.s,null===p||void 0===p?void 0:p.settlementId]),M=(0,t.useMemo)((()=>{const e=[];for(let t=0;t<64;t++){const n=[];for(let e=0;e<64;e++){const r=P&&P.row===t&&P.col===e,o=_&&_.row===t&&_.col===e;n.push({row:t,col:e,isPlayer:r,isHomestead:o,key:`${t}-${e}`})}e.push(n)}return e}),[P,_]),j=null===p||void 0===p||null===(s=p.location)||void 0===s?void 0:s.region,D=(0,t.useMemo)((()=>{var e,t,n,r;if(N)return m[10186]||"In a Dungeon";if(j)return j;if(null!==p&&void 0!==p&&null!==(e=p.location)&&void 0!==e&&e.g&&null!==p&&void 0!==p&&p.gridId){if(p.location.g.toString()===p.gridId.toString())return m[107]||"Your Homestead"}if("town"===(null===p||void 0===p||null===(t=p.location)||void 0===t?void 0:t.gtype)&&null!==p&&void 0!==p&&null!==(n=p.location)&&void 0!==n&&n.s&&null!==p&&void 0!==p&&p.settlementId){if(p.location.s.toString()===p.settlementId.toString())return m[108]||"Your Town"}const o=null===p||void 0===p||null===(r=p.location)||void 0===r?void 0:r.gtype;return["valley0","valley1","valley2","valley3"].includes(o)?m[10184]||"The Valley":m[2]||"Map"}),[N,j,null===p||void 0===p||null===(i=p.location)||void 0===i?void 0:i.g,null===p||void 0===p?void 0:p.gridId,null===p||void 0===p||null===(l=p.location)||void 0===l?void 0:l.gtype,null===p||void 0===p||null===(c=p.location)||void 0===c?void 0:c.s,null===p||void 0===p?void 0:p.settlementId,m]);return(0,d.jsxs)("div",{className:"frontier-mini-map",children:[(0,d.jsx)("h3",{style:{textAlign:"center",fontFamily:"Berkshire Swash",margin:"0 0 8px 0"},children:D}),(0,d.jsxs)("div",{className:"mini-map-row-container",children:[(0,d.jsx)("div",{className:"minimap-button-column home-column",children:!N&&(0,d.jsx)("span",{className:"minimap-signpost-button",onClick:()=>(0,ju.handleTransitSignpost)(p,"Signpost Home",f,g,y,v,b,x,w,p.skills,S,T,C,m,k,A),title:m&&m[107]?m[107]:"Go Home",children:"\ud83c\udfe0"})}),(0,d.jsx)("div",{className:"mini-map-grid",children:M.map(((e,t)=>(0,d.jsx)("div",{className:"mini-map-row",children:e.map((e=>{let t="default-cell",n=`Grid (${e.row}, ${e.col})`;return e.isPlayer?(t="player-cell",n=`You are here (${e.row}, ${e.col})`):e.isHomestead&&(t="homestead-cell",n=`Your homestead (${e.row}, ${e.col})`),(0,d.jsx)("div",{className:`mini-map-cell ${t}`,title:n},e.key)}))},t)))}),(0,d.jsx)("div",{className:"minimap-button-column town-column",children:!N&&(0,d.jsx)("span",{className:"minimap-signpost-button"+(R?" disabled":""),onClick:R?void 0:()=>(0,ju.handleTransitSignpost)(p,"Signpost Town Home",f,g,y,v,b,x,w,p.skills,S,T,C,m,k,A),title:m&&m[108]?m[108]:"Go to Town",style:R?{opacity:.4,cursor:"default"}:void 0,children:"\ud83c\udfdb\ufe0f"})})]}),N&&"695bd5b76545a9be8a36ee22"!==(null===p||void 0===p||null===(u=p.location)||void 0===u||null===(h=u.g)||void 0===h?void 0:h.toString())&&(0,d.jsx)("div",{className:"mini-map-dungeon-info",children:((e,t,n)=>{const r=(null===E||void 0===E?void 0:E.dungeon)||"--:--:--",o=(null===(e=r.match(/(\d+)d/))||void 0===e?void 0:e[1])||"0",a=(null===(t=r.match(/(\d+)h/))||void 0===t?void 0:t[1])||"0",s=(null===(n=r.match(/(\d+)m/))||void 0===n?void 0:n[1])||"0",i=0===parseInt(o,10)&&0===parseInt(a,10)&&0===parseInt(s,10);return(0,d.jsxs)("span",{style:{color:i?"#a71616ff":"inherit",fontWeight:i?"bold":"normal"},children:["Dungeon closes in ",r]})})()})]})};const Ou=function(e){let{isOpen:t=!0,onClose:n,title:r,children:o,custom:a,message:s,message2:i,size:l="standard",className:c}=e;return t?(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:`modal-container ${"small"===l?"modal-small":""} ${c||""}`,children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:n,children:"\xd7"}),r&&(0,d.jsx)("h2",{className:"modal-title",children:r}),(0,d.jsxs)("div",{className:"modal-content",children:[s&&(0,d.jsx)("p",{className:"modal-message",children:s}),i&&(0,d.jsx)("p",{className:"modal-message",children:i}),o,a]})]})}):null};var Bu,Lu="basil",Fu="https://js.stripe.com",$u="".concat(Fu,"/").concat(Lu,"/stripe.js"),Gu=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,zu=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,Uu="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Hu=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat($u).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n},qu=null,Vu=null,Wu=null,Yu=function(e){return null!==qu?qu:(qu=new Promise((function(t,n){if("undefined"!==typeof window&&"undefined"!==typeof document)if(window.Stripe&&e&&console.warn(Uu),window.Stripe)t(window.Stripe);else try{var r=function(){for(var e,t=document.querySelectorAll('script[src^="'.concat(Fu,'"]')),n=0;n<t.length;n++){var r=t[n];if(e=r.src,Gu.test(e)||zu.test(e))return r}return null}();if(r&&e)console.warn(Uu);else if(r){if(r&&null!==Wu&&null!==Vu){var o;r.removeEventListener("load",Wu),r.removeEventListener("error",Vu),null===(o=r.parentNode)||void 0===o||o.removeChild(r),r=Hu(e)}}else r=Hu(e);Wu=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),Vu=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(n),r.addEventListener("load",Wu),r.addEventListener("error",Vu)}catch(a){return void n(a)}else t(null)}))).catch((function(e){return qu=null,Promise.reject(e)}))},Ku=!1,Xu=function(){return Bu||(Bu=Yu(null).catch((function(e){return Bu=null,Promise.reject(e)})))};Promise.resolve().then((function(){return Xu()})).catch((function(e){Ku||console.warn(e)}));var Zu=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ku=!0;var r=Date.now();return Xu().then((function(e){return function(e,t,n){if(null===e)return null;var r=t[0].match(/^pk_test/),o=function(e){return 3===e?"v3":e}(e.version),a=Lu;r&&o!==a&&console.warn("Stripe.js@".concat(o," was loaded on the page, but @stripe/stripe-js@").concat("7.4.0"," expected Stripe.js@").concat(a,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var s=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"7.4.0",startTime:t})}(s,n),s}(e,t,r)}))};const Ju=async(e,t,n)=>{try{var r;const o=await a.A.post(`${s.A}/api/create-checkout-session`,{playerId:t.playerId,offerId:e});if(null!==(r=o.data)&&void 0!==r&&r.id){const e=await Zu("pk_live_51ReZDs2Ldypb8mDE69ZKUaxZ5aUTW9PCLZUg8JPNmQmefLd4c8jy44ryZ19UZhsMVqOi7DU3RJ9qGdN5a5K2aOP2000ulybBFt");await e.redirectToCheckout({sessionId:o.data.id})}else n("\u274c Failed to initiate checkout.")}catch(o){console.error("\u274c Error initiating checkout:",o),n("\u274c Error initiating checkout.")}};const Qu=function(e){let{onClose:n,currentPlayer:o,setCurrentPlayer:i,resources:l,openMailbox:u,setModalContent:h,setIsModalOpen:p}=e;const m=(0,r.k)(),[f,g]=(0,t.useState)([]),{updateStatus:y}=(0,t.useContext)(vu);(0,t.useEffect)((()=>{const e=new URLSearchParams(window.location.search),t=e.get("purchase");console.log("\ud83d\udd0d URL query params:",{purchaseSuccess:t,playerId:e.get("playerId"),offerId:e.get("offerId")});const n=e.get("playerId"),r=e.get("offerId");if("success"===t&&n&&r){a.A.post(`${s.A}/api/purchase-store-offer`,{playerId:n,offerId:r}).then((()=>{console.log("\ud83d\udcec Called /api/purchase-store-offer successfully for:",{playerId:n,offerId:r}),console.log("\u2705 Store reward successfully delivered."),y("\ud83c\udf89 Purchase successful! Check your Inbox."),c(o,(()=>{}),"store",!1),a.A.get(`${s.A}/api/player/${n}`).then((e=>{i(e.data)})).catch((e=>{console.error("\u274c Failed to refresh player data:",e)}))})).catch((e=>{console.error("\ud83d\uded1 Error calling /api/purchase-store-offer with:",{playerId:n,offerId:r}),console.error("\u274c Failed to deliver store reward:",e),y("\u26a0\ufe0f Purchase may not have been delivered. Please contact support.")}));const e=new URL(window.location.href);e.search="",window.history.replaceState({},document.title,e.toString())}}),[]),(0,t.useEffect)((()=>{v()}),[]);const v=async()=>{try{const e=await a.A.get(`${s.A}/api/store-offers`);g(e.data||[])}catch(e){console.error("\u274c Failed to load store offers:",e)}};return(0,d.jsxs)(Ou,{onClose:e=>{null!==e&&void 0!==e&&e.openMailbox&&"function"===typeof u&&u(),n()},title:m[1701],children:[(0,d.jsx)("h3",{children:m[1702]}),(0,d.jsx)("h4",{children:m[1703]}),(0,d.jsx)("h4",{children:m[1704]}),(0,d.jsx)("div",{className:"store-offers",children:(()=>{const e=f.filter((e=>!(e=>{if(!e.shelflifeDays||null===o||void 0===o||!o.created)return!1;const t=new Date(o.created),n=new Date;return Math.floor((n-t)/864e5)>e.shelflifeDays})(e))),t=new Set;return e.map((n=>{if(t.has(n.id))return null;if(3===n.id||4===n.id){const n=e.find((e=>3===e.id)),r=e.find((e=>4===e.id));return n&&t.add(3),r&&t.add(4),(0,d.jsxs)("div",{className:"store-offer-row",children:[n&&(0,d.jsxs)("div",{className:"store-offer-card store-offer-card-half",children:[(0,d.jsxs)("div",{className:"store-offer-left",children:[(0,d.jsx)("h3",{children:n.title}),(0,d.jsx)("p",{children:n.body}),(0,d.jsx)("p",{className:"store-reward-line",children:n.rewards.map((e=>{var t;return`${(null===(t=l.find((t=>t.type===e.item)))||void 0===t?void 0:t.symbol)||""} ${e.qty} ${e.item}`})).join(", ")})]}),(0,d.jsxs)("div",{className:"store-offer-right",children:[(0,d.jsxs)("div",{className:"store-price",children:["USD $",n.price.toFixed(2)]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(n.id,o,y),children:"Buy"})})]})]}),r&&(0,d.jsxs)("div",{className:"store-offer-card store-offer-card-half",children:[(0,d.jsxs)("div",{className:"store-offer-left",children:[(0,d.jsx)("h3",{children:r.title}),(0,d.jsx)("p",{children:r.body}),(0,d.jsx)("p",{className:"store-reward-line",children:r.rewards.map((e=>{var t;return`${(null===(t=l.find((t=>t.type===e.item)))||void 0===t?void 0:t.symbol)||""} ${e.qty} ${e.item}`})).join(", ")})]}),(0,d.jsxs)("div",{className:"store-offer-right",children:[(0,d.jsxs)("div",{className:"store-price",children:["USD $",r.price.toFixed(2)]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(r.id,o,y),children:"Buy"})})]})]})]},"group-3-4")}if(6===n.id||7===n.id||8===n.id){const n=e.find((e=>6===e.id)),r=e.find((e=>7===e.id)),a=e.find((e=>8===e.id));return n&&t.add(6),r&&t.add(7),a&&t.add(8),(0,d.jsxs)("div",{className:"store-offer-row",children:[n&&(0,d.jsxs)("div",{className:"store-offer-card store-offer-card-third store-offer-card-gem",children:[(0,d.jsxs)("div",{className:"store-offer-left",children:[(0,d.jsx)("h3",{children:n.title}),(0,d.jsx)("p",{children:n.body}),(0,d.jsx)("p",{className:"store-reward-line",children:n.rewards.map((e=>{var t;return`${(null===(t=l.find((t=>t.type===e.item)))||void 0===t?void 0:t.symbol)||""} ${e.qty} ${e.item}`})).join(", ")})]}),(0,d.jsxs)("div",{className:"store-offer-right",children:[(0,d.jsxs)("div",{className:"store-price",children:["USD $",n.price.toFixed(2)]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(n.id,o,y),children:"Buy"})})]})]}),r&&(0,d.jsxs)("div",{className:"store-offer-card store-offer-card-third store-offer-card-gem",children:[(0,d.jsxs)("div",{className:"store-offer-left",children:[(0,d.jsx)("h3",{children:r.title}),(0,d.jsx)("p",{children:r.body}),(0,d.jsx)("p",{className:"store-reward-line",children:r.rewards.map((e=>{var t;return`${(null===(t=l.find((t=>t.type===e.item)))||void 0===t?void 0:t.symbol)||""} ${e.qty} ${e.item}`})).join(", ")})]}),(0,d.jsxs)("div",{className:"store-offer-right",children:[(0,d.jsxs)("div",{className:"store-price",children:["USD $",r.price.toFixed(2)]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(r.id,o,y),children:"Buy"})})]})]}),a&&(0,d.jsxs)("div",{className:"store-offer-card store-offer-card-third store-offer-card-gem",children:[(0,d.jsxs)("div",{className:"store-offer-left",children:[(0,d.jsx)("h3",{children:a.title}),(0,d.jsx)("p",{children:a.body}),(0,d.jsx)("p",{className:"store-reward-line",children:a.rewards.map((e=>{var t;return`${(null===(t=l.find((t=>t.type===e.item)))||void 0===t?void 0:t.symbol)||""} ${e.qty} ${e.item}`})).join(", ")})]}),(0,d.jsxs)("div",{className:"store-offer-right",children:[(0,d.jsxs)("div",{className:"store-price",children:["USD $",a.price.toFixed(2)]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(a.id,o,y),children:"Buy"})})]})]})]},"group-6-7-8")}return t.add(n.id),(0,d.jsxs)("div",{className:"store-offer-card"+("1"===String(n.id)?" store-offer-card-gold":""),children:[(0,d.jsxs)("div",{className:"store-offer-left",children:[(0,d.jsx)("h3",{children:n.title}),(0,d.jsx)("p",{children:n.body}),(0,d.jsx)("p",{className:"store-reward-line",children:n.rewards.map((e=>{var t;return`${(null===(t=l.find((t=>t.type===e.item)))||void 0===t?void 0:t.symbol)||""} ${e.qty} ${e.item}`})).join(", ")})]}),(0,d.jsxs)("div",{className:"store-offer-right",children:[(0,d.jsxs)("div",{className:"store-price",children:["USD $",n.price.toFixed(2)]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(n.id,o,y),children:"Buy"})})]})]},n.id)}))})()})]})};const eh=function(e){var n;let{isOpen:r=!0,onAcceptDeath:o,onRevive:i,reviveCost:l=50,strings:c={},currentPlayer:u,inventory:h,updateStatus:p}=e;const[m,f]=(0,t.useState)({}),g=Array.isArray(h)&&(null===(n=h.find((e=>"Gem"===e.type)))||void 0===n?void 0:n.quantity)||0,y=g>=l;return(0,t.useEffect)((()=>{if(!r||y)return;(async()=>{try{const e=(await a.A.get(`${s.A}/api/store-offers`)).data||[],t={};e.forEach((e=>{t[e.id]=e})),f(t)}catch(e){console.error("\u274c Failed to load store offers:",e)}})()}),[r,y]),r?(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container "+(y?"modal-small":"modal-medium"),children:[(0,d.jsx)("h2",{className:"modal-title",children:c[5004]||"\ud83d\udc80 You have fallen!"}),(0,d.jsxs)("div",{className:"modal-content",children:[(0,d.jsx)("p",{className:"modal-message",children:c[5070]||"Your journey doesn't have to end here..."}),(0,d.jsx)("p",{className:"modal-message",children:c[5071]||"Choose your fate:"}),(0,d.jsxs)("div",{className:"shared-buttons",children:[(0,d.jsxs)("button",{className:`btn-basic ${y?"btn-gold":"btn-neutral"} btn-modal`,onClick:y?i:null,disabled:!y,style:{marginRight:"10px",opacity:y?1:.7},children:[c[5072]||"Revive for",(0,d.jsx)("br",{}),(0,d.jsxs)("span",{style:{color:y?"#2ecc71":"#e74c3c"},children:["\ud83d\udc8e ",l," / ",g]})]}),(0,d.jsx)("button",{className:"btn-basic btn-danger btn-modal",onClick:o,children:c[5073]||"Accept Your Death"})]}),!y&&(0,d.jsxs)("div",{style:{marginTop:"20px",borderTop:"1px solid var(--color-border)",paddingTop:"15px"},children:[(0,d.jsx)("p",{style:{textAlign:"center",fontWeight:"bold",marginBottom:"10px"},children:c[5074]||"Need more gems?"}),(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",flexDirection:"row",justifyContent:"center",gap:"6px"},children:[(0,d.jsxs)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(6,u,p),children:["\ud83d\udc8e 100 for ",m[6]?`$${m[6].price.toFixed(2)}`:"..."]}),(0,d.jsxs)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(7,u,p),children:["\ud83d\udc8e 250 for ",m[7]?`$${m[7].price.toFixed(2)}`:"..."]}),(0,d.jsxs)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(8,u,p),children:["\ud83d\udc8e 500 for ",m[8]?`$${m[8].price.toFixed(2)}`:"..."]})]})]})]})]})}):null},th=["farmplot","crafting","skill","power","pet","deco","station"],nh=e=>{let{isOpen:n,onClose:o,currentLevel:a,previousLevel:s,updateStatus:i,masterResources:l}=e;const c=(0,r.k)(),[u,h]=(0,t.useState)([]);if((0,t.useEffect)((()=>{if(!n||!a)return;(async()=>{try{const e=(await fd.getQuests()).filter((e=>e.level===a)),t=new Map;e.forEach((e=>{e.giver&&!t.has(e.giver)&&t.set(e.giver,e.symbol||"\u2705")})),h(Array.from(t.entries()).map((e=>{let[t,n]=e;return{giver:t,symbol:n}})))}catch(e){console.error("Error fetching quests for level up modal:",e),h([])}})()}),[n,a]),!n)return null;const p=(null===l||void 0===l?void 0:l.filter((e=>e.level===a&&(e=>!!e.category&&(!!th.includes(e.category)||"npc"===e.category&&("graze"===e.action||"worker"===e.action)))(e))))||[],m=()=>{i&&i((c[813]||"Level up! You are now level {level}!").replace("{level}",a)),o()};return(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container modal-medium level-up-modal",children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:m,children:"\xd7"}),(0,d.jsxs)("div",{className:"modal-title",children:["\u2b06\ufe0f ",c[811]||"Level Up!"]}),(0,d.jsxs)("div",{className:"modal-content",children:[(0,d.jsxs)("div",{className:"level-up-message",children:["\ud83c\udf89 ",(c[812]||"Congratulations! You've reached level {level}!").replace("{level}",a)," \ud83c\udf89"]}),p.length>0&&(0,d.jsxs)("div",{className:"unlocked-resources",children:[(0,d.jsx)("div",{className:"unlocked-title",children:c[10138]}),(0,d.jsx)("ul",{className:"unlocked-list",children:p.map(((e,t)=>(0,d.jsxs)("li",{children:[e.symbol," ",(0,Bc.Z)(e.type,c)]},t)))})]}),u.length>0&&(0,d.jsxs)("div",{className:"unlocked-resources",children:[(0,d.jsx)("div",{className:"unlocked-title",children:c[10139]}),(0,d.jsx)("ul",{className:"unlocked-list",children:u.map(((e,t)=>(0,d.jsxs)("li",{children:[e.symbol," ",(0,Bc.Z)(e.giver,c)]},t)))})]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal",onClick:m,children:c[360]})})]})]})})},rh=JSON.parse('[{"code":"en","label":"English","flag":"\ud83c\uddfa\ud83c\uddf8"},{"code":"es","label":"Espa\xf1ol","flag":"\ud83c\uddea\ud83c\uddf8"},{"code":"fr","label":"Fran\xe7ais","flag":"\ud83c\uddeb\ud83c\uddf7"},{"code":"de","label":"Deutsch","flag":"\ud83c\udde9\ud83c\uddea"},{"code":"it","label":"Italiano","flag":"\ud83c\uddee\ud83c\uddf9"},{"code":"pt","label":"Portugu\xeas","flag":"\ud83c\uddf5\ud83c\uddf9"},{"code":"ru","label":"\u0420\u0443\u0441\u0441\u043a\u0438\u0439","flag":"\ud83c\uddf7\ud83c\uddfa"},{"code":"no","label":"Norsk","flag":"\ud83c\uddf3\ud83c\uddf4"},{"code":"sv","label":"Svenska","flag":"\ud83c\uddf8\ud83c\uddea"},{"code":"fi","label":"Suomi","flag":"\ud83c\uddeb\ud83c\uddee"}]'),oh=["en","es","fr","de"];function ah(e){let{currentPlayer:n,setCurrentPlayer:o,updateStatus:i,onClose:l,onSave:c}=e;const u=(0,r.k)(),[h,p]=(0,t.useState)(n.language||"");return(0,d.jsx)("div",{className:"modal-overlay",onClick:l,children:(0,d.jsxs)("div",{className:"modal-container modal-medium",onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:l,children:"\xd7"}),(0,d.jsx)("div",{className:"modal-title",children:u[130]}),(0,d.jsx)("ul",{className:"language-list",children:rh.map((e=>{let{code:t,label:n,flag:r}=e;const o=oh.includes(t);return(0,d.jsxs)("li",{className:`language-item ${h===t?"selected":""} ${o?"":"disabled"}`,onClick:()=>{return e=t,void(oh.includes(e)&&p(e));var e},style:{opacity:o?1:.4,cursor:o?"pointer":"not-allowed"},children:[(0,d.jsx)("span",{className:"flag",children:r})," ",n]},t)}))}),(0,d.jsx)("div",{className:"modal-buttons shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-modal btn-success",onClick:async()=>{try{const e={...n,language:h};localStorage.setItem("player",JSON.stringify(e)),o(e),await a.A.post(`${s.A}/api/update-profile`,{playerId:n._id,updates:{language:h}}),i&&i("Language updated!"),c&&c(),window.location.reload()}catch(e){console.error("Error saving language:",e),i&&i("Failed to update language")}},children:u[131]})})]})})}async function sh(e){if(!e)return console.warn("\u26a0\ufe0f No settlementId provided to getMayorUsername."),"Error";try{var t;const n=await a.A.get(`${s.A}/api/get-settlement/${e}`),r=null===(t=n.data.roles)||void 0===t?void 0:t.find((e=>"Mayor"===e.roleName));if(!r||!r.playerId||"Vacant"===r.playerId)return"Vacant";return(await a.A.get(`${s.A}/api/player/${r.playerId}`)).data.username||"Unknown"}catch(n){return console.error("\u274c Failed to fetch mayor username:",n),"Error"}}const ih=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=(null===e||void 0===e?void 0:e.xp)||0;if(!t||0===t.length)return 1;let r=1;for(let o=0;o<t.length&&n>=t[o];o++)r=o+2;return r},lh=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=(null===e||void 0===e?void 0:e.xp)||0;if(!t||0===t.length)return 1e3;const r=ih(e,t)-1;return r>=t.length?n:t[r]},ch=JSON.parse('{"t9":[{"label":"Grinning Face","value":"\ud83d\ude00"},{"label":"Heart Eyes","value":"\ud83d\ude0d"},{"label":"Innocent Face","value":"\ud83d\ude07"},{"label":"Screaming Face","value":"\ud83d\ude31"},{"label":"Nerd Face","value":"\ud83e\udd13"},{"label":"Face with Hand Over Mouth","value":"\ud83e\udd2d"},{"label":"Alien","value":"\ud83d\udc7d"},{"label":"Crying Face","value":"\ud83d\ude2d"},{"label":"Sunglasses Face","value":"\ud83d\ude0e"},{"label":"Unamused Face","value":"\ud83d\ude12"},{"label":"Party Face","value":"\ud83e\udd73"}],"Vj":[{"label":"Clown Face","value":"\ud83e\udd21"},{"label":"Robot","value":"\ud83e\udd16"},{"label":"Poop","value":"\ud83d\udca9"},{"label":"Space Invader","value":"\ud83d\udc7e"},{"label":"Octopus","value":"\ud83d\udc19"},{"label":"Monkey","value":"\ud83d\udc35"},{"label":"Panda","value":"\ud83d\udc3c"},{"label":"Cat","value":"\ud83d\udc31"},{"label":"Mask","value":"\ud83d\udc7a"},{"label":"Puppy Dog","value":"\ud83d\udc36"},{"label":"Fox","value":"\ud83e\udd8a"},{"label":"Mouse","value":"\ud83d\udc2d"},{"label":"Frog","value":"\ud83d\udc38"},{"label":"Bunny","value":"\ud83d\udc30"}]}');function dh(e){let{currentPlayer:n,setCurrentPlayer:o,updateStatus:i,currentIcon:l,playerId:c,onClose:u,onSave:h,setModalContent:p,setModalIsOpen:m}=e;const[f,g]=(0,t.useState)(l),y=((0,r.k)(),"Gold"===n.accountStatus),v=ch.t9||[],b=ch.Vj||[];return(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container modal-medium",children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:u,children:"\xd7"}),(0,d.jsx)("div",{className:"modal-title",children:"Choose Your Avatar"}),(0,d.jsx)("br",{}),(0,d.jsx)("div",{className:"icon-grid",children:v.map((e=>(0,d.jsx)("button",{className:"icon-button "+(f===e.value?"selected":""),onClick:()=>g(e.value),disabled:!1,children:e.value},e.value)))}),(0,d.jsx)("h3",{children:"Premium Avatars"}),!y&&(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-modal btn-gold",style:{width:"240px"},onClick:()=>Ju(1,n,i),children:"Unlock Premium Avatars"})}),(0,d.jsx)("div",{className:"icon-grid",children:b.map((e=>{const t=!y;return(0,d.jsx)("button",{className:`icon-button ${f===e.value?"selected":""} ${t?"locked":""}`,disabled:t,onClick:()=>{t||g(e.value)},children:e.value},e.value)}))}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-modal",onClick:async()=>{try{await(async(e,t,n,r,o)=>{var i;if(!(e=>"string"===typeof e&&/\p{Emoji}/u.test(e))(r))return console.error("\u274c Attempted to set non-emoji icon:",r),void(null===o||void 0===o||o("Please select a valid emoji."));const l={icon:r},c=await a.A.post(`${s.A}/api/update-profile`,{playerId:n,updates:l});if(!c.data.success)throw new Error("Failed to update icon");const d=null===e||void 0===e||null===(i=e.location)||void 0===i?void 0:i.g;if(d){var u;const t=null===(u=$c.default.getPlayersInGrid(d))||void 0===u?void 0:u[e.playerId];if(t){const n={...t,icon:r};$c.default.updatePC(d,e.playerId,n),console.log(`\u2705 Updated icon in playersInGrid: ${e.playerId} \u2192 ${r}`)}}else console.warn("\u26a0\ufe0f No valid gridId found, skipping NPCsInGrid update.");const h={...e,icon:r};return localStorage.setItem("player",JSON.stringify(h)),t(h),console.log("\u2705 Updated localStorage and state for currentPlayer:",r),c.data.player})(n,o,c,f),h(f)}catch(e){alert("Failed to update icon.")}},children:"Save"})})]})})}const uh=function(e){let{isOpen:t,onClose:n}=e;const o=(0,r.k)();return t?(0,d.jsxs)(Ou,{isOpen:t,onClose:n,title:o[10131]||"Gold Pass Benefits",size:"medium",children:[(0,d.jsxs)("div",{style:{textAlign:"left",padding:"0 10px",fontFamily:"var(--font-text-1-family)",fontSize:"var(--font-text-1-size)",color:"var(--font-text-1-color)"},children:[(0,d.jsx)("h3",{style:{textAlign:"center",marginBottom:"16px",fontFamily:"var(--font-title-3-family)",fontSize:"var(--font-title-3-size)",fontWeight:"var(--font-title-3-weight)",color:"var(--font-title-3-color)"},children:o[9050]}),(0,d.jsx)("p",{style:{marginBottom:"8px"},children:o[9051]}),(0,d.jsx)("p",{style:{marginBottom:"8px"},children:o[9052]}),(0,d.jsx)("p",{style:{marginBottom:"8px"},children:o[9053]}),(0,d.jsx)("p",{style:{marginBottom:"8px"},children:o[9054]}),(0,d.jsx)("p",{style:{marginBottom:"8px"},children:o[9055]}),(0,d.jsx)("p",{style:{marginBottom:"8px"},children:o[9056]}),(0,d.jsx)("p",{style:{marginBottom:"8px"},children:o[9057]}),(0,d.jsx)("p",{style:{marginBottom:"8px"},children:o[9058]})]}),(0,d.jsx)("div",{className:"modal-buttons shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal",onClick:n,children:"OK"})})]}):null};async function hh(e,t,n){try{const r={...t,settings:{...t.settings,...e}};localStorage.setItem("player",JSON.stringify(r)),n(r);const o={};Object.keys(e).forEach((t=>{o[`settings.${t}`]=e[t]}));const i=t._id||t.playerId,l=await a.A.post(`${s.A}/api/update-profile`,{playerId:i,updates:o});l.data.success?console.log("Settings updated successfully on server."):console.error("Server update failed:",l.data.error)}catch(r){console.error("Error updating player settings:",r)}}const ph=(0,t.createContext)(),mh=()=>(0,t.useContext)(ph),fh=e=>{let{children:n,custom:r}=e;const[o,a]=(0,t.useState)(null);return(0,d.jsxs)(ph.Provider,{value:{activeModal:o,setActiveModal:a,openModal:e=>{console.log(`Opening modal: ${e}`),a(e)},closeModal:()=>{a(null)}},children:[n,r]})},gh=e=>{var n;let{onClose:o,currentPlayer:i,setCurrentPlayer:l,handleLogout:c,isRelocating:u,setIsRelocating:h,zoomLevel:p,setZoomLevel:m,handlePCClick:f,isDeveloper:g}=e;const y=(0,r.k)(),[v,b]=(0,t.useState)(!1),[x,w]=(0,t.useState)(!1),[S,T]=(0,t.useState)({username:"",icon:"",password:"",accountStatus:"Free",role:"Citizen"}),{updateStatus:C}=(0,t.useContext)(vu),[k,A]=(0,t.useState)(!1),[I,E]=(0,t.useState)(""),[P,_]=(0,t.useState)({isStateMachineEnabled:!1,isTeleportEnabled:!1,toggleVFX:!0,seasonOverride:"None"});(0,t.useEffect)((()=>{if(i){var e,t,n,r,o;const{settings:a}=i;_({isStateMachineEnabled:null!==(e=null===a||void 0===a?void 0:a.isStateMachineEnabled)&&void 0!==e&&e,isTeleportEnabled:null!==(t=null===a||void 0===a?void 0:a.isTeleportEnabled)&&void 0!==t&&t,toggleVFX:null===(n=null===a||void 0===a?void 0:a.toggleVFX)||void 0===n||n,rangeOn:null===(r=null===a||void 0===a?void 0:a.rangeOn)||void 0===r||r,seasonOverride:null!==(o=null===a||void 0===a?void 0:a.seasonOverride)&&void 0!==o?o:"None"}),T({username:i.username||"",icon:i.icon||"",password:"",accountStatus:i.accountStatus||"Free",role:i.role||"Citizen"}),E(""),console.log("Profile: curentPlayer = ",i)}}),[i]);const N=e=>{const{name:t,value:n}=e.target;T((e=>({...e,[t]:n})))},R=e=>{_((t=>{const n={...t,[e]:!t[e]};return hh(n,i,l),n}))},{setActiveModal:M}=mh();return(0,d.jsx)(Zc,{onClose:()=>{h(!1),"settlement"!==p&&"frontier"!==p||(m("close"),C(0)),o()},titleKey:"1119",panelName:"ProfilePanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:()=>{o(),setTimeout((()=>{const e={playerId:i._id,username:i.username,icon:i.icon,hp:i.hp||100,position:{x:0,y:0},iscamping:i.iscamping,isinboat:i.isinboat};f(e)}),0)},children:"Go to Player Character"})}),(0,d.jsx)("br",{}),(0,d.jsx)("h3",{children:y[4054]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:y[4052]}),(0,d.jsx)("input",{name:"username",type:"text",value:S.username,onChange:N,placeholder:"Enter your username"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:y[4053]}),(0,d.jsx)("input",{name:"password",type:"password",value:S.password,onChange:N,placeholder:"Enter new password (optional)"})]}),(0,d.jsx)("br",{}),g&&(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:y[4055]}),(0,d.jsxs)("select",{name:"accountStatus",value:S.accountStatus,onChange:N,children:[(0,d.jsx)("option",{value:"Free",children:"Free"}),(0,d.jsx)("option",{value:"Bronze",children:"Bronze"}),(0,d.jsx)("option",{value:"Silver",children:"Silver"}),(0,d.jsx)("option",{value:"Gold",children:"Gold"})]})]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{A(!0),E("");try{if(!S.username.trim())throw new Error("Username cannot be empty.");const n={username:S.username.trim(),icon:S.icon.trim(),...S.password&&{password:S.password},accountStatus:S.accountStatus,role:S.role,"settings.isStateMachineEnabled":P.isStateMachineEnabled,"settings.isTeleportEnabled":P.isTeleportEnabled,"settings.toggleVFX":P.toggleVFX,"settings.seasonOverride":P.seasonOverride,"settings.rangeOn":P.rangeOn};console.log("Saving updates:",n);const r=await a.A.post(`${s.A}/api/update-profile`,{playerId:i.playerId,updates:n});if(r.data.success){var e;console.log("Profile and settings successfully updated:",r.data.player);const n={...i,settings:{...i.settings,...P},username:S.username.trim(),icon:S.icon.trim(),accountStatus:S.accountStatus,role:S.role};l(n),localStorage.setItem("player",JSON.stringify(n)),console.log("Updated localStorage after save:",n.settings),S.role&&"Citizen"!==S.role&&(console.log(`\ud83c\udfdb\ufe0f Assigning player to role "${S.role}" in the settlement...`),await a.A.post(`${s.A}/api/update-settlement-role`,{settlementId:i.location.s,playerId:i._id,roleName:S.role}));const c=null===i||void 0===i||null===(e=i.location)||void 0===e?void 0:e.g;if(c){var t;const e=null===(t=$c.default.getPlayersInGrid(c))||void 0===t?void 0:t[i.playerId];if(e){const t={...e,username:S.username.trim()};$c.default.updatePC(c,i.playerId,t),console.log(`\u2705 Updated username in playersInGrid: ${i.playerId} \u2192 ${S.username.trim()}`)}}else console.warn("\u26a0\ufe0f No valid gridId found, skipping NPCsInGrid update.");o()}else{const e=r.data.error||"Failed to update profile.";console.error(e),E(e)}}catch(c){var n,r;console.error("Error during save operation:",c),"TAKEN"===(null===(n=c.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.error)&&(console.log("\u274c Username is already taken."),C(50)),E(c.message||"An unexpected error occurred while saving.")}finally{A(!1)}},disabled:k,children:k?"Saving...":y[10128]})}),(0,d.jsx)("br",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-gold",onClick:()=>w(!0),children:"Gold"===S.accountStatus?y[10130]:y[10131]})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:c,children:y[4056]})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{if(window.confirm("Are you sure you want to delete your account? This action cannot be undone."))try{(await a.A.post(`${s.A}/api/delete-player`,{playerId:i.playerId})).data.success?(alert("Account deleted successfully."),localStorage.removeItem("player"),window.location.reload()):alert("Failed to delete account.")}catch(e){console.error("Error deleting account:",e),alert("An error occurred while trying to delete your account.")}},children:y[4057]})}),(0,d.jsxs)("p",{children:[y[4058]," ",(null===i||void 0===i?void 0:i.playerId)||"N/A"]}),(0,d.jsxs)("p",{children:["Home Settlement ID: ",(null===i||void 0===i?void 0:i.settlementId)||"N/A"]}),(0,d.jsx)("br",{}),(0,d.jsx)("h3",{children:y[4059]}),(0,d.jsxs)("p",{children:[y[4060]," ",(0,d.jsx)("strong",{children:i.relocations})]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{u?(h(!1),m("close"),C(0)):(h(!0),m("frontier"))},disabled:!i.relocations,children:u?y[10132]:y[10133]})}),(0,d.jsx)("p",{children:y[4061]}),(0,d.jsx)("h3",{children:y[4062]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsxs)("button",{className:"btn-basic btn-success",onClick:()=>{M("LanguagePicker")},children:["\ud83c\udf0e ",(null===(n=rh.find((e=>e.code===i.language)))||void 0===n?void 0:n.label)||"Language"]})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsxs)("button",{className:"btn-basic "+(P.rangeOn?"btn-success":"btn-neutral"),onClick:()=>R("rangeOn"),children:[y[4064],P.rangeOn?"is ON":"is OFF"]})}),g&&(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsxs)("button",{className:"btn-basic "+(P.isTeleportEnabled?"btn-success":"btn-neutral"),onClick:()=>R("isTeleportEnabled"),children:["Teleport: ",P.isTeleportEnabled?"is ON":"is OFF"]})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsxs)("button",{className:"btn-basic "+(P.toggleVFX?"btn-success":"btn-neutral"),onClick:()=>R("toggleVFX"),children:["VFX: ",P.toggleVFX?"is ON":"is OFF"]})}),g&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h4",{children:"Season Override"}),(0,d.jsxs)("div",{className:"season-override-options",children:[(0,d.jsxs)("label",{style:{display:"block",marginBottom:"10px"},children:[(0,d.jsx)("input",{type:"radio",name:"seasonOverride",value:"None",checked:"None"===P.seasonOverride,onChange:()=>{_((e=>({...e,seasonOverride:"None"}))),hh({...P,seasonOverride:"None"},i,l)}}),"None (Use current season)"]}),(0,d.jsxs)("label",{style:{display:"block",marginBottom:"10px"},children:[(0,d.jsx)("input",{type:"radio",name:"seasonOverride",value:"Spring",checked:"Spring"===P.seasonOverride,onChange:()=>{_((e=>({...e,seasonOverride:"Spring"}))),hh({...P,seasonOverride:"Spring"},i,l),setTimeout((()=>window.location.reload()),500)}}),"Spring \ud83c\udf38"]}),(0,d.jsxs)("label",{style:{display:"block",marginBottom:"10px"},children:[(0,d.jsx)("input",{type:"radio",name:"seasonOverride",value:"Summer",checked:"Summer"===P.seasonOverride,onChange:()=>{_((e=>({...e,seasonOverride:"Summer"}))),hh({...P,seasonOverride:"Summer"},i,l),setTimeout((()=>window.location.reload()),500)}}),"Summer \u2600\ufe0f"]}),(0,d.jsxs)("label",{style:{display:"block",marginBottom:"10px"},children:[(0,d.jsx)("input",{type:"radio",name:"seasonOverride",value:"Fall",checked:"Fall"===P.seasonOverride,onChange:()=>{_((e=>({...e,seasonOverride:"Fall"}))),hh({...P,seasonOverride:"Fall"},i,l),setTimeout((()=>window.location.reload()),500)}}),"Fall \ud83c\udf42"]}),(0,d.jsxs)("label",{style:{display:"block",marginBottom:"10px"},children:[(0,d.jsx)("input",{type:"radio",name:"seasonOverride",value:"Winter",checked:"Winter"===P.seasonOverride,onChange:()=>{_((e=>({...e,seasonOverride:"Winter"}))),hh({...P,seasonOverride:"Winter"},i,l),setTimeout((()=>window.location.reload()),500)}}),"Winter \u2744\ufe0f"]})]})]}),v&&(0,d.jsx)(dh,{currentPlayer:i,setCurrentPlayer:l,updateStatus:C,currentIcon:S.icon,playerId:i.playerId,onClose:()=>b(!1),onSave:e=>{T((t=>({...t,icon:e}))),b(!1)}}),(0,d.jsx)(uh,{isOpen:x,onClose:()=>w(!1)})]})})},yh=(e,t)=>{console.log("\ud83c\udfaf Tracking account creation for:",e,t),((e,t)=>{"undefined"!==typeof window.gtag&&window.gtag("event","sign_up",{method:"email",value:1,currency:"USD",user_id:t,custom_parameters:{username:e}})})(e,t),"undefined"!==typeof window.rdt&&window.rdt("track","SignUp"),((e,t)=>{"undefined"!==typeof window.fbq&&window.fbq("track","CompleteRegistration",{value:1,currency:"USD",content_name:"game_account",status:!0,user_id:t})})(0,t),(e=>{"undefined"!==typeof window.ttq&&window.ttq.track("CompleteRegistration",{value:1,currency:"USD",content_id:e})})(t)},vh=()=>{const e=navigator.userAgent;return e.includes("Chrome")&&!e.includes("Edg")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")&&!e.includes("Chrome")?"Safari":e.includes("Edg")?"Edge":e.includes("Opera")||e.includes("OPR")?"Opera":"Unknown"},bh=()=>{const e=navigator.userAgent,t=e.match(/Windows NT (\d+\.\d+)/);if(t){const e=t[1];return`Windows ${{"10.0":"10/11",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.1:"XP"}[e]||e}`}const n=e.match(/Mac OS X (\d+[._]\d+(?:[._]\d+)?)/);if(n)return`MacOS ${n[1].replace(/_/g,".")}`;const r=e.match(/(?:iPhone|iPad|iPod).*?OS (\d+[._]\d+)/);if(r)return`iOS ${r[1].replace(/_/g,".")}`;const o=e.match(/Android (\d+(?:\.\d+)?)/);return o?`Android ${o[1]}`:e.includes("Linux")?"Linux":"Unknown"},xh=e=>{let{setCurrentPlayer:n,zoomLevel:o,setZoomLevel:i,setIsLoggedIn:l,closeModal:c}=e;const u=(0,r.k)(),[h,p]=(0,t.useState)(""),[m,f]=(0,t.useState)(""),[g,y]=(0,t.useState)("en"),[v,b]=(0,t.useState)(ch.t9[0].value),[x,w]=(0,t.useState)(0),[S,T]=(0,t.useState)(""),[C,k]=(0,t.useState)(!1),[A,I]=(0,t.useState)(null);(0,t.useEffect)((()=>{const e=()=>{const e=document.querySelector("#create-account-form h2");if(!e)return null;const t=e.getBoundingClientRect();return{x:t.left+t.width/2,y:t.top}},t=e();t&&I(t);const n=setInterval((()=>{const t=e();I(t)}),500);return()=>clearInterval(n)}),[]);const E=ch.t9,P=Math.max(0,E.length-3);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{id:"create-account-form",children:[(0,d.jsx)("div",{className:"panel-buffer-space"}),(0,d.jsx)("h2",{children:u[4002]}),(0,d.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!C)if(h.trim())if(m.trim()){T(""),k(!0);try{const e="Valley View 1",t=await a.A.get(`${s.A}/api/frontiers-by-name`,{params:{name:e}});if(!t.data||0===t.data.length)throw new Error("Frontier not found");const r=t.data[0];let l=null,d=null,u=null;for(const n of r.settlements||[]){for(const e of n){if(!0!==e.available)continue;const t=await a.A.get(`${s.A}/api/get-settlement/${e.settlementId}`),n=t.data.grids.flat(),r=n.find((e=>!0===e.available&&"homestead"===e.gridType)),o=n.find((e=>"town"===e.gridType));if(r&&o){l=e.settlementId,d=r.gridCoord,u=o.gridId;break}}if(d)break}if(!l||!d||!u)throw new Error("No available sub-grids in the Frontier.");let p=30,f=33;try{const e=(await a.A.get(`${s.A}/api/load-grid/${u}`)).data;if(e.resources&&Array.isArray(e.resources)){const t=e.resources.find((e=>"Signpost Home"===e.type));t?(p=t.x,f=t.y+1,console.log(`\u2705 Found Signpost Home at (${t.x}, ${t.y}), placing new player at (${p}, ${f})`)):console.warn("\u26a0\ufe0f Signpost Home not found in town grid, using default position")}}catch(o){console.warn("\u26a0\ufe0f Could not load town grid for spawn position, using default:",o.message)}const y=await(async()=>{var e,t,n,r;let o=null;try{const e=performance.now();await a.A.get(`${s.A}/api/ping`),o=Math.round(performance.now()-e)}catch{o=-1}let i=!1;try{const e=document.createElement("canvas");i=!(!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch{i=!1}return{latency:o,connectionType:(null===(e=navigator.connection)||void 0===e?void 0:e.effectiveType)||null,downlink:(null===(t=navigator.connection)||void 0===t?void 0:t.downlink)||null,screenWidth:(null===(n=window.screen)||void 0===n?void 0:n.width)||null,screenHeight:(null===(r=window.screen)||void 0===r?void 0:r.height)||null,viewportWidth:window.innerWidth||null,viewportHeight:window.innerHeight||null,devicePixelRatio:window.devicePixelRatio||null,deviceMemory:navigator.deviceMemory||null,hardwareConcurrency:navigator.hardwareConcurrency||null,isMobile:/Mobile|Android|iPhone|iPad|iPod/i.test(navigator.userAgent),isTouchDevice:"ontouchstart"in window||navigator.maxTouchPoints>0,webglSupported:i,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||null}})(),b={username:h,password:m,language:g,icon:v,location:{x:p,y:f,gridCoord:d,settlementId:l,frontierId:r._id,gtype:"homestead"},startInTown:!0,townGridId:u,browser:vh(),os:bh(),diagnostics:y};console.log("Calling /api/register-new-player with payload:",b);const x=await a.A.post(`${s.A}/api/register-new-player`,b);if(!x.data.success||!x.data.player)throw new Error("Player registration failed");const w=x.data.player;console.log("\u2705 Player registered with location:",w.location),yh(w.username,w._id||w.playerId),n(w),localStorage.removeItem("player"),localStorage.setItem("player",JSON.stringify(w));const S=w.location.g,T=Date.now(),C={playerId:w._id,type:"pc",username:w.username,position:{x:w.location.x,y:w.location.y},icon:w.icon||"\ud83d\ude00",hp:w.baseHp||25,maxhp:w.baseMaxhp||25,attackbonus:w.baseAttackbonus||1,armorclass:w.baseArmorclass||1,damage:w.baseDamage||1,attackrange:w.baseAttackrange||1,speed:w.baseSpeed||1,iscamping:!1,isinboat:!1,lastUpdated:T},k={gridId:S,playerId:w._id,pc:C,lastUpdated:T};await a.A.post(`${s.A}/api/save-single-pc`,k);try{await a.A.post(`${s.A}/api/send-mailbox-message`,{playerId:w._id,messageId:1})}catch(i){console.error("\u274c Failed to send welcome message:",i)}c&&c(),localStorage.setItem("initialZoomLevel","close"),window.location.reload()}catch(o){var t,r;console.error("Error during account creation:",o),T((null===(t=o.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.error)||"Account creation failed. Please try again."),k(!1)}}else T("Enter a password");else T("Enter a username")},children:[(0,d.jsx)("input",{type:"text",placeholder:u[4069]||"Choose Username",value:h,onChange:e=>p(e.target.value)}),(0,d.jsx)("input",{type:"password",placeholder:u[4070]||"Select a Password",value:m,onChange:e=>f(e.target.value)}),(0,d.jsxs)("select",{value:g,onChange:e=>y(e.target.value),children:[(0,d.jsx)("option",{value:"",children:u[4067]}),rh.filter((e=>{let{code:t}=e;return oh.includes(t)})).map((e=>{let{code:t,label:n}=e;return(0,d.jsx)("option",{value:t,children:n},t)}))]}),(0,d.jsx)("h3",{className:"avatar-header",children:u[4071]}),(0,d.jsxs)("div",{className:"avatar-carousel",children:[(0,d.jsx)("button",{type:"button",className:"avatar-scroll-btn",onClick:()=>{w((e=>Math.max(0,e-1)))},disabled:0===x,children:"\u25c0"}),(0,d.jsx)("div",{className:"avatar-icons-container",children:E.slice(x,x+3).map((e=>(0,d.jsx)("button",{type:"button",className:"avatar-icon-btn "+(v===e.value?"selected":""),onClick:()=>b(e.value),title:e.label,children:e.value},e.value)))}),(0,d.jsx)("button",{type:"button",className:"avatar-scroll-btn",onClick:()=>{w((e=>Math.min(P,e+1)))},disabled:x>=P,children:"\u25b6"})]}),S&&(0,d.jsx)("p",{className:"error-message",children:S}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",type:"submit",disabled:C,children:u[4068]||"Begin!"})})]})]}),A&&(0,cu.createPortal)((0,d.jsx)("div",{className:"ftue-doinker-button",style:{left:A.x-15+"px",top:A.y-50+"px",width:"30px",height:"40px"},children:(0,d.jsxs)("svg",{width:30,height:40,viewBox:"0 0 40 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"ftue-doinker-arrow",children:[(0,d.jsx)("path",{d:"M15 0 L15 35 L5 35 L20 60 L35 35 L25 35 L25 0 Z",fill:"#e53935",stroke:"#b71c1c",strokeWidth:"2"}),(0,d.jsx)("path",{d:"M17 2 L17 33 L20 33 L20 2 Z",fill:"#ff6f60",opacity:"0.6"})]})}),document.body)]})},wh=e=>{let{onClose:n,setCurrentPlayer:o,zoomLevel:i,setZoomLevel:l,onLoginSuccess:c}=e;const u=(0,r.k)(),[h,p]=(0,t.useState)(""),[m,f]=(0,t.useState)(""),[g,y]=(0,t.useState)(""),[v,b]=(0,t.useState)(!1);return(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1021",titleKey:"1121",panelName:"LoginPanel",children:v?(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsx)("h3",{children:u[4010]}),(0,d.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await a.A.post(`${s.A}/api/login`,{username:h,password:m});if(e.data.success){const t=e.data.player;o(t),localStorage.setItem("player",JSON.stringify(t)),n(),c&&c(t)}else y(e.data.error||"Invalid username or password")}catch(t){console.error("Error during login:",t),y("Login failed. Please try again.")}},className:"panel-form login-panel-form",children:[(0,d.jsx)("div",{className:"form-group",children:(0,d.jsx)("input",{id:"username",type:"text",className:"login-form-input",placeholder:u[4003]||"Username",value:h,onChange:e=>p(e.target.value),required:!0})}),(0,d.jsx)("div",{className:"form-group",children:(0,d.jsx)("input",{id:"password",type:"password",className:"login-form-input",placeholder:u[4006]||"Password",value:m,onChange:e=>f(e.target.value),required:!0})}),g&&(0,d.jsx)("p",{className:"error-message",children:g}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{type:"submit",className:"btn-basic btn-neutral",children:u[4007]})})]}),(0,d.jsx)("div",{className:"panel-buffer-space"}),(0,d.jsx)("p",{className:"login-link-text",children:(0,d.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),b(!1)},children:u[4001]})})]}):(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsx)(xh,{setCurrentPlayer:o,zoomLevel:i,setZoomLevel:l,setIsLoggedIn:()=>{n()}}),(0,d.jsx)("p",{className:"login-link-text",children:(0,d.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),b(!0)},children:u[4010]})}),(0,d.jsx)("div",{className:"panel-buffer-space"}),(0,d.jsx)("p",{className:"login-link-text",children:(0,d.jsx)("a",{href:"mailto:valleyviewgamedev@gmail.com",children:u[97]})})]})})},Sh=e=>{let{gridId:t,gridCoord:n,gridType:r,settlementId:o,NPCsInGrid:a,playersInGrid:s}=e;const i=e=>{try{return JSON.stringify(e,null,2)}catch{return"[Unserializable]"}},l=(null===a||void 0===a?void 0:a[t])||"Not loaded",c=(null===s||void 0===s?void 0:s[t])||"Not loaded";return(0,d.jsxs)("div",{className:"grid-debug-panel",children:[(0,d.jsx)("h4",{style:{color:"white"},children:"Debug:"}),(0,d.jsx)("br",{}),(0,d.jsx)("h5",{children:"gridId:"}),(0,d.jsx)("pre",{children:i(t)}),(0,d.jsxs)("h5",{children:["gridCoord: ",i(n)]}),(0,d.jsxs)("h5",{children:["gridType: ",i(r)]}),(0,d.jsxs)("h5",{children:["settlementId: ",i(o)]}),(0,d.jsx)("br",{}),(0,d.jsx)("h5",{children:"\ud83d\udc2e NPCsInGrid?[gridId]"}),(0,d.jsx)("pre",{children:i(l)}),(0,d.jsx)("h5",{children:"\ud83d\udc65 PlayersInGrid?[gridId]"}),(0,d.jsx)("pre",{children:i(c)})]})};const Th=e=>{var n,r,o,i;let{onClose:l,currentPlayer:c,setCurrentPlayer:u,setInventory:h,setResources:p,currentGridId:m,updateStatus:f,TILE_SIZE:g,setGrid:y,setGridId:v,setTileTypes:b,closeAllPanels:x}=e;const[w,S]=(0,t.useState)([]),[T,C]=(0,t.useState)([]),[k,A]=(0,t.useState)([]),[I,E]=(0,t.useState)(T),[P,_]=(0,t.useState)(!1),[N,R]=(0,t.useState)(""),[M,j]=(0,t.useState)(""),[D,O]=(0,t.useState)(""),[B,L]=(0,t.useState)(""),[F,$]=(0,t.useState)(""),[G,z]=(0,t.useState)((()=>!("true"===localStorage.getItem("useV2TilesExplicit"))||"true"===localStorage.getItem("useV2Tiles"))),[U,H]=(0,t.useState)((()=>!("true"!==localStorage.getItem("usePixiJSExplicit"))&&"true"===localStorage.getItem("usePixiJS"))),[q,V]=(0,t.useState)({fps:0,domElementCount:0,memoryUsage:0,renderMode:"Unknown"});(0,t.useEffect)((()=>{if(!m)return;(async()=>{try{console.log("Fetching timers for gridId:",m);const e=((await(0,Gc.FD)(m,f,c)).resources||[]).filter((e=>e.growEnd||e.craftEnd));console.log("\u23f3 Active Timers:",e),S(e)}catch(e){console.error("Error fetching timers:",e)}})()}),[m]),(0,t.useEffect)((()=>{const e=setInterval((()=>{S((e=>e.map((e=>{const t=e.growEnd?Math.max(0,Math.floor((e.growEnd-Date.now())/1e3)):null,n=e.craftEnd?Math.max(0,Math.floor((e.craftEnd-Date.now())/1e3)):null;return{...e,remainingTime:null!==t?t:n}}))))}),1e3);return()=>clearInterval(e)}),[]),(0,t.useEffect)((()=>{if(!m)return;(()=>{const e=Fc.Ay.getNPCsInGrid(m),t=$c.default.getPlayersInGrid(m);e?C(Object.values(e.npcs||{})):(console.warn(`No NPCsInGrid found for gridId: ${m}`),C([])),t?A(Object.values(t)):(console.warn(`No playersInGrid found for gridId: ${m}`),A([]))})()}),[m,P]),(0,t.useEffect)((()=>{E(T)}),[T]),(0,t.useEffect)((()=>{let e,t=0,n=performance.now();const r=()=>{t++;const o=performance.now();if(o-n>=1e3){const e=Math.round(1e3*t/(o-n)),r=document.querySelectorAll("*").length,a=null!==document.querySelector('canvas[style*="position: absolute"]'),s=null!==document.querySelector(".tile-g, .tile-s, .tile-d, .tile-w, .tile-l, .tile-p, .tile-n, .tile-o");let i="Unknown";a&&!s?i="Canvas":!a&&s?i="DOM":a&&s&&(i="Mixed");let l=0;performance.memory&&(l=Math.round(performance.memory.usedJSHeapSize/1024/1024)),V({fps:e,domElementCount:r,memoryUsage:l,renderMode:i}),t=0,n=o}e=requestAnimationFrame(r)};return e=requestAnimationFrame(r),()=>{e&&cancelAnimationFrame(e)}}),[]);return(0,d.jsxs)(Zc,{onClose:l,titleKey:"1120",panelName:"DebugPanel",children:[(0,d.jsxs)("div",{style:{backgroundColor:"#f0f0f0",padding:"10px",marginBottom:"15px",borderRadius:"5px",fontFamily:"monospace",fontSize:"11px"},children:[(0,d.jsx)("h3",{style:{margin:"0 0 8px 0",color:"#333",fontSize:"12px"},children:"\u26a1 Performance Metrics"}),(0,d.jsxs)("div",{style:{marginBottom:"8px",color:"#666"},children:[(0,d.jsx)("div",{children:"\ud83c\udfa8 Rendering Mode:"}),(0,d.jsx)("div",{children:(0,d.jsx)("strong",{style:{color:"green"},children:"Canvas (Forced)"})})]}),(0,d.jsxs)("div",{style:{marginTop:"10px",marginBottom:"8px",padding:"8px",backgroundColor:"#e8e8e8",borderRadius:"4px"},children:[(0,d.jsxs)("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",gap:"8px"},children:[(0,d.jsx)("input",{type:"checkbox",checked:G,onChange:e=>{const t=e.target.checked;z(t),localStorage.setItem("useV2Tiles",t),localStorage.setItem("useV2TilesExplicit","true"),window.dispatchEvent(new CustomEvent("tileRendererChange",{detail:t}))},style:{width:"16px",height:"16px"}}),(0,d.jsx)("span",{style:{fontWeight:"bold"},children:"Use V2 Tile Renderer (Autotiling)"})]}),(0,d.jsx)("div",{style:{fontSize:"10px",marginTop:"4px",color:"#888"},children:"Enables quarter-tile blending with grass blades at edges"})]}),(0,d.jsxs)("div",{style:{marginTop:"10px",marginBottom:"8px",padding:"8px",backgroundColor:"#fff3cd",borderRadius:"4px",border:"1px solid #ffc107"},children:[(0,d.jsxs)("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",gap:"8px"},children:[(0,d.jsx)("input",{type:"checkbox",checked:U,onChange:e=>{const t=e.target.checked;H(t),localStorage.setItem("usePixiJS",t),localStorage.setItem("usePixiJSExplicit","true"),window.dispatchEvent(new CustomEvent("pixiRendererChange",{detail:t}))},style:{width:"16px",height:"16px"}}),(0,d.jsx)("span",{style:{fontWeight:"bold"},children:"Use PixiJS Renderer (Experimental)"})]}),(0,d.jsx)("div",{style:{fontSize:"10px",marginTop:"4px",color:"#856404"},children:"WebGL-accelerated rendering with smooth zoom. Uncheck to revert to Canvas 2D."})]}),(0,d.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2px 10px"},children:[(0,d.jsx)("div",{children:(0,d.jsx)("strong",{children:"FPS:"})}),(0,d.jsx)("div",{children:(0,d.jsx)("strong",{children:"Render Mode:"})}),(0,d.jsx)("div",{style:{color:q.fps>=30?"green":q.fps>=15?"orange":"red",marginBottom:"6px"},children:q.fps}),(0,d.jsx)("div",{style:{color:"Canvas"===q.renderMode?"green":"blue",marginBottom:"6px"},children:q.renderMode}),(0,d.jsx)("div",{children:(0,d.jsx)("strong",{children:"DOM Elements:"})}),(0,d.jsx)("div",{children:(0,d.jsx)("strong",{children:"Memory:"})}),(0,d.jsx)("div",{children:q.domElementCount.toLocaleString()}),(0,d.jsx)("div",{children:q.memoryUsage>0?`${q.memoryUsage} MB`:"N/A"})]})]}),(0,d.jsx)("h3",{children:"Teleport to Another Grid"}),(0,d.jsx)("input",{type:"text",placeholder:"Enter GridCoord",value:M,onChange:e=>j(e.target.value)}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{try{const e=parseInt(M,10);if(isNaN(e))return void alert("Invalid gridCoord (not a number).");await(async e=>{if(!e||"number"!==typeof e||isNaN(e))return console.error("\u274c Invalid gridCoord passed to handleTeleport:",e),void f("\u274c Invalid grid selected for teleport.");const t=String(e).padStart(7,"0"),n=parseInt(t[3],10),r=parseInt(t[4],10);console.log(`\ud83d\udd22 Parsed gridCoord ${e} \u2192 row=${n}, col=${r}`);try{const t=(await a.A.get(`${s.A}/api/get-settlement-by-coords/${n}/${r}`)).data;if(!t||!t.grids||0===t.grids.length)return console.warn("No settlement or empty grids array found."),void f("\u274c Settlement data not found.");let o=null;for(const n of t.grids){for(const t of n)if(t.gridCoord===e){o=t;break}if(o)break}if(!o)return console.warn(`GridCoord ${e} not found in settlement.`),void f("\u274c Grid not found in settlement.");const i=c.location,l={x:0,y:0,g:o.gridId,s:t._id,f:c.location.f,gtype:o.gridType,gridCoord:e};(0,Gc.t3)(c,i,l,u,v,y,b,p,g,x,f,null,null,null,null)}catch(o){console.error("Error during teleport:",o),f("\u274c Teleport failed due to error.")}})(e)}catch(e){console.error("Error teleporting:",e),alert("Failed to teleport.")}},children:"Teleport"})}),(0,d.jsxs)("h3",{children:["FTUE Step: ",(null===c||void 0===c?void 0:c.ftuestep)||"Not set"]}),(0,d.jsxs)("h3",{children:["Warehouse Level: ",null!==(n=null===c||void 0===c?void 0:c.warehouseLevel)&&void 0!==n?n:0]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{try{const e=await a.A.post(`${s.A}/api/make-it-snow/${m}`);console.log("\u2744\ufe0f Make it snow response:",e.data),f(`\u2744\ufe0f Made it snow! ${e.data.tilesConverted} tiles converted.`),window.location.reload()}catch(e){console.error("\u274c Error making it snow:",e),f("\u274c Failed to make it snow.")}},children:"\u2744\ufe0f Make It Snow"})}),(0,d.jsxs)("div",{className:"shared-buttons",children:[(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{try{const e=await a.A.post(`${s.A}/api/melt-the-snow/${m}`);console.log("\u2600\ufe0f Melt the snow response:",e.data),f(`\u2600\ufe0f Snow melted! ${e.data.tilesConverted} tiles converted.`),window.location.reload()}catch(e){console.error("\u274c Error melting snow:",e),f("\u274c Failed to melt snow.")}},children:"\u2600\ufe0f Melt The Snow"}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{if(m){console.log("handleResetGrid: gridId:",m);try{var e;const t=null===c||void 0===c||null===(e=c.location)||void 0===e?void 0:e.s;if(!t)return console.error("Settlement ID not found for the current player."),void alert("Settlement ID not found for the current player.");const n=(await a.A.get(`${s.A}/api/get-settlement/${t}`)).data;if(!n||!n.frontierId)return console.error("Settlement data is incomplete or missing frontierId."),void alert("Settlement data is incomplete or missing frontierId.");const r=n.frontierId;console.log("Settlement and frontierId resolved:",{settlementId:t,frontierId:r});const o=(await a.A.get(`${s.A}/api/load-grid/${m}`)).data;if(!o||!o.gridType)return console.error("Grid data is incomplete or missing gridType."),void alert("Grid data is incomplete or missing gridType.");const i=o.gridType;let l=null;for(const e of n.grids){for(const t of e)if(t.gridId&&String(t.gridId)===String(m)){l=t.gridCoord;break}if(null!==l)break}if(null===l)return console.error("Could not resolve gridCoord from settlement."),void alert("Could not resolve gridCoord from settlement.");console.log("Extracted gridData: gridType=",i,"; gridCoord=",l);const d=await a.A.post(`${s.A}/api/reset-grid`,{gridCoord:l,gridId:m,gridType:i,settlementId:t,frontierId:r});console.log(`Grid ${m} of type ${i} reset successfully:`,d.data),f(903),window.location.reload()}catch(t){console.error(`Error resetting grid "${m}":`,t),alert(`Failed to reset grid "${m}". Check the console for details.`)}}else console.error("currentGridId is not defined.")},children:" Reset This Grid "})}),(0,d.jsx)("br",{})]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{try{const e=await a.A.post(`${s.A}/api/create-frontier`);console.log("Create New Frontier response:",e.data),alert("New Frontier created successfully!")}catch(e){console.error("Error creating new Frontier:",e),alert("Failed to create new Frontier. Check console for details.")}},children:" Create New Frontier "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{var e;if(!m)return console.error("\u274c No grid ID available."),void f("\u274c No grid ID available.");if("homestead"!==(null===c||void 0===c||null===(e=c.location)||void 0===e?void 0:e.gtype))return void alert("\u26a0\ufe0f This command only works on homestead grids.");if(window.confirm(`\u26a0\ufe0f Are you absolutely sure you want to remove this homestead grid?\n\nGrid ID: ${m}\n\nThis will:\n1. Delete this grid from the database\n2. Mark this location as available in the settlement\n\nThis action CANNOT be undone!`))try{console.log("\ud83c\udfda\ufe0f Removing homestead grid:",m);const e=await a.A.post(`${s.A}/api/remove-homestead`,{gridId:m});e.data.success?(console.log("\u2705 Homestead removed successfully"),f("\u2705 Homestead removed. Players relocated. Reloading..."),setTimeout((()=>{window.location.reload()}),1500)):(console.error("\u274c Failed to remove homestead:",e.data),f("\u274c Failed to remove homestead."))}catch(t){console.error("\u274c Error removing homestead:",t),f("\u274c Error removing homestead."),alert("Failed to remove homestead. Check console for details.")}},children:" Remove Homestead "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{try{await async function(e){let{currentPlayer:t}=e;try{const e=t.location.s;if(!e)return console.error("No settlement ID found for the current player."),void alert("No settlement ID found for the current player.");const r=(await a.A.get(`${s.A}/api/get-settlement/${e}`)).data;if(!r||!r.grids||0===r.grids.length)return console.error("Settlement data is incomplete or missing grids."),void alert("Settlement data is incomplete or missing grids.");const o=[];if(r.grids.forEach((e=>{e.forEach((e=>{"town"!==e.gridType||e.gridId||o.push(e.gridCoord)}))})),0===o.length)return console.log("No uninitialized town grids found in this settlement."),void alert("No uninitialized town grids found in this settlement.");console.log(`Found ${o.length} uninitialized town grids. Processing grids...`);for(const t of o)try{console.log(`Creating Town grid with gridCoord: ${t}`);const n=await a.A.post(`${s.A}/api/create-grid`,{gridCoord:t,gridType:"town",settlementId:e,frontierId:r.frontierId});console.log(`Processed town grid for gridCoord: ${t}`,n.data)}catch(n){console.error(`Failed to process grid for gridCoord: ${t}`,n)}alert("Town grids created successfully!")}catch(r){console.error("Error processing town grids:",r),alert("Failed to create town grids. Check the console for details.")}}({currentPlayer:c})}catch(e){console.error("Error generating town:",e),alert("Failed to generate town. Check console for details.")}},children:" Generate Town "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No player ID found. Cannot clear inventory.");const t=c.inventory.filter((e=>"Money"===e.type||"Gem"===e.type));console.log("Filtered inventory to retain only Money and Gems:",t),await a.A.post(`${s.A}/api/update-inventory`,{playerId:e,inventory:t,backpack:c.backpack||[]}),console.log("Inventory updated successfully on the server."),await(0,Kc.CP)(e,u);const n=await(0,Kc.J_)(e);console.log("Fetched inventory after clearing:",n),h(n),u((e=>({...e,inventory:n}))),f(900),console.log("Inventory cleared successfully except for Money.")}catch(e){console.error("Error clearing inventory:",e)}},children:" Clear Inventory "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No player ID found. Cannot clear skills and powers.");const t=[];console.log("Clearing all skills."),await a.A.post(`${s.A}/api/update-skills`,{playerId:e,skills:t}),console.log("Skills cleared successfully on the server.");const n=[];console.log("Clearing all powers."),await a.A.post(`${s.A}/api/update-powers`,{playerId:e,powers:n}),console.log("Powers cleared successfully on the server."),await(0,Kc.CP)(e,u),u((e=>({...e,skills:t,powers:n}))),f(905),console.log("Skills and powers cleared successfully.")}catch(e){console.error("Error clearing skills and powers:",e)}},children:" Clear Skills & Powers "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No player ID found. Cannot reset combat stats.");const t={maxhp:c.baseMaxhp,attackbonus:c.baseAttackbonus,armorclass:c.baseArmorclass,damage:c.baseDamage,attackrange:c.baseAttackrange,speed:c.baseSpeed};await $c.default.updatePC(m,e,t),console.log("Combat stats reset successfully using updatePC."),f(906)}catch(e){console.error("Error resetting combat stats:",e)}},children:" Reset Combat Stats "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No player logged in. Cannot clear quest history.");await a.A.post(`${s.A}/api/clear-quest-history`,{playerId:e});const t={...c,activeQuests:[],completedQuests:[]};u(t),console.log("Quest history cleared successfully."),f(901)}catch(e){console.error("Error clearing quest history:",e)}},children:" Clear Quest History "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No player logged in. Cannot clear relationships.");const t=["Kent","The Shepherd"],n=(c.relationships||[]).filter((e=>t.includes(e.name)));await a.A.post(`${s.A}/api/update-profile`,{playerId:e,updates:{relationships:n}});const r={...c,relationships:n};u(r),localStorage.setItem("player",JSON.stringify(r)),console.log("Relationships cleared successfully (kept Kent and The Shepherd)."),f("\u2705 Relationships cleared (kept Kent and The Shepherd).")}catch(e){console.error("Error clearing relationships:",e)}},children:" Clear Relationships "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:async e=>{if("cleargrid"===e)Fc.Ay.clearGridState(m)?(f("Grid state cleared successfully"),localStorage.removeItem(`NPCsInGrid_${m}`)):f("Failed to clear grid state");else console.warn(`Unknown debug command: ${e}`)},children:" Clear Grid State "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.username;if(!e)return void console.error("No user logged in. Cannot clear Trade Stall.");await a.A.post(`${s.A}/api/update-player-trade-stall`,{username:e,tradeStall:[]}),console.log("Trade Stall cleared successfully.")}catch(e){console.error("Error clearing Trade Stall:",e)}},children:" Clear Trade Stall "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No player ID found. Cannot clear trophies.");const t=[];console.log("Clearing all trophies."),await a.A.post(`${s.A}/api/update-profile`,{playerId:e,updates:{trophies:t}}),console.log("Trophies cleared successfully on the server."),await(0,Kc.CP)(e,u),u((e=>({...e,trophies:t}))),f("Trophies cleared successfully."),console.log("Trophies cleared successfully.")}catch(e){console.error("Error clearing trophies:",e)}},children:" Clear Trophies "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No player ID found. Cannot set all grids visited.");const t=await a.A.post(`${s.A}/api/set-all-grids-visited`,{playerId:e});t.data.success?(u((e=>({...e,gridsVisited:t.data.gridsVisited}))),console.log("\u2705 All grids marked as visited"),f("\u2705 All 4096 grids marked as visited.")):(console.error("\u274c Failed to set all grids visited:",t.data),f("\u274c Failed to set all grids visited."))}catch(e){console.error("\u274c Error setting all grids visited:",e),f("\u274c Error setting all grids visited.")}},children:" Set All Grids Visited "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{const e=null===c||void 0===c?void 0:c.playerId;if(e)try{const t=await a.A.post(`${s.A}/api/update-profile`,{playerId:e,updates:{firsttimeuser:!0,ftuestep:1}});if(t.data.success){const e={...c,firsttimeuser:!0,ftuestep:1};localStorage.setItem("player",JSON.stringify(e)),console.log("\u2705 FTUE reset successfully."),f("\u2705 FTUE reset. Refreshing page..."),setTimeout((()=>{window.location.reload()}),1e3)}else console.error("\u274c Failed to reset FTUE:",t.data.error),f("\u274c Failed to reset FTUE.")}catch(t){console.error("\u274c Error resetting FTUE:",t),f("\u274c Error resetting FTUE.")}else console.error("\u274c No player ID available.")},children:" Reset FTUE "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{const e=null===c||void 0===c?void 0:c.playerId;if(e)try{await a.A.post(`${s.A}/api/send-mailbox-message`,{playerId:e,messageId:1}),console.log("\ud83d\udcec Welcome message added to mailbox."),f("\u2705 Welcome message delivered."),await(0,Kc.CP)(e,u)}catch(t){console.error("\u274c Failed to send welcome message:",t),f("\u274c Failed to deliver welcome message.")}else console.error("\u274c No player ID available.")},children:" Resend Welcome Message "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{const e=null===c||void 0===c?void 0:c.playerId;if(e)try{await a.A.post(`${s.A}/api/send-mailbox-message`,{playerId:e,messageId:101}),console.log("\ud83d\udcec Welcome message added to mailbox."),f("\u2705 Welcome message delivered."),await(0,Kc.CP)(e,u)}catch(t){console.error("\u274c Failed to send welcome message:",t),f("\u274c Failed to deliver welcome message.")}else console.error("\u274c No player ID available.")},children:" Resend Reward Message "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No user logged in. Cannot add money.");await a.A.post(`${s.A}/api/update-inventory-delta`,{playerId:e,delta:{type:"Money",quantity:1e4,target:"inventory"}});const t=await(0,Kc.J_)(e);h(t),u((e=>({...e,inventory:t}))),await(0,Kc.CP)(e,u,!0),console.log("\u2705 Added 10,000 Money successfully using delta update.")}catch(e){console.error("\u274c Error adding money:",e)}},children:" Add Money "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No user logged in. Cannot perform Get Rich.");const t=[{type:"Money",quantity:1e5},{type:"Potion A",quantity:50},{type:"Potion B",quantity:50},{type:"Potion C",quantity:50},{type:"Gem",quantity:2e4},{type:"Book",quantity:100},{type:"Wood",quantity:1e3},{type:"Clay",quantity:1e3},{type:"Stone",quantity:1e3},{type:"Wheat",quantity:1e3},{type:"Corn",quantity:1e3},{type:"Carrot",quantity:1e3},{type:"Grapes",quantity:500},{type:"Apple",quantity:500},{type:"Bread",quantity:500},{type:"Olive Oil",quantity:500},{type:"Honey",quantity:500},{type:"Flour",quantity:500},{type:"Butter",quantity:500},{type:"Egg",quantity:500},{type:"Sugar",quantity:500},{type:"Cream",quantity:500},{type:"Lemon",quantity:500},{type:"Orange",quantity:500},{type:"Cloth",quantity:500},{type:"Lumber",quantity:500},{type:"Thread",quantity:500},{type:"Milk",quantity:500},{type:"Aged Wine",quantity:500},{type:"Sweater",quantity:500},{type:"Cheese",quantity:500},{type:"Sugarcane",quantity:500},{type:"Strawberry",quantity:500},{type:"Diamond Ring",quantity:500},{type:"Feverfew",quantity:100},{type:"Golden Key",quantity:100},{type:"Skeleton Key",quantity:100},{type:"Furniture",quantity:100},{type:"Port",quantity:100},{type:"Wool",quantity:500},{type:"Scroll",quantity:100},{type:"Runic Tunic",quantity:100},{type:"Pumpkin Soup",quantity:100},{type:"Cornmeal",quantity:100},{type:"Pepper Cheese",quantity:100},{type:"Portrait",quantity:10},{type:"Trident",quantity:10},{type:"Yellow Heart",quantity:1e3},{type:"Green Heart",quantity:500},{type:"Purple Heart",quantity:500},{type:"Saw",quantity:10},{type:"Shovel",quantity:20},{type:"Screwdriver",quantity:30}];await a.A.post(`${s.A}/api/update-inventory-delta`,{playerId:e,delta:t.map((e=>({...e,target:"inventory"})))});const n=await(0,Kc.J_)(e);h(n),u((e=>({...e,inventory:n}))),await(0,Kc.CP)(e,u,!0),console.log("\ud83d\udcb0 Get Rich: Inventory updated successfully via delta.")}catch(e){console.error("\u274c Error performing Get Rich:",e)}},children:" Get Rich "})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{try{const e=null===c||void 0===c?void 0:c.playerId;if(!e)return void console.error("No user logged in. Cannot add skills.");const t=(await a.A.get(`${s.A}/api/resources`)).data;if(!Array.isArray(t))return void console.error("Master resources are not an array:",t);const n=t.filter((e=>"skill"===e.category));if(0===n.length)return console.warn("No skill resources found."),void alert("No skill resources available to add.");const r=await a.A.get(`${s.A}/api/skills/${e}`),o=[...r.data.skills||[]];n.forEach((e=>{const t=o.find((t=>t.type===e.type));t?t.quantity+=1:o.push({type:e.type,quantity:1})})),await a.A.post(`${s.A}/api/update-skills`,{playerId:e,skills:o});const i={...c,skills:o};u(i),localStorage.setItem("player",JSON.stringify(i)),f(904),console.log("Get Skills: Added skills successfully.")}catch(e){console.error("Error adding skills:",e),alert("Failed to add skills. Check console for details.")}},children:" Get Skills "})}),(0,d.jsx)("h3",{children:"Create Single Valley Grid"}),(0,d.jsx)("input",{type:"text",placeholder:"Enter GridCoord",value:N,onChange:e=>R(e.target.value)}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{var e,t,n;const r=null===c||void 0===c||null===(e=c.location)||void 0===e?void 0:e.s,o=null===c||void 0===c||null===(t=c.location)||void 0===t?void 0:t.f;null===c||void 0===c||null===(n=c.location)||void 0===n||n.gtype;if(N&&r&&o)try{await async function(e){let{gridCoord:t}=e;try{console.log("\ud83d\udd0d Fetching all settlements to determine gridType for gridCoord:",t);const e=(await a.A.get(`${s.A}/api/settlements`)).data;if(!e||0===e.length)throw new Error("No settlements returned from the server");let n=null,r=null,o=null;for(const a of e)if(a.grids){for(const e of a.grids){for(const s of e)if(console.log(`\ud83d\udd0d Checking gridCoord ${s.gridCoord} (type: ${typeof s.gridCoord}) against input ${t}`),String(s.gridCoord)===String(t)){n=s,r=a._id,o=a.frontierId;break}if(n)break}if(n)break}if(!n)return console.warn(`\u2757 GridCoord ${t} not found in any settlement.`),void alert("GridCoord not found in any settlement data.");const i={gridCoord:t,gridType:n.gridType,settlementId:r,frontierId:o};console.log("\ud83d\udce4 Sending grid creation request with:",i);const l=await a.A.post(`${s.A}/api/create-grid`,i);console.log(`\u2705 Grid created: ${t}`,l.data),alert(`Grid ${t} created successfully!`)}catch(n){console.error(`\u274c Failed to create grid ${t}:`,n),alert(`Failed to create grid ${t}. See console for details.`)}}({gridCoord:N})}catch(i){console.error("Error creating single valley grid:",i),alert("Failed to create valley grid. See console for details.")}else alert("Missing gridCoord, settlementId, or frontierId.")},children:"Create Grid"})}),(0,d.jsx)("h3",{children:"Delete User Account"}),(0,d.jsx)("input",{type:"text",placeholder:"Enter Username",value:D,onChange:e=>O(e.target.value)}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{if(window.confirm(`\u26a0\ufe0f Are you absolutely sure you want to permanently delete the account for "${D}"? This cannot be undone.`))try{await(async e=>{var t;if("object"===typeof e&&null!==(t=e)&&void 0!==t&&t.username&&(e=e.username),e)try{const t=(await a.A.get(`${s.A}/api/get-player-by-username/${e}`)).data;if(!t||!t._id)return void alert(`Player not found for username: ${e}`);if(!window.confirm(`Are you sure you want to delete the account for "${e}"? This cannot be undone.`))return;const n=await a.A.post(`${s.A}/api/delete-player`,{playerId:t._id});n.data.success?(alert(`\u2705 Account for "${e}" deleted successfully.`),console.log(`\u2705 Account deleted for username: ${e}`)):(alert("\u274c Failed to delete account. See console for details."),console.error("Delete failed:",n.data))}catch(n){console.error("\u274c Error deleting account:",n),alert("An error occurred while trying to delete the account.")}else alert("Please enter a username.")})({username:D})}catch(e){console.error("Error deleting user account:",e),alert("Failed to delete user account. See console for details.")}},children:"Delete"})}),(0,d.jsx)("h3",{children:"Delete Orphaned Grid"}),(0,d.jsx)("input",{type:"text",placeholder:"Enter Grid ID",value:F,onChange:e=>$(e.target.value)}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:()=>(async e=>{if(!e)return void alert("Please enter a Grid ID.");if(window.confirm(`\u26a0\ufe0f Are you sure you want to delete orphaned grid?\n\nGrid ID: ${e}\n\nThis will:\n1. Delete this grid from the database\n2. Mark this location as available in the settlement\n\nThis action CANNOT be undone!`))try{console.log("\ud83d\uddd1\ufe0f Deleting orphaned grid:",e);const t=await a.A.post(`${s.A}/api/delete-orphaned-grid`,{gridId:e});t.data.success?(console.log("\u2705 Orphaned grid deleted successfully"),f("\u2705 Orphaned grid deleted and settlement updated."),$("")):(console.error("\u274c Failed to delete orphaned grid:",t.data),f(`\u274c ${t.data.error||"Failed to delete orphaned grid."}`))}catch(t){console.error("\u274c Error deleting orphaned grid:",t),f("\u274c Error deleting orphaned grid."),alert("Failed to delete orphaned grid. Check console for details.")}})(F),children:"Delete"})}),(0,d.jsx)("h3",{children:"Send Message to All Users"}),(0,d.jsx)("input",{type:"text",placeholder:"Enter Message ID",value:B,onChange:e=>L(e.target.value)}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{if(B)try{await(async e=>{try{await a.A.post(`${s.A}/api/send-mailbox-message-all`,{messageId:e}),console.log(`\ud83d\udcec Message ${e} added to mailbox for all users.`),f(`\u2705 Message ${e} delivered to all users.`),null!==c&&void 0!==c&&c.playerId&&await(0,Kc.CP)(c.playerId,u)}catch(t){console.error(`\u274c Failed to send message ${e}:`,t),f(`\u274c Failed to deliver message ${e}.`)}})(Number(B))}catch(e){console.error("Error sending message to all users:",e),alert("Failed to send message. See console for details.")}else alert("Please enter a message ID.")},children:"Send Message"})}),(0,d.jsxs)("div",{className:"debug-timers",children:[(0,d.jsx)("h3",{children:"\u23f3 Active Timers:"}),w.length>0?(0,d.jsx)("ul",{children:w.map(((e,t)=>(0,d.jsxs)("li",{children:[e.type," at (",e.x,", ",e.y,") -",e.growEnd?` \ud83c\udf31 Farming Timer Ends in ${e.remainingTime}s`:"",e.craftedItem?` \ud83d\udee0\ufe0f ${e.craftedItem}: `:"",e.craftEnd?` Ends in ${e.remainingTime}s`:""]},t)))}):(0,d.jsx)("p",{children:"No active timers."})]}),(0,d.jsx)(Sh,{gridId:m,gridCoord:null===c||void 0===c||null===(r=c.location)||void 0===r?void 0:r.gridCoord,gridType:null===c||void 0===c||null===(o=c.location)||void 0===o?void 0:o.gtype,settlementId:null===c||void 0===c||null===(i=c.location)||void 0===i?void 0:i.s,NPCsInGrid:{[m]:Fc.Ay.getNPCsInGrid(m)},playersInGrid:{[m]:$c.default.getPlayersInGrid(m)}})]})},Ch=e=>{let{inventory:n,masterResources:o,showActions:a=!1,warehouseAmounts:s,setWarehouseAmounts:i,handleAmountChange:l,handleDiscardWarehouseItem:c,amounts:u,setAmounts:h,handleActionItem:p,actionButtonText:m,actionButtonClass:f="btn-danger",isActionDisabled:g,handleSecondAction:y,secondActionButtonText:v,secondActionButtonClass:b="btn-success",strings:x}=e;const w=(0,r.k)(),S=x||w,[T,C]=(0,t.useState)("name"),[k,A]=(0,t.useState)("asc"),I=(0,t.useMemo)((()=>n.filter((e=>!(0,Kc.sy)(e.type))).sort(((e,t)=>{let n,r;switch(T){case"name":n=(0,Bc.Z)(e.type,S).toLowerCase(),r=(0,Bc.Z)(t.type,S).toLowerCase();break;case"quantity":n=e.quantity,r=t.quantity;break;case"food":const a=o.find((t=>t.type===e.type)),s=o.find((e=>e.type===t.type));n=(null===a||void 0===a?void 0:a.hp)>0?1:0,r=(null===s||void 0===s?void 0:s.hp)>0?1:0;break;default:return 0}return n<r?"asc"===k?-1:1:n>r?"asc"===k?1:-1:0}))),[n,S,T,k]),E=e=>{T===e?A("asc"===k?"desc":"asc"):(C(e),A("asc"))},P=e=>T!==e?"\u2195\ufe0f":"asc"===k?"\u2b06\ufe0f":"\u2b07\ufe0f";return 0===I.length?(0,d.jsx)("p",{children:S[76]}):(0,d.jsxs)("div",{className:"manage-contents-container",children:[(0,d.jsx)("div",{className:"manage-contents-header",children:(0,d.jsx)("table",{children:(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{onClick:()=>E("food"),className:"sortable-header",children:P("food")}),(0,d.jsxs)("th",{onClick:()=>E("name"),className:"sortable-header",children:[S[191]||"Item"," ",P("name")]}),(0,d.jsxs)("th",{onClick:()=>E("quantity"),className:"sortable-header",children:[S[185]||"Quantity"," ",P("quantity")]}),a&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("th",{children:S[186]||"Amount"}),(0,d.jsx)("th",{children:S[192]||"Action"}),y&&(0,d.jsx)("th",{children:S[192]||"Action"})]})]})})})}),(0,d.jsx)("div",{className:"manage-contents-scroll",children:(0,d.jsx)("table",{children:(0,d.jsx)("tbody",{children:I.map(((e,t)=>{const n=o.find((t=>t.type===e.type)),r=(null===n||void 0===n?void 0:n.hp)>0;return(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:r?`\u2764\ufe0f\u200d\ud83e\ude79 +${n.hp}`:""}),(0,d.jsxs)("td",{children:[(null===n||void 0===n?void 0:n.symbol)||""," ",(0,Bc.Z)(e.type,S)]}),(0,d.jsx)("td",{children:e.quantity.toLocaleString()}),a&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("td",{children:(0,d.jsxs)("div",{className:"amount-input",children:[(0,d.jsx)("button",{onClick:()=>l(s,i,e.type,(s[e.type]||0)-1,e.quantity),disabled:(s[e.type]||0)<=0,children:"-"}),(0,d.jsx)("input",{type:"number",value:s[e.type]||0,onChange:t=>l(s,i,e.type,parseInt(t.target.value,10)||0,e.quantity)}),(0,d.jsx)("button",{onClick:()=>l(s,i,e.type,(s[e.type]||0)+1,e.quantity),disabled:(s[e.type]||0)>=e.quantity,children:"+"}),(0,d.jsx)("button",{onClick:()=>l(s,i,e.type,e.quantity,e.quantity),style:{marginLeft:"4px"},children:S[165]})]})}),(0,d.jsx)("td",{children:"special"!==(null===n||void 0===n?void 0:n.category)&&(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:`btn-basic ${f||"btn-danger"} btn-mini`,onClick:()=>c(e),disabled:!(s[e.type]>0&&s[e.type]<=e.quantity),children:m||S[188]})})}),y&&(0,d.jsx)("td",{children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:`btn-basic ${b} btn-mini`,onClick:()=>y(e),disabled:!((u||s)[e.type]>0&&(u||s)[e.type]<=e.quantity),children:v||S[180]})})})]})]},t)}))})})})]})};const kh=function(e){var n,o,i,l,c,u,h;let{onClose:p,masterResources:m,globalTuning:f,currentPlayer:g,setCurrentPlayer:y,setInventory:v,setBackpack:b,updateStatus:x,openPanel:w,setActiveStation:S,setModalContent:T,setIsModalOpen:C}=e;const k=(0,r.k)(),A=(null===g||void 0===g?void 0:g.inventory)||[],I=(null===g||void 0===g?void 0:g.backpack)||[],[E,P]=(null===g||void 0===g||g.warehouseCapacity,null===g||void 0===g||g.backpackCapacity,(0,t.useState)(!1)),[_,N]=(0,t.useState)(!1),[R,M]=(0,t.useState)("name"),[j,D]=(0,t.useState)("asc"),[O,B]=(0,t.useState)("name"),[L,F]=(0,t.useState)("asc"),[$,G]=(0,t.useState)({}),[z,U]=(0,t.useState)({}),H=null===g||void 0===g||null===(n=g.skills)||void 0===n?void 0:n.some((e=>"Backpack"===e.type)),q=(0,Kc.O_)(g,m,f),V=(null===f||void 0===f?void 0:f.warehouseCapacityGold)||1e5,W=(null===f||void 0===f?void 0:f.backpackCapacityGold)||5e3,Y=e=>e.filter((e=>!(0,Kc.sy)(e.type))).reduce(((e,t)=>e+t.quantity),0),K=e=>{R===e?D("asc"===j?"desc":"asc"):(M(e),D("asc"))},X=e=>R!==e?"\u2195\ufe0f":"asc"===j?"\u2b06\ufe0f":"\u2b07\ufe0f",Z=e=>{O===e?F("asc"===L?"desc":"asc"):(B(e),F("asc"))},J=e=>O!==e?"\u2195\ufe0f":"asc"===L?"\u2b06\ufe0f":"\u2b07\ufe0f",Q=(e,t,n,r,o)=>{const a=Math.min(Math.max(0,r),o);t((e=>({...e,[n]:a})))},ee=async()=>{const e=g.location.g===g.gridId;try{if(e){const e=I.filter((e=>{const t=m.find((t=>t.type===e.type));return"special"!==(null===t||void 0===t?void 0:t.category)})),t=e.reduce(((e,t)=>e+t.quantity),0),n=Y(A);if(t>q.warehouse-n)return void x(20);const r=[...A];e.forEach((e=>{const t=r.findIndex((t=>t.type===e.type));-1!==t?r[t].quantity+=e.quantity:r.push(e)}));const o=I.filter((e=>{const t=m.find((t=>t.type===e.type));return"special"===(null===t||void 0===t?void 0:t.category)}));await a.A.post(`${s.A}/api/update-inventory`,{playerId:g.playerId,inventory:r,backpack:o}),y({...g,inventory:r,backpack:o}),v(r),b(o),x("Moved all items to warehouse")}else{const e=I.filter((e=>{const t=m.find((t=>t.type===e.type));return"special"===(null===t||void 0===t?void 0:t.category)}));await a.A.post(`${s.A}/api/update-inventory`,{playerId:g.playerId,backpack:e}),y({...g,backpack:e}),b(e),x("\u274c Discarded all items except special items")}}catch(t){console.error("Error updating inventory:",t)}};return(0,d.jsxs)(Zc,{onClose:p,descriptionKey:"1001",titleKey:"1101",panelName:"InventoryPanel",children:[(0,d.jsxs)("div",{className:"currency-section",children:[(0,d.jsxs)("div",{className:"currency-display",children:[(0,d.jsxs)("div",{className:"currency-column",children:[(0,d.jsxs)("div",{className:"currency-item",title:(0,Bc.Z)("Money",k),style:{cursor:"help"},children:[(0,d.jsx)("span",{className:"currency-emoji",children:"\ud83d\udcb0"}),(0,d.jsx)("span",{className:"currency-amount",children:((null===(o=A.find((e=>"Money"===e.type)))||void 0===o?void 0:o.quantity)||0).toLocaleString("en-US")})]}),(0,d.jsxs)("div",{className:"currency-item",title:(0,Bc.Z)("Gem",k),style:{cursor:"help"},children:[(0,d.jsx)("span",{className:"currency-emoji",children:"\ud83d\udc8e"}),(0,d.jsx)("span",{className:"currency-amount",children:((null===(i=A.find((e=>"Gem"===e.type)))||void 0===i?void 0:i.quantity)||0).toLocaleString("en-US")})]}),(0,d.jsxs)("div",{className:"currency-item",title:(0,Bc.Z)("Home Deed",k),style:{cursor:"help"},children:[(0,d.jsx)("span",{className:"currency-emoji",children:"\ud83c\udfe0"}),(0,d.jsx)("span",{className:"currency-amount",children:((null===(l=A.find((e=>"Home Deed"===e.type)))||void 0===l?void 0:l.quantity)||0).toLocaleString("en-US")})]})]}),(0,d.jsxs)("div",{className:"currency-column",children:[(0,d.jsxs)("div",{className:"currency-item",title:(0,Bc.Z)("Yellow Heart",k),style:{cursor:"help"},children:[(0,d.jsx)("span",{className:"currency-emoji",children:"\ud83d\udc9b"}),(0,d.jsx)("span",{className:"currency-amount",children:((null===(c=A.find((e=>"Yellow Heart"===e.type)))||void 0===c?void 0:c.quantity)||0).toLocaleString("en-US")})]}),(0,d.jsxs)("div",{className:"currency-item",title:(0,Bc.Z)("Green Heart",k),style:{cursor:"help"},children:[(0,d.jsx)("span",{className:"currency-emoji",children:"\ud83d\udc9a"}),(0,d.jsx)("span",{className:"currency-amount",children:((null===(u=A.find((e=>"Green Heart"===e.type)))||void 0===u?void 0:u.quantity)||0).toLocaleString("en-US")})]}),(0,d.jsxs)("div",{className:"currency-item",title:(0,Bc.Z)("Purple Heart",k),style:{cursor:"help"},children:[(0,d.jsx)("span",{className:"currency-emoji",children:"\ud83d\udc9c"}),(0,d.jsx)("span",{className:"currency-amount",children:((null===(h=A.find((e=>"Purple Heart"===e.type)))||void 0===h?void 0:h.quantity)||0).toLocaleString("en-US")})]})]})]}),(0,d.jsx)("div",{className:"currency-keys-row",style:{display:"flex",justifyContent:"flex-start",gap:"12px",marginTop:"8px",flexWrap:"wrap"},children:m.filter((e=>(0,Kc.sy)(e.type)&&e.type.includes("Key"))).map((e=>{var t;const n=(null===(t=A.find((t=>t.type===e.type)))||void 0===t?void 0:t.quantity)||0;return(0,d.jsxs)("div",{className:"currency-item",title:(0,Bc.Z)(e.type,k),style:{cursor:"help"},children:[(0,d.jsx)("span",{className:"currency-emoji",children:e.symbol||"\ud83d\udd11"}),(0,d.jsx)("span",{className:"currency-amount",children:n})]},e.type)}))})]}),(0,d.jsx)("hr",{className:"inventory-divider"}),(0,d.jsxs)("div",{className:"inventory-section-header",children:[(0,d.jsx)("h3",{children:k[182]}),H&&(0,d.jsxs)("div",{className:"capacity-info",children:[Y(I)," / "," ",(0,d.jsx)("span",{style:"Gold"===(null===g||void 0===g?void 0:g.accountStatus)?{color:"#B8860B"}:{},children:q.backpack})]})]}),H?(0,d.jsxs)(d.Fragment,{children:["Gold"===(null===g||void 0===g?void 0:g.accountStatus)&&(0,d.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginTop:"-5px",textAlign:"center",marginBottom:"8px"},children:["(+",W.toLocaleString()," ",k[89]||"additional capacity for Gold Pass",")"]}),I.length>0&&(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"8px"},children:[(0,d.jsx)("button",{className:"btn-basic",style:{flex:1},onClick:()=>P(!0),children:k[184]}),(0,d.jsx)("div",{style:{flex:1}})]}),(0,d.jsx)("div",{className:"backpack-table-container",style:{height:"auto",maxHeight:"300px"},children:I.filter((e=>!(0,Kc.sy)(e.type))).length>0?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"backpack-table-header",children:(0,d.jsx)("table",{children:(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsxs)("th",{onClick:()=>Z("name"),className:"sortable-header",children:[k[191]||"Item"," ",J("name")]}),(0,d.jsxs)("th",{onClick:()=>Z("quantity"),className:"sortable-header",children:[k[185]||"Quantity"," ",J("quantity")]})]})})})}),(0,d.jsx)("div",{className:"backpack-table-scroll",children:(0,d.jsx)("table",{children:(0,d.jsx)("tbody",{children:I.filter((e=>!(0,Kc.sy)(e.type))).sort(((e,t)=>{let n,r;switch(O){case"name":n=(0,Bc.Z)(e.type,k).toLowerCase(),r=(0,Bc.Z)(t.type,k).toLowerCase();break;case"quantity":n=e.quantity,r=t.quantity;break;default:return 0}return n<r?"asc"===L?-1:1:n>r?"asc"===L?1:-1:0})).map(((e,t)=>{var n;return(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[(null===(n=m.find((t=>t.type===e.type)))||void 0===n?void 0:n.symbol)||""," ",(0,Bc.Z)(e.type,k)]}),(0,d.jsx)("td",{children:e.quantity.toLocaleString()})]},t)}))})})})]}):(0,d.jsx)("p",{children:k[77]})})]}):(0,d.jsx)("div",{className:"capacity-display",children:k[75]}),(0,d.jsx)("hr",{className:"inventory-divider"}),(0,d.jsxs)("div",{className:"inventory-section-header",children:[(0,d.jsx)("h3",{children:k[181]}),(0,d.jsxs)("div",{className:"capacity-info",children:[Y(A)," / "," ",(0,d.jsx)("span",{style:"Gold"===(null===g||void 0===g?void 0:g.accountStatus)?{color:"#B8860B"}:{},children:q.warehouse})]})]}),"Gold"===(null===g||void 0===g?void 0:g.accountStatus)&&(0,d.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginTop:"-5px",textAlign:"center",marginBottom:"8px"},children:["(+",V.toLocaleString()," ",k[89]||"additional capacity for Gold Pass",")"]}),(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"8px"},children:[A.length>0&&(0,d.jsx)("button",{className:"btn-basic",style:{flex:1},onClick:()=>N(!0),disabled:g.location.g!==g.gridId,title:g.location.g!==g.gridId?"Must be at homestead to manage warehouse":"",children:k[184]}),(0,d.jsx)("button",{className:"btn-basic btn-success",style:{flex:1},onClick:()=>{p(),setTimeout((()=>{w("WarehousePanel")}),0)},children:k[194]})]}),(0,d.jsx)("div",{className:"inventory-table-container",children:A.filter((e=>!(0,Kc.sy)(e.type))).length>0?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"inventory-table-header",children:(0,d.jsx)("table",{children:(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsxs)("th",{onClick:()=>K("name"),className:"sortable-header",children:[k[191]||"Item"," ",X("name")]}),(0,d.jsxs)("th",{onClick:()=>K("quantity"),className:"sortable-header",children:[k[185]||"Quantity"," ",X("quantity")]})]})})})}),(0,d.jsx)("div",{className:"inventory-table-scroll",children:(0,d.jsx)("table",{children:(0,d.jsx)("tbody",{children:A.filter((e=>!(0,Kc.sy)(e.type))).sort(((e,t)=>{let n,r;switch(R){case"name":n=(0,Bc.Z)(e.type,k).toLowerCase(),r=(0,Bc.Z)(t.type,k).toLowerCase();break;case"quantity":n=e.quantity,r=t.quantity;break;default:return 0}return n<r?"asc"===j?-1:1:n>r?"asc"===j?1:-1:0})).map(((e,t)=>{var n;return(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[(null===(n=m.find((t=>t.type===e.type)))||void 0===n?void 0:n.symbol)||""," ",(0,Bc.Z)(e.type,k)]}),(0,d.jsx)("td",{children:e.quantity.toLocaleString()})]},t)}))})})})]}):(0,d.jsx)("p",{children:k[76]})}),E&&(()=>{const e=g.location.g===g.gridId,t=I.filter((e=>{const t=m.find((t=>t.type===e.type));return"special"!==(null===t||void 0===t?void 0:t.category)})),n=0===I.length||0===t.length;return(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container modal-large",children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:()=>P(!1),children:"\xd7"}),(0,d.jsx)("div",{className:"modal-title",children:k[187]}),(0,d.jsx)(Ch,{inventory:I,masterResources:m,showActions:!0,warehouseAmounts:$,setWarehouseAmounts:G,handleAmountChange:Q,handleDiscardWarehouseItem:e=>{const t=m.find((t=>t.type===e.type));!("special"===(null===t||void 0===t?void 0:t.category))&&$[e.type]>0&&$[e.type]<=e.quantity&&(async e=>{const t=g.location.g===g.gridId,n=$[e.type]||0;if(!(n<=0))try{if(t){const t=Y(A),r=q.warehouse-t;if(n>r)return void x(20);const o=[...A],i=o.findIndex((t=>t.type===e.type));-1!==i?o[i].quantity+=n:o.push({...e,quantity:n});const l=I.map((t=>{if(t.type===e.type){const e=t.quantity-n;return e>0?{...t,quantity:e}:null}return t})).filter(Boolean);await a.A.post(`${s.A}/api/update-inventory`,{playerId:g.playerId,inventory:o,backpack:l}),y({...g,inventory:o,backpack:l}),v(o),b(l),x(`Moved ${n}x ${(0,Bc.Z)(e.type,k)} to warehouse`)}else{const t=I.map((t=>{if(t.type===e.type){const e=t.quantity-n;return e>0?{...t,quantity:e}:null}return t})).filter(Boolean);await a.A.post(`${s.A}/api/update-inventory`,{playerId:g.playerId,backpack:t}),y({...g,backpack:t}),b(t),x(`\u274c Discarded ${n}x ${(0,Bc.Z)(e.type,k)}`)}}catch(r){console.error("Error updating inventory:",r)}})(e)},actionButtonText:e?k[196]:k[188],actionButtonClass:"btn-success",strings:k}),(0,d.jsx)("div",{className:"modal-buttons shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-modal btn-success",onAction:ee,disabled:n,transactionKey:`move-all-${null===g||void 0===g?void 0:g.gridId}`,children:e?k[189]:k[190]})})]})})})(),_&&(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container modal-large",children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:()=>N(!1),children:"\xd7"}),(0,d.jsx)("div",{className:"modal-title",children:k[193]}),(0,d.jsx)(Ch,{inventory:A,masterResources:m,showActions:!0,warehouseAmounts:z,setWarehouseAmounts:U,handleAmountChange:Q,handleDiscardWarehouseItem:async e=>{try{const t=z[e.type]||0;if(t<=0)return;const n=A.map((n=>{if(n.type===e.type){const e=n.quantity-t;return e>0?{...n,quantity:e}:null}return n})).filter(Boolean);await a.A.post(`${s.A}/api/update-inventory`,{playerId:g.playerId,inventory:n}),y({...g,inventory:n}),v(n),x(`\u274c Discarded ${t}x ${(0,Bc.Z)(e.type,k)}`)}catch(t){console.error("Error updating inventory:",t)}},handleSecondAction:async e=>{try{const t=z[e.type]||0;if(t<=0)return;if(!(0,Kc.Pu)({resource:e.type,quantity:t,currentPlayer:g,inventory:A,backpack:I,masterResources:m,globalTuning:f})){const e=Y(I),n=q.backpack-e;return void x(`\u274c Insufficient backpack capacity. Need ${t-n} more slots.`)}const n=await a.A.post(`${s.A}/api/transfer-inventory`,{playerId:g.playerId,transfers:[{itemType:e.type,quantity:t}],direction:"warehouse-to-backpack"});n.data.success&&(y({...g,inventory:n.data.inventory,backpack:n.data.backpack}),v(n.data.inventory),b(n.data.backpack),U((t=>({...t,[e.type]:0}))),x(`\u2705 Moved ${t}x ${(0,Bc.Z)(e.type,k)} to backpack`))}catch(r){var t,n;console.error("Error transferring to backpack:",r),null!==(t=r.response)&&void 0!==t&&null!==(n=t.data)&&void 0!==n&&n.error?x(`\u274c ${r.response.data.error}`):x("\u274c Transfer failed. Please try again.")}},secondActionButtonText:k[180],secondActionButtonClass:"btn-success",strings:k}),(0,d.jsx)("div",{className:"modal-buttons shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-modal btn-danger",onClick:()=>{T({title:"Are you sure?",message:"This will permanently discard ALL items in your warehouse!",message2:"This action cannot be undone.",custom:(0,d.jsxs)("div",{className:"shared-buttons",style:{marginTop:"20px",display:"flex",justifyContent:"center",gap:"10px"},children:[(0,d.jsx)("button",{className:"btn-basic btn-modal btn-danger",onClick:()=>{(async()=>{try{await a.A.post(`${s.A}/api/update-inventory`,{playerId:g.playerId,inventory:[]}),y({...g,inventory:[]}),v([]),x("\u274c Discarded all warehouse items"),N(!1)}catch(e){console.error("Error updating inventory:",e)}})(),C(!1)},children:"Yes, Discard All"}),(0,d.jsx)("button",{className:"btn-basic btn-modal btn-success",onClick:()=>C(!1),children:"Cancel"})]})}),C(!0)},children:k[190]})})]})})]})},Ah=e=>{var t,n;let{resource:r,inventory:o,backpack:a,masterResources:s,currentPlayer:i,strings:l,overrideGemCost:c=null}=e;const u=o||[],h=a||[],p=s||[],m=((null===(t=u.find((e=>"Gem"===e.type)))||void 0===t?void 0:t.quantity)||0)+((null===(n=h.find((e=>"Gem"===e.type)))||void 0===n?void 0:n.quantity)||0),f=(null===i||void 0===i?void 0:i.skills)||[],g=[];for(let d=1;d<=10;d++){const e=r[`ingredient${d}`],t=r[`ingredient${d}qty`];if(e&&t){var y,v;const n=p.find((t=>t.type===e)),r=((null===(y=u.find((t=>t.type===e)))||void 0===y?void 0:y.quantity)||0)+((null===(v=h.find((t=>t.type===e)))||void 0===v?void 0:v.quantity)||0),o=Math.min(r,t);o>0&&g.push({symbol:(null===n||void 0===n?void 0:n.symbol)||"",name:(0,Bc.Z)(e,l),amount:o})}}if(r.requires){const e=p.find((e=>e.type===r.requires));f.some((e=>e.type===r.requires))&&g.push({symbol:(null===e||void 0===e?void 0:e.symbol)||"",name:(0,Bc.Z)(r.requires,l),amount:"\u2713",isSkill:!0})}let b;if(null!==c&&void 0!==c)b=c;else{let e=0;for(let t=1;t<=10;t++){const n=r[`ingredient${t}`],o=r[`ingredient${t}qty`];if(n&&o){var x,w;const t=((null===(x=u.find((e=>e.type===n)))||void 0===x?void 0:x.quantity)||0)+((null===(w=h.find((e=>e.type===n)))||void 0===w?void 0:w.quantity)||0),r=Math.max(0,o-t);if(r>0){const t=p.find((e=>e.type===n));e+=((null===t||void 0===t?void 0:t.gemcost)||1)*r}}}if(r.requires){if(!f.some((e=>e.type===r.requires))){const t=p.find((e=>e.type===r.requires));e+=(null===t||void 0===t?void 0:t.gemcost)||1}}b=Math.ceil(e),0===b&&e>0&&(b=1)}const S=m>=b;return{render:()=>(0,d.jsxs)("div",{className:"gem-purchase-tooltip",children:[(0,d.jsxs)("div",{className:"spending-summary",children:[(0,d.jsx)("div",{className:"spending-label",children:"Will use:"}),g.map(((e,t)=>(0,d.jsxs)("div",{className:"spending-line",children:[e.symbol," ",e.amount," ",e.isSkill?"(Skill)":""]},t))),(0,d.jsxs)("div",{className:"spending-line gem-line",children:["\ud83d\udc8e ",b,"  (You have: \ud83d\udc8e ",m,")"]})]}),!S&&(0,d.jsx)("div",{className:"tooltip-footer",children:"Click for more \ud83d\udc8e"})]}),getModifiedRecipe:()=>{const e={...r};for(let a=1;a<=10;a++){const o=r[`ingredient${a}`],s=r[`ingredient${a}qty`];if(o&&s){var t,n;const r=((null===(t=u.find((e=>e.type===o)))||void 0===t?void 0:t.quantity)||0)+((null===(n=h.find((e=>e.type===o)))||void 0===n?void 0:n.quantity)||0);e[`ingredient${a}qty`]=Math.min(r,s)}}let o=1;for(let a=1;a<=10;a++)if(!r[`ingredient${a}`]){o=a;break}return e[`ingredient${o}`]="Gem",e[`ingredient${o}qty`]=b,e},hasEnoughGems:S,gemCost:b}},Ih=e=>e&&"string"===typeof e?e.replace(/\b(\d{4,})\b/g,((e,t)=>(e=>"number"===typeof e?e.toLocaleString():"string"!==typeof e||isNaN(Number(e))?e:Number(e).toLocaleString())(parseInt(t,10)))):e,Eh=e=>{let{symbol:n,name:o,details:a,info:s,disabled:i,className:l,style:c,onClick:u,hideInfo:h=!1,children:p,transactionKey:m,onTransactionAction:f,isTransactionMode:g=!1,gemCost:y=null,onGemPurchase:v=null,hideGem:b=!1,meetsLevelRequirement:x=!0,resource:w=null,inventory:S=null,backpack:T=null,masterResources:C=null,currentPlayer:k=null,devOnly:A=!1,filename:I=null,resourceType:E=null}=e;const P=(0,r.k)(),{openPanel:_}=(0,Xc.d)(),[N,R]=(0,t.useState)(!1),[M,j]=(0,t.useState)({top:0,left:0}),[D,O]=(0,t.useState)(!1),[B,L]=(0,t.useState)((()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`)),[F,$]=(0,t.useState)(!1),[G,z]=(0,t.useState)({top:0,left:0}),U=(0,t.useRef)(null),H=!!(w&&S&&T&&C&&k&&v&&(y||null!==w&&void 0!==w&&w.gemcost)),q=(0,t.useMemo)((()=>{if(!H)return null;try{return Ah({resource:w,inventory:S,backpack:T,masterResources:C,currentPlayer:k,strings:P,overrideGemCost:y})}catch(e){return console.error("Error creating gem calculation:",e),null}}),[H,w,S,T,C,k,P]);(0,t.useEffect)((()=>{g&&m&&console.log(`\ud83d\udcf1 [RESOURCE_BUTTON] Processing state changed: ${D} for ${m}`)}),[D,m,g]);const V=e=>{j({top:e.clientY+window.scrollY+10,left:e.clientX+window.scrollX+15})},W=e=>{z({top:e.clientY+window.scrollY+10,left:e.clientX+window.scrollX+15})};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"resource-button-wrapper","data-resource-type":E||o,children:[(0,d.jsxs)("button",{ref:U,className:`resource-button ${i||D?"disabled":""} ${l||""} ${D?"processing":""} ${A?"dev-only":""}`,onClick:async e=>{if(!i&&!D)if(g&&f&&m){e.preventDefault(),e.stopPropagation(),console.log(`\ud83d\udd12 [RESOURCE_BUTTON] Setting processing state for ${m}`),O(!0);try{await f(B,m),console.log(`\u2705 [RESOURCE_BUTTON] Transaction completed for ${m}`),L(`${Date.now()}-${Math.random().toString(36).substr(2,9)}`)}catch(t){console.error("Transaction failed:",t)}finally{console.log(`\ud83d\udd13 [RESOURCE_BUTTON] Clearing processing state for ${m}`),O(!1)}}else u&&u(e)},disabled:i||D,style:{opacity:i||D?.6:1,cursor:i||D?"not-allowed":"pointer",...c},children:[(0,d.jsxs)("span",{className:"resource-title",children:[D?"\u23f3":I?(0,d.jsx)("img",{src:`/assets/resources/${I}`,alt:o,style:{width:"24px",height:"24px",verticalAlign:"middle",marginRight:"4px"}}):n," ",D?"Processing...":o]}),!D&&(0,d.jsx)("span",{className:"resource-details",dangerouslySetInnerHTML:{__html:a?Ih(a):a}}),p,!h&&s&&(0,d.jsx)("span",{className:"info-button",onMouseEnter:e=>{R(!0),V(e)},onMouseMove:V,onMouseLeave:()=>R(!1),children:"\u2139\ufe0f"})]}),!b&&x&&H&&q&&!D&&(0,d.jsx)("span",{className:"gem-button",onClick:e=>{if(e.preventDefault(),e.stopPropagation(),v&&q)if(q.hasEnoughGems){const e=q.getModifiedRecipe();v(e)}else _("HowToGemsPanel")},onMouseEnter:e=>{$(!0),W(e)},onMouseMove:W,onMouseLeave:()=>$(!1),children:"\ud83d\udc8e"})]}),N&&s&&cu.createPortal((0,d.jsx)("div",{className:"info-toaster",style:{top:M.top,left:M.left,position:"absolute"},children:"string"===typeof s?(0,d.jsx)("p",{dangerouslySetInnerHTML:{__html:s}}):(0,d.jsx)(d.Fragment,{children:s})}),document.body),F&&q&&cu.createPortal((0,d.jsx)("div",{style:{top:G.top,left:G.left,position:"absolute",zIndex:99999},children:q.render()}),document.body)]})},Ph=e=>{let{onClose:n,setInventory:o,currentPlayer:i,setCurrentPlayer:l,masterResources:c,globalTuning:u,masterWarehouse:h,updateStatus:p}=e;const m=(0,r.k)(),f=(null===i||void 0===i?void 0:i.inventory)||[],[g,y]=(0,t.useState)(0),[v,b]=(0,t.useState)(null),[x,w]=(0,t.useState)(!1),[S,T]=(0,t.useState)(!1);(0,t.useEffect)((()=>{var e;if(!h||0===h.length)return;void 0!==(null===i||void 0===i?void 0:i.warehouseLevel)?(y(i.warehouseLevel),w(!1)):(y(0),w(!0),null!==i&&void 0!==i&&i.playerId&&C(0));const t=null!==(e=null===i||void 0===i?void 0:i.warehouseLevel)&&void 0!==e?e:g;t<h.length-1?b(h[t+1]):b(null)}),[null===i||void 0===i?void 0:i.warehouseCapacity,null===i||void 0===i?void 0:i.warehouseLevel,h]);const C=async e=>{try{(await a.A.post(`${s.A}/api/update-profile`,{playerId:i.playerId,updates:{warehouseLevel:e}})).data.success&&(l({...i,warehouseLevel:e}),w(!1),console.log("Successfully migrated warehouse level to player document"))}catch(t){console.error("Error migrating warehouse level:",t)}},k=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!v)return;const t=e||v,n=[];for(let o=1;o<=5;o++){const e=t[`ingredient${o}`],r=t[`ingredient${o}qty`];e&&r&&n.push({type:e,quantity:r})}if(console.log("Warehouse upgrade - Recipe to use:",t),console.log("Warehouse upgrade - Ingredients array:",n),e||(0,Kc.Fp)(v,f,null,1))try{if(!await(0,Kc.dw)({playerId:i.playerId,recipe:t,inventory:f,backpack:[],setInventory:o,setBackpack:()=>{},setCurrentPlayer:l,updateStatus:p}))return void console.warn("Failed to spend ingredients.");const e=(i.warehouseCapacity||1e3)+v.add,n=v.Level;(await a.A.post(`${s.A}/api/update-profile`,{playerId:i.playerId,updates:{warehouseCapacity:e,warehouseLevel:n}})).data.success&&(l({...i,warehouseCapacity:e,warehouseLevel:n}),p(`${m[197]||"Warehouse upgraded"}`))}catch(r){console.error("Error upgrading warehouse:",r),p("Failed to upgrade warehouse")}else p(16)},A=(0,Kc.O_)(i,c,u),I=(null===u||void 0===u?void 0:u.warehouseCapacityGold)||1e5,E=(e=>e&&Array.isArray(e)?e.filter((e=>e&&!(0,Kc.sy)(e.type))).reduce(((e,t)=>e+(t.quantity||0)),0):0)(f);return(0,d.jsxs)(Zc,{onClose:n,titleKey:"181",panelName:"WarehousePanel",children:[(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsxs)("div",{className:"warehouse-capacity-display",children:[(0,d.jsxs)("h3",{children:[m[183]," ",E," / "," ",(0,d.jsx)("span",{style:"Gold"===(null===i||void 0===i?void 0:i.accountStatus)?{color:"#B8860B"}:{},children:A.warehouse})]}),"Gold"===(null===i||void 0===i?void 0:i.accountStatus)&&(0,d.jsxs)("p",{style:{fontSize:"14px",color:"#666",margin:"5px 0"},children:["(+",I.toLocaleString()," ",m[89]||"additional capacity for Gold Pass",")"]})]}),v?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"skills-options",children:(0,d.jsx)(Eh,{symbol:"\ud83d\udce6",name:m[2024]||"Upgrade Warehouse",details:(()=>{const e=[];for(let r=1;r<=5;r++){var t,n;const o=v[`ingredient${r}`],a=v[`ingredient${r}qty`];if(!o||!a)continue;const s=(null===f||void 0===f||null===(t=f.find((e=>e.type===o)))||void 0===t?void 0:t.quantity)||0,i=s>=a?"green":"red",l=(null===(n=c.find((e=>e.type===o)))||void 0===n?void 0:n.symbol)||"";e.push(`<span style="color: ${i}; display: block;">${l} ${(0,Bc.Z)(o,m)} ${a} / ${s}</span>`)}return`${m[461]||"Requires:"}<div>${e.join("")}</div>`})(),info:`+${v.add} ${m[2021]||"capacity"}`,disabled:!(0,Kc.Fp)(v,f,null,1),onClick:()=>k(),onGemPurchase:(0,Kc.Fp)(v,f,null,1)?null:async e=>k(e),resource:{...v,gemcost:1},inventory:f,backpack:[],masterResources:c,currentPlayer:i})}),(0,d.jsxs)("p",{className:"upgrade-info",children:[m[196]||"Add"," ",v.add," ",m[198]||"to warehouse capacity"]})]}):(0,d.jsx)("div",{className:"max-level",children:(0,d.jsx)("p",{children:m[88]||"Your warehouse is at maximum capacity."})}),"Gold"!==(null===i||void 0===i?void 0:i.accountStatus)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",width:"100%",margin:"20px 0"},children:(0,d.jsx)("button",{className:"btn-basic btn-gold",onClick:()=>Ju(1,i,p),children:m[9061]})}),(0,d.jsx)("div",{className:"gold-pass-info",style:{textAlign:"center",marginBottom:"20px",fontSize:"14px",color:"#666"},children:m[199]})]}),(0,d.jsx)("div",{style:{textAlign:"center",marginTop:"10px"},children:(0,d.jsx)("button",{onClick:()=>T(!0),style:{background:"none",border:"none",color:"#B8860B",textDecoration:"underline",cursor:"pointer",fontSize:"14px"},children:m[10131]||"Gold Pass Benefits"})})]}),(0,d.jsx)(uh,{isOpen:S,onClose:()=>T(!1)})]})};const _h=function(e){let{onClose:n,masterResources:o,masterTrophies:i,currentPlayer:l,setCurrentPlayer:c,updateStatus:u,openPanel:h,setActiveStation:p,inventory:m,setInventory:f,backpack:g,setBackpack:y}=e;const v=(0,r.k)(),[b,x]=(0,t.useState)([]),[w,S]=(0,t.useState)(!0),[T,C]=(0,t.useState)(null);return(0,t.useEffect)((()=>{null!==l&&void 0!==l&&l.playerId&&(async()=>{try{S(!0);const e=await a.A.get(`${s.A}/api/player/${l.playerId}/trophies`);e.data.success&&x(e.data.trophies||[])}catch(e){console.error("Error fetching trophies:",e),u("Failed to load trophies")}finally{S(!1)}})()}),[null===l||void 0===l?void 0:l.playerId]),(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1035",titleKey:"1135",panelName:"TrophyPanel",children:(0,d.jsx)("div",{className:"trophy-container",children:w?(0,d.jsx)("div",{className:"loading",children:"Loading trophies..."}):(0,d.jsx)("div",{className:"trophy-grid",children:null===i||void 0===i?void 0:i.filter((e=>!1!==e.visible)).sort(((e,t)=>{const n=b.find((t=>t.name===e.name)),r=b.find((e=>e.name===t.name)),o=!!n,a=!!r,s=o&&!1===(null===n||void 0===n?void 0:n.collected),i=a&&!1===(null===r||void 0===r?void 0:r.collected);return s&&i?0:s&&!i?-1:!s&&i?1:o&&a?0:o&&!a?-1:!o&&a?1:0})).map(((e,t)=>{const n=b.find((t=>t.name===e.name)),r=!!n,o="Progress"===e.type?((e,t)=>{if(!e.progress||0===e.progress.length)return null;const n=(null===t||void 0===t?void 0:t.progress)||0,r=e.progress;let o=null,a=0,s=r[0];for(let c=0;c<r.length;c++){if(!(n>=r[c])){s=r[c];break}o=r[c],a=r[c],s=c+1<r.length?r[c+1]:r[c]}const i=s-a,l=i>0?(n-a)/i*100:100;return{current:n,lastAchievedMilestone:o,lastMilestone:a,nextMilestone:s,percentage:Math.min(100,Math.max(0,l)),displayText:`${n} / ${s}`,hasAchievedAll:n>=r[r.length-1]}})(e,n):null,i=r&&!1===(null===n||void 0===n?void 0:n.collected),h=T===e.name;return(0,d.jsxs)("div",{className:`trophy-card ${r?"":"unearned"} trophy-${(e.type||"Event").toLowerCase()}`,"data-tooltip":e.tooltip||"",children:[(0,d.jsxs)("div",{className:"trophy-icon-wrapper",children:[(0,d.jsx)("div",{className:"trophy-icon",children:"\ud83c\udfc6"}),r&&"Progress"===e.type&&(null===o||void 0===o?void 0:o.lastAchievedMilestone)&&(0,d.jsx)("div",{className:"progress-number",children:o.lastAchievedMilestone})]}),(0,d.jsxs)("div",{className:"trophy-content",children:[(0,d.jsx)("div",{className:"trophy-name",children:(0,Bc.Z)(e.name,v)}),"Progress"===e.type&&o&&(0,d.jsxs)("div",{className:"trophy-progress-container",children:[(0,d.jsx)("div",{className:"progress-text",children:o.displayText}),(0,d.jsx)("div",{className:"progress-bar",children:(0,d.jsx)("div",{className:"progress-fill",style:{width:`${Math.min(100,Math.max(0,o.percentage))}%`}})})]}),"Count"===e.type&&r&&(null===n||void 0===n?void 0:n.qty)>0&&(0,d.jsx)("div",{className:"trophy-count",children:(0,d.jsxs)("div",{className:"count-text",children:[n.qty,"x"]})})]}),i&&(0,d.jsx)("div",{className:"trophy-reward-gem",onClick:()=>(async e=>{try{C(e);const t=await a.A.post(`${s.A}/api/collect-trophy-reward`,{playerId:l.playerId,trophyName:e});if(t.data.success){const{gemReward:n,inventory:r}=t.data;r&&(f(r),c((e=>({...e,inventory:r})))),x((t=>t.map((t=>t.name===e?{...t,collected:!0}:t)))),Lc.A.addFloatingText(`+${n} \ud83d\udc8e`,window.innerWidth/2,window.innerHeight/2,64),u(`\ud83d\udc8e Earned ${n} Gem${n>1?"s":""} from your trophy`)}else u(t.data.message||"Failed to collect reward")}catch(t){console.error("Error collecting trophy reward:",t),u("Failed to collect trophy reward")}finally{C(null)}})(e.name),style:{opacity:h?.5:1,cursor:h?"wait":"pointer"},children:"\ud83d\udc8e"})]},t)}))})})})},Nh=(0,t.memo)((e=>{let{onClose:t}=e;const n=(0,r.k)();return(0,d.jsx)(Zc,{onClose:t,descriptionKey:"1018",titleKey:"1118",panelName:"HowToPanel",children:(0,d.jsxs)("div",{className:"panel-content",children:[(0,d.jsx)("h2",{children:n[9001]}),(0,d.jsx)("p",{children:n[9002]}),(0,d.jsx)("p",{children:n[9003]}),(0,d.jsx)("h3",{children:n[9004]}),(0,d.jsx)("p",{children:n[9005]}),(0,d.jsx)("p",{children:n[9006]}),(0,d.jsx)("p",{children:n[9007]}),(0,d.jsx)("h3",{children:n[9008]}),(0,d.jsx)("p",{children:n[9009]}),(0,d.jsx)("p",{children:n[9010]}),(0,d.jsx)("p",{children:n[9011]}),(0,d.jsx)("h3",{children:n[9012]}),(0,d.jsx)("p",{children:n[9013]}),(0,d.jsx)("p",{children:n[9014]})]})})})),Rh=(0,t.memo)((e=>{let{onClose:t}=e;const n=(0,r.k)();return(0,d.jsx)(Zc,{onClose:t,descriptionKey:"1026",titleKey:"1126",panelName:"HowToMoneyPanel",children:(0,d.jsxs)("div",{className:"panel-content",children:[(0,d.jsx)("h2",{children:n[9020]}),(0,d.jsx)("p",{children:n[9021]}),(0,d.jsx)("p",{children:n[9022]}),(0,d.jsx)("p",{children:n[9023]}),(0,d.jsx)("p",{children:n[9024]}),(0,d.jsx)("h2",{children:n[9025]}),(0,d.jsx)("p",{children:n[9026]}),(0,d.jsx)("p",{children:n[9027]})]})})})),Mh=(0,t.memo)((e=>{let{currentPlayer:n,updateStatus:o,onClose:i}=e;const l=(0,r.k)(),[c,u]=(0,t.useState)({});return(0,t.useEffect)((()=>{(async()=>{try{const e=(await a.A.get(`${s.A}/api/store-offers`)).data||[],t={};e.forEach((e=>{t[e.id]=e})),u(t)}catch(e){console.error("\u274c Failed to load store offers:",e)}})()}),[]),(0,d.jsx)(Zc,{onClose:i,descriptionKey:"1034",titleKey:"1134",panelName:"HowToGemsPanel",children:(0,d.jsxs)("div",{className:"panel-content",children:[(0,d.jsx)("h2",{children:l[9030]}),(0,d.jsx)("p",{children:l[9031]}),(0,d.jsx)("p",{children:l[9032]}),(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",gap:"10px"},children:[(0,d.jsx)("p",{style:{marginBottom:"0px",fontWeight:"bold"},children:l[9040]}),(0,d.jsxs)("button",{className:"btn-basic btn-gold",style:{width:"100%"},onClick:()=>Ju(6,n,o),children:[l[9041],c[6]?` $${c[6].price.toFixed(2)}`:""]}),(0,d.jsx)("p",{style:{marginBottom:"0px",marginTop:"6px",fontWeight:"bold"},children:l[9042]}),(0,d.jsxs)("button",{className:"btn-basic btn-gold",style:{width:"100%"},onClick:()=>Ju(7,n,o),children:[l[9043],c[7]?` $${c[7].price.toFixed(2)}`:""]}),(0,d.jsx)("p",{style:{marginBottom:"0px",marginTop:"6px",fontWeight:"bold"},children:l[9044]}),(0,d.jsxs)("button",{className:"btn-basic btn-gold",style:{width:"100%"},onClick:()=>Ju(8,n,o),children:[l[9045],c[8]?` $${c[8].price.toFixed(2)}`:""]})]}),(0,d.jsx)("p",{children:l[9033]})]})})})),jh=e=>{let{quest:t,state:n,onClick:o}=e;const a=(0,r.k)(),{symbol:s,title:i,completed:l,goals:c=[],reward:u,rewardqty:h}=t;return(0,d.jsxs)("div",{className:`quest-item ${n}`,onClick:o,children:[(0,d.jsxs)("div",{className:"quest-header",children:[(0,d.jsx)("h2",{children:s}),"reward"===n&&(0,d.jsx)("span",{className:"quest-checkmark",children:"\u2705"})]}),(0,d.jsx)("h2",{children:i}),(0,d.jsx)("h4",{children:l?a[206]:a[207]}),c.map(((e,t)=>e.action&&e.item&&e.qty?(0,d.jsxs)("p",{children:[e.action," ",e.item," x",e.qty,": ",e.progress," of ",e.qty]},t):null)),u&&h&&(0,d.jsxs)("p",{children:["Reward: ",h," ",u]})]})},Dh=e=>{let{quest:t,state:n,onClick:o,xpReward:a,level:s,meetsLevelRequirement:i=!0}=e;const l=(0,r.k)(),{symbol:c,title:u,reward:h,rewardqty:p,goals:m=[]}=t,f="reward"===n?l[208]:l[209],g=!i;return(0,d.jsxs)("div",{className:`quest-item ${n}${g?" disabled":""}`,onClick:()=>{!g&&o&&o()},style:g?{opacity:.6,cursor:"not-allowed"}:{},children:[(0,d.jsxs)("div",{className:"quest-header",children:[(0,d.jsx)("h2",{children:c}),"reward"===n&&(0,d.jsx)("span",{className:"quest-checkmark",children:"\u2705"})]}),(0,d.jsx)("h2",{children:u}),s&&(0,d.jsxs)("p",{style:{color:i?"green":"red",margin:"2px 0",fontWeight:"bold"},children:[l[10149]||"Level"," ",s]}),(0,d.jsx)("div",{className:"quest-goals",children:m.map(((e,t)=>e.action&&e.item&&e.qty?(0,d.jsxs)("p",{children:[e.action," ",e.item," x",e.qty]},t):null))}),(0,d.jsxs)("p",{children:["Reward: ",p," ",h]}),a&&"reward"===n&&(0,d.jsxs)("p",{style:{color:"#4CAF50",marginTop:"5px"},children:["\ud83d\udd37 +",a," XP"]}),(0,d.jsx)("button",{className:"quest-giver-button",children:f})]})};const Oh=function(e){let{onClose:n,currentPlayer:o}=e;const i=(0,r.k)(),[l,c]=(0,t.useState)([]),[u,h]=(0,t.useState)([]);(0,t.useEffect)((()=>{null!==o&&void 0!==o&&o.activeQuests&&(async e=>{if(!e||0===e.length)return e;let t=!1;const n=e.map((e=>{if(e.completed||e.rewardCollected)return e;const n={...e},r={...e.progress};let a=0,s=0;for(let c=1;c<=3;c++){const n=e[`goal${c}action`],d=e[`goal${c}item`],u=e[`goal${c}qty`];if(n&&d&&u){if(s++,"Acquire"===n){var i,l;const e=null===(i=o.skills)||void 0===i?void 0:i.some((e=>e.type===d)),n=null===(l=o.powers)||void 0===l?void 0:l.some((e=>e.type===d));(e||n)&&r[`goal${c}`]<u&&(r[`goal${c}`]=u,t=!0)}r[`goal${c}`]>=u&&a++}}return a===s&&s>0&&!n.completed&&(n.completed=!0,t=!0),n.progress=r,n}));if(t)try{await a.A.post(`${s.A}/api/update-player-quests`,{playerId:o.playerId,activeQuests:n})}catch(r){console.error("Error updating quest progress:",r)}return n})(o.activeQuests).then((e=>{c(e)}))}),[null===o||void 0===o?void 0:o.activeQuests,null===o||void 0===o?void 0:o.skills,null===o||void 0===o?void 0:o.powers,null===o||void 0===o?void 0:o.playerId]),(0,t.useEffect)((()=>{(async()=>{try{const e=await a.A.get(`${s.A}/api/quests`);h(e.data||[])}catch(e){console.error("Error fetching quest templates:",e)}})()}),[]);const p=l.filter((e=>u.some((t=>t.title===e.questId))));return(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1006",titleKey:"1106",panelName:"QuestPanel",children:p&&0!==p.length?(0,d.jsx)("div",{className:"standard-panel",children:p.map(((e,t)=>{var n,r,o;const a=u.find((t=>t.title===e.questId)),s=[{action:e.goal1action,item:e.goal1item,qty:e.goal1qty,progress:(null===(n=e.progress)||void 0===n?void 0:n.goal1)||0},{action:e.goal2action,item:e.goal2item,qty:e.goal2qty,progress:(null===(r=e.progress)||void 0===r?void 0:r.goal2)||0},{action:e.goal3action,item:e.goal3item,qty:e.goal3qty,progress:(null===(o=e.progress)||void 0===o?void 0:o.goal3)||0}].filter((e=>e.action&&e.item&&e.qty));return(0,d.jsx)(jh,{className:"resource-button "+(e.completed?"reward":"in-progress"),quest:{symbol:e.symbol,title:e.questId,completed:e.completed,goals:s,textbody:(null===a||void 0===a?void 0:a.textbody)||"",reward:(null===a||void 0===a?void 0:a.reward)||"",rewardqty:(null===a||void 0===a?void 0:a.rewardqty)||1},state:e.completed?"reward":"in-progress",onClick:null},t)}))}):(0,d.jsx)("p",{children:i[203]})})},Bh=async(e,t,n)=>{try{var r;const o=e._id||e.playerId;if(null===(r=e.relationships)||void 0===r?void 0:r.find((e=>e.name===t))){const e=await a.A.post(`${s.A}/api/update-relationship`,{playerId:o,targetName:t,delta:n});return{success:e.data.success,player:e.data.player,relationships:e.data.relationships,relationship:e.data.relationship}}{const e=await a.A.post(`${s.A}/api/add-relationship`,{playerId:o,targetName:t,initialScore:n});return{success:e.data.success,player:e.data.player,relationships:e.data.relationships}}}catch(o){return console.error("Error updating relationship:",o),{success:!1,error:o.message}}},Lh=async(e,t,n,r)=>{try{const i=e._id||e.playerId,l=await a.A.post(`${s.A}/api/add-or-update-relationship-status`,{playerId:i,name:t,status:n,value:r});if(l.data.success&&"met"===n&&!0===r){const e=su.filter((e=>e.type)).map((e=>e.type)),t=l.data.player.relationships.filter((e=>!0===e.met));if(e.every((e=>t.some((t=>t.name===e)))))try{const e=await a.A.post(`${s.A}/api/earn-trophy`,{playerId:i,trophyName:"Meet the Cast"});e.data.success&&e.data.isNewMilestone&&console.log("\ud83c\udfc6 Player earned Meet the Cast trophy!")}catch(o){console.error("Error awarding Meet the Cast trophy:",o)}}return{success:l.data.success,player:l.data.player,relationship:l.data.relationship}}catch(i){return console.error("Error updating relationship status:",i),{success:!1,error:i.message}}},Fh=(e,t)=>null!==e&&void 0!==e&&e.relationships?e.relationships.find((e=>e.name===t))||{name:t,relscore:0}:null,$h=(e,t,n)=>{var r;const o=su.find((t=>t.type===e));if(!o||!o.buff4friend&&!o.buff4love&&!o.buff4marriage)return{multiplier:1,bonusMessage:""};const a=null===(r=t.relationships)||void 0===r?void 0:r.find((t=>t.name===e));return a?!0===a.married&&o.buff4marriage?{multiplier:o.buff4marriage,bonusMessage:` ${o.buff4marriage}x ${n[621]}`}:!0===a.love&&o.buff4love?{multiplier:o.buff4love,bonusMessage:` ${o.buff4love}x ${n[623]}`}:!0===a.friend&&o.buff4friend?{multiplier:o.buff4friend,bonusMessage:` ${o.buff4friend}x ${n[622]}`}:{multiplier:1,bonusMessage:""}:{multiplier:1,bonusMessage:""}},Gh=JSON.parse('{"Eu":["\ud83c\udfa8","\ud83d\udcda","\ud83d\udef6","\ud83d\udd2c","\ud83e\ude89","\u26fa","\ud83d\udcb0"],"sw":["\ud83d\ude82","\ud83c\udf31","\u26fa","\u2694\ufe0f","\ud83d\udcb0","\ud83d\udc2e"],"vT":["\ud83e\udddd\u200d\u2640\ufe0f","\ud83d\udc32","\ud83e\uddcc","\ud83d\udc8d","\ud83d\udc7b","\ud83d\udd31","\ud83e\udd84","\ud83d\udd11","\ud83d\uddbc\ufe0f","\ud83e\uddde"]}');let zh={matchingInterests:0,matchingRandom:0,matchingTopics:0,rivalTopics:0,totalRounds:0};const Uh=(e,t)=>{if(!e||!t)return null;const n=su.find((t=>t.type===e));if(!n)return null;const r=n[t];return"rival"===r||"friend"===r||"love"===r?r:null},Hh=e=>{if(!e)return null;const t=su.find((t=>t.symbol===e));return(null===t||void 0===t?void 0:t.type)||null},qh=(e,t,n,r,o)=>{let a=!1,s=0;const i=Hh(e);if(i){const r=Uh(n,i);"rival"===r?(a="rival",s=-.15):("friend"===r||"love"===r||e===t)&&(a="match",s=.1)}else e===t&&(a="match",s=.1);return{matchState:a,chanceModifier:s}},Vh=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return"\u2753";if(e.startsWith("emoji_")){return{emoji_heart:"\u2764\ufe0f",emoji_pinkheart:"\ud83d\udc96",emoji_friend:"\ud83d\udc6b",emoji_diamond:"\ud83d\udc8d",emoji_forgive:"\ud83d\ude4f",emoji_questionmark:"\u2753",emoji_annoyed:"\ud83d\ude20",emoji_laughing:"\ud83d\ude02",emoji_blush:"\ud83d\ude0a",emoji_hug:"\ud83e\udd17",emoji_wink:"\ud83d\ude09",emoji_kiss:"\ud83d\ude18",emoji_angry:"\ud83d\ude21",emoji_sad:"\ud83d\ude22",emoji_happy:"\ud83d\ude0a",emoji_thinking:"\ud83e\udd14",emoji_wow:"\ud83d\ude2e",emoji_love:"\ud83e\udd70",emoji_cool:"\ud83d\ude0e",emoji_party:"\ud83e\udd73",emoji_sleepy:"\ud83d\ude34",emoji_hungry:"\ud83d\ude0b",emoji_brokenheart:"\ud83d\udc94"}[e]||"\u2753"}switch(e){case"player":return t.playerIcon||"\ud83d\ude0a";case"npc":return t.npcIcon||"\ud83e\udd14";case"interest":if(n&&t.currentPlayer&&t.masterResources){const e=t.currentPlayer.inventory||[],n=t.currentPlayer.backpack||[],r=(n.length>0?n:e).filter((e=>{const n=t.masterResources.find((t=>t.type===e.type));return n&&"doober"===n.category})).sort(((e,t)=>t.quantity-e.quantity)).slice(0,5).map((e=>{const n=t.masterResources.find((t=>t.type===e.type));return(null===n||void 0===n?void 0:n.symbol)||e.type})).filter((e=>e));if(r.length>0)return r[Math.floor(Math.random()*r.length)]}if(!n&&t.npcId&&t.masterResources){const e=su.find((e=>e.type===t.npcId));if(e){const n=[];let r=1;for(;e[`interest${r}`];){const o=e[`interest${r}`],a=t.masterResources.find((e=>e.type===o));a&&a.symbol&&n.push(a.symbol),r++}if(n.length>0)return n[Math.floor(Math.random()*n.length)]}}return Gh.Eu[Math.floor(Math.random()*Gh.Eu.length)];case"npcinterest1":if(t.npcId&&t.masterResources){const e=su.find((e=>e.type===t.npcId));if(e&&e.interest1){const n=t.masterResources.find((t=>t.type===e.interest1));if(n&&n.symbol)return n.symbol}}return"\u2753";case"npcinterest2":if(t.npcId&&t.masterResources){const e=su.find((e=>e.type===t.npcId));if(e&&e.interest2){const n=t.masterResources.find((t=>t.type===e.interest2));if(n&&n.symbol)return n.symbol}}return"\u2753";case"relationship":return"\ud83d\udc6b";case"random":if(t.relscore>80)return Gh.vT[Math.floor(Math.random()*Gh.vT.length)];{const e=[...Gh.sw];if(!n&&t.npcId&&t.masterResources){const n=su.find((e=>e.type===t.npcId));if(n&&n.interest2){const r=t.masterResources.find((e=>e.type===n.interest2));r&&r.symbol&&e.push(r.symbol)}}return e[Math.floor(Math.random()*e.length)]}case"people":if(n){if(t.currentPlayer&&t.masterResources){const e=t.currentPlayer.relationships||[];if(e.length>0){const t=e.filter((e=>!0===e.married));if(t.length>0){const e=t[Math.floor(Math.random()*t.length)],n=su.find((t=>t.type===e.name));return(null===n||void 0===n?void 0:n.symbol)||"\ud83d\udc6b"}const n=Math.max(...e.map((e=>e.relscore||0))),r=e.filter((e=>(e.relscore||0)===n)),o=r[Math.floor(Math.random()*r.length)],a=su.find((e=>e.type===o.name));return(null===a||void 0===a?void 0:a.symbol)||"\ud83d\udc6b"}const n=su.find((e=>"Kent"===e.type));return(null===n||void 0===n?void 0:n.symbol)||"\ud83d\udc68\ud83c\udffd"}return"\ud83d\udc6b"}if(t.npcId&&t.masterResources){const e=su.find((e=>e.type===t.npcId)),n=t.playerTopic?Hh(t.playerTopic):null;if(n){const e=Uh(t.npcId,n);if("rival"===e||"friend"===e||"love"===e)return t.playerTopic}if(e&&e.interest3){const n=t.masterResources.find((t=>t.type===e.interest3));if(n&&n.symbol)return n.symbol}const r=t.masterResources.filter((e=>"trade"===e.action||"quest"===e.action));if(r.length>0){return r[Math.floor(Math.random()*r.length)].symbol||"\ud83d\udc64"}}return"\ud83d\udc64";case"quest":return"\u2705";case"trade":return"\ud83d\udcb0";case"skill":return"\ud83d\udcaa";case"location":return"\ud83d\uddfa\ufe0f";case"weather":const r=["\u2600\ufe0f","\ud83c\udf28\ufe0f","\ud83c\udf26\ufe0f","\ud83c\udf29\ufe0f"];return r[Math.floor(Math.random()*r.length)];case"time":return"\ud83d\udd50";default:return e}},Wh=async function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];pd.addSpeech(t,n,r||n,o)},Yh=async e=>{pd.removeSpeech(e)},Kh=e=>new Promise((t=>setTimeout(t,e))),Xh={talk:{success:"\ud83d\ude04",failure:"\u274c"},"make friends":{success:"\ud83d\udc6b",failure:"\u274c"},"profess love":{success:"\u2764\ufe0f",failure:"\u274c"},propose:{success:"\ud83d\udc8d",failure:"\u274c"},divorce:{success:"\ud83d\udc94",failure:"\ud83d\ude20"},"end friendship":{success:"\ud83d\udc4b",failure:"\ud83d\ude24"},"end marriage":{success:"\ud83d\udc94",failure:"\ud83d\ude20"},insult:{success:"\ud83d\ude08",failure:"\ud83d\ude21"},compliment:{success:"\ud83d\ude4f",failure:"\u274c"},flatter:{success:"\ud83d\ude4f",failure:"\u274c"},"give gift":{success:"\ud83c\udf81",failure:"\u274c"},apologize:{success:"\ud83e\udd1d",failure:"\ud83d\ude21"},flirt:{success:"\ud83d\ude18",failure:"\u274c"},kiss:{success:"\ud83d\ude18",failure:"\u274c"},hug:{success:"\ud83e\udd17",failure:"\u274c"},joke:{success:"\ud83e\udd23",failure:"\u274c"},gossip:{success:"\ud83d\ude33",failure:"\u274c"},greet:{success:"\ud83d\udc4b",failure:"\u274c"},taunt:{success:"\ud83d\ude21",failure:"\ud83d\ude21"},tease:{success:"\ud83e\udd28",failure:"\ud83d\ude21"},default:{success:"\ud83d\udc4d",failure:"\u274c"}},Zh=(e,t)=>{const n=(e||"").toLowerCase().trim(),r=Xh[n]||Xh.default,o=t?r.success:r.failure;return console.log("\ud83c\udfad getInteractionEmoji:",{interactionName:e,normalizedName:n,isSuccess:t,emojis:r,result:o}),o},Jh=e=>{let{currentPlayer:n,setCurrentPlayer:o,targetName:a,targetType:s="npc",targetEmoji:i=null,onRelationshipChange:l,showActions:c=!0,compact:u=!1,masterInteractions:h=[],updateStatus:p,checkDistance:m=null,onInteractionClick:f=null,playerPosition:g=null,targetPosition:y=null,TILE_SIZE:v=30,masterResources:b=[],isDeveloper:x=!1}=e;const[w,S]=(0,t.useState)(null),[T,C]=(0,t.useState)(!1),[k,A]=(0,t.useState)(!1),I=(0,r.k)();(0,t.useEffect)((()=>{E()}),[null===n||void 0===n?void 0:n.playerId,a]);const E=async()=>{var e;if(!n||!a)return;const t=null===(e=n.relationships)||void 0===e?void 0:e.find((e=>e.name===a));if(t)S(t);else if(!T){C(!0);const e=await Bh(n,a,0);if(e.success&&e.player){o(e.player);const t=e.player.relationships.find((e=>e.name===a));S(t||{name:a,relscore:0})}C(!1)}},P=async e=>{if(!w||k)return;if(A(!0),m&&!m())return p&&p(620),void A(!1);f&&await f();const t=((e,t,n)=>{if(!n.relbitadd)return{allowed:!0};if("married"===n.relbitadd){var r;const n=null===(r=e.relationships)||void 0===r?void 0:r.find((e=>!0===e.married&&e.name!==t));if(n)return{allowed:!1,reason:`You are already married to ${n.name}`}}if("friend"===n.relbitadd){const n=[];su.forEach((e=>{const r=e.type;"rival"===e[t]&&n.push(r)}));for(const r of n){var o;const n=null===(o=e.relationships)||void 0===o?void 0:o.find((e=>e.name===r));if(!0===(null===n||void 0===n?void 0:n.friend))return{allowed:!1,reason:`${t} won't be friends with you because you're friends with ${r}`}}}if("love"===n.relbitadd||"crush"===n.relbitadd){const e=su.find((e=>e.type===t));if(e){const n=Object.entries(e).filter((e=>{let[t,n]=e;return"type"!==t&&"symbol"!==t&&"love"===n}));if(n.length>0)return{allowed:!1,reason:`${t} is already in love with ${n[0][0]}`}}}return{allowed:!0}})(n,a,e);if(!t.allowed)return p&&p(`\u274c ${t.reason}`),void A(!1);if(g&&y){var r;const t=n.icon||"\ud83d\ude0a",c=i||("npc"===s?"\ud83e\udd14":"\ud83d\ude0a"),d=(null===(r=n._id)||void 0===r?void 0:r.toString())||n.playerId,u=a;let h=null;await async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\ud83d\ude0a",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"\ud83e\udd14",o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null;zh={matchingInterests:0,matchingRandom:0,matchingTopics:0,rivalTopics:0,totalRounds:0};const d=(null===i||void 0===i?void 0:i.rounds)||Math.floor(3*Math.random())+1,u={playerIcon:(null===l||void 0===l?void 0:l.icon)||n,npcIcon:r,currentPlayer:l,interaction:i,masterResources:c,npcId:s};if(null!==l&&void 0!==l&&l.relationships&&s){const e=l.relationships.find((e=>e.name===s));e&&(u.relscore=e.relscore)}for(let h=0;h<d;h++){const o=h+1;zh.totalRounds=o;const l=a||`player_${Math.floor(e.x)}_${Math.floor(e.y)}`,c=null===i||void 0===i?void 0:i[`playertopic${o}`],d=c?Vh(c,u,!0):"\ud83d\udcad";await Wh("player",l,n,d),await Kh(1200),await Yh(l),await Kh(400);const p=s||`npc_${Math.floor(t.x)}_${Math.floor(t.y)}`,m=null===i||void 0===i?void 0:i[`npctopic${o}`];u.playerTopic=d,u.roundNum=o;const f=m?Vh(m,u,!1):"\ud83d\udcad",{matchState:g,chanceModifier:y}=qh(d,f,s);"match"===g?zh.matchingTopics++:"rival"===g&&zh.rivalTopics++,await Wh("npc",p,r,f,g),await Kh(1200),await Yh(p),await Kh(400)}o&&o(zh)}(g,y,t,c,v,(e=>{h=e}),d,u,e,n,b);const m=e.chance||1,f=h?((e,t,n,r,o)=>{let a=e||1;if("Talk"===t.interaction&&n.matchingTopics>0&&(a+=.1*n.matchingTopics),"Talk"===t.interaction&&n.rivalTopics>0&&(a-=.15*n.rivalTopics),r&&r.relationships){const e=r.relationships.find((e=>e.name===o));if(e)for(let n=1;n<=3;n++){const r=t[`relbuff${n}`];if(r&&!0===e[r]){a+=t.relbuff||.2;break}}}return Math.min(a,1)})(m,e,h,n,a):m;console.log("\ud83c\udfb2 Chance calculation:",{baseChance:m,conversationResults:h,modifiedChance:f});const w=Math.random(),S=w<=f;if(x&&p){var o,l;const t=null!==(o=h)&&void 0!==o&&o.matchingTopics?.1*h.matchingTopics:0,r=null!==(l=h)&&void 0!==l&&l.rivalTopics?.15*h.rivalTopics:0;let s=0;if(null!==n&&void 0!==n&&n.relationships){const t=n.relationships.find((e=>e.name===a));if(t)for(let n=1;n<=3;n++){const r=e[`relbuff${n}`];if(r&&!0===t[r]){s=e.relbuff||.2;break}}}const i=S?e.relscoreresult||0:-(e.relscoreresult||0),c=i>=0?`+${i}`:`${i}`,d=s>0?` + RelBuff ${s.toFixed(2)}`:"",u=`\ud83c\udfb2 ${e.interaction}: Base ${m.toFixed(2)} + Match ${t.toFixed(2)} - Rival ${r.toFixed(2)}${d} = Threshold ${f.toFixed(2)} | Roll ${w.toFixed(2)} \u2264 ${f.toFixed(2)}? \u2192 ${S?"\u2705":"\u274c"} (${c})`;p(u)}await _(S,e)}else{const t=e.chance||1,n=Math.random(),r=n<=t;if(x&&p){const o=r?e.relscoreresult||0:-(e.relscoreresult||0),a=o>=0?`+${o}`:`${o}`,s=`\ud83c\udfb2 ${e.interaction}: Threshold ${t.toFixed(2)} | Roll ${n.toFixed(2)} \u2264 ${t.toFixed(2)}? \u2192 ${r?"\u2705":"\u274c"} (${a})`;p(s)}await _(r,e)}},_=async(e,t)=>{if(e){const e=t.relscoreresult||0,l=await Bh(n,a,e);if(l.success&&l.player){o(l.player);let d=l.player.relationships.find((e=>e.name===a));if(S(d),t.relbitadd){const e=await Lh(n,a,t.relbitadd,!0);if(e.success&&e.player){o(e.player),d=e.player.relationships.find((e=>e.name===a)),S(d);let n=[];if("npc"===s){n=((e,t)=>{const n=[];return su.forEach((r=>{const o=r.type;if(o===e)return;const a=r[e];a&&("love"===t&&"love"===a||"friend"===t&&"rival"===a?n.push({npc:o,setScore:-50,clearAllStatuses:!0,setStatus:"rival"}):"friend"===t&&"friend"===a?n.push({npc:o,scoreChange:30}):"rival"===t&&"rival"===a?n.push({npc:o,scoreChange:50}):"rival"===t&&"love"===a&&n.push({npc:o,setScore:-50,clearAllStatuses:!0,setStatus:"rival"}))})),n})(a,t.relbitadd);for(const t of n)if(t.clearAllStatuses){var r,i;const n=await Bh(e.player,t.npc,t.setScore-((null===(r=e.player.relationships)||void 0===r||null===(i=r.find((e=>e.name===t.npc)))||void 0===i?void 0:i.relscore)||0));if(n.success&&n.player){const e=h.filter((e=>!1===e.isaninteraction)).map((e=>e.interaction.toLowerCase()));for(const r of e)await Lh(n.player,t.npc,r,!1);if(t.setStatus){const e=await Lh(n.player,t.npc,"met",!0),r=await Lh(e.success?e.player:n.player,t.npc,t.setStatus,!0);r.success&&r.player&&o(r.player)}}}else if(t.scoreChange){const n=await Bh(e.player,t.npc,t.scoreChange);if(n.success&&n.player){var c;const e=null===(c=n.player.relationships)||void 0===c?void 0:c.find((e=>e.name===t.npc));if(e&&!e.met){const e=await Lh(n.player,t.npc,"met",!0);e.success&&e.player?o(e.player):o(n.player)}else o(n.player)}}}if(p){const e=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a="";if(n&&t){switch(t){case"met":a=`${o[602]} ${e}.`;break;case"friend":a=`${o[603]} ${e}.`;break;case"crush":a=`${o[604]} ${e}.`;break;case"love":a=`${o[605]} ${e}.`;break;case"married":a=`${o[606]} ${e} ${o[607]}`;break;case"rival":a=`${o[606]} ${e} ${o[608]}`;break;default:a=`${o[615]} ${e} ${o[616]}`}if(r&&r.length>0){const e=r.filter((e=>"rival"===e.setStatus||e.scoreChange<0)),t=r.filter((e=>e.scoreChange>0&&"rival"!==e.setStatus));if(e.length>0)if(1===e.length){const t=e[0];"rival"===t.setStatus?a+=` ${t.npc} ${o[609]}`:a+=` ${t.npc} ${o[610]}`}else{const t=e.map((e=>e.npc)).join(` ${o[614]} `);a+=` ${t} ${o[611]}`}if(t.length>0)if(1===t.length)a+=` ${t[0].npc} ${o[612]}`;else{const e=t.map((e=>e.npc)).join(` ${o[614]} `);a+=` ${e} ${o[613]}`}}}return a}(a,t.relbitadd,!0,n,I);e&&p(e)}}}if(t.relbitremove){const e=await Lh(n,a,t.relbitremove,!1);e.success&&e.player&&(o(e.player),d=e.player.relationships.find((e=>e.name===a)),S(d))}const u=h.filter((e=>{if(!1!==e.isaninteraction)return!1;if("number"!==typeof e.relscoremin)return!1;const t=e.interaction.toLowerCase();return d.relscore<e.relscoremin&&!0===d[t]}));for(const e of u){const t=e.interaction.toLowerCase(),r=await Lh(n,a,t,!1);r.success&&r.player&&(o(r.player),d=r.player.relationships.find((e=>e.name===a)),S(d))}if(0!==e||t.relbitadd){const e=a,n=Zh(t.interaction,!0);pd.showOutcome(e,!0,n)}}}else{const e=-(t.relscoreresult||0),r=await Bh(n,a,e);if(r.success&&r.player){o(r.player);let e=r.player.relationships.find((e=>e.name===a));S(e);const t=h.filter((t=>{if(!1!==t.isaninteraction)return!1;if("number"!==typeof t.relscoremin)return!1;const n=t.interaction.toLowerCase();return e.relscore<t.relscoremin&&!0===e[n]}));for(const r of t){const t=r.interaction.toLowerCase(),s=await Lh(n,a,t,!1);s.success&&s.player&&(o(s.player),e=s.player.relationships.find((e=>e.name===a)),S(e))}}if(e<0||t.relbitadd){const e=a,n=Zh(t.interaction,!1);pd.showOutcome(e,!1,n)}}l&&l(t,e),A(!1)};if(!w)return null;const N=(R=w.relscore)>50?"#4CAF50":R>0?"#8BC34A":0===R?"#9E9E9E":R>-50?"#FF9800":"#F44336";var R;const M=h.filter((e=>{if(!1!==e.isaninteraction)return!1;const t=e.interaction.toLowerCase();return e.isvisible&&!0===w[t]}));if(u)return(0,d.jsxs)("div",{className:"relationship-card-compact",children:[(0,d.jsx)("span",{className:"relationship-name",children:a}),(0,d.jsxs)("span",{className:"relationship-score",style:{color:N},children:["[",w.relscore,"]"]}),M.map((e=>(0,d.jsxs)("span",{className:"relationship-status",children:["\u2022 ",(0,Bc.Z)(e.interaction,I)]},e.interaction)))]});const j=h.filter((e=>{var t,n;if(!1===e.isaninteraction)return!1;if(!e.isvisible)return!1;const r=null!==(t=e.relscoremin)&&void 0!==t?t:-100,o=null!==(n=e.relscoremax)&&void 0!==n?n:100;if(w.relscore<r||w.relscore>o)return!1;if(e.relbitrequired&&!w[e.relbitrequired])return!1;for(let a=1;a<=3;a++){const t=e[`relbitblock${a}`];if(t)if("all"===t){if(w.met||w.friend||w.crush||w.love||w.married||w.rival)return!1}else if(w[t])return!1}return!0}));return(0,d.jsx)("div",{className:"relationship-card",children:(0,d.jsxs)("div",{className:"relationship-card-content",children:[(0,d.jsx)("h3",{className:"relationship-title",children:I[601]}),(0,d.jsx)("div",{className:"relationship-score-bar-container",children:(0,d.jsx)("div",{className:"relationship-score-gradient",children:(0,d.jsx)("div",{className:"relationship-score-marker",style:{left:(w.relscore+100)/200*100+"%"}})})}),(0,d.jsx)("div",{className:"relationship-status-display",children:M.map((e=>(0,d.jsx)("span",{className:`relationship-status-badge ${e.interaction.toLowerCase()}`,children:(0,Bc.Z)(e.interaction,I)},e.interaction)))}),c&&j.length>0&&(0,d.jsx)("div",{className:"relationship-actions shared-buttons",children:j.map((e=>(0,d.jsx)("button",{className:"btn-basic",onClick:()=>P(e),disabled:k,children:(0,Bc.Z)(e.interaction,I)},e.interaction)))})]})})},Qh=t.memo(Jh),ep=e=>{let{isHealing:n,currentPlayer:r,TILE_SIZE:o,healAmount:a,onHealingComplete:s}=e;const i=(0,t.useRef)(null),l=(0,t.useRef)(null);return(0,t.useEffect)((()=>{var e,t,o,a,s;const c=null===r||void 0===r||null===(e=r.location)||void 0===e?void 0:e.g,d=null===(t=r._id)||void 0===t?void 0:t.toString(),u=null===(o=$c.default.getPlayersInGrid(c))||void 0===o?void 0:o[d],h=d||`player_${Math.floor((null===u||void 0===u||null===(a=u.position)||void 0===a?void 0:a.x)||0)}_${Math.floor((null===u||void 0===u||null===(s=u.position)||void 0===s?void 0:s.y)||0)}`;return n&&r&&null!==u&&void 0!==u&&u.position&&(console.log("\ud83d\ude4f Starting heal animation"),pd.addSpeech(h,"\ud83d\ude4f","\ud83d\ude4f",!1),l.current=setTimeout((()=>{console.log("\ud83d\ude4f Removing speech bubble after timeout"),pd.removeSpeech(h)}),1500)),()=>{console.log("\ud83d\ude4f Cleanup - isHealing changed to:",n),i.current&&clearTimeout(i.current),l.current&&clearTimeout(l.current),pd.removeSpeech(h)}}),[n,r,o]),null},tp=e=>{var n,o,i,c,u;let{onClose:h,npcData:p,inventory:m,setInventory:f,backpack:g,setBackpack:y,currentPlayer:v,setCurrentPlayer:b,setResources:x,TILE_SIZE:w,updateStatus:S,masterResources:T,masterInteractions:C,masterTraders:k,masterTrophies:A,masterXPLevels:I,zoomLevel:E,setZoomLevel:P,centerCameraOnPlayer:_,globalTuning:N,isDeveloper:R}=e;const M=(0,r.k)(),[j,D]=(0,t.useState)([]),[O,B]=(0,t.useState)([]),[L,F]=(0,t.useState)([]),[$,G]=(0,t.useState)(""),[z,U]=(0,t.useState)(""),[H,q]=(0,t.useState)(!1),[V,W]=(0,t.useState)(!1),[Y,K]=(0,t.useState)(0),[X,Z]=(0,t.useState)(!1),[J,Q]=(0,t.useState)(0),[ee,te]=(0,t.useState)(!1),[ne,re]=(0,t.useState)(!1),[oe,ae]=(0,t.useState)(new Set),se=1500,[ie,le]=(0,t.useState)(!1),[ce,de]=(0,t.useState)(null),ue=(0,t.useRef)(null);p||(console.warn("NPCPanel was opened with missing npcData."),p={type:"Unknown NPC",symbol:"\u2753"});const he=ih(v,I),pe=e=>!e||he>=e;(0,t.useEffect)((()=>{if(C&&p&&"quest"===p.action){const e=C.find((e=>"Quest"===e.interaction||"quest"===e.interaction));if(e){K(e.relscoremin||0);const t=Fh(v,p.type),n=(null===t||void 0===t?void 0:t.relscore)||0;q(n>=e.relscoremin)}else q(!0)}if(p&&"trade"===p.action){const e=C.find((e=>"Trade"===e.interaction||"trade"===e.interaction));if(e){Q(e.relscoremin||0);const t=Fh(v,p.type),n=(null===t||void 0===t?void 0:t.relscore)||0;Z(n>=e.relscoremin)}else Z(!0)}}),[C,p,v]),(0,t.useEffect)((()=>{if(p&&p.type){if("quest"===p.action){const e=setTimeout((()=>{me()}),100);return()=>clearTimeout(e)}if("heal"===p.action){const e=T.filter((e=>e.type===p.type));B(e)}else if("trade"===p.action){const t=null===k||void 0===k?void 0:k.filter((e=>e.trader===p.type));if(t&&t.length>0){var e;const n=null===(e=v.relationships)||void 0===e?void 0:e.find((e=>e.name===p.type)),r=t.some((e=>{if(e.rel||e.relscore){if(!n)return!0;if(e.rel&&!0!==n[e.rel])return!0;if(e.relscore&&(n.relscore||0)<e.relscore)return!0}return!1}));te(r);const o=t.filter((e=>{if(e.rel||e.relscore){if(!n)return!1;if(e.rel&&!0!==n[e.rel])return!1;if(e.relscore&&(n.relscore||0)<e.relscore)return!1}return!0})).map((e=>{const t=T.find((t=>t.type===e.gives)),n={type:e.gives,symbol:(null===t||void 0===t?void 0:t.symbol)||"?",tradeqty:e.givesqty||1,source:p.type,gemcost:(null===t||void 0===t?void 0:t.gemcost)||null,index:e.index,repeat:e.repeat,level:null===t||void 0===t?void 0:t.level,requires:null===t||void 0===t?void 0:t.requires,xp:e.xp};let r=1;for(let o=1;o<=7;o++){const t=`requires${o}`,a=`requires${o}qty`;e[t]&&(n[`ingredient${r}`]=e[t],n[`ingredient${r}qty`]=e[a]||1,r++)}return n}));F(o)}else{const e=T.filter((e=>e.source===p.type));F(e),te(!1)}}}}),[p,null===v||void 0===v?void 0:v.activeQuests,null===v||void 0===v?void 0:v.completedQuests,null===v||void 0===v?void 0:v.relationships,T,k]);const me=async()=>{try{var e;let t=(await fd.getQuests()).filter((e=>e.giver===p.type)).filter((e=>{const t=v.activeQuests.find((t=>t.questId===e.title)),n=v.completedQuests.some((t=>t.questId===e.title));if(t){return t.completed&&!t.rewardCollected}return!0===e.repeatable||"true"===e.repeatable||!n}));const n=null===(e=v.relationships)||void 0===e?void 0:e.find((e=>e.name===p.type)),r=t.some((e=>{if(e.rel||e.relscore){if(!n)return!0;if(e.rel&&!0!==n[e.rel])return!0;if(e.relscore&&(n.relscore||0)<e.relscore)return!0}return!1}));t=t.filter((e=>{if(e.rel||e.relscore){if(!n)return!1;if(e.rel&&!0!==n[e.rel])return!1;if(e.relscore&&(n.relscore||0)<e.relscore)return!1}return!0})),D(t),W(r)}catch(t){console.error("Error fetching quests:",t)}},fe=async(e,t)=>"heal"===t?ge(e):"trade"===t?ye(e):void 0,ge=async e=>{var t,n,r,o;U("");const a=`heal-${e.type}`;if(!e||ne||oe.has(a))return void(e||U("Invalid healing recipe selected."));re(!0),ae((e=>new Set(e).add(a))),setTimeout((()=>{ae((e=>{const t=new Set(e);return t.delete(a),t}))}),se);const s=null===v||void 0===v||null===(t=v.location)||void 0===t?void 0:t.g,i=null===(n=v._id)||void 0===n?void 0:n.toString(),l=null===(r=$c.default.getPlayersInGrid(s))||void 0===r?void 0:r[i];if(!l)return console.error(`Player ${v.username} not found in NPCsInGrid.`),void setTimeout((()=>{re(!1)}),se);const c=l.hp,d=l.maxhp,u=null===(o=Fc.Ay.getNPCsInGrid(s))||void 0===o?void 0:o[p.id];if(u&&void 0!==u.hp&&u.hp<=0)return S(`${(0,Bc.Z)(p.type,M)} has no heals remaining.`),void setTimeout((()=>{re(!1)}),se);if("hp"===p.output&&c>=d)return S(401),void setTimeout((()=>{re(!1)}),se);if(!await(0,Kc.dw)({playerId:v.playerId,recipe:e,inventory:m,backpack:g,setInventory:f,setBackpack:y,setCurrentPlayer:b,updateStatus:S}))return void setTimeout((()=>{re(!1)}),se);await(0,Kc.CP)(v.playerId,b);const x=p.qtycollected,w=Math.min(x,d-c);try{var T;await(async(e,t,n,r)=>{try{if(console.log("made it to modifyPlayerStatsInGridState"),console.log("statToMod = ",e,"; amountToMod = ",t),!e||!t)return void console.error("Invalid stat or amount to modify.");const o=$c.default.getPlayersInGrid(r),a=null===o||void 0===o?void 0:o[n];if(!a)return console.warn(`\ud83d\uded1 Player ${n} not found in playersInGrid for gridId ${r}`),void console.warn("\ud83e\udde0 All available PCs:",Object.keys(o));const s=(a[e]||0)+t;$c.default.updatePC(r,n,{[e]:s}),console.log(`\u2705 Modified ${e} for player ${n} by +${t}. New value: ${s}`)}catch(o){console.error("Error in modifyPlayerStats:",o)}})("hp",w,v._id,s),b((e=>({...e,hp:Math.min(e.maxhp,e.hp+w)}))),S(`${M[405]}${w}`);const e=null===(T=Fc.Ay.getNPCsInGrid(s))||void 0===T?void 0:T[p.id];if(e&&void 0!==e.hp){const t=e.hp-1;t<=0?(await Fc.Ay.removeNPC(s,p.id),S(`${(0,Bc.Z)(p.type,M)} has been exhausted and disappeared.`),h()):await Fc.Ay.updateNPC(s,p.id,{hp:t})}}catch(C){console.error("Error applying healing:",C)}finally{setTimeout((()=>{re(!1)}),se)}},ye=async e=>{var t,n;if(U(""),!e)return void U("Invalid recipe selected.");let r=e.tradeqty||1;const{multiplier:o,bonusMessage:i}=$h(p.type,v,M);r=Math.floor(r*o);const l=(0,Kc.Pu)({resource:e.type,quantity:r,currentPlayer:v,inventory:m,backpack:g,masterResources:T,globalTuning:N}),c=Array.isArray(m)?m:[],d=Array.isArray(g)?g:[];if(!l){var u;const t="homestead"===(null===v||void 0===v||null===(u=v.location)||void 0===u?void 0:u.gtype),n="Money"===e.type,r="Gem"===e.type;if(n||r||t)S(20);else{var h;const e=null===v||void 0===v||null===(h=v.skills)||void 0===h?void 0:h.some((e=>"Backpack"===e.type&&e.quantity>0));S(e?21:19)}return}const x=await(0,Kc.dw)({playerId:v.playerId,recipe:e,inventory:c,backpack:d,setInventory:f,setBackpack:y,setCurrentPlayer:b,updateStatus:S});if(!x||void 0!==x.success&&!x.success)return void U("Not enough ingredients.");if(!await(0,Kc.qf)({playerId:v.playerId,currentPlayer:v,resource:e.type,quantity:r,inventory:x.updatedInventory,backpack:x.updatedBackpack,setInventory:f,setBackpack:y,setCurrentPlayer:b,updateStatus:S,masterResources:T,globalTuning:N}))return void U("Failed to complete trade.");await(0,Uc.D)(v,"Collect",e.type,r,b);try{"Home Deed"===e.type?(console.log("\ud83c\udfc6 Awarding Homesteader trophy for trading Home Deed"),await(0,qc.p)(v.playerId,"Homesteader",1,v,A,b),await(0,au.LQ)("BoughtHomeDeed",v.playerId,v,b)):"Brass Bell"===e.type?(console.log("\ud83c\udfc6 Awarding Brass Bell trophy for trading Brass Bell"),await(0,qc.p)(v.playerId,"Brass Bell",1,v,A,b)):"Hope"===e.type?(console.log("\ud83c\udfc6 Awarding Hope trophy for trading Hope"),await(0,qc.p)(v.playerId,"Hope",1,v,A,b)):"Town Key"===e.type&&await(0,au.LQ)("AcquiredTownKey",v.playerId,v,b)}catch(E){console.error("\u274c Error awarding trade trophy:",E)}const w=T.find((e=>e.type===p.type&&"npc"===e.category)),C=null!==(t=null!==(n=e.xp)&&void 0!==n?n:null===w||void 0===w?void 0:w.xp)&&void 0!==t?t:1;try{const e=await a.A.post(`${s.A}/api/addXP`,{playerId:v.playerId,xpAmount:C});e.data.success&&b((t=>({...t,xp:e.data.newXP})))}catch(E){console.error("\u274c Error awarding XP for NPC trade:",E)}const k=[];if(e.requiresArray&&Array.isArray(e.requiresArray))e.requiresArray.forEach((e=>{e.type&&e.quantity&&k.push(`${e.quantity} ${e.type}`)}));else for(let a=1;a<=10;a++){const t=e[`ingredient${a}`],n=e[`ingredient${a}qty`];t&&n&&k.push(`${n} ${t}`)}const I=k.join(", ");S(`Exchanged ${I} for ${r} ${(0,Bc.Z)(e.type,M)}.${i}`)};return(0,d.jsxs)(Zc,{onClose:h,descriptionKey:"1013",title:`${p.symbol} ${(0,Bc.Z)(p.type,M)}`,panelName:"NPCPanel",children:[(0,d.jsxs)("div",{className:"station-panel-container",children:[(0,d.jsxs)("div",{className:"station-panel-content",children:["quest"===p.action&&(0,d.jsxs)("div",{className:"quest-options",children:[(e=>{const t=null===v||void 0===v||null===(e=v.relationships)||void 0===e?void 0:e.find((e=>e.name===p.type));if(null===t||void 0===t||!t.met)return null;const n=su.find((e=>e.type===p.type));if(!n)return null;const r=[n.interest1,n.interest2,n.interest3].filter(Boolean),o=[...new Set(r)];if(0===o.length)return null;const a=o.map((e=>{const t=T.find((t=>t.type===e));return t?{type:e,symbol:t.symbol}:null})).filter(Boolean);return 0===a.length?null:(0,d.jsxs)("div",{style:{marginBottom:"10px",display:"flex",alignItems:"center",gap:"8px"},children:[(0,d.jsx)("h3",{style:{margin:0},children:M[619]}),a.map(((e,t)=>(0,d.jsx)("span",{title:e.type,style:{fontSize:"1.5em"},children:e.symbol},t)))]})})(),(e=>{const t=null===v||void 0===v||null===(e=v.relationships)||void 0===e?void 0:e.find((e=>e.name===p.type));if(null===t||void 0===t||!t.met)return null;const n=su.find((e=>e.type===p.type));if(!n)return null;const r=["love","friend","rival","married"],o=[];if(Object.entries(n).forEach((e=>{let[t,n]=e;if(r.includes(n)){const e=su.find((e=>e.type===t));e&&o.push({targetName:t,targetSymbol:e.symbol,relationshipType:n})}})),0===o.length)return null;const a={love:o.filter((e=>"love"===e.relationshipType)),friend:o.filter((e=>"friend"===e.relationshipType)),rival:o.filter((e=>"rival"===e.relationshipType)),married:o.filter((e=>"married"===e.relationshipType))},s={love:660,friend:661,rival:662,married:663};return(0,d.jsx)("div",{style:{marginBottom:"10px"},children:Object.entries(a).map((e=>{let[t,n]=e;return 0===n.length?null:(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[(0,d.jsx)("h3",{style:{margin:0},children:M[s[t]]}),n.map(((e,t)=>(0,d.jsx)("span",{title:e.targetName,style:{fontSize:"1.5em",cursor:"help"},children:e.targetSymbol},t)))]},t)}))})})(),(()=>{const e=T.find((e=>e.type===p.type&&"npc"===e.category));return"noRel"===(null===e||void 0===e?void 0:e.output)?null:(0,d.jsx)(Qh,{currentPlayer:v,setCurrentPlayer:b,targetName:p.type,targetType:"npc",targetEmoji:p.symbol,showActions:!0,compact:!1,masterInteractions:C,updateStatus:S,masterResources:T,playerPosition:((e,t,n)=>{const r=null===v||void 0===v||null===(e=v.location)||void 0===e?void 0:e.g,o=null===(t=v._id)||void 0===t?void 0:t.toString(),a=null===(n=$c.default.getPlayersInGrid(r))||void 0===n?void 0:n[o];return(null===a||void 0===a?void 0:a.position)||null})(),targetPosition:((e,t)=>{const n=null===v||void 0===v||null===(e=v.location)||void 0===e?void 0:e.g,r=null===(t=Fc.Ay.getNPCsInGrid(n))||void 0===t?void 0:t[p.id];return(null===r||void 0===r?void 0:r.position)||null})(),TILE_SIZE:w,checkDistance:()=>{var e,t,n,r,o;if((null===v||void 0===v?void 0:v.gridId)===(null===v||void 0===v||null===(e=v.location)||void 0===e?void 0:e.g))return!0;const a=null===v||void 0===v||null===(t=v.location)||void 0===t?void 0:t.g,s=null===(n=v._id)||void 0===n?void 0:n.toString(),i=null===(r=$c.default.getPlayersInGrid(a))||void 0===r?void 0:r[s];if(null===i||void 0===i||!i.position)return!1;const l=null===(o=Fc.Ay.getNPCsInGrid(a))||void 0===o?void 0:o[p.id];if(null===l||void 0===l||!l.position)return!1;return(0,Oc.gd)(i.position,l.position)<=(0,Oc.ZW)(v,T)},onInteractionClick:()=>new Promise((e=>{var t,n,r,o;const a=null===(t=v.relationships)||void 0===t?void 0:t.find((e=>e.name===p.type));ue.current=a?{...a}:null;const s=null===v||void 0===v||null===(n=v.location)||void 0===n?void 0:n.g,i=null===(r=v._id)||void 0===r?void 0:r.toString(),l=null===(o=$c.default.getPlayersInGrid(s))||void 0===o?void 0:o[i];null!==l&&void 0!==l&&l.position&&_(l.position,w),e()})),onRelationshipChange:(e,t)=>{if(t&&e.relbitadd){const t=e.relbitadd.toLowerCase(),n=ue.current;if(!n||!n[t]){const e=su.find((e=>e.type===p.type)),n={met:"dialogOnMet",friend:"dialogOnFriend",married:"dialogOnMarried",love:"dialogOnLove",rival:"dialogOnRival"}[t];e&&n&&e[n]&&(de(t),le(!0))}}},isDeveloper:R})})(),!H&&(0,d.jsxs)("div",{style:{padding:"10px",backgroundColor:"var(--color-bg-light)",borderRadius:"5px",marginTop:"10px",textAlign:"center",fontStyle:"italic",color:"var(--color-text-muted)"},children:[M[625],p.type,"."]}),H&&V&&(0,d.jsx)("div",{style:{padding:"10px",backgroundColor:"var(--color-bg-light)",borderRadius:"5px",marginTop:"10px",textAlign:"center",fontStyle:"italic",color:"var(--color-text-muted)"},children:null===(n=M[627])||void 0===n?void 0:n.replace("{npc}",(null===(o=p)||void 0===o?void 0:o.type)||"")}),H&&0===j.length&&!V&&(0,d.jsx)("div",{style:{padding:"10px",backgroundColor:"var(--color-bg-light)",borderRadius:"5px",marginTop:"10px",textAlign:"center",fontStyle:"italic",color:"var(--color-text-muted)"},children:M[205]}),H&&(0,d.jsxs)(d.Fragment,{children:[j.length>0&&(0,d.jsx)("h3",{children:M[204]}),j.map((e=>{var t,n;const r=v.activeQuests.some((t=>t.questId===e.title&&t.completed&&!t.rewardCollected))?"reward":"accept",o=pe(e.level),i="reward"===r?()=>(async e=>{try{var t,n;const{multiplier:o,bonusMessage:i}=$h(p.type,v,M),l=Math.floor((e.rewardqty||1)*o),c=Array.isArray(m)?m:[],d=Array.isArray(g)?g:[],u=await(0,Kc.qf)({playerId:v.playerId,currentPlayer:v,resource:e.reward,quantity:l,inventory:c,backpack:d,setInventory:f,setBackpack:y,setCurrentPlayer:b,updateStatus:S,masterResources:T,globalTuning:N});if(!0!==u&&(!u||!1===u.success))return;try{if("Prospero's Orb"===e.reward){console.log(`\ud83c\udfc6 Awarding Prospero's Orb trophy for collecting ${l} orb(s)`);for(let e=0;e<l;e++)await(0,qc.p)(v.playerId,"Prospero's Orb",1,v,A,b);console.log(`\u2705 Successfully awarded ${l} Prospero's Orb trophy instance(s)`)}else if("Skeleton Key"===e.reward){console.log(`\ud83c\udfc6 Awarding Skeleton Key trophy for collecting ${l} key(s)`);for(let e=0;e<l;e++)await(0,qc.p)(v.playerId,"Skeleton Key",1,v,A,b);console.log(`\u2705 Successfully awarded ${l} Skeleton Key trophy instance(s)`)}else if("Golden Key"===e.reward){console.log(`\ud83c\udfc6 Awarding Golden Key trophy for collecting ${l} key(s)`);for(let e=0;e<l;e++)await(0,qc.p)(v.playerId,"Golden Key",1,v,A,b);console.log(`\u2705 Successfully awarded ${l} Golden Key trophy instance(s)`)}}catch(r){console.error("\u274c Error awarding quest reward trophy:",r)}await(0,Uc.D)(v,"Collect",e.reward,l,b);const h=T.find((e=>e.type===p.type&&"npc"===e.category)),x=null!==(t=null!==(n=e.xp)&&void 0!==n?n:null===h||void 0===h?void 0:h.xp)&&void 0!==t?t:1;try{const e=await a.A.post(`${s.A}/api/addXP`,{playerId:v.playerId,xpAmount:x});e.data.success&&b((t=>({...t,xp:e.data.newXP})))}catch(r){console.error("\u274c Error awarding XP for quest completion:",r)}let w=v.completedQuests.map((t=>t.questId===e.title?{...t,rewardCollected:!0}:t));w.some((t=>t.questId===e.title))||w.push({questId:e.title,rewardCollected:!0,timestamp:Date.now()});const C=v.activeQuests.filter((t=>t.questId!==e.title)),k={...v,completedQuests:w,activeQuests:C};await a.A.post(`${s.A}/api/update-profile`,{playerId:v.playerId,updates:{completedQuests:k.completedQuests,activeQuests:C}}).then((e=>{})),b((e=>({...e,completedQuests:k.completedQuests,activeQuests:C}))),D((t=>t.filter((t=>t.title!==e.title)))),await(0,au.LQ)("CollectedQuest",v.playerId,v,b),S(i?`Action item complete! Received ${l} ${(0,Bc.Z)(e.reward,M)}. ${i}`:201)}catch(r){console.error("Error collecting quest reward:",r),alert("Failed to collect quest reward.")}})(e):()=>(async e=>{if(!e)return;const t=j.find((t=>t.title===e));if(!t)return void console.error(`Quest "${e}" not found in available quests.`);let n={goal1:0,goal2:0,goal3:0},r=0,o=0;for(let a=1;a<=3;a++){const e=t[`goal${a}action`],s=t[`goal${a}item`],c=t[`goal${a}qty`];if(e&&s&&c)if(o++,"Acquire"===e){var i,l;const e=null===(i=v.skills)||void 0===i?void 0:i.some((e=>e.type===s)),t=null===(l=v.powers)||void 0===l?void 0:l.some((e=>e.type===s));e||t?(n[`goal${a}`]=1,r++):n[`goal${a}`]=0}else"Craft"===e&&Object.values(Fc.Ay.getNPCsInGrid(v.gridId)||{}).some((e=>e.type===s))?(n[`goal${a}`]=1,r++):n[`goal${a}`]=0}const c=o>0&&r===o;try{const t=await a.A.post(`${s.A}/api/add-player-quest`,{playerId:v.playerId,questId:e,startTime:Date.now(),progress:n,completed:c});t.data.success?(b(t.data.player),S(202)):G(`Failed to accept quest: ${t.data.error}`)}catch(d){console.error("Error accepting quest:",d),G("Error accepting quest. Check console.")}})(e.title),l=T.find((e=>e.type===p.type&&"npc"===e.category)),c=null!==(t=null!==(n=e.xp)&&void 0!==n?n:null===l||void 0===l?void 0:l.xp)&&void 0!==t?t:1;return(0,d.jsx)(Dh,{quest:{symbol:e.symbol,title:e.title,textbody:e.textbody,goals:[{action:e.goal1action,item:e.goal1item,qty:e.goal1qty},{action:e.goal2action,item:e.goal2item,qty:e.goal2qty},{action:e.goal3action,item:e.goal3item,qty:e.goal3qty}],reward:e.reward,rewardqty:e.rewardqty},state:r,onClick:i,xpReward:c,level:e.level,meetsLevelRequirement:o},e.title)}))]})]}),"heal"===p.action&&O.length>0&&(0,d.jsxs)("div",{className:"heal-options",children:[(0,d.jsx)(ep,{isHealing:ne,currentPlayer:v,TILE_SIZE:w,healAmount:p.qtycollected,onHealingComplete:()=>re(!1)}),(0,d.jsx)("br",{}),((e,t,n)=>{const r=null===v||void 0===v||null===(e=v.location)||void 0===e?void 0:e.g,o=null===(t=v._id)||void 0===t?void 0:t.toString(),a=null===(n=$c.default.getPlayersInGrid(r))||void 0===n?void 0:n[o];return a?(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("h3",{children:[M[511]," ",(0,d.jsx)("br",{}),a.hp," / ",a.maxhp]})}):(0,d.jsx)("h4",{children:M[512]})})(),(0,d.jsx)("br",{}),O.map((e=>{var t,n;const r=(0,Yd.gU)(e,T),o=(0,Kc.Fp)(e,m,1),a=e.qtycollected,s=`heal-${e.type}`,i=oe.has(s),l=null===v||void 0===v||null===(t=v.location)||void 0===t?void 0:t.g,c=null===(n=Fc.Ay.getNPCsInGrid(l))||void 0===n?void 0:n[p.id],u=c&&void 0!==c.hp&&c.hp<=0,h=T.find((e=>e.type===p.type&&"npc"===e.category)),f=(null===h||void 0===h?void 0:h.maxhp)||"Unknown";return(0,d.jsxs)("div",{children:[(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,M),details:`${M[463]} \u2764\ufe0f\u200d\ud83e\ude79 +${a}<br>${M[461]} ${r.join(", ")||"None"}`,info:`${M[51]}${f}`,disabled:!o||ne||i||u,onClick:()=>ge(e),className:i?"cooldown":"",style:i?{"--cooldown-duration":"1.5s"}:{},gemCost:e.gemcost||null,onGemPurchase:!e.gemcost||o||ne||i||u?null:e=>fe(e,"heal"),resource:e,inventory:m,backpack:g,masterResources:T,currentPlayer:v}),c&&void 0!==c.hp&&(0,d.jsxs)("div",{className:"healer-hp-text",children:[M[49]," ",c.hp]})]},e.type)})),z&&(0,d.jsx)("p",{className:"error-message",children:z})]}),"trade"===p.action&&(0,d.jsxs)("div",{className:"trade-options",children:[(e=>{const t=null===v||void 0===v||null===(e=v.relationships)||void 0===e?void 0:e.find((e=>e.name===p.type));if(null===t||void 0===t||!t.met)return null;const n=su.find((e=>e.type===p.type));if(!n)return null;const r=[n.interest1,n.interest2,n.interest3].filter(Boolean),o=[...new Set(r)];if(0===o.length)return null;const a=o.map((e=>{const t=T.find((t=>t.type===e));return t?{type:e,symbol:t.symbol}:null})).filter(Boolean);return 0===a.length?null:(0,d.jsxs)("div",{style:{marginBottom:"10px",display:"flex",alignItems:"center",gap:"8px"},children:[(0,d.jsx)("h3",{style:{margin:0},children:M[619]}),a.map(((e,t)=>(0,d.jsx)("span",{title:e.type,style:{fontSize:"1.5em"},children:e.symbol},t)))]})})(),(e=>{const t=null===v||void 0===v||null===(e=v.relationships)||void 0===e?void 0:e.find((e=>e.name===p.type));if(null===t||void 0===t||!t.met)return null;const n=su.find((e=>e.type===p.type));if(!n)return null;const r=["love","friend","rival","married"],o=[];if(Object.entries(n).forEach((e=>{let[t,n]=e;if(r.includes(n)){const e=su.find((e=>e.type===t));e&&o.push({targetName:t,targetSymbol:e.symbol,relationshipType:n})}})),0===o.length)return null;const a={love:o.filter((e=>"love"===e.relationshipType)),friend:o.filter((e=>"friend"===e.relationshipType)),rival:o.filter((e=>"rival"===e.relationshipType)),married:o.filter((e=>"married"===e.relationshipType))},s={love:660,friend:661,rival:662,married:663};return(0,d.jsx)("div",{style:{marginBottom:"10px"},children:Object.entries(a).map((e=>{let[t,n]=e;return 0===n.length?null:(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[(0,d.jsx)("h3",{style:{margin:0},children:M[s[t]]}),n.map(((e,t)=>(0,d.jsx)("span",{title:e.targetName,style:{fontSize:"1.5em",cursor:"help"},children:e.targetSymbol},t)))]},t)}))})})(),(()=>{const e=T.find((e=>e.type===p.type&&"npc"===e.category));return"noRel"===(null===e||void 0===e?void 0:e.output)?null:(0,d.jsx)(Qh,{currentPlayer:v,setCurrentPlayer:b,targetName:p.type,targetType:"npc",targetEmoji:p.symbol,showActions:!0,compact:!1,masterInteractions:C,updateStatus:S,masterResources:T,playerPosition:((e,t,n)=>{const r=null===v||void 0===v||null===(e=v.location)||void 0===e?void 0:e.g,o=null===(t=v._id)||void 0===t?void 0:t.toString(),a=null===(n=$c.default.getPlayersInGrid(r))||void 0===n?void 0:n[o];return(null===a||void 0===a?void 0:a.position)||null})(),targetPosition:((e,t)=>{const n=null===v||void 0===v||null===(e=v.location)||void 0===e?void 0:e.g,r=null===(t=Fc.Ay.getNPCsInGrid(n))||void 0===t?void 0:t[p.id];return(null===r||void 0===r?void 0:r.position)||null})(),TILE_SIZE:w,checkDistance:()=>{var e,t,n,r,o;if((null===v||void 0===v?void 0:v.gridId)===(null===v||void 0===v||null===(e=v.location)||void 0===e?void 0:e.g))return!0;const a=null===v||void 0===v||null===(t=v.location)||void 0===t?void 0:t.g,s=null===(n=v._id)||void 0===n?void 0:n.toString(),i=null===(r=$c.default.getPlayersInGrid(a))||void 0===r?void 0:r[s];if(null===i||void 0===i||!i.position)return!1;const l=null===(o=Fc.Ay.getNPCsInGrid(a))||void 0===o?void 0:o[p.id];if(null===l||void 0===l||!l.position)return!1;return(0,Oc.gd)(i.position,l.position)<=(0,Oc.ZW)(v,T)},onInteractionClick:()=>new Promise((e=>{var t,n,r,o;const a=null===(t=v.relationships)||void 0===t?void 0:t.find((e=>e.name===p.type));ue.current=a?{...a}:null;const s=null===v||void 0===v||null===(n=v.location)||void 0===n?void 0:n.g,i=null===(r=v._id)||void 0===r?void 0:r.toString(),l=null===(o=$c.default.getPlayersInGrid(s))||void 0===o?void 0:o[i];null!==l&&void 0!==l&&l.position&&_(l.position,w),e()})),onRelationshipChange:(e,t)=>{if(t&&e.relbitadd){const t=e.relbitadd.toLowerCase(),n=ue.current;if(!n||!n[t]){const e=su.find((e=>e.type===p.type)),n={met:"dialogOnMet",friend:"dialogOnFriend",married:"dialogOnMarried",love:"dialogOnLove",rival:"dialogOnRival"}[t];e&&n&&e[n]&&(de(t),le(!0))}}},isDeveloper:R})})(),!X&&(0,d.jsxs)("div",{style:{padding:"10px",backgroundColor:"var(--color-bg-light)",borderRadius:"5px",marginTop:"10px",textAlign:"center",fontStyle:"italic",color:"var(--color-text-muted)"},children:[M[626],p.type,"."]}),X&&ee&&(0,d.jsx)("div",{style:{padding:"10px",backgroundColor:"var(--color-bg-light)",borderRadius:"5px",marginTop:"10px",textAlign:"center",fontStyle:"italic",color:"var(--color-text-muted)"},children:null===(i=M[628])||void 0===i?void 0:i.replace("{npc}",(null===(c=p)||void 0===c?void 0:c.type)||"")}),X&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:M[420]}),L.length>0?(()=>{const e=L.filter((e=>{if(!1===e.repeat){const t=null===m||void 0===m?void 0:m.some((t=>t.type===e.type)),n=null===g||void 0===g?void 0:g.some((t=>t.type===e.type));if(t||n)return!1}return!0}));return 0===e.length?(0,d.jsx)("p",{children:M[423]}):e.map((e=>{var t,n;const r=(0,Kc.Fp)(e,m,g,1),o="devonly"===e.requires||(e=>{var t;return!e||(null===(t=v.skills)||void 0===t?void 0:t.some((t=>t.type===e)))})(e.requires),a=pe(e.level),s=o&&a,i=e.tradeqty||1;let l="";if(e.requiresArray&&Array.isArray(e.requiresArray))l=e.requiresArray.map((e=>{var t,n,r;const o=e.type,a=e.quantity;if(!o||!a)return"";const s=((null===m||void 0===m||null===(t=m.find((e=>e.type===o)))||void 0===t?void 0:t.quantity)||0)+((null===g||void 0===g||null===(n=g.find((e=>e.type===o)))||void 0===n?void 0:n.quantity)||0),i=s>=a?"green":"red",l=(null===(r=T.find((e=>e.type===o)))||void 0===r?void 0:r.symbol)||"";return`<span style="color: ${i}; display: block;">${l} ${(0,Bc.Z)(o,M)} ${a} / ${s}</span>`})).join("");else{const t=[];for(let n=1;n<=10;n++){var c,u,h;const r=e[`ingredient${n}`],o=e[`ingredient${n}qty`];if(!r||!o)continue;const a=((null===m||void 0===m||null===(c=m.find((e=>e.type===r)))||void 0===c?void 0:c.quantity)||0)+((null===g||void 0===g||null===(u=g.find((e=>e.type===r)))||void 0===u?void 0:u.quantity)||0),s=a>=o?"green":"red",i=(null===(h=T.find((e=>e.type===r)))||void 0===h?void 0:h.symbol)||"";t.push(`<span style="color: ${s}; display: block;">${i} ${(0,Bc.Z)(r,M)} ${o} / ${a}</span>`)}l=t.join("")}const f=T.find((e=>e.type===p.type&&"npc"===e.category)),y=null!==(t=null!==(n=e.xp)&&void 0!==n?n:null===f||void 0===f?void 0:f.xp)&&void 0!==t?t:1,b=a?"green":"red",x=(e.level?`<span style="color: ${b};">${M[10149]||"Level"} ${e.level}</span>`:"")+`${M[461]}<div>${l}</div><div style="margin-top: 8px; color: #4CAF50;">\ud83d\udd37 +${y} XP</div>`,w=!r||!s;return(0,d.jsx)(Eh,{symbol:e.symbol,name:`${i} ${(0,Bc.Z)(e.type,M)}`,details:x,disabled:w,onClick:()=>ye(e),gemCost:e.gemcost||null,onGemPurchase:!e.gemcost||r&&s?null:e=>fe(e,"trade"),meetsLevelRequirement:a,resource:e,inventory:m,backpack:g,masterResources:T,currentPlayer:v,devOnly:!1},`${e.source}-${e.index}`)}))})():(0,d.jsx)("p",{children:M[423]})]}),(0,d.jsx)("hr",{style:{margin:"16px 0",border:"none",borderTop:"1px solid var(--color-border, #444)"}}),(e=>{const t=null===(e=v.relationships)||void 0===e?void 0:e.find((e=>e.name===p.type));if(null===t||void 0===t||!t.met)return null;const n=su.find((e=>e.type===p.type)),r=null===n||void 0===n?void 0:n.dialogOnMet;if(r&&M[r]){const e=M[r].replace(/\{username\}/gi,(null===v||void 0===v?void 0:v.username)||"Adventurer");return(0,d.jsx)("div",{className:"trader-story",children:(0,d.jsx)("p",{children:e})})}return null})()]})]}),R&&(0,d.jsx)("div",{className:"station-panel-footer",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{if(await l(null===v||void 0===v?void 0:v.username))if(p&&p.id)try{const e=v.location.g;await Fc.Ay.removeNPC(e,p.id),S(`${(0,Bc.Z)(p.type,M)} has been removed from the grid.`),h()}catch(e){console.error("Error selling NPC:",e),S(`\u274c Failed to remove ${(0,Bc.Z)(p.type,M)}.`)}else console.error("Cannot sell NPC: Missing NPC data or ID");else S("\u274c Developer access required.")},children:M[490]})})})]}),(0,d.jsx)(iu,{isOpen:ie,onClose:()=>{var e;le(!1),"Constable Elbow"===(null===(e=p)||void 0===e?void 0:e.type)&&"met"===ce&&(0,au.LQ)("MetConstableElbow",v.playerId,v,b)},npcName:null===(u=p)||void 0===u?void 0:u.type,relationshipType:ce,username:null===v||void 0===v?void 0:v.username})]})},np=t.memo(tp);var rp=n(3287);const op=e=>{var n,o,i,l;let{TILE_SIZE:c,resources:u,setResources:h,inventory:p,setInventory:m,backpack:f,setBackpack:g,currentPlayer:y,setCurrentPlayer:v,gridId:b,masterResources:x,masterSkills:w,updateStatus:S,isDeveloper:T,currentSeason:C,globalTuning:k,masterXPLevels:A,cursorMode:I,setCursorMode:E}=e;const{closePanel:P}=(0,Xc.d)(),[_,N]=(0,t.useState)([]),[R,M]=(0,t.useState)([]),[j,D]=(0,t.useState)(!1),[O,B]=(0,t.useState)(!1),L=(0,r.k)(),[F,$]=(0,t.useState)(null!==(n=null===y||void 0===y||null===(o=y.settings)||void 0===o?void 0:o.plantWithCursor)&&void 0!==n&&n);(0,t.useEffect)((()=>{console.log("\ud83c\udfd7\ufe0f BuildPanel opened with currentPlayer:",{username:null===y||void 0===y?void 0:y.username,role:null===y||void 0===y?void 0:y.role,homeSettlementId:null===y||void 0===y?void 0:y.settlementId,currentLocation:null===y||void 0===y?void 0:y.location,isDeveloper:T});(async()=>{try{let e=!1;if("town"===y.location.gtype&&y.location.s){console.log("\ud83c\udfdb\ufe0f In town, checking if player is mayor...");const t=await sh(y.location.s);e=t===y.username,console.log("\ud83c\udfdb\ufe0f Mayor check:",{mayorUsername:t,playerUsername:y.username,isPlayerMayor:e})}B(e);const t=await a.A.get(`${s.A}/api/inventory/${y.playerId}`);m(t.data.inventory||[]);const n=(await a.A.get(`${s.A}/api/resources`)).data;M(n);const r=n.filter((e=>"BuildTown"===e.source));console.log("\ud83c\udfe2 BuildTown resources found:",r.map((e=>e.type)));const o=n.filter((t=>{if(!(0,Yd.vh)(t,T))return!1;const n=String(y.location.s||""),r=String(y.settlementId||""),o=n===r;"BuildTown"===t.source&&console.log(`BuildPanel: Checking ${t.type}:`,{source:t.source,gtype:y.location.gtype,isPlayerMayor:e,currentSettlement:y.location.s,homeSettlement:y.settlementId,currentSettlementStr:n,homeSettlementStr:r,settlementsMatch:o,isDeveloper:T});if(!("Build"===t.source||"BuildTown"===t.source&&"town"===y.location.gtype&&(e||T)&&(o||T)||"BuildValley"===t.source&&"homestead"!=y.location.gtype))return!1;if(t.season&&C&&t.season!==C)return!1;if("pet"===t.category){if(console.log(`\ud83d\udc3e Checking pet ${t.type}...`),"homestead"!==y.location.gtype&&!T)return console.log(`\ud83d\udc3e Filtering out pet ${t.type} - not on homestead`),!1;const e=u.find((e=>e.layoutkey===t.type||e.type===t.type));if(e&&!T)return console.log(`\ud83d\udc3e Filtering out pet ${t.type} - already exists on grid (layoutkey: ${e.layoutkey}, type: ${e.type})`),!1;console.log(`\ud83d\udc3e Pet ${t.type} is available to build`)}return!0})),i=o.filter((e=>"BuildTown"===e.source));console.log("\ud83c\udfd7\ufe0f Final BuildPanel options:",{totalOptions:o.length,buildTownIncluded:i.map((e=>e.type)),shouldHaveBuildTown:"town"===y.location.gtype&&(e||T)&&(String(y.location.s)===String(y.settlementId)||T)}),N(o)}catch(e){console.error("Error fetching build panel data:",e)}finally{D(!1)}})()}),[y,null===y||void 0===y||null===(i=y.location)||void 0===i?void 0:i.s,null===y||void 0===y||null===(l=y.location)||void 0===l?void 0:l.gtype,null===y||void 0===y?void 0:y.settlementId,T,C]);const G=ih(y,A),z=(null===k||void 0===k?void 0:k.maxTownBuildings)||500,U=u&&R?u.filter((e=>{const t=R.find((t=>t.type===e.type));return t&&"BuildTown"===t.source})).length:0,H=async e=>(0,rp.q)({TILE_SIZE:c,selectedItem:e.type,buildOptions:_,inventory:p,setInventory:m,backpack:f,setBackpack:g,resources:u,setResources:h,currentPlayer:y,setCurrentPlayer:v,gridId:b,updateStatus:S,modifiedRecipe:e});return(0,d.jsx)(Zc,{onClose:P,descriptionKey:"1002",titleKey:"1102",panelName:"BuildPanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:"8px",marginBottom:"10px",padding:"5px 0"},children:[(0,d.jsx)("label",{style:{fontFamily:"var(--font-title-4-family)",fontSize:"var(--font-title-4-size)",cursor:"pointer"},children:L[10187]||"Place with cursor"}),(0,d.jsx)("input",{type:"checkbox",checked:F,onChange:e=>{return t=e.target.checked,$(t),t||E(null),void hh({plantWithCursor:t},y,v);var t},style:{width:"18px",height:"18px",cursor:"pointer"}})]}),j?(0,d.jsx)("p",{children:L[98]}):(0,d.jsx)(d.Fragment,{children:_.map((e=>{(0,Yd.gU)(e,R);const t=(0,Kc.Fp)(e,p,f),n=(r=e.requires,(0,Yd.rw)(r,y));var r;const o=!(a=e.level)||G>=a;var a;const s=n&&o,i="BuildTown"===e.source&&"homestead"!==y.location.gtype&&U>=z,l=!t||!s||i;let w="";"build"===(null===I||void 0===I?void 0:I.type)&&(null===I||void 0===I?void 0:I.item)===e.type&&(w+="cursor-selected ");const T=[1,2,3,4].map((t=>{var n,r,o;const a=e[`ingredient${t}`],s=e[`ingredient${t}qty`];if(!a||!s)return"";const i=((null===p||void 0===p||null===(n=p.find((e=>e.type===a)))||void 0===n?void 0:n.quantity)||0)+((null===f||void 0===f||null===(r=f.find((e=>e.type===a)))||void 0===r?void 0:r.quantity)||0),l=i>=s?"green":"red",c=(null===(o=R.find((e=>e.type===a)))||void 0===o?void 0:o.symbol)||"";return`<span style="color: ${l}; display: block;">${c} ${(0,Bc.Z)(a,L)} ${s} / ${i}</span>`})).join(""),C=n?"green":"red",k=o?"green":"red",A=(i?`<span style="color: red;">${L[407]}</span>`:"")+(e.level?`<span style="color: ${k};">${L[10149]||"Level"} ${e.level}</span>`:"")+(e.requires?`<span style="color: ${C};">${L[460]}${(0,Bc.Z)(e.requires,L)}</span>`:"")+`${L[461]}<div>${T}</div>`,P=`\n                ${L[820]}${R.filter((t=>t.source===e.type)).map((e=>`${e.symbol||""} ${(0,Bc.Z)(e.type,L)}`)).join(", ")||"None"}\n              `;return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,L),details:A,info:P,disabled:l,className:w,onClick:()=>{l||(F?(e=>{E({type:"build",item:e.type,emoji:e.symbol||"\ud83c\udfd7\ufe0f",filename:e.filename||null,size:e.size||1,buildOptions:_})})(e):(0,rp.handleConstruction)({TILE_SIZE:c,selectedItem:e.type,buildOptions:_,inventory:p,setInventory:m,backpack:f,setBackpack:g,resources:u,setResources:h,setErrorMessage:console.error,currentPlayer:y,setCurrentPlayer:v,gridId:b,updateStatus:S}))},onGemPurchase:!e.gemcost||t&&s||i?null:H,meetsLevelRequirement:o,resource:e,inventory:p,backpack:f,masterResources:x||R,currentPlayer:y,devOnly:"devonly"===e.requires,filename:e.filename},e.type)}))})]})})},ap=t.memo(op),sp=e=>{var n,o;let{TILE_SIZE:i,resources:l,setResources:c,inventory:u,setInventory:h,backpack:p,setBackpack:m,currentPlayer:f,setCurrentPlayer:g,gridId:y,masterResources:v,masterSkills:b,updateStatus:x,isDeveloper:w,currentSeason:S,NPCsInGrid:T,globalTuning:C,masterXPLevels:k,cursorMode:A,setCursorMode:I}=e;const{closePanel:E}=(0,Xc.d)(),[P,_]=(0,t.useState)([]),[N,R]=(0,t.useState)([]),[M,j]=(0,t.useState)(!1),D=(0,r.k)(),[O,B]=(0,t.useState)(null!==(n=null===f||void 0===f||null===(o=f.settings)||void 0===o?void 0:o.plantWithCursor)&&void 0!==n&&n);(0,t.useEffect)((()=>{(async()=>{try{var e;const t=await a.A.get(`${s.A}/api/inventory/${f.playerId}`);h(t.data.inventory||[]);const n=(await a.A.get(`${s.A}/api/resources`)).data;R(n);const r="homestead"===(null===f||void 0===f||null===(e=f.location)||void 0===e?void 0:e.gtype),o=n.filter((e=>!!(0,Yd.vh)(e,w)&&("Buy"===e.source&&(!(!w&&!r&&!1===e.passable)&&(!e.season||!S||e.season===S)))));_(o)}catch(t){console.error("Error fetching buy panel data:",t)}finally{j(!1)}})()}),[f]);const L=ih(f,k),F=async e=>(0,rp.q)({TILE_SIZE:i,selectedItem:e.type,buildOptions:P,inventory:u,setInventory:h,backpack:p,setBackpack:m,resources:l,setResources:c,currentPlayer:f,setCurrentPlayer:g,gridId:y,updateStatus:x,modifiedRecipe:e}),$=(null===C||void 0===C?void 0:C.maxFarmAnimals)||10,G=(()=>{var e;return null!==T&&void 0!==T&&null!==(e=T[y])&&void 0!==e&&e.npcs?Object.values(T[y].npcs).filter((e=>"graze"===e.action)).length:0})();return(0,d.jsx)(Zc,{onClose:E,descriptionKey:"1003",titleKey:"1103",panelName:"BuyPanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:"8px",marginBottom:"10px",padding:"5px 0"},children:[(0,d.jsx)("label",{style:{fontFamily:"var(--font-title-4-family)",fontSize:"var(--font-title-4-size)",cursor:"pointer"},children:D[10187]||"Place with cursor"}),(0,d.jsx)("input",{type:"checkbox",checked:O,onChange:e=>{return t=e.target.checked,B(t),t||I(null),void hh({plantWithCursor:t},f,g);var t},style:{width:"18px",height:"18px",cursor:"pointer"}})]}),M?(0,d.jsx)("p",{children:D[98]}):(0,d.jsx)(d.Fragment,{children:P.map((e=>{var t;(0,Yd.gU)(e,N);const n=(0,Kc.Fp)(e,u),r=(o=e.requires,(0,Yd.rw)(o,f));var o;const a=!(s=e.level)||L>=s;var s;const b=r&&a,w=e.passable&&"graze"===e.action&&G>=$,S=!n||!b||w;let T="";"build"===(null===A||void 0===A?void 0:A.type)&&(null===A||void 0===A?void 0:A.item)===e.type&&(T+="cursor-selected ");const C=[1,2,3,4].map((t=>{var n,r,o;const a=e[`ingredient${t}`],s=e[`ingredient${t}qty`];if(!a||!s)return"";const i=((null===u||void 0===u||null===(n=u.find((e=>e.type===a)))||void 0===n?void 0:n.quantity)||0)+((null===p||void 0===p||null===(r=p.find((e=>e.type===a)))||void 0===r?void 0:r.quantity)||0),l=i>=s?"green":"red",c=(null===(o=N.find((e=>e.type===a)))||void 0===o?void 0:o.symbol)||"";return`<span style="color: ${l}; display: block;">${c} ${(0,Bc.Z)(a,D)} ${s} / ${i}</span>`})).join(""),k=r?"green":"red",E=a?"green":"red",_=(w?`<span style="color: red;">${D[407]} (${$})</span>`:"")+(e.level?`<span style="color: ${E};">${D[10149]||"Level"} ${e.level}</span>`:"")+(e.requires?`<span style="color: ${k};">${D[460]}${(0,Bc.Z)(e.requires,D)}</span>`:"")+`${D[461]}<div>${C}</div>`,R=(0,d.jsxs)("div",{className:"info-content",children:[(0,d.jsxs)("div",{children:[D[820],e.output?`${(null===(t=N.find((t=>t.type===e.output)))||void 0===t?void 0:t.symbol)||""} ${(0,Bc.Z)(e.output,D)}`:"Nothing"]}),(0,d.jsxs)("div",{children:[D[821],e.qtycollected||1]})]});return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,D),details:_,info:R,disabled:S,className:T,onClick:()=>{S||(O?(e=>{I({type:"build",item:e.type,emoji:e.symbol||"\ud83d\udc2e",filename:e.filename||null,size:e.size||1,buildOptions:P})})(e):(0,rp.handleConstruction)({TILE_SIZE:i,selectedItem:e.type,buildOptions:P,inventory:u,setInventory:h,backpack:p,setBackpack:m,resources:l,setResources:c,setErrorMessage:console.error,currentPlayer:f,setCurrentPlayer:g,gridId:y,updateStatus:x}))},onGemPurchase:!e.gemcost||n&&b||w?null:F,meetsLevelRequirement:a,resource:e,inventory:u,backpack:p,masterResources:v||N,currentPlayer:f,devOnly:"devonly"===e.requires},e.type)}))})]})})},ip=t.memo(sp),lp=e=>{var n,o;let{TILE_SIZE:i,resources:l,setResources:c,inventory:u,setInventory:h,backpack:p,setBackpack:m,currentPlayer:f,setCurrentPlayer:g,gridId:y,masterResources:v,masterSkills:b,updateStatus:x,isDeveloper:w,currentSeason:S,cursorMode:T,setCursorMode:C}=e;const{closePanel:k}=(0,Xc.d)(),[A,I]=(0,t.useState)([]),[E,P]=(0,t.useState)([]),[_,N]=(0,t.useState)(!1),R=(0,r.k)(),[M,j]=(0,t.useState)(null!==(n=null===f||void 0===f||null===(o=f.settings)||void 0===o?void 0:o.plantWithCursor)&&void 0!==n&&n);(0,t.useEffect)((()=>{(async()=>{try{var e;const t=await a.A.get(`${s.A}/api/inventory/${f.playerId}`);h(t.data.inventory||[]);const n=(await a.A.get(`${s.A}/api/resources`)).data;P(n);const r="homestead"===(null===f||void 0===f||null===(e=f.location)||void 0===e?void 0:e.gtype),o=n.filter((e=>!!(0,Yd.vh)(e,w)&&("Zoo"===e.source&&(!(!w&&!r)&&(!e.season||!S||e.season===S)))));I(o)}catch(t){console.error("Error fetching buy panel data:",t)}finally{N(!1)}})()}),[f]);const D=async e=>(0,rp.q)({TILE_SIZE:i,selectedItem:e.type,buildOptions:A,inventory:u,setInventory:h,backpack:p,setBackpack:m,resources:l,setResources:c,currentPlayer:f,setCurrentPlayer:g,gridId:y,updateStatus:x,modifiedRecipe:e});return(0,d.jsx)(Zc,{onClose:k,descriptionKey:"1039",titleKey:"1139",panelName:"PetsPanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:"8px",marginBottom:"10px",padding:"5px 0"},children:[(0,d.jsx)("label",{style:{fontFamily:"var(--font-title-4-family)",fontSize:"var(--font-title-4-size)",cursor:"pointer"},children:R[10187]||"Place with cursor"}),(0,d.jsx)("input",{type:"checkbox",checked:M,onChange:e=>{return t=e.target.checked,j(t),t||C(null),void hh({plantWithCursor:t},f,g);var t},style:{width:"18px",height:"18px",cursor:"pointer"}})]}),_?(0,d.jsx)("p",{children:R[98]}):(0,d.jsx)(d.Fragment,{children:A.map((e=>{(0,Yd.gU)(e,E);const t=(0,Kc.Fp)(e,u),n=(r=e.requires,(0,Yd.rw)(r,f));var r;const o=!t||!n;let a="";"build"===(null===T||void 0===T?void 0:T.type)&&(null===T||void 0===T?void 0:T.item)===e.type&&(a+="cursor-selected ");const s=[1,2,3,4].map((t=>{var n,r,o;const a=e[`ingredient${t}`],s=e[`ingredient${t}qty`];if(!a||!s)return"";const i=(null===u||void 0===u||null===(n=u.find((e=>e.type===a)))||void 0===n?void 0:n.quantity)||0,l=(null===p||void 0===p||null===(r=p.find((e=>e.type===a)))||void 0===r?void 0:r.quantity)||0,c=i+l,d=c>=s?"green":"red",h=(null===(o=E.find((e=>e.type===a)))||void 0===o?void 0:o.symbol)||"";return`<span style="color: ${d}; display: block;">${h} ${(0,Bc.Z)(a,R)} ${s} / ${c}</span>`})).join(""),b=n?"green":"red",w=(e.requires?`<span style="color: ${b};">${R[460]}${(0,Bc.Z)(e.requires,R)}</span><br>`:"")+`${R[461]}<div>${s}</div>`;return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,R),details:w,hideInfo:!0,disabled:o,className:a,onClick:()=>{o||(M?(e=>{C({type:"build",item:e.type,emoji:e.symbol||"\ud83d\udc12",filename:e.filename||null,size:e.size||1,buildOptions:A})})(e):(0,rp.handleConstruction)({TILE_SIZE:i,selectedItem:e.type,buildOptions:A,inventory:u,setInventory:h,backpack:p,setBackpack:m,resources:l,setResources:c,setErrorMessage:console.error,currentPlayer:f,setCurrentPlayer:g,gridId:y,updateStatus:x}))},onGemPurchase:e.gemcost&&o?D:null,resource:e,inventory:u,backpack:p,masterResources:v||E,currentPlayer:f,devOnly:"devonly"===e.requires},e.type)}))})]})})},cp=t.memo(lp),dp=e=>{var n,o;let{TILE_SIZE:i,resources:l,setResources:c,inventory:u,setInventory:h,backpack:p,setBackpack:m,currentPlayer:f,setCurrentPlayer:g,gridId:y,masterResources:v,masterSkills:b,updateStatus:x,isDeveloper:w,currentSeason:S,cursorMode:T,setCursorMode:C}=e;const{closePanel:k}=(0,Xc.d)(),[A,I]=(0,t.useState)([]),[E,P]=(0,t.useState)([]),[_,N]=(0,t.useState)(!1),R=(0,r.k)(),[M,j]=(0,t.useState)(null!==(n=null===f||void 0===f||null===(o=f.settings)||void 0===o?void 0:o.plantWithCursor)&&void 0!==n&&n);(0,t.useEffect)((()=>{(async()=>{try{var e;const t=await a.A.get(`${s.A}/api/inventory/${f.playerId}`);h(t.data.inventory||[]);const n=(await a.A.get(`${s.A}/api/resources`)).data;P(n);const r="homestead"===(null===f||void 0===f||null===(e=f.location)||void 0===e?void 0:e.gtype),o=n.filter((e=>!!(0,Yd.vh)(e,w)&&("Deco"===e.source&&(!(!w&&!r&&!1===e.passable)&&(!e.season||!S||e.season===S)))));I(o)}catch(t){console.error("Error fetching buy panel data:",t)}finally{N(!1)}})()}),[f]);const D=async e=>(0,rp.q)({TILE_SIZE:i,selectedItem:e.type,buildOptions:A,inventory:u,setInventory:h,backpack:p,setBackpack:m,resources:l,setResources:c,currentPlayer:f,setCurrentPlayer:g,gridId:y,updateStatus:x,modifiedRecipe:e});return(0,d.jsx)(Zc,{onClose:k,descriptionKey:"1031",titleKey:"1131",panelName:"BuyDecoPanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:"8px",marginBottom:"10px",padding:"5px 0"},children:[(0,d.jsx)("label",{style:{fontFamily:"var(--font-title-4-family)",fontSize:"var(--font-title-4-size)",cursor:"pointer"},children:R[10187]||"Place with cursor"}),(0,d.jsx)("input",{type:"checkbox",checked:M,onChange:e=>{return t=e.target.checked,j(t),t||C(null),void hh({plantWithCursor:t},f,g);var t},style:{width:"18px",height:"18px",cursor:"pointer"}})]}),_?(0,d.jsx)("p",{children:R[98]}):(0,d.jsx)(d.Fragment,{children:A.map((e=>{(0,Yd.gU)(e,E);const t=(0,Kc.Fp)(e,u),n=(r=e.requires,(0,Yd.rw)(r,f));var r;const o=!t||!n;let a="";"build"===(null===T||void 0===T?void 0:T.type)&&(null===T||void 0===T?void 0:T.item)===e.type&&(a+="cursor-selected ");const s=[1,2,3,4].map((t=>{var n,r,o;const a=e[`ingredient${t}`],s=e[`ingredient${t}qty`];if(!a||!s)return"";const i=(null===u||void 0===u||null===(n=u.find((e=>e.type===a)))||void 0===n?void 0:n.quantity)||0,l=(null===p||void 0===p||null===(r=p.find((e=>e.type===a)))||void 0===r?void 0:r.quantity)||0,c=i+l,d=c>=s?"green":"red",h=(null===(o=E.find((e=>e.type===a)))||void 0===o?void 0:o.symbol)||"";return`<span style="color: ${d}; display: block;">${h} ${(0,Bc.Z)(a,R)} ${s} / ${c}</span>`})).join(""),b=n?"green":"red",w=(e.requires?`<span style="color: ${b};">${R[460]}${(0,Bc.Z)(e.requires,R)}</span><br>`:"")+`${R[461]}<div>${s}</div>`;return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,R),details:w,disabled:o,className:a,onClick:()=>{o||(M?(e=>{C({type:"build",item:e.type,emoji:e.symbol||"\ud83e\udeb4",filename:e.filename||null,size:e.size||1,buildOptions:A})})(e):(0,rp.handleConstruction)({TILE_SIZE:i,selectedItem:e.type,buildOptions:A,inventory:u,setInventory:h,backpack:p,setBackpack:m,resources:l,setResources:c,setErrorMessage:console.error,currentPlayer:f,setCurrentPlayer:g,gridId:y,updateStatus:x}))},gemCost:e.gemcost||null,onGemPurchase:e.gemcost&&o?D:null,resource:e,inventory:u,backpack:p,masterResources:v||E,currentPlayer:f,devOnly:"devonly"===e.requires,filename:e.filename},e.type)}))})]})})},up=t.memo(dp);var hp=n(5519);const pp=(e,t)=>{if(!e||e<=t)return"0s";const n=e-t,r=Math.floor(n/864e5),o=Math.floor(n%864e5/36e5),a=Math.floor(n%36e5/6e4),s=Math.floor(n%6e4/1e3),i=[];return r>0&&i.push(`${r}d`),o>0&&i.push(`${o}h`),a>0&&i.push(`${a}m`),(s>0||0===i.length)&&i.push(`${s}s`),i.join(" ")},mp=e=>{if(!e||e<=0)return"0s";const t=Math.floor(e/86400),n=Math.floor(e%86400/3600),r=Math.floor(e%3600/60),o=Math.floor(e%60),a=[];return t>0&&a.push(`${t}d`),n>0&&a.push(`${n}h`),r>0&&a.push(`${r}m`),(o>0||0===a.length)&&a.push(`${o}s`),a.slice(0,2).join(" ")},fp=e=>{var n,o;let{onClose:i,TILE_SIZE:l,inventory:c,setInventory:u,backpack:h,setBackpack:p,resources:m,setResources:f,tiles:g,tileTypes:y,setTileTypes:v,currentPlayer:b,setCurrentPlayer:x,gridId:w,masterResources:S,masterSkills:T,updateStatus:C,currentSeason:k,isDeveloper:A,cursorMode:I,setCursorMode:E}=e;const P=(0,r.k)(),[_,N]=(0,t.useState)([]),[R,M]=(0,t.useState)([]),[j,D]=(0,t.useState)(!1),[O,B]=(0,t.useState)(new Set),[L,F]=(0,t.useState)(null!==(n=null===b||void 0===b||null===(o=b.settings)||void 0===o?void 0:o.plantWithCursor)&&void 0!==n&&n);(0,t.useEffect)((()=>{$()}),[]);const $=async()=>{try{const e=await a.A.get(`${s.A}/api/inventory/${b.playerId}`);u(e.data.inventory||[]);const t=(await a.A.get(`${s.A}/api/resources`)).data;M(t);const n=t.filter((e=>"farmplot"===e.category&&!!(0,Yd.vh)(e,A))).map((e=>({...e,isOffSeason:e.season&&k&&e.season!==k})));N(n)}catch(e){console.error("Error fetching farming panel data:",e)}finally{D(!1)}};return(0,d.jsx)(Zc,{onClose:i,descriptionKey:"1004",titleKey:"1104",panelName:"FarmingPanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"2px 12px",marginBottom:"6px",backgroundColor:"var(--color-bg-tertiary)",borderRadius:"8px"},children:[(0,d.jsx)("label",{style:{fontFamily:"var(--font-title-4-family)",fontSize:"var(--font-title-4-size)",cursor:"pointer"},children:P[10187]||"Plant with cursor"}),(0,d.jsx)("input",{type:"checkbox",checked:L,onChange:e=>{return t=e.target.checked,F(t),t||E(null),void hh({plantWithCursor:t},b,x);var t},style:{width:"18px",height:"18px",cursor:"pointer"}})]}),j?(0,d.jsx)("p",{children:P[98]}):(0,d.jsx)(d.Fragment,{children:_.map((e=>{var t;(0,Yd.gU)(e,R);const n=(0,Kc.Fp)(e,c,h,1),r=(o=e.requires,(0,Yd.rw)(o,b));var o;const a=e.isOffSeason,s=e.symbol||"";if(a)return(0,d.jsx)(Eh,{symbol:s,name:(0,Bc.Z)(e.type,P),details:"Off season",info:null,disabled:!0,onClick:()=>{}},e.type);const i=[1,2,3,4].map((t=>{var n,r,o;const a=e[`ingredient${t}`],s=e[`ingredient${t}qty`];if(!a||!s)return"";const i=(null===c||void 0===c||null===(n=c.find((e=>e.type===a)))||void 0===n?void 0:n.quantity)||0,l=(null===h||void 0===h||null===(r=h.find((e=>e.type===a)))||void 0===r?void 0:r.quantity)||0,d=i+l,u=d>=s?"green":"red",p=(null===(o=R.find((e=>e.type===a)))||void 0===o?void 0:o.symbol)||"";return`<span style="color: ${u}; display: block;">${p} ${(0,Bc.Z)(a,P)} ${s} / ${d}</span>`})).join(""),g=r?"green":"red",y=(e.requires?`<span style="color: ${g};">${P[460]}${(0,Bc.Z)(e.requires,P)}</span><br>`:"")+(e.growtime?`${P[458]}${mp(e.growtime)}<br>`:"")+`${P[461]}<div>${i}</div>`,v=`${P[820]}${R.filter((t=>t.source===e.type)).map((e=>`${e.symbol||""} ${(0,Bc.Z)(e.type,P)}`)).join(", ")||"None"}`,k=`plot-${e.type}`,A=O.has(k);let _="";return A&&(_+="cooldown "),"plant"===(null===I||void 0===I?void 0:I.type)&&(null===I||void 0===I||null===(t=I.item)||void 0===t?void 0:t.type)===e.type&&(_+="cursor-selected "),(0,d.jsx)(Eh,{symbol:s,name:(0,Bc.Z)(e.type,P),resourceType:e.type,className:_.trim(),style:A?{"--cooldown-duration":"0.45s"}:{},details:y,info:v,disabled:A||!n||!r,onClick:()=>{n&&r&&(L?(e=>{const t=R.find((t=>t.source===e.type)),n=(null===t||void 0===t?void 0:t.symbol)||e.symbol||"\ud83c\udf31",r=(null===t||void 0===t?void 0:t.filename)||e.filename||null;E({type:"plant",item:e,emoji:n,filename:r})})(e):(async e=>{const t=`plot-${e.type}`;if(O.has(t))return;B((e=>new Set(e).add(t)));const n=setTimeout((()=>{B((e=>{const n=new Set(e);return n.delete(t),n}))}),450);!0!==await(0,hp.handleFarmPlotPlacement)({selectedItem:e,TILE_SIZE:l,resources:m,setResources:f,currentPlayer:b,setCurrentPlayer:x,inventory:c,setInventory:u,backpack:h,setBackpack:p,gridId:w,masterResources:S,masterSkills:T,updateStatus:C})&&(clearTimeout(n),B((e=>{const n=new Set(e);return n.delete(t),n})))})(e))},devOnly:"devonly"===e.requires},e.type)}))})]})})},gp=t.memo(fp),yp={d:"\ud83d\udfeb",g:"\ud83d\udfe9",p:"\ud83d\udfe8",s:"\u2b1c\ufe0f",x:"\ud83e\udea8",w:"\ud83d\udca7",l:"\ud83d\udd25",n:"\ud83d\udfe8",o:"\u2744\ufe0f",z:"\ud83d\udfe2",c:"\ud83e\uddf1",y:"\u2b1b\ufe0f"},vp={d:310,g:311,p:312,s:312,x:313},bp=e=>{var n,o;let{onClose:i,TILE_SIZE:l,inventory:c,setInventory:u,backpack:h,setBackpack:p,resources:m,setResources:f,tiles:g,tileTypes:y,setTileTypes:v,currentPlayer:b,setCurrentPlayer:x,gridId:w,masterResources:S,masterSkills:T,masterXPLevels:C,updateStatus:k,isDeveloper:A,cursorMode:I,setCursorMode:E}=e;const P=(0,r.k)(),[_,N]=(0,t.useState)([]),[R,M]=(0,t.useState)([]),[j,D]=(0,t.useState)(!1),[O,B]=(0,t.useState)(new Set),[L,F]=(0,t.useState)(null!==(n=null===b||void 0===b||null===(o=b.settings)||void 0===o?void 0:o.plantWithCursor)&&void 0!==n&&n);(0,t.useEffect)((()=>{$()}),[]);const $=async()=>{try{const e=await a.A.get(`${s.A}/api/inventory/${b.playerId}`);u(e.data.inventory||[]);const t=(await a.A.get(`${s.A}/api/resources`)).data;M(t);const n=t.filter((e=>"farmplot"===e.category));N(n)}catch(e){console.error("Error fetching farming panel data:",e)}finally{D(!1)}},G=e=>{var t;return"devonly"===e||(!e||(null===(t=b.skills)||void 0===t?void 0:t.some((t=>t.type===e))))},z=ih(b,C),U=e=>!e||z>=e,H=e=>{let t="";return O.has(`terraform-${e}`)&&(t+="cooldown "),"terraform"===(null===I||void 0===I?void 0:I.type)&&(null===I||void 0===I?void 0:I.tileType)===e&&(t+="cursor-selected "),t.trim()},q=(e,t,n,r)=>{n&&"devonly"!==n&&!G(n)||r&&!U(r)||(L?((e,t)=>{E({type:"terraform",tileType:e,emoji:t})})(e,t):(async e=>{const t=`terraform-${e}`;O.has(t)||(B((e=>new Set(e).add(t))),setTimeout((()=>{B((e=>{const n=new Set(e);return n.delete(t),n}))}),500),await(0,hp.handleTerraform)({TILE_SIZE:l,tileType:e,gridId:w,currentPlayer:b,tileTypes:y,setTileTypes:v,isDeveloper:A}))})(e))};return(0,d.jsx)(Zc,{onClose:i,descriptionKey:"1033",titleKey:"1133",panelName:"ToolsPanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"2px 12px",marginBottom:"6px",backgroundColor:"var(--color-bg-tertiary)",borderRadius:"8px"},children:[(0,d.jsx)("label",{style:{fontFamily:"var(--font-title-4-family)",fontSize:"var(--font-title-4-size)",cursor:"pointer"},children:P[10187]||"Use with cursor"}),(0,d.jsx)("input",{type:"checkbox",checked:L,onChange:e=>{return t=e.target.checked,F(t),t||E(null),void hh({plantWithCursor:t},b,x);var t},style:{width:"18px",height:"18px",cursor:"pointer"}})]}),j?(0,d.jsx)("p",{children:P[98]}):(0,d.jsx)(d.Fragment,{children:null===S||void 0===S?void 0:S.filter((e=>"tile"===e.category)).map((e=>{const t=e.type,n=e.requires||null,r=e.level||null;if("devonly"===n&&!A)return null;const o=G(n),a=U(r),s=O.has(`terraform-${t}`),i=s||!o||!a,l=e.symbol||yp[t]||"\ud83d\udd32",c=e.action||t,u=c.charAt(0).toUpperCase()+c.slice(1),h=o?"green":"red";let p="";r&&(p+=`<span style="color: ${a?"green":"red"};">${P[10149]||"Level"} ${r}</span>`),n&&"devonly"!==n&&(p+=`<span style="color: ${h};">${P[460]}${(0,Bc.Z)(n,P)}</span>`),"devonly"===n&&(p+='<span style="color: orange;">Developer Only</span>'),p+=`${P[461]} None`;const m=vp[t],f=m?P[m]:`Creates a ${u.toLowerCase()} tile`;return(0,d.jsx)(Eh,{symbol:l,name:(0,Bc.Z)(u,P),className:H(t),style:s?{"--cooldown-duration":"0.5s"}:{},details:p,disabled:i,info:f,onClick:()=>q(t,l,n,r),devOnly:"devonly"===n},t)}))})]})})},xp=t.memo(bp);async function wp(e){let{currentPlayer:t,setInventory:n,setBackpack:r,setCurrentPlayer:o,setResources:i,stationType:c,currentStationPosition:d,gridId:u,TILE_SIZE:h,updateStatus:p,onClose:m,devOnly:f=!1}=e;if(f){if(!await l(null===t||void 0===t?void 0:t.username))return p("\u274c Developer access required."),{success:!1,error:"Developer access required"}}console.log(`\ud83d\udd12 [PROTECTED SELLING] Starting protected sale for ${c} at (${d.x}, ${d.y})`);const g=zc.default.getResources().filter((e=>{if(e.x===d.x&&e.y===d.y)return!0;const t=e.size||1;return t>1&&(d.x>=e.x&&d.x<e.x+t&&d.y<=e.y&&d.y>e.y-t)}));console.log(`\ud83d\udd0d Resources at/covering position (${d.x}, ${d.y}):`,g);const y=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,v=`sell-refund-${c}-${d.x}-${d.y}-${u}`;try{const e=await a.A.post(`${s.A}/api/sell-for-refund`,{playerId:t.playerId,gridId:u,stationX:d.x,stationY:d.y,stationType:c,transactionId:y,transactionKey:v});if(e.data.success){const{refundIngredients:t,totalMoneyRefund:r,inventory:a,removedStation:s}=e.data;a&&(n(a),o((e=>({...e,inventory:a}))));const l=zc.default.getResources().find((e=>e.x===d.x&&e.y===d.y));await(0,Gc.mQ)(u,{x:d.x,y:d.y,type:null},!0),console.log("\u2705 Removed main resource from database");const f=zc.default.getResources().filter((e=>{if(e.x===d.x&&e.y===d.y)return!1;if(l&&l.size&&l.size>1&&"shadow"===e.type){const t=l.anchorKey||`${l.type}-${l.x}-${l.y}`;if(e.parentAnchorKey===t)return!1}return!0}));zc.default.setResources(f),i(f),(0,Hc.MV)(d.x,d.y,h);const g=t&&t.length>0?t.map((e=>`${e.quantity} ${e.type}`)).join(", "):`${r} Money`;return console.log(`\u2705 Station ${c} sold successfully. Refund: ${g}`),p(`Sold ${c} for ${g}.`),m(),{success:!0,totalMoneyRefund:r}}}catch(A){var b,x,w,S;if(console.error("Error in protected station selling:",A),429===(null===(b=A.response)||void 0===b?void 0:b.status))p(471);else if(400===(null===(x=A.response)||void 0===x?void 0:x.status)){var T,C,k;console.error("\u274c 400 Error details:",null===(T=A.response)||void 0===T?void 0:T.data),p(`\u274c Cannot sell: ${(null===(C=A.response)||void 0===C||null===(k=C.data)||void 0===k?void 0:k.error)||"Invalid request"}`)}else p("\u274c Failed to sell station");return{success:!1,error:(null===(w=A.response)||void 0===w||null===(S=w.data)||void 0===S?void 0:S.error)||"Unknown error"}}}const Sp=e=>{let{onClose:n,inventory:o,setInventory:i,backpack:l,setBackpack:c,currentPlayer:u,setCurrentPlayer:h,stationType:p,stationCategory:m,currentStationPosition:f,gridId:g,isDeveloper:y,TILE_SIZE:v,updateStatus:b,masterSkills:x,setResources:w,masterResources:S,masterXPLevels:T}=e;const C=(0,r.k)(),[k,A]=(0,t.useState)(p||"Skills Panel"),[I,E]=(0,t.useState)([]),[P,_]=(0,t.useState)([]),[N,R]=(0,t.useState)([]),[M,j]=(0,t.useState)(""),[D,O]=(0,t.useState)(!1),[B,L]=(0,t.useState)("\ud83d\udcd8");(0,t.useEffect)((()=>{p?p!==k&&A(p):A("Basic Skills")}),[p]),(0,t.useEffect)((()=>{(async()=>{O(!0);try{console.log("Fetching skills and inventory for:",k);const[e,t,n]=await Promise.all([a.A.get(`${s.A}/api/inventory/${u.playerId}`),a.A.get(`${s.A}/api/skills/${u.playerId}`),a.A.get(`${s.A}/api/resources`)]),r=e.data.inventory||[],o=e.data.backpack||[],l=t.data.skills||[],d=n.data;i(r),c(o),E(d);const h=d.find((e=>e.type===p));L((null===h||void 0===h?void 0:h.symbol)||"\ud83d\udcaa");const f=l.filter((e=>d.some((t=>t.type===e.type&&"skill"===t.category))));R(f);const g="trainingAndShop"===m?["skill","special"]:["skill"],y=d.filter((e=>g.includes(e.category)&&e.source===k));_(y)}catch(e){console.error("Error fetching resources, inventory, or skills:",e)}finally{O(!1)}})()}),[k,null===u||void 0===u?void 0:u.playerId,m]);const F=ih(u,T),$=async e=>G(e.type,e),G=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=P.find((t=>t.type===e)),r=t||n,d="special"===n.category;if(d){const e=n.qtycollected||1;if(!(0,Kc.Pu)({resource:n.type,quantity:e,currentPlayer:u,inventory:o,backpack:l,masterResources:I,globalTuning:null})){var p;if("homestead"===(null===u||void 0===u||null===(p=u.location)||void 0===p?void 0:p.gtype))b(20);else{var m;const e=null===u||void 0===u||null===(m=u.skills)||void 0===m?void 0:m.some((e=>"Backpack"===e.type&&e.quantity>0));b(e?21:19)}return}}if(await(0,Kc.dw)({playerId:u.playerId,recipe:r,inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:b}))if(d){if(!await(0,Kc.qf)({playerId:u.playerId,currentPlayer:u,resource:n.type,quantity:n.qtycollected||1,inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:b,masterResources:I,globalTuning:null}))return void console.warn(`Failed to gain ${n.type}`);await(0,Uc.D)(u,"Buy",n.type,1,h),b(`${C[80]} ${(0,Bc.Z)(n.type,C)}.`),await(0,Kc.CP)(u.playerId,h)}else{const e=[...N];e.push({type:n.type,category:n.category,quantity:1}),R(e),b(`\ud83d\udcaa ${(0,Bc.Z)(n.type,C)} skill acquired.`);try{await a.A.post(`${s.A}/api/update-skills`,{playerId:u.playerId,skills:e}),await(0,Uc.D)(u,"Acquire",n.type,1,h),await(0,qc.p)(u.playerId,"Skill Builder",1,u,null,h),await(0,Kc.CP)(u.playerId,h),_((e=>e.filter((e=>e.type!==n.type))))}catch(f){console.error("Error updating player on server:",f),j("Error updating player on server.")}}else console.warn("Failed to spend ingredients.")},z=y&&"Basic Skills"!==k&&f&&g,U=I.find((e=>e.type===p)),H="training"===(null===U||void 0===U?void 0:U.category);return(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1005",title:`${B} ${k}`,panelName:"SkillsPanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[D?(0,d.jsx)("p",{children:C[98]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"skills-to-acquire",children:(0,d.jsx)("div",{className:"skills-options",children:P.map((e=>{const t=N.some((t=>t.type===e.type)),n=e.output?`+${e.qtycollected||1} to ${C[e.output]||e.output}`:null;let r="";const a=x[e.type];if(a&&"object"===typeof a){const e=Object.keys(a);if(e.length>0){r=`Collection multiplied: ${e.join(", ")}`}}const s=I.filter((t=>t.requires===e.type)).map((e=>`${e.symbol||""} ${(0,Bc.Z)(e.type,C)}`)).join(", ")||"None",i=(0,d.jsxs)("div",{className:"info-content",children:[n&&(0,d.jsx)("div",{children:n}),"None"!==s&&(0,d.jsxs)("div",{style:{display:"block",marginBottom:"3px"},children:[(0,d.jsx)("strong",{children:"Unlocks:"})," ",s]}),r&&(0,d.jsx)("div",{style:{color:"blue"},children:r})]});if(t)return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,C),className:"mini",info:i,disabled:!0,hideGem:!0},e.type);const c=(0,Kc.Fp)(e,o,l,1),h=!(p=e.requires)||N.some((e=>e.type===p));var p;const m=!(f=e.level)||F>=f;var f;const g=h&&m,y=[1,2,3,4].map((t=>{var n,r,a;const s=e[`ingredient${t}`],i=e[`ingredient${t}qty`];if(!s||!i)return"";const c=((null===o||void 0===o||null===(n=o.find((e=>e.type===s)))||void 0===n?void 0:n.quantity)||0)+((null===l||void 0===l||null===(r=l.find((e=>e.type===s)))||void 0===r?void 0:r.quantity)||0),d=c>=i?"green":"red",u=(null===(a=I.find((e=>e.type===s)))||void 0===a?void 0:a.symbol)||"";return`<span style="color: ${d}; display: block;">${u} ${(0,Bc.Z)(s,C)} ${i} / ${c}</span>`})).join(""),v=h?"green":"red",b=m?"green":"red",w=(e.level?`<span style="color: ${b};">${C[10149]||"Level"} ${e.level}</span>`:"")+(e.requires?`<span style="color: ${v};">${C[460]}${(0,Bc.Z)(e.requires,C)}</span>`:"")+`${C[461]}<div>${y}</div>`;return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,C),details:w,info:i,disabled:!c||!g,onClick:()=>G(e.type),onGemPurchase:!e.gemcost||c&&g?null:$,meetsLevelRequirement:m,resource:e,inventory:o,backpack:l,masterResources:S||I,currentPlayer:u,devOnly:"devonly"===e.requires},e.type)}))})}),(0,d.jsx)("h3",{children:C[10175]}),"Basic Skills"===k&&(0,d.jsxs)("div",{className:"skills-owned",children:[(0,d.jsx)("br",{}),(0,d.jsx)("h2",{children:C[1303]}),N.length>0?N.map((e=>{const t=I.find((t=>t.type===e.type));if(!t)return null;const n=t.output?`+${t.qtycollected||1} to ${C[t.output]||t.output}`:null;let r="";const o=x[t.type];if(o&&"object"===typeof o){const e=Object.keys(o);if(e.length>0){r=`Collection multiplied: ${e.join(", ")}`}}const a=I.filter((e=>e.requires===t.type)).map((e=>`${e.symbol||""} ${(0,Bc.Z)(e.type,C)}`)).join(", ")||"None",s=(0,d.jsxs)("div",{className:"info-content",children:[n&&(0,d.jsx)("div",{children:n}),"None"!==a&&(0,d.jsxs)("div",{style:{display:"block",marginBottom:"3px"},children:[(0,d.jsx)("strong",{children:"Unlocks:"})," ",a]}),r&&(0,d.jsx)("div",{style:{color:"blue"},children:r})]});return(0,d.jsx)(Eh,{symbol:t.symbol,name:(0,Bc.Z)(e.type,C),className:"mini",info:s,disabled:!0,hideGem:!0},e.type)})):(0,d.jsx)("p",{children:C[1305]})]}),z&&(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-danger",onAction:H?async()=>{try{var e;const t=zc.default.getResources().find((e=>e.x===f.x&&e.y===f.y));await(0,Gc.mQ)(g,{x:f.x,y:f.y,type:null},!0);const r=zc.default.getResources().filter((e=>{if(e.x===f.x&&e.y===f.y)return!1;if(t&&t.size&&t.size>1&&"shadow"===e.type){const n=t.anchorKey||`${t.type}-${t.x}-${t.y}`;if(e.parentAnchorKey===n)return!1}return!0}));zc.default.setResources(r),w(r),(0,Hc.MV)(f.x,f.y,v),b(`${(0,Bc.Z)(p,C)} ${(null===(e=C[438])||void 0===e?void 0:e.toLowerCase())||"removed"}.`),n()}catch(t){console.error("Error removing training building:",t),b("Failed to remove training building")}}:async()=>{try{await wp({currentPlayer:u,stationType:p,currentStationPosition:f,gridId:g,setResources:w,setInventory:i,setCurrentPlayer:h,updateStatus:b,onClose:n,devOnly:!0})&&n()}catch(e){console.error("Error selling station:",e),b("Failed to sell station")}},transactionKey:`${H?"remove":"sell-refund"}-${p}-${f.x}-${f.y}-${g}`,children:H?C[438]:C[490]})})]}),M&&(0,d.jsx)("p",{className:"error-message",children:M})]})})},Tp=t.memo(Sp),Cp=e=>{var t;if(!e||!e.grids)return console.warn("calculateSettlementPopulation: No settlement data or grids provided"),0;return((null===(t=e.grids)||void 0===t?void 0:t.flat())||[]).filter((e=>"homestead"===e.gridType&&!1===e.available)).length||0};const kp=function(e){var n;let{onClose:o,currentPlayer:i,setModalContent:l,setIsModalOpen:c}=e;const u=(0,r.k)(),[h,p]=(0,t.useState)(!1),[m,f]=(0,t.useState)(null),[g,y]=(0,t.useState)(""),[v,b]=(0,t.useState)(0),[x,w]=(0,t.useState)(0),[S,T]=(0,t.useState)([]),[C,k]=(0,t.useState)(""),A=zc.default.getResources()||[],I={School:0,Hospital:0,Library:0};return A.forEach((e=>{"School"===e.type&&I.School++,"Hospital"===e.type&&I.Hospital++,"Library"===e.type&&I.Library++})),(0,t.useEffect)((()=>{(async()=>{if(p(!0),i&&i.settlementId)try{console.log("\ud83c\udfdb\ufe0f Fetching full settlement data for ID:",i.settlementId);const e=(await a.A.get(`${s.A}/api/get-settlement/${i.settlementId}`)).data;f(e),T(e.taxlog||[]),b(e.taxrate||0);const t=Cp(e);w(t);const n=await sh(i.settlementId);k(n)}catch(e){console.error("\u274c Error fetching government data:",e)}finally{p(!1)}else console.warn("\u26a0\ufe0f currentPlayer or settlementId is not available yet.")})()}),[i]),(0,d.jsx)(Zc,{onClose:o,descriptionKey:"1007",titleKey:"1107",panelName:"GovPanel",children:(0,d.jsx)("div",{className:"standard-panel",children:h?(0,d.jsx)("p",{children:u[98]}):(0,d.jsxs)(d.Fragment,{children:[g&&(0,d.jsx)("p",{className:"error-message",children:g}),m&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:(0,d.jsx)("strong",{children:u[3001]})}),(0,d.jsx)("h2",{style:{color:"rgb(154, 106, 22)"},children:(0,d.jsx)("strong",{children:m.displayName||m.name||"Unnamed Settlement"})}),(0,d.jsxs)("h3",{children:[u[3002]," ",(0,d.jsx)("strong",{children:x})]})]}),(0,d.jsxs)("h3",{children:[u[3003]," ",v,"%"]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{if(null!==i&&void 0!==i&&i.settlementId){console.log("\ud83d\udce4 Requesting tax log for settlement ID:",i.settlementId);try{const e=await a.A.get(`${s.A}/api/settlement/${i.settlementId}/taxlog`);console.log("\ud83d\udce5 Tax log response:",e.data);const t=e.data.taxlog||[];console.log("\ud83d\udcca Parsed taxlog:",t);const n=(0,d.jsxs)("table",{className:"tax-log-table",style:{width:"100%",textAlign:"left",borderCollapse:"collapse"},children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{style:{padding:"6px 12px"},children:u[5102]}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:u[5103]}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:u[5104]}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:u[5105]})]})}),(0,d.jsx)("tbody",{children:[...t].reverse().map(((e,t)=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{style:{padding:"6px 12px"},children:new Date(e.date).toLocaleDateString()}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.totalcollected}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.currentmayor}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.mayortake})]},t)))})]});l({title:u[5100],size:"large",message:0===t.length?u[5101]:void 0,custom:n}),c(!0)}catch(e){console.error("\u274c Failed to fetch tax log:",e),l({title:"Error",message:"Failed to load tax log.",size:"small"}),c(!0)}}else console.warn("\u26a0\ufe0f Cannot show tax log: settlementId missing.")},children:u[3020]})}),(0,d.jsx)("p",{children:u[3004]}),(0,d.jsx)("h3",{children:u[2085]}),(0,d.jsx)("h2",{style:{color:"rgb(154, 106, 22)"},children:(0,d.jsx)("strong",{children:C||"Vacant"})}),(0,d.jsx)("p",{children:u[3005]}),(0,d.jsx)("p",{children:u[3009]}),(0,d.jsx)("p",{children:u[3010]}),(0,d.jsx)("p",{children:u[3011]}),(0,d.jsx)("p",{children:u[3012]}),(0,d.jsx)("p",{children:u[3013]}),"town"===(null===i||void 0===i||null===(n=i.location)||void 0===n?void 0:n.gtype)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:u[2090]}),(0,d.jsx)("p",{children:I.School>0?`${u[2092]}${I.School}`:u[2093]}),(0,d.jsx)("p",{children:I.Hospital>0?`${u[2094]}${I.Hospital}`:u[2095]}),(0,d.jsx)("p",{children:I.Library>0?`${u[2098]}${I.Library}`:u[2099]})]})]})})})};const Ap=function(e){let{inventory:t=[],backpack:n=[],masterResources:o=[],masterTraders:a=[],showTitle:s=!0,size:i="normal"}=e;const l=(0,r.k)(),c=null===a||void 0===a?void 0:a.find((e=>"Oracle"===e.trader)),u=[];if(c)for(let r=1;r<=7;r++){const e=`requires${r}`,t=`requires${r}qty`;c[e]&&u.push({name:c[e],qty:c[t]||1})}const h="small"===i?"14px":"20px",p="small"===i?"2px":"4px",m="small"===i?"8px":"16px";return(0,d.jsxs)(d.Fragment,{children:[s&&(0,d.jsx)("h2",{style:{textAlign:"center",marginBottom:"10px"},children:l[200801]}),(0,d.jsx)("div",{style:{display:"flex",justifyContent:"space-between",gap:p,marginBottom:m,width:"100%"},children:u.map(((e,r)=>{const a=((e,r)=>{const o=null===t||void 0===t?void 0:t.find((t=>(null===t||void 0===t?void 0:t.type)===e)),a=null===n||void 0===n?void 0:n.find((t=>(null===t||void 0===t?void 0:t.type)===e));return((null===o||void 0===o?void 0:o.qty)||(null===o||void 0===o?void 0:o.quantity)||0)+((null===a||void 0===a?void 0:a.qty)||(null===a||void 0===a?void 0:a.quantity)||0)>=r})(e.name,e.qty),s=(e=>{const t=null===o||void 0===o?void 0:o.find((t=>t.type===e));return(null===t||void 0===t?void 0:t.symbol)||"?"})(e.name);return(0,d.jsx)("div",{style:{flex:1,aspectRatio:"1",borderRadius:"4px",backgroundColor:a?"var(--color-btn-primary)":"rgb(154, 106, 22)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:h},children:a?s:""},r)}))})]})};const Ip=function(e){let{onClose:n,currentPlayer:o,setModalContent:i,setIsModalOpen:l,masterResources:c,masterTraders:u,masterXPLevels:h}=e;const p=(0,r.k)(),[m,f]=(0,t.useState)(!0),[g,y]=(0,t.useState)([]);return(0,t.useEffect)((()=>{(async()=>{if(o&&o.frontierId){f(!0);try{console.log("\ud83c\udfc6 Fetching leaderboard data for frontier:",o.frontierId);const e=await a.A.get(`${s.A}/api/players-by-frontier-with-dev-status/${o.frontierId}`),t=e.data.filter((e=>!e.isDeveloper)).sort(((e,t)=>(t.netWorth||0)-(e.netWorth||0))).slice(0,10);console.log("\ud83c\udfc6 Top 10 players summary:",t);const n=t.map((async e=>{try{const t=e.playerId||e._id||e.id;if(console.log(`\ud83c\udfc6 Fetching full data for ${e.username} using ID:`,t),!t)throw console.error(`\u274c No ID found for player ${e.username}:`,e),new Error("No player ID found");const n=(await a.A.get(`${s.A}/api/player/${t}`)).data;return console.log(`\ud83c\udfc6 Full data for ${e.username}:`,n),{username:n.username||e.username,icon:n.icon||"\ud83d\ude42",netWorth:e.netWorth||0,xp:n.xp||0,inventory:n.inventory||[],backpack:n.backpack||[]}}catch(t){return console.error(`\u274c Error fetching full data for player ${e.username}:`,t),{username:e.username,icon:"\ud83d\ude42",netWorth:e.netWorth||0,xp:0,inventory:[],backpack:[]}}})),r=await Promise.all(n);y(r),f(!1)}catch(e){console.error("\u274c Error fetching leaderboard data:",e),f(!1)}}else console.warn("\ufffd\x0f currentPlayer or frontierId is not available yet.")})()}),[o]),(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1040",titleKey:"1140",panelName:"LeaderboardPanel",children:m?(0,d.jsx)("p",{children:"Loading leaderboard..."}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h2",{className:"leaderboard-title",children:"Top players by net worth:"}),g.length>0?(0,d.jsx)("div",{className:"leaderboard-container",children:g.slice(0,10).map(((e,t)=>{const n=ih(e,h),r=lh(e,h),o=n-2,a=o>=0&&(null===h||void 0===h?void 0:h[o])||0,s=e.xp-a,i=r-a,l=i<=0?100:Math.min(100,Math.max(0,s/i*100));return(0,d.jsxs)("div",{className:"player-card",children:[(0,d.jsxs)("div",{className:"player-header",children:[(0,d.jsxs)("div",{className:"player-rank",children:["#",t+1]}),(0,d.jsxs)("div",{className:"player-info",children:[e.icon," ",(0,d.jsx)("strong",{children:e.username})]})]}),(0,d.jsxs)("div",{className:"player-networth",children:["\ud83d\udcb0 ",e.netWorth.toLocaleString()]}),(0,d.jsxs)("div",{className:"player-stats",children:[p[10150]," ",n]}),(0,d.jsxs)("div",{className:"player-stats",children:[p[10151]," ",e.xp," / ",r]}),(0,d.jsx)("div",{className:"xp-bar-container",children:(0,d.jsx)("div",{className:"xp-bar-fill",style:{width:`${l}%`}})}),(0,d.jsx)(Ap,{inventory:e.inventory,backpack:e.backpack,masterResources:c,masterTraders:u,showTitle:!1,size:"small"})]},t)}))}):(0,d.jsx)("p",{children:"No leaderboard data available."})]})})},Ep=e=>{let{currentPlayer:t,masterXPLevels:n,requiredLevel:o,children:a,featureName:s}=e;const i=(0,r.k)(),l=ih(t,n);return l>=o?(0,d.jsx)(d.Fragment,{children:a}):(0,d.jsxs)("div",{className:"level-lock-container",children:[(0,d.jsx)("div",{className:"level-lock-icon",children:"\ud83d\udd12"}),(0,d.jsx)("div",{className:"level-lock-message",children:(i[814]||"The {feature} unlocks at level {level}.").replace("{feature}",s||"feature").replace("{level}",o)}),(0,d.jsx)("div",{className:"level-lock-current",children:(i[815]||"Your current level: {level}").replace("{level}",l)})]})};const Pp=function(e){let{onClose:n,inventory:o,setInventory:i,backpack:l,setBackpack:c,currentPlayer:u,setCurrentPlayer:h,updateStatus:p,masterResources:m,masterXPLevels:f,globalTuning:g,setResources:y,currentStationPosition:v,gridId:b,TILE_SIZE:x,isDeveloper:w}=e;const S=(0,r.k)(),T=null===m||void 0===m?void 0:m.find((e=>"Bank"===e.type)),C=(null===T||void 0===T?void 0:T.level)||1,[k,A]=(0,t.useState)(!1),[I,E]=(0,t.useState)([]),[P,_]=(0,t.useState)(""),[N,R]=(0,t.useState)(""),[M,j]=(0,t.useState)(new Set),D=1500,O=async()=>{A(!0);try{var e,t;const n=await a.A.get(`${s.A}/api/get-frontier/${u.frontierId}`);E((null===(e=n.data.bank)||void 0===e?void 0:e.offers)||[]),R((null===(t=n.data.bank)||void 0===t?void 0:t.phase)||"")}catch(n){console.error("\u274c Error fetching bank offers:",n)}finally{A(!1)}};(0,t.useEffect)((()=>{const e=()=>{const e=Date.now(),t=(JSON.parse(localStorage.getItem("timers"))||{}).bank||{};t.phase!==N&&(console.log("\ud83c\udfe6 Bank phase changed, fetching new data..."),O()),_(pp(t.endTime,e))};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[N,null===u||void 0===u?void 0:u.frontierId]),(0,t.useEffect)((()=>{null!==u&&void 0!==u&&u.frontierId&&O()}),[null===u||void 0===u?void 0:u.frontierId]);const B=async(e,t)=>{M.has(t)||(console.log(`Starting cooldown for button ${t}, duration: 1500ms (1.5s)`),j((e=>new Set(e).add(t))),setTimeout((()=>{console.log(`Ending cooldown for button ${t}`),j((e=>{const n=new Set(e);return n.delete(t),n}))}),D),await(async e=>{if(!e||!u)return;if(!await(0,Kc.dw)({playerId:u.playerId,recipe:{ingredient1:e.itemBought,ingredient1qty:e.qtyBought},inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:p}))return;await(0,Kc.qf)({playerId:u.playerId,currentPlayer:u,resource:e.itemGiven,quantity:e.qtyGiven,inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:p,masterResources:m,globalTuning:g})&&(await(0,Uc.D)(u,"Sell",e.itemBought,e.qtyBought,h),p(`\u2705 Exchanged ${e.qtyBought} ${e.itemBought} for ${e.qtyGiven} ${e.itemGiven}.`))})(e))},L=e=>{const t=m.find((t=>t.type===e));return(null===t||void 0===t?void 0:t.symbol)||"\u2753"};return(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1017",titleKey:"1117",panelName:"BankPanel",children:(0,d.jsxs)(Ep,{currentPlayer:u,masterXPLevels:f,requiredLevel:C,featureName:"Bank",children:[(()=>{const e=String(u.location.s)===String(u.settlementId);return console.log("\ud83c\udfe6 Bank access check:",{currentSettlement:u.location.s,homeSettlement:u.settlementId,isInHomeSettlement:e}),!e})()?(0,d.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,d.jsx)("h2",{children:S[2050]||"This is not your home settlement. You cannot access banking services in any settlement but your own."})}):k?(0,d.jsx)("p",{children:S[98]}):(0,d.jsx)(d.Fragment,{children:"active"===N?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:S[1402]})," ",(0,d.jsx)("h2",{className:"countdown-timer",children:P}),I.length>0?I.map(((e,t)=>{var n,r;const a=((null===o||void 0===o||null===(n=o.find((t=>t.type===e.itemBought)))||void 0===n?void 0:n.quantity)||0)+((null===l||void 0===l||null===(r=l.find((t=>t.type===e.itemBought)))||void 0===r?void 0:r.quantity)||0);return(0,d.jsx)(Eh,{className:M.has(t)?"cooldown":"",style:M.has(t)?{"--cooldown-duration":"1.5s"}:{},onClick:()=>B(e,t),disabled:M.has(t)||!(0,Kc.Fp)({ingredient1:e.itemBought,ingredient1qty:e.qtyBought},o,l,1),hideInfo:!0,children:(0,d.jsxs)("div",{className:"resource-details",children:[(0,d.jsx)("span",{children:(0,d.jsx)("strong",{children:S[1403]})})," ",L(e.itemBought)," ",e.itemBought," x",e.qtyBought," / ",a,(0,d.jsx)("br",{}),S[1404]," ",L(e.itemGiven)," ",e.qtyGiven," "]})},t)})):(0,d.jsx)("p",{children:S[1405]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:S[1406]})," ",(0,d.jsx)("h3",{children:P}),(0,d.jsx)("p",{children:S[1407]})," "]})}),w&&(0,d.jsx)("div",{className:"station-panel-footer",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-danger",onAction:async(e,t)=>{await wp({currentPlayer:u,setInventory:i,setBackpack:c,setCurrentPlayer:h,setResources:y,stationType:"Bank",currentStationPosition:v,gridId:b,TILE_SIZE:x,updateStatus:p,onClose:n,devOnly:!0})},transactionKey:`sell-refund-Bank-${null===v||void 0===v?void 0:v.x}-${null===v||void 0===v?void 0:v.y}-${b}`,children:S[425]||"Sell for Refund"})})})]})})};function _p(e,t,n,r,o){var a,s;const i=((null===e||void 0===e?void 0:e.skills)||[]).map((e=>e.type)),l=ih(e,o);console.log("\ud83e\udd20 Kent offer generation:",{isFirstTimeUser:null===e||void 0===e?void 0:e.firsttimeuser,playerSkills:i,playerLevel:l});const c=t.filter((n=>{var o;if("doober"!==n.category)return!1;if("noBank"===n.output)return!1;if(n.requires&&!i.includes(n.requires))return!1;if(n.season&&n.season!==r)return!1;const a=[n.ingredient1,n.ingredient2,n.ingredient3,n.ingredient4].filter(Boolean);for(const e of a){const n=t.find((t=>t.type===e));if(n&&n.season&&n.season!==r)return!1}if(!0===(null===e||void 0===e?void 0:e.firsttimeuser)&&!(0,Yd.AQ)(n.type,t))return!1;if("epic"===n.scrollchance||"legendary"===n.scrollchance)return!1;if("valley"===n.source)return!1;const s=t.find((e=>e.type===n.source));if(console.log(`\ud83d\udd0d Checking ${n.type} (source: ${n.source}):`,{foundSourceResource:!!s,sourceType:null===s||void 0===s?void 0:s.type,sourceRequires:null===s||void 0===s?void 0:s.requires,playerSkills:i,hasRequiredSkill:null!==s&&void 0!==s&&s.requires?i.includes(s.requires):"N/A",shouldFilter:s&&s.requires&&!i.includes(s.requires)}),s&&s.requires&&!i.includes(s.requires))return console.log(`\u274c Filtering out ${n.type} - source ${n.source} requires ${s.requires} skill`),!1;if(!(null===e||void 0===e||null===(o=e.trophies)||void 0===o?void 0:o.some((e=>"Explore the Valley"===e.title)))){const e=t.find((e=>"attack"===e.action&&e.output===n.type));if(e)return console.log(`\u274c Filtering out ${n.type} - output of attack resource ${e.type}, player lacks "Explore the Valley" trophy`),!1}return!(n.level&&n.level>l)}));if(0===c.length)return console.warn("No eligible resources found for Kent offers"),[];const d=[],u=(null===n||void 0===n?void 0:n.maxKentOffers)||6,h=(null===e||void 0===e||null===(a=e.kentOffers)||void 0===a||null===(s=a.offers)||void 0===s?void 0:s.length)||0;let p=2;h+2>u&&(p=Math.max(0,u-h));const m=l<10,f=m?Math.ceil(p/2):0;let g=0;for(let v=0;v<p;v++){var y;const r=[...(null===e||void 0===e||null===(y=e.kentOffers)||void 0===y?void 0:y.offers)||[],...d],o={};r.forEach((e=>{o[e.item]=(o[e.item]||0)+1}));let a=c.filter((e=>(o[e.type]||0)<2));if(m){const e=p-v,n=f-g;if(n>0&&n>=e-(e-n)){const e=a.filter((e=>(0,Yd.AQ)(e.type,t)));e.length>0&&(a=e)}}if(0===a.length){console.log("\ud83e\udd20 No more unique resources available (all have 2+ offers)");break}const s=a[Math.floor(Math.random()*a.length)];let i;(0,Yd.AQ)(s.type,t)&&g++,i=(0,Yd.AQ)(s.type,t)?!0===(null===e||void 0===e?void 0:e.firsttimeuser)?Math.floor(9*Math.random())+4:Math.floor(37*Math.random())+4:Math.floor(10*Math.random())+1;const l=[{item:"Money",quantity:(s.maxprice||100)*i}],u=(null===n||void 0===n?void 0:n.harvestDropRate)||.1,h=Math.random();if(console.log(`\ud83e\udd20 Kent bonus reward check for ${s.type}:`),console.log(`   globalTuning.harvestDropRate: ${null===n||void 0===n?void 0:n.harvestDropRate}`),console.log(`   Resolved drop rate: ${u} (${(100*u).toFixed(1)}%)`),console.log(`   Roll: ${h.toFixed(3)}`),console.log("   Success: "+(h<=u?"YES":"NO")),h<=u){console.log("\ud83c\udf89 Kent bonus reward roll succeeded!");const e=t.filter((e=>"valley"===e.source&&e.scrollchance));if(console.log(`   Found ${e.length} valley resources with scrollchance:`),e.forEach((e=>{console.log(`     - ${e.type} (${e.scrollchance})`)})),e.length>0){const t=Jd(e,1);if(console.log(`   Selected valley resource: ${(null===t||void 0===t?void 0:t.type)||"NONE"}`),t){let e=1;switch(t.scrollchance){case"legendary":case"epic":e=1;break;case"rare":e=Math.floor(2*Math.random())+1;break;default:e=Math.floor(3*Math.random())+1}l.push({item:t.type,quantity:e}),console.log(`\ud83c\udf81 ADDED valley bonus reward: ${t.type} x${e} (${t.scrollchance})`)}else console.log("\u274c selectWeightedRandomItem returned null")}else console.log("\u274c No valley resources found with scrollchance")}else console.log(`\u274c Kent bonus reward roll failed: ${h.toFixed(3)} > ${u}`);const b={item:s.type,quantity:i,rewards:l};d.push(b)}return console.log(`Generated ${d.length} new Kent offers:`,d),d}const Np=function(e){var n;let{onClose:o,inventory:i,setInventory:l,backpack:c,setBackpack:u,currentPlayer:h,setCurrentPlayer:p,updateStatus:m,masterResources:f,globalTuning:g,currentSeason:y,masterXPLevels:v}=e;const b=(0,r.k)(),[x,w]=(0,t.useState)(!1),[S,T]=(0,t.useState)([]),[C,k]=(0,t.useState)(""),[A,I]=(0,t.useState)(""),[E,P]=(0,t.useState)(!1),_=async()=>{w(!0);try{const e=null===h||void 0===h?void 0:h.kentOffers;if(e&&e.offers&&0!==e.offers.length)T(e.offers||[]);else{console.log("\ud83d\udd04 No Kent offers found, generating fallback...");const e=await(async()=>{try{const e=f.find((e=>"Wheat"===e.type)),t={endTime:0,offers:[{item:"Wheat",quantity:4,rewards:[{item:"Money",quantity:4*((null===e||void 0===e?void 0:e.maxprice)||100)}]}]};if((await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{kentOffers:t}})).data.success)return console.log("\u2705 Generated fallback Kent offers:",t),p((e=>({...e,kentOffers:t}))),t}catch(e){console.error("\u274c Error generating fallback Kent offer:",e)}return{endTime:0,offers:[]}})();T(e.offers||[])}I("active")}catch(e){console.error("\u274c Error fetching Kent offers:",e)}finally{w(!1)}};(0,t.useEffect)((()=>{const e=()=>{const e=Date.now(),t=null===h||void 0===h?void 0:h.kentOffers,n=(null===t||void 0===t?void 0:t.endTime)||0;n>e?(k(pp(n,e)),I("locked")):(k(b[45]),I("active"))};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[null===h||void 0===h||null===(n=h.kentOffers)||void 0===n?void 0:n.endTime]),(0,t.useEffect)((()=>{null!==h&&void 0!==h&&h.playerId&&_()}),[null===h||void 0===h?void 0:h.playerId]);const N=async(e,t)=>{const n=(null===g||void 0===g?void 0:g.kentRefreshTimerSeconds)||5,r=Date.now()+1e3*n,o=function(e,t,n,r,o,a){const{kentOffers:s,removedIndex:i}=function(e,t){if(!e||!e.offers)return{kentOffers:e,removedIndex:-1};const n=e.offers.findIndex((e=>e.item===t.itemBought&&e.quantity===t.qtyBought)),r=e.offers.filter(((e,t)=>t!==n));return{kentOffers:{...e,offers:r},removedIndex:n}}(e.kentOffers,t),l=_p({...e,kentOffers:s},n,r,o,a),c=[...s.offers];return l.length>0&&i>=0?(c.splice(i,0,l[0]),l.length>1&&c.push(...l.slice(1))):l.length>0&&c.push(...l),{...s,offers:c}}(h,e,f,g,y,v);o.endTime=r;(await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{kentOffers:o}})).data.success&&(p((e=>({...e,kentOffers:o}))),T(o.offers||[])),m(t)},R=()=>{const e=Date.now(),t=null===h||void 0===h?void 0:h.kentOffers;return((null===t||void 0===t?void 0:t.endTime)||0)>e},M=e=>{const t=f.find((t=>t.type===e));return(null===t||void 0===t?void 0:t.symbol)||"\u2753"},j=e=>{const t=f.find((t=>t.type===e.item));return 2*((null===t||void 0===t?void 0:t.xp)||1)};return(0,d.jsx)(Zc,{onClose:o,titleKey:"1138",panelName:"KentPanel",children:x?(0,d.jsx)("p",{children:b[98]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"kent-header-area",children:"locked"===A?(0,d.jsxs)("h2",{children:[b[46]," ",(0,d.jsx)("span",{className:"countdown-timer",children:C})]}):(0,d.jsx)("h2",{className:"countdown-timer",children:C})}),(0,d.jsx)(d.Fragment,{children:S.length>0?(0,d.jsxs)(d.Fragment,{children:[S.map(((e,t)=>{var n,r,o,y;const v=((null===i||void 0===i||null===(n=i.find((t=>t.type===e.item)))||void 0===n?void 0:n.quantity)||0)+((null===c||void 0===c||null===(r=c.find((t=>t.type===e.item)))||void 0===r?void 0:r.quantity)||0),x={itemBought:e.item,qtyBought:e.quantity,itemGiven:(null===(o=e.rewards[0])||void 0===o?void 0:o.item)||"Money",qtyGiven:(null===(y=e.rewards[0])||void 0===y?void 0:y.quantity)||0},w="locked"===A||R();return(0,d.jsxs)("div",{className:"kent-offer-wrapper",children:[(0,d.jsx)(Eh,{className:"kent-offer-button "+(w?"disabled":""),onClick:()=>!w&&!E&&(async e=>{if(e&&h&&!E){if(R())return console.log("\ud83d\udeab Kent trade blocked: Timer still active"),void m("\u274c Kent is not available yet. Please wait for the timer to expire.");P(!0);try{if(!await(0,Kc.dw)({playerId:h.playerId,recipe:{ingredient1:e.itemBought,ingredient1qty:e.qtyBought},inventory:i,backpack:c,setInventory:l,setBackpack:u,setCurrentPlayer:p,updateStatus:m}))return;let n=!0;const r=S.find((t=>t.item===e.itemBought&&t.quantity===e.qtyBought));if(r&&r.rewards){for(const e of r.rewards)if(!await(0,Kc.qf)({playerId:h.playerId,currentPlayer:h,resource:e.item,quantity:e.quantity,inventory:i,backpack:c,setInventory:l,setBackpack:u,setCurrentPlayer:p,updateStatus:m,masterResources:f,globalTuning:g})){n=!1;break}}else n=await(0,Kc.qf)({playerId:h.playerId,currentPlayer:h,resource:e.itemGiven,quantity:e.qtyGiven,inventory:i,backpack:c,setInventory:l,setBackpack:u,setCurrentPlayer:p,updateStatus:m,masterResources:f,globalTuning:g});if(!n)return;const o=j(r);try{const e=await a.A.post(`${s.A}/api/addXP`,{playerId:h.playerId,xpAmount:o});e.data.success&&p((t=>({...t,xp:e.data.newXP})))}catch(t){console.error("\u274c Error awarding XP for Kent trade:",t)}const d=r&&r.rewards?r.rewards.map((e=>`${e.quantity} ${e.item}`)).join(", "):`${e.qtyGiven} ${e.itemGiven}`;await N(e,`\u2705 Exchanged ${e.qtyBought} ${e.itemBought} for ${d} and +${o} XP.`),await(0,Uc.D)(h,"Sell",e.itemBought,e.qtyBought,p),await(0,au.LQ)("SoldToKent",h.playerId,h,p)}catch(t){console.error("\u274c Error in Kent trade:",t),m("\u274c Trade failed. Please try again.")}finally{P(!1)}}})(x),disabled:w||E||!(0,Kc.Fp)({ingredient1:x.itemBought,ingredient1qty:x.qtyBought},i,c,1),hideInfo:!0,children:(0,d.jsx)("div",{className:"resource-details",children:(0,d.jsxs)("div",{className:"kent-offer-content",children:[(0,d.jsx)("div",{className:"kent-offer-symbol",children:M(x.itemBought)}),(0,d.jsxs)("div",{className:"kent-offer-details",children:[(0,d.jsx)("div",{className:"kent-offer-requirement",children:(0,d.jsxs)("span",{className:"kent-offer-item "+(v<x.qtyBought?"insufficient":"sufficient"),children:[(0,Bc.Z)(x.itemBought,b)," x",x.qtyBought," / ",v]})}),(0,d.jsxs)("div",{className:"kent-offer-reward",children:[b[42]," ",e.rewards.map(((t,n)=>`${M(t.item)} ${t.quantity.toLocaleString()}${n<e.rewards.length-1?", ":""}`)).join(""),", \ud83d\udd37 ",j(e)]})]})]})})}),(0,d.jsx)("div",{className:"kent-dismiss-button "+(w||E?"disabled":""),onClick:e=>{e.stopPropagation(),w||E||(async e=>{if(e&&h&&!E){if(R())return console.log("\ud83d\udeab Kent dismiss blocked: Timer still active"),void m("\u274c Kent is not available yet. Please wait for the timer to expire.");P(!0);try{await N(e,`\u274c Dismissed offer for ${e.itemBought}.`)}catch(t){console.error("\u274c Error dismissing Kent offer:",t),m("\u274c Failed to dismiss offer. Please try again.")}finally{P(!1)}}})(x)},children:"\xd7"})]},t)})),(0,d.jsx)("div",{className:"kent-dismiss-all-link "+("locked"===A||R()||E?"disabled":""),onClick:()=>{"locked"===A||R()||E||(async()=>{if(h&&!E&&0!==S.length){if(R())return console.log("\ud83d\udeab Kent dismiss all blocked: Timer still active"),void m("\u274c Kent is not available yet. Please wait for the timer to expire.");P(!0);try{const e=(null===g||void 0===g?void 0:g.kentRefreshTimerSeconds)||5,t=Date.now()+1e3*e,n={endTime:t,offers:_p({...h,kentOffers:{offers:[]}},f,g,y,v)};(await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{kentOffers:n}})).data.success&&(p((e=>({...e,kentOffers:n}))),T(n.offers||[])),m("\u274c Dismissed all offers.")}catch(e){console.error("\u274c Error dismissing all Kent offers:",e),m("\u274c Failed to dismiss offers. Please try again.")}finally{P(!1)}}})()},children:b[190]||"Dismiss all"})]}):(0,d.jsx)("p",{children:"No offers available from Kent."})})]})})};function Rp(e,t,n,r,o,a){var s;const i=[];console.log("\ud83d\ude82 Train reward generation for season:",o);const l=ih(t,a),c=o?o.toLowerCase():"spring";console.log("\ud83d\ude82 Looking for season key:",c);const d=null===r||void 0===r||null===(s=r.trainRewards)||void 0===s?void 0:s[c];if(console.log("\ud83d\ude82 Seasonal rewards found:",d),!d||!Array.isArray(d))return console.warn("\ud83d\ude82 No train rewards found for season:",c,"in globalTuning"),console.warn("\ud83d\ude82 Available keys:",Object.keys((null===r||void 0===r?void 0:r.trainRewards)||{})),i;console.log("\ud83d\ude82 Available seasonal rewards:",d);if(d.includes("XP")){const e=function(e){const t=Math.floor(e/5);let n=10*Math.pow(1.5,t);n=Math.min(n,200);const r=1+.15*(2*Math.random()-1),o=Math.round(n*r);return console.log(`\ud83d\ude82 XP calculation: level=${e}, intervals=${t}, scaledBase=${n.toFixed(1)}, finalXP=${o}`),o}(l);i.push({item:"XP",quantity:e}),console.log("\ud83d\ude82 XP reward (scaled by level):",e)}const u=d.filter((e=>"XP"!==e)),h=Math.floor(Math.random()*Math.min(3,u.length))+1,p=new Set;for(let m=0;m<h;m++){const e=u.filter((e=>!p.has(e)));if(0===e.length)break;const t=e[Math.floor(Math.random()*e.length)];let r;p.add(t),r=(0,Yd.AQ)(t,n)?Math.floor(10*Math.random())+1:Math.floor(3*Math.random())+1,i.push({item:t,quantity:r})}return console.log(`Generated ${i.length} train rewards:`,i),i}function Mp(e,t,n,r,o,a){console.log(`\ud83d\ude82 Generating complete train data for train #${o} in ${r}`);const s=function(e,t,n,r,o){const a=((null===e||void 0===e?void 0:e.skills)||[]).map((e=>e.type)),s=ih(e,o);console.log("\ud83d\ude82 Train offer generation:",{isFirstTimeUser:null===e||void 0===e?void 0:e.firsttimeuser,playerSkills:a,playerLevel:s});const i=t.filter((n=>{var o;if("doober"!==n.category)return!1;if("noBank"===n.output)return!1;if(!n.source)return!1;if(n.requires&&!a.includes(n.requires))return!1;if(n.season&&n.season!==r)return!1;const i=[n.ingredient1,n.ingredient2,n.ingredient3,n.ingredient4].filter(Boolean);for(const e of i){const n=t.find((t=>t.type===e));if(n&&n.season&&n.season!==r)return!1}if(!0===(null===e||void 0===e?void 0:e.firsttimeuser)&&!(0,Yd.AQ)(n.type,t))return!1;if("epic"===n.scrollchance||"legendary"===n.scrollchance)return!1;if("valley"===n.source)return!1;const l=t.find((e=>e.type===n.source));if(l&&l.requires&&!a.includes(l.requires))return!1;if(!(null===e||void 0===e||null===(o=e.trophies)||void 0===o?void 0:o.some((e=>"Explore the Valley"===e.title)))){const e=t.find((e=>"attack"===e.action&&e.output===n.type));if(e)return!1}return!(n.level&&n.level>s)}));if(0===i.length)return console.warn("No eligible resources found for Train offers"),[];const l=[],c=(null===n||void 0===n?void 0:n.maxTrainOffers)||8,d=Math.min(c,i.length);for(let u=0;u<d;u++){const n=l.map((e=>e.item)),r=i.filter((e=>!n.includes(e.type)));if(0===r.length){console.log("\ud83d\ude82 No more unique resources available for train offers");break}const o=r[Math.floor(Math.random()*r.length)];let a;a=(0,Yd.AQ)(o.type,t)?!0===(null===e||void 0===e?void 0:e.firsttimeuser)?Math.floor(16*Math.random())+5:Math.floor(46*Math.random())+5:Math.floor(15*Math.random())+2;const s={item:o.type,quantity:a};l.push(s)}return console.log(`Generated ${l.length} new Train offers:`,l),l}(e,t,n,r,a);return{offers:s,rewards:Rp(0,e,t,n,r,a)}}const jp=function(e){var n;let{onClose:o,inventory:i,setInventory:l,backpack:c,setBackpack:u,currentPlayer:h,setCurrentPlayer:p,updateStatus:m,masterResources:f,setModalContent:g,setIsModalOpen:y,globalTuning:v,currentSeason:b,masterXPLevels:x}=e;const w=(0,r.k)(),S=null===f||void 0===f?void 0:f.find((e=>"Train"===e.type)),T=(null===S||void 0===S?void 0:S.level)||1,[C,k]=(0,t.useState)("loading"),[A,I]=(0,t.useState)("\u23f3"),[E,P]=(0,t.useState)(!1),[_,N]=(0,t.useState)(0),[R,M]=(0,t.useState)(0),[j,D]=(0,t.useState)(""),[O,B]=(0,t.useState)([]),[L,F]=(0,t.useState)([]),[$,G]=(0,t.useState)([]),[z,U]=(0,t.useState)([]),[H,q]=(0,t.useState)(!1),[V,W]=(0,t.useState)("");(0,t.useEffect)((()=>{null!==h&&void 0!==h&&h.playerId&&null!==h&&void 0!==h&&h.settlementId&&Y()}),[null===h||void 0===h?void 0:h.playerId,null===h||void 0===h?void 0:h.settlementId]),(0,t.useEffect)((()=>{const e=()=>{const e=Date.now(),t=(JSON.parse(localStorage.getItem("timers"))||{}).train||{},n=t.phase;k(n||"unknown"),D(n||"unknown");const r=t.endTime;r&&!isNaN(r)?I(pp(r,e)):I("N/A")};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[]),(0,t.useEffect)((()=>{if(null===h||void 0===h||!h.playerId||!j)return;(async()=>{var e,t;const n=(null===h||void 0===h||null===(e=h.train)||void 0===e?void 0:e.currentTrainNumber)||0,r=(null===h||void 0===h||null===(t=h.train)||void 0===t?void 0:t.lastRewardDeliveryTrainNumber)||0;n===R&&("departing"===j||"arriving"===j)&&n>r&&(console.log("\ud83d\ude82 [Reactive] Train phase changed to departing/arriving - checking for reward delivery"),await Z(n))})()}),[j,null===h||void 0===h||null===(n=h.train)||void 0===n?void 0:n.currentTrainNumber,R]),(0,t.useEffect)((()=>{"loading"===C&&V&&W("")}),[C,V]);const Y=async()=>{P(!0);try{var e,t;console.log("\ud83d\ude82 Initializing personalized train data...");const n=await a.A.get(`${s.A}/api/get-settlement/${h.settlementId}`),r=((null===(e=n.data)||void 0===e?void 0:e.trainlog)||[]).find((e=>"Current Train"===e.status)),o=(null===r||void 0===r?void 0:r.trainnumber)||1;M(o),console.log("\ud83d\ude82 Settlement train number:",o);const i=(null===h||void 0===h||null===(t=h.train)||void 0===t?void 0:t.currentTrainNumber)||0;N(i),console.log("\ud83d\ude82 Player train number:",i),await K(i,o,j)}catch(n){console.error("\u274c Error initializing train data:",n)}finally{P(!1)}},K=async(e,t,n)=>{var r,o;console.log("\ud83d\ude82 Determining train data to show:",{playerTrainNum:e,settlementTrainNum:t,settlementPhase:n,lastRewardDelivery:(null===h||void 0===h||null===(r=h.train)||void 0===r?void 0:r.lastRewardDeliveryTrainNumber)||0});const a=e<t;e===t&&("departing"===n||"arriving"===n)&&e>((null===h||void 0===h||null===(o=h.train)||void 0===o?void 0:o.lastRewardDeliveryTrainNumber)||0)?(console.log("\ud83d\ude82 Train is departing/arriving - checking for reward delivery"),await Z(e),await X()):a?(console.log("\ud83d\ude82 Player is behind, advancing to current train"),await J(t)):e===t?(console.log("\ud83d\ude82 Player is on current train"),await X()):(console.log("\ud83d\ude82 Player is ahead of settlement train - this should not happen"),await X())},X=async()=>{var e,t,n,r;const o=(null===h||void 0===h||null===(e=h.train)||void 0===e?void 0:e.currentTrainOffers)||[],a=(null===h||void 0===h||null===(t=h.train)||void 0===t?void 0:t.currentTrainRewards)||[],s=(null===h||void 0===h||null===(n=h.train)||void 0===n?void 0:n.nextTrainOffers)||[],i=(null===h||void 0===h||null===(r=h.train)||void 0===r?void 0:r.nextTrainRewards)||[];0===o.length?(console.log("\ud83d\ude82 Generating new current train data"),await Q(R)):(console.log("\ud83d\ude82 Using existing current train data"),B(o),F(a),G(s),U(i))},Z=async e=>{var t,n;const r=(null===h||void 0===h||null===(t=h.train)||void 0===t?void 0:t.currentTrainOffers)||[],o=(null===h||void 0===h||null===(n=h.train)||void 0===n?void 0:n.currentTrainRewards)||[];if(r.length>0){if(r.every((e=>!0===e.completed))&&o.length>0){console.log("\ud83d\ude82 All current train offers completed! Delivering rewards to mailbox:",o);Date.now();const t={messageId:101,timestamp:new Date,rewards:o.map((e=>({item:e.item,qty:e.quantity}))),read:!1,collected:!1,neverPurge:!1};try{const n=[...(null===h||void 0===h?void 0:h.messages)||[],t],r={...h.train,lastRewardDeliveryTrainNumber:e};if((await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{messages:n,train:r}})).data.success){p((e=>({...e,messages:n,train:r})));const e=o.map((e=>`${ee(e.item)} ${e.quantity} ${e.item}`)).join(", ");m(`\ud83d\ude82 Train rewards delivered to your mailbox: ${e}`),W(w[2016]||"Train rewards have been delivered to your mailbox!"),console.log("\u2705 Current train rewards successfully delivered to mailbox")}}catch(i){console.error("\u274c Error delivering current train rewards to mailbox:",i)}}else{const t=r.filter((e=>!0===e.completed)).length;console.log(`\ud83d\ude82 Train departing with ${t}/${r.length} offers completed`);try{const t={...h.train,lastRewardDeliveryTrainNumber:e};(await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{train:t}})).data.success&&p((e=>({...e,train:t})))}catch(i){console.error("\u274c Error updating lastRewardDeliveryTrainNumber:",i)}}}},J=async e=>{var t,n;console.log("\ud83d\ude82 Advancing player to train",e),await(async()=>{var e,t;const n=(null===h||void 0===h||null===(e=h.train)||void 0===e?void 0:e.currentTrainOffers)||[],r=(null===h||void 0===h||null===(t=h.train)||void 0===t?void 0:t.currentTrainRewards)||[];if(n.length>0)if(n.every((e=>!0===e.completed))&&r.length>0){console.log("\ud83d\ude82 All train offers completed! Delivering rewards to mailbox:",r),Date.now();const e={messageId:101,timestamp:new Date,rewards:r.map((e=>({item:e.item,qty:e.quantity}))),read:!1,collected:!1,neverPurge:!1};try{const t=[...(null===h||void 0===h?void 0:h.messages)||[],e];if((await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{messages:t}})).data.success){p((e=>({...e,messages:t})));const e=r.map((e=>`${ee(e.item)} ${e.quantity} ${e.item}`)).join(", ");m(`\ud83d\ude82 Train rewards delivered to your mailbox: ${e}`),W(w[2016]||"Train rewards have been delivered to your mailbox!"),console.log("\u2705 Train rewards successfully delivered to mailbox")}}catch(o){console.error("\u274c Error delivering train rewards to mailbox:",o)}}else if(n.length>0){const e=n.filter((e=>!0===e.completed)).length;console.log(`\ud83d\ude82 Train expired with ${e}/${n.length} offers completed`),m(`\ud83d\ude82 Previous train left with ${e}/${n.length} orders completed`)}})();const r=(null===h||void 0===h||null===(t=h.train)||void 0===t?void 0:t.nextTrainOffers)||[],o=(null===h||void 0===h||null===(n=h.train)||void 0===n?void 0:n.nextTrainRewards)||[];let i=[],l=[];if(r.length>0)i=r,l=o,console.log("\ud83d\ude82 Using existing next train data as current");else{console.log("\ud83d\ude82 Generating new current train data");const t=Mp(h,f,v,b,e,x);i=t.offers,l=t.rewards}const c=Mp(h,f,v,b,e+1,x),d={currentTrainNumber:e,currentTrainOffers:i,currentTrainRewards:l,nextTrainOffers:c.offers,nextTrainRewards:c.rewards};try{(await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{train:d}})).data.success&&(p((e=>({...e,train:d}))),N(e),B(i),F(l),G(c.offers),U(c.rewards),console.log("\u2705 Player advanced to train",e))}catch(u){console.error("\u274c Error advancing player train:",u)}},Q=async e=>{const t=Mp(h,f,v,b,e,x),n=Mp(h,f,v,b,e+1,x),r={currentTrainNumber:e,currentTrainOffers:t.offers,currentTrainRewards:t.rewards,nextTrainOffers:n.offers,nextTrainRewards:n.rewards};try{(await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{train:r}})).data.success&&(p((e=>({...e,train:r}))),B(t.offers),F(t.rewards),G(n.offers),U(n.rewards),console.log("\u2705 Generated and saved new train data"))}catch(o){console.error("\u274c Error saving train data:",o)}},ee=e=>{var t;return(null===(t=f.find((t=>t.type===e)))||void 0===t?void 0:t.symbol)||"\u2753"},te=()=>{const e=Date.now(),t=(JSON.parse(localStorage.getItem("timers"))||{}).train||{},n=t.endTime,r=t.phase;return!!("loading"===r&&n&&e>=n)||("departing"===r||"arriving"===r)};return(0,d.jsx)(Zc,{onClose:o,descriptionKey:"1022",titleKey:"1122",panelName:"NewTrainPanel",children:(0,d.jsx)(Ep,{currentPlayer:h,masterXPLevels:x,requiredLevel:T,featureName:"Train",children:String(h.location.s)!==String(h.settlementId)?(0,d.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,d.jsx)("h2",{children:w[2050]||"This is not your home settlement."})}):E?(0,d.jsx)("p",{children:w[98]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("h3",{children:["Train is ",C," (#",_,")"]}),(0,d.jsxs)("h2",{className:"countdown-timer",children:["\u23f3 ",A]}),V&&("departing"===C||"arriving"===C)&&(0,d.jsxs)("div",{style:{backgroundColor:"var(--color-success)",color:"var(--color-text-white)",padding:"10px",margin:"10px 0",borderRadius:"5px",textAlign:"center",fontWeight:"bold"},children:["\u2705 ",V]}),"loading"===C&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"reward-section",children:[(0,d.jsx)("h4",{children:w[2019]}),L.length>0?(0,d.jsx)("div",{className:"train-rewards-container",children:L.map(((e,t)=>(0,d.jsxs)("div",{className:"train-reward-item",children:[ee(e.item)," ",e.quantity," ",e.item]},t)))}):(0,d.jsx)("p",{children:"No rewards available"})]}),0===O.length?null:(0,d.jsxs)("div",{className:"offer-section",children:[(0,d.jsx)("h4",{children:"Your Train Orders"}),O.map(((e,t)=>{var n,r;const o=e.completed||!1,g=((null===i||void 0===i||null===(n=i.find((t=>t.type===e.item)))||void 0===n?void 0:n.quantity)||0)+((null===c||void 0===c||null===(r=c.find((t=>t.type===e.item)))||void 0===r?void 0:r.quantity)||0),y=te(),b=g>=e.quantity&&!o&&!y,x=f.find((t=>t.type===e.item)),S=((null===x||void 0===x?void 0:x.maxprice)||100)*e.quantity;let T,C,k;if(o)T=`<span style="color: green;">${ee(e.item)} ${e.item} ${e.quantity}</span>`,C=`<div>${T}</div>Completed`,k="";else if(y)T=`<span style="color: gray;">${ee(e.item)} ${e.item} ${e.quantity} / ${g}</span>`,C=`<div>${T}</div>Train Departed`,k="";else{T=`<span style="color: ${b?"green":"red"};">${ee(e.item)} ${e.item} ${e.quantity} / ${g}</span>`;const t=`${ee("Money")} ${S.toLocaleString()}`;C=`<div>${T}</div>${w[42]} ${t}`,k=""}return(0,d.jsxs)("div",{style:{position:"relative"},children:[(0,d.jsx)(Eh,{className:"train-offer-card "+(o?"completed":""),onClick:()=>H||!b||o?null:(async e=>{if(e&&h&&!H)if(te())m("\u274c Train has already departed! Cannot fulfill orders.");else{q(!0);try{if(!await(0,Kc.dw)({playerId:h.playerId,recipe:{type:e.item,ingredient1:e.item,ingredient1qty:e.quantity},inventory:i,backpack:c,setInventory:l,setBackpack:u,setCurrentPlayer:p,updateStatus:m}))return;const t=f.find((t=>t.type===e.item)),n=((null===t||void 0===t?void 0:t.maxprice)||100)*e.quantity;await(0,Kc.qf)({playerId:h.playerId,currentPlayer:h,resource:"Money",quantity:n,inventory:i,backpack:c,setInventory:l,setBackpack:u,setCurrentPlayer:p,updateStatus:m,masterResources:f,globalTuning:v});const r=O.map((t=>t.item!==e.item||t.quantity!==e.quantity||t.completed?t:{...t,completed:!0})),o={...h.train,currentTrainOffers:r};(await a.A.post(`${s.A}/api/update-profile`,{playerId:h.playerId,updates:{train:o}})).data.success&&(p((e=>({...e,train:o}))),B(r),m(`\u2705 Delivered ${e.quantity} ${e.item} for ${ee("Money")} ${n.toLocaleString()}.`))}catch(t){console.error("\u274c Error fulfilling train offer:",t),m("\u274c Trade failed. Please try again.")}finally{q(!1)}}})(e),disabled:o||!b||H,details:C,children:k}),o&&(0,d.jsx)("div",{style:{position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",fontSize:"2em",color:"green",pointerEvents:"none",zIndex:10},children:"\u2705"})]},t)}))]})]}),("loading"===C||"departing"===C)&&(0===$.length?null:(0,d.jsxs)("div",{className:"next-shipment-preview",children:[(0,d.jsx)("h4",{children:w[2003]}),(0,d.jsxs)("div",{className:"next-shipment-container",children:[(0,d.jsx)("div",{style:{marginBottom:"10px"},children:(0,d.jsx)("strong",{children:"Orders:"})}),$.map(((e,t)=>(0,d.jsxs)("div",{className:"next-shipment-item",children:[ee(e.item)," ",e.item]},t)))]})]}))]})})})};const Dp=function(e){let{onClose:n,inventory:o,setInventory:i,backpack:l,setBackpack:c,currentPlayer:u,setCurrentPlayer:h,updateStatus:p,masterResources:m,masterXPLevels:f,setModalContent:g,setIsModalOpen:y,globalTuning:v}=e;const b=(0,r.k)(),x=null===m||void 0===m?void 0:m.find((e=>"Carnival"===e.type)),w=(null===x||void 0===x?void 0:x.level)||1,[S,T]=(0,t.useState)([]),[C,k]=(0,t.useState)("here"),[A,I]=(0,t.useState)("\u23f3"),[E,P]=(0,t.useState)([]),[_,N]=(0,t.useState)([]),[R,M]=(0,t.useState)([]),[j,D]=(0,t.useState)({}),[O,B]=(0,t.useState)(!1),[L,F]=(0,t.useState)(null);(0,t.useEffect)((()=>{(async()=>{if(null!==u&&void 0!==u&&u.playerId){B(!0);try{const e=await a.A.get(`${s.A}/api/inventory/${u.playerId}`);M(e.data.inventory||[])}catch(e){console.error("\u274c Error fetching latest inventory:",e)}finally{B(!1)}}})(),null!==u&&void 0!==u&&u.settlementId&&$()}),[null===u||void 0===u?void 0:u.playerId,null===u||void 0===u?void 0:u.settlementId]),(0,t.useEffect)((()=>{null!==u&&void 0!==u&&u.settlementId&&$()}),[C]),(0,t.useEffect)((()=>{const e=()=>{const e=Date.now(),t=(JSON.parse(localStorage.getItem("timers"))||{}).carnival||{},n=t.phase;k(n||"unknown");const r=t.endTime;r&&!isNaN(r)?I(pp(r,e)):I("N/A")};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[]);const $=async()=>{try{var e,t,n,r,o,i;const l=await a.A.get(`${s.A}/api/get-settlement/${u.settlementId}`),c=(null===(e=l.data)||void 0===e||null===(t=e.carnival)||void 0===t?void 0:t.currentoffers)||[];T(c),P((null===(n=l.data)||void 0===n||null===(r=n.carnival)||void 0===r?void 0:r.nextoffers)||[]);const d=((null===(o=l.data)||void 0===o||null===(i=o.carnival)||void 0===i?void 0:i.carnivallog)||[]).find((e=>"Current Carnival"===e.status));d?(N(d.rewards||[]),d.carnivalnumber&&F(d.carnivalnumber)):N([]),await G(c)}catch(l){console.error("\u274c Error fetching carnival offers:",l)}},G=async e=>{try{const t=[...new Set(e.filter((e=>e.claimedBy)).map((e=>e.claimedBy)))];if(0===t.length)return;const n=t.map((async e=>{try{return{playerId:e,username:(await a.A.get(`${s.A}/api/player/${e}`)).data.username}}catch(t){return console.error(`\u274c Error fetching username for player ${e}:`,t),{playerId:e,username:"Unknown"}}})),r=(await Promise.all(n)).reduce(((e,t)=>{let{playerId:n,username:r}=t;return e[n]=r,e}),{});D((e=>({...e,...r})))}catch(t){console.error("\u274c Error fetching usernames:",t)}},[z,U]=(0,t.useState)(!1),[H,q]=(0,t.useState)({logic:"",carnivalNumber:null}),V=async()=>{if(g&&y)if(null!==u&&void 0!==u&&u.settlementId)try{const e=(await a.A.get(`${s.A}/api/settlement/${u.settlementId}/carnivallog`)).data.carnivallog||[],t=(0,d.jsxs)("table",{className:"carnival-log-table",style:{width:"100%",textAlign:"left",borderCollapse:"collapse"},children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Carnival #"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Date"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Status"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Offers Filled"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Total Winners"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Reward Summary"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Logic"})]})}),(0,d.jsx)("tbody",{children:[...e].reverse().map(((e,t)=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.carnivalnumber||"-"}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:new Date(e.date).toLocaleDateString()}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.status||""}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:"Next Carnival"===e.status||"Current Carnival"===e.status?"n/a":e.alloffersfilled?"\u2705":"\u274c"}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:"Next Carnival"===e.status||"Current Carnival"===e.status?"n/a":e.totalwinners}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:(()=>{const t={};return(e.rewards||[]).forEach((e=>{t[e.item]?t[e.item]+=e.qty:t[e.item]=e.qty})),Object.entries(t).map((e=>{let[t,n]=e;return`${n} ${t}`})).join(", ")})()}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.logic?(0,d.jsx)("button",{onClick:()=>{return t=e.logic,n=e.carnivalnumber,q({logic:t,carnivalNumber:n}),void U(!0);var t,n},className:"carnival-logic-button",children:"Logic"}):"-"})]},t)))})]});g({title:"Carnival Log",size:"large",message:0===e.length?"No recent carnival activity.":void 0,custom:t}),y(!0)}catch(e){console.error("\u274c Failed to fetch carnival log:",e),g({title:"Error",message:"Failed to load carnival log.",size:"small"}),y(!0)}else console.warn("\u26a0\ufe0f Cannot show carnival log: settlementId missing.");else console.warn("Modal context functions not available.")},W=e=>{var t;return(null===(t=m.find((t=>t.type===e)))||void 0===t?void 0:t.symbol)||"\u2753"},Y=(e,t)=>t.length?(0,d.jsxs)("div",{className:"offer-section",children:[(0,d.jsx)("h4",{children:e}),t.map(((e,t)=>{var n;const r=e.claimedBy===u.playerId,f=e.filled,g=(null===R||void 0===R?void 0:R.some((t=>t.type===e.itemBought&&t.quantity>=e.qtyBought)))||!1,y=(null===R||void 0===R||null===(n=R.find((t=>t.type===e.itemBought)))||void 0===n?void 0:n.quantity)||0,x=`<span style="color: ${y>=e.qtyBought?"green":"red"};">${W(e.itemBought)} ${e.itemBought} ${e.qtyBought} / ${y}</span>`,w=`${W(e.itemGiven)} ${e.qtyGiven.toLocaleString()}`,C=`<div>${x}</div><br>${b[42]}: ${w}`;let k="";if(f){k=j[e.claimedBy]||"Unknown"}else if(r&&g)k=b[2005];else if(r)k=b[2006];else if(e.claimedBy){const t=j[e.claimedBy]||"Unknown";k=`${b[2007]} (${t})`}else k=b[2008];return(0,d.jsx)(Eh,{name:f||e.claimedBy?j[e.claimedBy]||"Unknown":"",className:"carnival-offer-card "+(e.claimedBy?"resource-button":"unclaimed"),onClick:()=>f?null:r?(async e=>{if(!e||e.claimedBy!==u.playerId)return;if(await(0,Kc.dw)({playerId:u.playerId,recipe:{type:e.itemBought,ingredient1:e.itemBought,ingredient1qty:e.qtyBought},inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:p}))try{await a.A.post(`${s.A}/api/update-carnival-offer/${u.settlementId}`,{updateOffer:{...e,filled:!0}}),await(0,Kc.qf)({playerId:u.playerId,currentPlayer:u,resource:"Money",quantity:e.qtyGiven,inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:p,masterResources:m,globalTuning:v}),T((t=>{const n=t.findIndex((t=>t.itemBought===e.itemBought&&t.qtyBought===e.qtyBought&&t.claimedBy===u.playerId&&!t.filled));if(-1===n)return t;const r=[...t];return r[n]={...r[n],filled:!0},r})),p(`\u2705 Delivered ${e.qtyBought} ${e.itemBought}.`)}catch(t){console.error("\u274c Error fulfilling offer:",t),$()}})(e):e.claimedBy?null:(async e=>{if(!e||e.claimedBy)return;if(S.some((e=>e.claimedBy===u.playerId&&!e.filled)))p(2014);else try{const t=S.findIndex((t=>t.itemBought===e.itemBought&&t.qtyBought===e.qtyBought&&!t.claimedBy&&!t.filled));if(-1===t)return void console.warn("\u26a0\ufe0f No matching unclaimed offer found to claim.");const n={...S[t],claimedBy:u.playerId};200===(await a.A.post(`${s.A}/api/update-carnival-offer/${u.settlementId}`,{updateOffer:n})).status&&(T((e=>{const r=[...e];return r[t]=n,r})),D((e=>({...e,[u.playerId]:u.username}))))}catch(n){var t;console.error("\u274c Error claiming carnival offer:",n),409===(null===(t=n.response)||void 0===t?void 0:t.status)?(p(2017),$()):p(505)}})(e),disabled:f||!r&&e.claimedBy||r&&!g,details:C,children:(0,d.jsx)("strong",{children:f||e.claimedBy?!f&&e.claimedBy?b[2007]:"":k})},t)}))]}):null,K=S.filter((e=>e.claimedBy===u.playerId&&!e.filled)),X=S.filter((e=>!e.claimedBy)),Z=S.filter((e=>e.claimedBy&&e.claimedBy!==u.playerId&&!e.filled)),J=S.filter((e=>e.filled)),Q=("departing"===C||"arriving"===C)&&(S.length>0&&S.every((e=>e.filled)));return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1037",titleKey:"1137",panelName:"CarnivalPanel",children:(0,d.jsx)(Ep,{currentPlayer:u,masterXPLevels:f,requiredLevel:w,featureName:"Carnival",children:(()=>{const e=String(u.location.s)===String(u.settlementId);return console.log("\ud83c\udfa1 Carnival access check:",{currentSettlement:u.location.s,homeSettlement:u.settlementId,isInHomeSettlement:e}),!e})()?(0,d.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,d.jsx)("h2",{children:b[1352]||"This is not your home settlement."})}):O?(0,d.jsx)("p",{children:b[98]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("h3",{children:[b[1352]," ",C," ",L?`(#${L})`:""]}),(0,d.jsxs)("h2",{className:"countdown-timer",children:["\u23f3 ",A]}),"here"===C&&(0,d.jsxs)(d.Fragment,{children:[(()=>{if(!_.length||"here"!==C)return null;const e={};return _.forEach((t=>{e[t.item]?e[t.item]+=t.qty:e[t.item]=t.qty})),(0,d.jsxs)("div",{className:"reward-section",children:[(0,d.jsx)("h4",{children:b[2004]}),(0,d.jsx)("div",{className:"carnival-rewards-container",children:Object.entries(e).map(((e,t)=>{let[n,r]=e;return(0,d.jsxs)("div",{className:"carnival-reward-item",children:[W(n)," ",r," ",n]},t)}))})]})})(),Y(b[2009],K),Y(b[2010],X),Y(b[2011],Z),Y(b[2012],J)]}),Q&&(0,d.jsx)("div",{className:"carnival-rewards-banner",children:b[2016]}),("here"===C||"departing"===C)&&(()=>{if(!["here","departing"].includes(C))return null;if(!E.length)return null;const e=new Set,t=E.filter((t=>!e.has(t.itemBought)&&(e.add(t.itemBought),!0)));return(0,d.jsxs)("div",{className:"next-shipment-preview",children:[(0,d.jsx)("h4",{children:b[2018]}),(0,d.jsx)("div",{className:"next-shipment-container",children:t.map(((e,t)=>(0,d.jsxs)("div",{className:"next-shipment-item",children:[W(e.itemBought)," ",e.itemBought]},t)))})]})})(),(0,d.jsx)("div",{className:"shared-buttons",style:{margin:"2px 0"},children:(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:()=>V(),children:b[1351]})})]})})}),z&&(0,d.jsx)("div",{className:"carnival-logic-modal-overlay",children:(0,d.jsxs)("div",{className:"carnival-logic-modal",children:[(0,d.jsx)("button",{onClick:()=>U(!1),className:"carnival-logic-modal-close",children:"\xd7"}),(0,d.jsxs)("h3",{children:["Carnival #",H.carnivalNumber||"?"," Logic"]}),(0,d.jsx)("pre",{children:H.logic||"No logic information available"})]})})]})},Op=e=>{let{onClose:n,currentPlayer:o,setCurrentPlayer:i,inventory:l,setInventory:c,backpack:u,setBackpack:h,setResources:p,currentStationPosition:m,gridId:f,TILE_SIZE:g,isDeveloper:y,masterResources:v,masterSkills:b,masterXPLevels:x,updateStatus:w}=e;const S=(0,r.k)(),T=null===v||void 0===v?void 0:v.find((e=>"Courthouse"===e.type)),C=(null===T||void 0===T?void 0:T.level)||1,[k,A]=(0,t.useState)(null),[I,E]=(0,t.useState)(0),[P,_]=(0,t.useState)(!1),[N,R]=(0,t.useState)(""),[M,j]=(0,t.useState)(""),{updateStatus:D}=(0,t.useContext)(vu),O=w||D,[B,L]=(0,t.useState)([]),[F,$]=(0,t.useState)(""),[G,z]=(0,t.useState)(null),[U,H]=(0,t.useState)(!1),[q,V]=(0,t.useState)(""),[W,Y]=(0,t.useState)([]),[K,X]=(0,t.useState)(0),[Z,J]=(0,t.useState)(null),[Q,ee]=(0,t.useState)({x:0,y:0}),[te,ne]=(0,t.useState)(""),[re,oe]=(0,t.useState)(!1),[ae,se]=(0,t.useState)(null),[ie,le]=(0,t.useState)(""),[ce,de]=(0,t.useState)(0),[ue,he]=(0,t.useState)([]),[pe,me]=(0,t.useState)([]),[fe,ge]=(0,t.useState)(!1);(0,t.useEffect)((()=>{ye()}),[o.settlementId]),(0,t.useEffect)((()=>{const e=()=>{const e=Date.now(),t=(JSON.parse(localStorage.getItem("timers"))||{}).elections||{},n=t.phase||"Administration";n!==N&&(console.log("\ud83d\uddf3\ufe0f Election phase changing to:",n),R(n));const r=t.endTime;r&&!isNaN(r)?j(pp(r,e)):j("N/A")};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[]),(0,t.useEffect)((()=>{console.log("\ud83d\uddf3\ufe0f Phase changed to:",N),"Counting"===N&&(L([]),Y([])),ye()}),[N]),(0,t.useEffect)((()=>{(async()=>{if(v&&o){ge(!0);try{const e=await a.A.get(`${s.A}/api/skills/${o.playerId}`),t=(e.data.skills||[]).filter((e=>v.some((t=>t.type===e.type&&"skill"===t.category))));me(t);const n=v.filter((e=>"skill"===e.category&&"Courthouse"===e.source&&!t.some((t=>t.type===e.type))));he(n)}catch(e){console.error("Error fetching skills:",e)}finally{ge(!1)}}})()}),[v,null===o||void 0===o?void 0:o.playerId]);const ye=async()=>{try{const n=(await a.A.get(`${s.A}/api/get-settlement/${o.settlementId}`)).data;A(n),E(n.taxrate||0),X(n.taxrate||0),L(n.campaignPromises||[]),ne(n.displayName||"");const r=n.roles.find((e=>"Mayor"===e.roleName));_(r&&r.playerId.toString()===o._id.toString());const i=await sh(o.settlementId);le(i);const l=Cp(n);if(de(l),H(!1),V(""),n.votes){const t=n.votes.find((e=>String(e.voterId)===String(o._id)));if(t){var e;H(!0);const r=null===(e=n.campaignPromises)||void 0===e?void 0:e.find((e=>String(e.playerId)===String(t.candidateId)));V((null===r||void 0===r?void 0:r.username)||"Unknown")}}if("Voting"===N&&!U){var t;const e=(null===(t=n.campaignPromises)||void 0===t?void 0:t.reduce(((e,t)=>(e.find((e=>e.playerId===t.playerId))||e.push({playerId:t.playerId,username:t.username}),e)),[]))||[];Y(e)}}catch(n){console.error("\u274c Error fetching election data:",n)}},ve=e=>!e||pe.some((t=>t.type===e)),be=e=>{var t;return(null===(t=B.find((t=>t.playerId===e)))||void 0===t?void 0:t.text)||"No campaign promise made."};return console.log("hasVoted:",U),console.log("electionPhase:",N),(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1012",titleKey:"1112",panelName:"Courthouse",children:(0,d.jsxs)(Ep,{currentPlayer:o,masterXPLevels:x,requiredLevel:C,featureName:"Courthouse",children:[(0,d.jsxs)("div",{className:"panel-content courthouse-panel",children:[(()=>{const e=String(o.location.s)===String(o.settlementId);return console.log("\ud83c\udfdb\ufe0f Courthouse access check:",{currentSettlement:o.location.s,homeSettlement:o.settlementId,isInHomeSettlement:e}),!e})()?(0,d.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,d.jsx)("h3",{children:S[2050]||"This is not your home settlement."})}):(0,d.jsxs)(d.Fragment,{children:[ue.length>0&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"skills-options",children:fe?(0,d.jsx)("p",{children:S[98]||"Loading..."}):ue.map((e=>{const t=(0,Kc.Fp)(e,l,u,1),n=ve(e.requires),r=[1,2,3,4].map((t=>{var n,r,o;const a=e[`ingredient${t}`],s=e[`ingredient${t}qty`];if(!a||!s)return"";const i=((null===l||void 0===l||null===(n=l.find((e=>e.type===a)))||void 0===n?void 0:n.quantity)||0)+((null===u||void 0===u||null===(r=u.find((e=>e.type===a)))||void 0===r?void 0:r.quantity)||0),c=i>=s?"green":"red",d=(null===(o=v.find((e=>e.type===a)))||void 0===o?void 0:o.symbol)||"";return`<span style="color: ${c}; display: block;">${d} ${(0,Bc.Z)(a,S)} ${s} / ${i}</span>`})).join(""),p=n?"green":"red",m=(e.requires?`<span style="color: ${p};">${S[460]||"Requires:"} ${(0,Bc.Z)(e.requires,S)}</span><br>`:"")+`${S[461]||"Cost:"}<div>${r}</div>`,f=e.output?`+${e.qtycollected||1} to ${S[e.output]||e.output}`:null;let g="";const y=null===b||void 0===b?void 0:b[e.type];if(y&&"object"===typeof y){const e=Object.keys(y);if(e.length>0){g=`Collection multiplied: ${e.join(", ")}`}}const x=v.filter((t=>t.requires===e.type)).map((e=>`${e.symbol||""} ${(0,Bc.Z)(e.type,S)}`)).join(", ")||"None",w=(0,d.jsxs)("div",{className:"info-content",children:[f&&(0,d.jsx)("div",{children:f}),"None"!==x&&(0,d.jsxs)("div",{style:{display:"block",marginBottom:"3px"},children:[(0,d.jsx)("strong",{children:"Unlocks:"})," ",x]}),g&&(0,d.jsx)("div",{style:{color:"blue"},children:g})]});return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,S),details:m,info:w,disabled:!t||!n,onClick:()=>(async e=>{const t=v.find((t=>t.type===e));if(!t)return;if(t.requires&&!ve(t.requires))return void O(S[465]||"You need the required skill first.");if(!await(0,Kc.dw)({playerId:o.playerId,recipe:t,inventory:l,backpack:u,setInventory:c,setBackpack:h,setCurrentPlayer:i,updateStatus:O}))return void console.warn("Failed to spend ingredients.");const n=[...pe];n.push({type:t.type,category:t.category,quantity:1}),me(n),O(`\ud83d\udcaa ${(0,Bc.Z)(t.type,S)} skill acquired.`);try{await a.A.post(`${s.A}/api/update-skills`,{playerId:o.playerId,skills:n}),await(0,Uc.D)(o,"Acquire",t.type,1,i),await(0,qc.p)(o.playerId,"Skill Builder",1,o,null,i),await(0,Kc.CP)(o.playerId,i),he((e=>e.filter((e=>e.type!==t.type))))}catch(r){console.error("Error updating player on server:",r),O("Error updating player on server.")}})(e.type),resource:e,inventory:l,backpack:u,masterResources:v,currentPlayer:o},e.type)}))}),(0,d.jsx)("hr",{className:"inventory-divider"})]}),P&&(0,d.jsx)("h2",{children:S[2080]}),(0,d.jsxs)("div",{className:"debug-buttons",children:[(0,d.jsx)("h3",{children:S[2082]}),P?(0,d.jsxs)("div",{className:"settlement-name-editor",children:[(0,d.jsx)("input",{type:"text",value:te,onChange:e=>ne(e.target.value),placeholder:S[2081]}),(0,d.jsx)("div",{className:"shared-buttons",style:{display:"inline-block",marginLeft:"8px"},children:(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal-small",onClick:async()=>{if(P&&te.trim())try{(await a.A.post(`${s.A}/api/update-settlement`,{settlementId:o.settlementId,updates:{displayName:te}})).data.success?(O(`Settlement renamed to ${te}`),A((e=>({...e,displayName:te})))):O("\u274c Error updating settlement name.")}catch(e){console.error("\u274c Error saving settlement name:",e),O("\u274c Failed to save settlement name.")}},disabled:!te.trim(),style:{width:"auto"},children:S[2083]})})]}):(0,d.jsx)("h2",{style:{color:"rgb(154, 106, 22)"},children:(0,d.jsx)("strong",{children:(null===k||void 0===k?void 0:k.displayName)||"Unnamed"})}),(0,d.jsxs)("h3",{children:[S[3002]," ",(0,d.jsx)("strong",{children:ce})]}),(0,d.jsxs)("h3",{children:[S[2041]," ",I,"%"]}),P&&(0,d.jsxs)("div",{className:"tax-rate-editor",children:[(0,d.jsx)("input",{type:"range",min:"0",max:"20",value:K,onChange:e=>X(Number(e.target.value))}),(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"8px"},children:[(0,d.jsxs)("span",{style:{flex:1},children:[S[2042]," ",K,"%"]}),(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal-small",onClick:async()=>{if(P)try{console.log(`\ud83d\udcbe Saving new tax rate: ${K}%`);const e=await a.A.post(`${s.A}/api/update-settlement`,{settlementId:o.settlementId,updates:{taxrate:K}});e.data.success?(console.log("\u2705 Tax rate updated successfully."),O(`\ud83d\udcb0 Tax rate set to ${K}%`),E(K)):(console.error("\u274c Failed to update tax rate:",e.data.error),O("\u274c Error updating tax rate."))}catch(e){console.error("\u274c Error saving tax rate:",e),O("\u274c Failed to save tax rate.")}},style:{width:"auto",maxWidth:"100px",flexShrink:0},children:S[2043]})]})]}),(0,d.jsx)("br",{}),!P&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:S[2085]}),(0,d.jsx)("h2",{style:{color:"rgb(154, 106, 22)"},children:(0,d.jsx)("strong",{children:ie||"Vacant"})})]}),!P&&(0,d.jsx)("h2",{children:S[2079]}),(0,d.jsx)("p",{children:S[2084]}),(0,d.jsx)("br",{}),(0,d.jsx)("h3",{children:S[2045]}),(0,d.jsxs)("h3",{children:[(0,d.jsxs)("strong",{children:["Counting"===N&&S[2062],"Voting"===N&&S[2061],"Campaigning"===N&&S[2060],"Administration"===N&&S[2063]]})," ","  "," ",M]}),(0,d.jsx)("br",{}),"Campaigning"===N&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:S[2048]}),(0,d.jsx)("div",{className:"campaign-promises",children:B.length>0?B.map(((e,t)=>(0,d.jsxs)("div",{className:"campaign-entry",children:[(0,d.jsxs)("strong",{children:[e.username,":"]})," ",e.text]},t))):(0,d.jsx)("p",{children:S[2071]})}),!B.some((e=>e.playerId===o._id))&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("textarea",{value:F,onChange:e=>$(e.target.value),placeholder:S[2072]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{if(F.trim())if(F.length>200)O("Campaign promises cannot exceed 200 characters.");else try{const e=await a.A.post(`${s.A}/api/save-campaign-promise`,{settlementId:o.settlementId,playerId:o._id,username:o.username,text:F});e.data.message&&(console.log(`\ud83d\udce2 ${e.data.message}`),O("\ud83c\udfdb\ufe0f Campaign promise submitted."),L(e.data.campaignPromises),$(""))}catch(e){console.error("\u274c Error submitting campaign promise:",e),O("\u274c Failed to submit campaign promise.")}},children:S[2073]})})]})]}),"Voting"===N&&(0,d.jsxs)("div",{className:"voting-section",children:[U?(0,d.jsx)("p",{children:S[2077]}):W.length>0?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:S[2074]}),W.map(((e,t)=>(0,d.jsxs)("div",{className:"candidate-row",onMouseEnter:t=>{J(e.playerId),ee({x:t.clientX+10,y:t.clientY-40})},onMouseLeave:()=>J(null),children:[(0,d.jsx)("input",{type:"radio",name:"vote",value:e.playerId,onChange:()=>{z(e.playerId)}}),(0,d.jsxs)("div",{style:{marginLeft:"10px"},children:[(0,d.jsx)("strong",{children:e.username}),(0,d.jsxs)("div",{style:{fontSize:"0.9em",color:"#666",marginTop:"4px"},children:['"',be(e.playerId),'"']})]})]},e.playerId||t))),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{if(G)try{const e=await a.A.post(`${s.A}/api/cast-vote`,{settlementId:o.settlementId,voterId:o._id,candidateId:G});if(e.data.message){console.log(`\ud83d\uddf3\ufe0f ${e.data.message}`),O("\ud83c\udfdb\ufe0f Vote successfully cast."),H(!0);const t=W.find((e=>e.playerId===G));V((null===t||void 0===t?void 0:t.username)||"Unknown"),await(0,Uc.D)(o,"Vote","Election",1),ye()}}catch(e){console.error("\u274c Error casting vote:",e),"Already voted."===e.response.data.error?O("\u274c You already voted."):O("\u274c Failed to cast vote.")}},disabled:!G,children:S[2074]})}),Z&&(0,d.jsxs)("div",{className:"candidate-tooltip",style:{left:Q.x,top:Q.y},children:[(0,d.jsx)("strong",{children:S[2076]}),(0,d.jsx)("br",{}),'"',be(Z),'"']})]}):(0,d.jsx)("p",{children:S[2078]}),0===W.length&&(0,d.jsx)("p",{children:(0,d.jsx)("em",{children:"No one ran for mayor this election cycle."})})]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{if(null!==o&&void 0!==o&&o.settlementId){console.log("\ud83d\uddf3\ufe0f Show Election Log clicked"),console.log("\ud83d\udce4 Fetching election log for settlement:",o.settlementId);try{const e=await a.A.get(`${s.A}/api/settlement/${o.settlementId}/electionlog`);console.log("\ud83d\udce5 Election log API response:",e.data);const t=e.data.electionlog||[],n=(0,d.jsxs)("table",{className:"election-log-table",style:{width:"100%",textAlign:"left",borderCollapse:"collapse"},children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Date"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Candidates"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Elected Mayor"})]})}),(0,d.jsx)("tbody",{children:[...t].reverse().map(((e,t)=>{var n;return(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{style:{padding:"6px 12px"},children:new Date(e.date).toLocaleDateString()}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:(null===(n=e.candidates)||void 0===n?void 0:n.length)>0?e.candidates.map(((e,t)=>(0,d.jsxs)("div",{children:[e.username,": ",e.votes," votes"]},t))):(0,d.jsx)("em",{children:"No candidates"})}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.electedmayor||"None"})]},t)}))})]});se({title:"Recent Election Results",size:"large",message:0===t.length?"No election results recorded yet.":void 0,custom:n}),oe(!0)}catch(e){console.error("\u274c Failed to fetch election log:",e),se({title:"Error",message:"Failed to load election log.",size:"small"}),oe(!0)}}else console.warn("\u26a0\ufe0f Cannot show election log: settlementId missing.")},children:"Recent Election Results"})})]})]}),y&&(0,d.jsx)("div",{className:"station-panel-footer",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-danger",onAction:async(e,t)=>{await wp({currentPlayer:o,setInventory:c,setBackpack:h,setCurrentPlayer:i,setResources:p,stationType:"Courthouse",currentStationPosition:m,gridId:f,TILE_SIZE:g,updateStatus:O,onClose:n,devOnly:!0})},transactionKey:`sell-refund-Courthouse-${null===m||void 0===m?void 0:m.x}-${null===m||void 0===m?void 0:m.y}-${f}`,children:S[425]||"Sell for Refund"})})})]}),re&&(0,d.jsx)(Ou,{isOpen:re,onClose:()=>oe(!1),title:null===ae||void 0===ae?void 0:ae.title,size:null===ae||void 0===ae?void 0:ae.size,message:null===ae||void 0===ae?void 0:ae.message,custom:null===ae||void 0===ae?void 0:ae.custom})]})})};function Bp(e){if(e<=0)return 0;const t=e/6e4;return Math.ceil(Math.pow(t,.45))}const Lp=e=>{var n,o,i,l;let{onClose:c,inventory:u,setInventory:h,backpack:p,setBackpack:m,currentPlayer:f,setCurrentPlayer:g,resources:y,setResources:v,stationType:b,currentStationPosition:x,gridId:w,masterResources:S,masterSkills:T,TILE_SIZE:C,isDeveloper:k,currentSeason:A,globalTuning:I}=e;const E="homestead"===(null===f||void 0===f||null===(n=f.location)||void 0===n?void 0:n.gtype),P=(0,r.k)(),[_,N]=(0,t.useState)([]),[R,M]=(0,t.useState)([]),[j,D]=(0,t.useState)(""),[O,B]=(0,t.useState)("\ud83d\uded6"),{updateStatus:L}=(0,t.useContext)(vu),[F,$]=(0,t.useState)(null),[G,z]=(0,t.useState)(!1),[U,H]=(0,t.useState)(null),[q,V]=(0,t.useState)(null),[W,Y]=(0,t.useState)(!1),[K,X]=(0,t.useState)(!1),[Z,J]=(0,t.useState)(0),[Q,ee]=(0,t.useState)(0),[te,ne]=(0,t.useState)(!1);(0,t.useEffect)((()=>{if(!b||!x)return;console.log("\ud83d\udd04 [CRAFTING USEEFFECT] Checking for active crafting timers...",{stationRefreshKey:Q,resourcesLength:null===y||void 0===y?void 0:y.length,currentStationPosition:x});const e=null===y||void 0===y?void 0:y.find((e=>e.x===x.x&&e.y===x.y));if(console.log("\ud83d\udd04 [CRAFTING USEEFFECT] Found station:",{station:e?{x:e.x,y:e.y,craftEnd:e.craftEnd,craftedItem:e.craftedItem}:null}),e&&e.craftEnd){console.log("\ud83d\udd04 [CRAFTING USEEFFECT] Station has craftEnd, setting up timer"),H(e.craftedItem),Y(!0),z(!0);const t=()=>{const t=Math.max(0,Math.floor((e.craftEnd-Date.now())/1e3));V(t),0===t&&(console.log("\u2705 Crafting complete! Ready to collect."),Y(!1),X(!0))};t();const n=setInterval(t,1e3);return()=>clearInterval(n)}console.log("\ud83d\udd04 [CRAFTING USEEFFECT] No craftEnd found, resetting state"),H(null),Y(!1),X(!1),V(null),z(!1)}),[b,x,y,Q]),(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];h(e);const t=(await a.A.get(`${s.A}/api/inventory/${f.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(h(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[f]),(0,t.useEffect)((()=>{try{let e=S.filter((e=>e.source===b&&(!e.season||!A||e.season===A)));const t=Fc.Ay.getNPCsInGrid(w);if(t){const n=Object.values(t).filter((e=>e&&e.type)).map((e=>e.type));e=e.filter((e=>!1!==e.repeatable||!n.includes(e.type)||(console.log(`Filtering out non-repeatable ${e.type} - already exists on grid`),!1)))}N(e);const n=S.find((e=>e.type===b));B((null===n||void 0===n?void 0:n.symbol)||"\ud83d\uded6"),$(n),M(S||[])}catch(e){console.error("Error processing masterResources:",e)}}),[b,S,w,Z]),(0,t.useEffect)((()=>{const e=setInterval((()=>{J((e=>e+1))}),2e3);return()=>clearInterval(e)}),[]),(0,t.useEffect)((()=>{f&&(async()=>{var e,t;let n=!1;if("town"===(null===f||void 0===f||null===(e=f.location)||void 0===e?void 0:e.gtype)&&null!==f&&void 0!==f&&null!==(t=f.location)&&void 0!==t&&t.s)try{n=await sh(f.location.s)===f.username}catch(r){console.error("Error checking mayor status:",r)}ne(n)})()}),[null===f||void 0===f||null===(o=f.location)||void 0===o?void 0:o.s,null===f||void 0===f?void 0:f.username]);const re=async(e,t,n)=>{if(console.log(`\ud83d\udd12 [PROTECTED CRAFTING] Starting protected craft for ${n.type}`),console.log("Current station state:",{craftedItem:U,isCrafting:W,isReadyToCollect:K,craftingCountdown:q}),D(""),n)try{const r=await a.A.post(`${s.A}/api/crafting/start-craft`,{playerId:f.playerId,gridId:w,stationX:x.x,stationY:x.y,recipe:n,transactionId:e,transactionKey:t});if(r.data.success){const{craftEnd:e,craftedItem:t,inventory:o,backpack:a}=r.data;o&&(h(o),g((e=>({...e,inventory:o})))),a&&(m(a),g((e=>({...e,backpack:a})))),console.log("\ud83d\udd04 [CRAFT START] Updating resources with new craftEnd:",e,"craftedItem:",t);const s=zc.default.getResources().map((n=>n.x===x.x&&n.y===x.y?{...n,craftEnd:e,craftedItem:t}:n)),i=s.find((e=>e.x===x.x&&e.y===x.y));console.log("\ud83d\udd04 [CRAFT START] Updated station:",{craftEnd:null===i||void 0===i?void 0:i.craftEnd,craftedItem:null===i||void 0===i?void 0:i.craftedItem}),zc.default.setResources(s),v(s),console.log("\ud83d\udd04 [CRAFT START] Setting UI state - isCrafting: true, activeTimer: true"),H(t),V(Math.max(0,Math.floor((e-Date.now())/1e3))),z(!0),Y(!0),X(!1),await(0,Kc.CP)(f.playerId,g),Lc.A.addFloatingText(404,x.x,x.y,C),L(`${P[440]} ${(0,Bc.Z)(n.type,P)}`),console.log(`\u2705 ${n.type} crafting started using protected endpoint.`)}}catch(i){var r,o;console.error("Error in protected crafting start:",i),429===(null===(r=i.response)||void 0===r?void 0:r.status)?L(451):400===(null===(o=i.response)||void 0===o?void 0:o.status)?L(450):L(452)}else D("Invalid recipe selected.")},oe=async e=>{var t,n,r,o;if(!W||!q)return void console.error("\u274c No active crafting to speed up");const a=Bp(1e3*q);if(((null===(t=f.inventory)||void 0===t||null===(n=t.find((e=>"Gem"===e.type)))||void 0===n?void 0:n.quantity)||0)+((null===(r=f.backpack)||void 0===r||null===(o=r.find((e=>"Gem"===e.type)))||void 0===o?void 0:o.quantity)||0)<a)L(`Need ${a} gems to speed up crafting`);else try{if(!await(0,Kc.dw)({playerId:f.playerId,recipe:{ingredient1:"Gem",ingredient1qty:a},inventory:u,backpack:p,setInventory:h,setBackpack:m,setCurrentPlayer:g,updateStatus:L}))return void console.error("\u274c Failed to spend gems for speedup");const e=await(0,Gc.mQ)(w,{type:b,x:x.x,y:x.y,craftEnd:Date.now(),craftedItem:U},!0);if(null===e||void 0===e||!e.success)throw new Error("Failed to update crafting station in database");{const e=zc.default.getResources().map((e=>e.x===x.x&&e.y===x.y?{...e,craftEnd:Date.now(),craftedItem:U}:e));zc.default.setResources(e),v(e),V(0),Y(!1),X(!0),L(`Used ${a} gems to complete crafting instantly`),Lc.A.addFloatingText(`-${a} \ud83d\udc8e`,x.x,x.y,C),console.log(`\u2705 Crafting completed instantly using ${a} gems`)}}catch(s){console.error("\u274c Error in gem speedup:",s),L("\u274c Failed to speed up crafting")}},ae=async e=>{console.log("\ud83d\udd0d [GEM DEBUG] handleGemPurchase called with:",e);if(!await(0,Kc.dw)({playerId:f.playerId,recipe:e,inventory:u,backpack:p,setInventory:h,setBackpack:m,setCurrentPlayer:g,updateStatus:L}))return void console.warn("Failed to spend ingredients for gem purchase.");console.log("\ud83d\udd0d [GEM DEBUG] Ingredients spent successfully");if(R.find((t=>t.type===e.type))){const t=await(0,Kc.qf)({playerId:f.playerId,currentPlayer:f,resource:e.type,quantity:1,inventory:f.inventory,backpack:f.backpack,setInventory:h,setBackpack:m,setCurrentPlayer:g,updateStatus:L,masterResources:S,globalTuning:I});!0===t||t&&!0===t.success?(await(0,Uc.D)(f,"Craft",e.type,1,g),L(`\ud83d\udc8e ${(0,Bc.Z)(e.type,P)} crafted instantly!`),Lc.A.addFloatingText(`+1 ${(0,Bc.Z)(e.type,P)}`,x.x,x.y,C),await(0,Kc.CP)(f.playerId,g)):L("\u274c Failed to add crafted item to inventory")}else L("Gem purchase not supported for this item type")},se=(()=>{const e=Object.entries(T||{}).filter((e=>{let[t,n]=e;return n&&"object"===typeof n&&n[b]>1})).map((e=>{var t;let[n,r]=e;return{skillName:n,multiplier:r[b],hasSkill:null===(t=f.skills)||void 0===t?void 0:t.some((e=>e.type===n))}}));if(0===e.length)return null;const t=e.filter((e=>e.hasSkill)),n=e.filter((e=>!e.hasSkill)),r=t.reduce(((e,t)=>e*t.multiplier),1);let o=[];if(t.length>0)if(1===t.length)o.push(`${P[805]}${(0,Bc.Z)(t[0].skillName,P)}${P[806]}${t[0].multiplier}x.`);else{const e=t.map((e=>`${(0,Bc.Z)(e.skillName,P)} (${e.multiplier}x)`)).join(" & ");o.push(`Your ${e} skills combine to increase output by ${r}x.`)}return n.length>0&&n.forEach((e=>{const t=R.find((t=>t.type===e.skillName)),n=(null===t||void 0===t?void 0:t.source)||"Skill Shop";o.push(`${P[801]}${(0,Bc.Z)(e.skillName,P)}${P[802]}${(0,Bc.Z)(n,P)}${P[803]}${e.multiplier}x.`)})),o.join(" ")})(),ie=(()=>{const e=Fc.Ay.getNPCsInGrid(w);return e?Object.values(e).filter((e=>e&&"heal"===e.action)).length:0})(),le=(y&&R?y.filter((e=>{const t=R.find((t=>t.type===e.type));return t&&"Hospital"===t.type})).length:0)*((null===I||void 0===I?void 0:I.doctorsPerHospital)||1);return(0,d.jsx)(Zc,{onClose:c,title:`${O} ${(0,Bc.Z)(b,P)}`,panelName:"CraftingStation",children:(0,d.jsx)("div",{className:"station-panel-container",children:"Library"!==b&&"Hospital"!==b||null!==f&&void 0!==f&&null!==(i=f.location)&&void 0!==i&&null!==(l=i.gtype)&&void 0!==l&&l.startsWith("valley")||String(f.location.s)===String(f.settlementId)?(0,d.jsxs)(d.Fragment,{children:[se&&(0,d.jsx)("div",{className:"station-panel-header",style:{padding:"10px",backgroundColor:"var(--color-bg-light)",borderRadius:"5px",fontStyle:"italic",marginBottom:"10px"},children:se}),(0,d.jsxs)("div",{className:"station-panel-content",children:[(null===_||void 0===_?void 0:_.length)>0?_.map((e=>{(0,Yd.gU)(e,R||[]);const t=(0,Kc.Fp)(e,u,Array.isArray(p)?p:[],1),n=(e=>{var t;return!e||(null===(t=f.skills)||void 0===t?void 0:t.some((t=>t.type===e)))})(e.requires),r=n?"green":"red",o=U===e.type&&q>0,i=U===e.type&&0===q,l="heal"===e.action&&ie>=le,c=o?Bp(1e3*q):0,y=o?`${P[441]} ${pp(Date.now()+1e3*q,Date.now())}`:i?P[457]:e.crafttime?`${P[458]} ${mp(e.crafttime)}`:P[459],k=(0,d.jsxs)("div",{className:"info-content",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:P[421]})," ",R.filter((t=>[t.ingredient1,t.ingredient2,t.ingredient3,t.ingredient4].includes(e.type))).map((e=>`${e.symbol||""} ${(0,Bc.Z)(e.type,P)}`)).join(", ")||"None"]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:P[422]})," \ud83d\udcb0 ",e.minprice||"n/a"]}),"Hospital"===b&&"heal"===e.action&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:P[51]})," ",e.maxhp||"n/a"]})]}),A=[1,2,3,4].map((t=>{var n,r,o;const a=e[`ingredient${t}`],s=e[`ingredient${t}qty`];if(!a||!s)return"";const i=((null===u||void 0===u||null===(n=u.find((e=>e.type===a)))||void 0===n?void 0:n.quantity)||0)+((null===p||void 0===p||null===(r=p.find((e=>e.type===a)))||void 0===r?void 0:r.quantity)||0),l=i>=s?"green":"red",c=(null===(o=R.find((e=>e.type===a)))||void 0===o?void 0:o.symbol)||"";return`<span style="color: ${l}; display: block;">${c} ${(0,Bc.Z)(a,P)} ${s} / ${i}</span>`})).join("");return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,P),className:"resource-button "+(o?"in-progress":i?"ready btn-sell":""),details:o?y:(l?`<span style="color: red;">${P[408]}</span><br>`:"")+(e.requires?`<span style="color: ${r};">${P[460]}${(0,Bc.Z)(e.requires,P)}</span><br>`:"")+`${y}<br>`+(i?"":`${P[461]}<div>${A}</div>`),info:k,disabled:!i&&(null!==U||!t||!n||l),onClick:void 0,isTransactionMode:!0,transactionKey:i?`crafting-collect-${e.type}-${x.x}-${x.y}`:`crafting-start-${e.type}-${x.x}-${x.y}`,onTransactionAction:i?(t,n)=>(async(e,t,n)=>{if(console.log(`\ud83d\udd12 [PROTECTED CRAFTING] Starting protected collection for ${n.type}`),n)try{const r=await a.A.post(`${s.A}/api/crafting/collect-item`,{playerId:f.playerId,gridId:w,stationX:x.x,stationY:x.y,craftedItem:U,transactionId:e,transactionKey:t});if(r.data.success){const{collectedItem:e,isNPC:t,inventory:o,updatedStation:a}=r.data;console.log("MasterSkills:",T),console.log("Station Type:",b);const s=(0,Kc.TM)(b,f.skills||[],T),i=1,l=(0,Kc.dN)(i,s.multiplier);if(console.log("[DEBUG] qtyCollected after multiplier:",l),t){const t=R.find((t=>t.type===e));t&&(Fc.Ay.spawnNPC(w,t,{x:x.x,y:x.y}),J((e=>e+1))),Lc.A.addFloatingText(`+${l} ${(0,Bc.Z)(e,P)}`,x.x,x.y,C)}else{const t=await(0,Kc.qf)({playerId:f.playerId,currentPlayer:f,resource:e,quantity:l,inventory:f.inventory,backpack:f.backpack,setInventory:h,setBackpack:m,setCurrentPlayer:g,updateStatus:L,masterResources:S,globalTuning:I});if(!0!==t&&(!t||!1===t.success))return void console.error("\u274c Failed to add buffed crafted item to inventory.");Lc.A.addFloatingText(`+${l} ${(0,Bc.Z)(e,P)}`,x.x,x.y,C)}await(0,Uc.D)(f,"Craft",e,l,g),console.log("\ud83d\udd04 [COLLECT] Clearing crafting state from resources...");const c=zc.default.getResources().map((e=>e.x===x.x&&e.y===x.y?{...e,craftEnd:void 0,craftedItem:void 0}:e)),d=c.find((e=>e.x===x.x&&e.y===x.y));console.log("\ud83d\udd04 [COLLECT] Updated station after clearing:",{craftEnd:null===d||void 0===d?void 0:d.craftEnd,craftedItem:null===d||void 0===d?void 0:d.craftedItem}),zc.default.setResources(c),v(c),console.log("\ud83d\udd04 [COLLECT] Resetting UI state..."),z(!1),H(null),V(null),X(!1),Y(!1),console.log("\ud83d\udd04 [COLLECT] Incrementing stationRefreshKey"),ee((e=>(console.log("\ud83d\udd04 [COLLECT] stationRefreshKey changing from",e,"to",e+1),e+1))),await(0,Kc.CP)(f.playerId,g);const u=nd("craft",e,l,s.hasSkills?s:null,P,Bc.Z);L(u),console.log(`${n.type} collected successfully using protected endpoint.`)}}catch(o){var r;console.error("Error in protected crafting collection:",o),429===(null===(r=o.response)||void 0===r?void 0:r.status)?L(471):L("\u274c Failed to collect item")}else console.error("\u274c No valid crafted item to collect.")})(t,n,e):(t,n)=>re(t,n,e),gemCost:o?c:null,onGemPurchase:o?()=>oe():!e.gemcost||t&&n||null!==U||l?null:ae,resource:o?{type:"CraftingSpeedup",gemcost:c}:e,inventory:u,backpack:p,masterResources:S,currentPlayer:f,hideGem:i||!o&&null!==U||!o&&!e.gemcost||l},e.type)})):(0,d.jsx)("p",{children:P[424]}),j&&(0,d.jsx)("p",{className:"error-message",children:j})]}),("homestead"===f.location.gtype||k||"BuildTown"===(null===F||void 0===F?void 0:F.source)&&"town"===f.location.gtype&&te)&&(0,d.jsx)("div",{className:"station-panel-footer",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-success",onAction:async(e,t)=>{const n="BuildTown"===(null===F||void 0===F?void 0:F.source)&&"town"===f.location.gtype&&te;await wp({currentPlayer:f,setInventory:h,setBackpack:m,setCurrentPlayer:g,setResources:v,stationType:b,currentStationPosition:x,gridId:w,TILE_SIZE:C,updateStatus:L,onClose:c,devOnly:!E&&!n})},transactionKey:`sell-refund-${b}-${x.x}-${x.y}-${w}`,children:P[425]})})})]}):(0,d.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,d.jsx)("h2",{children:P[2050]||"This is not your home settlement. You cannot access community services in any settlement but your own."})})})})},Fp=t.memo(Lp),$p=JSON.parse('[{"workerType":"Kent","offsetX":2,"offsetY":-1},{"workerType":"The Shepherd","offsetX":2,"offsetY":0},{"workerType":"Farm Hand","offsetX":0,"offsetY":-2},{"workerType":"Rancher","offsetX":1,"offsetY":-2},{"workerType":"Lumberjack","offsetX":2,"offsetY":-2},{"workerType":"Crafter","offsetX":3,"offsetY":-2}]'),Gp=e=>{let{onClose:n,inventory:o,setInventory:i,backpack:l,setBackpack:c,currentPlayer:u,setCurrentPlayer:h,setResources:p,stationType:m,currentStationPosition:f,gridId:g,masterResources:y,masterSkills:v,masterTrophies:b,TILE_SIZE:x,isDeveloper:w,globalTuning:S}=e;const T=(0,r.k)(),[C,k]=(0,t.useState)([]),[A,I]=(0,t.useState)([]),[E,P]=(0,t.useState)(""),[_,N]=(0,t.useState)("\ud83d\uded6"),{updateStatus:R}=(0,t.useContext)(vu),[M,j]=(0,t.useState)(null),[D,O]=(0,t.useState)(!1),[B,L]=(0,t.useState)(null),[F,$]=(0,t.useState)(null),[G,z]=(0,t.useState)(!1),[U,H]=(0,t.useState)(!1),[q,V]=(0,t.useState)(0);(0,t.useEffect)((()=>{var e;if(!m||!f)return;const t=null===(e=zc.default.getResources())||void 0===e?void 0:e.find((e=>e.x===f.x&&e.y===f.y));if(t&&t.craftEnd){console.log(`\u23f3 Active crafting found: ${t.craftedItem} until ${new Date(t.craftEnd).toLocaleTimeString()}`),L(t.craftedItem),z(!0),O(!0);const e=()=>{const e=Math.max(0,Math.floor((t.craftEnd-Date.now())/1e3));$(e),0===e&&(z(!1),H(!0))};e();const n=setInterval(e,1e3);return()=>clearInterval(n)}console.log("\u274c No active crafting timer found."),L(null),z(!1),H(!1),$(null),O(!1)}),[m,f,zc.default.getResources(),F]),(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];i(e);const t=(await a.A.get(`${s.A}/api/inventory/${u.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(i(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[u]),(0,t.useEffect)((()=>{try{let e=y.filter((e=>e.source===m));const t=Fc.Ay.getNPCsInGrid(g);if(t){const n=Object.values(t).filter((e=>e&&e.type)).map((e=>e.type));console.log("Existing NPC types on grid:",n),e=e.filter((e=>!1!==e.repeatable||!n.includes(e.type)||(console.log(`Filtering out non-repeatable ${e.type} - already exists on grid`),!1)))}k(e);const n=y.find((e=>e.type===m));N((null===n||void 0===n?void 0:n.symbol)||"\ud83d\uded6"),j(n),I(y||[])}catch(e){console.error("Error processing masterResources:",e)}}),[m,y,g,q]),(0,t.useEffect)((()=>{const e=setInterval((()=>{V((e=>e+1))}),2e3);return()=>clearInterval(e)}),[]);const W=async e=>{var t,n,r,a;if(!G||!F)return void console.error("\u274c No active crafting to speed up");const s=Bp(1e3*F);if(((null===(t=u.inventory)||void 0===t||null===(n=t.find((e=>"Gem"===e.type)))||void 0===n?void 0:n.quantity)||0)+((null===(r=u.backpack)||void 0===r||null===(a=r.find((e=>"Gem"===e.type)))||void 0===a?void 0:a.quantity)||0)<s)R(`Need ${s} gems to speed up crafting`);else try{if(!await(0,Kc.dw)({playerId:u.playerId,recipe:{ingredient1:"Gem",ingredient1qty:s},inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:R}))return void console.error("\u274c Failed to spend gems for speedup");const e=await(0,Gc.mQ)(g,{type:m,x:f.x,y:f.y,craftEnd:Date.now(),craftedItem:B},!0);if(null===e||void 0===e||!e.success)throw new Error("Failed to update crafting station in database");{const e=zc.default.getResources().map((e=>e.x===f.x&&e.y===f.y?{...e,craftEnd:Date.now(),craftedItem:B}:e));zc.default.setResources(e),p(e),$(0),z(!1),H(!0),R(`Used ${s} gems to complete crafting instantly`),Lc.A.addFloatingText(`-${s} \ud83d\udc8e`,f.x,f.y,x),console.log(`\u2705 Crafting completed instantly using ${s} gems`)}}catch(d){console.error("\u274c Error in gem speedup:",d),R("\u274c Failed to speed up crafting")}},Y=async e=>{console.log("\ud83d\udd0d [GEM DEBUG] handleGemPurchase called with:",e);if(!await(0,Kc.dw)({playerId:u.playerId,recipe:e,inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:R}))return void console.warn("Failed to spend ingredients for gem purchase.");console.log("\ud83d\udd0d [GEM DEBUG] Ingredients spent successfully");const t=A.find((t=>t.type===e.type));if(t&&"npc"===t.category){const n=$p.find((t=>t.workerType===e.type)),r=(null===n||void 0===n?void 0:n.offsetX)||0,o=(null===n||void 0===n?void 0:n.offsetY)||0,a={x:f.x+r,y:f.y+o};console.log(`Spawning ${e.type} at offset (${r}, ${o}) from Farm House`),Fc.Ay.spawnNPC(g,t,a),"worker"===t.action&&await(0,qc.p)(u.playerId,"First Farm Worker",1,u,b,h),await(0,Uc.D)(u,"Craft",e.type,1,h),R(`\ud83d\udc8e ${(0,Bc.Z)(e.type,T)} hired instantly!`),Lc.A.addFloatingText(`+1 ${(0,Bc.Z)(e.type,T)}`,f.x,f.y,x),V((e=>e+1)),await(0,Kc.CP)(u.playerId,h)}else R("Gem purchase not supported for this item type")};return(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1032",titleKey:"1132",panelName:"FarmHouse",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(null===C||void 0===C?void 0:C.length)>0?C.map((e=>{(0,Yd.gU)(e,A||[]);const t=(0,Kc.Fp)(e,o,Array.isArray(l)?l:[],1),n=(e=>{var t;return!e||(null===(t=u.skills)||void 0===t?void 0:t.some((t=>t.type===e)))})(e.requires),r=n?"green":"red",w=B===e.type&&F>0,C=B===e.type&&0===F,k=w?Bp(w?1e3*F:0):0,I=w?`${T[441]} ${pp(Date.now()+1e3*F,Date.now())}`:C?T[457]:e.crafttime?`${T[458]} ${mp(e.crafttime)}`:T[459];let E;E="Farm Hand"===e.type?(0,d.jsx)("div",{className:"info-content",children:(0,d.jsx)("div",{children:T[350]})}):"Rancher"===e.type?(0,d.jsx)("div",{className:"info-content",children:(0,d.jsx)("div",{children:T[351]})}):"Lumberjack"===e.type?(0,d.jsx)("div",{className:"info-content",children:(0,d.jsx)("div",{children:T[352]})}):"Crafter"===e.type?(0,d.jsx)("div",{className:"info-content",children:(0,d.jsx)("div",{children:T[353]})}):"Kent"===e.type?(0,d.jsx)("div",{className:"info-content",children:(0,d.jsx)("div",{children:T[354]})}):"The Shepherd"===e.type?(0,d.jsx)("div",{className:"info-content",children:(0,d.jsx)("div",{children:T[355]})}):(0,d.jsxs)("div",{className:"info-content",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:T[421]})," ",A.filter((t=>[t.ingredient1,t.ingredient2,t.ingredient3,t.ingredient4].includes(e.type))).map((e=>`${e.symbol||""} ${(0,Bc.Z)(e.type,T)}`)).join(", ")||"None"]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:T[422]})," \ud83d\udcb0 ",e.minprice||"n/a"]})]});const _=[1,2,3,4].map((t=>{var n,r,a;const s=e[`ingredient${t}`],i=e[`ingredient${t}qty`];if(!s||!i)return"";const c=((null===o||void 0===o||null===(n=o.find((e=>e.type===s)))||void 0===n?void 0:n.quantity)||0)+((null===l||void 0===l||null===(r=l.find((e=>e.type===s)))||void 0===r?void 0:r.quantity)||0),d=c>=i?"green":"red",u=(null===(a=A.find((e=>e.type===s)))||void 0===a?void 0:a.symbol)||"";return`<span style="color: ${d}; display: block;">${u} ${(0,Bc.Z)(s,T)} ${i} / ${c}</span>`})).join("");return(0,d.jsx)(Eh,{symbol:e.symbol,name:(0,Bc.Z)(e.type,T),className:"resource-button "+(w?"in-progress":C?"ready btn-sell":""),details:w?I:(e.requires?`<span style="color: ${r};">${T[460]}${(0,Bc.Z)(e.requires,T)}</span><br>`:"")+`${I}<br>`+(C?"":`${T[461]}<div>${_}</div>`),info:E,disabled:!C&&(null!==B||!t||!n),onClick:void 0,isTransactionMode:!0,transactionKey:C?`crafting-collect-${e.type}-${f.x}-${f.y}`:`crafting-start-${e.type}-${f.x}-${f.y}`,onTransactionAction:C?(t,n)=>(async(e,t,n)=>{if(n){console.log("\ud83d\udd0d [COLLECT DEBUG] Starting collection:",{craftedItem:B,recipeType:null===n||void 0===n?void 0:n.type,ftuestep:u.ftuestep,firsttimeuser:u.firsttimeuser,stationType:m});try{const n=await a.A.post(`${s.A}/api/crafting/collect-item`,{playerId:u.playerId,gridId:g,stationX:f.x,stationY:f.y,craftedItem:B,transactionId:e,transactionKey:t});if(n.data.success){const{collectedItem:e,isNPC:t,inventory:r,updatedStation:o}=n.data;console.log("\ud83d\udd0d [COLLECT DEBUG] Server response:",{collectedItem:e,isNPC:t,hasInventory:!!r}),console.log("MasterSkills:",v);const a=1*(u.skills||[]).filter((t=>{var n;const r=A.find((e=>e.type===t.type)),o="skill"===(null===r||void 0===r?void 0:r.category),a=((null===v||void 0===v||null===(n=v[t.type])||void 0===n?void 0:n[e])||1)>1;return o&&a})).map((e=>e.type)).reduce(((t,n)=>{var r;return t*((null===v||void 0===v||null===(r=v[n])||void 0===r?void 0:r[e])||1)}),1);if(console.log("[DEBUG] qtyCollected after multiplier:",a),Lc.A.addFloatingText(`+${a} ${(0,Bc.Z)(e,T)}`,f.x,f.y,x),t){const t=A.find((t=>t.type===e));if(t){const n=$p.find((t=>t.workerType===e)),r=(null===n||void 0===n?void 0:n.offsetX)||0,o=(null===n||void 0===n?void 0:n.offsetY)||0,a={x:f.x+r,y:f.y+o};console.log(`Spawning ${e} at offset (${r}, ${o}) from Farm House, final position: (${a.x}, ${a.y})`),Fc.Ay.spawnNPC(g,t,a),"worker"===t.action&&await(0,qc.p)(u.playerId,"First Farm Worker",1,u,b,h),V((e=>e+1))}}else await(0,Kc.qf)({playerId:u.playerId,currentPlayer:u,resource:e,quantity:a,inventory:u.inventory,backpack:u.backpack,setInventory:i,setBackpack:c,setCurrentPlayer:h,updateStatus:R,masterResources:y,globalTuning:S})||console.error("\u274c Failed to add buffed crafted item to inventory.");await(0,Uc.D)(u,"Craft",e,a,h);const s=zc.default.getResources().map((e=>e.x===f.x&&e.y===f.y?{...e,craftEnd:void 0,craftedItem:void 0}:e));zc.default.setResources(s),p(s),O(!1),L(null),$(null),H(!1),await(0,Kc.CP)(u.playerId,h)}}catch(o){var r;console.error("Error in protected crafting collection:",o),429===(null===(r=o.response)||void 0===r?void 0:r.status)?R(471):R(454)}}else console.error("\u274c No valid crafted item to collect.")})(t,n,e):(t,n)=>(async(e,t,n)=>{if(console.log(`\ud83d\udd12 [PROTECTED CRAFTING] Starting protected craft for ${n.type}`),P(""),n)try{const r={playerId:u.playerId,gridId:g,stationX:f.x,stationY:f.y,recipe:n,transactionId:e,transactionKey:t,isGemPurchase:t&&t.includes("crafting-gem-")};console.log("\ud83d\udd0d [CRAFT DEBUG] Sending to server:",r);const o=await a.A.post(`${s.A}/api/crafting/start-craft`,r);if(o.data.success){const{craftEnd:e,craftedItem:t,inventory:r,backpack:a}=o.data;r&&(i(r),h((e=>({...e,inventory:r})))),a&&(c(a),h((e=>({...e,backpack:a}))));const s=zc.default.getResources().map((n=>n.x===f.x&&n.y===f.y?{...n,craftEnd:e,craftedItem:t}:n));zc.default.setResources(s),p(s),L(t),$(Math.max(0,Math.floor((e-Date.now())/1e3))),O(!0),z(!0),H(!1),await(0,Kc.CP)(u.playerId,h),Lc.A.addFloatingText(404,f.x,f.y,x),R(`${T[440]} ${(0,Bc.Z)(n.type,T)}`)}}catch(d){var r,o,l;console.error("Error in protected crafting start:",d),console.error("Error response data:",null===(r=d.response)||void 0===r?void 0:r.data),429===(null===(o=d.response)||void 0===o?void 0:o.status)?R(451):400===(null===(l=d.response)||void 0===l?void 0:l.status)?R(450):R(452)}else P("Invalid recipe selected.")})(t,n,e),gemCost:w?k:null,onGemPurchase:w?()=>W():!e.gemcost||t&&n||null!==B?null:Y,resource:w?{type:"CraftingSpeedup",gemcost:k}:e,inventory:o,backpack:l,masterResources:y||A,currentPlayer:u,hideGem:C||!w&&null!==B||!w&&!e.gemcost},e.type)})):(0,d.jsx)("p",{children:T[456]}),E&&(0,d.jsx)("p",{className:"error-message",children:E}),w&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("hr",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-danger",onAction:async(e,t)=>{await wp({currentPlayer:u,setInventory:i,setBackpack:c,setCurrentPlayer:h,setResources:p,stationType:m,currentStationPosition:f,gridId:g,TILE_SIZE:x,updateStatus:R,onClose:n,devOnly:!0})},transactionKey:`sell-refund-${m}-${f.x}-${f.y}-${g}`,children:T[490]})})]})]})})},zp=t.memo(Gp);const Up=function(e){let{isOpen:n,title:r,message:o}=e;const[a,s]=(0,t.useState)(0),i=["\u23f3","\u231b"];return(0,t.useEffect)((()=>{if(!n)return void s(0);const e=setInterval((()=>{s((e=>(e+1)%i.length))}),500);return()=>clearInterval(e)}),[n]),n?(0,d.jsx)(Ou,{isOpen:n,onClose:()=>{},title:r,size:"small",className:"progress-modal",children:(0,d.jsxs)("div",{className:"progress-modal-content",children:[(0,d.jsx)("div",{className:"progress-message",children:o}),(0,d.jsx)("div",{className:"progress-hourglass",children:i[a]})]})}):null},Hp=(0,t.createContext)(),qp=e=>{let{children:n}=e;const[r,o]=(0,t.useState)({}),a=function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];console.log(`\ud83c\udfad NPC ${e}: ${t?`setting overlay '${t}'`:"clearing overlay"} (clickable: ${n})`),o((r=>({...r,[e]:t?{overlay:t,clickable:n}:void 0})))};return(0,d.jsx)(Hp.Provider,{value:{npcOverlays:r,setNPCOverlay:a,clearNPCOverlay:e=>{a(e,null)},getNPCOverlay:e=>r[e],setBusyOverlay:e=>a(e,"hourglass",!1),setQuestOverlay:e=>a(e,"exclamation",!0),setAttackOverlay:e=>a(e,"attack",!0)},children:n})};function Vp(e){let{isOpen:n,onClose:r,crops:o,getFreshCrops:a,onExecute:s,showBulkReplant:i,hasRequiredSkill:l,strings:c,currentSeason:u,masterResources:h}=e;const[p,m]=(0,t.useState)({}),[f,g]=(0,t.useState)({}),[y,v]=(0,t.useState)(!1);t.useEffect((()=>{if(n&&o.length>0){const e={};if(o.forEach((t=>{e[t.type]=!0})),m(e),i){const e={};o.forEach((t=>{if(t.repeatable)return void(e[t.type]=!0);const n=l(t.replantRequires);let r=!0;if(u&&h){const e=h.find((e=>"farmplot"===e.category&&e.output===t.type));e&&e.season&&(r=e.season===u)}n&&r&&(e[t.type]=!0)})),g(e)}}}),[n,o,i,l,u,h]);return n?(0,d.jsx)(Ou,{isOpen:n,onClose:r,title:c[315]||"Select Crops to Harvest",size:"medium",children:(0,d.jsxs)("div",{style:{padding:"20px",fontSize:"16px"},children:[(0,d.jsxs)("div",{style:{marginBottom:"15px",display:"flex",gap:"10px"},children:[(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"10px"},children:[(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal-small",onClick:()=>{const e={},t={};o.forEach((n=>{e[n.type]=!0,n.repeatable&&(t[n.type]=!0)})),m(e),g((e=>({...e,...t})))},children:c[316]||"Select All"}),(0,d.jsx)("button",{className:"btn-basic btn-neutral btn-modal-small",onClick:()=>{m({}),g({})},children:c[317]||"Deselect All"})]}),i&&(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"10px",marginLeft:"auto"},children:[(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal-small",onClick:()=>{const e={},t={};o.forEach((n=>{if(n.repeatable)return p[n.type]&&(e[n.type]=!0),void(t[n.type]=p[n.type]||!1);const r=l(n.replantRequires);let o=!0;if(u&&h){const e=h.find((e=>"farmplot"===e.category&&e.output===n.type));e&&e.season&&(o=e.season===u)}r&&o?(e[n.type]=!0,t[n.type]=!0):t[n.type]=p[n.type]||!1})),g(e),m((e=>({...e,...t})))},children:c[316]||"Select All"}),(0,d.jsx)("button",{className:"btn-basic btn-neutral btn-modal-small",onClick:()=>{const e={};o.forEach((t=>{t.repeatable&&p[t.type]&&(e[t.type]=!0)})),g(e)},children:c[317]||"Deselect All"})]})]}),i&&(0,d.jsxs)("div",{style:{display:"flex",marginBottom:"10px",fontSize:"14px",fontWeight:"bold"},children:[(0,d.jsx)("div",{style:{width:"30px",paddingLeft:"5px"},children:c[342]||"Harvest?"}),(0,d.jsx)("div",{style:{flex:1}}),(0,d.jsx)("div",{style:{width:"140px",textAlign:"center"},children:c[343]||"Replant?"})]}),(0,d.jsx)("div",{style:{maxHeight:"400px",overflowY:"auto"},children:o.map((e=>{const t=l(e.replantRequires);let n=!0;if(u&&h){const t=h.find((t=>"farmplot"===t.category&&t.output===e.type));t&&t.season&&(n=t.season===u)}const r=t&&n,a=!0===e.repeatable,s=f[e.type]||!1,y=a||!r;return(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px",padding:"5px",borderBottom:"1px solid #eee"},children:[(0,d.jsx)("div",{style:{width:"30px"},children:(0,d.jsx)("input",{type:"checkbox",checked:p[e.type]||!1,onChange:()=>(e=>{const t=o.find((t=>t.type===e)),n=!0===(null===t||void 0===t?void 0:t.repeatable);m((t=>{const r=!t[e];return r?n&&g((t=>({...t,[e]:!0}))):g((t=>({...t,[e]:!1}))),{...t,[e]:r}}))})(e.type),style:{width:"20px"}})}),(0,d.jsxs)("div",{style:{flex:1,textAlign:"left"},children:[e.symbol," ",(0,Bc.Z)(e.type,c)," (",e.count,")"]}),i&&(0,d.jsxs)("div",{style:{marginLeft:"60px",width:"100px",display:"flex",alignItems:"center",justifyContent:"center"},children:[!a&&!n&&(0,d.jsx)("span",{style:{fontSize:"12px",color:"#888",marginRight:"5px"},children:"off season"}),(0,d.jsx)("input",{type:"checkbox",checked:s,onChange:()=>!a&&r&&(e=>{const t=o.find((t=>t.type===e));!0!==(null===t||void 0===t?void 0:t.repeatable)&&g((t=>{const n=!t[e];return n&&m((t=>({...t,[e]:!0}))),{...t,[e]:n}}))})(e.type),disabled:y,style:{width:"20px",opacity:r?1:.5,cursor:y?"not-allowed":"pointer"},title:a?"Auto-replants for free":r?"":n?`Requires ${e.replantRequires||"unknown skill"} to replant ${e.type}`:`${e.type} is not available in current season`})]})]},e.type)}))}),(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center"},children:(0,d.jsx)("button",{className:`btn-basic ${y?"btn-neutral":"btn-success"} btn-modal`,onClick:async()=>{if(!y){v(!0);try{if(a){const e=await a(),t={},n={};e.forEach((e=>{p[e.type]&&(t[e.type]=!0,(e.repeatable||f[e.type])&&(n[e.type]=!0))})),s(t,n)}else{const e={...f};o.forEach((t=>{t.repeatable&&p[t.type]&&(e[t.type]=!0)})),s(p,e)}}finally{v(!1)}}},disabled:y||Object.values(p).every((e=>!e)),children:y?"Processing...":c[318]||"Harvest Selected"})})]})}):null}async function Wp(e){let{selectedCropTypes:t,selectedReplantTypes:r,resources:o,masterResources:i,masterSkills:l,currentPlayer:c,setCurrentPlayer:d,setInventory:u,setBackpack:h,setResources:p,gridId:m,showBulkReplant:f,strings:g,refreshPlayerAfterInventoryUpdate:y,globalTuning:v}=e;const b=Object.keys(t).filter((e=>t[e]));if(0===b.length)return{success:!1,error:g[449]||"No crops selected for harvest."};const x=await Promise.resolve().then(n.bind(n,6857)).then((e=>e.default));await x.forceProcessPendingSeeds({gridId:m,setResources:p,masterResources:i});const w=await Promise.resolve().then(n.bind(n,5823)).then((e=>e.default));let S=w.getResources();const T=S.filter((e=>{if("farmplot"===e.category&&e.growEnd){const t=Date.now();return e.growEnd<=t}return!1}));if(T.length>0){let e=0;const t=50;for(;e<t;){await new Promise((e=>setTimeout(e,100))),e++,S=w.getResources();if(0===T.filter((e=>{const t=S.find((t=>t.x===e.x&&t.y===e.y));return!!t&&!("farmplot"!==t.category||!t.growEnd)})).length)break}e===t&&(await x.forceProcessPendingSeeds({gridId:m,setResources:p,masterResources:i}),await new Promise((e=>setTimeout(e,200))))}await x.forceProcessPendingSeeds({gridId:m,setResources:p,masterResources:i}),await new Promise((e=>setTimeout(e,100)));const C=w.getResources(),k=await async function(e,t,n,r,o,a){let s=0;const i=[],l=(o.inventory||[]).filter((e=>!(0,Kc.sy)(e.type))).reduce(((e,t)=>e+(t.quantity||0)),0),c=(o.backpack||[]).filter((e=>!(0,Kc.sy)(e.type))).reduce(((e,t)=>e+(t.quantity||0)),0),d=(0,Kc.O_)(o,n,a),u=d.warehouse||0,h=d.backpack||0,p=u+h,m=l+c,f=p-m;for(const x of e){const e=t.filter((e=>e.type===x));if(0===e.length)continue;const a=n.find((e=>e.type===x));if(!a)continue;const l=(0,Kc.TM)(x,o.skills||[],r),c=a.qtycollected||1,d=Math.floor(c*l.multiplier),u=e.length*d;i.push({type:x,count:e.length,baseYield:c,skillMultiplier:l.multiplier,skillInfo:l,yieldPerCrop:d,totalYield:u,positions:e.map((e=>({x:e.x,y:e.y}))),symbol:a.symbol||"\ud83c\udf3e"}),s+=u}const g=[],y={};for(const x of i){const e=n.find((e=>"farmplot"===e.category&&e.output===x.type));if(e){for(let t=1;t<=4;t++){const n=e[`ingredient${t}`],r=e[`ingredient${t}qty`];if(n&&r){const e=r*x.count;y[n]=(y[n]||0)+e}}g.push({farmplotType:e.type,cropType:x.type,count:x.count,positions:x.positions,growtime:e.growtime||60})}}const v={};let b=!0;return Object.entries(y).forEach((e=>{var t,n,r,a;let[s,i]=e;const l=((null===(t=o.inventory)||void 0===t||null===(n=t.find((e=>e.type===s)))||void 0===n?void 0:n.quantity)||0)+((null===(r=o.backpack)||void 0===r||null===(a=r.find((e=>e.type===s)))||void 0===a?void 0:a.quantity)||0);v[s]={needed:i,has:l,enough:l>=i},l<i&&(b=!1)})),{canHarvest:f>=s,totalCapacityNeeded:s,availableSpace:f,currentTotalUsage:m,totalCapacity:p,warehouseCapacity:u,backpackCapacity:h,harvestDetails:i,replantDetails:g,seedsNeeded:y,hasEnoughSeeds:v,canReplantAll:b}}(b,C,i,l,c,v);if(!k.canHarvest){const e=k.totalCapacityNeeded,t=k.availableSpace;return{success:!1,error:`${g[447]||"Not enough space"}: ${e} needed, ${t} available`}}if(f&&!k.canReplantAll){const e=Object.entries(k.hasEnoughSeeds).filter((e=>{let[t,n]=e;return!n.enough})).map((e=>{let[t,n]=e;return`${(0,Bc.Z)(t,g)}: ${n.needed-n.has} more needed`})).join(", ");console.log(`\u26a0\ufe0f Not enough seeds for replanting: ${e}`)}const A=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=[];return e.harvestDetails.forEach((e=>{const o=t[e.type]||!1;let a=!1;if(o&&n.length>0){const t=n.find((t=>t.type===e.type));a=!0===(null===t||void 0===t?void 0:t.repeatable)}r.push({cropType:e.type,positions:e.positions,replant:o,freeReplant:a,expectedYield:e.totalYield})})),r}(k,r,i),I=`bulk-harvest-${c._id}-${Date.now()}`,E=`bulk-harvest-${m}`;try{const e=await a.A.post(`${s.A}/api/bulk-harvest`,{playerId:c._id,gridId:m,operations:A,transactionId:I,transactionKey:E});if(e.data.success){const t=e.data.results;e.data.inventory&&(u(e.data.inventory.warehouse||[]),h(e.data.inventory.backpack||[]),d((t=>({...t,inventory:e.data.inventory.warehouse||[],backpack:e.data.inventory.backpack||[]}))));const n=new Set;t.harvested&&Object.values(t.harvested).forEach((e=>{e&&e.positions&&Array.isArray(e.positions)&&e.positions.forEach((e=>n.add(`${e.x},${e.y}`)))}));const r=C.filter((e=>!n.has(`${e.x},${e.y}`)));t.replanted&&Object.entries(t.replanted).forEach((e=>{let[t,n]=e;const o=i.find((e=>"farmplot"===e.category&&e.output===t));o&&n.positions&&Array.isArray(n.positions)&&n.positions.forEach(((e,t)=>{const a=1e3*(n.growtime||o.growtime||300),s=Date.now()+a;r.push({...o,x:e.x,y:e.y,type:o.type,growEnd:s,stage:1,category:"farmplot",output:o.output})}))})),w.setResources(r),p(r),x.initializeFarmState(r);const o={};t.harvested&&"object"===typeof t.harvested&&Object.entries(t.harvested).forEach((e=>{let[t,n]=e;if(n){const e=(0,Kc.TM)(t,c.skills||[],l);e.hasSkills&&(o[t]=e)}}));const a={};t.harvested&&"object"===typeof t.harvested&&Object.entries(t.harvested).forEach((e=>{let[t,n]=e;n&&"undefined"!==typeof n.quantity&&(a[t]=n.quantity)}));const s={};t.replanted&&Object.entries(t.replanted).forEach((e=>{let[t,n]=e;s[t]=n.count}));let m=0;t.harvested&&Object.entries(t.harvested).forEach((e=>{let[t,n]=e;"Wheat"!==t&&n&&n.positions&&Array.isArray(n.positions)&&(m+=n.positions.length)})),console.log("\ud83c\udf81 Calculating warehouse drops for",m,"non-Wheat plots harvested");const f=function(e,t){let{masterResources:n,globalTuning:r,selectWeightedRandomItem:o,playerId:a}=t;const s=[],i=n.filter((e=>"Warehouse"===e.requires&&e.scrollchance));if(0===i.length)return console.warn("\ufffd\x0f No warehouse ingredients found in masterResources"),s;const l=i.map((e=>({...e,scrollchance:Kd(e.type,a)}))),c=(null===r||void 0===r?void 0:r.harvestDropRate)||.1;console.log(`<\ud83c\udfb2 Bulk warehouse calculation: globalTuning.harvestDropRate = ${null===r||void 0===r?void 0:r.harvestDropRate}, resolved dropRate = ${c}`);for(let d=0;d<e;d++)if(Math.random()<=c){const e=o(l,1);e&&s.push({type:e.type,quantity:1,symbol:e.symbol||"",rarity:e.scrollchance||"common"})}return console.log(`<\ufffd Bulk warehouse drops calculated: ${s.length} total drops from ${e} plots`),s}(m,{masterResources:i,globalTuning:v,selectWeightedRandomItem:Jd,playerId:c.playerId}),y=function(e){const t={};return e.forEach((e=>{t[e.type]||(t[e.type]={quantity:0,symbol:e.symbol,rarity:e.rarity}),t[e.type].quantity+=e.quantity})),t}(f);if(console.log("\ud83c\udf81 Aggregated warehouse drops:",y),f.length>0)try{for(const t of f){var P,_;await(0,Kc.qf)({playerId:c.playerId,currentPlayer:c,resource:t.type,quantity:t.quantity,inventory:(null===(P=e.data.inventory)||void 0===P?void 0:P.warehouse)||[],backpack:(null===(_=e.data.inventory)||void 0===_?void 0:_.backpack)||[],setInventory:u,setBackpack:h,setCurrentPlayer:d,updateStatus:()=>{},masterResources:i,globalTuning:v})?(console.log(`\u2705 Added warehouse ingredient: ${t.type} x${t.quantity}`),await(0,Uc.D)(c,"Collect",t.type,t.quantity,d)):console.warn(`\u26a0\ufe0f Failed to add warehouse ingredient: ${t.type} x${t.quantity} (inventory full?)`)}}catch(M){console.error("\u274c Error adding warehouse ingredients to inventory:",M)}return t.harvested&&"object"===typeof t.harvested&&Object.entries(t.harvested).forEach((e=>{let[t,n]=e;n&&n.quantity&&(0,Uc.D)({questProgressCategory:"collect",itemName:t,quantity:n.quantity,currentPlayer:c,setCurrentPlayer:d,masterResources:i})})),Object.entries(t.seedsUsed||{}).forEach((e=>{let[t,n]=e;(0,Uc.D)({questProgressCategory:"spend",itemName:t,quantity:n,currentPlayer:c,setCurrentPlayer:d,masterResources:i})})),{success:!0,harvestResults:a,replantInfo:s,harvestSkillsInfo:o,warehouseDrops:y,seedsUsed:t.seedsUsed||{},statusMessage:td("harvest",a,o,s,g,Bc.Z)}}return{success:!1,error:g[448]||"Bulk harvest failed"}}catch(M){var N,R;return console.error("\ud83c\udf3e Bulk harvest error:",M),{success:!1,error:(null===(N=M.response)||void 0===N||null===(R=N.data)||void 0===R?void 0:R.message)||M.message||"Bulk harvest failed"}}}function Yp(e,t){const n={};e.filter((e=>(0,Yd.AQ)(e.type,t))).forEach((e=>{if(!n[e.type]){const r=t.find((t=>t.type===e.type)),o=t.find((t=>"farmplot"===t.category&&t.output===e.type));n[e.type]={count:0,symbol:(null===r||void 0===r?void 0:r.symbol)||"\ud83c\udf3e",replantRequires:null===o||void 0===o?void 0:o.requires,repeatable:!0===e.repeatable||!0===(null===r||void 0===r?void 0:r.repeatable)}}n[e.type].count++}));return Object.entries(n).map((e=>{let[t,n]=e;return{type:t,count:n.count,symbol:n.symbol,replantRequires:n.replantRequires,repeatable:n.repeatable}}))}const Kp=function(e){let{isOpen:t,onClose:n,results:r,strings:o,masterResources:a}=e;if(!t||!r)return null;const{harvestResults:s={},replantInfo:i={},harvestSkillsInfo:l={},warehouseDrops:c={},seedsUsed:u={}}=r,h=Object.keys(s).length>0,p=Object.keys(i).length>0,m=Object.keys(c).length>0;return Object.keys(l).length,(0,d.jsx)(Ou,{isOpen:t,onClose:n,title:o[356]||"Bulk Harvest Results",size:"medium",className:"bulk-harvest-results-modal",children:(0,d.jsxs)("div",{className:"bulk-harvest-results-content",children:[h&&(0,d.jsxs)("div",{className:"results-section",children:[(0,d.jsxs)("h3",{className:"results-section-header crops",children:["\ud83c\udf31 ",o[357]||"Crops Harvested"]}),(0,d.jsx)("div",{className:"crop-rows",children:Object.entries(s).map((e=>{let[t,n]=e;const r=l[t],s=r&&r.hasSkills,i=null===a||void 0===a?void 0:a.find((e=>e.type===t)),c=(null===i||void 0===i?void 0:i.symbol)||"\ud83c\udf3e";return(0,d.jsxs)("div",{className:"crop-row",children:[(0,d.jsx)("span",{className:"crop-symbol",children:c}),(0,d.jsx)("span",{className:"crop-name",children:(0,Bc.Z)(t,o)}),(0,d.jsxs)("span",{className:"crop-quantity",children:["+",n]}),s&&(0,d.jsxs)("span",{className:"crop-skills",children:["Skills applied (",r.multiplier,"x): ",r.skills.join(", ")]})]},t)}))})]}),p&&(0,d.jsxs)("div",{className:"results-section",children:[(0,d.jsxs)("h3",{className:"results-section-header replanting",children:["\ud83c\udf31 ",o[358]||"Crops Replanted"]}),(0,d.jsx)("div",{className:"replant-rows",children:Object.entries(i).map((e=>{let[t,n]=e;const r=null===a||void 0===a?void 0:a.find((e=>e.type===t)),s=(null===r||void 0===r?void 0:r.symbol)||"\ud83c\udf31",i=u[t];return(0,d.jsxs)("div",{className:"replant-row",children:[(0,d.jsx)("span",{className:"replant-symbol",children:s}),(0,d.jsx)("span",{className:"replant-name",children:(0,Bc.Z)(t,o)}),(0,d.jsx)("span",{className:"replant-quantity",children:n}),i&&(0,d.jsxs)("span",{className:"replant-seeds-used",children:[o[361]||"Seeds used",": -",i]})]},t)}))})]}),m&&(0,d.jsxs)("div",{className:"results-section",children:[(0,d.jsxs)("h3",{className:"results-section-header warehouse",children:["\ud83d\udce6 ",o[359]||"Warehouse Ingredients Found"]}),(0,d.jsx)("div",{className:"results-grid-warehouse",children:Object.entries(c).map((e=>{let[t,n]=e;return(0,d.jsxs)("div",{className:"result-item warehouse",children:[(0,d.jsx)("div",{className:"result-item-label",children:(0,d.jsxs)("span",{className:"result-item-name",children:[n.symbol," ",(0,Bc.Z)(t,o)]})}),(0,d.jsxs)("span",{className:"result-item-quantity warehouse",children:["+",n.quantity]})]},t)}))})]}),(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",marginTop:"20px"},children:(0,d.jsx)("button",{onClick:n,className:"btn-basic btn-success btn-modal",style:{fontSize:"16px",padding:"10px 20px"},children:o[360]||"Continue"})})]})})};function Xp(e){let{isOpen:n,onClose:r,animals:o,onExecute:a,strings:s}=e;const[i,l]=(0,t.useState)({});t.useEffect((()=>{if(n&&o.length>0){const e={};o.forEach((t=>{e[t.type]=!0})),l(e)}}),[n,o]);return n?(0,d.jsx)(Ou,{isOpen:n,onClose:r,title:s[319]||"Select Animals to Collect",size:"medium",children:(0,d.jsxs)("div",{style:{padding:"20px",fontSize:"16px"},children:[(0,d.jsxs)("div",{className:"shared-buttons",style:{marginBottom:"15px",display:"flex",gap:"10px"},children:[(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal-small",onClick:()=>{const e={};o.forEach((t=>{e[t.type]=!0})),l(e)},children:s[316]||"Select All"}),(0,d.jsx)("button",{className:"btn-basic btn-danger btn-modal-small",onClick:()=>l({}),children:s[317]||"Deselect All"})]}),(0,d.jsx)("div",{style:{marginBottom:"20px"},children:o.map(((e,t)=>(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",padding:"5px",backgroundColor:t%2===0?"transparent":"var(--color-bg-light)"},children:[(0,d.jsx)("input",{type:"checkbox",checked:i[e.type]||!1,onChange:t=>{l((n=>({...n,[e.type]:t.target.checked})))},style:{marginRight:"10px"}}),(0,d.jsxs)("span",{children:[e.symbol," ",(0,Bc.Z)(e.type,s)," (",e.count,")"]})]},e.type)))}),(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center"},children:(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal",onClick:()=>{a()},disabled:Object.values(i).every((e=>!e)),children:s[318]||"Collect Selected"})})]})}):null}function Zp(e){let{isOpen:n,onClose:r,stationGroups:o,onExecute:a,hasBulkRestartCraft:s,strings:i,masterResources:l,inventory:c,backpack:u}=e;const[h,p]=(0,t.useState)([]),[m,f]=(0,t.useState)({});t.useEffect((()=>{if(n&&o.length>0&&(p(o),s)){const e={};o.forEach((t=>{if(t.canRestart){const n=`${t.stationType}-${t.craftedItem}`;e[n]=!0}})),f(e)}}),[n,o,s]);const g=e=>h.some((t=>t.stationType===e.stationType&&t.craftedItem===e.craftedItem));if(!n)return null;const y=e=>!s||!e.canRestart||!e.affordable;return(0,d.jsx)(Ou,{isOpen:n,onClose:r,title:i[341]||"Select Crafting Stations to Collect:",size:"large",children:(0,d.jsxs)("div",{style:{padding:"20px",fontSize:"16px"},children:[(0,d.jsxs)("div",{style:{marginBottom:"15px",display:"flex",gap:"10px"},children:[(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"10px"},children:[(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal-small",onClick:()=>{p(o)},children:i[316]||"Select All"}),(0,d.jsx)("button",{className:"btn-basic btn-neutral btn-modal-small",onClick:()=>{p([]),f({})},children:i[317]||"Deselect All"})]}),s&&(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"10px",marginLeft:"auto",marginRight:"20px"},children:[(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal-small",onClick:()=>{const e={},t=[];o.forEach((n=>{if(n.canRestart&&n.affordable){const r=`${n.stationType}-${n.craftedItem}`;e[r]=!0,g(n)||t.push(n)}})),f((t=>({...t,...e}))),p((e=>[...e,...t]))},children:i[316]||"Select All"}),(0,d.jsx)("button",{className:"btn-basic btn-neutral btn-modal-small",onClick:()=>{f({})},children:i[317]||"Deselect All"})]})]}),(0,d.jsxs)("div",{style:{display:"flex",marginBottom:"10px",fontSize:"14px",fontWeight:"bold"},children:[(0,d.jsx)("div",{style:{width:"60px",textAlign:"center"},children:i[346]||"Collect?"}),(0,d.jsx)("div",{style:{width:"200px",textAlign:"left",paddingLeft:"10px"},children:i[476]||"Station"}),(0,d.jsx)("div",{style:{width:"270px",textAlign:"left"},children:i[161]||"Item"}),s&&(0,d.jsx)("div",{style:{width:"80px",textAlign:"center"},children:i[475]}),(0,d.jsx)("div",{style:{width:"150px",textAlign:"center"},children:i[177]})]}),(0,d.jsx)("div",{style:{maxHeight:"400px",overflowY:"auto"},children:o.map(((e,t)=>{const n=`${e.stationType}-${e.craftedItem}`,r=(e=>{if(!e.recipe||!e.stationCount)return null;const t={};for(let a=1;a<=4;a++){const s=e.recipe[`ingredient${a}`],i=e.recipe[`ingredient${a}qty`];if(s&&i){var n,r,o;const a=i*e.stationCount,d=((null===c||void 0===c||null===(n=c.find((e=>e.type===s)))||void 0===n?void 0:n.quantity)||0)+((null===u||void 0===u||null===(r=u.find((e=>e.type===s)))||void 0===r?void 0:r.quantity)||0);t[s]={needed:a,available:d,symbol:(null===(o=l.find((e=>e.type===s)))||void 0===o?void 0:o.symbol)||""}}}return t})(e);return(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px",padding:"5px",borderBottom:"1px solid #eee"},children:[(0,d.jsx)("div",{style:{width:"60px",textAlign:"center"},children:(0,d.jsx)("input",{type:"checkbox",checked:g(e),onChange:()=>(e=>{p((t=>{if(t.some((t=>t.stationType===e.stationType&&t.craftedItem===e.craftedItem))){const n=`${e.stationType}-${e.craftedItem}`;return f((e=>({...e,[n]:!1}))),t.filter((t=>!(t.stationType===e.stationType&&t.craftedItem===e.craftedItem)))}return[...t,e]}))})(e),style:{width:"20px"}})}),(0,d.jsxs)("div",{style:{width:"200px",textAlign:"left",fontWeight:"bold",paddingLeft:"10px"},children:[e.stationSymbol," ",(0,Bc.Z)(e.stationType,i)]}),(0,d.jsxs)("div",{style:{width:"270px",textAlign:"left"},children:[e.craftedSymbol," ",(0,Bc.Z)(e.craftedItem,i)," (",e.stationCount,")"]}),s?(()=>{const t=(e=>s?e.canRestart?(e.affordable,null):i[346]||"Locked":i[345]||"Requires skill")(e);return(0,d.jsxs)("div",{style:{marginLeft:"0px",width:"80px",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,d.jsx)("input",{type:"checkbox",checked:m[n]||!1,onChange:()=>!y(e)&&(e=>{const t=`${e.stationType}-${e.craftedItem}`;f((n=>{const r=!n[t];return r&&p((t=>t.some((t=>t.stationType===e.stationType&&t.craftedItem===e.craftedItem))?t:[...t,e])),{...n,[t]:r}}))})(e),disabled:y(e),style:{width:"20px",opacity:y(e)?.5:1,cursor:y(e)?"not-allowed":"pointer"},title:t||""}),t&&(0,d.jsx)("span",{style:{fontSize:"11px",color:"red",marginTop:"2px"},children:t})]})})():null,(0,d.jsx)("div",{style:{width:"150px",textAlign:"center",fontSize:"12px"},children:r&&Object.entries(r).map(((e,t)=>{let[n,r]=e;const o=r.available>=r.needed?"green":"red";return(0,d.jsxs)("div",{style:{color:o},children:[r.symbol," ",r.needed,"/",r.available]},t)}))})]},t)}))}),(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center"},children:(0,d.jsx)("button",{className:"btn-basic btn-success btn-modal",onClick:()=>{a(h,m)},disabled:0===h.length,children:i[318]||"Collect"})})]})})}async function Jp(e){let{selectedGroups:t,selectedRestartStations:n,hasBulkRestartCraft:r,currentPlayer:o,setCurrentPlayer:i,inventory:l,setInventory:c,backpack:d,setBackpack:u,setResources:h,gridId:p,masterResources:m,masterSkills:f,strings:g,updateStatus:y,globalTuning:v}=e;if(0===t.length)return"No crafting stations selected for collection.";const b=t.flatMap((e=>e.stations)).map((e=>{const o=`${e.type}-${e.craftedItem}`,a=r&&n[o];let s=null;if(a){const n=t.find((t=>t.stationType===e.type&&t.craftedItem===e.craftedItem));n&&n.recipe&&n.affordable&&(s=n.recipe)}return{x:e.x,y:e.y,type:e.type,craftedItem:e.craftedItem,transactionId:`bulk-craft-collect-${Date.now()}-${Math.random()}`,shouldRestart:a&&null!==s,restartRecipe:s}})),x=`bulk-craft-collect-${o._id}-${Date.now()}`,w=`bulk-craft-collect-${p}`;try{const e=await a.A.post(`${s.A}/api/crafting/collect-bulk`,{playerId:o.playerId||o._id,gridId:p,stations:b,transactionId:x,transactionKey:w});if(e.data.success&&e.data.results){var S,T;const t=e.data.results;let n=[...zc.default.getResources()];const r={},a={},s={},b={};for(const e of t)if(e.collected||e.success){const{station:t,collectedItem:n,craftedItem:i,isNPC:l}=e,c=n||i,d=`${t.x}-${t.y}`;e.restarted&&e.newCraftEnd?b[d]={craftEnd:e.newCraftEnd,craftedItem:e.newCraftedItem||c}:b[d]={craftEnd:void 0,craftedItem:void 0};const u=t.stationType||t.type,h=(o.skills||[]).filter((e=>{var t;const n=m.find((t=>t.type===e.type)),r="skill"===(null===n||void 0===n?void 0:n.category),o=((null===f||void 0===f||null===(t=f[e.type])||void 0===t?void 0:t[u])||1)>1;return r&&o})).map((e=>e.type)),g=h.reduce(((e,t)=>{var n;return e*((null===f||void 0===f||null===(n=f[t])||void 0===n?void 0:n[u])||1)}),1),y=1*g;if(l){const e=m.find((e=>e.type===c));e&&Fc.Ay.spawnNPC(p,e,{x:t.x,y:t.y})}else r[c]=(r[c]||0)+y,!s[c]&&h.length>0&&(s[c]={skills:h,multiplier:g,hasSkills:!0});if(e.restarted){const t=e.newCraftedItem||e.restartedItem||c;t&&(a[t]=(a[t]||0)+1)}}n=n.map((e=>{const t=`${e.x}-${e.y}`;return b[t]?{...e,...b[t]}:e})),e.data.inventory&&(c(e.data.inventory.warehouse||e.data.inventory),u(e.data.inventory.backpack||[]),i((t=>({...t,inventory:e.data.inventory.warehouse||e.data.inventory,backpack:e.data.inventory.backpack||[]})))),zc.default.setResources(n),h(n);const x=(null===(S=e.data.inventory)||void 0===S?void 0:S.warehouse)||l,w=(null===(T=e.data.inventory)||void 0===T?void 0:T.backpack)||d;for(const[e,l]of Object.entries(r))await(0,Kc.qf)({playerId:o.playerId,currentPlayer:{...o,inventory:x,backpack:w},resource:e,quantity:l,inventory:x,backpack:w,setInventory:c,setBackpack:u,setCurrentPlayer:i,updateStatus:y,masterResources:m,globalTuning:v}),await(0,Uc.D)(o,"Craft",e,l,i);await(0,Kc.CP)(o.playerId,i,!1);const C=Object.keys(r).length>0,k=Object.keys(a).length>0,A=t.filter((e=>e.collected||e.success)).length;if(C||k){const e=[];return C&&e.push(td("craft",r,s,null,g,Bc.Z)),k&&e.push(function(e,t,n,r){return e&&0!==Object.keys(e).length?`${Object.entries(e).map((e=>{let[t,o]=e;return`${o} ${r(t,n)}`})).join(", ")} ${{craft:"restarted",harvest:"replanted"}[t]||"restarted"}`:""}(a,"craft",g,Bc.Z)),e.join(" | ")}return A>0?`Collected from ${A} crafting station${A>1?"s":""}.`:"Failed to collect any crafted items."}return"Failed to collect crafted items."}catch(A){var C,k;return console.error("\ud83c\udfed Bulk crafting error:",A),(null===(C=A.response)||void 0===C||null===(k=C.data)||void 0===k?void 0:k.message)||A.message||"Bulk crafting failed"}}const Qp=e=>{let{onClose:o,npc:i,inventory:l,setInventory:c,backpack:u,setBackpack:h,currentPlayer:p,setCurrentPlayer:m,resources:f,setResources:g,stationType:y,currentStationPosition:v,gridId:b,TILE_SIZE:x,updateStatus:w,masterResources:S,masterSkills:T,currentSeason:C,globalTuning:k,isDeveloper:A=!1,masterXPLevels:I=[]}=e;const E=(0,r.k)(),[P,_]=(0,t.useState)([]),[N,R]=(0,t.useState)(""),[M,j]=(0,t.useState)("\ud83d\uded6"),[D,O]=(0,t.useState)(null),[B,L]=(0,t.useState)([]),[F,$]=(0,t.useState)([]),[G,z]=(0,t.useState)(!1),[U,H]=(0,t.useState)([]),[q,V]=(0,t.useState)(null),[W,Y]=(0,t.useState)(!1),[K,X]=(0,t.useState)(!1),[Z,J]=(0,t.useState)({}),[Q,ee]=(0,t.useState)([]),[te,ne]=(0,t.useState)(!1),[re,oe]=(0,t.useState)({}),[ae,se]=(0,t.useState)({}),[ie,le]=(0,t.useState)([]),ce=p.skills||[],de=ce.some((e=>"Bulk Replant"===e.type)),ue=ce.some((e=>"Bulk Restart Craft"===e.type)),[he,pe]=(0,t.useState)({isOpen:!1,message:""}),{setBusyOverlay:me,clearNPCOverlay:fe}=(0,t.useContext)(Hp),{startBulkOperation:ge,endBulkOperation:ye}=Cu();async function ve(e,t,n,r){let o=null;pe({isOpen:!0,message:E[477]||"Processing..."});try{o=await r()}catch(a){console.error(`${e} failed:`,a),o=a.message||`Failed to complete ${e}.`}finally{pe({isOpen:!1,message:""}),n&&fe(n.id),ye(t),o&&w(o)}}const be=(null===i||void 0===i?void 0:i.type)||y,xe=["Farmer","Farm Hand"].includes(be),we=["Farmer","Farm Hand"].includes(be)&&de,Se=["Farmer","Rancher"].includes(be),Te=["Farmer","Lumberjack"].includes(be),Ce=["Farmer","Farm Hand"].includes(be),ke=["Farmer","Crafter"].includes(be),Ae=e=>{var t;return!e||(null===(t=p.skills)||void 0===t?void 0:t.some((t=>t.type===e)))};(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];c(e);const t=(await a.A.get(`${s.A}/api/inventory/${p.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(c(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[p]);const Ie=ih(p,I);(0,t.useEffect)((()=>{try{const e=Array.isArray(l)?l:[],t=Array.isArray(u)?u:[],n=S.filter((n=>{var r,o;if(!(0,Yd.AQ)(n.type,S))return!1;if("devonly"===n.requires&&!A)return!1;if(!A&&n.season&&C&&n.season!==C)return!1;if(!A&&n.level&&n.level>Ie)return!1;return!(((null===(r=e.find((e=>e.type===n.type)))||void 0===r?void 0:r.quantity)||0)+((null===(o=t.find((e=>e.type===n.type)))||void 0===o?void 0:o.quantity)||0)>9)}));_(n);const r=S.find((e=>e.type===y));j((null===r||void 0===r?void 0:r.symbol)||"\ud83d\uded6"),O(r)}catch(e){console.error("Error loading worker offers:",e)}}),[y,S,C,A,Ie,l,u]),(0,t.useEffect)((()=>{var e;const t=(null===(e=p.skills)||void 0===e?void 0:e.map((e=>e.type)))||[];let n=["Farm Hand"];"Crafter"!==be&&"Farmer"!==be||n.push("Crafter"),"Rancher"!==be&&"Farmer"!==be||n.push("Rancher");let r=S.filter((e=>"skill"===e.category&&n.includes(e.source)&&!t.includes(e.type)));"Farm Hand"===be?r=r.filter((e=>["Bulk Harvest","Bulk Replant"].includes(e.type))):"Rancher"===be?r=r.filter((e=>"Bulk Animal Collect"===e.type)):"Lumberjack"===be?r=r.filter((e=>["Logging","Better Logging"].includes(e.type))):"Crafter"===be&&(r=r.filter((e=>["Bulk Crafting","Bulk Restart Craft"].includes(e.type)))),L(r)}),[S,p,be]);async function Ee(){X(!1),o(),R("");const e=Object.values(Fc.Ay.getNPCsInGrid(b)||{}).find((e=>"worker"===e.action&&["Farmer","Rancher"].includes(e.type)));e&&me(e.id);const t=`bulk-animal-collect-${Date.now()}`;ge("bulk-animal-collect",t),await ve("bulk-animal-collect",t,e,(async()=>await async function(e){let{selectedAnimalTypes:t,gridId:n,currentPlayer:r,setCurrentPlayer:o,setInventory:a,setBackpack:s,setResources:i,updateStatus:l,TILE_SIZE:c,masterResources:d,masterSkills:u,strings:h}=e;const p=Object.keys(t).filter((e=>t[e]));if(0===p.length)return"No animals selected for collection.";const m=Object.values(Fc.Ay.getNPCsInGrid(n)||{}).filter((e=>"processing"===e.state&&p.includes(e.type))),f=e=>new Promise((t=>setTimeout(t,e))),g={},y={};for(const v of m){const e=await od(v,v.position.y,v.position.x,a,s,i,r,o,c,d,u,n,(()=>{}),(()=>{}),l,(()=>{}),(()=>{}),h);if(e&&"success"===e.type&&e.collectedItem){const{collectedItem:t,collectedQuantity:n,skillsApplied:r}=e;if(g[t]=(g[t]||0)+n,!y[t]&&r&&r.length>0){const e=n;y[t]={skills:r,multiplier:e,hasSkills:!0}}}await f(100)}if(await f(100),await(0,Kc.CP)(r.playerId,o,!1),Object.keys(g).length>0)return td("animal",g,y,null,h,Bc.Z);return"Failed to collect from any animals."}({selectedAnimalTypes:Z,gridId:b,currentPlayer:p,setCurrentPlayer:m,setInventory:c,setBackpack:h,setResources:g,updateStatus:w,TILE_SIZE:x,masterResources:S,masterSkills:T,strings:E}))),o()}const Pe=t.useCallback((async()=>{const e=await Promise.resolve().then(n.bind(n,6857)).then((e=>e.default));await e.forceProcessPendingSeeds({gridId:b,setResources:g,masterResources:S}),await new Promise((e=>setTimeout(e,100)));return Yp(zc.default.getResources(),S)}),[b,g,S]);const _e=e=>{switch(e){case"Bulk Harvest":return E[427];case"Bulk Animal Collect":return E[431];case"Logging":return E[432];case"Better Logging":return E[433];case"Bulk Crafting":return E[464];case"Bulk Restart Craft":return E[468]||"Automatically restart crafting after collection";default:return""}};return(0,d.jsxs)(Zc,{onClose:o,descriptionKey:"1023",title:null!==i&&void 0!==i&&i.symbol?`${i.symbol} ${be}`:be,panelName:"FarmHandPanel",children:[(0,d.jsxs)("div",{className:"standard-panel",children:[xe&&(null===ce||void 0===ce?void 0:ce.some((e=>"Bulk Harvest"===e.type)))&&(0,d.jsx)("div",{children:(0,d.jsx)(Eh,{symbol:"\ud83c\udf31",name:(0,Bc.Z)("Bulk Harvest",E),className:"resource-button bulk-skill",details:E[428],onClick:async function(){const e=await Promise.resolve().then(n.bind(n,6857)).then((e=>e.default));await e.forceProcessPendingSeeds({gridId:b,setResources:g,masterResources:S}),e.stopSeedTimer(),await new Promise((e=>setTimeout(e,200)));const t=zc.default.getResources(),r=Yp(t,S);if(0===r.length)return w(E[344]||"No crops ready for harvest."),e.initializeFarmState(t),void e.startSeedTimer({gridId:b,setResources:g,masterResources:S});H(r),z(!0)}})}),Se&&(null===ce||void 0===ce?void 0:ce.some((e=>"Bulk Animal Collect"===e.type)))&&(0,d.jsx)("div",{children:(0,d.jsx)(Eh,{symbol:"\ud83d\udc2e",name:(0,Bc.Z)("Bulk Animal Collect",E),className:"resource-button bulk-skill",details:E[434],onClick:function(){const e=Object.values(Fc.Ay.getNPCsInGrid(b)||{}),t=e.filter((e=>"processing"===e.state));if(0===t.length)return void w("No animals are ready to collect.");const n=e.find((e=>"worker"===e.action&&["Farmer","Rancher"].includes(e.type)));n&&me(n.id);const r={};t.forEach((e=>{r[e.type]=(r[e.type]||0)+1}));const o=Object.entries(r).map((e=>{let[t,n]=e;const r=S.find((e=>e.type===t));return{type:t,count:n,symbol:(null===r||void 0===r?void 0:r.symbol)||"\ud83d\udc2e"}}));ee(o);const a={};o.forEach((e=>{a[e.type]=!0})),J(a),X(!0)}})}),Te&&(null===ce||void 0===ce?void 0:ce.some((e=>"Logging"===e.type)))&&(0,d.jsx)("div",{children:(0,d.jsx)(Eh,{symbol:"\ud83e\ude93",name:(0,Bc.Z)("Logging",E),className:"resource-button bulk-skill",details:E[435],onClick:async function(){console.log("\ud83e\ude93\ud83e\ude93\ud83e\ude93\ud83e\ude93\ud83e\ude93 Logging initiated \ud83e\ude93\ud83e\ude93\ud83e\ude93\ud83e\ude93\ud83e\ude93\ud83e\ude93"),o(),R("");const e=Array.isArray(l)?l:[],t=Array.isArray(u)?u:[],n=Object.values(Fc.Ay.getNPCsInGrid(b)||{}).find((e=>"worker"===e.action&&["Farmer","Lumberjack"].includes(e.type)));n&&me(n.id);const r=`bulk-logging-${Date.now()}`;ge("bulk-logging",r);try{const n=(p.skills||[]).filter((e=>["Logging","Better Logging"].includes(e.type))).reduce(((e,t)=>{const n=S.find((e=>e.type===t.type));return e+((null===n||void 0===n?void 0:n.qtycollected)||0)}),0);if(0===n)return void w("No logging skills available.");const r=Object.values(Fc.Ay.getNPCsInGrid(b)||{}),o=r.find((e=>"Lumberjack"===e.type)),s=r.find((e=>"Farmer"===e.type||"Farm Hand"===e.type));let i,l;if(o)i=o.position,l="Lumberjack";else if(s)i=s.position,l="Farmer";else{var a;const e=null===(a=$c.default.getPlayersInGrid(b))||void 0===a?void 0:a[p.playerId];e&&e.position?(i=e.position,l="Player"):(i={x:0,y:0},l="Default")}console.log(`\ud83e\ude93 Using ${l} position as center: (${i.x}, ${i.y})`);const d=f.filter((e=>"Oak Tree"===e.type)).map((e=>({...e,distance:Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))}))).sort(((e,t)=>e.distance-t.distance));if(0===d.length)return void w(E[437]||"No trees available to chop.");const u=d.slice(0,n);console.log(`\ud83c\udf32 Found ${d.length} trees, will chop ${u.length} closest to Lumberjack`);const y=e=>new Promise((t=>setTimeout(t,e))),v=[];for(const e of u)await tu(e,e.y,e.x,0,g,0,0,0,0,b,Lc.A.addFloatingText,x,p,m,S),v.push({x:e.x,y:e.y}),await y(100);await y(300),setTimeout((async()=>{for(const n of v){const r=("function"===typeof g?await new Promise((e=>{g((t=>(e(t),t)))})):f).find((e=>e.x===n.x&&e.y===n.y&&"doober"===e.category));console.log("\ud83e\udeb5\ud83e\udeb5\ud83e\udeb5 Found wood doober at",n,":",r),r?(console.log("Calling handleDooberClick"),await eu(r,r.y,r.x,f,g,c,h,e,t,p.skills,b,Lc.A.addFloatingText,x,p,m,w,S,T,E,null,k),await y(100)):console.warn("\u26a0\ufe0f No doober found at position:",n)}w(`\ud83e\udeb5 Logging complete: ${u.length} trees chopped and collected.`)}),50),await(0,Kc.CP)(p.playerId,m)}catch(s){console.error("Logging failed:",s),R("Failed to auto-chop trees.")}finally{ye(r);const e=Object.values(Fc.Ay.getNPCsInGrid(b)||{}).find((e=>"worker"===e.action&&["Farmer","Lumberjack"].includes(e.type)));e&&fe(e.id)}}})}),ke&&(null===ce||void 0===ce?void 0:ce.some((e=>"Bulk Crafting"===e.type)))&&(0,d.jsx)("div",{children:(0,d.jsx)(Eh,{symbol:"\ud83d\uded6",name:(0,Bc.Z)("Bulk Crafting",E),className:"resource-button bulk-skill",details:E[465],onClick:function(){console.log("\ud83d\uded6 Opening selective crafting modal");const e=function(e,t,n,r,o){const a=Date.now(),s=(zc.default.getResources()||[]).filter((t=>{const n=e.find((e=>e.type===t.type));return!(!n||"crafting"!==n.category)&&t.craftEnd&&t.craftEnd<=a&&t.craftedItem})),i={};s.forEach((r=>{const a=`${r.type}-${r.craftedItem}`;if(!i[a]){const s=e.find((e=>e.type===r.type)),l=e.find((e=>e.type===r.craftedItem)),c=e.find((e=>e.source===r.type&&e.type===r.craftedItem));i[a]={stationType:r.type,stationSymbol:(null===s||void 0===s?void 0:s.symbol)||"\ud83c\udfed",craftedItem:r.craftedItem,craftedSymbol:(null===l||void 0===l?void 0:l.symbol)||"\ud83d\udce6",stations:[],recipe:c,canRestart:!!c&&o(null===c||void 0===c?void 0:c.requires),affordable:!!c&&(0,Kc.Fp)(c,t,n,1)}}i[a].stations.push(r)}));const l=Object.values(i).map((e=>({...e,stationCount:e.stations.length})));return l.sort(((e,t)=>{const n=e.stationType.localeCompare(t.stationType);return 0!==n?n:e.craftedItem.localeCompare(t.craftedItem)})),l}(S,l,u,0,Ae);if(0===e.length)return void w(E[466]||"No crafting stations ready to collect.");const t=e;le(t);const n={};if(t.forEach((e=>{n[`${e.stationType}-${e.craftedItem}`]=!0})),oe(n),ue){const e={},n={};[...l||[],...u||[]].forEach((e=>{n[e.type]=(n[e.type]||0)+e.quantity})),t.forEach((t=>{const r=S.find((e=>e.type===t.craftedItem));if(r){let o=!0;for(let e=1;e<=5;e++){const a=r[`ingredient${e}`],s=r[`ingredient${e}qty`]||1;if(a){const e=s*t.count;if((n[a]||0)<e){o=!1;break}}}o&&(e[`${t.stationType}-${t.craftedItem}`]=!0)}})),se(e)}else se({});ne(!0)}})}),B.length>0&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:E[430]}),B.map((e=>{const t=(0,Kc.Fp)(e,l,1,u),n=[1,2,3,4].map((t=>{var n,r,o;const a=e[`ingredient${t}`],s=e[`ingredient${t}qty`];if(!a||!s)return"";const i=((null===(n=l.find((e=>e.type===a)))||void 0===n?void 0:n.quantity)||0)+((null===(r=u.find((e=>e.type===a)))||void 0===r?void 0:r.quantity)||0),c=i>=s?"green":"red",d=(null===(o=S.find((e=>e.type===a)))||void 0===o?void 0:o.symbol)||"";return`<span style="color: ${c}; display: block;">${d} ${a} ${s} / ${i}</span>`})).join(""),r=`Costs:<div>${n}</div>`;return(0,d.jsx)(Eh,{symbol:e.symbol,name:e.type,className:"resource-button",details:r,onClick:()=>(async e=>{R("");const t=Array.isArray(l)?l:[],n=Array.isArray(u)?u:[];if(!await(0,Kc.dw)({playerId:p.playerId,recipe:e,inventory:t,backpack:n,setInventory:c,setBackpack:h,setCurrentPlayer:m,updateStatus:w}))return void R("Not enough ingredients.");const r=[...p.skills||[],{type:e.type,category:e.category,quantity:1}];await a.A.post(`${s.A}/api/update-skills`,{playerId:p.playerId,skills:r}),await(0,Uc.D)(p,"Acquire",e.type,1,m),await(0,Kc.CP)(p.playerId,m),w(`${e.type} acquired.`)})(e),disabled:!t,info:_e(e.type)?(0,d.jsx)("div",{children:_e(e.type)}):void 0},e.type)}))]}),Ce&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h3",{children:E[426]}),(null===P||void 0===P?void 0:P.length)>0?P.map((e=>{var t,n;const r=10*(e.maxprice||100),o=((null===(t=l.find((e=>"Money"===e.type)))||void 0===t?void 0:t.quantity)||0)+((null===(n=u.find((e=>"Money"===e.type)))||void 0===n?void 0:n.quantity)||0)>=r,a=`${E[347]} \ud83d\udcb0 ${r}`;return(0,d.jsx)(Eh,{symbol:e.symbol,name:e.type,className:"resource-button",details:a,disabled:!o,onClick:()=>(async e=>{R("");const t=10*(e.maxprice||100),n={ingredient1:"Money",ingredient1qty:t,type:e.type},r=Array.isArray(l)?l:[],o=Array.isArray(u)?u:[];if(!await(0,Kc.dw)({playerId:p.playerId,recipe:n,inventory:r,backpack:o,setInventory:c,setBackpack:h,setCurrentPlayer:m,updateStatus:w}))return void R("Not enough money.");await(0,Kc.qf)({playerId:p.playerId,currentPlayer:p,resource:e.type,quantity:1,inventory:r,backpack:o,setInventory:c,setBackpack:h,setCurrentPlayer:m,updateStatus:w,masterResources:S,globalTuning:k})?w(`Bought 1 ${e.type} for ${t} Money.`):R("Not enough space to carry that item.")})(e)},e.type)})):(0,d.jsx)("p",{children:E[423]})]}),N&&(0,d.jsx)("p",{className:"error-message",children:N})]}),(0,d.jsx)(Vp,{isOpen:G,onClose:async()=>{z(!1);const e=Object.values(Fc.Ay.getNPCsInGrid(b)||{}).find((e=>"worker"===e.action));e&&fe(e.id);const t=await Promise.resolve().then(n.bind(n,6857)).then((e=>e.default)),r=zc.default.getResources();t.initializeFarmState(r),t.startSeedTimer({gridId:b,setResources:g,masterResources:S})},crops:U,getFreshCrops:Pe,onExecute:async function(e,t){z(!1),R("");const r=Object.values(Fc.Ay.getNPCsInGrid(b)||{}).find((e=>"worker"===e.action));r&&me(r.id);const o=`bulk-harvest-${Date.now()}`;ge("bulk-harvest",o);try{await ve("bulk-harvest",o,r,(async()=>{const n=await Wp({selectedCropTypes:e,selectedReplantTypes:t,resources:zc.default.getResources(),masterResources:S,masterSkills:T,currentPlayer:p,setCurrentPlayer:m,setInventory:c,setBackpack:h,setResources:g,gridId:b,showBulkReplant:we,strings:E,refreshPlayerAfterInventoryUpdate:Kc.CP,globalTuning:k});return n.success?(V(n),setTimeout((()=>{Y(!0)}),500),n.statusMessage):n.error}))}finally{const e=await Promise.resolve().then(n.bind(n,6857)).then((e=>e.default)),t=zc.default.getResources();e.initializeFarmState(t),e.startSeedTimer({gridId:b,setResources:g,masterResources:S})}},showBulkReplant:we,hasRequiredSkill:Ae,strings:E,currentSeason:C,masterResources:S}),(0,d.jsx)(Xp,{isOpen:K,onClose:()=>{X(!1);const e=Object.values(Fc.Ay.getNPCsInGrid(b)||{}).find((e=>"worker"===e.action&&["Farmer","Rancher"].includes(e.type)));e&&fe(e.id)},animals:Q,onExecute:()=>Ee(),strings:E}),(0,d.jsx)(Zp,{isOpen:te,onClose:()=>{ne(!1);const e=Object.values(Fc.Ay.getNPCsInGrid(b)||{}).find((e=>"worker"===e.action&&["Farmer","Crafter"].includes(e.type)));e&&fe(e.id)},stationGroups:ie,onExecute:async function(e,t){ne(!1),R("");const n=Object.values(Fc.Ay.getNPCsInGrid(b)||{}).find((e=>"worker"===e.action&&["Farmer","Crafter"].includes(e.type)));n&&me(n.id);const r=`bulk-crafting-${Date.now()}`;ge("bulk-crafting",r),await ve("bulk-crafting",r,n,(async()=>await Jp({selectedGroups:e,selectedRestartStations:t,hasBulkRestartCraft:ue,currentPlayer:p,setCurrentPlayer:m,inventory:l,setInventory:c,backpack:u,setBackpack:h,setResources:g,gridId:b,masterResources:S,masterSkills:T,strings:E,updateStatus:w,globalTuning:k}))),o()},hasBulkRestartCraft:ue,strings:E,masterResources:S,inventory:l,backpack:u}),(0,d.jsx)(Up,{isOpen:he.isOpen,title:E[478]||"Processing...",message:he.message}),(0,d.jsx)(Kp,{isOpen:W,onClose:()=>{Y(!1),V(null)},results:q,strings:E,masterResources:S})]})},em=t.memo(Qp),tm=e=>{let{onClose:n,inventory:o,setInventory:i,backpack:l,setBackpack:c,currentPlayer:u,setCurrentPlayer:p,setResources:m,stationType:f,currentStationPosition:g,gridId:y,TILE_SIZE:v,updateStatus:b,masterResources:x,masterTraders:w,masterTrophies:S,isDeveloper:T,globalTuning:C,masterXPLevels:k}=e;const A=(0,r.k)(),[I,E]=(0,t.useState)([]),[P,_]=(0,t.useState)(""),[N,R]=(0,t.useState)("\ud83d\uded6"),[M,j]=(0,t.useState)(null),[D,O]=(0,t.useState)(0),B=ih(u,k);(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];i(e);const t=(await a.A.get(`${s.A}/api/inventory/${u.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(i(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[u]),(0,t.useEffect)((()=>{if(!x||!f)return;const e=null===w||void 0===w?void 0:w.filter((e=>e.trader===f));if(e&&e.length>0){const t=e.map((e=>{const t=x.find((t=>t.type===e.gives)),n={type:e.gives,symbol:(null===t||void 0===t?void 0:t.symbol)||"?",qtycollected:e.givesqty||1,source:f,gemcost:(null===t||void 0===t?void 0:t.gemcost)||null,index:e.index,repeat:e.repeat,level:null===t||void 0===t?void 0:t.level,requires:null===t||void 0===t?void 0:t.requires,category:null===t||void 0===t?void 0:t.category};let r=1;for(let o=1;o<=7;o++){const t=`requires${o}`,a=`requires${o}qty`;e[t]&&(n[`ingredient${r}`]=e[t],n[`ingredient${r}qty`]=e[a]||1,r++)}return n})),n=t.filter((e=>{var t;return"power"!==e.category||!(null!==(t=u.powers)&&void 0!==t&&t.some((t=>t.type===e.type)))}));E(n)}else{const e=x.filter((e=>e.source===f&&(!u.powers||!u.powers.some((t=>t.type===e.type)))));E(e)}const t=x.find((e=>e.type===f));R((null===t||void 0===t?void 0:t.symbol)||"\ud83d\uded6"),j(t)}),[f,D,x,w,u.powers]);const L=async e=>F(e),F=async e=>{if(_(""),!e)return void _("Invalid recipe selected.");if("power"!==e.category){const r=e.qtycollected||1;if(!(0,Kc.Pu)({resource:e.type,quantity:r,currentPlayer:u,inventory:o,backpack:l,masterResources:x,globalTuning:C})){var t;const r="homestead"===(null===u||void 0===u||null===(t=u.location)||void 0===t?void 0:t.gtype),o="Money"===e.type,a="Gem"===e.type;if(o||a||r)b(20);else{var n;const e=null===u||void 0===u||null===(n=u.skills)||void 0===n?void 0:n.some((e=>"Backpack"===e.type&&e.quantity>0));b(e?21:19)}return}}if(!await(0,Kc.dw)({playerId:u.playerId,recipe:e,inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:p,updateStatus:b}))return;await(0,Kc.CP)(u.playerId,p);if("power"===e.category){const t=[...u.powers||[]],n=t.findIndex((t=>t.type===e.type));n>=0?t[n].quantity+=1:t.push({type:e.type,quantity:1}),await a.A.post(`${s.A}/api/update-powers`,{playerId:u.playerId,powers:t}),p((e=>({...e,powers:t})));const o=e=>!0===e.passable&&"number"===typeof e.damage&&e.damage>0,i=e=>!0===e.passable&&"number"===typeof e.armorclass&&e.armorclass>0;if((e=>!o(e)&&!i(e))(e)){var r;const t=null===(r=$c.default.getAllPCs(y))||void 0===r?void 0:r[u.playerId];if(t){const n={};["hp","maxhp","damage","armorclass","attackbonus","attackrange","speed"].forEach((r=>{if("number"===typeof e[r]){const o=t[r]||0,a=o+e[r];n[r]=a,console.log(`\ud83e\udde0 Updated ${r} for player ${u.playerId}: ${o} -> ${a}`)}})),Object.keys(n).length>0&&await $c.default.updatePC(y,u.playerId,n)}}else console.log(`${e.type} added to inventory - equip in Combat Panel to apply stats`),(0,h.D)("Message",{title:A[7004]||"Note:",message:A[7017]||"Equip in Combat Panel to use"})}else{if(!await(0,Kc.qf)({playerId:u.playerId,currentPlayer:u,resource:e.type,quantity:e.qtycollected||1,inventory:o,backpack:l,setInventory:i,setBackpack:c,setCurrentPlayer:p,updateStatus:b,masterResources:x,globalTuning:C}))return void console.warn(`Failed to gain ${e.type}`)}await(0,Uc.D)(u,"Buy",e.type,1,p),b(`${A[80]} ${e.type}.`),"Boat"===e.type&&null!==u&&void 0!==u&&u.playerId&&(0,qc.p)(u.playerId,"Mariner",1,u,S,p),"King's Crown"===e.type&&null!==u&&void 0!==u&&u.playerId&&(0,qc.p)(u.playerId,"King's Crown",1,u,S,p),"Trident"===e.type&&null!==u&&void 0!==u&&u.playerId&&(0,qc.p)(u.playerId,"Trident",1,u,S,p),O((e=>e+1))};return(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1025",title:`${N} ${f}`,panelName:"ShopStation",children:(0,d.jsxs)("div",{className:"station-panel-container",children:[(0,d.jsxs)("div",{className:"station-panel-content",children:["Store"===f&&(0,d.jsx)("p",{style:{fontWeight:"bold",color:"#4CAF50"},children:A[410]}),(null===I||void 0===I?void 0:I.length)>0?(()=>{const e=I.filter((e=>{if(!1===e.repeat){const t=null===o||void 0===o?void 0:o.some((t=>t.type===e.type)),n=null===l||void 0===l?void 0:l.some((t=>t.type===e.type));if(t||n)return!1}return!0}));return 0===e.length?(0,d.jsx)("p",{children:A[423]}):e.map((e=>{const t=(0,Kc.Fp)(e,o,l,1),n=(e=>{var t,n;return!e||(null===(t=u.skills)||void 0===t?void 0:t.some((t=>t.type===e)))||(null===(n=u.powers)||void 0===n?void 0:n.some((t=>t.type===e)))})(e.requires),r=!(a=e.level)||B>=a;var a;const s=n&&r;let i=null;if("power"===e.category){const t=[];["hp","maxhp","damage","armorclass","attackbonus","attackrange","speed"].forEach((n=>{if("number"===typeof e[n]){const r=A[n]||n;t.push(`${e[n]>0?"+":""}${e[n]} ${r}`)}})),t.length>0&&(i=(0,d.jsx)("span",{style:{color:"blue"},children:t.join(", ")}))}const c=[1,2,3,4].map((t=>{var n,r,a;const s=e[`ingredient${t}`],i=e[`ingredient${t}qty`];if(!s||!i)return"";const c=((null===o||void 0===o||null===(n=o.find((e=>e.type===s)))||void 0===n?void 0:n.quantity)||0)+((null===l||void 0===l||null===(r=l.find((e=>e.type===s)))||void 0===r?void 0:r.quantity)||0),d=c>=i?"green":"red",u=(null===(a=x.find((e=>e.type===s)))||void 0===a?void 0:a.symbol)||"";return`<span style="color: ${d}; display: block;">${u} ${s} ${i} / ${c}</span>`})).join(""),h=n?"green":"red",p=r?"green":"red";let m="";if("power"===e.category){const t=[];["hp","maxhp","damage","armorclass","attackbonus","attackrange","speed"].forEach((n=>{if("number"===typeof e[n]){const r=A[n]||n;t.push(`${e[n]>0?"+":""}${e[n]} ${r}`)}})),t.length>0&&(m=`<span style="color: blue;">${t.join(", ")}</span><br>`)}const g=m+(e.level?`<span style="color: ${p};">${A[10149]||"Level"} ${e.level}</span>`:"")+(e.requires?`<span style="color: ${h};">${A[460]||"Requires:"} ${e.requires}</span>`:"")+`${A[461]||"Costs:"}<div>${c}</div>`;let y=null;"Store"!==f&&"General Store"!==f||("Tent"===e.type?y=(0,d.jsx)("div",{children:A[81]}):"Boat"===e.type&&(y=(0,d.jsx)("div",{children:A[82]}))),!y&&i&&(y=(0,d.jsx)("div",{style:{marginBottom:"4px"},children:(0,d.jsx)("strong",{children:i})}));const v=y?(0,d.jsx)("div",{className:"info-content",children:y}):null;return(0,d.jsx)(Eh,{symbol:e.symbol,name:e.type,className:"resource-button",details:g,info:v,disabled:!t||!s,onClick:()=>F(e),gemCost:null,onGemPurchase:!e.gemcost||t&&s?null:L,meetsLevelRequirement:r,resource:e,inventory:o,backpack:l,masterResources:x,currentPlayer:u},e.type)}))})():(0,d.jsx)("p",{children:A[423]}),P&&(0,d.jsx)("p",{className:"error-message",children:P})]}),T&&(0,d.jsx)("div",{className:"station-panel-footer",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-danger",onAction:async()=>{try{await wp({currentPlayer:u,stationType:f,currentStationPosition:g,gridId:y,setResources:m,setInventory:i,setCurrentPlayer:p,updateStatus:b,onClose:n,devOnly:!0})&&n()}catch(e){console.error("Error selling station:",e),b("Failed to sell station")}},transactionKey:`sell-refund-${f}-${g.x}-${g.y}-${y}`,children:A[490]})})})]})})},nm=t.memo(tm);const rm=e=>{var n;let{onClose:o,inventory:i,setInventory:l,backpack:c,setBackpack:u,currentPlayer:p,setCurrentPlayer:m,setResources:f,stationType:g,currentStationPosition:y,gridId:v,masterResources:b,masterSkills:x,masterTrophies:w,TILE_SIZE:S,isDeveloper:T,currentSeason:C,globalTuning:k}=e;const A="homestead"===(null===p||void 0===p||null===(n=p.location)||void 0===n?void 0:n.gtype),I=(0,r.k)(),[E,P]=(0,t.useState)([]),[_,N]=(0,t.useState)([]),[R,M]=(0,t.useState)("\ud83d\uded6"),{updateStatus:j}=(0,t.useContext)(vu),[D,O]=(0,t.useState)(null),[B,L]=(0,t.useState)(!1),[F,$]=(0,t.useState)(null),[G,z]=(0,t.useState)(null),[U,H]=(0,t.useState)(!1),[q,V]=(0,t.useState)(!1),[W,Y]=(0,t.useState)(0),[K,X]=(0,t.useState)(0),[Z,J]=(0,t.useState)(1),[Q,ee]=(0,t.useState)(!1);(0,t.useEffect)((()=>{if(!g||!y)return;const e=()=>{var e;const t=null===(e=zc.default.getResources())||void 0===e?void 0:e.find((e=>e.x===y.x&&e.y===y.y));if(t&&t.craftEnd&&t.craftedItem){const e=Date.now(),n=t.craftEnd<e;if($(t.craftedItem),J(t.qty||1),n)H(!1),V(!0),z(0),L(!1);else{H(!0),L(!0);const n=Math.max(0,Math.floor((t.craftEnd-e)/1e3));z(n),0===n&&(H(!1),V(!0))}}else(F||U||q)&&($(null),H(!1),V(!1),z(null),L(!1),J(1))};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[g,y,F,U,q]),(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];l(e);const t=(await a.A.get(`${s.A}/api/inventory/${p.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(l(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[p]),(0,t.useEffect)((()=>{const e=[...i||[],...c||[]].find((e=>"Scroll"===e.type));X((null===e||void 0===e?void 0:e.quantity)||0)}),[i,c]),(0,t.useEffect)((()=>{try{let e=b.filter((e=>e.source===g&&(!e.season||!C||e.season===C)));const t=Fc.Ay.getNPCsInGrid(v);if(t){const n=Object.values(t).filter((e=>e&&e.type)).map((e=>e.type));console.log("Existing NPC types on grid:",n),e=e.filter((e=>!1!==e.repeatable||!n.includes(e.type)||(console.log(`Filtering out non-repeatable ${e.type} - already exists on grid`),!1)))}P(e);const n=b.find((e=>e.type===g));M((null===n||void 0===n?void 0:n.symbol)||"\ud83d\uded6"),O(n),N(b||[])}catch(e){console.error("Error processing masterResources:",e)}}),[g,b,v,W]),(0,t.useEffect)((()=>{const e=setInterval((()=>{Y((e=>e+1))}),2e3);return()=>clearInterval(e)}),[]);const te=(()=>{const e=Object.entries(x||{}).filter((e=>{let[t,n]=e;return n&&"object"===typeof n&&n[g]>1})).map((e=>{var t;let[n,r]=e;return{skillName:n,multiplier:r[g],hasSkill:null===(t=p.skills)||void 0===t?void 0:t.some((e=>e.type===n))}}));if(0===e.length)return null;const t=e.filter((e=>e.hasSkill)),n=e.filter((e=>!e.hasSkill)),r=t.reduce(((e,t)=>e*t.multiplier),1);let o=[];if(t.length>0)if(1===t.length)o.push(`${I[805]}${(0,Bc.Z)(t[0].skillName,I)}${I[806]}${t[0].multiplier}x.`);else{const e=t.map((e=>`${(0,Bc.Z)(e.skillName,I)} (${e.multiplier}x)`)).join(" & ");o.push(`Your ${e} skills combine to increase output by ${r}x.`)}return n.length>0&&n.forEach((e=>{const t=_.find((t=>t.type===e.skillName)),n=(null===t||void 0===t?void 0:t.source)||"Skill Shop";o.push(`${I[801]}${(0,Bc.Z)(e.skillName,I)}${I[802]}${(0,Bc.Z)(n,I)}${I[803]}${e.multiplier}x.`)})),o.join(" ")})(),ne=async(e,t)=>{if(F&&!Q){ee(!0);try{const d=await a.A.post(`${s.A}/api/crafting/collect-item`,{playerId:p.playerId,gridId:v,stationX:y.x,stationY:y.y,craftedItem:F,transactionId:e,transactionKey:t});if(d.data.success){var n,r;const{collectedItem:e,isNPC:t}=d.data,g=Z||1,x=_.find((t=>t.type===e));if(t){const t=_.find((t=>t.type===e));t&&Fc.Ay.spawnNPC(v,t,{x:y.x,y:y.y}),Lc.A.addFloatingText(`+${g} ${(0,Bc.Z)(e,I)}`,y.x,y.y,S)}else if(!x||"skill"!==x.category&&"power"!==x.category){if(!await(0,Kc.qf)({playerId:p.playerId,currentPlayer:p,resource:e,quantity:g,inventory:p.inventory,backpack:p.backpack,setInventory:l,setBackpack:u,setCurrentPlayer:m,updateStatus:j,masterResources:b,globalTuning:k}))return console.error("\u274c Failed to add revealed item to inventory."),void ee(!1);Lc.A.addFloatingText(`+${g} ${(0,Bc.Z)(e,I)}`,y.x,y.y,S)}else{var o,i;if("skill"===x.category?null===(o=p.skills)||void 0===o?void 0:o.some((t=>t.type===e)):null===(i=p.powers)||void 0===i?void 0:i.some((t=>t.type===e))){j(I[828]||"You already have this");const t=(0,Bc.Z)(e,I),n="skill"===x.category?"\ud83d\udcaa":"power"===x.category?"\u26a1":"\ud83d\udd27";Lc.A.addFloatingText(`${n} ${t} (Already Owned)`,y.x,y.y,S)}else{const t=await async function(e){let{item:t,currentPlayer:n,setCurrentPlayer:r,updateStatus:o,strings:i,gridId:l,quantity:c=1}=e;try{if(!t||!t.type||!t.category)return console.error("Invalid item provided to gainSkillOrPower:",t),!1;if(console.log(`\ud83c\udfaf Adding ${t.category}: ${t.type} x${c}`),"skill"===t.category){const e=[...n.skills||[]],o=e.findIndex((e=>e.type===t.type));o>=0?e[o].quantity=(e[o].quantity||1)+c:e.push({type:t.type,category:t.category,quantity:c}),await a.A.post(`${s.A}/api/update-skills`,{playerId:n.playerId,skills:e}),r((t=>({...t,skills:e}))),await(0,Uc.D)(n,"Acquire",t.type,c,r),"skill"===t.category&&await(0,qc.p)(n.playerId,"Skill Builder",1,n,null,r)}else{if("power"!==t.category)return console.error("Unknown item category:",t.category),!1;{const e=[...n.powers||[]],o=e.findIndex((e=>e.type===t.type));if(o>=0?e[o].quantity=(e[o].quantity||1)+c:e.push({type:t.type,quantity:c}),await a.A.post(`${s.A}/api/update-powers`,{playerId:n.playerId,powers:e}),r((t=>({...t,powers:e}))),t.output&&"number"===typeof t.qtycollected)if("range"===t.output){const e=(n.range||0)+t.qtycollected;await a.A.post(`${s.A}/api/update-profile`,{playerId:n.playerId,updates:{range:e}});const o={...n,range:e};r(o),localStorage.setItem("player",JSON.stringify(o)),console.log(`\ud83c\udfaf Updated range on player document: ${e}`)}else{var d;const e=null===(d=$c.default.getAllPCs(l))||void 0===d?void 0:d[n.playerId];if(e){const r=e[t.output]||0,o=r+t.qtycollected;await $c.default.updatePC(l,n.playerId,{[t.output]:o}),console.log(`\ud83e\udde0 Updated ${t.output} for player ${n.playerId}: ${r} -> ${o}`)}}}}return await(0,Kc.CP)(n.playerId,r),!0}catch(u){return console.error("Error in gainSkillOrPower:",u),o(`Failed to acquire ${t.type}`),!1}}({item:x,currentPlayer:p,setCurrentPlayer:m,updateStatus:j,strings:I,gridId:v,quantity:g});if(!t)return console.error("\u274c Failed to add skill/power to player."),void ee(!1);const n=(0,Bc.Z)(e,I),r="skill"===x.category?"\ud83d\udcaa":"power"===x.category?"\u26a1":"\ud83d\udd27";if(Lc.A.addFloatingText(`${r} ${n}`,y.x,y.y,S),"power"===x.category){const e=e=>!0===e.passable&&"number"===typeof e.damage&&e.damage>0,t=e=>!0===e.passable&&"number"===typeof e.armorclass&&e.armorclass>0;if((n=>!e(n)&&!t(n))(x)){var c;const e=null===(c=$c.default.getAllPCs(v))||void 0===c?void 0:c[p._id];if(e){const t={};["hp","maxhp","damage","armorclass","attackbonus","attackrange","speed"].forEach((n=>{if("number"===typeof x[n]){const r=e[n]||0,o=r+x[n];t[n]=o,console.log(`\ud83e\udde0 Updated ${n} for player ${p._id}: ${r} -> ${o}`)}})),Object.keys(t).length>0&&await $c.default.updatePC(v,p._id,t)}}else(0,h.D)("Message",{title:I[7001]||"Tip",message:I[7017]||"Equip in Combat Panel to use"})}}}await(0,Uc.D)(p,"Collect",e,g,m);const T=zc.default.getResources().map((e=>e.x===y.x&&e.y===y.y?{...e,craftEnd:void 0,craftedItem:void 0,qty:1}:e));zc.default.setResources(T),f(T),L(!1),$(null),z(null),V(!1),J(1),x&&("skill"===x.category||"power"===x.category)&&("skill"===x.category?null===(n=p.skills)||void 0===n?void 0:n.some((t=>t.type===e)):null===(r=p.powers)||void 0===r?void 0:r.some((t=>t.type===e)))||j(`${I[469]||"Collected"} ${g}x ${(0,Bc.Z)(e,I)}`),await(0,Kc.CP)(p.playerId,m),null!==p&&void 0!==p&&p.playerId&&(0,qc.p)(p.playerId,"Scroll Revealer",1,p,w,m),setTimeout((()=>{ee(!1)}),100)}else ee(!1)}catch(d){console.error("Error collecting revealed item:",d),j("\u274c Failed to collect item"),ee(!1)}}else console.error("\u274c No revealed item to collect or already collecting.")};return(0,d.jsx)(Zc,{onClose:o,descriptionKey:"1036",title:I[1136]||"Ancient Temple",panelName:"ScrollStation",children:(0,d.jsxs)("div",{className:"station-panel-container",children:[(0,d.jsxs)("div",{className:"station-panel-content",children:[(0,d.jsxs)("div",{style:{padding:"10px",textAlign:"center",fontSize:"16px",fontWeight:"bold"},children:[I[825],": ",(0,d.jsx)("br",{}),K," \ud83d\udcdc ",K>1?I[826]:I[827]]}),te&&(0,d.jsx)("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"var(--color-bg-light)",borderRadius:"5px",fontStyle:"italic"},children:te}),F&&(U||q)?U?(0,d.jsxs)("div",{className:"scroll-reveal-animation",children:[(0,d.jsx)("div",{className:"scroll-emoji",children:"\ud83d\udcdc"}),(0,d.jsx)("div",{className:"scroll-revealing-text",children:"Revealing Scroll..."}),(0,d.jsx)("div",{className:"scroll-countdown-text",children:pp(Date.now()+1e3*G,Date.now())})]}):(()=>{const e=b.find((e=>e.type===F)),t=(null===e||void 0===e?void 0:e.scrollchance)||"common",n="string"===typeof t?t.toUpperCase():"COMMON";return(0,d.jsx)(Eh,{symbol:(null===e||void 0===e?void 0:e.symbol)||"\ud83d\udce6",name:`\n${(0,Bc.Z)(F,I)}${Z>1?` (${Z})`:""}`,className:`resource-button scroll-collect-button rarity-${"string"===typeof t?t:"common"} ${Q?"collecting":"ready"}`,details:n,disabled:!q||Q,isTransactionMode:q&&!Q,transactionKey:q?`scroll-collect-${F}-${y.x}-${y.y}`:void 0,onTransactionAction:q?ne:void 0})})():K>0&&!Q?(0,d.jsx)(Eh,{name:I[831],className:"resource-button",details:`${I[461]} 1x \ud83d\udcdc ${I[827]}`,disabled:!1,isTransactionMode:!0,transactionKey:`scroll-reveal-${y.x}-${y.y}`,onTransactionAction:async(e,t)=>{if(0!==K)try{if(!await(0,Kc.dw)({playerId:p.playerId,currentPlayer:p,recipe:{ingredient1:"Scroll",ingredient1qty:1},inventory:p.inventory,backpack:p.backpack,setInventory:l,setBackpack:u,setCurrentPlayer:m,updateStatus:j,masterResources:b}))return void j(I[820]||"Failed to spend scroll");const n=function(e){const t=e.filter((e=>e.scrollchance));if(0===t.length)return console.warn("No scrollable items found in masterResources, using fallback"),{type:"Wood",quantity:10};const n=Jd(t,1);if(n){const e=n.scrollqty||1;return console.log(`\ud83c\udfb2 Scroll reveal: ${n.type} x${e} (rarity: ${n.scrollchance})`),{type:n.type,quantity:e}}const r=t[0];return{type:r.type,quantity:r.scrollqty||1}}(b),r=(function(e,t){const n=t.find((t=>t.type===e.type)),r=(null===n||void 0===n?void 0:n.symbol)||"\ud83d\udce6";e.quantity,e.type}(n,b),b.find((e=>"Reveal Scroll"===e.type))),o=(null===r||void 0===r?void 0:r.crafttime)||30,i=await a.A.post(`${s.A}/api/crafting/start-craft`,{playerId:p.playerId,gridId:v,stationX:y.x,stationY:y.y,recipe:{type:n.type,crafttime:o},qty:n.quantity,transactionId:e,transactionKey:t});if(i.data.success){const{craftEnd:e,craftedItem:t,inventory:r,backpack:o}=i.data;r&&(l(r),m((e=>({...e,inventory:r})))),o&&(u(o),m((e=>({...e,backpack:o}))));const a=zc.default.getResources().map((r=>r.x===y.x&&r.y===y.y?{...r,craftEnd:e,craftedItem:t,qty:n.quantity}:r));zc.default.setResources(a),f(a),$(t),J(n.quantity),z(Math.max(0,Math.floor((e-Date.now())/1e3))),L(!0),H(!0),V(!1),await(0,Kc.CP)(p.playerId,m),Lc.A.addFloatingText(I[829],y.x,y.y,S),await(0,Uc.D)(p,"Spend","Scroll",1,m)}}catch(n){console.error("Error in scroll reveal process:",n),j(I[830])}else j(I[820]||"You need at least 1 scroll to reveal")}}):null,0===K&&!F&&(0,d.jsx)("p",{style:{textAlign:"center",padding:"20px",color:"#666"},children:I[832]})]}),("homestead"===p.location.gtype||T)&&(0,d.jsx)("div",{className:"station-panel-footer",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-danger",onAction:async(e,t)=>{await wp({currentPlayer:p,setInventory:l,setBackpack:u,setCurrentPlayer:m,setResources:f,stationType:g,currentStationPosition:y,gridId:v,TILE_SIZE:S,updateStatus:j,onClose:o,devOnly:!A})},transactionKey:`sell-refund-${g}-${y.x}-${y.y}-${v}`,children:I[425]})})})]})})},om=t.memo(rm),am=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;const r=e.filter((e=>"pets"===e.source));if(0===r.length)return console.warn("No pet rewards found in masterResources"),null;const o=function(e,t){return e.map((e=>"Warehouse"===e.requires?{...e,scrollchance:Kd(e.type,t)}:e))}(r,n),a=Jd(o,t);if(!a)return null;const s=function(e){const t={common:{min:2,max:3},uncommon:{min:2,max:3},rare:{min:2,max:3},epic:{min:1,max:1},legendary:{min:1,max:1}},n=t[e]||t.common;return Math.floor(Math.random()*(n.max-n.min+1))+n.min}(a.scrollchance||"common");return{type:a.type,quantity:s,rarity:a.scrollchance||"common"}},sm=e=>{var n;let{onClose:o,inventory:i,setInventory:l,backpack:c,setBackpack:u,currentPlayer:h,setCurrentPlayer:p,setResources:m,petResource:f,currentPetPosition:g,gridId:y,masterResources:v,masterSkills:b,masterTrophies:x,TILE_SIZE:w,isDeveloper:S,globalTuning:T}=e;const C="homestead"===(null===h||void 0===h||null===(n=h.location)||void 0===n?void 0:n.gtype),k=(0,r.k)(),{updateStatus:A}=(0,t.useContext)(vu),[I,E]=(0,t.useState)(!1),[P,_]=(0,t.useState)(null),[N,R]=(0,t.useState)(null),[M,j]=(0,t.useState)(!1),[D,O]=(0,t.useState)(!1),[B,L]=(0,t.useState)(1),[F,$]=(0,t.useState)("common"),[G,z]=(0,t.useState)(!1),[U,H]=(0,t.useState)(!1),q=(null===f||void 0===f?void 0:f.type)||"Pet",V=(null===f||void 0===f?void 0:f.symbol)||"=\x15",W=(null===f||void 0===f?void 0:f.output)||"Milk",Y=(null===f||void 0===f?void 0:f.qtycollected)||1,K=(null===f||void 0===f?void 0:f.crafttime)||60;(0,t.useEffect)((()=>{(()=>{const e=(0,Kc.Fp)({ingredient1:W,ingredient1qty:Y},[...i||[],...c||[]]);H(e)})()}),[i,c,W,Y]),(0,t.useEffect)((()=>{if(!f||!g)return;const e=()=>{var e;const t=null===(e=zc.default.getResources())||void 0===e?void 0:e.find((e=>e.x===g.x&&e.y===g.y));if(t&&t.craftEnd&&t.craftedItem){const e=Date.now(),n=t.craftEnd<e;if(_(t.craftedItem),L(t.qty||1),$(t.rarity||"common"),n)j(!1),O(!0),R(0),E(!1);else{j(!0),E(!0);const n=Math.max(0,Math.floor((t.craftEnd-e)/1e3));R(n),0===n&&(j(!1),O(!0))}}else(P||M||D)&&(_(null),j(!1),O(!1),R(null),E(!1),L(1),$("common"))};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[f,g,P,M,D]);const X=async(e,t)=>{if(P&&!G){z(!0);try{const i=await a.A.post(`${s.A}/api/crafting/collect-item`,{playerId:h.playerId,gridId:y,stationX:g.x,stationY:g.y,craftedItem:P,transactionId:e,transactionKey:t});if(i.data.success){var n,r;const{collectedItem:e,isNPC:t}=i.data,c=B||1,d=v.find((t=>t.type===e));if(!await(0,Kc.qf)({playerId:h.playerId,currentPlayer:h,resource:e,quantity:c,inventory:h.inventory,backpack:h.backpack,setInventory:l,setBackpack:u,setCurrentPlayer:p,updateStatus:A,masterResources:v,globalTuning:T}))return console.error("L Failed to add pet reward to inventory."),void z(!1);Lc.A.addFloatingText(`+${c} ${(0,Bc.Z)(e,k)}`,g.x,g.y,w);const f=v.find((e=>e.type===q)),y=(null===f||void 0===f?void 0:f.xp)||1;try{const e=await a.A.post(`${s.A}/api/addXP`,{playerId:h.playerId,xpAmount:y});e.data.success&&p((t=>({...t,xp:e.data.newXP})))}catch(o){console.error("\u274c Error awarding XP for pet collection:",o)}await(0,Uc.D)(h,"Collect",e,c,p);const b=zc.default.getResources().map((e=>e.x===g.x&&e.y===g.y?{...e,craftEnd:void 0,craftedItem:void 0,qty:1,rarity:void 0}:e));zc.default.setResources(b),m(b),E(!1),_(null),R(null),O(!1),L(1),$("common"),d&&("skill"===d.category||"power"===d.category)&&("skill"===d.category?null===(n=h.skills)||void 0===n?void 0:n.some((t=>t.type===e)):null===(r=h.powers)||void 0===r?void 0:r.some((t=>t.type===e)))||A(`${(0,Bc.Z)(q,k)} found ${c}x ${(0,Bc.Z)(e,k)}!`),await(0,Kc.CP)(h.playerId,p),setTimeout((()=>{z(!1)}),100)}else z(!1)}catch(o){console.error("Error collecting pet reward:",o),A("L Failed to collect reward"),z(!1)}}else console.error("L No reward to collect or already collecting.")};return(0,d.jsx)(Zc,{onClose:o,title:(0,Bc.Z)(q,k),panelName:"PetPanel",children:(0,d.jsxs)("div",{className:"pet-panel-container",children:[(0,d.jsxs)("div",{className:"pet-panel-content",children:[(0,d.jsx)("div",{className:"pet-display",children:V}),(0,d.jsx)("div",{className:"pet-info",children:(0,d.jsx)("p",{className:"pet-status",children:M?`${(0,Bc.Z)(q,k)}${k[8014]||" is searching for treasures..."}`:D?`${(0,Bc.Z)(q,k)}${k[8016]||" has found something!"}`:(0,d.jsxs)(d.Fragment,{children:[k[8010]||"This pet is hungry.",(0,d.jsx)("br",{}),k[8011]||"Feed"," ",Y,"x ",(0,Bc.Z)(W,k),k[8012]||" to send it searching."]})})}),P&&(M||D)?M?(0,d.jsx)("div",{className:"pet-searching",children:(0,d.jsx)("div",{className:"pet-searching-countdown",children:pp(Date.now()+1e3*N,Date.now())})}):(()=>{const e=v.find((e=>e.type===P)),t=v.find((e=>e.type===q)),n=(null===t||void 0===t?void 0:t.xp)||1;return(0,d.jsx)(Eh,{symbol:(null===e||void 0===e?void 0:e.symbol)||"\ud83d\udce6",name:`${(0,Bc.Z)(P,k)}${B>1?` (${B})`:""}`,details:`(+ \ud83d\udd37${n})`,className:`resource-button pet-collect-button scroll-collect-button rarity-${F} ${G?"collecting":"ready"}`,disabled:!D||G,isTransactionMode:D&&!G,transactionKey:D?`pet-collect-${P}-${g.x}-${g.y}`:void 0,onTransactionAction:D?X:void 0,hideInfo:!0})})():G?null:(0,d.jsx)(Eh,{name:`${k[8011]||"Feed"} ${(0,Bc.Z)(q,k)}`,className:"resource-button",details:`${k[461]||"Requires"} ${Y}x ${(0,Bc.Z)(W,k)}`,ingredientDetails:(0,Yd.gU)({ingredient1:W,ingredient1qty:Y},v),disabled:!U,isValid:U,isTransactionMode:U,transactionKey:U?`pet-feed-${q}-${g.x}-${g.y}`:void 0,onTransactionAction:U?async(e,t)=>{if(U)try{if(!await(0,Kc.dw)({playerId:h.playerId,currentPlayer:h,recipe:{ingredient1:W,ingredient1qty:Y},inventory:h.inventory,backpack:h.backpack,setInventory:l,setBackpack:u,setCurrentPlayer:p,updateStatus:A,masterResources:v}))return void A(`Failed to feed ${(0,Bc.Z)(q,k)}`);const n=(null===f||void 0===f?void 0:f.qtycollected)||1,r=am(v,n,h.playerId);if(!r)return console.error("Failed to generate pet reward"),void A("Something went wrong while feeding the pet");const o=await a.A.post(`${s.A}/api/crafting/start-craft`,{playerId:h.playerId,gridId:y,stationX:g.x,stationY:g.y,recipe:{type:r.type,crafttime:K},qty:r.quantity,rarity:r.rarity,transactionId:e,transactionKey:t});if(o.data.success){const{craftEnd:e,craftedItem:t,inventory:n,backpack:a}=o.data;n&&(l(n),p((e=>({...e,inventory:n})))),a&&(u(a),p((e=>({...e,backpack:a}))));const s=zc.default.getResources().map((n=>n.x===g.x&&n.y===g.y?{...n,craftEnd:e,craftedItem:t,qty:r.quantity,rarity:r.rarity}:n));zc.default.setResources(s),m(s),_(t),L(r.quantity),$(r.rarity),R(Math.max(0,Math.floor((e-Date.now())/1e3))),E(!0),j(!0),O(!1),await(0,Kc.CP)(h.playerId,p);const i=`Fed ${(0,Bc.Z)(q,k)} ${Y}x ${(0,Bc.Z)(W,k)}`;Lc.A.addFloatingText(i,g.x,g.y,w),A(`${(0,Bc.Z)(q,k)}${k[8014]||" is searching for treasures..."}`),await(0,Uc.D)(h,"Feed",q,1,p)}}catch(n){console.error("Error in pet feeding process:",n),A(`Failed to feed ${(0,Bc.Z)(q,k)}`)}else A(`You need ${Y}x ${(0,Bc.Z)(W,k)} to feed ${(0,Bc.Z)(q,k)}`)}:void 0,hideInfo:!0})]}),(C||S)&&(0,d.jsxs)("div",{className:"pet-panel-footer",children:[(0,d.jsx)("hr",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-success",onAction:async(e,t)=>{await wp({currentPlayer:h,setInventory:l,setBackpack:u,setCurrentPlayer:p,setResources:m,stationType:(null===f||void 0===f?void 0:f.type)||q,currentStationPosition:g,gridId:y,TILE_SIZE:w,updateStatus:A,onClose:o,devOnly:!C})},transactionKey:`sell-refund-${q}-${g.x}-${g.y}-${y}`,children:k[425]||"Sell for refund"})})]})]})})},im=t.memo(sm),lm=e=>{var n;let{onClose:o,inventory:i,setInventory:l,backpack:c,setBackpack:u,currentPlayer:h,setCurrentPlayer:p,setResources:m,stationType:f,currentStationPosition:g,gridId:y,TILE_SIZE:v,updateStatus:b,masterResources:x,isDeveloper:w}=e;const S="homestead"===(null===h||void 0===h||null===(n=h.location)||void 0===n?void 0:n.gtype),[T,C]=(0,t.useState)(null),[k,A]=(0,t.useState)(null),I=(0,r.k)();console.log("Inside Animal Stall:",{stationType:f,currentStationPosition:g}),(0,t.useEffect)((()=>{const e=x.find((e=>e.type===f));C(e)}),[f,x]),(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];l(e);const t=(await a.A.get(`${s.A}/api/inventory/${h.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(l(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[h]);return(0,d.jsx)(Zc,{onClose:o,descriptionKey:"1011",titleKey:"1111",panelName:"AnimalStall",children:(0,d.jsxs)("div",{className:"animalstall-panel-container",children:[(0,d.jsx)("div",{className:"animalstall-panel-content",children:(0,d.jsxs)("h2",{children:[(null===T||void 0===T?void 0:T.symbol)||"\ud83d\uded6"," ",f]})}),("homestead"===h.location.gtype||w)&&(0,d.jsxs)("div",{className:"animalstall-panel-footer",children:[(0,d.jsx)("hr",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-success",onAction:async(e,t)=>{await wp({currentPlayer:h,setInventory:l,setBackpack:u,setCurrentPlayer:p,setResources:m,stationType:f,currentStationPosition:g,gridId:y,TILE_SIZE:v,updateStatus:b,onClose:o,devOnly:!S})},transactionKey:`sell-refund-${f}-${g.x}-${g.y}-${y}`,children:I[425]})})]})]})})},cm=t.memo(lm),dm=e=>{let{onClose:n,inventory:o,setInventory:i,backpack:l,setBackpack:c,currentPlayer:u,setCurrentPlayer:h,setResources:p,stationType:m,currentStationPosition:f,gridId:g,currentResource:y,TILE_SIZE:v,updateStatus:b,masterResources:x,globalTuning:w}=e;const[S,T]=(0,t.useState)(!1),[C,k]=(0,t.useState)(null),[A,I]=(0,t.useState)(Date.now()),E=(0,r.k)();console.log("--------Inside Crop Panel:",{stationType:m,currentStationPosition:f,currentResource:y}),(0,t.useEffect)((()=>{const e=x.find((e=>e.type===m));k(e)}),[m,x]),(0,t.useEffect)((()=>{const e=setInterval((()=>{I(Date.now())}),1e3);return()=>clearInterval(e)}),[]);(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];i(e);const t=(await a.A.get(`${s.A}/api/inventory/${u.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(i(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[u]);return(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1030",titleKey:"1130",panelName:"CropPanel",children:(0,d.jsxs)("div",{className:"standard-panel",children:[(0,d.jsxs)("h2",{children:[(null===C||void 0===C?void 0:C.symbol)||"\ud83c\udf31"," ",m]}),(0,d.jsx)("p",{children:(()=>{if(!y||!y.growEnd)return"Unknown status";const e=Math.max(0,y.growEnd-A);if(e<=0)return"Ready for harvest!";const t=Math.floor(e/864e5),n=Math.floor(e%864e5/36e5),r=Math.floor(e%36e5/6e4),o=Math.floor(e%6e4/1e3),a=[];return t>0&&a.push(`${t}d`),n>0&&a.push(`${n}h`),r>0&&a.push(`${r}m`),(o>0||0===a.length)&&a.push(`${o}s`),`${a.join(" ")} remaining`})()}),(0,d.jsx)("hr",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{if(!S){T(!0),setTimeout((()=>{T(!1)}),2e3);try{await(0,Gc.mQ)(g,{type:null,x:f.x,y:f.y},p,!0),p((e=>e.filter((e=>!(e.x===f.x&&e.y===f.y))))),console.log(`Removed ${m} successfully (no refund).`),b(439),n()}catch(e){console.error("Error removing the crop:",e)}}},disabled:S,children:E[438]})})]})})},um=t.memo(dm),hm=e=>{var n;let{onClose:o,inventory:i,setInventory:l,backpack:c,setBackpack:u,currentPlayer:h,setCurrentPlayer:p,setResources:m,stationType:f,currentStationPosition:g,gridId:y,TILE_SIZE:v,updateStatus:b,masterResources:x,isDeveloper:w}=e;const[S,T]=(0,t.useState)(null),C="homestead"===(null===h||void 0===h||null===(n=h.location)||void 0===n?void 0:n.gtype),k=(0,r.k)();console.log("Inside Deco Panel:",{stationType:f,currentStationPosition:g}),(0,t.useEffect)((()=>{const e=x.find((e=>e.type===f&&(C||!1!==e.passable)));T(e)}),[f,x,C]),(0,t.useEffect)((()=>{(async()=>{try{const e=JSON.parse(localStorage.getItem("inventory"))||[];l(e);const t=(await a.A.get(`${s.A}/api/inventory/${h.playerId}`)).data.inventory||[];JSON.stringify(e)!==JSON.stringify(t)&&(l(t),localStorage.setItem("inventory",JSON.stringify(t)))}catch(e){console.error("Error syncing inventory:",e)}})()}),[h]);return(0,d.jsx)(Zc,{onClose:o,titleKey:"1128",panelName:"DecoPanel",children:(0,d.jsxs)("div",{className:"deco-panel-container",children:[(0,d.jsx)("div",{className:"deco-panel-content",children:(0,d.jsxs)("h2",{children:[(null===S||void 0===S?void 0:S.symbol)||"\ud83d\uded6"," ",(0,Bc.Z)(f,k)]})}),("homestead"===h.location.gtype||w)&&(0,d.jsxs)("div",{className:"deco-panel-footer",children:[(0,d.jsx)("hr",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-success",onAction:async(e,t)=>{await wp({currentPlayer:h,setInventory:l,setBackpack:u,setCurrentPlayer:p,setResources:m,stationType:f,currentStationPosition:g,gridId:y,TILE_SIZE:v,updateStatus:b,onClose:o,devOnly:!C})},transactionKey:`sell-refund-${f}-${g.x}-${g.y}-${y}`,children:k[425]})})]})]})})},pm=t.memo(hm),mm=e=>{let{isOpen:n,onClose:o,inventory:a,resourceData:s,amounts:i,handleAmountChange:l,handleAddToSlot:c,getSlotConfig:u,selectedSlotIndex:h,transactionKeyPrefix:p="add-to-trade-slot",isRequestMode:m=!1,playerMoney:f=0}=e;const g=(0,r.k)(),[y,v]=(0,t.useState)("name"),[b,x]=(0,t.useState)("asc"),w=(0,t.useMemo)((()=>a.filter((e=>"Money"!==e.type&&"Gem"!==e.type)).sort(((e,t)=>{let n,r;switch(y){case"name":n=(0,Bc.Z)(e.type,g).toLowerCase(),r=(0,Bc.Z)(t.type,g).toLowerCase();break;case"quantity":n=e.quantity,r=t.quantity;break;case"price":const o=s.find((t=>t.type===e.type)),a=s.find((e=>e.type===t.type));n=(null===o||void 0===o?void 0:o.maxprice)||0,r=(null===a||void 0===a?void 0:a.maxprice)||0;break;case"amount":n=i[e.type]||0,r=i[t.type]||0;break;default:return 0}return n<r?"asc"===b?-1:1:n>r?"asc"===b?1:-1:0}))),[a,s,i,g,y,b]),S=e=>{y===e?x("asc"===b?"desc":"asc"):(v(e),x("asc"))},T=e=>y!==e?"\u2195\ufe0f":"asc"===b?"\u2b06\ufe0f":"\u2b07\ufe0f";if(!n)return null;const C=u(h);return(0,d.jsxs)("div",{className:"inventory-modal wider",children:[(0,d.jsx)("button",{className:"close-button",onClick:o,children:"\u2716"}),(0,d.jsx)("h2",{children:m?g[10180]:g[160]}),(0,d.jsxs)("p",{className:"trading-modal-subtitle",children:[C.maxAmount," ",m?g[10181]:g[158]]}),(0,d.jsxs)("div",{className:"inventory-modal-container",children:[(0,d.jsx)("div",{className:"inventory-modal-header",children:(0,d.jsx)("table",{children:(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsxs)("th",{onClick:()=>S("name"),className:"sortable-header",children:[g[161]," ",T("name")]}),(0,d.jsxs)("th",{onClick:()=>S("quantity"),className:"sortable-header",children:[g[162]," ",T("quantity")]}),(0,d.jsxs)("th",{onClick:()=>S("price"),className:"sortable-header",children:[g[163]," ",T("price")]}),(0,d.jsxs)("th",{onClick:()=>S("amount"),className:"sortable-header",children:[m?"Amount to Request":g[164]," ",T("amount")]}),(0,d.jsx)("th",{})]})})})}),(0,d.jsx)("div",{className:"inventory-modal-scroll",children:(0,d.jsx)("table",{children:(0,d.jsx)("tbody",{children:w.map((e=>{const t=s.find((t=>t.type===e.type)),n=(null===t||void 0===t?void 0:t.maxprice)||0,r=i[e.type]||0,o=r*n,a=m?Math.floor(f/n):e.quantity,u=Math.min(m?a:e.quantity,C.maxAmount);return(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[null===t||void 0===t?void 0:t.symbol," ",(0,Bc.Z)(e.type,g)]}),(0,d.jsx)("td",{children:e.quantity}),(0,d.jsxs)("td",{children:["\ud83d\udcb0 ",n]}),(0,d.jsx)("td",{children:(0,d.jsxs)("div",{className:"amount-input",children:[(0,d.jsx)("button",{onClick:()=>l(e.type,r-1),disabled:r<=0,children:"-"}),(0,d.jsx)("input",{type:"number",value:r,onChange:t=>l(e.type,parseInt(t.target.value,10)||0)}),(0,d.jsx)("button",{onClick:()=>l(e.type,r+1),disabled:r>=u,children:"+"}),(0,d.jsx)("button",{onClick:()=>l(e.type,u),style:{marginLeft:"4px"},children:g[165]})]})}),(0,d.jsx)("td",{children:(0,d.jsx)(Jc,{className:"add-button",onAction:(t,n)=>c(t,n,e.type),transactionKey:`${p}-${e.type}`,disabled:m?!(r>0&&o<=f):!(r>0&&r<=e.quantity),children:m?"Request":g[166]})})]},e.type)}))})})})]})]})};const fm=function(e){var n;let{isOpen:o,onClose:i,currentPlayer:l,onBuyItem:c,onFulfillRequest:u,masterResources:h,globalTuning:p}=e;const m=(0,r.k)(),[f,g]=(0,t.useState)([]),[y,v]=(0,t.useState)({}),[b,x]=(0,t.useState)({}),[w,S]=(0,t.useState)([]),[T,C]=(0,t.useState)(!1),[k,A]=(0,t.useState)("buy");(0,t.useEffect)((()=>{var e;if(!o||null===l||void 0===l||null===(e=l.location)||void 0===e||!e.s)return;(async()=>{C(!0);try{const e=(await a.A.get(`${s.A}/api/players-in-settlement`,{params:{settlementId:l.location.s}})).data.players||[];g(e);const t=await a.A.get(`${s.A}/api/resources`);S(t.data);const n=e.map((e=>a.A.get(`${s.A}/api/player-trade-stall`,{params:{playerId:e.playerId}}).then((t=>({playerId:e.playerId,tradeStall:t.data.tradeStall||[]}))).catch((t=>({playerId:e.playerId,tradeStall:[]}))))),r=await Promise.all(n),o={};r.forEach((e=>{o[e.playerId]=e.tradeStall})),v(o);const i=e.map((e=>a.A.get(`${s.A}/api/player-trade-stall-requests`,{params:{playerId:e.playerId}}).then((t=>({playerId:e.playerId,tradeStallRequests:t.data.tradeStallRequests||[]}))).catch((()=>({playerId:e.playerId,tradeStallRequests:[]}))))),c=await Promise.all(i),d={};c.forEach((e=>{d[e.playerId]=e.tradeStallRequests})),console.log("[Global Market] Trade request results:",c),console.log("[Global Market] Trade requests data object:",d),x(d)}catch(e){console.error("Error fetching global market data:",e)}finally{C(!1)}})()}),[o,null===l||void 0===l||null===(n=l.location)||void 0===n?void 0:n.s]);const I=e=>{const t=w.find((t=>t.type===e));return(null===t||void 0===t?void 0:t.symbol)||""};if(!o)return null;const E=f.filter((e=>{if(e.playerId===l.playerId)return!1;const t=y[e.playerId];return t&&t.some((e=>(null===e||void 0===e?void 0:e.resource)&&(null===e||void 0===e?void 0:e.amount)>0&&!(null!==e&&void 0!==e&&e.boughtBy)))})).sort(((e,t)=>e.username.localeCompare(t.username))),P=(()=>{console.log("[Global Market] Filtering players with requests..."),console.log("[Global Market] Settlement players:",f),console.log("[Global Market] Player trade requests state:",b),console.log("[Global Market] Current player ID:",l.playerId);const e=f.filter((e=>{if(e.playerId===l.playerId)return console.log(`[Global Market] Excluding current player: ${e.username}`),!1;const t=b[e.playerId];if(console.log(`[Global Market] Player ${e.username} (${e.playerId}) requests:`,t),!t)return console.log("[Global Market]   -> No requests found"),!1;const n=t.some((e=>{const t=(null===e||void 0===e?void 0:e.resource)&&(null===e||void 0===e?void 0:e.amount)>0&&(null===e||void 0===e?void 0:e.moneyCommitted)>0;return null!==e&&void 0!==e&&e.resource&&console.log("[Global Market]   -> Slot:",e,`Active: ${t}`),t}));return console.log(`[Global Market]   -> Has active requests: ${n}`),n}));return console.log("[Global Market] Filtered players with requests:",e),e.sort(((e,t)=>e.username.localeCompare(t.username)))})();return(0,d.jsxs)(Ou,{isOpen:o,onClose:i,title:m[362]||"Global Market",size:"large",className:"global-market-modal",children:[(0,d.jsxs)("div",{className:"global-market-content",children:[(0,d.jsxs)("div",{className:"tab-navigation",children:[(0,d.jsx)("button",{className:"tab-button "+("buy"===k?"active":""),onClick:()=>A("buy"),children:"Buy"}),(0,d.jsx)("button",{className:"tab-button "+("sell"===k?"active":""),onClick:()=>A("sell"),children:"Sell (Player Requests)"})]}),T?(0,d.jsx)("div",{className:"loading-container",children:(0,d.jsx)("div",{className:"loading-text",children:m[98]||"Loading..."})}):"buy"===k?0===E.length?(0,d.jsx)("div",{className:"no-items-container",children:(0,d.jsx)("div",{className:"no-items-text",children:m[363]||"No items currently available for purchase"})}):(0,d.jsx)("div",{className:"players-list",children:E.map((e=>{const t=y[e.playerId]||[],n=t.filter((e=>(null===e||void 0===e?void 0:e.resource)&&(null===e||void 0===e?void 0:e.amount)>0&&!(null!==e&&void 0!==e&&e.boughtBy)));return(0,d.jsxs)("div",{className:"player-row",children:[(0,d.jsxs)("div",{className:"player-info",children:[(0,d.jsxs)("div",{className:"player-username",children:[e.icon&&(0,d.jsx)("span",{className:"player-icon",children:e.icon}),e.username]}),(0,d.jsxs)("div",{className:"player-items-count",children:[n.length," ",m[364]||"items available"]})]}),(0,d.jsx)("div",{className:"player-slots",children:n.map(((n,r)=>{const o=t.findIndex((e=>e===n)),i=n.amount*n.price;return(0,d.jsxs)("div",{className:"slot-item",children:[(0,d.jsx)("div",{className:"slot-info",children:(0,d.jsxs)("div",{className:"slot-item-name",children:[n.amount,"x ",I(n.resource)," ",(0,Bc.Z)(n.resource,m)]})}),(0,d.jsx)("div",{className:"slot-button",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsxs)(Jc,{className:"btn-basic btn-success",transactionKey:`global-market-buy-${e.playerId}-${o}`,onAction:(t,n)=>(async(e,t,n,r)=>{try{await c(e,t,n,r);const o=await a.A.get(`${s.A}/api/player-trade-stall`,{params:{playerId:e}});v((t=>({...t,[e]:o.data.tradeStall||[]})))}catch(o){console.error("Error in global market buy:",o)}})(e.playerId,o,t,n),children:[m[365]||"Buy"," \ud83d\udcb0",i.toLocaleString()]})})})]},o)}))})]},e.playerId)}))}):0===P.length?(0,d.jsx)("div",{className:"no-items-container",children:(0,d.jsx)("div",{className:"no-items-text",children:"No player requests currently available"})}):(0,d.jsx)("div",{className:"players-list",children:P.map((e=>{const t=b[e.playerId]||[],n=t.filter((e=>(null===e||void 0===e?void 0:e.resource)&&(null===e||void 0===e?void 0:e.amount)>0&&(null===e||void 0===e?void 0:e.moneyCommitted)>0));return(0,d.jsxs)("div",{className:"player-row",children:[(0,d.jsxs)("div",{className:"player-info",children:[(0,d.jsxs)("div",{className:"player-username",children:[e.icon&&(0,d.jsx)("span",{className:"player-icon",children:e.icon}),e.username]}),(0,d.jsxs)("div",{className:"player-items-count",children:[n.length," ",m[364]||"requests available"]})]}),(0,d.jsx)("div",{className:"player-slots",children:n.map((n=>{var r;const o=t.findIndex((e=>e===n)),i=null===(r=l.inventory)||void 0===r?void 0:r.find((e=>e.type===n.resource)),c=((null===i||void 0===i?void 0:i.quantity)||0)>=n.amount;return(0,d.jsxs)("div",{className:"slot-item "+(c?"":"unfulfillable"),children:[(0,d.jsx)("div",{className:"slot-info",children:(0,d.jsxs)("div",{className:"slot-item-name",children:[n.amount,"x ",I(n.resource)," ",(0,Bc.Z)(n.resource,m)]})}),(0,d.jsx)("div",{className:"slot-button",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsxs)(Jc,{className:"btn-basic btn-success",transactionKey:`fulfill-request-${e.playerId}-${o}`,onAction:(t,n)=>(async(e,t,n,r)=>{try{await u(e,t,n,r);const o=await a.A.get(`${s.A}/api/player-trade-stall-requests`,{params:{playerId:e}});x((t=>({...t,[e]:o.data.tradeStallRequests||[]})))}catch(o){console.error("Error fulfilling request:",o)}})(e.playerId,o,t,n),disabled:!c,children:[m[167]||"Sell"," \ud83d\udcb0",n.moneyCommitted.toLocaleString()]})})})]},o)}))})]},e.playerId)}))})]}),(0,d.jsx)("div",{className:"global-market-footer",children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{onClick:i,className:"btn-basic btn-neutral",children:m[366]||"Close"})})})]})};const gm=function(e){var n;let{onClose:o,inventory:i,setInventory:l,backpack:c,setBackpack:u,currentPlayer:h,setCurrentPlayer:p,globalTuning:m,setModalContent:f,setIsModalOpen:g,masterResources:y}=e;const v=(0,r.k)(),[b,x]=(0,t.useState)([]),[w,S]=(0,t.useState)([]),[T,C]=(0,t.useState)("sell"),[k,A]=(0,t.useState)(null),[I,E]=(0,t.useState)(null),[P,_]=(0,t.useState)({}),[N,R]=(0,t.useState)({}),[M,j]=(0,t.useState)(0),[D,O]=(0,t.useState)([]),{updateStatus:B}=(0,t.useContext)(vu),[L,F]=(0,t.useState)(!0),[$,G]=(0,t.useState)(!1),z=(null===m||void 0===m?void 0:m.tradeStallSlots)||[],U=(null===m||void 0===m?void 0:m.tradeStallRequests)||[],H=e=>z.find((t=>t.slotIndex===e))||{maxAmount:50,sellWaitTime:3e5,unlocked:0===e,unlockCost:0,requiresGoldPass:!1},q=e=>U.find((t=>t.slotIndex===e))||{maxAmount:10,unlocked:0===e,unlockCost:0,requiresGoldPass:!1},V=e=>{const t=w[e],n=q(e);return!!t&&(void 0===t.locked?!!(t.resource&&t.amount>0)||0===e:!0!==t.locked||!(!n.requiresGoldPass||"Gold"!==h.accountStatus))},W=e=>{const t=b[e],n=H(e);return!!t&&(void 0===t.locked?!!(t.resource&&t.amount>0)||0===e:!0!==t.locked||!(!n.requiresGoldPass||"Gold"!==h.accountStatus))},Y=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e||F(!0);const t=await a.A.get(`${s.A}/api/resources`);if(O(t.data),!e){const e=await a.A.get(`${s.A}/api/inventory/${h.playerId}`);l(e.data.inventory||[])}const n=(await a.A.get(`${s.A}/api/player-trade-stall`,{params:{playerId:h.playerId}})).data.tradeStall||[],r=Array.from({length:6},((e,t)=>{const r=n.find((e=>e&&e.slotIndex===t));return r||{slotIndex:t,locked:!0,resource:null,amount:0,price:0,sellTime:null,boughtBy:null,boughtFor:null}}));x(r);const o=(await a.A.get(`${s.A}/api/player-trade-stall-requests`,{params:{playerId:h.playerId}})).data.tradeStallRequests||[],i=Array.from({length:3},((e,t)=>{const n=o.find((e=>e&&e.slotIndex===t));return n||{slotIndex:t,locked:!0,resource:null,amount:0,price:0,moneyCommitted:0}}));S(i);const c=r.reduce(((e,t)=>null!==t&&void 0!==t&&t.resource&&null!==t&&void 0!==t&&t.amount&&null!==t&&void 0!==t&&t.price&&(null===t||void 0===t||!t.boughtBy)?e+t.amount*t.price:e),0);j(c)}catch(t){console.error("Error fetching TradeStall data:",t)}finally{F(!1)}};(0,t.useEffect)((()=>{Y()}),[null===h||void 0===h?void 0:h.playerId]);const K=async(e,t,n,r)=>{const o=D.find((e=>e.type===n)),c=(null===o||void 0===o?void 0:o.maxprice)||0,d=H(k),u=[...b];u[k]={slotIndex:k,resource:n,amount:r,price:c,sellTime:Date.now()+d.sellWaitTime,boughtBy:null,boughtFor:null};try{await a.A.post(`${s.A}/api/update-player-trade-stall`,{playerId:h.playerId,tradeStall:u}),await a.A.post(`${s.A}/api/update-inventory`,{playerId:h.playerId,inventory:i.map((e=>e.type===n?{...e,quantity:e.quantity-r}:e)).filter((e=>e.quantity>0))}),await(0,Kc.CP)(h.playerId,p);const e=await a.A.get(`${s.A}/api/inventory/${h.playerId}`);l(e.data.inventory),x(u),A(null),X(u)}catch(m){throw console.error("Error adding item to Trade Stall:",m),m}},X=e=>{console.log("Inside calculateTotalSetllValue; Current Inventory:",i);const t=e.reduce(((e,t)=>null!==t&&void 0!==t&&t.amount&&null!==t&&void 0!==t&&t.price?e+t.amount*t.price:e),0);j(t)},Z=e=>{const t=D.find((t=>t.type===e));return(null===t||void 0===t?void 0:t.symbol)||""};return(0,d.jsxs)(Zc,{onClose:o,descriptionKey:"1008",titleKey:"1108",panelName:"TradeStall",children:[(0,d.jsx)("div",{className:"shared-buttons",style:{margin:"2px 0"},children:(0,d.jsxs)("button",{className:"btn-basic btn-success",onClick:()=>G(!0),children:["\ud83c\udf0d ",v[362]||"Global Market"]})}),(0,d.jsx)("div",{style:{margin:"16px 0"}}),(0,d.jsxs)("div",{className:"tab-navigation",children:[(0,d.jsx)("button",{className:"tab-button "+("sell"===T?"active":""),onClick:()=>C("sell"),children:"Sell"}),(0,d.jsx)("button",{className:"tab-button "+("request"===T?"active":""),onClick:()=>C("request"),children:"Request"})]}),L?(0,d.jsx)("div",{style:{textAlign:"center",padding:"40px",fontSize:"1.2rem"},children:v[98]}):(0,d.jsxs)(d.Fragment,{children:["sell"===T&&(0,d.jsx)("div",{className:"trade-stall-slots shared-buttons",children:b.map(((e,n)=>{const r=!(null!==e&&void 0!==e&&e.resource),o=null===e||void 0===e?void 0:e.boughtBy,c=(null===e||void 0===e?void 0:e.sellTime)&&e.sellTime<=Date.now(),u=(null===e||void 0===e?void 0:e.sellTime)&&e.sellTime>Date.now(),m=W(n),f=H(n);return(0,d.jsx)(t.Fragment,{children:(0,d.jsxs)("div",{className:"trade-slot-container",children:[(0,d.jsx)("div",{className:`trade-slot btn-basic ${r&&m?"btn-neutral":""} ${r||o||c?"":"filled"} ${o?"btn-collect":""} ${!m&&n>=4?"locked gold-slot btn-gold":m?"":"locked"} ${c&&!o?"btn-sell":""}`,onClick:()=>{r&&m?(e=>{const t=b[e],n=!(null!==t&&void 0!==t&&t.resource),r=W(e),o=H(e);if(console.log("Slot clicked:",e,"Is unlocked:",r,"Is empty:",n),!r){if(o.requiresGoldPass&&"Gold"!==h.accountStatus)return;if(!o.requiresGoldPass)return}n&&r&&(A(e),_({}))})(n):o?(async(e,t,n)=>{console.log(`\ud83d\udd12 [PROTECTED COLLECTION] Starting protected collection for slot ${n}`);try{const r=await a.A.post(`${s.A}/api/trade-stall/collect-payment`,{playerId:h.playerId,slotIndex:n,transactionId:e,transactionKey:`${t}-${n}`});r.data.success&&(r.data.tradeStall&&x(r.data.tradeStall),r.data.inventory&&(l(r.data.inventory),p((e=>({...e,inventory:r.data.inventory,tradeStall:r.data.tradeStall})))),await(0,Uc.D)(h,"Sell",r.data.resource,r.data.amount,p),B(`\ud83d\udcb0 Collected ${r.data.collected}.`),await Y(!0))}catch(o){var r;console.error("Error in protected collection:",o),429===(null===(r=o.response)||void 0===r?void 0:r.status)?B(471):B("\u274c Failed to collect payment")}})(`collect-${Date.now()}`,"collect-payment",n):c&&!o&&(async(e,t,n)=>{console.log(`\ud83d\udd12 [PROTECTED SELL] Starting protected sell for slot ${n}`);try{const r=await a.A.post(`${s.A}/api/trade-stall/sell-to-game`,{playerId:h.playerId,slotIndex:n,transactionId:e,transactionKey:`${t}-${n}`});r.data.success&&(r.data.tradeStall&&(x(r.data.tradeStall),p((e=>({...e,tradeStall:r.data.tradeStall})))),r.data.inventory&&(l(r.data.inventory),p((e=>({...e,inventory:r.data.inventory})))),await(0,Uc.D)(h,"Sell",r.data.resource,r.data.amount,p),B(`${v[141]} ${r.data.amount}x ${(0,Bc.Z)(r.data.resource,v)} (\ud83d\udcb0 ${r.data.sold}).`),await Y(!0))}catch(o){var r;console.error("Error in protected sell:",o),429===(null===(r=o.response)||void 0===r?void 0:r.status)?B(471):B("\u274c Failed to sell item")}})(`sell-${Date.now()}`,"sell-to-game",n)},children:n>=4&&"Gold"!==h.accountStatus?(0,d.jsxs)("div",{className:"trade-slot-locked",children:[(0,d.jsx)("div",{className:"trade-slot-lock-icon",children:"\ud83d\udd12"}),(0,d.jsx)("div",{className:"trade-slot-lock-text",children:v[171]}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem",marginTop:"4px"},children:[v[173]," ",f.maxAmount]}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem"},children:[mp(f.sellWaitTime/1e3)," ",v[174]]})]}):m?r?(0,d.jsxs)("div",{className:"trade-slot-empty-text",children:[(0,d.jsxs)("div",{children:["\u2795 ",v[156]]}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem",marginTop:"4px"},children:[v[173]," ",f.maxAmount]}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem"},children:[mp(f.sellWaitTime/1e3)," ",v[174]]})]}):(0,d.jsxs)("div",{className:"trade-slot-content",children:[(0,d.jsx)("div",{className:"trade-slot-item-name",children:`${e.amount}x ${Z(e.resource)} ${(0,Bc.Z)(e.resource,v)}`}),o&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"trade-slot-status",children:[v[157]," ",e.boughtBy]}),(0,d.jsxs)("div",{className:"trade-slot-status",children:[v[318]," \ud83d\udcb0",e.boughtFor.toLocaleString()]})]}),u&&!o&&(0,d.jsx)("div",{className:"trade-slot-status timer",children:pp(e.sellTime,Date.now())}),c&&!o&&(0,d.jsxs)("div",{className:"trade-slot-status ready",children:[v[167]," \ud83d\udcb0",(e.amount*e.price).toLocaleString()]})]}):(0,d.jsxs)("div",{className:"trade-slot-locked",children:[(0,d.jsx)("div",{className:"trade-slot-lock-icon",children:"\ud83d\udd12"}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem",marginTop:"4px"},children:[v[173]," ",f.maxAmount]}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem"},children:[mp(f.sellWaitTime/1e3)," ",v[174]]})]})}),n>=4&&"Gold"!==h.accountStatus?(0,d.jsx)("div",{className:"trade-button-container",children:(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",width:"100%"},children:(0,d.jsx)("button",{className:"btn-basic btn-gold",style:{width:"100%"},onClick:()=>Ju(1,h,B),children:v[9061]})})}):m?null:(0,d.jsx)("div",{className:"trade-button-container",children:(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",width:"100%"},children:(0,d.jsxs)("button",{className:"btn-basic btn-neutral",style:{width:"100%"},onClick:()=>(async e=>{const t=H(e);if(t&&!t.requiresGoldPass)try{const n={ingredient1:"Wood",ingredient1qty:t.unlockCost};if(!await(0,Kc.dw)({playerId:h.playerId,recipe:n,inventory:h.inventory||i,backpack:h.backpack||[],setInventory:l,setBackpack:()=>{},setCurrentPlayer:p,updateStatus:B}))return console.warn("Not enough Wood to unlock this slot."),void B(`${v[177]} ${t.unlockCost} ${Z("Wood")} ${v[176]} ${v[178]}`);const r=b.map(((t,n)=>n===e?{...t,locked:!1}:t));await a.A.post(`${s.A}/api/update-player-trade-stall`,{playerId:h.playerId,tradeStall:r}),x(r),p({...h,tradeStall:r}),await(0,Kc.CP)(h.playerId,p),await Y(!0),B(`${v[170]}`)}catch(n){console.error("Error unlocking slot:",n),B("Failed to unlock slot")}})(n),children:[v[175]," ",f.unlockCost," ",Z("Wood")," ",v[176]]})})})]})},n)}))}),"request"===T&&(0,d.jsx)("div",{className:"trade-stall-slots shared-buttons",children:w.map(((e,n)=>{const r=!(null!==e&&void 0!==e&&e.resource),o=V(n),c=q(n);return(0,d.jsx)(t.Fragment,{children:(0,d.jsxs)("div",{className:"trade-slot-container",children:[(0,d.jsx)("div",{className:`trade-slot btn-basic ${r&&o?"btn-neutral":""} ${r?"":"filled"} ${!o&&c.requiresGoldPass?"locked gold-slot btn-gold":o?"":"locked"}`,onClick:()=>{r&&o&&(e=>{const t=w[e],n=!(null!==t&&void 0!==t&&t.resource),r=V(e);n&&r&&(E(e),R({}))})(n)},children:c.requiresGoldPass&&"Gold"!==h.accountStatus?(0,d.jsxs)("div",{className:"trade-slot-locked",children:[(0,d.jsx)("div",{className:"trade-slot-lock-icon",children:"\ud83d\udd12"}),(0,d.jsx)("div",{className:"trade-slot-lock-text",children:v[171]}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem",marginTop:"4px"},children:[v[173]," ",c.maxAmount]})]}):o?r?(0,d.jsxs)("div",{className:"trade-slot-empty-text",children:[(0,d.jsx)("div",{children:"\u2795 Add Request"}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem",marginTop:"4px"},children:[v[173]," ",c.maxAmount]})]}):(0,d.jsxs)("div",{className:"trade-slot-content",children:[(0,d.jsx)("div",{className:"trade-slot-item-name",children:`${e.amount}x ${Z(e.resource)} ${(0,Bc.Z)(e.resource,v)}`}),(0,d.jsxs)("div",{className:"trade-slot-status",children:["You Pay: \ud83d\udcb0",e.moneyCommitted.toLocaleString()]})]}):(0,d.jsxs)("div",{className:"trade-slot-locked",children:[(0,d.jsx)("div",{className:"trade-slot-lock-icon",children:"\ud83d\udd12"}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem",marginTop:"4px"},children:[v[173]," ",c.maxAmount]})]})}),c.requiresGoldPass&&"Gold"!==h.accountStatus?(0,d.jsx)("div",{className:"trade-button-container",children:(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",width:"100%"},children:(0,d.jsx)("button",{className:"btn-basic btn-gold",style:{width:"100%"},onClick:()=>Ju(1,h,B),children:v[9061]})})}):o?r?null:(0,d.jsx)("div",{className:"trade-button-container",children:(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",width:"100%"},children:(0,d.jsx)(Jc,{className:"btn-basic btn-danger",style:{width:"100%"},transactionKey:`cancel-request-${n}`,onAction:(e,t)=>(async(e,t,n)=>{const r=w[n];if(null!==r&&void 0!==r&&r.resource&&null!==r&&void 0!==r&&r.moneyCommitted)try{await(0,Kc.qf)({playerId:h.playerId,currentPlayer:h,resource:"Money",quantity:r.moneyCommitted,inventory:h.inventory||i,backpack:h.backpack||[],setInventory:l,setBackpack:()=>{},setCurrentPlayer:p,updateStatus:B,masterResources:y,globalTuning:m});const e=[...w];e[n]={slotIndex:n,locked:r.locked,resource:null,amount:0,price:0,moneyCommitted:0},await a.A.post(`${s.A}/api/update-player-trade-stall-requests`,{playerId:h.playerId,tradeStallRequests:e}),await(0,Kc.CP)(h.playerId,p);const t=await a.A.get(`${s.A}/api/inventory/${h.playerId}`);l(t.data.inventory),S(e),B(`Request canceled. Refunded \ud83d\udcb0${r.moneyCommitted}`)}catch(c){var o;console.error("Error canceling request:",c),429===(null===(o=c.response)||void 0===o?void 0:o.status)?B(471):B("\u274c Failed to cancel request")}else console.warn("No request to cancel in this slot.")})(0,0,n),children:"Cancel Request"})})}):(0,d.jsx)("div",{className:"trade-button-container",children:(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",width:"100%"},children:(0,d.jsxs)("button",{className:"btn-basic btn-neutral",style:{width:"100%"},onClick:()=>(async e=>{const t=q(e);if(t&&!t.requiresGoldPass)try{const n={ingredient1:"Wood",ingredient1qty:t.unlockCost};if(!await(0,Kc.dw)({playerId:h.playerId,recipe:n,inventory:h.inventory||i,backpack:h.backpack||[],setInventory:l,setBackpack:()=>{},setCurrentPlayer:p,updateStatus:B}))return console.warn("Not enough Wood to unlock this request slot."),void B(`${v[177]} ${t.unlockCost} ${Z("Wood")} ${v[176]} ${v[178]}`);const r=w.map(((t,n)=>n===e?{...t,locked:!1}:t));await a.A.post(`${s.A}/api/update-player-trade-stall-requests`,{playerId:h.playerId,tradeStallRequests:r}),S(r),p({...h,tradeStallRequests:r}),await(0,Kc.CP)(h.playerId,p),await Y(!0),B(`${v[170]}`)}catch(n){console.error("Error unlocking request slot:",n),B("Failed to unlock slot")}})(n),children:[v[175]," ",c.unlockCost," ",Z("Wood")," ",v[176]]})})})]})},n)}))})]}),(0,d.jsx)(mm,{isOpen:null!==k,onClose:()=>A(null),inventory:i,resourceData:D,amounts:P,handleAmountChange:(e,t)=>{const n=i.find((t=>t.type===e)),r=n?n.quantity:0,o=H(k),a=Math.min(r,o.maxAmount);_((n=>({...n,[e]:Math.min(Math.max(0,t),a)})))},handleAddToSlot:async(e,t,n)=>{let r=P[n]||0;const o=i.find((e=>e.type===n));if(null===k||r<=0||!o||r>o.quantity)return void console.warn("Invalid amount or resource exceeds available quantity.");const a=H(k);if(r>a.maxAmount&&(r=a.maxAmount,console.log(`Amount adjusted to slot limit: ${r} (max: ${a.maxAmount})`)),r===o.quantity&&(0,Yd.AQ)(n,y)){const o=y.find((e=>e.output===n&&"farmplot"===e.category));if(o&&o.ingredient1qty>0)return f({title:"\u26a0\ufe0f Warning",message:`This will leave you with 0 ${n}, so you will not be able to plant ${n} again.`,message2:"Are you sure?",size:"small",onClose:()=>g(!1),children:(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"10px",justifyContent:"center",marginTop:"10px"},children:[(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:()=>g(!1),children:"Cancel"}),(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{g(!1);const o=H(k),a=Math.min(r,o.maxAmount);await K(e,t,n,a)},children:v[168]})]})}),void g(!0)}await K(e,t,n,r)},getSlotConfig:H,selectedSlotIndex:k,transactionKeyPrefix:"add-to-trade-slot"}),(0,d.jsx)(mm,{isOpen:null!==I,onClose:()=>E(null),inventory:D.filter((e=>"doober"===e.category)).map((e=>{var t,n,r,o;const a=((null===(t=h.inventory)||void 0===t||null===(n=t.find((t=>t.type===e.type)))||void 0===n?void 0:n.quantity)||0)+((null===(r=h.backpack)||void 0===r||null===(o=r.find((t=>t.type===e.type)))||void 0===o?void 0:o.quantity)||0);return{type:e.type,quantity:a}})),resourceData:D,amounts:N,handleAmountChange:(e,t)=>{const n=q(I).maxAmount;R((r=>({...r,[e]:Math.min(Math.max(0,t),n)})))},handleAddToSlot:async(e,t,n)=>{var r;const o=N[n]||0;if(null===I||o<=0)return void console.warn("Invalid amount for request.");const c=D.find((e=>e.type===n)),d=(null===c||void 0===c?void 0:c.maxprice)||0,u=o*d;if(u>((null===(r=i.find((e=>"Money"===e.type)))||void 0===r?void 0:r.quantity)||0))return void B("You don't have enough money");const m={ingredient1:"Money",ingredient1qty:u};if(!await(0,Kc.dw)({playerId:h.playerId,recipe:m,inventory:h.inventory||i,backpack:h.backpack||[],setInventory:l,setBackpack:()=>{},setCurrentPlayer:p,updateStatus:B}))return console.warn("Not enough Money to create request."),void B("You don't have enough money");const f=[...w];f[I]={slotIndex:I,resource:n,amount:o,price:d,moneyCommitted:u};try{await a.A.post(`${s.A}/api/update-player-trade-stall-requests`,{playerId:h.playerId,tradeStallRequests:f}),await(0,Kc.CP)(h.playerId,p);const e=await a.A.get(`${s.A}/api/inventory/${h.playerId}`);l(e.data.inventory),S(f),E(null),B(`Request posted for ${o}x ${(0,Bc.Z)(n,v)}`)}catch(g){throw console.error("Error creating request:",g),g}},getSlotConfig:q,selectedSlotIndex:I,transactionKeyPrefix:"create-request",isRequestMode:!0,playerMoney:(null===(n=i.find((e=>"Money"===e.type)))||void 0===n?void 0:n.quantity)||0}),(0,d.jsx)(fm,{isOpen:$,onClose:()=>G(!1),currentPlayer:h,onBuyItem:async(e,t,n,r)=>{try{var o;const n=(await a.A.get(`${s.A}/api/player-trade-stall`,{params:{playerId:e}})).data.tradeStall||[],r=n[t];if(!r||r.boughtBy)return void B(155);const d=r.amount*r.price;if(d>((null===(o=i.find((e=>"Money"===e.type)))||void 0===o?void 0:o.quantity)||0))return console.warn("Not enough money to complete the purchase."),void B(152);const u={ingredient1:"Money",ingredient1qty:d};if(!await(0,Kc.dw)({playerId:h.playerId,recipe:u,inventory:h.inventory||i,backpack:h.backpack||[],setInventory:l,setBackpack:()=>{},setCurrentPlayer:p,updateStatus:B}))return void console.warn("Not enough Money to buy this item.");const f=await(0,Kc.qf)({playerId:h.playerId,currentPlayer:h,resource:r.resource,quantity:r.amount,inventory:h.inventory||i,backpack:h.backpack||[],setInventory:l,setBackpack:()=>{},setCurrentPlayer:p,updateStatus:B,masterResources:y,globalTuning:m});var c;if(f&&!1===f.success)return console.warn("Failed to add items to inventory:",null===(c=f.error)||void 0===c?void 0:c.message),void await(0,Kc.qf)({playerId:h.playerId,currentPlayer:h,resource:"Money",quantity:d,inventory:h.inventory||i,backpack:h.backpack||[],setInventory:l,setBackpack:()=>{},setCurrentPlayer:p,updateStatus:()=>{},masterResources:y,globalTuning:m});const g=[...n];g[t]={...r,sellTime:null,boughtBy:h.username,boughtFor:d},await a.A.post(`${s.A}/api/update-player-trade-stall`,{playerId:e,tradeStall:g}),B(22)}catch(d){throw console.error("Error processing global market purchase:",d),d}},onFulfillRequest:async(e,t,n,r)=>{try{const o=await a.A.post(`${s.A}/api/trade-stall/fulfill-request`,{sellerPlayerId:h.playerId,buyerPlayerId:e,slotIndex:t,transactionId:n,transactionKey:`${r}-${t}`});o.data.success&&(l(o.data.sellerInventory),p((e=>({...e,inventory:o.data.sellerInventory}))),B(`Sold ${o.data.amount}x ${(0,Bc.Z)(o.data.resource,v)} for \ud83d\udcb0${o.data.earned}`))}catch(i){var o;throw console.error("Error fulfilling request:",i),400===(null===(o=i.response)||void 0===o?void 0:o.status)?B(i.response.data.error||"Failed to fulfill request"):B("\u274c Failed to fulfill request"),i}},masterResources:y,globalTuning:m})]})};function ym(e){let{onClose:n,backpack:o,setBackpack:i,currentPlayer:l,setCurrentPlayer:c,gridId:u,setModalContent:h,setIsModalOpen:p,isDeveloper:m,stationType:f,currentStationPosition:g,setResources:y,setInventory:v,TILE_SIZE:b,globalTuning:x}=e;const w=(0,r.k)(),[S,T]=(0,t.useState)([]),[C,k]=(0,t.useState)(null),[A,I]=(0,t.useState)({}),[E,P]=(0,t.useState)([]),{updateStatus:_}=(0,t.useContext)(vu),[N,R]=(0,t.useState)([]),[M,j]=(0,t.useState)(!0),[D,O]=(0,t.useState)(Date.now()),[B,L]=(0,t.useState)(!1),[F,$]=(0,t.useState)({}),G=e=>{var t;return(null===x||void 0===x||null===(t=x.tradeStallSlots)||void 0===t?void 0:t.find((t=>t.slotIndex===e)))||{maxAmount:50,sellWaitTime:3e5}};(0,t.useEffect)((()=>{const e=[];for(let t=0;t<4;t++)e.push({slotIndex:t,resource:null,amount:0,price:0,sellTime:null,boughtBy:null,boughtFor:null,sellerUsername:null,sellerId:null});T(e)}),[]),(0,t.useEffect)((()=>{(async()=>{j(!0);try{const e=await a.A.get(`${s.A}/api/resources`);P(e.data),R(e.data);const t=await a.A.get(`${s.A}/api/load-grid/${u}`);t.data.outpostTradeStall&&Array.isArray(t.data.outpostTradeStall)&&T(t.data.outpostTradeStall)}catch(e){console.error("Error fetching Outpost data:",e),_("Failed to load Outpost data")}finally{j(!1)}})()}),[u]),(0,t.useEffect)((()=>{const e=setInterval((()=>{O(Date.now())}),1e3);return()=>clearInterval(e)}),[]);const z=e=>{const t=E.find((t=>t.type===e));return(null===t||void 0===t?void 0:t.symbol)||""},U=async(e,t,n,r)=>{const d=E.find((e=>e.type===n)),h=(null===d||void 0===d?void 0:d.minprice)||0,p=G(C);try{const d=await a.A.post(`${s.A}/api/outpost/add-item`,{gridId:u,slotIndex:C,resource:n,amount:r,price:h,sellTime:Date.now()+p.sellWaitTime,sellerUsername:l.username,sellerId:l.playerId,transactionId:e,transactionKey:t});if(d.data.success){T(d.data.outpostTradeStall);const e=o.map((e=>e.type===n?{...e,quantity:e.quantity-r}:e)).filter((e=>e.quantity>0));i(e),c((t=>({...t,backpack:e}))),k(null),_(`Added ${r}x ${n} to Outpost`)}}catch(m){throw console.error("Error adding item to Outpost:",m),_("Failed to add item to Outpost"),m}},H=(null===l||void 0===l?void 0:l.inventory)||[],q=(0,Kc.O_)(l,N,x),V=e=>e.filter((e=>!(0,Kc.sy)(e.type))).reduce(((e,t)=>e+t.quantity),0),W=(e,t,n,r,o)=>{const a=Math.min(Math.max(0,r),o);t((e=>({...e,[n]:a})))},Y=async()=>{try{const e=o.filter((e=>{const t=N.find((t=>t.type===e.type));return"special"!==(null===t||void 0===t?void 0:t.category)})),t=e.reduce(((e,t)=>e+t.quantity),0),n=V(H);if(t>q.warehouse-n)return void _(20);const r=[...H];e.forEach((e=>{const t=r.findIndex((t=>t.type===e.type));-1!==t?r[t].quantity+=e.quantity:r.push(e)}));const d=o.filter((e=>{const t=N.find((t=>t.type===e.type));return"special"===(null===t||void 0===t?void 0:t.category)}));await a.A.post(`${s.A}/api/update-inventory`,{playerId:l.playerId,inventory:r,backpack:d}),c({...l,inventory:r,backpack:d}),v(r),i(d),_("\ud83d\udce6 Sent all items to warehouse"),L(!1)}catch(e){console.error("Error sending all items home:",e),_("Failed to send items home")}};return M?(0,d.jsx)(Zc,{onClose:n,descriptionKey:"1008",titleKey:"1141",panelName:"OutpostPanel",children:(0,d.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[w[98]," "]})}):(0,d.jsxs)(Zc,{onClose:n,descriptionKey:"1008",titleKey:"1141",panelName:"OutpostPanel",children:[o&&o.filter((e=>!(0,Kc.sy)(e.type))).length>0&&(0,d.jsx)("div",{className:"shared-buttons",style:{marginBottom:"10px"},children:(0,d.jsxs)("button",{className:"btn-basic btn-success",onClick:()=>{$({}),L(!0)},title:w[369]||"Send items from your backpack directly to your warehouse at home.",children:["\ud83c\udfe0 ",w[368]||"Send Goods Home"]})}),(0,d.jsx)("br",{}),(0,d.jsx)("hr",{className:"inventory-divider"}),(0,d.jsx)("h2",{children:null===w||void 0===w?void 0:w[1108]}),(0,d.jsxs)("div",{className:"outpost-header",children:[" ",null===w||void 0===w?void 0:w[179]," "]}),(0,d.jsx)("div",{className:"trade-stall-slots shared-buttons",children:S.slice(0,4).map(((e,t)=>{const n=!(null!==e&&void 0!==e&&e.resource),r=null===e||void 0===e?void 0:e.boughtBy,o=(null===e||void 0===e?void 0:e.sellerId)===l.playerId,i=(null===e||void 0===e?void 0:e.sellTime)&&e.sellTime<=D&&o,h=(null===e||void 0===e?void 0:e.sellTime)&&e.sellTime>D;return(0,d.jsxs)("div",{className:"trade-slot-container",children:[(0,d.jsx)("div",{className:`trade-slot btn-basic ${n?"btn-neutral":""} ${n||r||i?"":"filled"} ${r&&o?"btn-collect":""} ${i&&o?"btn-sell":""}`,onClick:()=>{n?(e=>{const t=S[e];(null===t||void 0===t||!t.resource)&&(k(e),I({}))})(t):r&&o?(async(e,t,n)=>{const r=S[n];if(r&&r.sellerId===l.playerId&&r.boughtBy)try{const o=await a.A.post(`${s.A}/api/outpost/collect-payment`,{gridId:u,slotIndex:n,playerId:l.playerId,transactionId:e,transactionKey:t});o.data.success&&(T(o.data.outpostTradeStall),o.data.inventory&&c((e=>({...e,inventory:o.data.inventory}))),_(`\ud83d\udcb0 Collected ${r.boughtFor}.`))}catch(o){throw console.error("Error collecting payment:",o),_("Failed to collect payment"),o}})(`collect-${Date.now()}`,"collect-payment",t):i&&o&&(async(e,t,n)=>{const r=S[n];if(r&&r.resource&&r.sellerId===l.playerId)try{const r=await a.A.post(`${s.A}/api/outpost/sell-to-game`,{gridId:u,slotIndex:n,playerId:l.playerId,transactionId:e,transactionKey:t});r.data.success&&(T(r.data.outpostTradeStall),r.data.inventory&&c((e=>({...e,inventory:r.data.inventory}))),_(`\ud83d\udcb0 Sold ${r.data.amount}x ${r.data.resource} for ${r.data.sold}.`))}catch(o){throw console.error("Error selling to game:",o),_("Failed to sell item"),o}})(`sell-${Date.now()}`,"sell-to-game",t)},children:n?(0,d.jsxs)("div",{className:"trade-slot-empty-text",children:[(0,d.jsxs)("div",{children:["\u2795 ",w[156]]}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem",marginTop:"4px"},children:[w[173]," ",G(t).maxAmount]}),(0,d.jsxs)("div",{style:{fontSize:"0.8rem"},children:[mp(G(t).sellWaitTime/1e3)," ",w[174]]})]}):(0,d.jsxs)("div",{className:"trade-slot-content",children:[(0,d.jsx)("div",{className:"trade-slot-item-name",children:`${e.amount}x ${z(e.resource)} ${(0,Bc.Z)(e.resource,w)}`}),e.sellerUsername&&(0,d.jsx)("div",{style:{fontSize:"0.75rem",color:"#666"},children:e.sellerUsername}),r&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"trade-slot-status",children:[w[157]," ",e.boughtBy]}),o&&(0,d.jsxs)("div",{className:"trade-slot-status",children:[w[318]," \ud83d\udcb0",e.boughtFor]})]}),h&&!r&&(0,d.jsx)("div",{className:"trade-slot-status timer",children:pp(e.sellTime,D)}),i&&!r&&(0,d.jsxs)("div",{className:"trade-slot-status ready",children:[w[167]," \ud83d\udcb0",e.amount*e.price]})]})}),!n&&!o&&!r&&(0,d.jsx)("div",{className:"trade-button-container",children:(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",width:"100%"},children:(0,d.jsxs)(Jc,{className:"btn-basic btn-success",style:{width:"100%"},onAction:(e,n)=>(async(e,t,n)=>{var r,o;const i=S[n];if(!i||!i.resource||i.boughtBy)return;const d=i.amount*i.price;if(d>((null===(r=l.inventory)||void 0===r||null===(o=r.find((e=>"Money"===e.type)))||void 0===o?void 0:o.quantity)||0))_(152);else try{const r=await a.A.post(`${s.A}/api/outpost/buy-item`,{gridId:u,slotIndex:n,buyerId:l.playerId,buyerUsername:l.username,transactionId:e,transactionKey:t});r.data.success&&(T(r.data.outpostTradeStall),r.data.inventory&&c((e=>({...e,inventory:r.data.inventory}))),_(`Bought ${i.amount}x ${i.resource} for ${d}`))}catch(h){throw console.error("Error buying from Outpost:",h),_("Failed to buy item"),h}})(e,n,t),transactionKey:`outpost-buy-${t}`,children:["Buy \ud83d\udcb0",e.amount*e.price]})})})]},t)}))}),(0,d.jsx)(mm,{isOpen:null!==C,onClose:()=>k(null),inventory:o||[],resourceData:E,amounts:A,handleAmountChange:(e,t)=>{const n=o.find((t=>t.type===e)),r=n?n.quantity:0,a=G(C),s=Math.min(r,a.maxAmount);I((n=>({...n,[e]:Math.min(Math.max(0,t),s)})))},handleAddToSlot:async(e,t,n)=>{let r=A[n]||0;const a=o.find((e=>e.type===n));if(null===C||r<=0||!a||r>a.quantity)return void console.warn("Invalid amount or resource exceeds available quantity.");const s=G(C);if(r>s.maxAmount&&(r=s.maxAmount,console.log(`Amount adjusted to slot limit: ${r} (max: ${s.maxAmount})`)),r===a.quantity&&(0,Yd.AQ)(n,N)){const o=N.find((e=>e.output===n&&"farmplot"===e.category));if(o&&o.ingredient1qty>0)return h({title:"\u26a0\ufe0f Warning",message:`This will leave you with 0 ${n}, so you will not be able to plant ${n} again.`,message2:"Are you sure?",size:"small",onClose:()=>p(!1),children:(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"10px",justifyContent:"center",marginTop:"10px"},children:[(0,d.jsx)("button",{className:"btn-basic btn-neutral",onClick:()=>p(!1),children:"Cancel"}),(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:()=>{p(!1),U(e,t,n,r)},children:"Proceed"})]})}),void p(!0)}await U(e,t,n,r)},getSlotConfig:G,selectedSlotIndex:C,transactionKeyPrefix:"outpost-add"}),B&&(()=>{const e=o.filter((e=>{const t=N.find((t=>t.type===e.type));return"special"!==(null===t||void 0===t?void 0:t.category)})),t=0===o.length||0===e.length;return(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container modal-large",children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:()=>L(!1),children:"\xd7"}),(0,d.jsxs)("div",{className:"modal-title",children:["\ud83c\udfe0 ",w[368]||"Send Goods Home"]}),(0,d.jsx)("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"10px",textAlign:"center"},children:w[369]||"Send items from your backpack directly to your warehouse at home."}),(0,d.jsx)(Ch,{inventory:o,masterResources:N,showActions:!0,warehouseAmounts:F,setWarehouseAmounts:$,handleAmountChange:W,handleDiscardWarehouseItem:e=>{const t=N.find((t=>t.type===e.type));!("special"===(null===t||void 0===t?void 0:t.category))&&F[e.type]>0&&F[e.type]<=e.quantity&&(async e=>{const t=F[e.type]||0;if(!(t<=0))try{const n=V(H),r=q.warehouse-n;if(t>r)return void _(20);const d=[...H],u=d.findIndex((t=>t.type===e.type));-1!==u?d[u].quantity+=t:d.push({...e,quantity:t});const h=o.map((n=>{if(n.type===e.type){const e=n.quantity-t;return e>0?{...n,quantity:e}:null}return n})).filter(Boolean);await a.A.post(`${s.A}/api/update-inventory`,{playerId:l.playerId,inventory:d,backpack:h}),c({...l,inventory:d,backpack:h}),v(d),i(h),$((t=>({...t,[e.type]:0}))),_(`\ud83d\udce6 Sent ${t}x ${(0,Bc.Z)(e.type,w)} to warehouse`)}catch(n){console.error("Error sending item home:",n),_("Failed to send item home")}})(e)},actionButtonText:w[196]||"Add",actionButtonClass:"btn-success",strings:w}),(0,d.jsx)("div",{className:"modal-buttons shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-modal btn-success",onAction:Y,disabled:t,transactionKey:`send-all-home-${u}`,children:w[189]||"Add All to Warehouse"})})]})})})(),m&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("br",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)(Jc,{className:"btn-basic btn-success",onAction:async(e,t)=>{await wp({currentPlayer:l,setInventory:v,setBackpack:i,setCurrentPlayer:c,setResources:y,stationType:f,currentStationPosition:g,gridId:u,TILE_SIZE:b,updateStatus:_,onClose:n,devOnly:!0})},transactionKey:`sell-refund-${f}-${null===g||void 0===g?void 0:g.x}-${null===g||void 0===g?void 0:g.y}-${u}`,children:w[425]||"Sell for Refund"})})]})]})}const vm=t.memo(ym);const bm=function(e){var n;let{onClose:o,inventory:i,setInventory:l,backpack:u,setBackpack:h,currentPlayer:p,setCurrentPlayer:m,resources:f,updateStatus:g,masterResources:y}=e;const v=(0,r.k)(),[b,x]=(0,t.useState)([]),[w,S]=(0,t.useState)(!0),[T,C]=(0,t.useState)([]),[k,A]=(null===p||void 0===p||null===(n=p.location)||void 0===n||n.g,(0,t.useState)((null===p||void 0===p?void 0:p.messages)||[]));(0,t.useEffect)((()=>{Array.isArray(null===p||void 0===p?void 0:p.messages)&&A(p.messages)}),[null===p||void 0===p?void 0:p.messages]),(0,t.useEffect)((()=>{(async()=>{try{const e=await fetch(`${s.A}/api/messages`),t=await e.json();x(t),c(p,(()=>{}),"mailbox",!1),S(!1);const n=(await a.A.get(`${s.A}/api/player/${p.playerId}`)).data.messages||[],r=n.filter((e=>!e.read));if(r.length>0){const e=n.map((e=>e.read?e:{...e,read:!0}));await a.A.post(`${s.A}/api/update-player-messages`,{playerId:p.playerId,messages:e}),C(r.map((e=>e.messageId)))}m((e=>({...e,messages:n}))),A(n)}catch(e){console.error("\u274c Error fetching or updating mailbox data:",e)}})()}),[]);const I=e=>{var t;return(null===(t=f.find((t=>t.type===e)))||void 0===t?void 0:t.symbol)||""},E=e=>e&&0!==e.length?(0,d.jsx)("div",{className:"reward-summary",children:e.map(((e,t)=>(0,d.jsxs)("span",{className:"reward-item",children:[I(e.item)," ",e.qty," ",e.item]},t)))}):null;return p&&Array.isArray(p.messages)?(0,d.jsxs)(Ou,{onClose:()=>{console.log("\ud83d\udced Closing mailbox"),C([]),o()},title:v[1606],className:"mailbox-modal",children:[w&&0===k.length?(0,d.jsx)("p",{children:v[1601]}):0===k.length?(0,d.jsx)("p",{children:v[1602]}):[...k].reverse().map(((e,t)=>{const n=b.find((t=>t.id===e.messageId));if(!n)return console.warn(`\ud83d\udced No template found for messageId: ${e.messageId}`),null;const r=e.rewards&&e.rewards.length>0?e.rewards:n.rewards;return(0,d.jsxs)("div",{className:"mailbox-message",children:[(0,d.jsxs)("div",{className:"message-left",children:[(0,d.jsxs)("h3",{children:[n.title,(!e.read||T.includes(e.messageId))&&(0,d.jsx)("span",{className:"unread-tag",children:"\ud83c\udd95"})]}),(0,d.jsx)("p",{className:"message-body",children:n.body}),(0,d.jsxs)("p",{className:"mailbox-timestamp",children:[v[1603],": ",new Date(e.timestamp).toLocaleString()]})]}),(0,d.jsxs)("div",{className:"message-actions",children:[(null===r||void 0===r?void 0:r.length)>0&&E(r),(0,d.jsxs)("div",{className:"shared-buttons",style:{display:"flex",gap:"8px"},children:[(null===r||void 0===r?void 0:r.length)>0&&(0,d.jsx)(Jc,{className:"btn-basic btn-success btn-modal-small",transactionKey:`mailbox-collect-${e.messageId}-${k.length-1-t}`,onAction:(e,n)=>(async(e,t,n)=>{console.log(`\ud83d\udd12 [PROTECTED MAILBOX] Starting protected collection for message ${n}`);try{const r=await a.A.post(`${s.A}/api/mailbox/collect-rewards`,{playerId:p.playerId,messageIndex:n,transactionId:e,transactionKey:t});if(r.data.success){const{messages:e,inventory:t,backpack:o,skills:a,powers:s,relocations:i,xp:c,collectedItems:d}=r.data;if(m((n=>({...n,messages:e||n.messages,inventory:t||n.inventory,backpack:o||n.backpack,skills:a||n.skills,powers:s||n.powers,relocations:void 0!==i?i:n.relocations,xp:void 0!==c?c:n.xp}))),t&&l(t),o&&h(o),A(e||[]),a&&d)for(const n of d){const e=n.match(/(\d+)\s+(.+)/);if(e){const[,t,n]=e;a.some((e=>e.type===n))&&await(0,Uc.D)(p,"Acquire",n,parseInt(t),m)}}await(0,Kc.CP)(p.playerId,m),b.find((e=>{var t;return e.id===(null===(t=p.messages[n])||void 0===t?void 0:t.messageId)})),g(`Collected rewards: ${d.join(", ")}`)}}catch(o){var r;console.error("Error in protected mailbox collection:",o),429===(null===(r=o.response)||void 0===r?void 0:r.status)?g(471):g("\u274c Failed to collect rewards")}})(e,n,k.length-1-t),children:v[1604]}),(0,d.jsx)("button",{className:"btn-basic btn-neutral btn-modal-small",style:{width:"40px",backgroundColor:"var(--color-btn-active)"},title:"Delete",onClick:()=>{window.confirm("Are you sure you want to delete this message?")&&(async(e,t)=>{try{const n=[...p.messages];n.splice(t,1),await a.A.post(`${s.A}/api/update-player-messages`,{playerId:e,messages:n}),m((e=>({...e,messages:n}))),g(1607)}catch(n){console.error("\u274c Error deleting message:",n),g("\u274c Failed to delete message.")}})(p.playerId,t)},children:"\ud83d\uddd1\ufe0f"})]})]})]},t)})),(0,d.jsx)("p",{children:v[1605]})]}):(0,d.jsx)(Ou,{onClose:o,title:v[1606],message:"No messages available."})};const xm=function(e){let{onClose:n,currentPlayer:o}=e;const i=(0,r.k)(),[l,c]=(0,t.useState)("..."),[u,h]=(0,t.useState)([]),[p,m]=(0,t.useState)({type:"Unknown",phase:"Unknown",endTime:null}),[f,g]=(0,t.useState)([]),[y,v]=(0,t.useState)(null);(0,t.useEffect)((()=>{const e=JSON.parse(localStorage.getItem("timers")),t=(null===e||void 0===e?void 0:e.seasons)||{type:"Unknown",phase:"Unknown",endTime:null};m(t)}),[]),(0,t.useEffect)((()=>{(async()=>{try{const e=await a.A.get(`${s.A}/api/tuning/seasons`);h(e.data)}catch(e){console.error("\u274c Failed to load season tuning:",e)}})()}),[]),(0,t.useEffect)((()=>{const e=()=>{const e=new Date,t=new Date(p.endTime);c(pp(t,e))};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[p]),(0,t.useEffect)((()=>{const e=setInterval((()=>{const e=Date.now(),t=new Date(p.endTime).getTime(),n=Math.floor((t-e)/1e3);v(n)}),1e3);return()=>clearInterval(e)}),[p]),(0,t.useEffect)((()=>{20===y&&(console.warn("\ud83d\udd01 Forcing refresh \u2014 countdown reached 10s"),window.location.reload())}),[y]),(0,t.useEffect)((()=>{(async()=>{try{var e,t,n;if(null===o||void 0===o||!o.frontierId)return;const r=await a.A.get(`${s.A}/api/get-frontier/${o.frontierId}`),i=(null===(e=r.data)||void 0===e?void 0:e.seasonlog)||[],l=null===(t=r.data)||void 0===t||null===(n=t.seasons)||void 0===n?void 0:n.seasonNumber,c=i.find((e=>e.seasonnumber===l)),d=(null===c||void 0===c?void 0:c.seasonwinners)||[];g(d.map(((e,t)=>({username:e.username,netWorth:e.networth}))))}catch(r){console.error("\u274c Error fetching season winners:",r)}})()}),[o]);const b=u.findIndex((e=>e.seasonType===p.type)),x=(b-1+u.length)%u.length,w=b>=0?u[x]:{seasonType:"Unknown"},S=`\ud83d\uddd3\ufe0f ${w.seasonType} \u2192 ${p.type}`,T=i[5035],C=i[5036];return(0,d.jsxs)(Ou,{isOpen:!0,onClose:n,title:S,message:T,message2:C,size:"standard",children:[(0,d.jsxs)("h2",{className:"countdown-timer",children:[(0,d.jsxs)("strong",{children:[p.type," begins in:"]})," ",l]}),(0,d.jsxs)("h3",{children:["\ud83d\udcb0 Results from ",w.seasonType]}),f.length>0?f.map(((e,t)=>(0,d.jsxs)("p",{children:[t+1,". ",(0,d.jsx)("strong",{children:e.username})," \u2013 Net Worth: ",e.netWorth]},t))):(0,d.jsx)("p",{children:"No data available."}),(0,d.jsx)("br",{}),(0,d.jsxs)("ul",{style:{paddingLeft:"1.5rem",marginBottom:"1rem"},children:[(0,d.jsx)("p",{children:"\ud83e\uddd1\u200d\ud83c\udf3e Sending players home"}),(0,d.jsx)("p",{children:"\ud83d\udee0\ufe0f Resetting towns and valleys"}),(0,d.jsx)("p",{children:"\ud83d\udcb0 Nerfing money accounts"}),(0,d.jsx)("p",{children:"\ud83d\udcec Sending out rewards"})]}),(0,d.jsx)("br",{})]})};const wm=function(e){let{onClose:n,currentPlayer:o,setCurrentPlayer:i}=e;const l=(0,r.k)(),[c,u]=(0,t.useState)(""),[h,p]=(0,t.useState)(""),[m,f]=(0,t.useState)(0),[g,y]=(0,t.useState)(""),[v,b]=(0,t.useState)(""),[x,w]=(0,t.useState)(""),[S,T]=(0,t.useState)([]),[C,k]=(0,t.useState)([]),[A,I]=(0,t.useState)([]),[E,P]=(0,t.useState)(""),[_,N]=(0,t.useState)(""),[R,M]=(0,t.useState)(""),j=e=>{if(null===e||void 0===e||!e.length)return"no items";return[...new Set(e.map((e=>e.itemBought)))].join(", ")},D=async()=>{try{var e,t,n,r,i,l,c;const d=(await a.A.get(`${s.A}/api/get-settlement/${o.settlementId}`)).data;console.log("Settlement data fetched:",d),u(d.displayName),f(d.taxrate);const h=await sh(o.settlementId);console.log("\ud83d\udc51 Mayor:",h),p(h),T(d.currentoffers),k(d.nextoffers);const m=await a.A.get(`${s.A}/api/get-frontier/${o.frontierId}`);I((null===(e=m.data.bank)||void 0===e?void 0:e.offers)||[]);const g=JSON.parse(localStorage.getItem("timers"))||{};w((null===(t=g.bank)||void 0===t?void 0:t.phase)||""),b((null===(n=g.train)||void 0===n?void 0:n.phase)||""),y((null===(r=g.elections)||void 0===r?void 0:r.phase)||"");const v=Date.now();P(pp(null===(i=g.train)||void 0===i?void 0:i.endTime,v)),N(pp(null===(l=g.elections)||void 0===l?void 0:l.endTime,v)),M(pp(null===(c=g.bank)||void 0===c?void 0:c.endTime,v))}catch(d){console.error("Error fetching town data:",d)}};return(0,t.useEffect)((()=>{D();const e=setInterval(D,1e3);return()=>clearInterval(e)}),[o]),(0,d.jsxs)(Ou,{onClose:n,className:"modal-TownNews",size:"standard",children:[(0,d.jsxs)("h3",{children:[l[1501],' "',c||"...",'"']}),h?(0,d.jsxs)("p",{children:[l[1502]," ",h,l[1503]," ",m,"%."]}):(0,d.jsxs)(d.Fragment,{children:[" ",(0,d.jsxs)("p",{children:[l[1512]," ",l[1515]," ",m,"%."]}),"  "]}),(0,d.jsx)("h4",{children:l[1504]}),"Campaigning"===g&&(0,d.jsx)("p",{children:l[1505]}),"Voting"===g&&(0,d.jsxs)("p",{children:[l[1506]," ",l[10121]," ",_]}),"Counting"===g&&(0,d.jsxs)("p",{children:[l[1518]," ",_,"."]}),"arriving"===v&&(0,d.jsxs)("p",{children:[l[1507]," ",j(S),"."]}),"departing"===v&&(0,d.jsxs)("p",{children:[l[1513]," ",E,". ",l[1514]," ",j(C),"."]}),"loading"===v&&(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("p",{children:[l[1509]," ",j(S),". ",l[1517]," ",E,"."]})}),"active"===x&&(0,d.jsxs)("p",{children:[l[1516]," ",j(A),". ",l[10124],R]}),"refreshing"===x&&(0,d.jsx)("p",{children:l[1511]})]})};const Sm=function(e){var n;let{onClose:o,currentPlayer:i,setModalContent:l,setIsModalOpen:c}=e;const u=(0,r.k)(),{openPanel:h}=(0,Xc.d)(),[p,m]=(0,t.useState)(""),[f,g]=(0,t.useState)([]),[y,v]=(0,t.useState)(""),[b,x]=(0,t.useState)([]),[w,S]=(0,t.useState)(0),[T,C]=(0,t.useState)({}),k=()=>{const e=JSON.parse(localStorage.getItem("timers"));return(null===e||void 0===e?void 0:e.seasons)||{type:"Unknown",phase:"Unknown",endTime:null}};(0,t.useEffect)((()=>{(async()=>{try{const e=await a.A.get(`${s.A}/api/tuning/seasons`);x(e.data)}catch(e){console.error("\u274c Failed to fetch season cycle",e)}})()}),[]),(0,t.useEffect)((()=>{const e=()=>{const e=k(),t=new Date,n=new Date(null===e||void 0===e?void 0:e.endTime);m(pp(n,t))};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[]),(0,t.useEffect)((()=>{(async()=>{if(i&&i.frontierId)try{console.log("\ud83d\udcb0 Fetching top citizens and leading settlement for frontier:",i.frontierId);const e=(await a.A.get(`${s.A}/api/players-by-frontier-with-dev-status/${i.frontierId}`)).data,t=(await a.A.get(`${s.A}/api/settlements`)).data,n=t.reduce(((e,t)=>(e[t._id]=t.displayName||t.name||"Unknown Settlement",e)),{});C(n);const r={};e.forEach((e=>{if(e.isDeveloper)return;const t=e.settlementId||"unknown",o=e.netWorth||0;r[t]||(r[t]={totalNetWorth:0,settlementName:n[t]||"Unknown Settlement"}),r[t].totalNetWorth+=o}));let o=null,l=-1;for(const[a,s]of Object.entries(r))s.totalNetWorth>l&&(l=s.totalNetWorth,o=a);const c=o&&r[o]?r[o].settlementName:"No data available";let d="Unknown";if(o&&t){const e=t.find((e=>e._id===o));e&&(d=Cp(e))}c&&(n[c+"_pop"]=d),S(l);const u=e.filter((e=>!e.isDeveloper)).map((e=>({username:e.username,netWorth:e.netWorth||0}))).sort(((e,t)=>t.netWorth-e.netWorth)).slice(0,3);g(u),v(c)}catch(e){console.error("\u274c Error fetching top citizens and settlement:",e)}else console.warn("\u26a0\ufe0f currentPlayer or frontierId is not available yet.")})()}),[i]);const A=k();return(e=>{var t;if(!b.length||!e)return"Unknown";const n=(b.findIndex((t=>t.seasonType===e))+1)%b.length;null===(t=b[n])||void 0===t||t.seasonType})(null===A||void 0===A?void 0:A.type),(0,d.jsxs)(Zc,{onClose:o,descriptionKey:"1015",titleKey:"1115",panelName:"SeasonPanel",children:["onSeason"===(null===A||void 0===A?void 0:A.phase)?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("h2",{children:[u[3053]," ",(null===A||void 0===A?void 0:A.type)||u[3054]]}),(0,d.jsx)("p",{children:u[3055]}),(0,d.jsx)("h2",{className:"countdown-timer",children:p})]}):(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("h2",{children:u[3056]})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:()=>{const e=(0,d.jsxs)("div",{style:{textAlign:"left",paddingLeft:"20px",paddingRight:"20px"},children:[(0,d.jsx)("p",{children:u[15001]}),(0,d.jsx)("h3",{style:{marginTop:"20px",marginBottom:"10px"},children:u[15002]}),(0,d.jsxs)("ol",{style:{paddingLeft:"40px"},children:[(0,d.jsx)("li",{children:u[15003]}),(0,d.jsx)("li",{children:u[15004]}),(0,d.jsx)("li",{children:u[15005]}),(0,d.jsx)("li",{children:u[15006]})]}),(0,d.jsx)("h3",{style:{marginTop:"20px",marginBottom:"10px"},children:u[15007]}),(0,d.jsxs)("ol",{start:"7",style:{paddingLeft:"40px"},children:[(0,d.jsx)("li",{children:u[15008]}),(0,d.jsx)("li",{children:u[15009]}),(0,d.jsx)("li",{children:u[15010]}),(0,d.jsx)("li",{children:u[15011]}),(0,d.jsx)("li",{children:u[15012]}),(0,d.jsx)("li",{children:u[15013]}),(0,d.jsx)("li",{children:u[15014]}),(0,d.jsx)("li",{children:u[15015]}),(0,d.jsx)("li",{children:u[15016]}),(0,d.jsx)("li",{children:u[15017]})]}),(0,d.jsx)("h3",{style:{marginTop:"20px",marginBottom:"10px"},children:u[15018]}),(0,d.jsxs)("ol",{start:"17",style:{paddingLeft:"40px"},children:[(0,d.jsx)("li",{children:u[15019]}),(0,d.jsx)("li",{children:u[15020]}),(0,d.jsx)("li",{children:u[15021]}),(0,d.jsx)("li",{children:u[15022]})]})]});l({title:"Season Rules",size:"large",custom:e}),c(!0)},children:u[15e3]})}),(0,d.jsx)("p",{children:u[3057]}),(0,d.jsx)("h3",{children:u[3058]}),(0,d.jsx)("p",{children:u[3051]}),f.length>0?(0,d.jsx)("div",{children:f.map(((e,t)=>(0,d.jsxs)("p",{children:[t+1,". ",(0,d.jsx)("strong",{children:e.username})," : ",e.netWorth.toLocaleString()]},t)))}):(0,d.jsx)("p",{children:u[3052]}),(0,d.jsx)("h3",{children:u[3059]}),y?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{children:(0,d.jsx)("strong",{children:y})}),(0,d.jsxs)("p",{children:[u[3060]," ",w.toLocaleString()]}),(0,d.jsxs)("p",{children:[u[3061]," ",(null===(n=T[y+"_pop"])||void 0===n?void 0:n.toLocaleString())||u[3062]]})]}):(0,d.jsx)("p",{children:u[3063]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:()=>h&&h("LeaderboardPanel"),children:u[1140]})}),(0,d.jsx)("br",{}),(0,d.jsx)("br",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{if(null!==i&&void 0!==i&&i.frontierId){console.log("\ud83d\udcdc Fetching season log for frontier:",i.frontierId);try{const e=(await a.A.get(`${s.A}/api/frontier/${i.frontierId}/seasonlog`)).data.seasonlog||[],t=(0,d.jsxs)("table",{className:"season-log-table",style:{width:"100%",textAlign:"left",borderCollapse:"collapse"},children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Season"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Date"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Top Settlement"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Top Players by Net Worth"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Grids Reset"}),(0,d.jsx)("th",{style:{padding:"6px 12px"},children:"Players Relocated"})]})}),(0,d.jsx)("tbody",{children:[...e].reverse().map(((e,t)=>(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{style:{padding:"6px 12px"},children:["#",e.seasonnumber," ",e.seasontype]}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:new Date(e.date).toLocaleDateString()}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.winningsettlement}),(0,d.jsx)("td",{style:{padding:"6px 12px",whiteSpace:"pre-line"},children:e.seasonwinners.map((e=>`${e.username}: ${e.networth.toLocaleString()}`)).join("\n")}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.gridsreset}),(0,d.jsx)("td",{style:{padding:"6px 12px"},children:e.playersrelocated})]},t)))})]});l({title:"Season Log",size:"large",message:0===e.length?"No season history found.":void 0,custom:t}),c(!0)}catch(e){console.error("\u274c Failed to fetch season log:",e),l({title:"Error",message:"Failed to load season log.",size:"small"}),c(!0)}}else console.warn("\u26a0\ufe0f Cannot show season log: frontierId missing.")},children:u[3064]})})]})},Tm=e=>{var n,o,a,s,i,l,c,u,h,p,m;let{isOpen:f,onClose:g,currentPlayer:y,setCurrentPlayer:v,masterResources:b,updateStatus:x}=e;const w=(0,r.k)(),[S,T]=(0,t.useState)({}),C=(0,t.useMemo)((()=>b.filter((e=>e.hp&&e.hp>0))),[b]),k=(0,t.useMemo)((()=>{const e=(y.backpack||[]).filter((e=>C.some((t=>t.type===e.type)))).map((e=>{const t=C.find((t=>t.type===e.type));return{...e,hp:t.hp,symbol:t.symbol}}));return e}),[y.backpack,C]),A=(0,t.useMemo)((()=>{var e;if(!("homestead"===(null===(e=y.location)||void 0===e?void 0:e.gtype)))return[];const t=(y.inventory||[]).filter((e=>{const t=C.some((t=>t.type===e.type));return t})).map((e=>{const t=C.find((t=>t.type===e.type));return{...e,hp:t.hp,symbol:t.symbol}}));return t}),[y.inventory,null===(n=y.location)||void 0===n?void 0:n.gtype,C]),I=(e,t,n)=>{var r,o,a;const s=null===(r=y.location)||void 0===r?void 0:r.g,i=String(y._id||y.playerId),l=$c.default.getPlayersInGrid(s),c=(null===l||void 0===l||null===(o=l[i])||void 0===o?void 0:o.hp)||0,d=((null===l||void 0===l||null===(a=l[i])||void 0===a?void 0:a.maxhp)||100)-c;if(d<=0)return void T((t=>({...t,[e]:0})));const u=C.find((t=>t.type===e)),h=(null===u||void 0===u?void 0:u.hp)||1,p=Math.floor(d/h),m=Math.min(n,p),f=Math.max(0,Math.min(t,m));T((t=>({...t,[e]:f})))},E=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return 0===e.length?(0,d.jsxs)("div",{className:"eating-section",children:[(0,d.jsx)("h3",{children:t}),(0,d.jsx)("p",{children:"No edible items available."})]}):(0,d.jsxs)("div",{className:"eating-section",children:[(0,d.jsx)("h3",{children:t}),(0,d.jsxs)("div",{className:"eating-container",children:[(0,d.jsx)("div",{className:"eating-header",children:(0,d.jsx)("table",{children:(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:w[191]}),(0,d.jsx)("th",{children:w[10156]}),(0,d.jsx)("th",{children:w[10157]}),(0,d.jsx)("th",{children:w[10158]}),(0,d.jsx)("th",{children:w[10159]}),(0,d.jsx)("th",{children:w[192]})]})})})}),(0,d.jsx)("div",{className:"eating-scroll",children:(0,d.jsx)("table",{children:(0,d.jsx)("tbody",{children:e.map(((e,t)=>{return(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[e.symbol," ",(0,Bc.Z)(e.type,w)]}),(0,d.jsx)("td",{children:e.quantity.toLocaleString()}),(0,d.jsx)("td",{children:e.hp}),(0,d.jsx)("td",{children:(0,d.jsxs)("div",{className:"amount-input",children:[(0,d.jsx)("button",{onClick:()=>I(e.type,(S[e.type]||0)-1,e.quantity),disabled:(S[e.type]||0)<=0,children:"-"}),(0,d.jsx)("input",{type:"number",value:S[e.type]||0,onChange:t=>I(e.type,parseInt(t.target.value,10)||0,e.quantity),min:"0",max:e.quantity}),(0,d.jsx)("button",{onClick:()=>I(e.type,(S[e.type]||0)+1,e.quantity),disabled:((t,n,r)=>{const o=S[e.type]||0;if(o>=e.quantity)return!0;const a=null===(t=y.location)||void 0===t?void 0:t.g,s=String(y._id||y.playerId),i=$c.default.getPlayersInGrid(a),l=(null===i||void 0===i||null===(n=i[s])||void 0===n?void 0:n.hp)||0,c=((null===i||void 0===i||null===(r=i[s])||void 0===r?void 0:r.maxhp)||100)-l;return o>=Math.floor(c/e.hp)})(),children:"+"}),(0,d.jsx)("button",{onClick:()=>{var t,n,r;const o=null===(t=y.location)||void 0===t?void 0:t.g,a=String(y._id||y.playerId),s=$c.default.getPlayersInGrid(o),i=(null===s||void 0===s||null===(n=s[a])||void 0===n?void 0:n.hp)||0,l=((null===s||void 0===s||null===(r=s[a])||void 0===r?void 0:r.maxhp)||100)-i,c=Math.floor(l/e.hp),d=Math.min(e.quantity,c);I(e.type,d,e.quantity)},style:{marginLeft:"4px"},title:"Max",children:w[10160]})]})}),(0,d.jsx)("td",{children:(0,d.jsx)("strong",{children:(r=e.type,o=e.hp,(S[r]||0)*o)})}),(0,d.jsx)("td",{children:(0,d.jsx)("button",{className:"eat-button",onClick:()=>async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=S[e.type]||0;if(n<=0||n>e.quantity)return void x("Invalid amount to eat.");const r=n*e.hp;try{var o;const c=null===(o=y.location)||void 0===o?void 0:o.g;if(c){var a,s,i,l;const e=y._id||y.playerId,t=(null===(a=$c.default.getPlayersInGrid(c))||void 0===a||null===(s=a[e])||void 0===s?void 0:s.hp)||0,n=(null===(i=$c.default.getPlayersInGrid(c))||void 0===i||null===(l=i[e])||void 0===l?void 0:l.maxhp)||100,o=Math.min(t+r,n);$c.default.updatePC(c,e,{hp:o}),v((e=>({...e,hp:o})))}const d=t?"inventory":"backpack";v((t=>({...t,[d]:t[d].map((t=>t.type===e.type?{...t,quantity:t.quantity-n}:t)).filter((e=>e.quantity>0))}))),T({}),x(`\ud83c\udf7d\ufe0f Ate ${n} ${e.type}(s) ${w[1404]} +${r} \u2764\ufe0f\u200d\ud83e\ude79 ${w[10157]}`)}catch(c){console.error("Error eating item:",c),x("Failed to eat item.")}}(e,n),disabled:!(S[e.type]>0&&S[e.type]<=e.quantity),children:w[78]})})]},`${e.type}-${t}`);var r,o}))})})})]})]})};return f?(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container eating-modal-container",children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:g,children:"\xd7"}),(0,d.jsxs)("div",{className:"modal-title",children:[w[10161]," (",null!==y&&void 0!==y&&y._id&&null!==(o=null===(a=$c.default.getPlayersInGrid(null===y||void 0===y||null===(i=y.location)||void 0===i?void 0:i.g))||void 0===a||null===(s=a[String(y._id)])||void 0===s?void 0:s.hp)&&void 0!==o?o:"?","/",null!==y&&void 0!==y&&y._id&&null!==(l=null===(c=$c.default.getPlayersInGrid(null===y||void 0===y||null===(h=y.location)||void 0===h?void 0:h.g))||void 0===c||null===(u=c[String(y._id)])||void 0===u?void 0:u.maxhp)&&void 0!==l?l:"?",")"]}),(0,d.jsxs)("div",{className:"modal-content",children:[E(k,`${w[182]}`,!1),"homestead"===(null===(p=y.location)||void 0===p?void 0:p.gtype)&&E(A,`${w[181]}`,!0),0===k.length&&0===A.length&&(0,d.jsx)("div",{className:"no-food-message",children:(0,d.jsxs)("p",{children:[w[10162]," ","homestead"===(null===(m=y.location)||void 0===m?void 0:m.gtype)?"backpack or warehouse":"backpack","."]})})]})]})}):null},Cm=e=>{var n,o,i,l,c,u,h,p,m;let{currentPlayer:f,setCurrentPlayer:g,inventory:y,setInventory:v,backpack:b,setBackpack:x,updateStatus:w,masterTrophies:S,masterResources:T,masterXPLevels:C,masterTraders:k,tentCount:A,setTentCount:I,boatCount:E,isCamping:P,setIsCamping:_,isInBoat:N,setIsInBoat:R,displayedPCData:M,setDisplayedPCData:j,openPanel:D}=e;const[O,B]=(0,t.useState)(!1),[L,F]=(0,t.useState)(!1),$=(0,r.k)();return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("h2",{children:[$[4051]," ",f.username," "]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsxs)("button",{className:"btn-basic btn-success",onClick:()=>B(!0),children:[f.icon||"\ud83d\ude42"," ",$[4065]]})}),P?(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{_(!1),j((e=>({...e,iscamping:!1}))),g((e=>({...e,iscamping:!1}))),I((e=>e+1));try{if((await a.A.post(`${s.A}/api/update-profile`,{playerId:f.playerId,updates:{iscamping:!1}})).data.success){var e;w(30);const t=null===f||void 0===f||null===(e=f.location)||void 0===e?void 0:e.g;t&&$c.default.updatePC(t,f.playerId,{iscamping:!1})}else _(!0),j((e=>({...e,iscamping:!0}))),g((e=>({...e,iscamping:!0}))),I((e=>e-1))}catch(t){console.error("\u274c Error putting away tent:",t),w(29),_(!0),j((e=>({...e,iscamping:!0}))),g((e=>({...e,iscamping:!0}))),I((e=>e-1))}},children:$[10155]})}):(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsxs)("button",{className:"btn-basic btn-success",disabled:N,onClick:()=>{A<=0?(console.warn("\ud83d\udeab No tents found. Button press ignored."),w(27)):(async()=>{if(console.log("\u26fa\ufe0f handlePitchTent called; tentCount = ",A),!(A<=0)){_(!0),j((e=>({...e,iscamping:!0}))),g((e=>({...e,iscamping:!0}))),I((e=>e-1));try{var e;if(!(await a.A.post(`${s.A}/api/update-profile`,{playerId:f.playerId,updates:{iscamping:!0}})).data.success)return _(!1),j((e=>({...e,iscamping:!1}))),g((e=>({...e,iscamping:!1}))),void I((e=>e+1));const t={ingredient1:"Tent",ingredient1qty:1};if(!await(0,Kc.dw)({playerId:f.playerId,recipe:t,inventory:y,backpack:b,setInventory:v,setBackpack:x,setCurrentPlayer:g,updateStatus:w}))return await a.A.post(`${s.A}/api/update-profile`,{playerId:f.playerId,updates:{iscamping:!1}}),_(!1),j((e=>({...e,iscamping:!1}))),g((e=>({...e,iscamping:!1}))),void I((e=>e+1));console.log("\u26fa\ufe0f iscamping: updated profile successfully"),w(28),null!==f&&void 0!==f&&f.playerId&&(0,qc.p)(f.playerId,"Adventurer",1,f,S,g);const n=null===f||void 0===f||null===(e=f.location)||void 0===e?void 0:e.g;n&&$c.default.updatePC(n,f.playerId,{iscamping:!0})}catch(t){console.error("\u274c Error pitching tent:",t),w(29),_(!1),j((e=>({...e,iscamping:!1}))),g((e=>({...e,iscamping:!1}))),I((e=>e+1))}}})()},children:[$[10154]," (",A,")"]})}),N?(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:async()=>{R(!1),j((e=>({...e,isinboat:!1}))),g((e=>({...e,isinboat:!1})));try{if((await a.A.post(`${s.A}/api/update-profile`,{playerId:f.playerId,updates:{isinboat:!1}})).data.success){var e;w("You got out of your boat.");const t=null===f||void 0===f||null===(e=f.location)||void 0===e?void 0:e.g;t&&$c.default.updatePC(t,f.playerId,{isinboat:!1})}else R(!0),j((e=>({...e,isinboat:!0}))),g((e=>({...e,isinboat:!0})))}catch(t){console.error("\u274c Error getting out of boat:",t),w("Failed to get out of boat."),R(!0),j((e=>({...e,isinboat:!0}))),g((e=>({...e,isinboat:!0})))}},children:$[10153]})}):(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",disabled:P,onClick:()=>{E<=0?(console.warn("\ud83d\udeab No boats found. Button press ignored."),w(37)):(async()=>{if(!(E<=0)){R(!0),j((e=>({...e,isinboat:!0}))),g((e=>({...e,isinboat:!0})));try{if((await a.A.post(`${s.A}/api/update-profile`,{playerId:f.playerId,updates:{isinboat:!0}})).data.success){var e;w("You got in your boat.");const t=null===f||void 0===f||null===(e=f.location)||void 0===e?void 0:e.g;t&&$c.default.updatePC(t,f.playerId,{isinboat:!0})}else R(!1),j((e=>({...e,isinboat:!1}))),g((e=>({...e,isinboat:!1})))}catch(t){console.error("\u274c Error getting in boat:",t),w("Failed to get in boat."),R(!1),j((e=>({...e,isinboat:!1}))),g((e=>({...e,isinboat:!1})))}}})()},children:$[10152]})}),(0,d.jsx)("br",{}),(0,d.jsxs)("h3",{children:[$[10150]," ",ih(f,C)]}),(0,d.jsxs)("h3",{children:[$[10151]," ",f.xp||0," / ",lh(f,C)]}),(0,d.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"var(--color-button-hover)",borderRadius:"2px",overflow:"hidden",marginTop:"4px",marginBottom:"8px"},children:(0,d.jsx)("div",{style:{height:"100%",backgroundColor:"var(--color-btn-primary)",width:`${(()=>{const e=(null===f||void 0===f?void 0:f.xp)||0,t=ih(f,C),n=lh(f,C),r=t-2,o=r>=0&&(null===C||void 0===C?void 0:C[r])||0,a=e-o,s=n-o;return s<=0?100:Math.min(100,Math.max(0,a/s*100))})()}%`,transition:"width 0.3s ease"}})}),(0,d.jsx)(Ap,{inventory:y,backpack:b,masterResources:T,masterTraders:k,showTitle:!0,size:"normal"}),(0,d.jsx)("br",{}),(0,d.jsxs)("h3",{children:[$[10112]," ",null!==f&&void 0!==f&&f._id&&null!==(n=null===(o=$c.default.getPlayersInGrid(null===f||void 0===f||null===(l=f.location)||void 0===l?void 0:l.g))||void 0===o||null===(i=o[String(f._id)])||void 0===i?void 0:i.hp)&&void 0!==n?n:"?"," / ",null!==f&&void 0!==f&&f._id&&null!==(c=null===(u=$c.default.getPlayersInGrid(null===f||void 0===f||null===(p=f.location)||void 0===p?void 0:p.g))||void 0===u||null===(h=u[String(f._id)])||void 0===h?void 0:h.maxhp)&&void 0!==c?c:"?"]}),(0,d.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"var(--color-button-hover)",borderRadius:"2px",overflow:"hidden",marginTop:"4px",marginBottom:"8px"},children:(0,d.jsx)("div",{style:{height:"100%",backgroundColor:(null!==f&&void 0!==f&&f._id&&null!==(G=null===(z=$c.default.getPlayersInGrid(null===f||void 0===f||null===(H=f.location)||void 0===H?void 0:H.g))||void 0===z||null===(U=z[String(f._id)])||void 0===U?void 0:U.hp)&&void 0!==G?G:0)/(null!==f&&void 0!==f&&f._id&&null!==(q=null===(V=$c.default.getPlayersInGrid(null===f||void 0===f||null===(Y=f.location)||void 0===Y?void 0:Y.g))||void 0===V||null===(W=V[String(f._id)])||void 0===W?void 0:W.maxhp)&&void 0!==q?q:1)*100<=10?"#ff4444":"#74ee66",width:`${((e,t,n,r,o,a,s,i)=>{const l=null!==f&&void 0!==f&&f._id&&null!==(e=null===(t=$c.default.getPlayersInGrid(null===f||void 0===f||null===(r=f.location)||void 0===r?void 0:r.g))||void 0===t||null===(n=t[String(f._id)])||void 0===n?void 0:n.hp)&&void 0!==e?e:0,c=null!==f&&void 0!==f&&f._id&&null!==(o=null===(a=$c.default.getPlayersInGrid(null===f||void 0===f||null===(i=f.location)||void 0===i?void 0:i.g))||void 0===a||null===(s=a[String(f._id)])||void 0===s?void 0:s.maxhp)&&void 0!==o?o:1;return Math.min(100,Math.max(0,l/c*100))})()}%`,transition:"width 0.3s ease, background-color 0.3s ease"}})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:()=>F(!0),children:$[78]})}),(0,d.jsx)("br",{}),(0,d.jsxs)("h3",{onClick:()=>D("SkillsPanel"),style:{cursor:"pointer",textDecoration:"underline"},children:[$[1105]," (",(null===(m=f.skills)||void 0===m?void 0:m.length)||0,")"]}),(0,d.jsx)("h3",{onClick:()=>D("CombatPanel"),style:{cursor:"pointer",textDecoration:"underline"},children:$[1124]}),(0,d.jsx)("br",{}),(0,d.jsx)("h3",{onClick:()=>D("ProfilePanel"),style:{cursor:"pointer",textDecoration:"underline"},children:$[1190]}),O&&(0,d.jsx)(dh,{currentPlayer:f,setCurrentPlayer:g,updateStatus:w,currentIcon:f.icon,playerId:f.playerId,onClose:()=>B(!1),onSave:e=>{j((t=>({...t,icon:e}))),B(!1)}}),(0,d.jsx)(Tm,{isOpen:L,onClose:()=>F(!1),currentPlayer:f,setCurrentPlayer:g,masterResources:T,updateStatus:w})]});var G,z,U,H,q,V,W,Y},km=e=>{var n;let{onClose:o,pcData:c,currentPlayer:u,setCurrentPlayer:h,inventory:p,setInventory:m,backpack:f,setBackpack:g,updateStatus:y,masterInteractions:v,masterTrophies:b,masterResources:x,masterXPLevels:w,masterTraders:S,isDeveloper:T,controllerUsername:C,setControllerUsername:k,openPanel:A}=e;const[I,E]=(0,t.useState)(0),[P,_]=(0,t.useState)(0),[N,R]=(0,t.useState)(!1),[M,j]=(0,t.useState)(!1),[D,O]=(0,t.useState)(c),[B,L]=(0,t.useState)(null),[F,$]=(0,t.useState)(!1),G=(0,r.k)();console.log("made it to SocialPanel; pc = ",c),(0,t.useEffect)((()=>{if(c)if(c.playerId!==u.playerId){var e;const t=null===u||void 0===u||null===(e=u.location)||void 0===e?void 0:e.g;if(!t)return;const n=$c.default.getPlayersInGrid(t)[c.playerId];n&&(R(n.iscamping||!1),j(n.isinboat||!1),O((e=>({...e,iscamping:n.iscamping,isinboat:n.isinboat,hp:n.hp,username:n.username}))));(async()=>{if(c.playerId){$(!0);try{console.log(`\ud83d\udcca Fetching full data for ${c.username}`);const e=await a.A.get(`${s.A}/api/player/${c.playerId}`);L({xp:e.data.xp||0,inventory:e.data.inventory||[],backpack:e.data.backpack||[]})}catch(e){console.error(`\u274c Error fetching full data for ${c.username}:`,e),L({xp:0,inventory:[],backpack:[]})}finally{$(!1)}}})()}else L(null)}),[c,u]),(0,t.useEffect)((()=>{if(!c)return console.warn("SocialPanel was opened with missing pcData."),void O({username:"Unknown",hp:0,iscamping:!1});if(c.playerId===u.playerId){var e,t,n,r;O({...c,iscamping:u.iscamping||!1,isinboat:u.isinboat||!1,hp:u.hp||c.hp}),R(u.iscamping||!1),j(u.isinboat||!1);const o=(null===(e=u.backpack)||void 0===e||null===(t=e.find((e=>"Tent"===e.type)))||void 0===t?void 0:t.quantity)||0;E(o);const a=(null===(n=u.backpack)||void 0===n||null===(r=n.find((e=>"Boat"===e.type)))||void 0===r?void 0:r.quantity)||0;_(a)}else O(c)}),[c,u,u.iscamping,u.isinboat]);return(0,d.jsxs)(Zc,{onClose:o,descriptionKey:"1014",titleKey:"1114",panelName:"SocialPanel",children:[D.playerId!==u.playerId&&F&&(0,d.jsx)("p",{children:"Loading player data..."}),D.playerId!==u.playerId&&B&&!F&&(0,d.jsxs)("div",{className:"player-card",style:{marginBottom:"20px"},children:[(0,d.jsx)("div",{className:"player-header",children:(0,d.jsxs)("div",{className:"player-info",children:[D.iscamping?"\ud83c\udfd5\ufe0f ":D.isinboat?"\ud83d\udef6 ":(D.icon||"\ud83d\ude0a")+" ",(0,d.jsx)("strong",{children:D.username})]})}),(0,d.jsxs)("div",{className:"player-stats",children:[G[10150]," ",ih(B,w)]}),(0,d.jsxs)("div",{className:"player-stats",children:[G[10151]," ",B.xp," / ",lh(B,w)]}),(()=>{const e=ih(B,w),t=lh(B,w),n=e-2,r=n>=0&&(null===w||void 0===w?void 0:w[n])||0,o=B.xp-r,a=t-r,s=a<=0?100:Math.min(100,Math.max(0,o/a*100));return(0,d.jsx)("div",{className:"xp-bar-container",children:(0,d.jsx)("div",{className:"xp-bar-fill",style:{width:`${s}%`}})})})(),(0,d.jsx)(Ap,{inventory:B.inventory,backpack:B.backpack,masterResources:x,masterTraders:S,showTitle:!1,size:"medium"})]}),T&&D.playerId!==u.playerId&&(0,d.jsxs)("div",{className:"shared-buttons",children:[(0,d.jsx)("button",{className:"btn-basic btn-danger",onClick:async()=>{var e;if(!await l(null===u||void 0===u?void 0:u.username))return void y("\u274c Developer access required.");if(!c||!c.playerId)return console.error("\u274c Cannot remove: No player data"),void y("Failed to remove player from grid state");const t=null===u||void 0===u||null===(e=u.location)||void 0===e?void 0:e.g;if(!t)return console.error("\u274c Cannot remove: No grid ID found"),void y("Failed to remove player from grid state");const n=c.playerId;console.log(`\ud83d\uddd1\ufe0f Removing player ${c.username} (${n}) from grid ${t}`);try{console.log("\ud83d\udce4 Calling /remove-single-pc to remove player from database...");if(!(await a.A.post(`${s.A}/api/remove-single-pc`,{gridId:t,playerId:n})).data.success)throw new Error("Failed to remove player from database");console.log(`\u2705 Successfully removed player ${c.username} from database`),$c.default.removePC(t,n),console.log(`\u2705 Successfully removed player ${c.username} from local grid state`),C===c.username&&(console.log(`\ud83c\udfae Removed player ${c.username} was the NPCController, clearing controller`),k&&k(null)),i.Ay&&(console.log(`\ud83c\udfae Forcing NPCController reassignment after removing ${c.username}`),i.Ay.emit("leave-grid",{gridId:t,playerId:n,username:c.username}),setTimeout((()=>{console.log("\ud83d\udd04 Requesting current players from server after removal"),i.Ay.emit("request-current-grid-players",{gridId:t})}),50),C===c.username&&setTimeout((()=>{i.Ay.emit("request-npc-controller",{gridId:t})}),100)),y(`Removed ${c.username} from grid${C===c.username?" and cleared NPC control":""}`),c.playerId!==u.playerId&&o()}catch(r){console.error("\u274c Error removing player from grid state:",r),y("Failed to remove player from grid state")}},children:"\ud83d\uddd1\ufe0f Remove from GridState (dev only)"}),(0,d.jsx)("br",{}),(0,d.jsx)("br",{}),(0,d.jsxs)("button",{className:"btn-basic btn-danger",onClick:async()=>{var e;if(!await l(null===u||void 0===u?void 0:u.username))return void y("\u274c Developer access required.");if(!c||!c.playerId)return console.error("\u274c Cannot send home: No player data"),void y("Failed to send player home");const t=c.playerId,n=null===u||void 0===u||null===(e=u.location)||void 0===e?void 0:e.g;console.log(`\ud83c\udfe0 Sending player ${c.username} (${t}) home`);try{if(!(await a.A.post(`${s.A}/api/send-player-home`,{playerId:t,fromGridId:n})).data.success)throw new Error("Failed to send player home");console.log(`\u2705 Successfully sent player ${c.username} home`),n&&($c.default.removePC(n,t),console.log(`\u2705 Removed ${c.username} from local grid state`)),C===c.username&&(console.log(`\ud83c\udfae Sent player ${c.username} was the NPCController, clearing controller`),k&&k(null),i.Ay&&setTimeout((()=>{i.Ay.emit("request-npc-controller",{gridId:n})}),100)),y(`Sent ${c.username} home`),c.playerId!==u.playerId&&o()}catch(r){console.error("\u274c Error sending player home:",r),y("Failed to send player home")}},children:["\ud83c\udfe0 Send Home (dev only)",null!==B&&void 0!==B&&null!==(n=B.inventory)&&void 0!==n&&n.some((e=>"Home Deed"===e.type))?" (has Home Deed)":""]})]}),D.playerId===u.playerId&&(0,d.jsx)(Cm,{currentPlayer:u,setCurrentPlayer:h,inventory:p,setInventory:m,backpack:f,setBackpack:g,updateStatus:y,masterTrophies:b,masterResources:x,masterXPLevels:w,masterTraders:S,tentCount:I,setTentCount:E,boatCount:P,isCamping:N,setIsCamping:R,isInBoat:M,setIsInBoat:j,displayedPCData:D,setDisplayedPCData:O,openPanel:A})]})},Am=t.memo(km),Im=e=>{var n,o,i;let{onClose:l,currentPlayer:c,setCurrentPlayer:u,masterResources:h,masterSkills:p,TILE_SIZE:m}=e;const f=(0,r.k)(),[g,y]=(0,t.useState)([]),[v,b]=(0,t.useState)(!1),{updateStatus:x}=(0,t.useContext)(vu),[w,S]=(0,t.useState)(0),[T,C]=(0,t.useState)({}),k=e=>!0===e.passable&&"number"===typeof e.damage&&e.damage>0,A=e=>!0===e.passable&&"number"===typeof e.armorclass&&e.armorclass>0,I=e=>!k(e)&&!A(e);(0,t.useEffect)((()=>{const e=setInterval((()=>{var e;const t=null===(e=$c.default.getAllPCs(c.location.g))||void 0===e?void 0:e[c._id];t&&C(t)}),500);return()=>clearInterval(e)}),[c._id,c.location.g]);const E=()=>{var e;return(null===(e=$c.default.getAllPCs(c.location.g))||void 0===e?void 0:e[c._id])||{}},P=e=>{const t=(null===T||void 0===T?void 0:T[e])||0;let n;n="maxhp"===e?"baseMaxhp":"hp"===e?"baseHp":`base${e.charAt(0).toUpperCase()+e.slice(1)}`;const r=c[n]||0;return{base:r,modifier:t-r,total:t}},_=P("hp"),N=P("maxhp"),R=P("damage"),M=P("armorclass"),j=P("attackbonus"),D=P("attackrange"),O=P("speed"),B=e=>{var t,n;const r=e.location.g,o=e._id,a={hp:e.baseHp||0,maxhp:e.baseMaxhp||0,damage:e.baseDamage||0,armorclass:e.baseArmorclass||0,attackbonus:e.baseAttackbonus||0,attackrange:e.baseAttackrange||0,speed:e.baseSpeed||0},s=e.powers||[],i={hp:0,maxhp:0,damage:0,armorclass:0,attackbonus:0,attackrange:0,speed:0},l=(null===(t=e.settings)||void 0===t?void 0:t.equippedWeapon)||null,c=(null===(n=e.settings)||void 0===n?void 0:n.equippedArmor)||null;s.forEach((e=>{const t=h.find((t=>t.type===e.type));if(t&&"power"===t.category){const n=e.quantity||0;(I(t)||k(t)&&e.type===l||A(t)&&e.type===c)&&Object.keys(i).forEach((e=>{"number"===typeof t[e]&&(i[e]+=n*t[e])}))}}));const d={};Object.keys(a).forEach((e=>{d[e]=a[e]+(i[e]||0)}));const u=E();void 0!==(null===u||void 0===u?void 0:u.hp)?d.hp=u.hp:d.hp&&0!==d.hp||(d.hp=d.maxhp),d.playerId=o,d.username=e.username,d.position=e.position||{},d.icon=e.icon||"\ud83d\ude00",d.iscamping=e.iscamping||!1,d.isinboat=e.isinboat||!1,d.lastUpdated=(new Date).toISOString();const p=E(),m=null===p||void 0===p?void 0:p.position;d.position=m&&"number"===typeof m.x&&"number"===typeof m.y?m:{x:0,y:0},$c.default.updatePC(r,o,d)};return(0,d.jsxs)(Zc,{onClose:l,titleKey:"1124",panelName:"CombatPanel",children:[(0,d.jsx)("div",{className:"standard-panel",children:v?(0,d.jsx)("p",{children:"Loading..."}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"combat-stats",children:[(0,d.jsxs)("h3",{children:[f[10112]," ",(0,d.jsx)("span",{className:"stat-total",children:_.total})]}),(0,d.jsx)("br",{}),(0,d.jsx)("table",{className:"stats-table",children:(0,d.jsxs)("tbody",{children:[(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[f[550],": ",(0,d.jsx)("span",{className:"stat-total blue-text",children:0!==N.modifier?N.total:N.base})]}),(0,d.jsxs)("td",{className:"stat-breakdown",children:["(",N.base," ",(0,d.jsxs)("span",{className:"stat-total blue-text",children:["+ ",N.modifier]}),")"]})]}),(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[f[551],": ",(0,d.jsx)("span",{className:"stat-total blue-text",children:0!==M.modifier?M.total:M.base})]}),(0,d.jsxs)("td",{className:"stat-breakdown",children:["(",M.base," ",(0,d.jsxs)("span",{className:"stat-total blue-text",children:["+ ",M.modifier]}),")"]})]}),(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[f[552],": ",(0,d.jsx)("span",{className:"stat-total blue-text",children:0!==j.modifier?j.total:j.base})]}),(0,d.jsxs)("td",{className:"stat-breakdown",children:["(",j.base," ",(0,d.jsxs)("span",{className:"stat-total blue-text",children:["+ ",j.modifier]}),")"]})]}),(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[f[553],": ",(0,d.jsx)("span",{className:"stat-total blue-text",children:0!==R.modifier?R.total:R.base})]}),(0,d.jsxs)("td",{className:"stat-breakdown",children:["(",R.base," ",(0,d.jsxs)("span",{className:"stat-total blue-text",children:["+ ",R.modifier]}),")"]})]}),(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[f[555],": ",(0,d.jsx)("span",{className:"stat-total blue-text",children:0!==D.modifier?D.total:D.base})]}),(0,d.jsxs)("td",{className:"stat-breakdown",children:["(",D.base," ",(0,d.jsxs)("span",{className:"stat-total blue-text",children:["+ ",D.modifier]}),")"]})]}),(0,d.jsxs)("tr",{children:[(0,d.jsxs)("td",{children:[f[554],": ",(0,d.jsx)("span",{className:"stat-total blue-text",children:0!==O.modifier?O.total:O.base})]}),(0,d.jsxs)("td",{className:"stat-breakdown",children:["(",O.base," ",(0,d.jsxs)("span",{className:"stat-total blue-text",children:["+ ",O.modifier]}),")"]})]})]})})]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:()=>{B(c)},children:"\ud83d\udd04 Fix Combat Stats"})}),(0,d.jsx)("br",{}),(0,d.jsxs)("div",{className:"combat-equip",children:[(0,d.jsx)("h3",{children:f[522]}),(0,d.jsx)("br",{}),(null===(n=c.powers)||void 0===n?void 0:n.filter((e=>{const t=h.find((t=>t.type===e.type));return t&&A(t)})).length)>0?c.powers.filter((e=>{const t=h.find((t=>t.type===e.type));return t&&A(t)})).map(((e,t)=>{const n=h.find((t=>t.type===e.type)),r=e.type===(()=>{var e;return(null===(e=c.settings)||void 0===e?void 0:e.equippedArmor)||null})(),o=[];return["maxhp","damage","armorclass","attackbonus","attackrange","speed"].forEach((t=>{if("number"===typeof n[t]){const r=(e.quantity||0)*n[t],a=f[t]||t;o.push(`${r>0?"+":""}${r} ${a}`)}})),(0,d.jsxs)("div",{className:"equipment-item",children:[(0,d.jsx)("input",{type:"checkbox",checked:r,onChange:()=>(async e=>{try{const t={...c.settings,equippedArmor:e};await a.A.post(`${s.A}/api/update-profile`,{playerId:c.playerId,updates:{settings:t}});const n={...c,settings:t};u(n),setTimeout((()=>{var e;B(n);const t=null===(e=$c.default.getAllPCs(c.location.g))||void 0===e?void 0:e[c._id];t&&C(t)}),100),x(e?`Equipped ${e}`:"Unequipped armor")}catch(t){console.error("Error equipping armor:",t),x("Failed to equip armor")}})(r?null:e.type),onMouseDown:e=>{setTimeout((()=>e.target.blur()),0)},className:"equipment-checkbox",disabled:!1}),(0,d.jsxs)("div",{className:"equipment-content",children:[(0,d.jsx)("strong",{children:n.type}),(0,d.jsx)("br",{}),o.map(((e,t)=>(0,d.jsx)("div",{className:"equipment-stat",children:e},t)))]})]},`armor-${t}`)})):(0,d.jsx)("p",{children:f[523]}),(0,d.jsx)("br",{}),(0,d.jsx)("h3",{children:f[524]}),(0,d.jsx)("br",{}),(null===(o=c.powers)||void 0===o?void 0:o.filter((e=>{const t=h.find((t=>t.type===e.type));return t&&k(t)})).length)>0?c.powers.filter((e=>{const t=h.find((t=>t.type===e.type));return t&&k(t)})).map(((e,t)=>{const n=h.find((t=>t.type===e.type)),r=e.type===(()=>{var e;return(null===(e=c.settings)||void 0===e?void 0:e.equippedWeapon)||null})(),o=[];return["maxhp","damage","armorclass","attackbonus","attackrange","speed"].forEach((t=>{if("number"===typeof n[t]){const r=(e.quantity||0)*n[t],a=f[t]||t;o.push(`${r>0?"+":""}${r} ${a}`)}})),(0,d.jsxs)("div",{className:"equipment-item",children:[(0,d.jsx)("input",{type:"checkbox",checked:r,onChange:()=>(async e=>{try{const t={...c.settings,equippedWeapon:e};await a.A.post(`${s.A}/api/update-profile`,{playerId:c.playerId,updates:{settings:t}});const n={...c,settings:t};u(n),setTimeout((()=>{var e;B(n);const t=null===(e=$c.default.getAllPCs(c.location.g))||void 0===e?void 0:e[c._id];t&&C(t)}),100),x(e?`Equipped ${e}`:"Unequipped weapon")}catch(t){console.error("Error equipping weapon:",t),x("Failed to equip weapon")}})(r?null:e.type),onMouseDown:e=>{setTimeout((()=>e.target.blur()),0)},className:"equipment-checkbox",disabled:!1}),(0,d.jsxs)("div",{className:"equipment-content",children:[(0,d.jsx)("strong",{children:n.type}),(0,d.jsx)("br",{}),o.map(((e,t)=>(0,d.jsx)("div",{className:"equipment-stat",children:e},t)))]})]},`weapon-${t}`)})):(0,d.jsx)("p",{children:f[525]})]}),(0,d.jsxs)("div",{className:"combat-powers",children:[(0,d.jsx)("h3",{children:f[526]}),(0,d.jsx)("br",{}),(null===(i=c.powers)||void 0===i?void 0:i.filter((e=>{const t=h.find((t=>t.type===e.type));return t&&I(t)})).length)>0?c.powers.filter((e=>{const t=h.find((t=>t.type===e.type));return t&&I(t)})).map(((e,t)=>{const n=h.find((t=>t.type===e.type));if(!n)return null;const r=e.quantity||0,o=[];return["maxhp","damage","armorclass","attackbonus","attackrange","speed"].forEach((e=>{if("number"===typeof n[e]){const t=r*n[e],a=f[e]||e;o.push(`${t>0?"+":""}${t} ${a}`)}})),(0,d.jsx)("div",{className:"magic-enhancement-item",children:(0,d.jsxs)("div",{className:"equipment-content",children:[(0,d.jsx)("strong",{children:n.type}),(0,d.jsx)("br",{}),o.length>0?o.map(((e,t)=>(0,d.jsx)("div",{className:"equipment-stat",children:e},t))):(0,d.jsx)("div",{className:"no-combat-effects",children:"(No combat effects)"})]})},`magic-${t}`)})):(0,d.jsx)("p",{children:f[527]})]})]})}),(0,d.jsx)("br",{})]})},Em=t.memo(Im),Pm=(0,t.memo)((e=>{let{currentPlayer:t,updateStatus:n,onClose:o}=e;const a=(0,r.k)(),s="Gold"===t.accountStatus;return(0,d.jsx)(Zc,{onClose:o,descriptionKey:"1027",titleKey:"1127",panelName:"GoldBenefitsPanel",children:(0,d.jsxs)("div",{className:"panel-content",children:[(0,d.jsx)("div",{className:"shared-buttons",style:{display:"flex",justifyContent:"center",width:"100%"},children:s?(0,d.jsx)("p",{children:a[9060]}):(0,d.jsx)("button",{className:"btn-basic btn-gold",style:{width:"100%"},onClick:()=>Ju(1,t,n),children:a[9061]})}),(0,d.jsx)("br",{}),(0,d.jsx)("h2",{children:a[9050]}),(0,d.jsx)("p",{children:a[9051]}),(0,d.jsx)("p",{children:a[9052]}),(0,d.jsx)("p",{children:a[9053]}),(0,d.jsx)("p",{children:a[9054]}),(0,d.jsx)("p",{children:a[9055]}),(0,d.jsx)("p",{children:a[9056]}),(0,d.jsx)("p",{children:a[9057]}),(0,d.jsx)("p",{children:a[9058]})]})})}));function _m(e,t){let n="";switch(e){case"facebook":n=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`;break;case"twitter":n=`https://twitter.com/intent/tweet?text=Come+play+Valley+View!&url=${encodeURIComponent(t)}`;break;case"reddit":n=`https://www.reddit.com/submit?url=${encodeURIComponent(t)}&title=Check+out+Valley+View!`;break;default:return void console.warn("Unsupported network:",e)}window.open(n,"_blank","noopener,noreferrer")}const Nm=function(e){let{onClose:t}=e;const n=(0,r.k)(),o=window.location.href;return(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal-container modal-medium",children:[(0,d.jsx)("button",{className:"modal-close-btn",onClick:t,children:"\xd7"}),(0,d.jsx)("div",{className:"modal-title",children:'\ud83d\udce2 Share "Secrets of Elsinore"'}),(0,d.jsx)("p",{children:n[95]}),(0,d.jsxs)("div",{className:"shared-buttons",children:[(0,d.jsx)("button",{className:"btn-basic facebook-btn btn-modal",onClick:()=>_m("facebook",o),children:"Facebook"}),(0,d.jsx)("button",{className:"btn-basic twitter-btn btn-modal",onClick:()=>_m("twitter",o),children:"Twitter / X"}),(0,d.jsx)("button",{className:"btn-basic reddit-btn btn-modal",onClick:()=>_m("reddit",o),children:"Reddit"})]}),(0,d.jsxs)("div",{className:"copy-link",children:[(0,d.jsx)("input",{type:"text",readOnly:!0,value:o}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-modal-small",onClick:()=>{return e=o,void navigator.clipboard.writeText(e).then((()=>alert("\u2705 Link copied to clipboard!"))).catch((()=>alert("\u274c Failed to copy link.")));var e},children:"\ud83d\udccb Copy"})})]}),(0,d.jsxs)("div",{className:"discord-section",children:[(0,d.jsx)("p",{children:"and"}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic discord-btn btn-modal",onClick:()=>window.open("https://discord.gg/mQgRP2K9","_blank"),children:"Join our Discord"})})]}),(0,d.jsx)("br",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-modal btn-success",onClick:t,children:n[796]})})]})})},Rm=e=>{let{emoji:n,initialX:r,initialY:o}=e;const[a,s]=(0,t.useState)({x:r,y:o}),[i,l]=(0,t.useState)({x:r,y:o}),[c,u]=(0,t.useState)(0);return(0,t.useEffect)((()=>{const e=setTimeout((()=>{const e=Math.floor(4*Math.random()),t=100+200*Math.random();let n=a.x,r=a.y;switch(e){case 0:r=Math.max(50,a.y-t);break;case 1:n=Math.min(950,a.x+t);break;case 2:r=Math.min(550,a.y+t);break;case 3:n=Math.max(240,a.x-t)}const o=Math.sqrt(Math.pow(n-a.x,2)+Math.pow(r-a.y,2));u(o/100),l({x:n,y:r}),s({x:n,y:r})}),1e3+1e3*c);return()=>clearTimeout(e)}),[a,c]),(0,d.jsx)("div",{className:"start-screen-emoji",style:{position:"absolute",left:`${i.x}px`,top:`${i.y}px`,fontSize:"30px",transition:c>0?`all ${c}s linear`:"none",zIndex:10,userSelect:"none"},children:n})},Mm=[{emoji:"\ud83d\udc78",initialX:300,initialY:100},{emoji:"\ud83e\udd20",initialX:800,initialY:400},{emoji:"\ud83d\udc3a",initialX:550,initialY:300}],jm=()=>(0,d.jsx)(d.Fragment,{children:Mm.map(((e,t)=>(0,d.jsx)(Rm,{emoji:e.emoji,initialX:e.initialX,initialY:e.initialY},t)))}),Dm=e=>{let{isTransitioning:n,onTransitionComplete:r}=e;const[o,a]=(0,t.useState)(0),[s,i]=(0,t.useState)(!1),[l,c]=(0,t.useState)(null);if((0,t.useEffect)((()=>{const e=document.querySelector(".homestead");c(e)}),[]),(0,t.useEffect)((()=>{if(!n){a(0);const e=setTimeout((()=>{i(!1),r&&r()}),400);return()=>clearTimeout(e)}i(!0),requestAnimationFrame((()=>{a(1)}))}),[n,r]),!s||!l)return null;const u=l.getBoundingClientRect();return(0,d.jsx)("div",{style:{position:"absolute",top:u.top+window.scrollY,left:u.left+window.scrollX,width:u.width,height:u.height,backgroundColor:"#000000",opacity:o,transition:"opacity 0.4s ease-in-out",zIndex:1e3,pointerEvents:n?"all":"none"}})},Om=()=>{const[e,n]=(0,t.useState)(!1),r=(0,t.useCallback)((()=>{console.log("\ud83c\udf11 [TRANSITION FADE] Starting fade to black..."),n(!0)}),[]),o=(0,t.useCallback)((()=>{console.log("\ud83c\udf15 [TRANSITION FADE] Ending transition, fading back..."),n(!1)}),[]),a=(0,t.useCallback)((()=>e),[e]);return{isTransitioning:e,startTransition:r,endTransition:o,getTransitionState:a}},Bm="https://www.SECRETSofELSINORE.com";const Lm=function(){return(0,d.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999},children:(0,d.jsxs)("div",{style:{backgroundColor:"#fff",padding:"40px",borderRadius:"12px",textAlign:"center",maxWidth:"400px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)"},children:[(0,d.jsx)("h2",{style:{marginTop:0,color:"#333"},children:"This game has moved!"}),(0,d.jsx)("p",{style:{fontSize:"16px",color:"#555",lineHeight:1.5},children:"Please visit the new site and log in there with your username and password:"}),(0,d.jsx)("p",{style:{fontFamily:"'Lora', serif",fontSize:"18px",fontWeight:"bold",color:"#2563eb",margin:"20px 0"},children:Bm.replace("https://","")}),(0,d.jsx)("button",{onClick:()=>{window.location.href=Bm},style:{backgroundColor:"#4caf50",color:"#fff",border:"none",padding:"12px 40px",fontSize:"18px",fontWeight:"bold",borderRadius:"8px",cursor:"pointer",marginTop:"10px"},children:"Go"})]})})};const Fm=function(){var e,o,f,g,y,v,b,x,w,S,T,k,A,I,E,P,_,N,R,j,D,O,B,L;const F=window.location.hostname.includes("valleyviewgame.com");Math.floor(1e4*Math.random()),(0,t.useEffect)((()=>{const e=Math.floor(1e4*Math.random());console.log(`\ud83e\udde9 App mounted. Instance ID: ${e}`),console.trace()}),[]),(0,t.useEffect)((()=>{var e;const t=document.getElementById("root");return console.log("\ud83d\udce6 App mounted. Parent contents:",null===t||void 0===t||null===(e=t.innerHTML)||void 0===e?void 0:e.slice(0,200)),()=>{console.log("\ud83d\udca5 App unmounted.")}}),[]);const $=(0,r.k)(),{uiLocked:G}=(0,t.useContext)(nu),[z,U]=(0,t.useState)(!1),[H,q]=(0,t.useState)(!1),{activeModal:V,setActiveModal:W,openModal:Y,closeModal:K}=mh(),[X,Z]=(0,t.useState)(!1),[J,Q]=(0,t.useState)({title:"",message:"",message2:""}),[ee,te]=(0,t.useState)(!1),[ne,re]=(0,t.useState)(!1),{updateStatus:oe}=(0,t.useContext)(vu),[ae,se]=(0,t.useState)(null),[ie,le]=(0,t.useState)(!1),[ce,de]=(0,t.useState)({currentLevel:0,previousLevel:0}),ue=Cu(),{isTransitioning:he,startTransition:pe,endTransition:me}=Om(),fe={startTransition:pe,endTransition:me,isTransitioning:()=>he};(0,t.useEffect)((()=>{/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(Q({title:"Unsupported Device",size:"small",children:(0,d.jsxs)("div",{style:{fontSize:"1rem",textAlign:"center",padding:"1rem"},children:["\ud83d\udeab This game is intended for desktop browsers only.",(0,d.jsx)("br",{}),(0,d.jsx)("br",{}),"Please revisit on a laptop or desktop computer."]}),onClose:()=>{}}),Z(!0))}),[]);const ge=()=>Y&&Y("Mailbox");(0,t.useEffect)((()=>{const e=new URLSearchParams(window.location.search),t=e.get("purchase"),n=e.get("playerId"),r=e.get("offerId");if("success"===t&&n&&r){console.log("\ud83e\uddfe Processing store purchase via App.js effect:",{playerId:n,offerId:r}),a.A.post(`${s.A}/api/purchase-store-offer`,{playerId:n,offerId:r}).then((()=>{console.log("\ud83d\udcec Purchase reward sent successfully."),"1"===String(r)?(oe&&oe("\ud83c\udf89 Congratulations on purchasing a Gold Pass!"),a.A.get(`${s.A}/api/player/${n}`).then((e=>{At("GoldBenefitsPanel"),Q({title:$[5060],message:$[5061],message2:$[5062],size:"small"}),Z(!0)})).catch((e=>{console.error("\u274c Failed to refresh player data after Gold purchase:",e)}))):(oe&&oe("\u2705 Purchase successful! Check your Inbox."),ge&&ge())})).catch((e=>{console.error("\u274c Failed to fulfill purchase:",e),oe&&oe("\u26a0\ufe0f Purchase may not have been fulfilled. Contact support if missing.")}));const e=new URL(window.location.href);e.search="",window.history.replaceState({},document.title,e.toString())}}),[]),(0,t.useEffect)((()=>{let e,t=!1;return e=setInterval((async()=>{try{(null===J||void 0===J?void 0:J.title)===$[1e4]&&Z(!1),t&&window.location.reload()}catch(e){console.warn("\u274c Server unreachable:",e.message),t||(Q({title:$[1e4],message:$[10001],message2:$[10002]}),Z(!0),t=!0)}}),2e3),()=>clearInterval(e)}),[]),(0,t.useEffect)((()=>{(async()=>{var e,t;console.log("Checking for on or off Season on app start");const n=localStorage.getItem("timers");if(!n)return void console.warn("No timers in localStorage yet.");let r=null;try{r=JSON.parse(n)}catch(i){return void console.warn("Malformed timers in localStorage:",i)}if("offSeason"===(null===(e=r)||void 0===e||null===(t=e.seasons)||void 0===t?void 0:t.phase)){console.log("\ud83d\udd75\ufe0f Initial local phase is offSeason, confirming with server...");try{var o;const e=null===(o=(await a.A.get(`${s.A}/api/get-global-season-phase`)).data)||void 0===o?void 0:o.phase;Ct("offSeason"===e),console.log("offSeason"===e?"\u2705 Server confirms offSeason":"\u274c Server says it's not offSeason")}catch(l){console.error("\u274c Error confirming season with server:",l)}}})()}),[]);const ye=(()=>{const e=JSON.parse(localStorage.getItem("timers"));return(null===e||void 0===e?void 0:e.seasons)||{type:"Unknown",phase:"Unknown",endTime:null}})(),[ve,be]=(0,t.useState)(null),[xe,we]=(0,t.useState)((()=>localStorage.getItem("gridId")||null)),[Se,Te]=(0,t.useState)([]),[Ce,ke]=(0,t.useState)([]),[Ae,Ie]=(0,t.useState)([]),[Ee,Pe]=(0,t.useState)([]),[_e,Ne]=(0,t.useState)([]),[Re,Me]=(0,t.useState)([]),[je,De]=(0,t.useState)([]),[Oe,Be]=(0,t.useState)(null),[Le,Fe]=(0,t.useState)([]),[$e,Ge]=(0,t.useState)([]),[ze,Ue]=(0,t.useState)([]),[He,qe]=(0,t.useState)([]),[Ve,We]=(0,t.useState)([]);(0,t.useEffect)((()=>{ve&&(async()=>{var e,t;let n=!1;if("town"===(null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.gtype)&&null!==ve&&void 0!==ve&&null!==(t=ve.location)&&void 0!==t&&t.s)try{n=await sh(ve.location.s)===ve.username}catch(r){console.error("Error checking mayor status in App.js:",r)}q(n)})()}),[null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.s,null===ve||void 0===ve?void 0:ve.username]),(0,t.useEffect)((()=>{void 0!==Ce&&null!==Ce&&(zc.default.setTiles(Ce),console.log("GlobalGridStateTilesAndResources tiles updated:",Ce))}),[Ce]),(0,t.useEffect)((()=>{if(void 0!==Se&&null!==Se){let e=Se;const t=Se.filter((e=>{if(e.growEnd&&Ee){return Ee.some((t=>"farmplot"===t.category&&t.output===e.type))}return!1}));t.length>0&&(console.warn(`\ud83e\uddf9 Found ${t.length} crops with invalid growEnd fields, cleaning up...`),t.forEach((e=>{console.log(`  - ${e.type} at (${e.x}, ${e.y}) has growEnd=${e.growEnd}`)})),e=Se.map((e=>{if(t.some((t=>t.x===e.x&&t.y===e.y))){const{growEnd:t,...n}=e;return console.log(`\ud83c\udf3e Cleaned crop ${e.type} at (${e.x}, ${e.y})`),n}return e})),Te(e)),zc.default.setResources(e)}}),[Se,Ee]);const[Ye,Ke]=(0,t.useState)("close"),[Xe,Ze]=(0,t.useState)((()=>!("true"===localStorage.getItem("useV2TilesExplicit"))||"true"===localStorage.getItem("useV2Tiles")));(0,t.useEffect)((()=>{const e=e=>Ze(e.detail);return window.addEventListener("tileRendererChange",e),()=>window.removeEventListener("tileRendererChange",e)}),[]);const[Je,Qe]=(0,t.useState)((()=>!("true"!==localStorage.getItem("usePixiJSExplicit"))&&"true"===localStorage.getItem("usePixiJS")));(0,t.useEffect)((()=>{const e=e=>Qe(e.detail);return window.addEventListener("pixiRendererChange",e),()=>window.removeEventListener("pixiRendererChange",e)}),[]);const et=(0,t.useMemo)((()=>null!==Oe&&void 0!==Oe&&Oe.closerZoom?{closer:Oe.closerZoom,close:Oe.closeZoom,far:Oe.farZoom}:{closer:50,close:30,far:16}),[Oe]),tt=et[Ye],nt=et.close,rt=tt/nt,[ot,at]=(0,t.useState)(null),[st,it]=(0,t.useState)(null);(0,t.useEffect)((()=>{var e;null!==ve&&void 0!==ve&&null!==(e=ve.location)&&void 0!==e&&e.s&&it(ve.location.s)}),[ve]),(0,t.useEffect)((()=>{const e=()=>{Ye&&"settlement"!==Ye&&"frontier"!==Ye&&localStorage.setItem("initialZoomLevel",Ye)};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)}),[Ye]);const[lt,ct]=(0,t.useState)(null),[dt,ut]=(0,t.useState)({}),[ht,pt]=(0,t.useState)({}),[mt,ft]=(0,t.useState)(null),gt=(0,t.useContext)(mu),yt=(0,t.useContext)(fu);(0,t.useEffect)((()=>{Fc.Ay.registerSetGridState(yt)}),[yt]);const vt=(0,t.useContext)(uu),bt=(0,t.useContext)(hu);(0,t.useEffect)((()=>{$c.default.registerSetPlayersInGrid(bt)}),[bt]),(0,t.useEffect)((()=>{$c.default.registerTileSize(tt)}),[tt]);const xt=(0,t.useRef)(Ye);(0,t.useEffect)((()=>{var e;if(xt.current!==Ye&&(xt.current=Ye,Ye&&"settlement"!==Ye&&"frontier"!==Ye&&null!==ve&&void 0!==ve&&null!==(e=ve.location)&&void 0!==e&&e.g&&null!==ve&&void 0!==ve&&ve._id)){var t,n,r;const e=ve.location.g,o=String(ve._id),a=null===vt||void 0===vt||null===(t=vt[e])||void 0===t||null===(n=t.pcs)||void 0===n||null===(r=n[o])||void 0===r?void 0:r.position;console.log("\ud83d\udcf7 [ZOOM TRANSITION] ========== ZOOM LEVEL CHANGE =========="),console.log(`\ud83d\udcf7 [ZOOM TRANSITION] zoomLevel: ${Ye}`),console.log(`\ud83d\udcf7 [ZOOM TRANSITION] activeTileSize: ${tt}`),console.log(`\ud83d\udcf7 [ZOOM TRANSITION] PIXI_BASE_TILE_SIZE: ${nt}`),console.log(`\ud83d\udcf7 [ZOOM TRANSITION] pixiZoomScale: ${rt}`),console.log(`\ud83d\udcf7 [ZOOM TRANSITION] Expected container size: ${64*nt*rt}px`),console.log("\ud83d\udcf7 [ZOOM TRANSITION] playerPos from playersInGrid:",a),console.log("\ud83d\udcf7 [ZOOM TRANSITION] ======================================"),a&&tt?requestAnimationFrame((()=>{(0,$d.di)(a,tt)})):console.warn("\ud83d\udcf7 [ZOOM TRANSITION] Cannot center - missing playerPos or activeTileSize")}}),[Ye,tt,vt,ve]);const[wt,St]=(0,t.useState)(!1),[Tt,Ct]=(0,t.useState)(!1),{activePanel:kt,openPanel:At,closePanel:It}=(0,Xc.d)(),{closeAllPanels:Et}=(0,Xc.d)(),[Pt,_t]=(0,t.useState)(null),[Nt,Rt]=(0,t.useState)(null),[Mt,jt]=(0,t.useState)(null),[Dt,Ot]=(0,t.useState)(!1),[Bt,Lt]=(0,t.useState)(!1),[Ft,$t]=(0,t.useState)(null),[Gt,zt]=(0,t.useState)("resource"),[Ut,Ht]=(0,t.useState)(null),[qt,Vt]=(0,t.useState)(null);(0,t.useEffect)((()=>{["FarmingPanel","ToolsPanel","BuildPanel","BuyPanel","BuyDecoPanel","PetsPanel"].includes(kt)||Ht(null)}),[kt]),(0,t.useEffect)((()=>{if(null!==Ut&&void 0!==Ut&&Ut.emoji||null!==Ut&&void 0!==Ut&&Ut.filename){const e=Ut.size||1,t=32*e,n=t/2,r=e=>{const t=document.createElement("style");t.id="cursor-mode-style",t.textContent=`\n        body.cursor-mode-active,\n        body.cursor-mode-active * {\n          cursor: url(${e}) ${n} ${n}, crosshair !important;\n        }\n      `,document.head.appendChild(t),document.body.classList.add("cursor-mode-active")};if(Ut.filename){const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const e=document.createElement("canvas");e.width=t,e.height=t;e.getContext("2d").drawImage(o,0,0,t,t);const n=e.toDataURL();r(n)},o.onerror=()=>{if(Ut.emoji){const o=document.createElement("canvas");o.width=t,o.height=t;const a=o.getContext("2d"),s=24*e;a.font=`${s}px serif`,a.textAlign="center",a.textBaseline="middle",a.fillText(Ut.emoji,n,n);const i=o.toDataURL();r(i)}},o.src=`/assets/resources/${Ut.filename}`}else{const o=document.createElement("canvas");o.width=t,o.height=t;const a=o.getContext("2d"),s=24*e;a.font=`${s}px serif`,a.textAlign="center",a.textBaseline="middle",a.fillText(Ut.emoji,n,n);const i=o.toDataURL();r(i)}return()=>{document.body.classList.remove("cursor-mode-active");const e=document.getElementById("cursor-mode-style");e&&e.remove()}}{document.body.classList.remove("cursor-mode-active");const e=document.getElementById("cursor-mode-style");e&&e.remove()}}),[Ut]),(0,t.useEffect)((()=>{(0,h.p)("Trophy",(e=>{At("TrophyPanel")})),(0,h.p)("To Do",(e=>{At("QuestPanel")}))}),[At]),(0,t.useEffect)((()=>{localStorage.getItem("player")||(console.log("[Watcher] No stored player found \u2014 showing login panel."),St(!0),At("LoginPanel"),hn(!0))}),[kt]);const Wt=e=>{switch(console.log("App.js: Handling an NPC Panel:",e,e.action),e.action){case"quest":case"trade":case"heal":_t(e),"Kent"===e.type?At("KentPanel"):At("NPCPanel");break;case"worker":var t;_t(e),jt({type:e.type,position:e.position,gridId:null===(t=ve.location)||void 0===t?void 0:t.g}),At("FarmHandPanel")}},Yt=e=>{console.log("App.js: Opening SocialPanel for PC:",e),Rt(e),At("SocialPanel")},[Kt,Xt]=(0,t.useState)(null),[Zt,Jt]=(0,t.useState)(null),[Qt,en]=(0,t.useState)(!1),[tn,nn]=(0,t.useState)((()=>new Set)),[rn,on]=(0,t.useState)({}),[an,sn]=(0,t.useState)({chat:!1,store:!1,mailbox:!1}),ln=(0,t.useMemo)((()=>Ae),[Ae]),cn=(0,t.useMemo)((()=>Ce),[Ce]),dn=(0,t.useMemo)((()=>Se),[Se]),[un,hn]=(0,t.useState)(!1);let pn=!1;const[mn,fn]=(0,t.useState)(!1);(0,t.useEffect)((()=>{if(!i.Ay)return;i.Ay.off("connect",i.Ay.__vvgame_connect_listener);const e=()=>{console.log("\ud83d\udce1 Socket connected!"),null!==ve&&void 0!==ve&&ve.playerId&&(console.log("\ud83d\udce1 Rejoining playerId room:",ve.playerId),i.Ay.emit("join-player-room",ve.playerId))};return i.Ay.on("connect",e),i.Ay.__vvgame_connect_listener=e,()=>{i.Ay.off("connect",e),delete i.Ay.__vvgame_connect_listener}}),[i.Ay,ve]),(0,t.useEffect)((()=>{let e=null;return(async()=>{if(console.log("\ud83c\udfc1\ud83c\udfc1\ud83c\udfc1 App initialization begun."),pn)console.log("Initialization is already in progress. Skipping.");else{pn=!0;try{var t,r,o,d,u,h,f,g,y,v,b,x,w,S,T,C,k,A,I,E,P,_,N,R,M;console.log("\ud83c\udfc1\u2705 1 InitAppWrapper; Merging player data and initializing inventory...");const[B,G,z,H,q,V,W,Y,K]=await Promise.all([(0,m.hC)(),(0,m._M)(),(0,m.Xs)(),(0,m.sk)(),(0,m.Mp)(),(0,m.zz)(),(0,m.O5)(),(0,m.aI)(),(0,m.uq)()]);Pe(G),Me(B),Be(z),Fe(H),Ge(q),Ue(V),De(W),qe(Y),We(K),Ne(!0),console.log("\ud83c\udfc1\u2705 2 InitAppWrapper; getting local player...");const X=localStorage.getItem("player");if(!X)return console.log("No stored player found, showing login screen."),St(!0),At("LoginPanel"),void hn(!0);const J=JSON.parse(X);console.log("\ud83c\udfc1\u2705 2.1 InitAppWrapper; fetching player from server...");const ee=(await a.A.get(`${s.A}/api/player/${J.playerId}`)).data;if(!ee||!ee.playerId)return console.error("Invalid full player data from server:",ee),void St(!0);console.log("\ud83c\udfc1\u2705 2.2 InitAppWrapper; updating lastActive timestamp...");try{await a.A.post(`${s.A}/api/update-last-active`,{playerId:J.playerId})}catch(L){console.warn("Failed to update lastActive:",L)}console.log("\ud83c\udfc1\u2705 2.5 InitAppWrapper; checking for stale gridId after relocation...");const te=localStorage.getItem("gridId"),ne=null===(t=ee.location)||void 0===t?void 0:t.g;te&&ne&&te!==ne&&(console.warn("\ud83c\udf2a\ufe0f Detected stale gridId from localStorage. Updating to new home grid."),localStorage.setItem("gridId",ne),we(ne)),console.log("\ud83c\udfc1\u2705 3 InitAppWrapper; Merging player data and initializing inventory...");let re={...J,...ee};if(be(re),null!==(r=re)&&void 0!==r&&r.username){console.log(`\ud83d\udd0d [APP] About to check developer status for: "${re.username}"`);const e=await l(re.username);console.log(`\ud83d\udd0d [APP] isDev result: ${e}, calling setIsDeveloper(${e})`),U(e)}else console.log("\ud83d\udd0d [APP] No username found in updatedPlayerData:",re);ut(ee.inventory||[]),pt(ee.backpack||[]),console.log("\ud83c\udfc1\u2705 4. Determining local gridId...");const ae=ne||(null===J||void 0===J||null===(o=J.location)||void 0===o?void 0:o.g)||localStorage.getItem("gridId");if(!ae)return void console.error("No gridId found. Unable to initialize grid.");we(ae),localStorage.setItem("gridId",ae),i.Ay.connect();const se=()=>new Promise((e=>{i.Ay.connected?e():i.Ay.once("connect",e)}));await se(),console.log("\ud83d\udce1 Socket connected, now joining rooms..."),i.Ay.emit("join-grid",{gridId:ae,playerId:ee.playerId}),console.log("\ud83d\udce1 Emitted join-grid for grid:",ae);const ie={playerId:ee.playerId||(null===(d=ee._id)||void 0===d?void 0:d.toString()),username:ee.username,type:"pc",icon:ee.icon||"\ud83d\ude00",position:{x:null!==(u=null===(h=ee.location)||void 0===h?void 0:h.x)&&void 0!==u?u:0,y:null!==(f=null===(g=ee.location)||void 0===g?void 0:g.y)&&void 0!==f?f:0},hp:null!==(y=ee.baseHp)&&void 0!==y?y:25,maxhp:null!==(v=ee.baseMaxhp)&&void 0!==v?v:25,armorclass:null!==(b=ee.baseArmorclass)&&void 0!==b?b:10,attackbonus:null!==(x=ee.baseAttackbonus)&&void 0!==x?x:0,damage:null!==(w=ee.baseDamage)&&void 0!==w?w:1,attackrange:null!==(S=ee.baseAttackrange)&&void 0!==S?S:1,speed:null!==(T=ee.baseSpeed)&&void 0!==T?T:1,iscamping:null!==(C=ee.iscamping)&&void 0!==C&&C,isinboat:null!==(k=ee.isinboat)&&void 0!==k&&k,lastUpdated:Date.now()};i.Ay.emit("player-joined-grid",{gridId:ae,playerId:ee.playerId,username:ee.username,playerData:ie}),i.Ay.emit("join-player-room",{playerId:ee.playerId}),console.log(`\ud83d\udce1 Joined socket room for playerId: ${ee.playerId}`),i.Ay.emit("set-username",{username:ee.username}),console.log(`\ud83c\udfae Requesting current NPCController for grid: ${ae}`),i.Ay.emit("request-npc-controller",{gridId:ae}),console.log("\ud83c\udfc1\u2705 5 InitAppWrapper; Initializing grid tiles and resources..."),await(0,p.F)(tt,ae,Ie,Te,ke,oe,ee,Ee),console.log("\ud83c\udfc1\u2705 6 InitAppWrapper; Initializing NPC NPCsInGrid..."),await Fc.Ay.initializeGridState(ae);const le=Fc.Ay.getNPCsInGrid(ae);console.log("initializedState (NPCs): ",le),console.log("\ud83c\udfc1\u2705 7 InitAppWrapper; Initializing playersInGrid..."),await $c.default.initializePlayersInGrid(ae);const ce=$c.default.getPlayersInGrid(ae),de=String(J.playerId);console.log("\ud83d\udd0d [DEBUG] playerId:",de),console.log("\ud83d\udd0d [DEBUG] freshPCState keys:",Object.keys(ce||{})),console.log("\ud83d\udd0d [DEBUG] freshPCState full:",JSON.stringify(ce,null,2));const ue=null===ce||void 0===ce||null===(A=ce[de])||void 0===A?void 0:A.position,he=null!=(null===ue||void 0===ue?void 0:ue.x)&&null!=(null===ue||void 0===ue?void 0:ue.y)?ue:null!=(null===(I=ee.location)||void 0===I?void 0:I.x)&&null!=(null===(E=ee.location)||void 0===E?void 0:E.y)?{x:ee.location.x,y:ee.location.y}:null;if(console.log("\ud83d\udccd Player position for centering:",he,"(from grid:",ue,", from DB:",ee.location,")"),he){const e=localStorage.getItem("initialZoomLevel")||"close",t={closer:(null===z||void 0===z?void 0:z.closerZoom)||50,close:(null===z||void 0===z?void 0:z.closeZoom)||30,far:(null===z||void 0===z?void 0:z.farZoom)||16},n=t[e]||t.close;console.log(`\ud83d\udcf7 Centering camera on (${he.x}, ${he.y}) with TILE_SIZE: ${n} (zoom: ${e}, from globalTuning: ${JSON.stringify(t)})`),(0,$d.V5)(he,n)}console.log("\ud83c\udfc1\u2705 8 InitAppWrapper; Resolving player location...");const pe=ee._id.toString();let me=null===ce||void 0===ce?void 0:ce[pe];const fe=(null===(P=ee.location)||void 0===P?void 0:P.g)!==ae,ge=!me;if(console.log("isLocationMismatch = ",fe),console.log("isMissingFromGrid = ",ge),ge&&xe===ee.location.g){var j;console.warn("\ud83e\udded Player not in correct NPCsInGrid or missing entirely. Repositioning...");const e={x:0,y:0};console.warn("InitAppWrapper: adding PC to NPCsInGrid"),await $c.default.addPlayer(xe,ee.playerId,ee),console.warn("InitAppWrapper: refreshing NPCsInGrid"),bt((e=>({...e,[xe]:$c.default.getPlayersInGrid(xe)})));const t=null===(j=$c.default.getPlayersInGrid(xe))||void 0===j?void 0:j[pe];console.log("Refreshed gridPlayer:",t),console.warn("InitAppWrapper: adding PC to NPCsInGrid"),we(xe),localStorage.setItem("gridId",xe),ee.location={...ee.location,x:e.x,y:e.y,g:xe},console.log("\u2705 Player repositioned into NPCsInGrid:",t)}else console.log("\u2705 Player found in local NPCsInGrid.");if(console.log("\ud83c\udfc1\u2705 11 InitAppWrapper: updating localStorage with player data"),re={...ee,location:{...ee.location,x:(null===me||void 0===me||null===(_=me.position)||void 0===_?void 0:_.x)||3,y:(null===me||void 0===me||null===(N=me.position)||void 0===N?void 0:N.y)||3,g:ee.location.g}},re.gridId&&!re.homesteadGridCoord)try{console.log("\ud83c\udfe0 Looking up homestead gridCoord for gridId:",re.gridId);const e=await a.A.get(`${s.A}/api/homestead-gridcoord/${re.gridId}`);e.data.gridCoord&&(re.homesteadGridCoord=e.data.gridCoord,console.log("\ud83c\udfe0\u2705 Homestead gridCoord found and stored:",e.data.gridCoord))}catch(L){var D,O;console.warn("\ud83c\udfe0\u274c Could not find homestead gridCoord:",(null===(D=L.response)||void 0===D||null===(O=D.data)||void 0===O?void 0:O.error)||L.message)}be(re),localStorage.setItem("player",JSON.stringify(re)),console.log("\u2705 LocalStorage updated with combat stats:",re);const ye=null===(R=re.location)||void 0===R?void 0:R.gridCoord;if("number"===typeof ye&&ye>=0)try{const{isGridVisited:e}=await Promise.resolve().then(n.bind(n,9804));if(!e(re.gridsVisited,ye)){console.log(`\ud83d\udccd [GRIDS_VISITED] Marking initial grid ${ye} as visited`);const e=await a.A.post(`${s.A}/api/mark-grid-visited`,{playerId:re.playerId,gridCoord:ye});e.data.success&&e.data.gridsVisited&&(re.gridsVisited=e.data.gridsVisited,be({...re}),localStorage.setItem("player",JSON.stringify(re)),console.log("\ud83d\udccd [GRIDS_VISITED] \u2705 Initial grid marked as visited"))}}catch(F){console.warn("\ud83d\udccd [GRIDS_VISITED] Could not mark initial grid as visited:",F)}null!==(M=re.settings)&&void 0!==M&&M.hasDied&&(console.log("\u2620\ufe0f Player died last session. Showing death modal."),Q({title:$[5001],message:$[5002],message2:$[5003],size:"small"}),Z(!0),await a.A.post(`${s.A}/api/update-profile`,{playerId:re.playerId,updates:{"settings.hasDied":!1}}),re.settings.hasDied=!1,localStorage.setItem("player",JSON.stringify(re)));const ve=function(e){if(null===e||void 0===e||!e.username)return console.warn("\u26a0\ufe0f getBadgeState called without valid currentPlayer"),{};const t=`badges_${e.username}`,n=localStorage.getItem(t);return n?JSON.parse(n):{}}(re);sn(ve);(re.messages||[]).some((e=>!e.read))&&c(re,sn,"mailbox",!0),e=(0,i.xY)(re,sn,c),console.log("\u2705\ud83c\udfc1\u2705\ud83c\udfc1\u2705\ud83c\udfc1\u2705 App initialization complete.");const Se=localStorage.getItem("initialZoomLevel");Se&&(Ke(Se),localStorage.removeItem("initialZoomLevel")),fn(!0),!0===re.firsttimeuser&&void 0!==re.ftuestep&&re.ftuestep>=0&&console.log("\ud83c\udf93 FTUE step detected for first-time user:",re.ftuestep,", will show after grid loads")}catch(L){var B;console.error("Error during app initialization:",L),404===(null===(B=L.response)||void 0===B?void 0:B.status)?(console.log("Player not found (possibly deleted). Clearing local storage and showing login panel."),localStorage.removeItem("player"),localStorage.removeItem("playerId"),be(null),St(!0)):oe("ERR_NETWORK"===L.code?1:0)}}})(),()=>{var t;null===(t=e)||void 0===t||t()}}),[]),(0,t.useEffect)((()=>{const e=localStorage.getItem("revivalState");if(e&&ve)try{const t=JSON.parse(e);t.playerId===ve._id&&t.isRevivalPending?(console.log("\ud83d\udd04 Restoring revival state after refresh"),re(!0),te(!0)):localStorage.removeItem("revivalState")}catch(t){console.error("Error parsing revival state:",t),localStorage.removeItem("revivalState")}}),[ve]),(0,t.useEffect)((()=>{if(null===ve||void 0===ve||!ve.username)return;const e=localStorage.getItem(`badges_${ve.username}`);e&&sn(JSON.parse(e));const t=(0,i.xY)(ve,sn,c);return()=>{null===t||void 0===t||t()}}),[ve,i.Ay]),(0,t.useEffect)((()=>{if(!0===(null===ve||void 0===ve?void 0:ve.firsttimeuser)&&void 0!==(null===ve||void 0===ve?void 0:ve.ftuestep)&&ve.ftuestep>=0&&ve.ftuestep!==lt&&(null===lt||ve.ftuestep>lt)){if(mn&&Ce.length>0&&Se.length>0){console.log("\ud83c\udf93 FTUE step changed to:",ve.ftuestep,", showing FTUE (grid loaded)");const e=Ve.find((e=>e.step===ve.ftuestep));!1!==(null===e||void 0===e?void 0:e.showModal)&&(It(),jt(null)),Lt(!0),ct(ve.ftuestep)}else console.log("\ud83c\udf93 FTUE step changed to:",ve.ftuestep,", but waiting for grid to load")}}),[null===ve||void 0===ve?void 0:ve.ftuestep,lt,mn,Ce.length,Se.length,It]),(0,t.useEffect)((()=>{if(!0===(null===ve||void 0===ve?void 0:ve.firsttimeuser)&&void 0!==(null===ve||void 0===ve?void 0:ve.ftuestep)&&ve.ftuestep>=0&&!Bt&&mn&&Ce.length>0&&Se.length>0&&ve.ftuestep!==lt){console.log("\ud83c\udf93 Grid loaded, showing pending FTUE step:",ve.ftuestep);const e=Ve.find((e=>e.step===ve.ftuestep));!1!==(null===e||void 0===e?void 0:e.showModal)&&(It(),jt(null)),Lt(!0),ct(ve.ftuestep)}}),[mn,Ce.length,Se.length,ve,lt,Bt,It]),(0,t.useEffect)((()=>{if(null===ve||void 0===ve||!ve.firsttimeuser||void 0===(null===ve||void 0===ve?void 0:ve.ftuestep))return void $t(null);const e=Ve.find((e=>e.step===ve.ftuestep));if(null!==e&&void 0!==e&&e.doinker&&null!==e&&void 0!==e&&e.doinkerTarget){const t=e.doinkerTarget,n=e.doinkerType||"resource";$t(t),zt(n)}else $t(null),zt("resource")}),[null===ve||void 0===ve?void 0:ve.ftuestep,null===ve||void 0===ve?void 0:ve.firsttimeuser]),(0,t.useEffect)((()=>{if(void 0!==(null===ve||void 0===ve?void 0:ve.xp)&&He&&He.length>0){const e=ih(ve,He);null!==ae&&e>ae&&(de({currentLevel:e,previousLevel:ae}),le(!0)),se(e)}}),[null===ve||void 0===ve?void 0:ve.xp,He,ae]),(0,t.useEffect)((()=>(xe&&Ee&&(ou.default.initializeFarmState(Se),ou.default.startSeedTimer({gridId:xe,setResources:Te,masterResources:Ee})),()=>{ou.default.stopSeedTimer()})),[xe,Se,Ee]),(0,t.useEffect)((()=>{if(!mn)return void console.log("App not initialized. Skipping NPC management.");const e=setInterval((()=>{var e;const t=null===gt||void 0===gt||null===(e=gt[xe])||void 0===e?void 0:e.npcs;if(!t)return void console.warn("No NPCs in NPCsInGrid for gridId:",xe);if(Zt===(null===ve||void 0===ve?void 0:ve.username)){Object.values(t).forEach((e=>{"function"===typeof e.update?e.gridId&&e.gridId!==xe?console.warn(`\u26a0\ufe0f NPC ${e.id} (${e.type}) has gridId ${e.gridId} but is being updated in grid ${xe}. Skipping.`):e.update(Date.now(),gt[xe],xe,tt):console.warn("\ud83d\uded1 Skipping NPC without update() method:",e)}));const e=Fc.Ay.getNPCsInGrid(xe);var n,r;if(null!==e&&void 0!==e&&e.npcs)Fc.Ay.setAllNPCs(xe,e.npcs),console.log("\ud83d\udd04 NPC update loop: Triggered state update, sample NPC:",Object.values(e.npcs)[0]?{id:Object.values(e.npcs)[0].id,pos:`${null===(n=Object.values(e.npcs)[0].position)||void 0===n?void 0:n.x},${null===(r=Object.values(e.npcs)[0].position)||void 0===r?void 0:r.y}`}:"none")}}),1e3);return()=>clearInterval(e)}),[mn,xe,gt,ve,tt,Zt]),(0,t.useEffect)((()=>{if(!mn)return void console.log("App not initialized. Skipping PC management.");const e=setInterval((async()=>{if(vt&&xe&&null!==ve&&void 0!==ve&&ve._id){var e,t,n,r,o;const a=String(ve._id),s=null===vt||void 0===vt||null===(e=vt[xe])||void 0===e||null===(t=e.pcs)||void 0===t?void 0:t[a],i=null===s||void 0===s||null===(n=s.position)||void 0===n?void 0:n.x,l=null===s||void 0===s||null===(r=s.position)||void 0===r?void 0:r.y,c=null===Ce||void 0===Ce||null===(o=Ce[l])||void 0===o?void 0:o[i];if((null===s||void 0===s?void 0:s.hp)<=0&&ve&&!ne){console.log("\ud83d\udc80 Player is dead. Showing revival option..."),re(!0),te(!0);const e={isRevivalPending:!0,deathTimestamp:Date.now(),playerId:ve._id};localStorage.setItem("revivalState",JSON.stringify(e))}else if("l"===c){const e=2;vt[xe].pcs[a].hp-=e,Lc.A.addFloatingText(`- ${e} \u2764\ufe0f\u200d\ud83e\ude79 HP`,i,l,tt),console.log("\ud83d\udd25 Player is standing on lava. Applying 2 damage.")}}}),1e3);return()=>clearInterval(e)}),[mn,xe,vt,ve,tt,Se,Te,ut,pt,dt,ht,Ee,Re]),(0,t.useEffect)((()=>{if(!mn)return void console.log("App not initialized. Skipping PC Health Check.");const e=setInterval((async()=>{if(vt&&xe&&null!==ve&&void 0!==ve&&ve._id){var e,t,n,r;const o=String(ve._id),a=null===vt||void 0===vt||null===(e=vt[xe])||void 0===e||null===(t=e.pcs)||void 0===t?void 0:t[o],s=null===a||void 0===a||null===(n=a.position)||void 0===n?void 0:n.x,i=null===a||void 0===a||null===(r=a.position)||void 0===r?void 0:r.y;if((null===a||void 0===a?void 0:a.hp)<=ve.baseMaxhp/2&&"homestead"===ve.location.gtype){const e=2;vt[xe].pcs[o].hp+=e,Lc.A.addFloatingText(`+ ${e} \u2764\ufe0f\u200d\ud83e\ude79 HP`,s,i,tt)}}}),1e4);return()=>clearInterval(e)}),[mn,xe,vt,ve,tt,Se,Te,ut,pt,dt,ht,Ee,Re]);const[gn,yn]=(0,t.useState)((()=>JSON.parse(localStorage.getItem("timers"))||{seasons:{phase:"",endTime:null,type:""},elections:{phase:"",endTime:null},train:{phase:"",endTime:null},carnival:{phase:"",endTime:null},taxes:{phase:"",endTime:null},bank:{phase:"",endTime:null},dungeon:{phase:"",endTime:null}})),[vn,bn]=(0,t.useState)({seasons:"",elections:"",train:"",carnival:"",taxes:"",bank:"",dungeon:""});(0,t.useEffect)((()=>{if(null===ve||void 0===ve||!ve.settlementId)return;(async()=>{await xn(),console.log("\u2705 Timers initialized:",gn)})();const e=setInterval(xn,6e4);return()=>clearInterval(e)}),[ve]);const xn=async()=>{if(ve){if(null!==ve&&void 0!==ve&&ve.settlementId&&null!==ve&&void 0!==ve&&ve.frontierId)try{var e,t,n,r,o,i,l,c,d,u,h,p,m,f,g,y;const v=(await a.A.get(`${s.A}/api/get-frontier/${ve.frontierId}`)).data;let b=(null===(e=v.seasons)||void 0===e?void 0:e.seasonType)||"Unknown";null!==ve&&void 0!==ve&&null!==(t=ve.settings)&&void 0!==t&&t.seasonOverride&&"None"!==ve.settings.seasonOverride&&(console.log(`\ud83c\udf38 Applying season override: ${ve.settings.seasonOverride} (original: ${b})`),b=ve.settings.seasonOverride);const x={seasons:{type:b,phase:(null===(n=v.seasons)||void 0===n?void 0:n.phase)||"Unknown",endTime:null!==(r=v.seasons)&&void 0!==r&&r.endTime?new Date(v.seasons.endTime).getTime():null},elections:{phase:(null===(o=v.elections)||void 0===o?void 0:o.phase)||"Unknown",endTime:null!==(i=v.elections)&&void 0!==i&&i.endTime?new Date(v.elections.endTime).getTime():null},train:{phase:(null===(l=v.train)||void 0===l?void 0:l.phase)||"Unknown",endTime:null!==(c=v.train)&&void 0!==c&&c.endTime?new Date(v.train.endTime).getTime():null},carnival:{phase:(null===(d=v.carnival)||void 0===d?void 0:d.phase)||"Unknown",endTime:null!==(u=v.carnival)&&void 0!==u&&u.endTime?new Date(v.carnival.endTime).getTime():null},taxes:{phase:(null===(h=v.taxes)||void 0===h?void 0:h.phase)||"Unknown",endTime:null!==(p=v.taxes)&&void 0!==p&&p.endTime?new Date(v.taxes.endTime).getTime():null},bank:{phase:(null===(m=v.bank)||void 0===m?void 0:m.phase)||"Unknown",endTime:null!==(f=v.bank)&&void 0!==f&&f.endTime?new Date(v.bank.endTime).getTime():null},dungeon:{phase:(null===(g=v.dungeon)||void 0===g?void 0:g.phase)||"Unknown",endTime:null!==(y=v.dungeon)&&void 0!==y&&y.endTime?new Date(v.dungeon.endTime).getTime():null}};yn(x),localStorage.setItem("timers",JSON.stringify(x)),console.log("\u2705 Current Time:",Date.now())}catch(v){console.error("\u274c Error fetching timers data:",v)}}else console.warn("\u26d4 No player loaded \u2014 skipping fetchTimersData.")};(0,t.useEffect)((()=>{const e=()=>{var e,t,n,r,o,a,s;if(!gn||!gn.carnival)return void console.log("Timers not yet initialized, skipping countdown update");const i=Date.now();bn({seasons:null!==(e=gn.seasons)&&void 0!==e&&e.endTime?pp(gn.seasons.endTime,i):"--:--:--",elections:null!==(t=gn.elections)&&void 0!==t&&t.endTime?pp(gn.elections.endTime,i):"--:--:--",train:null!==(n=gn.train)&&void 0!==n&&n.endTime?pp(gn.train.endTime,i):"--:--:--",carnival:null!==(r=gn.carnival)&&void 0!==r&&r.endTime?pp(gn.carnival.endTime,i):"--:--:--",taxes:null!==(o=gn.taxes)&&void 0!==o&&o.endTime?pp(gn.taxes.endTime,i):"--:--:--",bank:null!==(a=gn.bank)&&void 0!==a&&a.endTime?pp(gn.bank.endTime,i):"--:--:--",dungeon:null!==(s=gn.dungeon)&&void 0!==s&&s.endTime?pp(gn.dungeon.endTime,i):"--:--:--"})};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[gn]),(0,t.useEffect)((()=>{"offSeason"===gn.seasons.phase?Ct(!0):Ct(!1);const e=setInterval((async()=>{const e=Date.now();let t=!1;if(gn.seasons.endTime&&e>=gn.seasons.endTime&&(console.log("\ud83c\udf31 Season phase ended."),t=!0),gn.elections.endTime&&e>=gn.elections.endTime&&(console.log("\ud83c\udfdb\ufe0f Election phase ended. Fetching new election data..."),t=!0),gn.train.endTime&&e>=gn.train.endTime&&(console.log("\ud83d\ude82 Train cycle ended. Fetching new train data..."),t=!0),gn.carnival.endTime&&e>=gn.carnival.endTime&&(console.log("\ud83c\udfa1 Carnival cycle ended. Fetching new carnival data..."),t=!0),gn.taxes.endTime&&e>=gn.taxes.endTime&&(console.log("\ud83d\udcb0 Tax cycle ended. Fetching new tax data..."),t=!0),gn.bank.endTime&&e>=gn.bank.endTime&&(console.log("\ud83d\udcb0 Bank cycle ended. Fetching new bank timer..."),t=!0),gn.dungeon.endTime&&e>=gn.dungeon.endTime){var r,o,a,s,i;console.log("\u2694\ufe0f Dungeon phase ended. Transitioning phase...");const e="open"===gn.dungeon.phase?"resetting":"open";yn((t=>({...t,dungeon:{...t.dungeon,phase:e,endTime:null}})));const l="695bd5b76545a9be8a36ee22"===(null===(r=kn.current)||void 0===r||null===(o=r.location)||void 0===o||null===(a=o.g)||void 0===a?void 0:a.toString());"resetting"!==e||"dungeon"!==(null===(s=kn.current)||void 0===s||null===(i=s.location)||void 0===i?void 0:i.gtype)||l||(console.log("\ud83d\udea8 Player is in dungeon during reset phase - teleporting out!",{timestamp:Date.now(),playerId:kn.current._id,sourceGrid:kn.current.sourceGridBeforeDungeon}),(async()=>{if(An.current)console.log("\u23f8\ufe0f Dungeon exit already in progress, skipping duplicate attempt");else{An.current=!0;try{console.log("\ud83d\udea8 Auto-exiting dungeon due to reset phase"),oe("Dungeon is resetting! Teleporting you to safety...");try{const{handleDungeonExit:e}=await n.e(95).then(n.bind(n,5095));return await e(kn.current,be,we,Ie,ke,Te,oe,tt,Et,ue,Ee,$,ze,fe),oe("You have been safely returned to the surface as the dungeon resets."),void(An.current=!1)}catch(e){console.warn("\u26a0\ufe0f Normal dungeon exit failed, attempting fallback...",e)}console.log("\ud83d\udccd Fallback: Teleporting to player's homestead");const{handleTransitSignpost:t}=await Promise.resolve().then(n.bind(n,6704));await t(kn.current,"Signpost Home",be,we,Ie,ke,Te,oe,tt,kn.current.skills,Et,ue,Ee,$,ze,fe),oe("Dungeon reset - you've been returned to your homestead.")}catch(t){console.error("\u274c Error auto-exiting dungeon:",t),oe("Error returning to surface. The dungeon will reset when you manually exit.")}finally{An.current=!1}}})()),t=!0}if(t){var l,c;console.log("\u23f3 A phase has ended! Fetching updated timers..."),await xn();"offSeason"===(null===(l=JSON.parse(localStorage.getItem("timers")))||void 0===l||null===(c=l.seasons)||void 0===c?void 0:c.phase)&&(Ct(!0),console.log("\ud83d\udd53 OffSeason detected immediately after fetch."))}}),1e3);return()=>clearInterval(e)}),[gn]);const wn=(0,t.useRef)(null===(o=gn.seasons)||void 0===o?void 0:o.phase);(0,t.useEffect)((()=>{var e;const t=null===(e=gn.seasons)||void 0===e?void 0:e.phase;"offSeason"===wn.current&&"onSeason"===t&&(console.warn("\ud83d\udd01 offSeason ended \u2014 forcing full app reload."),window.location.reload()),wn.current=t}),[null===(f=gn.seasons)||void 0===f?void 0:f.phase]),(0,t.useEffect)((()=>{(0,i.ZR)(xe,ve,_e,bt,Zt,Jt)}),[i.Ay,xe,_e,ve,Zt]),(0,t.useEffect)((()=>{mn?(0,i.zN)(tt,xe,ve,bt,Cn,nn):console.log("App not initialized. Skipping PC socket changes.")}),[i.Ay,xe,ve]),(0,t.useEffect)((()=>{mn?(0,i.j0)(tt,xe,yt,yu):console.log("App not initialized. Skipping NPC socket changes.")}),[i.Ay,xe,mn]),(0,t.useEffect)((()=>{(0,i.Bp)(tt,xe,_e,Te,Ee,Yd.if)}),[i.Ay,xe,_e]),(0,t.useEffect)((()=>{(0,i.BD)(xe,ke,Yd.El)}),[i.Ay,xe]),(0,t.useEffect)((()=>{(0,i.zK)(xe,ve,Jt)}),[i.Ay,xe,ve]),(0,t.useEffect)((()=>{(0,i.uv)()}),[i.Ay]),(0,t.useEffect)((()=>{i.Ay&&ve&&xe&&(0,i.jg)(xe,ve,en)}),[i.Ay,ve,xe]),(0,t.useEffect)((()=>{if(!i.Ay||!xe)return;return(0,i.Wc)(xe,nn)}),[i.Ay,xe]),(0,t.useEffect)((()=>{if(!i.Ay||null===ve||void 0===ve||!ve.playerId)return;return(0,i.xY)(ve,sn,c)}),[i.Ay,ve]),(0,t.useEffect)((()=>{if(!i.Ay||!ve)return;return(0,i.kf)(on)}),[i.Ay,ve]);const Sn=async()=>{var e;const t=null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.g;if(t&&null!==ve&&void 0!==ve&&ve._id)if(ve.iscamping)oe(32);else if("frontier"===Ye)Ke("settlement"),oe(12);else if("settlement"===Ye){Ke("far");const{username:e,gridType:n}=await(0,Oc.qJ)(t);"town"===n?oe(14):["valley0","valley1","valley2","valley3"].includes(n)?oe(16):"homestead"===n?e?await(0,Gc.qh)(n,e,oe,ve,ve.location.g):oe("This homestead is unoccupied."):(console.warn(`Unexpected gridType: ${n}`),oe("Unknown location."))}else"far"===Ye?Ke("close"):"close"===Ye&&Ke("closer");else console.warn("No valid gridId or playerId found for currentPlayer.")},Tn=()=>{var e;null!==ve&&void 0!==ve&&null!==(e=ve.location)&&void 0!==e&&e.g&&null!==ve&&void 0!==ve&&ve._id?ve.iscamping?oe(32):"closer"===Ye?Ke("close"):"close"===Ye?Ke("far"):"far"===Ye?(Ke("settlement"),oe(12)):"settlement"===Ye&&(Ke("frontier"),oe(13)):console.warn("No valid gridId or playerId found for currentPlayer.")},Cn=(0,t.useRef)(0),kn=(0,t.useRef)(ve),An=(0,t.useRef)(!1);(0,t.useEffect)((()=>{kn.current=ve,null!==ve&&void 0!==ve&&ve.sourceGridBeforeDungeon&&console.log("\ud83d\udccd Player sourceGridBeforeDungeon updated:",ve.sourceGridBeforeDungeon)}),[ve]),(0,t.useEffect)((()=>{const e=e=>{if(V)return;if(Tt)return;if("-"===e.key||"_"===e.key)return Tn(),void e.preventDefault();if("="===e.key||"+"===e.key)return Sn(),void e.preventDefault();if("Escape"===e.key)return Ht(null),void e.preventDefault();if("frontier"===Ye||"settlement"===Ye)return;const t=document.activeElement;(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName)&&("i"!==e.key&&"I"!==e.key?(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&e.preventDefault(),(0,$d.Eu)(e,ve,tt,Ee,be,we,Ie,ke,Te,oe,Et,Cn,ue,$,fe)):ve&&(At("InventoryPanel"),e.preventDefault()))},t=e=>{(0,$d.zQ)(e)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}}),[ve,Ee,tt,V,Ye]);let In=!1;const En=(0,t.useCallback)((async(e,t)=>{var r,o;if(In)return;In=!0;const a=(null===ve||void 0===ve?void 0:ve.gridId)===(null===ve||void 0===ve||null===(r=ve.location)||void 0===r?void 0:r.g),s=$c.default.getPlayerPosition(xe,String(null===ve||void 0===ve?void 0:ve._id)),i={x:t,y:e},l=()=>{if(a)return!0;if(!s)return!1;return(0,Oc.gd)(s,i)<=(0,Oc.ZW)(ve,Ee)};if("plant"===(null===Ut||void 0===Ut?void 0:Ut.type)&&Ut.item){if(!l())return Lc.A.addFloatingText(24,i.x,i.y,tt),void(In=!1);const{handleFarmPlotPlacement:r}=await Promise.resolve().then(n.bind(n,5519));return await r({selectedItem:Ut.item,TILE_SIZE:tt,resources:Se,setResources:Te,currentPlayer:ve,setCurrentPlayer:be,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,gridId:xe,masterResources:Ee,masterSkills:Re,updateStatus:oe,overridePosition:{x:t,y:e}}),void(In=!1)}if("terraform"===(null===Ut||void 0===Ut?void 0:Ut.type)&&(Ut.tileType||Ut.actionType)){if(!l())return Lc.A.addFloatingText(24,i.x,i.y,tt),void(In=!1);const{handleTerraform:r}=await Promise.resolve().then(n.bind(n,5519));return await r({TILE_SIZE:tt,tileType:Ut.tileType,actionType:Ut.actionType,gridId:xe,currentPlayer:ve,tileTypes:Ce,setTileTypes:ke,overridePosition:{x:t,y:e},isDeveloper:z}),void(In=!1)}if("build"===(null===Ut||void 0===Ut?void 0:Ut.type)&&Ut.item&&Ut.buildOptions){if(!l())return Lc.A.addFloatingText(24,i.x,i.y,tt),void(In=!1);const{handleConstruction:r}=await Promise.resolve().then(n.bind(n,3287));return await r({TILE_SIZE:tt,selectedItem:Ut.item,buildOptions:Ut.buildOptions,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,resources:Se,setResources:Te,currentPlayer:ve,setCurrentPlayer:be,gridId:xe,updateStatus:oe,overridePosition:{x:t,y:e},globalTuning:Oe,masterResources:Ee}),void(In=!1)}const c=Se.find((n=>{const r=n.size||1;return t>=n.x&&t<n.x+r&&e<=n.y&&e>n.y-r}));if(console.log("\u2b06\ufe0f handleTileClick invoked with:",{rowIndex:e,colIndex:t,resource:c}),c&&"homestead"===(null===ve||void 0===ve||null===(o=ve.location)||void 0===o?void 0:o.gtype)&&!a&&!z){const e=!1,t=["Mailbox","Trade Stall","Warehouse"],n="station"===(null===c||void 0===c?void 0:c.category)&&t.includes(null===c||void 0===c?void 0:c.type),r="npc"===(null===c||void 0===c?void 0:c.category)||"travel"===(null===c||void 0===c?void 0:c.category);if(n||!r&&!e)return console.warn("\ud83d\udeab Blocked interaction on another player's homestead."),oe(90),void(In=!1)}if(xe&&"string"===typeof xe)if(null!==ve&&void 0!==ve&&ve.username&&"string"===typeof ve.username)if(null!==ve&&void 0!==ve&&ve._id){if(!s||"undefined"===typeof s.x||"undefined"===typeof s.y)return console.error("\u26a0\ufe0f Player position is invalid in NPCsInGrid; playerPos: ",s),void(In=!1);if(c&&"npc"!==c.category&&!a){if((0,Oc.gd)(s,i)>(0,Oc.ZW)(ve,Ee))return Lc.A.addFloatingText(24,i.x,i.y,tt),void(In=!1);if((0,Gc.iZ)(s,i))return Lc.A.addFloatingText(40,i.x,i.y,tt),console.log("Wall blocking interaction from player to resource"),void(In=!1)}var d,u;if(c)if(console.log("App.js: Resource clicked:",c),"npc"===c.category);else if("travel"===c.category){var h;if(null!==ue&&void 0!==ue&&null!==(h=ue.isAnyBulkOperationActive)&&void 0!==h&&h.call(ue)){ue.getActiveBulkOperations();return void oe(470)}if("Dungeon Entrance"===c.type){if(console.log("\ud83d\udeaa Dungeon entrance clicked in App.js"),null===gn||void 0===gn||!gn.dungeon)return console.warn("No dungeon phase data available"),void oe("Unable to access dungeon information");let e=gn.dungeon.phase;if(gn.dungeon.endTime){Date.now()>=gn.dungeon.endTime&&(e="open"===gn.dungeon.phase?"resetting":"open",console.log(`\u23f0 Timer expired - actual phase is ${e} (server still shows ${gn.dungeon.phase})`))}const{handleDungeonEntrance:t}=await n.e(95).then(n.bind(n,5095));await t(ve,e,be,we,Ie,ke,Te,oe,tt,Et,ue,Ee,$,ze,fe,{x:c.x*tt,y:c.y*tt})}else if("Dungeon Exit"===c.type){console.log("\ud83d\udeaa Dungeon exit clicked in App.js");const{handleDungeonExit:e}=await n.e(95).then(n.bind(n,5095));await e(ve,be,we,Ie,ke,Te,oe,tt,Et,ue,Ee,$,ze,fe)}else{const{handleTransitSignpost:e}=await Promise.resolve().then(n.bind(n,6704));await e(ve,c.type,be,we,Ie,ke,Te,oe,tt,ve.skills,Et,ue,Ee,$,ze,fe)}}else if("training"===c.category||"trainingAndShop"===c.category)jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe,category:c.category}),At("SkillsPanel");else if("crafting"===c.category)if(jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe}),"Ancient Temple"===c.type)At("ScrollStation");else At("CraftingStation");else if("farmhouse"===c.category)jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe}),At("FarmHouse");else if("shop"===c.category)jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe}),At("ShopStation");else if("stall"===c.category)jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe}),At("AnimalStall");else if("farmplot"===c.category)jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe,resource:c}),At("CropPanel");else if("deco"===c.category){if("door"===c.action){const{handleDoorClick:e}=await n.e(803).then(n.bind(n,1803));e(c,ve,tt,oe,$)}jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe}),At("DecoPanel")}else if("pet"===c.category)jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe}),At("PetPanel");else if("station"===c.category)switch(jt({type:c.type,position:{x:c.x,y:c.y},gridId:xe}),c.type){case"Courthouse":At("Courthouse");break;case"Trade Stall":case"Trade":case"Trading Post":At("TradeStall");break;case"Outpost":At("OutpostPanel");break;case"Mailbox":Y("Mailbox");break;case"Warehouse":At("WarehousePanel");break;case"Train":At("NewTrainPanel");break;case"Carnival":At("CarnivalPanel");break;case"Bank":At("BankPanel");break;case"Worker Slot":const e=Se.find((e=>"Farm House"===e.type&&"farmhouse"===e.category));e?(jt({type:"Farm House",position:{x:e.x,y:e.y},gridId:xe}),At("FarmHouse")):(console.warn("Farm House not found on grid"),oe("Farm House not found"));break;default:console.warn(`Unhandled station type: ${c.type}`)}else Qd(c,c.y,c.x,Se,Te,ut,pt,dt,ht,Lc.A.addFloatingText,xe,tt,Ce,ve,be,we,Ie,ke,oe,Ee,Re,Q,Z,Et,$,ue,At,ze,Oe,fe,gn).finally((()=>{In=!1}));else if(console.log("isTeleportEnabled:",null===ve||void 0===ve||null===(d=ve.settings)||void 0===d?void 0:d.isTeleportEnabled),null!==ve&&void 0!==ve&&null!==(u=ve.settings)&&void 0!==u&&u.isTeleportEnabled){const n={x:t,y:e};console.log("\ud83d\udccd Player teleporting to grid position:",n);const r={...ve,position:n};be(r),localStorage.setItem("player",JSON.stringify(r)),null!==ve&&void 0!==ve&&ve._id&&$c.default.updatePC(xe,ve._id,{position:n})}In=!1}else console.error("No player ID found");else console.error("Invalid username:",null===ve||void 0===ve?void 0:ve.username);else console.error("Invalid gridId:",xe)}),[Se,xe,dt,ve,mt,tt,Ut]);(0,t.useEffect)((()=>{let e=Date.now();const t=12e5,n=()=>{e=Date.now()},r=()=>{const n=Date.now()-e;n>=t?(console.warn("\ud83d\udd01 Inactive too long. Showing refresh modal."),Q({title:$[70],message:$[71],message2:$[72],size:"small",onClose:()=>Z(!1),children:(0,d.jsx)("div",{style:{display:"flex",gap:"10px",justifyContent:"center",marginTop:"10px"},children:(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic btn-success",onClick:()=>{Z(!1),window.location.reload()},children:$[73]})})})}),Z(!0),setTimeout((()=>{console.warn("\ud83d\udd01 Auto-refreshing due to inactivity..."),window.location.reload()}),3e4)):n>=9e5&&(console.warn("\ud83d\udc4b Inactive for a while. Releasing controller role."),Zt===(null===ve||void 0===ve?void 0:ve.username)&&i.Ay.emit("relinquish-npc-controller",{gridId:xe}))};window.addEventListener("mousemove",n),window.addEventListener("keydown",n),document.addEventListener("visibilitychange",(()=>{if("visible"===document.visibilityState){const o=Date.now()-e;if(console.log(`\ud83d\udc40 Tab became visible. Inactive for ${Math.floor(o/6e4)} minutes`),o>=t)return console.warn("\ud83d\udd01 Was inactive too long while tab was hidden. Showing refresh modal."),void r();n()}}));const o=setInterval(r,6e4);return()=>{window.removeEventListener("mousemove",n),window.removeEventListener("keydown",n),clearInterval(o)}}),[ve,Zt,xe]);const[Pn,_n]=(0,t.useState)(!1),[Nn,Rn]=(0,t.useState)(!1),Mn=(null===ve||void 0===ve?void 0:ve.gridId)===(null===ve||void 0===ve||null===(g=ve.location)||void 0===g?void 0:g.g),[jn,Dn]=(0,t.useState)(!1),[On,Bn]=(0,t.useState)(!1),Ln=t.useMemo((()=>{if("far"===Ye||"closer"===Ye||"close"===Ye){var e;return Object.values((null===gt||void 0===gt||null===(e=gt[xe])||void 0===e?void 0:e.npcs)||{})}return[]}),[gt,xe,Ye]),Fn=Object.values((null===vt||void 0===vt||null===(y=vt[xe])||void 0===y?void 0:y.pcs)||{});return(0,d.jsxs)(d.Fragment,{children:[F&&(0,d.jsx)(Lm,{}),(0,d.jsx)(Lc.A,{}),(0,d.jsxs)("header",{className:"app-header",children:[(0,d.jsx)("div",{className:"header-title",children:(0,d.jsx)("h1",{children:$[0]})}),(0,d.jsxs)("div",{className:"header-controls-left header-grid",children:[(0,d.jsxs)("button",{className:"header-link",onClick:()=>{if(ve){const e={playerId:ve._id,username:ve.username,icon:ve.icon,hp:ve.hp||100,position:{x:0,y:0},iscamping:ve.iscamping,isinboat:ve.isinboat};Yt(e)}},children:[(null===ve||void 0===ve?void 0:ve.icon)||"\ud83d\ude0a"," ",(null===ve||void 0===ve?void 0:ve.username)||"Loading..."]}),(0,d.jsxs)("span",{className:"header-link",style:{textDecoration:"none",cursor:"default"},children:[$[10150]," ",ih(ve,He)]}),(0,d.jsx)("button",{className:"header-link",disabled:!ve,onClick:()=>At("InventoryPanel"),children:$[10103]}),(0,d.jsx)("span",{}),(0,d.jsxs)("span",{className:"header-link",style:{textDecoration:"none",cursor:"default"},children:[$[10112]," ",null!==ve&&void 0!==ve&&ve._id&&null!==(v=null===vt||void 0===vt||null===(b=vt[xe])||void 0===b||null===(x=b.pcs)||void 0===x||null===(w=x[String(ve._id)])||void 0===w?void 0:w.hp)&&void 0!==v?v:"?","/",null!==ve&&void 0!==ve&&ve._id&&null!==(S=null===vt||void 0===vt||null===(T=vt[xe])||void 0===T||null===(k=T.pcs)||void 0===k||null===(A=k[String(ve._id)])||void 0===A?void 0:A.maxhp)&&void 0!==S?S:"?"]}),(0,d.jsxs)("div",{className:"header-currency-group",children:[(0,d.jsxs)("button",{className:"header-link",onClick:()=>At("HowToGemsPanel"),children:["\ud83d\udc8e ",Array.isArray(null===ve||void 0===ve?void 0:ve.inventory)?((null===(I=ve.inventory.find((e=>"Gem"===e.type)))||void 0===I?void 0:I.quantity)||0).toLocaleString():"..."]}),(0,d.jsxs)("button",{className:"header-link",onClick:()=>At("HowToMoneyPanel"),children:["\ud83d\udcb0 ",Array.isArray(null===ve||void 0===ve?void 0:ve.inventory)?((null===(E=ve.inventory.find((e=>"Money"===e.type)))||void 0===E?void 0:E.quantity)||0).toLocaleString():"..."]})]})]}),(0,d.jsxs)("div",{className:"header-controls-center",children:[(0,d.jsx)("div",{className:"header-row",children:(0,d.jsxs)("div",{className:"header-link-wrapper",children:[(0,d.jsx)("button",{className:"header-link",disabled:!ve,onClick:()=>W("Store"),children:$[10104]}),an.store&&(0,d.jsx)("div",{className:"badge-dot"})]})}),(0,d.jsx)("div",{className:"header-row",children:(0,d.jsxs)("div",{className:"header-link-wrapper",children:[an.mailbox&&(0,d.jsx)("div",{className:"badge-dot badge-dot-left"}),(0,d.jsx)("button",{className:"header-link",disabled:!ve,onClick:()=>Y("Mailbox"),children:$[10105]})]})})]}),(0,d.jsxs)("div",{className:"header-controls-right header-grid-right",children:[(0,d.jsx)("button",{className:"header-link",onClick:()=>At("ProfilePanel"),children:$[1190]}),(0,d.jsxs)("div",{className:"header-link-wrapper",children:[(0,d.jsx)("button",{className:"header-link",disabled:!ve,onClick:()=>Dn((e=>!e)),children:$[10107]}),an.chat&&(0,d.jsx)("div",{className:"badge-dot"})]}),(0,d.jsx)("span",{}),(0,d.jsx)("button",{className:"header-link",disabled:!ve,onClick:()=>At("LeaderboardPanel"),children:$[1140]}),(0,d.jsxs)("button",{className:"header-link",disabled:!ve,onClick:()=>W("LanguagePicker"),children:["\ud83c\udf10 ",(null===(P=rh.find((e=>e.code===(null===ve||void 0===ve?void 0:ve.language))))||void 0===P?void 0:P.label)||"Language"]}),(0,d.jsx)("button",{className:"header-link",onClick:()=>Ot(!0),children:$[10106]})]})]}),(0,d.jsxs)("div",{className:"status-bar-wrapper",children:[" ",(0,d.jsx)(xu,{})," "]}),jn&&ve&&(0,d.jsx)("div",{className:"chat-panel-slideout "+(On?"closing":""),children:(0,d.jsx)(u,{currentGridId:null===(_=ve.location)||void 0===_?void 0:_.g,currentSettlementId:null===(N=ve.location)||void 0===N?void 0:N.s,currentFrontierId:ve.frontierId,currentPlayer:ve,onClose:()=>{Bn(!0),setTimeout((()=>{Dn(!1),Bn(!1)}),300)}})}),(0,d.jsx)("div",{className:"nav-column",children:ve&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"zoom-controls",children:(0,d.jsxs)("div",{className:"zoom-button-container",children:[(0,d.jsx)("button",{className:"zoom-button zoom-in",disabled:!ve,onClick:Sn,children:(0,d.jsx)("span",{children:"+"})}),(0,d.jsx)("button",{className:"zoom-button zoom-out",disabled:!ve,onClick:Tn,children:(0,d.jsx)("span",{children:"\u2212"})})]})}),(0,d.jsx)("button",{className:"nav-button "+(kt?"":"selected"),title:$[12009],onClick:()=>It(),children:"\ud83d\udc78"}),(0,d.jsx)("button",{className:"nav-button "+("SocialPanel"===kt?"selected":""),title:"My Profile",disabled:!ve,onClick:()=>{if(ve){const e={playerId:ve._id,username:ve.username,icon:ve.icon,hp:ve.hp||100,position:{x:0,y:0},iscamping:ve.iscamping,isinboat:ve.isinboat};Yt(e)}},children:(null===ve||void 0===ve?void 0:ve.icon)||"\ud83d\ude0a"}),(0,d.jsx)("button",{className:"nav-button "+("QuestPanel"===kt?"selected":""),title:$[12004],disabled:!ve,onClick:()=>At("QuestPanel"),children:"\u2705"}),!(null!==ve&&void 0!==ve&&ve.firsttimeuser&&(null===ve||void 0===ve?void 0:ve.ftuestep)<=2)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{className:"nav-button "+("FarmingPanel"===kt?"selected":""),title:$[12001],disabled:!ve,onClick:()=>{var e;ve.iscamping||ve.isinboat?oe(340):"homestead"!==(null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.gtype)||Mn||z?At("FarmingPanel"):oe(90)},children:"\ud83c\udf3d"}),(0,d.jsx)("button",{className:"nav-button "+("ToolsPanel"===kt?"selected":""),title:$[12012],disabled:!ve,onClick:()=>{var e;ve.iscamping||ve.isinboat?oe(340):"homestead"!==(null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.gtype)||Mn?At("ToolsPanel"):oe(90)},children:"\u26cf\ufe0f"}),(0,d.jsx)("button",{className:"nav-button "+("BuyPanel"===kt?"selected":""),title:$[12003],disabled:!ve,onClick:()=>{var e;ve.iscamping||ve.isinboat?oe(340):"homestead"!==(null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.gtype)||Mn||z?At("BuyPanel"):oe(90)},children:"\ud83d\udc2e"}),(0,d.jsx)("button",{className:"nav-button "+("BuildPanel"===kt?"selected":""),title:$[12002],disabled:!ve,onClick:()=>{var e;ve.iscamping||ve.isinboat?oe(340):"homestead"!==(null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.gtype)||Mn||z?At("BuildPanel"):oe(90)},children:"\ud83d\uded6"}),(0,d.jsx)("button",{className:"nav-button "+("SkillsPanel"===kt?"selected":""),title:$[12005],disabled:!ve,onClick:()=>{jt(null),At("SkillsPanel")},children:"\ud83d\udcaa"})]}),!(null!==ve&&void 0!==ve&&ve.firsttimeuser)&&Mn&&(0,d.jsx)("button",{className:"nav-button "+("PetsPanel"===kt?"selected":""),title:$[12014],disabled:!ve,onClick:()=>{var e;ve.iscamping||ve.isinboat?oe(340):"homestead"!==(null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.gtype)||Mn||z?At("PetsPanel"):oe(90)},children:"\ud83d\udc12"}),!(null!==ve&&void 0!==ve&&ve.firsttimeuser)&&(0,d.jsx)("button",{className:"nav-button "+("BuyDecoPanel"===kt?"selected":""),title:$[12011],disabled:!ve,onClick:()=>{var e;ve.iscamping||ve.isinboat?oe(340):"homestead"!==(null===ve||void 0===ve||null===(e=ve.location)||void 0===e?void 0:e.gtype)||Mn||z?At("BuyDecoPanel"):oe(90)},children:"\ud83e\udeb4"}),!(null!==ve&&void 0!==ve&&ve.firsttimeuser&&(null===ve||void 0===ve?void 0:ve.ftuestep)<=2)&&(0,d.jsx)("button",{className:"nav-button "+("CombatPanel"===kt?"selected":""),title:$[12006],disabled:!ve,onClick:()=>At("CombatPanel"),children:"\u2694\ufe0f"}),!(null!==ve&&void 0!==ve&&ve.firsttimeuser)&&(0,d.jsx)("button",{className:"nav-button "+("GovPanel"===kt?"selected":""),title:$[12007],onClick:()=>At("GovPanel"),children:"\ud83c\udfdb\ufe0f"}),!(null!==ve&&void 0!==ve&&ve.firsttimeuser&&(null===ve||void 0===ve?void 0:ve.ftuestep)<=2)&&(0,d.jsx)("button",{className:"nav-button "+("TrophyPanel"===kt?"selected":""),title:$[12013],onClick:()=>At("TrophyPanel"),children:"\ud83c\udfc6"}),z&&(0,d.jsx)("button",{className:"nav-button "+("DebugPanel"===kt?"selected":""),title:"Debug",onClick:()=>At("DebugPanel"),children:"\ud83d\udc1e"})]})}),(0,d.jsxs)("div",{className:"app-container",children:[(0,d.jsxs)("div",{className:"base-panel",children:[(0,d.jsxs)("div",{className:"base-panel-content",children:[(0,d.jsx)(Du,{currentPlayer:ve,strings:$,setCurrentPlayer:be,setGridId:we,setGrid:Ie,setTileTypes:ke,setResources:Te,updateStatus:oe,TILE_SIZE:tt,closeAllPanels:Et,bulkOperationContext:ue,masterResources:Ee,masterTrophies:ze,transitionFadeControl:fe,timers:gn,countdowns:vn}),(0,d.jsx)("h2",{style:{textAlign:"center"},children:$[10109]}),(0,d.jsx)("h3",{style:{textAlign:"center"},children:$[10135]}),(0,d.jsx)("h3",{style:{textAlign:"center"},children:$[10136]}),(0,d.jsx)("h3",{style:{textAlign:"center"},children:$[10137]}),(0,d.jsx)("h3",{style:{textAlign:"center"},children:Mn?$[10140]:$[10141]}),(0,d.jsx)("br",{}),(0,d.jsxs)("h2",{style:{textAlign:"center",fontFamily:"Berkshire Swash",color:"var(--color-primary-green-dark)",margin:"0 0 4px 0"},children:[$[10113]," ",(null===ye||void 0===ye?void 0:ye.type)||"[Season unknown]"]}),(0,d.jsx)("h2",{style:{margin:"0 0 8px 0",textAlign:"center"},children:(0,d.jsx)("span",{onClick:()=>At("SeasonPanel"),style:{textDecoration:"underline",cursor:"pointer"},children:"onSeason"===gn.seasons.phase?$[10114]:$[10115]})}),(0,d.jsx)("h2",{className:"countdown-timer",style:{textAlign:"center"},children:vn.seasons}),(0,d.jsx)("br",{}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic",onClick:()=>Y("TownNews"),children:$[10125]})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic",onClick:()=>At("HowToPanel"),children:$[10110]})}),(0,d.jsx)("br",{}),(0,d.jsx)("h2",{style:{textAlign:"center"},children:$[96]}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic",onClick:()=>window.open("https://discord.gg/SZMw4vpUJV","_blank"),children:"Join Discord Server"})}),(0,d.jsx)("div",{className:"shared-buttons",children:(0,d.jsx)("button",{className:"btn-basic",onClick:()=>window.location.href="mailto:valleyviewgamedev@gmail.com",children:$[97]})}),(0,d.jsx)("br",{}),(0,d.jsx)("h3",{children:$[10126]}),(0,d.jsxs)("div",{children:[null!==vt&&void 0!==vt&&null!==(R=vt[xe])&&void 0!==R&&R.pcs&&"object"===typeof vt[xe].pcs?0===Object.entries(vt[xe].pcs).length?(0,d.jsx)("h4",{children:$[10127]}):Object.entries(vt[xe].pcs).map((e=>{let[t,n]=e;return(0,d.jsxs)("p",{children:[tn.has(t)&&"\ud83d\udce1 ",(0,d.jsx)("strong",{children:n.username})]},t)})):(0,d.jsx)("h4",{children:$[10127]}),(0,d.jsx)("h4",{children:Zt?`\ud83d\udc2e ${Zt}`:"There is no NPCController"})]}),(0,d.jsx)("br",{})]}),(0,d.jsx)("div",{className:"base-panel-buffer"})]}),(0,d.jsxs)("div",{className:"homestead",children:[un&&(0,d.jsxs)("div",{className:"keyart-wrapper",children:[(0,d.jsx)("img",{src:"/assets/images/ValleyViewLoadScreen.png",alt:"Valley View Key Art",className:"keyart-image"}),(0,d.jsx)(jm,{})]}),"far"===Ye||"closer"===Ye||"close"===Ye?(0,d.jsxs)(d.Fragment,{children:[Je?(0,d.jsx)(Dd,{grid:ln,tileTypes:cn,resources:dn,npcs:Ln,pcs:Fn,currentPlayer:ve,TILE_SIZE:nt,zoomScale:rt,zoomLevel:Ye,handleTileClick:En,masterResources:Ee,strings:$,craftingStatus:null,tradingStatus:null,badgeState:an,electionPhase:gn.elections.phase,globalTuning:Oe,hoverTooltip:Kt,setHoverTooltip:Xt,onNPCClick:Wt,onPCClick:Yt,setInventory:ut,setBackpack:pt,setResources:Te,setCurrentPlayer:be,masterSkills:Re,masterTrophies:ze,setModalContent:Q,setIsModalOpen:Z,updateStatus:oe,openPanel:At,setActiveStation:jt,gridId:xe,timers:gn,playersInGrid:vt,isDeveloper:z,connectedPlayers:tn,cursorMode:Ut}):(0,d.jsxs)(d.Fragment,{children:[Xe?(0,d.jsx)(M,{grid:ln,tileTypes:cn,TILE_SIZE:tt,zoomLevel:Ye,handleTileClick:En}):(0,d.jsx)(C,{grid:ln,tileTypes:cn,TILE_SIZE:tt,zoomLevel:Ye,handleTileClick:En}),Ut&&(0,d.jsx)(qd,{hoveredTile:qt,cursorMode:Ut,TILE_SIZE:tt,gridWidth:(null===ln||void 0===ln||null===(j=ln[0])||void 0===j?void 0:j.length)||0,gridHeight:(null===ln||void 0===ln?void 0:ln.length)||0}),(0,d.jsx)(Bd,{resources:dn,masterResources:Ee,globalTuning:Oe,TILE_SIZE:tt,handleTileClick:En,currentPlayer:ve,badgeState:an,electionPhase:gn.elections.phase}),(0,d.jsx)(Fd,{npcs:Ln,TILE_SIZE:tt,currentPlayer:ve,globalTuning:Oe,gridId:null===ve||void 0===ve||null===(D=ve.location)||void 0===D?void 0:D.g,onNPCClick:Wt,checkQuestNPCStatus:e=>bd(e,ve),checkTradeNPCStatus:e=>xd(e,Ee),checkKentNPCStatus:e=>wd(e,ve),strings:$,masterResources:Ee,playersInGrid:vt,setInventory:ut,setBackpack:pt,setResources:Te,setCurrentPlayer:be,masterSkills:Re,setModalContent:Q,setIsModalOpen:Z,updateStatus:oe,openPanel:At,setActiveStation:jt,masterTrophies:ze,setHoverTooltip:Xt,isDeveloper:z}),(0,d.jsx)(Hd,{pcs:Fn,TILE_SIZE:tt,currentPlayer:ve,gridId:xe,onPCClick:Yt,setCurrentPlayer:be,setInventory:ut,setBackpack:pt,masterResources:Ee,strings:$,connectedPlayers:tn}),(0,d.jsx)(Sd,{TILE_SIZE:tt,openPanel:At,setActiveStation:jt,setInventory:ut,setBackpack:pt,setResources:Te,currentPlayer:ve,setCurrentPlayer:be,onNPCClick:Wt,onPCClick:Yt,handleTileClick:En,masterResources:Ee,masterSkills:Re,masterTrophies:ze,hoverTooltip:Kt,setHoverTooltip:Xt,setModalContent:Q,setIsModalOpen:Z,updateStatus:oe,strings:$,gridId:xe,globalTuning:Oe,timers:gn,resources:dn,npcs:Ln,pcs:Fn,grid:ln,tileTypes:cn,onTileHover:Vt,cursorModeActive:!!Ut,isDeveloper:z})]}),Kt&&(0,d.jsx)("div",{className:"HoverTooltip",style:{bottom:`calc(100vh - ${Kt.y}px + 10px)`,left:Kt.x,transform:"translateX(-50%)"},dangerouslySetInnerHTML:{__html:Kt.content}}),(0,d.jsx)(du,{doinkerTargets:Ft,doinkerType:Gt,TILE_SIZE:tt,visible:!!Ft,gridId:xe,activePanel:kt})]}):null,"settlement"===Ye&&(0,d.jsx)(Nu,{currentPlayer:ve,isDeveloper:z,setZoomLevel:Ke,isRelocating:ot,setIsRelocating:at,setCurrentPlayer:be,setGridId:we,setGrid:Ie,setResources:Te,setTileTypes:ke,TILE_SIZE:tt,masterResources:Ee,closeAllPanels:Et,visibleSettlementId:st,setVisibleSettlementId:it,onClose:()=>Ke("far")}),"frontier"===Ye&&(0,d.jsx)(Mu,{currentPlayer:ve,isDeveloper:z,setZoomLevel:Ke,isRelocating:ot,setIsRelocating:at,setCurrentPlayer:be,setGridId:we,setGrid:Ie,setResources:Te,setTileTypes:ke,masterResources:Ee,masterTrophies:ze,TILE_SIZE:tt,closeAllPanels:Et,visibleSettlementId:st,setVisibleSettlementId:it,onClose:()=>Ke("settlement")})]}),Dt&&(0,d.jsx)(Nm,{onClose:()=>Ot(!1)}),Bt&&(0,d.jsx)(lu,{currentPlayer:ve,setCurrentPlayer:be,onClose:()=>Lt(!1),openPanel:At,setActiveQuestGiver:_t,gridId:xe,setActiveStation:jt,masterResources:Ee,masterFTUEsteps:Ve,setResources:Te,TILE_SIZE:tt}),(0,d.jsxs)(Ou,{isOpen:X,onClose:()=>{null!==J&&void 0!==J&&J.onClose?J.onClose():Z(!1)},title:J.title,message:J.message,message2:J.message2,size:J.size||"standard",children:[J.children,J.custom]}),(0,d.jsx)(eh,{isOpen:ee,onAcceptDeath:async()=>{console.log("\u2620\ufe0f Player accepted death"),te(!1),re(!1),localStorage.removeItem("revivalState"),await async function(e,t,r,o,i,l,c,d,u,h,p){console.log("\u26b0\ufe0f Handling player death for",e.username);try{console.log("\ud83c\udfdb\ufe0f Finding town grid for death respawn in settlement:",e.settlementId);const u=(await a.A.get(`${s.A}/api/get-settlement/${e.settlementId}`)).data;if(!u||!u.grids)return void console.error("\u274c Could not find settlement for death respawn");const h=u.grids.flat().find((e=>"town"===e.gridType&&e.gridId));if(!h)return void console.error("\u274c Could not find town grid in settlement for death respawn");console.log("\ud83c\udfdb\ufe0f Found town grid for respawn:",h.gridId);const m=await(0,Oc.f0)(h.gridId),f={x:m.x,y:m.y,g:h.gridId,s:e.settlementId,f:e.location.f,gtype:"town",gridCoord:h.gridCoord},g={...e.location,...f};let y=40;"Gold"===e.accountStatus&&(y=Math.floor(e.baseMaxhp/2));const v=(e.baseMaxhp||990)+(e.maxhpModifier||0);console.log(`\ud83d\udea8 [HP DEBUG] Death recovery for ${e.username}:`),console.log("  player.baseMaxhp:",e.baseMaxhp),console.log("  player.maxhp (before):",e.maxhp),console.log("  properMaxHp (calculated):",v),console.log("  restoredHp:",y);const b=e.backpack.filter((e=>"Tent"===e.type||"Boat"===e.type)),x={...e.location},w={...e,hp:y,maxhp:v,backpack:b,location:g};await a.A.post(`${s.A}/api/update-profile`,{playerId:e._id,updates:{backpack:b,hp:y,maxhp:v,location:g,settings:e.settings}}),t(w),localStorage.setItem("player",JSON.stringify(w)),console.log(`Player ${e.username} will be teleported to town grid with ${y} HP.`),console.log("\ud83d\udce6 Player before changePlayerLocation:",JSON.stringify(w,null,2)),await(0,Gc.t3)(w,x,g,t,r,o,l,i,c,p,d,null,null,null,null),console.log(`\ud83c\udfe5 Ensuring player HP is set to ${y} in grid state`);const S=await Promise.resolve().then(n.bind(n,1431)).then((e=>e.default));await S.updatePC(h.gridId,w._id,{hp:y}),t((e=>({...e,hp:y})))}catch(m){console.error("Error during player death handling and teleportation:",m)}}(ve,be,we,Ie,Te,ke,tt,oe,0,0,Et),Q({title:$[5001],message:$[5002],message2:$[5003],size:"small"}),Z(!0)},onRevive:async()=>{var e;console.log("\ud83d\udc8e Player attempting to revive");const t=(null===Oe||void 0===Oe?void 0:Oe.costToRevive)||50,n=(null===(e=dt.find((e=>"Gem"===e.type)))||void 0===e?void 0:e.quantity)||0;if(console.log(`Player has ${n} gems, needs ${t}`),n>=t){console.log("\u2705 Player has enough gems, reviving...");const e=(null===Oe||void 0===Oe?void 0:Oe.percentageToRevive)||.25,n=(ve.baseMaxhp||25)+(ve.maxhpModifier||0),i=Math.floor(n*e);try{var r;const e=dt.map((e=>"Gem"===e.type?{...e,quantity:e.quantity-t}:e)),n=(await a.A.post(`${s.A}/api/update-profile`,{playerId:ve._id,updates:{inventory:e}}),{...ve,inventory:e});be(n),localStorage.setItem("player",JSON.stringify(n)),ut(e);const o=String(ve._id);console.log(`\ud83c\udfe5 Updating player ${o} HP to ${i} in grid ${xe}`),$c.default.updatePC(xe,o,{hp:i});const l=$c.default.getPlayersInGrid(xe);console.log("\u2705 Player HP in grid state:",null===(r=l[o])||void 0===r?void 0:r.hp),te(!1),re(!1),localStorage.removeItem("revivalState"),console.log(`\u2705 Player revived with ${i} HP`),oe(`Revived with ${i} HP! \ud83d\udc8e -${t} Gems`)}catch(o){console.error("\u274c Error during revival:",o),oe("Revival failed - please try again")}}},reviveCost:(null===Oe||void 0===Oe?void 0:Oe.costToRevive)||50,strings:$,currentPlayer:ve,inventory:dt,updateStatus:oe}),"Mailbox"===V&&(0,d.jsx)(bm,{onClose:K,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,resources:Ee,updateStatus:oe,masterResources:Ee}),"TownNews"===V&&(0,d.jsx)(wm,{onClose:K,currentPlayer:ve,setCurrentPlayer:be,resources:Ee}),"LanguagePicker"===V&&(0,d.jsx)(ah,{currentPlayer:ve,setCurrentPlayer:be,updateStatus:oe,onClose:()=>W(null),onSave:()=>W(null)}),"Store"===V&&(0,d.jsx)(Qu,{onClose:function(){let{openMailbox:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};W(null),e&&setTimeout((()=>W("Mailbox")),100)},currentPlayer:ve,setCurrentPlayer:be,resources:Ee,setModalContent:Q,setIsModalOpen:Z}),Tt&&(0,d.jsx)(xm,{currentPlayer:ve,timers:gn}),"ProfilePanel"===kt&&(0,d.jsx)(gh,{onClose:It,currentPlayer:ve,setCurrentPlayer:be,handleLogout:()=>{console.log("Logging out user..."),Fc.Ay.stopGridStateUpdates(),be(null),ut({}),ft({x:0,y:0}),Ie([]),Te([]),ke([]),we(null),localStorage.removeItem("gridId"),localStorage.removeItem("player"),window.location.reload(),console.log("Player has logged out, and state has been reset.")},isRelocating:ot,setIsRelocating:at,zoomLevel:Ye,setZoomLevel:Ke,handlePCClick:Yt,isDeveloper:z}),"LoginPanel"===kt&&(0,d.jsx)(wh,{onClose:It,setCurrentPlayer:e=>{be(e),It()},zoomLevel:Ye,setZoomLevel:Ke,onLoginSuccess:async(e,t)=>{await(async e=>{console.log("Handling login success for player:",e),localStorage.setItem("player",JSON.stringify(e)),window.location.reload()})(e)}}),"DebugPanel"===kt&&(0,d.jsx)(Th,{onClose:It,currentPlayer:ve,setCurrentPlayer:be,setInventory:ut,setResources:Te,currentGridId:null===ve||void 0===ve||null===(O=ve.location)||void 0===O?void 0:O.g,updateStatus:oe,TILE_SIZE:tt,setGrid:Ie,setGridId:we,setTileTypes:ke,closeAllPanels:Et}),"InventoryPanel"===kt&&(0,d.jsx)(kh,{onClose:It,masterResources:Ee,globalTuning:Oe,currentPlayer:ve,setCurrentPlayer:be,setInventory:ut,setBackpack:pt,updateStatus:oe,openPanel:At,setActiveStation:jt,setModalContent:Q,setIsModalOpen:Z}),"WarehousePanel"===kt&&(0,d.jsx)(Ph,{onClose:()=>At("InventoryPanel"),masterResources:Ee,currentPlayer:ve,setCurrentPlayer:be,setInventory:ut,stationType:null===Mt||void 0===Mt?void 0:Mt.type,globalTuning:Oe,masterWarehouse:je,updateStatus:oe}),"TrophyPanel"===kt&&(0,d.jsx)(_h,{onClose:It,masterResources:Ee,masterTrophies:ze,currentPlayer:ve,setCurrentPlayer:be,updateStatus:oe,openPanel:At,setActiveStation:jt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt}),"BankPanel"===kt&&(0,d.jsx)(Pp,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,updateStatus:oe,masterResources:Ee,masterXPLevels:He,globalTuning:Oe,setResources:Te,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:xe,TILE_SIZE:tt,isDeveloper:z}),"KentPanel"===kt&&(0,d.jsx)(Np,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,updateStatus:oe,masterResources:Ee,globalTuning:Oe,currentSeason:(null===(B=gn.seasons)||void 0===B?void 0:B.type)||"Unknown",masterXPLevels:He}),"NewTrainPanel"===kt&&(0,d.jsx)(jp,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,updateStatus:oe,masterResources:Ee,setModalContent:Q,setIsModalOpen:Z,globalTuning:Oe,currentSeason:(null===(L=gn.seasons)||void 0===L?void 0:L.type)||"Unknown",masterXPLevels:He}),"CarnivalPanel"===kt&&(0,d.jsx)(Dp,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,updateStatus:oe,masterResources:Ee,masterXPLevels:He,setModalContent:Q,setIsModalOpen:Z}),"HowToPanel"===kt&&(0,d.jsx)(Nh,{onOpen:At,onClose:It}),"HowToMoneyPanel"===kt&&(0,d.jsx)(Rh,{onOpen:At,onClose:It}),"HowToGemsPanel"===kt&&(0,d.jsx)(Mh,{currentPlayer:ve,updateStatus:oe,onOpen:At,onClose:It}),"GoldBenefitsPanel"===kt&&(0,d.jsx)(Pm,{currentPlayer:ve,updateStatus:oe,onOpen:At,onClose:It}),"GovPanel"===kt&&(0,d.jsx)(kp,{onClose:It,currentPlayer:ve,setCurrentPlayer:be,setModalContent:Q,setIsModalOpen:Z}),"LeaderboardPanel"===kt&&(0,d.jsx)(Ip,{onClose:It,currentPlayer:ve,setModalContent:Q,setIsModalOpen:Z,masterResources:Ee,masterTraders:$e,masterXPLevels:He}),"Courthouse"===kt&&(0,d.jsx)(Op,{onClose:It,currentPlayer:ve,setCurrentPlayer:be,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,setResources:Te,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:xe,TILE_SIZE:tt,isDeveloper:z,masterResources:Ee,masterXPLevels:He,masterSkills:Re}),"QuestPanel"===kt&&(0,d.jsx)(Oh,{onClose:It,currentPlayer:ve,setCurrentPlayer:be}),"SkillsPanel"===kt&&(0,d.jsx)(Tp,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,stationType:null===Mt||void 0===Mt?void 0:Mt.type,stationCategory:null===Mt||void 0===Mt?void 0:Mt.category,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,isDeveloper:z,TILE_SIZE:tt,updateStatus:oe,masterSkills:Re,setResources:Te,masterResources:Ee,masterXPLevels:He}),"CombatPanel"===kt&&(0,d.jsx)(Em,{onClose:It,inventory:dt,setInventory:ut,currentPlayer:ve,setCurrentPlayer:be,masterResources:Ee,masterSkills:Re,TILE_SIZE:tt,updateStatus:oe}),"CraftingStation"===kt&&(0,d.jsx)(Fp,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,resources:Se,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,masterResources:Ee,masterSkills:Re,TILE_SIZE:tt,updateStatus:oe,isDeveloper:z,currentSeason:null===ye||void 0===ye?void 0:ye.type,globalTuning:Oe}),"FarmHouse"===kt&&(0,d.jsx)(zp,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,masterResources:Ee,masterSkills:Re,masterTrophies:ze,TILE_SIZE:tt,updateStatus:oe,isDeveloper:z}),"ShopStation"===kt&&(0,d.jsx)(nm,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,TILE_SIZE:tt,updateStatus:oe,masterResources:Ee,masterTraders:$e,masterTrophies:ze,isDeveloper:z,globalTuning:Oe,masterXPLevels:He}),"ScrollStation"===kt&&(0,d.jsx)(om,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,TILE_SIZE:tt,updateStatus:oe,masterResources:Ee,masterTrophies:ze,isDeveloper:z}),"FarmingPanel"===kt&&(0,d.jsx)(gp,{onClose:It,TILE_SIZE:tt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,resources:Se,setResources:Te,tiles:Ae,tileTypes:Ce,setTileTypes:ke,currentPlayer:ve,setCurrentPlayer:be,gridId:xe,masterResources:Ee,masterSkills:Re,updateStatus:oe,currentSeason:null===ye||void 0===ye?void 0:ye.type,isDeveloper:z,cursorMode:Ut,setCursorMode:Ht}),"ToolsPanel"===kt&&(0,d.jsx)(xp,{onClose:It,TILE_SIZE:tt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,resources:Se,setResources:Te,tiles:Ae,tileTypes:Ce,setTileTypes:ke,currentPlayer:ve,setCurrentPlayer:be,gridId:xe,masterResources:Ee,masterSkills:Re,masterXPLevels:He,updateStatus:oe,isDeveloper:z,cursorMode:Ut,setCursorMode:Ht}),"BuildPanel"===kt&&(0,d.jsx)(ap,{onClose:It,TILE_SIZE:tt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,resources:Se,setResources:Te,currentPlayer:ve,setCurrentPlayer:be,gridId:xe,masterResources:Ee,masterSkills:Re,updateStatus:oe,isDeveloper:z,currentSeason:null===ye||void 0===ye?void 0:ye.type,globalTuning:Oe,masterXPLevels:He,cursorMode:Ut,setCursorMode:Ht}),"BuyPanel"===kt&&(0,d.jsx)(ip,{onClose:It,TILE_SIZE:tt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,resources:Se,setResources:Te,currentPlayer:ve,setCurrentPlayer:be,gridId:xe,masterResources:Ee,masterSkills:Re,updateStatus:oe,isDeveloper:z,currentSeason:null===ye||void 0===ye?void 0:ye.type,NPCsInGrid:gt,globalTuning:Oe,masterXPLevels:He,cursorMode:Ut,setCursorMode:Ht}),"PetsPanel"===kt&&(0,d.jsx)(cp,{onClose:It,TILE_SIZE:tt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,resources:Se,setResources:Te,currentPlayer:ve,setCurrentPlayer:be,gridId:xe,masterResources:Ee,masterSkills:Re,updateStatus:oe,isDeveloper:z,currentSeason:null===ye||void 0===ye?void 0:ye.type,cursorMode:Ut,setCursorMode:Ht}),"BuyDecoPanel"===kt&&(0,d.jsx)(up,{onClose:It,TILE_SIZE:tt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,resources:Se,setResources:Te,currentPlayer:ve,setCurrentPlayer:be,gridId:xe,masterResources:Ee,masterSkills:Re,updateStatus:oe,isDeveloper:z,currentSeason:null===ye||void 0===ye?void 0:ye.type,cursorMode:Ut,setCursorMode:Ht}),"NPCPanel"===kt&&(0,d.jsx)(np,{onClose:It,npcData:Pt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,TILE_SIZE:tt,updateStatus:oe,masterResources:Ee,masterInteractions:Le,masterTraders:$e,masterTrophies:ze,masterXPLevels:He,zoomLevel:Ye,setZoomLevel:Ke,centerCameraOnPlayer:$d.V5,globalTuning:Oe,isDeveloper:z}),"FarmHandPanel"===kt&&(0,d.jsx)(em,{onClose:It,npc:Pt,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,resources:Se,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,TILE_SIZE:tt,updateStatus:oe,masterResources:Ee,masterSkills:Re,currentSeason:null===ye||void 0===ye?void 0:ye.type,isDeveloper:z,globalTuning:Oe,masterXPLevels:He}),"SocialPanel"===kt&&(0,d.jsx)(Am,{onClose:It,pcData:Nt,currentPlayer:ve,setCurrentPlayer:be,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,updateStatus:oe,masterInteractions:Le,masterTrophies:ze,masterResources:Ee,masterXPLevels:He,masterTraders:$e,isDeveloper:z,controllerUsername:Zt,setControllerUsername:Jt,openPanel:At}),"AnimalStall"===kt&&(0,d.jsx)(cm,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,TILE_SIZE:tt,updateStatus:oe,masterResources:Ee,isDeveloper:z}),"AnimalPanel"===kt&&(0,d.jsx)(ed,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,npcId:null===Mt||void 0===Mt?void 0:Mt.npcId,TILE_SIZE:tt,updateStatus:oe,masterResources:Ee}),"CropPanel"===kt&&(0,d.jsx)(um,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,currentResource:null===Mt||void 0===Mt?void 0:Mt.resource,TILE_SIZE:tt,updateStatus:oe,masterResources:Ee}),"DecoPanel"===kt&&(0,d.jsx)(pm,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,TILE_SIZE:tt,updateStatus:oe,masterResources:Ee,isDeveloper:z}),"PetPanel"===kt&&(0,d.jsx)(im,{onClose:It,inventory:dt,setInventory:ut,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,setResources:Te,petResource:Se.find((e=>{var t,n;return e.x===(null===Mt||void 0===Mt||null===(t=Mt.position)||void 0===t?void 0:t.x)&&e.y===(null===Mt||void 0===Mt||null===(n=Mt.position)||void 0===n?void 0:n.y)})),currentPetPosition:null===Mt||void 0===Mt?void 0:Mt.position,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,masterResources:Ee,masterSkills:Re,masterTrophies:ze,TILE_SIZE:tt,isDeveloper:z}),"TradeStall"===kt&&(0,d.jsx)(gm,{onClose:It,inventory:dt,setInventory:ut,currentPlayer:ve,setCurrentPlayer:be,updateStatus:oe,globalTuning:Oe,setModalContent:Q,setIsModalOpen:Z}),"OutpostPanel"===kt&&(0,d.jsx)(vm,{onClose:It,backpack:ht,setBackpack:pt,currentPlayer:ve,setCurrentPlayer:be,gridId:null===Mt||void 0===Mt?void 0:Mt.gridId,setModalContent:Q,setIsModalOpen:Z,isDeveloper:z,stationType:null===Mt||void 0===Mt?void 0:Mt.type,currentStationPosition:null===Mt||void 0===Mt?void 0:Mt.position,setResources:Te,setInventory:ut,TILE_SIZE:tt,globalTuning:Oe}),"SeasonPanel"===kt&&(0,d.jsx)(Sm,{onClose:It,currentPlayer:ve,setCurrentPlayer:be,setModalContent:Q,setIsModalOpen:Z})]}),G&&(0,d.jsx)("div",{style:{position:"fixed",inset:0,zIndex:9999,backgroundColor:"rgba(0,0,0,0.0)",cursor:"wait"}}),(0,d.jsx)(Dm,{isTransitioning:he}),(0,d.jsx)(nh,{isOpen:ie,onClose:()=>le(!1),currentLevel:ce.currentLevel,previousLevel:ce.previousLevel,updateStatus:oe,masterResources:Ee})]})},$m=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,6453)).then((t=>{let{getCLS:n,getFID:r,getFCP:o,getLCP:a,getTTFB:s}=t;n(e),r(e),o(e),a(e),s(e)}))};if(console.warn("\ud83d\udd25 index.js evaluated again \u2014 app may remount"),window.__app_initialized__)console.log("\ud83d\uded1 App already initialized, preventing HMR remount");else{window.__app_initialized__=!0;let e="en";try{const t=localStorage.getItem("player");if(t){const n=JSON.parse(t);null!==n&&void 0!==n&&n.language&&(e=n.language)}}catch(Gm){console.warn("Failed to parse player data for language:",Gm)}const t=e,n=document.getElementById("root");console.log("\ud83e\udeb5 root element:",n),window.__root_created__?console.error("\u274c React root was already created!"):(console.warn("\ud83e\uddea Creating React root"),window.__root_created__=!0,window.__root=o.createRoot(n)),window.__app_rendered__?console.error("\u274c App already rendered \u2014 something is wrong"):(console.warn("\ud83e\uddea Rendering App..."),window.__app_rendered__=!0,window.__root.render((0,d.jsx)(ru,{children:(0,d.jsx)(qp,{children:(0,d.jsx)(Tu,{children:(0,d.jsx)(r.s,{language:t,children:(0,d.jsx)(gu,{children:(0,d.jsx)(pu,{children:(0,d.jsx)(bu,{children:(0,d.jsx)(Xc.e,{children:(0,d.jsx)(fh,{children:(0,d.jsx)(Fm,{})})})})})})})})})})))}$m()})()})();
//# sourceMappingURL=main.f96dd92f.js.map