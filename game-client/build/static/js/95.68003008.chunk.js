"use strict";(self.webpackChunkgame_client=self.webpackChunkgame_client||[]).push([[95],{95:(n,o,e)=>{e.d(o,{handleDungeonEntrance:()=>l,handleDungeonExit:()=>g});var t=e(488),r=e(213),i=e(593),s=e(894),d=(e(467),e(364));const a="695bd5b76545a9be8a36ee22";async function l(n,o,e,d,a,l,g,u,c,p,v,h){let f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,x=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null,T=arguments.length>15&&void 0!==arguments[15]?arguments[15]:{x:0,y:0};try{if(console.log("\ud83d\udeaa Handling dungeon entrance click, phase:",o),"open"!==o){console.log("\ud83d\udd12 Dungeon is closed (phase: "+o+")");const n=(null===f||void 0===f?void 0:f[10201])||"The dungeon is currently closed";return s.A.addFloatingText(n,T.x,T.y,c),void u(n)}null!==x&&void 0!==x&&x.startTransition&&(console.log("\ud83c\udf11 [DUNGEON] Starting fade transition"),x.startTransition()),console.log("\u2705 Dungeon is open, preparing teleportation...");try{const o=n.location.g,s=await r.A.post(`${t.A}/api/enter-dungeon`,{playerId:n._id,sourceGridId:o,frontierId:n.frontierId});if(!s.data.success)throw new Error(s.data.error||"Failed to enter dungeon");const T=s.data.dungeonGridId,E=s.data.entryPosition,w=s.data.sourceGridId;console.log("\ud83c\udfb2 Entering dungeon:",T,"at position:",E,"from source:",w),e&&e((n=>({...n,sourceGridBeforeDungeon:w})));const I={...n.location},m={x:E.x,y:E.y,g:T,s:n.settlementId,f:n.frontierId,gtype:"dungeon",gridCoord:null};console.log("\ud83d\udccd Teleporting to dungeon:",m),await(0,i.t3)(n,I,m,e,d,a,l,g,c,p,u,v,h,f,y);u((null===f||void 0===f?void 0:f[10202])||"You have entered the dungeon!"),null!==x&&void 0!==x&&x.endTransition&&x.endTransition()}catch(I){throw I}}catch(I){var E,w;console.error("\u274c Error entering dungeon:",I),I.response&&(console.error("Error response data:",I.response.data),console.error("Error response status:",I.response.status));u((null===(E=I.response)||void 0===E||null===(w=E.data)||void 0===w?void 0:w.error)||"Failed to enter dungeon"),null!==x&&void 0!==x&&x.endTransition&&x.endTransition()}}async function g(n,o,e,s,l,g,u,c,p,v,h){let f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,x=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null;try{console.log("\ud83d\udeaa Handling dungeon exit click"),null!==x&&void 0!==x&&x.startTransition&&(console.log("\ud83c\udf11 [DUNGEON] Starting fade transition"),x.startTransition());const T=await r.A.post(`${t.A}/api/exit-dungeon`,{playerId:n._id});if(!T.data.success)throw new Error(T.data.error||"Failed to exit dungeon");const E=T.data.sourceGridId,w=T.data.exitPosition,I=T.data.settlementId;console.log("\ud83c\udfe0 Returning to grid:",E,"at position:",w),console.log("\ud83c\udfe0 Using settlementId from server:",I);const m={...n.location},C={x:w.x,y:w.y,g:E,s:I,f:n.frontierId,gtype:T.data.gridType||"valley",gridCoord:T.data.gridCoord};console.log("\ud83d\udccd Teleporting back to:",C),await(0,i.t3)(n,m,C,o,e,s,l,g,c,p,u,v,h,f,y),o&&o((n=>({...n,sourceGridBeforeDungeon:null})));const D=m.g===a,G="town"===C.gtype;null!==n&&void 0!==n&&n.firsttimeuser&&D&&G&&(console.log("\ud83c\udf93 First-time user exited FTUE Cave into town - triggering ExitedCave"),await(0,d.LQ)("ExitedCave",n._id,n,o));u((null===f||void 0===f?void 0:f[10203])||"You have exited the dungeon"),null!==x&&void 0!==x&&x.endTransition&&x.endTransition()}catch(T){console.error("\u274c Error exiting dungeon:",T),T.response&&(console.error("Error response data:",T.response.data),console.error("Error response status:",T.response.status),console.error("Error response headers:",T.response.headers)),u("Failed to exit dungeon"),null!==x&&void 0!==x&&x.endTransition&&x.endTransition()}}}}]);
//# sourceMappingURL=95.68003008.chunk.js.map