"use strict";(self.webpackChunkgame_client=self.webpackChunkgame_client||[]).push([[95],{95:(n,o,e)=>{e.d(o,{handleDungeonEntrance:()=>d,handleDungeonExit:()=>a});var r=e(488),t=e(213),i=e(593),s=e(894);e(467);async function d(n,o,e,d,a,l,g,u,c,p,v,h){let f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,T=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null,x=arguments.length>15&&void 0!==arguments[15]?arguments[15]:{x:0,y:0};try{if(console.log("\ud83d\udeaa Handling dungeon entrance click, phase:",o),"open"!==o){console.log("\ud83d\udd12 Dungeon is closed (phase: "+o+")");const n=(null===f||void 0===f?void 0:f[10201])||"The dungeon is currently closed";return s.A.addFloatingText(n,x.x,x.y,c),void u(n)}null!==T&&void 0!==T&&T.startTransition&&(console.log("\ud83c\udf11 [DUNGEON] Starting fade transition"),T.startTransition()),console.log("\u2705 Dungeon is open, preparing teleportation...");try{const o=n.location.g,s=await t.A.post(`${r.A}/api/enter-dungeon`,{playerId:n._id,sourceGridId:o,frontierId:n.frontierId});if(!s.data.success)throw new Error(s.data.error||"Failed to enter dungeon");const x=s.data.dungeonGridId,E=s.data.entryPosition,I=s.data.sourceGridId;console.log("\ud83c\udfb2 Entering dungeon:",x,"at position:",E,"from source:",I),e&&e((n=>({...n,sourceGridBeforeDungeon:I})));const w={...n.location},D={x:E.x,y:E.y,g:x,s:n.settlementId,f:n.frontierId,gtype:"dungeon",gridCoord:null};console.log("\ud83d\udccd Teleporting to dungeon:",D),await(0,i.t3)(n,w,D,e,d,a,l,g,c,p,u,v,h,f,y);u((null===f||void 0===f?void 0:f[10202])||"You have entered the dungeon!"),null!==T&&void 0!==T&&T.endTransition&&T.endTransition()}catch(w){throw w}}catch(w){var E,I;console.error("\u274c Error entering dungeon:",w),w.response&&(console.error("Error response data:",w.response.data),console.error("Error response status:",w.response.status));u((null===(E=w.response)||void 0===E||null===(I=E.data)||void 0===I?void 0:I.error)||"Failed to enter dungeon"),null!==T&&void 0!==T&&T.endTransition&&T.endTransition()}}async function a(n,o,e,s,d,a,l,g,u,c,p){let v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,h=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null;try{console.log("\ud83d\udeaa Handling dungeon exit click"),null!==f&&void 0!==f&&f.startTransition&&(console.log("\ud83c\udf11 [DUNGEON] Starting fade transition"),f.startTransition());const y=await t.A.post(`${r.A}/api/exit-dungeon`,{playerId:n._id});if(!y.data.success)throw new Error(y.data.error||"Failed to exit dungeon");const T=y.data.sourceGridId,x=y.data.exitPosition,E=y.data.settlementId;console.log("\ud83c\udfe0 Returning to grid:",T,"at position:",x),console.log("\ud83c\udfe0 Using settlementId from server:",E);const I={...n.location},w={x:x.x,y:x.y,g:T,s:E,f:n.frontierId,gtype:y.data.gridType||"valley",gridCoord:y.data.gridCoord};console.log("\ud83d\udccd Teleporting back to:",w),await(0,i.t3)(n,I,w,o,e,s,d,a,g,u,l,c,p,v,h),o&&o((n=>({...n,sourceGridBeforeDungeon:null})));l((null===v||void 0===v?void 0:v[10203])||"You have exited the dungeon"),null!==f&&void 0!==f&&f.endTransition&&f.endTransition()}catch(y){console.error("\u274c Error exiting dungeon:",y),y.response&&(console.error("Error response data:",y.response.data),console.error("Error response status:",y.response.status),console.error("Error response headers:",y.response.headers)),l("Failed to exit dungeon"),null!==f&&void 0!==f&&f.endTransition&&f.endTransition()}}}}]);
//# sourceMappingURL=95.e66923f4.chunk.js.map