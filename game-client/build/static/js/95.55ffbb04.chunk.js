"use strict";(self.webpackChunkgame_client=self.webpackChunkgame_client||[]).push([[95],{5095:(e,o,n)=>{n.d(o,{handleDungeonEntrance:()=>l,handleDungeonExit:()=>g});var t=n(3488),r=n(6213),i=n(1593),s=n(6894),d=(n(2467),n(5364));const a="695bd5b76545a9be8a36ee22";async function l(e,o,n,d,a,l,g,u,c,p,v,h){let f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,x=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null,T=arguments.length>15&&void 0!==arguments[15]?arguments[15]:{x:0,y:0};try{if(console.log("\ud83d\udeaa Handling dungeon entrance click, phase:",o),"open"!==o){console.log("\ud83d\udd12 Dungeon is closed (phase: "+o+")");const e=(null===f||void 0===f?void 0:f[10201])||"The dungeon is currently closed";return s.A.addFloatingText(e,T.x,T.y,c),void u(e)}null!==x&&void 0!==x&&x.startTransition&&(console.log("\ud83c\udf11 [DUNGEON] Starting fade transition"),x.startTransition()),console.log("\u2705 Dungeon is open, preparing teleportation...");try{const o=e.location.g,s=await r.A.post(`${t.A}/api/enter-dungeon`,{playerId:e._id,sourceGridId:o,frontierId:e.frontierId});if(!s.data.success)throw new Error(s.data.error||"Failed to enter dungeon");const T=s.data.dungeonGridId,E=s.data.entryPosition,I=s.data.sourceGridId;console.log("\ud83c\udfb2 Entering dungeon:",T,"at position:",E,"from source:",I),n&&n((e=>({...e,sourceGridBeforeDungeon:I})));const w={...e.location},m={x:E.x,y:E.y,g:T,s:e.settlementId,f:e.frontierId,gtype:"dungeon",gridCoord:null};console.log("\ud83d\udccd Teleporting to dungeon:",m),await(0,i.t3)(e,w,m,n,d,a,l,g,c,p,u,v,h,f,y);u((null===f||void 0===f?void 0:f[10202])||"You have entered the dungeon!"),null!==x&&void 0!==x&&x.endTransition&&x.endTransition()}catch(w){throw w}}catch(w){var E,I;console.error("\u274c Error entering dungeon:",w),w.response&&(console.error("Error response data:",w.response.data),console.error("Error response status:",w.response.status));u((null===(E=w.response)||void 0===E||null===(I=E.data)||void 0===I?void 0:I.error)||"Failed to enter dungeon"),null!==x&&void 0!==x&&x.endTransition&&x.endTransition()}}async function g(e,o,n,s,l,g,u,c,p,v,h){let f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,x=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null;try{console.log("\ud83d\udeaa Handling dungeon exit click"),null!==x&&void 0!==x&&x.startTransition&&(console.log("\ud83c\udf11 [DUNGEON] Starting fade transition"),x.startTransition());const T=await r.A.post(`${t.A}/api/exit-dungeon`,{playerId:e._id});if(!T.data.success)throw new Error(T.data.error||"Failed to exit dungeon");const E=T.data.sourceGridId,I=T.data.exitPosition,w=T.data.settlementId;console.log("\ud83c\udfe0 Returning to grid:",E,"at position:",I),console.log("\ud83c\udfe0 Using settlementId from server:",w);const m={...e.location},C={x:I.x,y:I.y,g:E,s:w,f:e.frontierId,gtype:T.data.gridType||"valley",gridCoord:T.data.gridCoord};console.log("\ud83d\udccd Teleporting back to:",C),await(0,i.t3)(e,m,C,o,n,s,l,g,c,p,u,v,h,f,y),o&&o((e=>({...e,sourceGridBeforeDungeon:null})));const D=m.g===a,G="homestead"===C.gtype;null!==e&&void 0!==e&&e.firsttimeuser&&D&&G&&(console.log("\ud83c\udf93 First-time user exited FTUE Cave into homestead - triggering ExitedCave"),await(0,d.LQ)("ExitedCave",e._id,e,o));u((null===f||void 0===f?void 0:f[10203])||"You have exited the dungeon"),null!==x&&void 0!==x&&x.endTransition&&x.endTransition()}catch(T){console.error("\u274c Error exiting dungeon:",T),T.response&&(console.error("Error response data:",T.response.data),console.error("Error response status:",T.response.status),console.error("Error response headers:",T.response.headers)),u("Failed to exit dungeon"),null!==x&&void 0!==x&&x.endTransition&&x.endTransition()}}}}]);
//# sourceMappingURL=95.55ffbb04.chunk.js.map